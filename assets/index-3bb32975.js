import{_ as Y5}from"./index-10e24cf3.js";/* empty css              */import{r as z1,a as w1,q as OD,h as B2,j as z2,B as gv,I as yv,m as df,n as DD,R as pf,u as FD,M as ND,o as BD,J as zD,a1 as UD,a2 as VD}from"./vue-e0e31f72.js";import{c as jc,h as mf,d as v_,e as jD,j as $D,B as GD}from"./arco-38a32e5c.js";function HD(){let e=z1(!1);function t(){e.value=!e.value}return{mixinFullscreen:e,mixinFullscreenMethod:t}}var q5={},Z5={},nA=function(t){return Z5[t]},Gp=function(t,r){Z5[t]=r},WD=function(t){return q5[t]},Ag=function(t,r){q5[t]=r},iA={},Eb={},Sb=34,$g=10,Ab=13;function K5(e){return new Function("d","return {"+e.map(function(t,r){return JSON.stringify(t)+": d["+r+'] || ""'}).join(",")+"}")}function XD(e,t){var r=K5(e);return function(n,i){return t(r(n),i,e)}}function aA(e){var t=Object.create(null),r=[];return e.forEach(function(n){for(var i in n)i in t||r.push(t[i]=i)}),r}function Fc(e,t){var r=e+"",n=r.length;return n<t?new Array(t-n+1).join(0)+r:r}function YD(e){return e<0?"-"+Fc(-e,6):e>9999?"+"+Fc(e,6):Fc(e,4)}function qD(e){var t=e.getUTCHours(),r=e.getUTCMinutes(),n=e.getUTCSeconds(),i=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":YD(e.getUTCFullYear())+"-"+Fc(e.getUTCMonth()+1,2)+"-"+Fc(e.getUTCDate(),2)+(i?"T"+Fc(t,2)+":"+Fc(r,2)+":"+Fc(n,2)+"."+Fc(i,3)+"Z":n?"T"+Fc(t,2)+":"+Fc(r,2)+":"+Fc(n,2)+"Z":r||t?"T"+Fc(t,2)+":"+Fc(r,2)+"Z":"")}function ZD(e){var t=new RegExp('["'+e+`
\r]`),r=e.charCodeAt(0);function n(x,E){var T,I,k=i(x,function(D,V){if(T)return T(D,V-1);I=D,T=E?XD(D,E):K5(D)});return k.columns=I||[],k}function i(x,E){var T=[],I=x.length,k=0,D=0,V,O=I<=0,F=!1;x.charCodeAt(I-1)===$g&&--I,x.charCodeAt(I-1)===Ab&&--I;function N(){if(O)return Eb;if(F)return F=!1,iA;var q,Y=k,ee;if(x.charCodeAt(Y)===Sb){for(;k++<I&&x.charCodeAt(k)!==Sb||x.charCodeAt(++k)===Sb;);return(q=k)>=I?O=!0:(ee=x.charCodeAt(k++))===$g?F=!0:ee===Ab&&(F=!0,x.charCodeAt(k)===$g&&++k),x.slice(Y+1,q-1).replace(/""/g,'"')}for(;k<I;){if((ee=x.charCodeAt(q=k++))===$g)F=!0;else if(ee===Ab)F=!0,x.charCodeAt(k)===$g&&++k;else if(ee!==r)continue;return x.slice(Y,q)}return O=!0,x.slice(Y,I)}for(;(V=N())!==Eb;){for(var H=[];V!==iA&&V!==Eb;)H.push(V),V=N();E&&(H=E(H,D++))==null||T.push(H)}return T}function o(x,E){return x.map(function(T){return E.map(function(I){return y(T[I])}).join(e)})}function a(x,E){return E==null&&(E=aA(x)),[E.map(y).join(e)].concat(o(x,E)).join(`
`)}function u(x,E){return E==null&&(E=aA(x)),o(x,E).join(`
`)}function c(x){return x.map(h).join(`
`)}function h(x){return x.map(y).join(e)}function y(x){return x==null?"":x instanceof Date?qD(x):t.test(x+="")?'"'+x.replace(/"/g,'""')+'"':x}return{parse:n,parseRows:i,format:a,formatBody:u,formatRows:c,formatRow:h,formatValue:y}}var KD=ZD(","),QD=KD.parse;function U2(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function JD(e){if(Array.isArray(e))return U2(e)}function e6(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Q5(e,t){if(e){if(typeof e=="string")return U2(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return U2(e,t)}}function t6(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function cn(e){return JD(e)||e6(e)||Q5(e)||t6()}function qh(e){"@babel/helpers - typeof";return qh=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},qh(e)}function r6(e,t){if(qh(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(qh(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function J5(e){var t=r6(e,"string");return qh(t)==="symbol"?t:String(t)}function Q(e,t,r){return t=J5(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function oA(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function _t(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?oA(Object(r),!0).forEach(function(n){Q(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):oA(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var n6=E1;function E1(e,t){var r=e&&e.type,n;if(r==="FeatureCollection")for(n=0;n<e.features.length;n++)E1(e.features[n],t);else if(r==="GeometryCollection")for(n=0;n<e.geometries.length;n++)E1(e.geometries[n],t);else if(r==="Feature")E1(e.geometry,t);else if(r==="Polygon")sA(e.coordinates,t);else if(r==="MultiPolygon")for(n=0;n<e.coordinates.length;n++)sA(e.coordinates[n],t);return e}function sA(e,t){if(e.length!==0){uA(e[0],t);for(var r=1;r<e.length;r++)uA(e[r],!t)}}function uA(e,t){for(var r=0,n=0,i=0,o=e.length,a=o-1;i<o;a=i++){var u=(e[i][0]-e[a][0])*(e[a][1]+e[i][1]),c=r+u;n+=Math.abs(r)>=Math.abs(u)?r-c+u:u-c+r,r=c}r+n>=0!=!!t&&e.reverse()}const V2=jc(n6);var Fl=63710088e-1,TE={centimeters:Fl*100,centimetres:Fl*100,degrees:Fl/111325,feet:Fl*3.28084,inches:Fl*39.37,kilometers:Fl/1e3,kilometres:Fl/1e3,meters:Fl,metres:Fl,miles:Fl/1609.344,millimeters:Fl*1e3,millimetres:Fl*1e3,nauticalmiles:Fl/1852,radians:1,yards:Fl*1.0936},i6={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/Fl,yards:1.0936133},j2={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function nh(e,t,r){r===void 0&&(r={});var n={type:"Feature"};return(r.id===0||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=t||{},n.geometry=e,n}function a6(e,t,r){switch(e){case"Point":return fs(t).geometry;case"LineString":return yl(t).geometry;case"Polygon":return Um(t).geometry;case"MultiPoint":return eI(t).geometry;case"MultiLineString":return CE(t).geometry;case"MultiPolygon":return ME(t).geometry;default:throw new Error(e+" is invalid")}}function fs(e,t,r){if(r===void 0&&(r={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!U1(e[0])||!U1(e[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:e};return nh(n,t,r)}function o6(e,t,r){return r===void 0&&(r={}),Qo(e.map(function(n){return fs(n,t)}),r)}function Um(e,t,r){r===void 0&&(r={});for(var n=0,i=e;n<i.length;n++){var o=i[n];if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var a=0;a<o[o.length-1].length;a++)if(o[o.length-1][a]!==o[0][a])throw new Error("First and last Position are not equivalent.")}var u={type:"Polygon",coordinates:e};return nh(u,t,r)}function s6(e,t,r){return r===void 0&&(r={}),Qo(e.map(function(n){return Um(n,t)}),r)}function yl(e,t,r){if(r===void 0&&(r={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:e};return nh(n,t,r)}function u6(e,t,r){return r===void 0&&(r={}),Qo(e.map(function(n){return yl(n,t)}),r)}function Qo(e,t){t===void 0&&(t={});var r={type:"FeatureCollection"};return t.id&&(r.id=t.id),t.bbox&&(r.bbox=t.bbox),r.features=e,r}function CE(e,t,r){r===void 0&&(r={});var n={type:"MultiLineString",coordinates:e};return nh(n,t,r)}function eI(e,t,r){r===void 0&&(r={});var n={type:"MultiPoint",coordinates:e};return nh(n,t,r)}function ME(e,t,r){r===void 0&&(r={});var n={type:"MultiPolygon",coordinates:e};return nh(n,t,r)}function l6(e,t,r){r===void 0&&(r={});var n={type:"GeometryCollection",geometries:e};return nh(n,t,r)}function c6(e,t){if(t===void 0&&(t=0),t&&!(t>=0))throw new Error("precision must be a positive number");var r=Math.pow(10,t||0);return Math.round(e*r)/r}function PE(e,t){t===void 0&&(t="kilometers");var r=TE[t];if(!r)throw new Error(t+" units is invalid");return e*r}function Rx(e,t){t===void 0&&(t="kilometers");var r=TE[t];if(!r)throw new Error(t+" units is invalid");return e/r}function f6(e,t){return ky(Rx(e,t))}function h6(e){var t=e%360;return t<0&&(t+=360),t}function ky(e){var t=e%(2*Math.PI);return t*180/Math.PI}function Jf(e){var t=e%360;return t*Math.PI/180}function p6(e,t,r){if(t===void 0&&(t="kilometers"),r===void 0&&(r="kilometers"),!(e>=0))throw new Error("length must be a positive number");return PE(Rx(e,t),r)}function d6(e,t,r){if(t===void 0&&(t="meters"),r===void 0&&(r="kilometers"),!(e>=0))throw new Error("area must be a positive number");var n=j2[t];if(!n)throw new Error("invalid original units");var i=j2[r];if(!i)throw new Error("invalid final units");return e/n*i}function U1(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function IE(e){return!!e&&e.constructor===Object}function v6(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(e.length!==4&&e.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach(function(t){if(!U1(t))throw new Error("bbox must only contain numbers")})}function m6(e){if(!e)throw new Error("id is required");if(["string","number"].indexOf(typeof e)===-1)throw new Error("id must be a number or a string")}const g6=Object.freeze(Object.defineProperty({__proto__:null,areaFactors:j2,bearingToAzimuth:h6,convertArea:d6,convertLength:p6,degreesToRadians:Jf,earthRadius:Fl,factors:TE,feature:nh,featureCollection:Qo,geometry:a6,geometryCollection:l6,isNumber:U1,isObject:IE,lengthToDegrees:f6,lengthToRadians:Rx,lineString:yl,lineStrings:u6,multiLineString:CE,multiPoint:eI,multiPolygon:ME,point:fs,points:o6,polygon:Um,polygons:s6,radiansToDegrees:ky,radiansToLength:PE,round:c6,unitsFactors:i6,validateBBox:v6,validateId:m6},Symbol.toStringTag,{value:"Module"}));function $0(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Od(e){if(Array.isArray(e))return e;if(e.type==="Feature"){if(e.geometry!==null)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function G0(e){return e.type==="Feature"?e.geometry:e}function tI(e,t){return e.type==="FeatureCollection"?"FeatureCollection":e.type==="GeometryCollection"?"GeometryCollection":e.type==="Feature"&&e.geometry!==null?e.geometry.type:e.type}function Nd(e,t,r){if(e!==null)for(var n,i,o,a,u,c,h,y=0,x=0,E,T=e.type,I=T==="FeatureCollection",k=T==="Feature",D=I?e.features.length:1,V=0;V<D;V++){h=I?e.features[V].geometry:k?e.geometry:e,E=h?h.type==="GeometryCollection":!1,u=E?h.geometries.length:1;for(var O=0;O<u;O++){var F=0,N=0;if(a=E?h.geometries[O]:h,a!==null){c=a.coordinates;var H=a.type;switch(y=r&&(H==="Polygon"||H==="MultiPolygon")?1:0,H){case null:break;case"Point":if(t(c,x,V,F,N)===!1)return!1;x++,F++;break;case"LineString":case"MultiPoint":for(n=0;n<c.length;n++){if(t(c[n],x,V,F,N)===!1)return!1;x++,H==="MultiPoint"&&F++}H==="LineString"&&F++;break;case"Polygon":case"MultiLineString":for(n=0;n<c.length;n++){for(i=0;i<c[n].length-y;i++){if(t(c[n][i],x,V,F,N)===!1)return!1;x++}H==="MultiLineString"&&F++,H==="Polygon"&&N++}H==="Polygon"&&F++;break;case"MultiPolygon":for(n=0;n<c.length;n++){for(N=0,i=0;i<c[n].length;i++){for(o=0;o<c[n][i].length-y;o++){if(t(c[n][i][o],x,V,F,N)===!1)return!1;x++}N++}F++}break;case"GeometryCollection":for(n=0;n<a.geometries.length;n++)if(Nd(a.geometries[n],t,r)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function y6(e,t,r,n){var i=r;return Nd(e,function(o,a,u,c,h){a===0&&r===void 0?i=o:i=t(i,o,a,u,c,h)},n),i}function rI(e,t){var r;switch(e.type){case"FeatureCollection":for(r=0;r<e.features.length&&t(e.features[r].properties,r)!==!1;r++);break;case"Feature":t(e.properties,0);break}}function _6(e,t,r){var n=r;return rI(e,function(i,o){o===0&&r===void 0?n=i:n=t(n,i,o)}),n}function V1(e,t){if(e.type==="Feature")t(e,0);else if(e.type==="FeatureCollection")for(var r=0;r<e.features.length&&t(e.features[r],r)!==!1;r++);}function x6(e,t,r){var n=r;return V1(e,function(i,o){o===0&&r===void 0?n=i:n=t(n,i,o)}),n}function jp(e){var t=[];return Nd(e,function(r){t.push(r)}),t}function RE(e,t){var r,n,i,o,a,u,c,h,y,x,E=0,T=e.type==="FeatureCollection",I=e.type==="Feature",k=T?e.features.length:1;for(r=0;r<k;r++){for(u=T?e.features[r].geometry:I?e.geometry:e,h=T?e.features[r].properties:I?e.properties:{},y=T?e.features[r].bbox:I?e.bbox:void 0,x=T?e.features[r].id:I?e.id:void 0,c=u?u.type==="GeometryCollection":!1,a=c?u.geometries.length:1,i=0;i<a;i++){if(o=c?u.geometries[i]:u,o===null){if(t(null,E,h,y,x)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(t(o,E,h,y,x)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<o.geometries.length;n++)if(t(o.geometries[n],E,h,y,x)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}E++}}function nI(e,t,r){var n=r;return RE(e,function(i,o,a,u,c){o===0&&r===void 0?n=i:n=t(n,i,o,a,u,c)}),n}function Dv(e,t){RE(e,function(r,n,i,o,a){var u=r===null?null:r.type;switch(u){case null:case"Point":case"LineString":case"Polygon":return t(nh(r,i,{bbox:o,id:a}),n,0)===!1?!1:void 0}var c;switch(u){case"MultiPoint":c="Point";break;case"MultiLineString":c="LineString";break;case"MultiPolygon":c="Polygon";break}for(var h=0;h<r.coordinates.length;h++){var y=r.coordinates[h],x={type:c,coordinates:y};if(t(nh(x,i),n,h)===!1)return!1}})}function b6(e,t,r){var n=r;return Dv(e,function(i,o,a){o===0&&a===0&&r===void 0?n=i:n=t(n,i,o,a)}),n}function iI(e,t){Dv(e,function(r,n,i){var o=0;if(r.geometry){var a=r.geometry.type;if(!(a==="Point"||a==="MultiPoint")){var u,c=0,h=0,y=0;if(Nd(r,function(x,E,T,I,k){if(u===void 0||n>c||I>h||k>y){u=x,c=n,h=I,y=k,o=0;return}var D=yl([u,x],r.properties);if(t(D,n,i,k,o)===!1)return!1;o++,u=x})===!1)return!1}}})}function aI(e,t,r){var n=r,i=!1;return iI(e,function(o,a,u,c,h){i===!1&&r===void 0?n=o:n=t(n,o,a,u,c,h),i=!0}),n}function oI(e,t){if(!e)throw new Error("geojson is required");Dv(e,function(r,n,i){if(r.geometry!==null){var o=r.geometry.type,a=r.geometry.coordinates;switch(o){case"LineString":if(t(r,n,i,0,0)===!1)return!1;break;case"Polygon":for(var u=0;u<a.length;u++)if(t(yl(a[u],r.properties),n,i,u)===!1)return!1;break}}})}function w6(e,t,r){var n=r;return oI(e,function(i,o,a,u){o===0&&r===void 0?n=i:n=t(n,i,o,a,u)}),n}function E6(e,t){if(t=t||{},!IE(t))throw new Error("options is invalid");var r=t.featureIndex||0,n=t.multiFeatureIndex||0,i=t.geometryIndex||0,o=t.segmentIndex||0,a=t.properties,u;switch(e.type){case"FeatureCollection":r<0&&(r=e.features.length+r),a=a||e.features[r].properties,u=e.features[r].geometry;break;case"Feature":a=a||e.properties,u=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":u=e;break;default:throw new Error("geojson is invalid")}if(u===null)return null;var c=u.coordinates;switch(u.type){case"Point":case"MultiPoint":return null;case"LineString":return o<0&&(o=c.length+o-1),yl([c[o],c[o+1]],a,t);case"Polygon":return i<0&&(i=c.length+i),o<0&&(o=c[i].length+o-1),yl([c[i][o],c[i][o+1]],a,t);case"MultiLineString":return n<0&&(n=c.length+n),o<0&&(o=c[n].length+o-1),yl([c[n][o],c[n][o+1]],a,t);case"MultiPolygon":return n<0&&(n=c.length+n),i<0&&(i=c[n].length+i),o<0&&(o=c[n][i].length-o-1),yl([c[n][i][o],c[n][i][o+1]],a,t)}throw new Error("geojson is invalid")}function S6(e,t){if(t=t||{},!IE(t))throw new Error("options is invalid");var r=t.featureIndex||0,n=t.multiFeatureIndex||0,i=t.geometryIndex||0,o=t.coordIndex||0,a=t.properties,u;switch(e.type){case"FeatureCollection":r<0&&(r=e.features.length+r),a=a||e.features[r].properties,u=e.features[r].geometry;break;case"Feature":a=a||e.properties,u=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":u=e;break;default:throw new Error("geojson is invalid")}if(u===null)return null;var c=u.coordinates;switch(u.type){case"Point":return fs(c,a,t);case"MultiPoint":return n<0&&(n=c.length+n),fs(c[n],a,t);case"LineString":return o<0&&(o=c.length+o),fs(c[o],a,t);case"Polygon":return i<0&&(i=c.length+i),o<0&&(o=c[i].length+o),fs(c[i][o],a,t);case"MultiLineString":return n<0&&(n=c.length+n),o<0&&(o=c[n].length+o),fs(c[n][o],a,t);case"MultiPolygon":return n<0&&(n=c.length+n),i<0&&(i=c[n].length+i),o<0&&(o=c[n][i].length-o),fs(c[n][i][o],a,t)}throw new Error("geojson is invalid")}const A6=Object.freeze(Object.defineProperty({__proto__:null,coordAll:jp,coordEach:Nd,coordReduce:y6,featureEach:V1,featureReduce:x6,findPoint:S6,findSegment:E6,flattenEach:Dv,flattenReduce:b6,geomEach:RE,geomReduce:nI,lineEach:oI,lineReduce:w6,propEach:rI,propReduce:_6,segmentEach:iI,segmentReduce:aI},Symbol.toStringTag,{value:"Module"}));function sI(e,t){var r=t.x,n=t.y,i=t.x1,o=t.y1,a=t.coordinates,u=t.geometry,c=[];if(!Array.isArray(e))return{dataArray:[]};if(u)return e.filter(function(V){return V[u]&&V[u].type&&V[u].coordinates&&V[u].coordinates.length>0}).forEach(function(V,O){var F=V2(_t({},V[u]),!0);Dv(F,function(N){var H=Od(N),q=_t(_t({},V),{},{_id:O,coordinates:H});c.push(q)})}),{dataArray:c};for(var h=0;h<e.length;h++){var y=e[h],x=[];if(a){var E="Polygon";Array.isArray(a[0])||(E="Point"),Array.isArray(a[0])&&!Array.isArray(a[0][0])&&(E="LineString");var T=V2({type:E,coordinates:cn(y[a])},!0);x=T.coordinates}else if(r&&n&&i&&o){var I=[parseFloat(y[r]),parseFloat(y[n])],k=[parseFloat(y[i]),parseFloat(y[o])];x=[I,k]}else r&&n&&(x=[parseFloat(y[r]),parseFloat(y[n])]);var D=_t(_t({},y),{},{_id:h,coordinates:x});c.push(D)}return{dataArray:c}}function T6(e,t){var r=QD(e);return sI(r,t)}function C6(e){for(var t=e.toString(),r=5381,n=t.length;n;)r=r*33^t.charCodeAt(--n);return r>>>0}function M6(e,t){return t===void 0?null:qh(e.properties[t])*1==="number"?e.properties[t]*1:e.properties&&e.properties[t]?C6(e.properties[t]+"")%1000019:null}function P6(e,t){var r=[],n={};return e.features?(e.features=e.features.filter(function(i){var o=i.geometry;return i!=null&&o&&o.type&&o.coordinates&&o.coordinates.length>0}),V2(e,!0),e.features.length===0?{dataArray:[],featureKeys:n}:(Dv(e,function(i,o){var a=M6(i,t==null?void 0:t.featureId);a===null&&(a=o);var u=a,c=Od(i),h=_t(_t({},i.properties),{},{coordinates:c,_id:u});r.push(h)}),{dataArray:r,featureKeys:n})):(e.features=[],{dataArray:[]})}function lA(e,t,r,n,i,o,a){try{var u=e[o](a),c=u.value}catch(h){r(h);return}u.done?t(c):Promise.resolve(c).then(n,i)}function Vt(e){return function(){var t=this,r=arguments;return new Promise(function(n,i){var o=e.apply(t,r);function a(c){lA(o,n,i,a,u,"next",c)}function u(c){lA(o,n,i,a,u,"throw",c)}a(void 0)})}}var uI={exports:{}},lI={exports:{}};(function(e){function t(r){"@babel/helpers - typeof";return e.exports=t=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},e.exports.__esModule=!0,e.exports.default=e.exports,t(r)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports})(lI);var I6=lI.exports;(function(e){var t=I6.default;function r(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */e.exports=r=function(){return n},e.exports.__esModule=!0,e.exports.default=e.exports;var n={},i=Object.prototype,o=i.hasOwnProperty,a=Object.defineProperty||function(ze,Be,$e){ze[Be]=$e.value},u=typeof Symbol=="function"?Symbol:{},c=u.iterator||"@@iterator",h=u.asyncIterator||"@@asyncIterator",y=u.toStringTag||"@@toStringTag";function x(ze,Be,$e){return Object.defineProperty(ze,Be,{value:$e,enumerable:!0,configurable:!0,writable:!0}),ze[Be]}try{x({},"")}catch{x=function($e,it,mt){return $e[it]=mt}}function E(ze,Be,$e,it){var mt=Be&&Be.prototype instanceof k?Be:k,Qe=Object.create(mt.prototype),rt=new xe(it||[]);return a(Qe,"_invoke",{value:ee(ze,$e,rt)}),Qe}function T(ze,Be,$e){try{return{type:"normal",arg:ze.call(Be,$e)}}catch(it){return{type:"throw",arg:it}}}n.wrap=E;var I={};function k(){}function D(){}function V(){}var O={};x(O,c,function(){return this});var F=Object.getPrototypeOf,N=F&&F(F(Se([])));N&&N!==i&&o.call(N,c)&&(O=N);var H=V.prototype=k.prototype=Object.create(O);function q(ze){["next","throw","return"].forEach(function(Be){x(ze,Be,function($e){return this._invoke(Be,$e)})})}function Y(ze,Be){function $e(mt,Qe,rt,gt){var er=T(ze[mt],ze,Qe);if(er.type!=="throw"){var zt=er.arg,qt=zt.value;return qt&&t(qt)=="object"&&o.call(qt,"__await")?Be.resolve(qt.__await).then(function(Zr){$e("next",Zr,rt,gt)},function(Zr){$e("throw",Zr,rt,gt)}):Be.resolve(qt).then(function(Zr){zt.value=Zr,rt(zt)},function(Zr){return $e("throw",Zr,rt,gt)})}gt(er.arg)}var it;a(this,"_invoke",{value:function(Qe,rt){function gt(){return new Be(function(er,zt){$e(Qe,rt,er,zt)})}return it=it?it.then(gt,gt):gt()}})}function ee(ze,Be,$e){var it="suspendedStart";return function(mt,Qe){if(it==="executing")throw new Error("Generator is already running");if(it==="completed"){if(mt==="throw")throw Qe;return Ne()}for($e.method=mt,$e.arg=Qe;;){var rt=$e.delegate;if(rt){var gt=pe(rt,$e);if(gt){if(gt===I)continue;return gt}}if($e.method==="next")$e.sent=$e._sent=$e.arg;else if($e.method==="throw"){if(it==="suspendedStart")throw it="completed",$e.arg;$e.dispatchException($e.arg)}else $e.method==="return"&&$e.abrupt("return",$e.arg);it="executing";var er=T(ze,Be,$e);if(er.type==="normal"){if(it=$e.done?"completed":"suspendedYield",er.arg===I)continue;return{value:er.arg,done:$e.done}}er.type==="throw"&&(it="completed",$e.method="throw",$e.arg=er.arg)}}}function pe(ze,Be){var $e=Be.method,it=ze.iterator[$e];if(it===void 0)return Be.delegate=null,$e==="throw"&&ze.iterator.return&&(Be.method="return",Be.arg=void 0,pe(ze,Be),Be.method==="throw")||$e!=="return"&&(Be.method="throw",Be.arg=new TypeError("The iterator does not provide a '"+$e+"' method")),I;var mt=T(it,ze.iterator,Be.arg);if(mt.type==="throw")return Be.method="throw",Be.arg=mt.arg,Be.delegate=null,I;var Qe=mt.arg;return Qe?Qe.done?(Be[ze.resultName]=Qe.value,Be.next=ze.nextLoc,Be.method!=="return"&&(Be.method="next",Be.arg=void 0),Be.delegate=null,I):Qe:(Be.method="throw",Be.arg=new TypeError("iterator result is not an object"),Be.delegate=null,I)}function ue(ze){var Be={tryLoc:ze[0]};1 in ze&&(Be.catchLoc=ze[1]),2 in ze&&(Be.finallyLoc=ze[2],Be.afterLoc=ze[3]),this.tryEntries.push(Be)}function ie(ze){var Be=ze.completion||{};Be.type="normal",delete Be.arg,ze.completion=Be}function xe(ze){this.tryEntries=[{tryLoc:"root"}],ze.forEach(ue,this),this.reset(!0)}function Se(ze){if(ze){var Be=ze[c];if(Be)return Be.call(ze);if(typeof ze.next=="function")return ze;if(!isNaN(ze.length)){var $e=-1,it=function mt(){for(;++$e<ze.length;)if(o.call(ze,$e))return mt.value=ze[$e],mt.done=!1,mt;return mt.value=void 0,mt.done=!0,mt};return it.next=it}}return{next:Ne}}function Ne(){return{value:void 0,done:!0}}return D.prototype=V,a(H,"constructor",{value:V,configurable:!0}),a(V,"constructor",{value:D,configurable:!0}),D.displayName=x(V,y,"GeneratorFunction"),n.isGeneratorFunction=function(ze){var Be=typeof ze=="function"&&ze.constructor;return!!Be&&(Be===D||(Be.displayName||Be.name)==="GeneratorFunction")},n.mark=function(ze){return Object.setPrototypeOf?Object.setPrototypeOf(ze,V):(ze.__proto__=V,x(ze,y,"GeneratorFunction")),ze.prototype=Object.create(H),ze},n.awrap=function(ze){return{__await:ze}},q(Y.prototype),x(Y.prototype,h,function(){return this}),n.AsyncIterator=Y,n.async=function(ze,Be,$e,it,mt){mt===void 0&&(mt=Promise);var Qe=new Y(E(ze,Be,$e,it),mt);return n.isGeneratorFunction(Be)?Qe:Qe.next().then(function(rt){return rt.done?rt.value:Qe.next()})},q(H),x(H,y,"Generator"),x(H,c,function(){return this}),x(H,"toString",function(){return"[object Generator]"}),n.keys=function(ze){var Be=Object(ze),$e=[];for(var it in Be)$e.push(it);return $e.reverse(),function mt(){for(;$e.length;){var Qe=$e.pop();if(Qe in Be)return mt.value=Qe,mt.done=!1,mt}return mt.done=!0,mt}},n.values=Se,xe.prototype={constructor:xe,reset:function(Be){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(ie),!Be)for(var $e in this)$e.charAt(0)==="t"&&o.call(this,$e)&&!isNaN(+$e.slice(1))&&(this[$e]=void 0)},stop:function(){this.done=!0;var Be=this.tryEntries[0].completion;if(Be.type==="throw")throw Be.arg;return this.rval},dispatchException:function(Be){if(this.done)throw Be;var $e=this;function it(zt,qt){return rt.type="throw",rt.arg=Be,$e.next=zt,qt&&($e.method="next",$e.arg=void 0),!!qt}for(var mt=this.tryEntries.length-1;mt>=0;--mt){var Qe=this.tryEntries[mt],rt=Qe.completion;if(Qe.tryLoc==="root")return it("end");if(Qe.tryLoc<=this.prev){var gt=o.call(Qe,"catchLoc"),er=o.call(Qe,"finallyLoc");if(gt&&er){if(this.prev<Qe.catchLoc)return it(Qe.catchLoc,!0);if(this.prev<Qe.finallyLoc)return it(Qe.finallyLoc)}else if(gt){if(this.prev<Qe.catchLoc)return it(Qe.catchLoc,!0)}else{if(!er)throw new Error("try statement without catch or finally");if(this.prev<Qe.finallyLoc)return it(Qe.finallyLoc)}}}},abrupt:function(Be,$e){for(var it=this.tryEntries.length-1;it>=0;--it){var mt=this.tryEntries[it];if(mt.tryLoc<=this.prev&&o.call(mt,"finallyLoc")&&this.prev<mt.finallyLoc){var Qe=mt;break}}Qe&&(Be==="break"||Be==="continue")&&Qe.tryLoc<=$e&&$e<=Qe.finallyLoc&&(Qe=null);var rt=Qe?Qe.completion:{};return rt.type=Be,rt.arg=$e,Qe?(this.method="next",this.next=Qe.finallyLoc,I):this.complete(rt)},complete:function(Be,$e){if(Be.type==="throw")throw Be.arg;return Be.type==="break"||Be.type==="continue"?this.next=Be.arg:Be.type==="return"?(this.rval=this.arg=Be.arg,this.method="return",this.next="end"):Be.type==="normal"&&$e&&(this.next=$e),I},finish:function(Be){for(var $e=this.tryEntries.length-1;$e>=0;--$e){var it=this.tryEntries[$e];if(it.finallyLoc===Be)return this.complete(it.completion,it.afterLoc),ie(it),I}},catch:function(Be){for(var $e=this.tryEntries.length-1;$e>=0;--$e){var it=this.tryEntries[$e];if(it.tryLoc===Be){var mt=it.completion;if(mt.type==="throw"){var Qe=mt.arg;ie(it)}return Qe}}throw new Error("illegal catch attempt")},delegateYield:function(Be,$e,it){return this.delegate={iterator:Se(Be),resultName:$e,nextLoc:it},this.method==="next"&&(this.arg=void 0),I}},n}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports})(uI);var R6=uI.exports,S1=R6(),L6=S1;try{regeneratorRuntime=S1}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=S1:Function("r","regeneratorRuntime = r")(S1)}const Ce=jc(L6);function $2(e,t,r,n){for(var i=n,o=r-t>>1,a=r-t,u,c=e[t],h=e[t+1],y=e[r],x=e[r+1],E=t+3;E<r;E+=3){var T=k6(e[E],e[E+1],c,h,y,x);if(T>i)u=E,i=T;else if(T===i){var I=Math.abs(E-o);I<a&&(u=E,a=I)}}i>n&&(u-t>3&&$2(e,t,u,n),e[u+2]=i,r-u>3&&$2(e,u,r,n))}function k6(e,t,r,n,i,o){var a=i-r,u=o-n;if(a!==0||u!==0){var c=((e-r)*a+(t-n)*u)/(a*a+u*u);c>1?(r=i,n=o):c>0&&(r+=a*c,n+=u*c)}return a=e-r,u=t-n,a*a+u*u}function Oy(e,t,r,n){var i={id:typeof e>"u"?null:e,type:t,geometry:r,tags:n,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return O6(i),i}function O6(e){var t=e.geometry,r=e.type;if(r==="Point"||r==="MultiPoint"||r==="LineString")Tb(e,t);else if(r==="Polygon"||r==="MultiLineString")for(var n=0;n<t.length;n++)Tb(e,t[n]);else if(r==="MultiPolygon")for(n=0;n<t.length;n++)for(var i=0;i<t[n].length;i++)Tb(e,t[n][i])}function Tb(e,t){for(var r=0;r<t.length;r+=3)e.minX=Math.min(e.minX,t[r]),e.minY=Math.min(e.minY,t[r+1]),e.maxX=Math.max(e.maxX,t[r]),e.maxY=Math.max(e.maxY,t[r+1])}function D6(e,t){var r=[];if(e.type==="FeatureCollection")for(var n=0;n<e.features.length;n++)A1(r,e.features[n],t,n);else e.type==="Feature"?A1(r,e,t):A1(r,{geometry:e},t);return r}function A1(e,t,r,n){if(t.geometry){var i=t.geometry.coordinates,o=t.geometry.type,a=Math.pow(r.tolerance/((1<<r.maxZoom)*r.extent),2),u=[],c=t.id;if(r.promoteId?c=t.properties[r.promoteId]:r.generateId&&(c=n||0),o==="Point")cA(i,u);else if(o==="MultiPoint")for(var h=0;h<i.length;h++)cA(i[h],u);else if(o==="LineString")G2(i,u,a,!1);else if(o==="MultiLineString")if(r.lineMetrics){for(h=0;h<i.length;h++)u=[],G2(i[h],u,a,!1),e.push(Oy(c,"LineString",u,t.properties));return}else Cb(i,u,a,!1);else if(o==="Polygon")Cb(i,u,a,!0);else if(o==="MultiPolygon")for(h=0;h<i.length;h++){var y=[];Cb(i[h],y,a,!0),u.push(y)}else if(o==="GeometryCollection"){for(h=0;h<t.geometry.geometries.length;h++)A1(e,{id:c,geometry:t.geometry.geometries[h],properties:t.properties},r,n);return}else throw new Error("Input data is not a valid GeoJSON object.");e.push(Oy(c,o,u,t.properties))}}function cA(e,t){t.push(cI(e[0])),t.push(fI(e[1])),t.push(0)}function G2(e,t,r,n){for(var i,o,a=0,u=0;u<e.length;u++){var c=cI(e[u][0]),h=fI(e[u][1]);t.push(c),t.push(h),t.push(0),u>0&&(n?a+=(i*h-c*o)/2:a+=Math.sqrt(Math.pow(c-i,2)+Math.pow(h-o,2))),i=c,o=h}var y=t.length-3;t[2]=1,$2(t,0,y,r),t[y+2]=1,t.size=Math.abs(a),t.start=0,t.end=t.size}function Cb(e,t,r,n){for(var i=0;i<e.length;i++){var o=[];G2(e[i],o,r,n),t.push(o)}}function cI(e){return e/360+.5}function fI(e){var t=Math.sin(e*Math.PI/180),r=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return r<0?0:r>1?1:r}function Ad(e,t,r,n,i,o,a,u){if(r/=t,n/=t,o>=r&&a<n)return e;if(a<r||o>=n)return null;for(var c=[],h=0;h<e.length;h++){var y=e[h],x=y.geometry,E=y.type,T=i===0?y.minX:y.minY,I=i===0?y.maxX:y.maxY;if(T>=r&&I<n){c.push(y);continue}else if(I<r||T>=n)continue;var k=[];if(E==="Point"||E==="MultiPoint")F6(x,k,r,n,i);else if(E==="LineString")hI(x,k,r,n,i,!1,u.lineMetrics);else if(E==="MultiLineString")Mb(x,k,r,n,i,!1);else if(E==="Polygon")Mb(x,k,r,n,i,!0);else if(E==="MultiPolygon")for(var D=0;D<x.length;D++){var V=[];Mb(x[D],V,r,n,i,!0),V.length&&k.push(V)}if(k.length){if(u.lineMetrics&&E==="LineString"){for(D=0;D<k.length;D++)c.push(Oy(y.id,E,k[D],y.tags));continue}(E==="LineString"||E==="MultiLineString")&&(k.length===1?(E="LineString",k=k[0]):E="MultiLineString"),(E==="Point"||E==="MultiPoint")&&(E=k.length===3?"Point":"MultiPoint"),c.push(Oy(y.id,E,k,y.tags))}}return c.length?c:null}function F6(e,t,r,n,i){for(var o=0;o<e.length;o+=3){var a=e[o+i];a>=r&&a<=n&&(t.push(e[o]),t.push(e[o+1]),t.push(e[o+2]))}}function hI(e,t,r,n,i,o,a){for(var u=fA(e),c=i===0?N6:B6,h=e.start,y,x,E=0;E<e.length-3;E+=3){var T=e[E],I=e[E+1],k=e[E+2],D=e[E+3],V=e[E+4],O=i===0?T:I,F=i===0?D:V,N=!1;a&&(y=Math.sqrt(Math.pow(T-D,2)+Math.pow(I-V,2))),O<r?F>r&&(x=c(u,T,I,D,V,r),a&&(u.start=h+y*x)):O>n?F<n&&(x=c(u,T,I,D,V,n),a&&(u.start=h+y*x)):Pb(u,T,I,k),F<r&&O>=r&&(x=c(u,T,I,D,V,r),N=!0),F>n&&O<=n&&(x=c(u,T,I,D,V,n),N=!0),!o&&N&&(a&&(u.end=h+y*x),t.push(u),u=fA(e)),a&&(h+=y)}var H=e.length-3;T=e[H],I=e[H+1],k=e[H+2],O=i===0?T:I,O>=r&&O<=n&&Pb(u,T,I,k),H=u.length-3,o&&H>=3&&(u[H]!==u[0]||u[H+1]!==u[1])&&Pb(u,u[0],u[1],u[2]),u.length&&t.push(u)}function fA(e){var t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function Mb(e,t,r,n,i,o){for(var a=0;a<e.length;a++)hI(e[a],t,r,n,i,o,!1)}function Pb(e,t,r,n){e.push(t),e.push(r),e.push(n)}function N6(e,t,r,n,i,o){var a=(o-t)/(n-t);return e.push(o),e.push(r+(i-r)*a),e.push(1),a}function B6(e,t,r,n,i,o){var a=(o-r)/(i-r);return e.push(t+(n-t)*a),e.push(o),e.push(1),a}function z6(e,t){var r=t.buffer/t.extent,n=e,i=Ad(e,1,-1-r,r,0,-1,2,t),o=Ad(e,1,1-r,2+r,0,-1,2,t);return(i||o)&&(n=Ad(e,1,-r,1+r,0,-1,2,t)||[],i&&(n=hA(i,1).concat(n)),o&&(n=n.concat(hA(o,-1)))),n}function hA(e,t){for(var r=[],n=0;n<e.length;n++){var i=e[n],o=i.type,a;if(o==="Point"||o==="MultiPoint"||o==="LineString")a=Ib(i.geometry,t);else if(o==="MultiLineString"||o==="Polygon"){a=[];for(var u=0;u<i.geometry.length;u++)a.push(Ib(i.geometry[u],t))}else if(o==="MultiPolygon")for(a=[],u=0;u<i.geometry.length;u++){for(var c=[],h=0;h<i.geometry[u].length;h++)c.push(Ib(i.geometry[u][h],t));a.push(c)}r.push(Oy(i.id,o,a,i.tags))}return r}function Ib(e,t){var r=[];r.size=e.size,e.start!==void 0&&(r.start=e.start,r.end=e.end);for(var n=0;n<e.length;n+=3)r.push(e[n]+t,e[n+1],e[n+2]);return r}function pA(e,t){if(e.transformed)return e;var r=1<<e.z,n=e.x,i=e.y,o,a,u;for(o=0;o<e.features.length;o++){var c=e.features[o],h=c.geometry,y=c.type;if(c.geometry=[],y===1)for(a=0;a<h.length;a+=2)c.geometry.push(dA(h[a],h[a+1],t,r,n,i));else for(a=0;a<h.length;a++){var x=[];for(u=0;u<h[a].length;u+=2)x.push(dA(h[a][u],h[a][u+1],t,r,n,i));c.geometry.push(x)}}return e.transformed=!0,e}function dA(e,t,r,n,i,o){return[Math.round(r*(e*n-i)),Math.round(r*(t*n-o))]}function U6(e,t,r,n,i){for(var o=t===i.maxZoom?0:i.tolerance/((1<<t)*i.extent),a={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:r,y:n,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},u=0;u<e.length;u++){a.numFeatures++,V6(a,e[u],o,i);var c=e[u].minX,h=e[u].minY,y=e[u].maxX,x=e[u].maxY;c<a.minX&&(a.minX=c),h<a.minY&&(a.minY=h),y>a.maxX&&(a.maxX=y),x>a.maxY&&(a.maxY=x)}return a}function V6(e,t,r,n){var i=t.geometry,o=t.type,a=[];if(o==="Point"||o==="MultiPoint")for(var u=0;u<i.length;u+=3)a.push(i[u]),a.push(i[u+1]),e.numPoints++,e.numSimplified++;else if(o==="LineString")Rb(a,i,e,r,!1,!1);else if(o==="MultiLineString"||o==="Polygon")for(u=0;u<i.length;u++)Rb(a,i[u],e,r,o==="Polygon",u===0);else if(o==="MultiPolygon")for(var c=0;c<i.length;c++){var h=i[c];for(u=0;u<h.length;u++)Rb(a,h[u],e,r,!0,u===0)}if(a.length){var y=t.tags||null;if(o==="LineString"&&n.lineMetrics){y={};for(var x in t.tags)y[x]=t.tags[x];y.mapbox_clip_start=i.start/i.size,y.mapbox_clip_end=i.end/i.size}var E={geometry:a,type:o==="Polygon"||o==="MultiPolygon"?3:o==="LineString"||o==="MultiLineString"?2:1,tags:y};t.id!==null&&(E.id=t.id),e.features.push(E)}}function Rb(e,t,r,n,i,o){var a=n*n;if(n>0&&t.size<(i?a:n)){r.numPoints+=t.length/3;return}for(var u=[],c=0;c<t.length;c+=3)(n===0||t[c+2]>a)&&(r.numSimplified++,u.push(t[c]),u.push(t[c+1])),r.numPoints++;i&&j6(u,o),e.push(u)}function j6(e,t){for(var r=0,n=0,i=e.length,o=i-2;n<i;o=n,n+=2)r+=(e[n]-e[o])*(e[n+1]+e[o+1]);if(r>0===t)for(n=0,i=e.length;n<i/2;n+=2){var a=e[n],u=e[n+1];e[n]=e[i-2-n],e[n+1]=e[i-1-n],e[i-2-n]=a,e[i-1-n]=u}}function $6(e,t){return new Lx(e,t)}function Lx(e,t){t=this.options=G6(Object.create(this.options),t);var r=t.debug;if(t.maxZoom<0||t.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(t.promoteId&&t.generateId)throw new Error("promoteId and generateId cannot be used together.");var n=D6(e,t);this.tiles={},this.tileCoords=[],r&&(this.stats={},this.total=0),n=z6(n,t),n.length&&this.splitTile(n,0,0,0),r&&n.length}Lx.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};Lx.prototype.splitTile=function(e,t,r,n,i,o,a){for(var u=[e,t,r,n],c=this.options,h=c.debug;u.length;){n=u.pop(),r=u.pop(),t=u.pop(),e=u.pop();var y=1<<t,x=H2(t,r,n),E=this.tiles[x];if(!E&&(h>1,E=this.tiles[x]=U6(e,t,r,n,c),this.tileCoords.push({z:t,x:r,y:n}),h)){h>1;var T="z"+t;this.stats[T]=(this.stats[T]||0)+1,this.total++}if(E.source=e,i){if(t===c.maxZoom||t===i)continue;var I=1<<i-t;if(r!==Math.floor(o/I)||n!==Math.floor(a/I))continue}else if(t===c.indexMaxZoom||E.numPoints<=c.indexMaxPoints)continue;if(E.source=null,e.length!==0){h>1;var k=.5*c.buffer/c.extent,D=.5-k,V=.5+k,O=1+k,F,N,H,q,Y,ee;F=N=H=q=null,Y=Ad(e,y,r-k,r+V,0,E.minX,E.maxX,c),ee=Ad(e,y,r+D,r+O,0,E.minX,E.maxX,c),e=null,Y&&(F=Ad(Y,y,n-k,n+V,1,E.minY,E.maxY,c),N=Ad(Y,y,n+D,n+O,1,E.minY,E.maxY,c),Y=null),ee&&(H=Ad(ee,y,n-k,n+V,1,E.minY,E.maxY,c),q=Ad(ee,y,n+D,n+O,1,E.minY,E.maxY,c),ee=null),h>1,u.push(F||[],t+1,r*2,n*2),u.push(N||[],t+1,r*2,n*2+1),u.push(H||[],t+1,r*2+1,n*2),u.push(q||[],t+1,r*2+1,n*2+1)}}};Lx.prototype.getTile=function(e,t,r){var n=this.options,i=n.extent,o=n.debug;if(e<0||e>24)return null;var a=1<<e;t=(t%a+a)%a;var u=H2(e,t,r);if(this.tiles[u])return pA(this.tiles[u],i);o>1;for(var c=e,h=t,y=r,x;!x&&c>0;)c--,h=Math.floor(h/2),y=Math.floor(y/2),x=this.tiles[H2(c,h,y)];return!x||!x.source?null:(o>1,o>1,this.splitTile(x.source,c,h,y,e,t,r),o>1,this.tiles[u]?pA(this.tiles[u],i):null)};function H2(e,t,r){return((1<<e)*r+t)*32+e}function G6(e,t){for(var r in t)e[r]=t[r];return e}function $t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function vA(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,J5(n.key),n)}}function Gt(e,t,r){return t&&vA(e.prototype,t),r&&vA(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}var H6=function(){function e(t,r,n,i){$t(this,e),Q(this,"vectorLayerCache",{}),this.x=r,this.y=n,this.z=i,this.vectorTile=t}return Gt(e,[{key:"getTileData",value:function(r){if(!r||!this.vectorTile.layers[r])return[];if(this.vectorLayerCache[r])return this.vectorLayerCache[r];var n=this.vectorTile.layers[r];return n.features}},{key:"getFeatureById",value:function(){throw new Error("Method not implemented.")}}]),e}(),W6={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0};function X6(e){for(var t=0,r=0,n=e.length,i=n-1,o,a;r<n;i=r++)o=e[r],a=e[i],t+=(a.x-o.x)*(o.y+a.y);return t}function Y6(e){var t=e.length;if(t<=1)return[e];for(var r=[],n,i,o=0;o<t;o++){var a=X6(e[o]);a!==0&&(i===void 0&&(i=a<0),i===a<0?(n&&r.push(n),n=[e[o]]):n.push(e[o]))}return n&&r.push(n),r}var q6=["Unknown","Point","LineString","Polygon"];function Z6(e,t,r,n,i){var o=i.geometry,a=i.type,u=i.tags,c=i.id,h=e*Math.pow(2,n),y=e*t,x=e*r,E=q6[a],T,I;function k(O){for(var F=0;F<O.length;F++){var N=O[F];if(N[3])break;var H=180-(N[1]+x)*360/h,q=(N[0]+y)*360/h-180,Y=360/Math.PI*Math.atan(Math.exp(H*Math.PI/180))-90;O[F]=[q,Y,0,1]}}switch(a){case 1:var D=[];for(T=0;T<o.length;T++)D[T]=o[T][0];o=D,k(o);break;case 2:for(T=0;T<o.length;T++)k(o[T]);break;case 3:for(o=Y6(o),T=0;T<o.length;T++)for(I=0;I<o[T].length;I++)k(o[T][I]);break}o.length===1?o=o[0]:E="Multi"+E;var V={type:"Feature",geometry:{type:E,coordinates:o},properties:u,id:c,tileOrigin:[0,0],coord:""};return V}var K6=function(){var e=Vt(Ce.mark(function t(r,n,i,o){return Ce.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",new Promise(function(c){var h=n.getTile(r.z,r.x,r.y),y=h?h.features.map(function(T){return Z6(o,i.x,i.y,i.z,T)}):[],x={layers:{defaultLayer:{features:y}}},E=new H6(x,r.x,r.y,r.z);c(E)}));case 1:case"end":return u.stop()}},t)}));return function(r,n,i,o){return e.apply(this,arguments)}}();function Q6(e){var t={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!0,debug:0};return e===void 0||typeof e.geojsonvtOptions>"u"?t:_t(_t({},t),e.geojsonvtOptions)}function J6(e,t){var r=Q6(t),n=r.extent||4096,i=$6(e,r),o=function(c,h){return K6(h,i,c,n)},a=_t(_t(_t({},W6),t),{},{getTileData:o});return{data:e,dataArray:[],tilesetOptions:a,isTile:!0}}function Dy(e,t){return Dy=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},Dy(e,t)}function yn(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Dy(e,t)}function Ye(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function xn(e,t){if(t&&(qh(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Ye(e)}function Ct(e){return Ct=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Ct(e)}function e8(e){return Function.toString.call(e).indexOf("[native code]")!==-1}function t8(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function T1(e,t,r){return t8()?T1=Reflect.construct.bind():T1=function(i,o,a){var u=[null];u.push.apply(u,o);var c=Function.bind.apply(i,u),h=new c;return a&&Dy(h,a.prototype),h},T1.apply(null,arguments)}function W2(e){var t=typeof Map=="function"?new Map:void 0;return W2=function(n){if(n===null||!e8(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(typeof t<"u"){if(t.has(n))return t.get(n);t.set(n,i)}function i(){return T1(n,arguments,Ct(this).constructor)}return i.prototype=Object.create(n.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),Dy(i,n)},W2(e)}var py="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function LE(e){this.message=e}LE.prototype=new Error;LE.prototype.name="InvalidCharacterError";function r8(e){var t=String(e).replace(/=+$/,"");if(t.length%4===1)throw new LE("'atob' failed: The string to be decoded is not correctly encoded.");for(var r="",n=0,i,o,a=0;o=t.charAt(a++);~o&&(i=n%4?i*64+o:o,n++%4)?r+=String.fromCharCode(255&i>>(-2*n&6)):0)o=py.indexOf(o);return r}function pI(e){e=String(e);for(var t,r,n,i,o="",a=0,u=e.length%3;a<e.length;){if((r=e.charCodeAt(a++))>255||(n=e.charCodeAt(a++))>255||(i=e.charCodeAt(a++))>255)throw new TypeError("Failed to execute 'btoa' on 'Window': The string to be encoded contains characters outside of the Latin1 range.");t=r<<16|n<<8|i,o+=py.charAt(t>>18&63)+py.charAt(t>>12&63)+py.charAt(t>>6&63)+py.charAt(t&63)}return u?o.slice(0,u-3)+"===".substring(u):o}var n8=function(){function e(t,r){$t(this,e),this.buffers=t,this.type=r}return Gt(e,[{key:"arraybuffer",value:function(){return Promise.resolve(this.buffers[0])}},{key:"stream",value:function(){throw new Error("not implemented")}},{key:"text",value:function(){throw new Error("not implemented")}},{key:"slice",value:function(r,n,i){throw new Error("not implemented")}}]),e}(),eh;typeof window>"u"?eh={devicePixelRatio:1,navigator:{userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36",browserLanguage:"zh-CN",language:"zh-CN",platform:""},location:"",document:{documentElement:{style:{}},createEvent:function(){return!0},getElementById:function(t){return!0},createElement:function(){return{className:"",classList:{add:function(){return""}}}},createElementNS:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},querySelector:function(){return!1}},performance:{mark:function(t){return null},clearMeasures:function(t){return null},clearMarks:function(t){return null},measure:function(t,r,n){return{duration:0}},now:function(){return new Date().getTime()}},Blob:"",dispatchEvent:function(t){return!0},Event:function(t,r){return!0},createElement:function(){return!0},createElementNS:function(){return!0},XMLHttpRequest:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},requestAnimationFrame:function(){return!0},cancelAnimationFrame:function(){return!0},clearTimeout:function(){return!0}}:eh=window;var i8=typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;const a8=i8?my.getSystemInfoSync().pixelRatio:eh.devicePixelRatio;var dI=Gt(function e(t,r){$t(this,e),this.cancelBubble=!1,this.cancelable=!1,this.target=null,this.currentTarget=null,this.preventDefault=function(){},this.stopPropagation=function(){},this.type=t,this.timeStamp=Date.now()});function o8(e,t){var r=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=s8(e))||t&&e&&typeof e.length=="number"){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(h){throw h},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,a=!1,u;return{s:function(){r=r.call(e)},n:function(){var h=r.next();return o=h.done,h},e:function(h){a=!0,u=h},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(a)throw u}}}}function s8(e,t){if(e){if(typeof e=="string")return mA(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return mA(e,t)}}function mA(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Gg=new WeakMap,kE=function(){function e(){$t(this,e),Gg.set(this,{})}return Gt(e,[{key:"addEventListener",value:function(r,n){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=Gg.get(this);o||(o={}),o[r]||(o[r]=[]),o[r].push(n),Gg.set(this,o),i.capture,i.once,i.passive}},{key:"removeEventListener",value:function(r,n){var i=Gg.get(this);if(i){var o=i[r];if(o&&o.length>0){for(var a=o.length;a--;a>0)if(o[a]===n){o.splice(a,1);break}}}}},{key:"dispatchEvent",value:function(r){var n=Gg.get(this)[r.type];if(n){var i=o8(n),o;try{for(i.s();!(o=i.n()).done;){var a=o.value;a(r)}}catch(u){i.e(u)}finally{i.f()}}}}]),e}();function u8(e){var t=l8();return function(){var n=Ct(e),i;if(t){var o=Ct(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xn(this,i)}}function l8(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var vI=function(e){yn(r,e);var t=u8(r);function r(){var n;return $t(this,r),n=t.call(this),n.childNodes=[],n}return Gt(r,[{key:"appendChild",value:function(i){this.childNodes.push(i)}},{key:"cloneNode",value:function(){var i=Object.create(this);return Object.assign(i,this),i}},{key:"removeChild",value:function(i){var o=this.childNodes.findIndex(function(a){return a===i});return o>-1?this.childNodes.splice(o,1):null}}]),r}(kE);function c8(e){var t=f8();return function(){var n=Ct(e),i;if(t){var o=Ct(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xn(this,i)}}function f8(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var mI=function(e){yn(r,e);var t=c8(r);function r(){var n;return $t(this,r),n=t.call(this),n.className="",n.children=[],n}return Gt(r,[{key:"setAttribute",value:function(i,o){this[i]=o}},{key:"getAttribute",value:function(i){return this[i]}},{key:"setAttributeNS",value:function(i,o){this[i]=o}},{key:"getAttributeNS",value:function(i){return this[i]}}]),r}(vI),h8=typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,X2,Y2,q2,Z2;if(h8){var Z_=my.getSystemInfoSync();X2=Z_.screenWidth,Y2=Z_.screenHeight,q2=Z_.windowWidth,Z2=Z_.windowHeight}else{var gA=eh.innerWidth,yA=eh.innerHeight;X2=gA,Y2=yA,q2=gA,Z2=yA}var wy={width:X2,height:Y2,availWidth:q2,availHeight:Z2,availLeft:0,availTop:0},kx=wy.availWidth,Ox=wy.availHeight,_A={style:[]};function gI(e,t){if(!("parentNode"in e)){var r;t===0?r=function(){return null}:t===1?r=function(){return _A}:r=function(){return null},Object.defineProperty(e,"parentNode",{enumerable:!0,get:r})}if(!("parentElement"in e)){var n;t===0?n=function(){return null}:t===1?n=function(){return _A}:n=function(){return null},Object.defineProperty(e,"parentElement",{enumerable:!0,get:n})}}function p8(e){e.style=e.style||{},Object.assign(e.style,{top:"0px",left:"0px",width:kx+"px",height:Ox+"px",margin:"0px",padding:"0px"})}function d8(e){"clientLeft"in e||(e.clientLeft=0,e.clientTop=0),"clientWidth"in e||(e.clientWidth=kx,e.clientHeight=Ox),"getBoundingClientRect"in e||(e.getBoundingClientRect=function(){var t={x:0,y:0,top:0,left:0,width:this.clientWidth,height:this.clientHeight,right:this.clientWidth,bottom:this.clientHeight};return t})}function v8(e){"offsetLeft"in e||(e.offsetLeft=0,e.offsetTop=0),"offsetWidth"in e||(e.offsetWidth=kx,e.offsetHeight=Ox)}function m8(e){"scrollLeft"in e||(e.scrollLeft=0,e.scrollTop=0),"scrollWidth"in e||(e.scrollWidth=kx,e.scrollHeight=Ox)}function yI(e){var t=function(){return!0};e.classList=[],e.classList.add=t,e.classList.remove=t,e.classList.contains=t,e.classList.toggle=t}function g8(e){var t=y8();return function(){var n=Ct(e),i;if(t){var o=Ct(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xn(this,i)}}function y8(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function d0(){}var Tg=function(e){yn(r,e);var t=g8(r);function r(){var n,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",o=arguments.length>1?arguments[1]:void 0;return $t(this,r),n=t.call(this),n.className="",n.children=[],n.focus=d0,n.blur=d0,n.insertBefore=d0,n.appendChild=d0,n.removeChild=d0,n.remove=d0,n.innerHTML="",n.tagName=i.toUpperCase(),gI(Ye(n),o),p8(Ye(n)),yI(Ye(n)),d8(Ye(n)),v8(Ye(n)),m8(Ye(n)),n}return Gt(r)}(mI);function _8(e){var t=x8();return function(){var n=Ct(e),i;if(t){var o=Ct(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xn(this,i)}}function x8(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var _I=function(e){yn(r,e);var t=_8(r);function r(n){return $t(this,r),t.call(this,n)}return Gt(r,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),r}(Tg);function b8(e){var t=w8();return function(){var n=Ct(e),i;if(t){var o=Ct(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xn(this,i)}}function w8(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var xI=function(e){yn(r,e);var t=b8(r);function r(){return $t(this,r),t.call(this,"video")}return Gt(r)}(_I),E8={};function OE(){return E8}var bI=Gt(function e(){$t(this,e);var t=OE(),r=t.createImage&&t.createImage()||{};return"tagName"in r||(r.tagName="IMG",r.__proto__=e.prototype),gI(r),yI(r),Object.assign(r,{addEventListener:function(i,o){r["on".concat(i)]=o.bind(r)},removeEventListener:function(i){r["on".concat(i)]=null}}),r}),wI={href:"",protocol:"",host:""};function EI(e){var t=S8();return function(){var n=Ct(e),i;if(t){var o=Ct(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xn(this,i)}}function S8(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var A8=function(e){yn(r,e);var t=EI(r);function r(){return $t(this,r),t.call(this,"body",0)}return Gt(r,[{key:"addEventListener",value:function(i,o){}},{key:"removeEventListener",value:function(i,o,a){}},{key:"dispatchEvent",value:function(i){}}]),r}(Tg),T8=function(e){yn(r,e);var t=EI(r);function r(){return $t(this,r),t.call(this,"html",0)}return Gt(r,[{key:"addEventListener",value:function(i,o){}},{key:"removeEventListener",value:function(i,o){}},{key:"dispatchEvent",value:function(i){}}]),r}(Tg),Hg={},Am={readyState:"complete",visibilityState:"visible",hidden:!1,fullscreen:!0,scripts:[],style:{},location:wI,ontouchstart:null,ontouchmove:null,ontouchend:null,onvisibilitychange:null,parentNode:null,parentElement:null,head:null,body:null,documentElement:{style:[]},createElement:function(t){return t=t.toLowerCase(),t==="canvas"?my.createOffscreenCanvas(1024,128,"2d"):t==="img"?new bI:t==="video"?new xI:new Tg(t)},createElementNS:function(t,r){return this.createElement(r)},createTextNode:function(t){return t},getElementById:function(t){return null},getElementsByTagName:function(t){return t=t.toLowerCase(),[]},getElementsByTagNameNS:function(t,r){return this.getElementsByTagName(r)},getElementsByName:function(t){return[]},querySelector:function(t){return null},querySelectorAll:function(t){return[]},addEventListener:function(t,r,n){Hg[t]||(Hg[t]=[]),Hg[t].push(r)},removeEventListener:function(t,r){var n=Hg[t];if(n&&n.length>0){for(var i=n.length;i--;i>0)if(n[i]===r){n.splice(i,1);break}}},dispatchEvent:function(t){var r=t.type,n=Hg[r];if(n)for(var i=0;i<n.length;i++)n[i](t);t.target&&typeof t.target["on"+r]=="function"&&t.target["on"+r](t)},createEvent:function(t){return new dI(t)}};Am.documentElement=new T8;Am.head=new Tg("head");Am.body=new A8;var C8=Object,M8=function(){function e(){$t(this,e);var t=arguments.length;if(t===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){this._w=arguments[0],this._h=arguments[1],this._data=new Uint8ClampedArray(this._w*this._h*4);return}}else t===3&&qh(arguments[0])==="object"&&typeof arguments[1]=="number"&&typeof arguments[2]=="number"&&(this._data=arguments[0],this._w=arguments[1],this._h=arguments[2]);throw new Error("ImageData: params error")}return Gt(e,[{key:"width",get:function(){return this._w}},{key:"height",get:function(){return this._h}},{key:"data",get:function(){return this._data}}]),e}(),P8=typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,K2,Dc,j1;if(P8){var Lb=my.getSystemInfoSync();K2=Lb.system,Dc=Lb.platform,j1=Lb.language}else{var cf={versions:function(){var e=eh.navigator.userAgent;return{trident:e.indexOf("Trident")>-1,presto:e.indexOf("Presto")>-1,webKit:e.indexOf("AppleWebKit")>-1,gecko:e.indexOf("Gecko")>-1&&e.indexOf("KHTML")===-1,mobile:!!e.match(/AppleWebKit.*Mobile.*/),ios:!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:e.indexOf("Android")>-1||e.indexOf("Linux")>-1,iPhone:e.indexOf("iPhone")>-1,iPad:e.indexOf("iPad")>-1,webApp:e.indexOf("Safari")===-1,weixin:e.indexOf("MicroMessenger")>-1,qq:e.match(/\sQQ/i)===" qq"}}(),language:(eh.navigator.browserLanguage||eh.navigator.language).toLowerCase()};cf.versions.android?Dc="android":cf.versions.trident?Dc="IE":cf.versions.presto?Dc="Opera":cf.versions.webKit?Dc="webKit":cf.versions.gecko?Dc="Firefox":cf.versions.mobile?Dc="mobile":cf.versions.ios?Dc="ios":cf.versions.iPhone?Dc="iPhone":cf.versions.iPad?Dc="ipad":cf.versions.webApp?Dc="webApp":cf.versions.weixin?Dc="weixin":cf.versions.qq&&(Dc="qq"),K2=eh.navigator.userAgent,j1=cf.language}var I8=K2.toLowerCase().indexOf("android")!==-1,SI=I8?"Android; CPU Android 6.0":"iPhone; CPU iPhone OS 10_3_1 like Mac OS X",R8="Mozilla/5.0 (".concat(SI,") AppleWebKit/603.1.30 (KHTML, like Gecko) Mobile/14E8301 MicroMessenger/6.6.0 MiniGame NetType/WIFI Language/").concat(j1),L8={platform:Dc,language:j1,appVersion:"5.0 (".concat(SI,") AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1"),userAgent:R8},k8={mark:function(t){return null},clearMeasures:function(t){return null},clearMarks:function(t){return null},measure:function(t,r,n){return{duration:0}},now:function(){}},xA=0,bA=0;function O8(e){var t=Date.now(),r=Math.max(xA+23,t);return bA=setTimeout(function(){e(xA=r)},r-t),bA}function D8(e){var t=OE();return t.requestAnimationFrame?t.requestAnimationFrame(e):O8(e)}function F8(e){var t=OE();return t.cancelAnimationFrame?t.cancelAnimationFrame(e):clearTimeout(e)}var N8=function(){function e(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if($t(this,e),t.indexOf("http://")==0||t.indexOf("https://")==0){this.href=t;return}this.href=r+t}return Gt(e,null,[{key:"createObjectURL",value:function(r){var n=r.buffers[0],i=r.type,o=B8(n),a="data:".concat(i,";base64, ");return a+o}}]),e}();function B8(e){for(var t="",r=new Uint8Array(e),n=r.byteLength,i=0;i<n;i++)t+=String.fromCharCode(r[i]);return pI(t)}var z8={GCCSO_SHADER_BINARY_FJ:37472,_3DC_XY_AMD:34810,_3DC_X_AMD:34809,ACTIVE_ATTRIBUTES:35721,ACTIVE_ATTRIBUTE_MAX_LENGTH:35722,ACTIVE_PROGRAM_EXT:33369,ACTIVE_TEXTURE:34016,ACTIVE_UNIFORMS:35718,ACTIVE_UNIFORM_MAX_LENGTH:35719,ALIASED_LINE_WIDTH_RANGE:33902,ALIASED_POINT_SIZE_RANGE:33901,ALL_COMPLETED_NV:34034,ALL_SHADER_BITS_EXT:4294967295,ALPHA:6406,ALPHA16F_EXT:34844,ALPHA32F_EXT:34838,ALPHA8_EXT:32828,ALPHA8_OES:32828,ALPHA_BITS:3413,ALPHA_TEST_FUNC_QCOM:3009,ALPHA_TEST_QCOM:3008,ALPHA_TEST_REF_QCOM:3010,ALREADY_SIGNALED_APPLE:37146,ALWAYS:519,AMD_compressed_3DC_texture:1,AMD_compressed_ATC_texture:1,AMD_performance_monitor:1,AMD_program_binary_Z400:1,ANGLE_depth_texture:1,ANGLE_framebuffer_blit:1,ANGLE_framebuffer_multisample:1,ANGLE_instanced_arrays:1,ANGLE_pack_reverse_row_order:1,ANGLE_program_binary:1,ANGLE_texture_compression_dxt3:1,ANGLE_texture_compression_dxt5:1,ANGLE_texture_usage:1,ANGLE_translated_shader_source:1,ANY_SAMPLES_PASSED_CONSERVATIVE_EXT:36202,ANY_SAMPLES_PASSED_EXT:35887,APPLE_copy_texture_levels:1,APPLE_framebuffer_multisample:1,APPLE_rgb_422:1,APPLE_sync:1,APPLE_texture_format_BGRA8888:1,APPLE_texture_max_level:1,ARM_mali_program_binary:1,ARM_mali_shader_binary:1,ARM_rgba8:1,ARRAY_BUFFER:34962,ARRAY_BUFFER_BINDING:34964,ATC_RGBA_EXPLICIT_ALPHA_AMD:35987,ATC_RGBA_INTERPOLATED_ALPHA_AMD:34798,ATC_RGB_AMD:35986,ATTACHED_SHADERS:35717,BACK:1029,BGRA8_EXT:37793,BGRA_EXT:32993,BGRA_IMG:32993,BINNING_CONTROL_HINT_QCOM:36784,BLEND:3042,BLEND_COLOR:32773,BLEND_DST_ALPHA:32970,BLEND_DST_RGB:32968,BLEND_EQUATION:32777,BLEND_EQUATION_ALPHA:34877,BLEND_EQUATION_RGB:32777,BLEND_SRC_ALPHA:32971,BLEND_SRC_RGB:32969,BLUE_BITS:3412,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,BUFFER:33504,BUFFER_ACCESS_OES:35003,BUFFER_MAPPED_OES:35004,BUFFER_MAP_POINTER_OES:35005,BUFFER_OBJECT_EXT:37201,BUFFER_SIZE:34660,BUFFER_USAGE:34661,BYTE:5120,CCW:2305,CLAMP_TO_BORDER_NV:33069,CLAMP_TO_EDGE:33071,COLOR_ATTACHMENT0:36064,COLOR_ATTACHMENT0_NV:36064,COLOR_ATTACHMENT10_NV:36074,COLOR_ATTACHMENT11_NV:36075,COLOR_ATTACHMENT12_NV:36076,COLOR_ATTACHMENT13_NV:36077,COLOR_ATTACHMENT14_NV:36078,COLOR_ATTACHMENT15_NV:36079,COLOR_ATTACHMENT1_NV:36065,COLOR_ATTACHMENT2_NV:36066,COLOR_ATTACHMENT3_NV:36067,COLOR_ATTACHMENT4_NV:36068,COLOR_ATTACHMENT5_NV:36069,COLOR_ATTACHMENT6_NV:36070,COLOR_ATTACHMENT7_NV:36071,COLOR_ATTACHMENT8_NV:36072,COLOR_ATTACHMENT9_NV:36073,COLOR_ATTACHMENT_EXT:37104,COLOR_BUFFER_BIT:16384,COLOR_BUFFER_BIT0_QCOM:1,COLOR_BUFFER_BIT1_QCOM:2,COLOR_BUFFER_BIT2_QCOM:4,COLOR_BUFFER_BIT3_QCOM:8,COLOR_BUFFER_BIT4_QCOM:16,COLOR_BUFFER_BIT5_QCOM:32,COLOR_BUFFER_BIT6_QCOM:64,COLOR_BUFFER_BIT7_QCOM:128,COLOR_CLEAR_VALUE:3106,COLOR_EXT:6144,COLOR_WRITEMASK:3107,COMPARE_REF_TO_TEXTURE_EXT:34894,COMPILE_STATUS:35713,COMPRESSED_RGBA_ASTC_10x10_KHR:37819,COMPRESSED_RGBA_ASTC_10x5_KHR:37816,COMPRESSED_RGBA_ASTC_10x6_KHR:37817,COMPRESSED_RGBA_ASTC_10x8_KHR:37818,COMPRESSED_RGBA_ASTC_12x10_KHR:37820,COMPRESSED_RGBA_ASTC_12x12_KHR:37821,COMPRESSED_RGBA_ASTC_4x4_KHR:37808,COMPRESSED_RGBA_ASTC_5x4_KHR:37809,COMPRESSED_RGBA_ASTC_5x5_KHR:37810,COMPRESSED_RGBA_ASTC_6x5_KHR:37811,COMPRESSED_RGBA_ASTC_6x6_KHR:37812,COMPRESSED_RGBA_ASTC_8x5_KHR:37813,COMPRESSED_RGBA_ASTC_8x6_KHR:37814,COMPRESSED_RGBA_ASTC_8x8_KHR:37815,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGBA_PVRTC_2BPPV2_IMG:37175,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_4BPPV2_IMG:37176,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_ANGLE:33778,COMPRESSED_RGBA_S3TC_DXT5_ANGLE:33779,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:37853,COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:37847,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_NV:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_NV:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_NV:35919,COMPRESSED_SRGB_S3TC_DXT1_NV:35916,COMPRESSED_TEXTURE_FORMATS:34467,CONDITION_SATISFIED_APPLE:37148,CONSTANT_ALPHA:32771,CONSTANT_COLOR:32769,CONTEXT_FLAG_DEBUG_BIT:2,CONTEXT_ROBUST_ACCESS_EXT:37107,COUNTER_RANGE_AMD:35777,COUNTER_TYPE_AMD:35776,COVERAGE_ALL_FRAGMENTS_NV:36565,COVERAGE_ATTACHMENT_NV:36562,COVERAGE_AUTOMATIC_NV:36567,COVERAGE_BUFFERS_NV:36563,COVERAGE_BUFFER_BIT_NV:32768,COVERAGE_COMPONENT4_NV:36561,COVERAGE_COMPONENT_NV:36560,COVERAGE_EDGE_FRAGMENTS_NV:36566,COVERAGE_SAMPLES_NV:36564,CPU_OPTIMIZED_QCOM:36785,CULL_FACE:2884,CULL_FACE_MODE:2885,CURRENT_PROGRAM:35725,CURRENT_QUERY_EXT:34917,CURRENT_VERTEX_ATTRIB:34342,CW:2304,DEBUG_CALLBACK_FUNCTION:33348,DEBUG_CALLBACK_USER_PARAM:33349,DEBUG_GROUP_STACK_DEPTH:33389,DEBUG_LOGGED_MESSAGES:37189,DEBUG_NEXT_LOGGED_MESSAGE_LENGTH:33347,DEBUG_OUTPUT:37600,DEBUG_OUTPUT_SYNCHRONOUS:33346,DEBUG_SEVERITY_HIGH:37190,DEBUG_SEVERITY_LOW:37192,DEBUG_SEVERITY_MEDIUM:37191,DEBUG_SEVERITY_NOTIFICATION:33387,DEBUG_SOURCE_API:33350,DEBUG_SOURCE_APPLICATION:33354,DEBUG_SOURCE_OTHER:33355,DEBUG_SOURCE_SHADER_COMPILER:33352,DEBUG_SOURCE_THIRD_PARTY:33353,DEBUG_SOURCE_WINDOW_SYSTEM:33351,DEBUG_TYPE_DEPRECATED_BEHAVIOR:33357,DEBUG_TYPE_ERROR:33356,DEBUG_TYPE_MARKER:33384,DEBUG_TYPE_OTHER:33361,DEBUG_TYPE_PERFORMANCE:33360,DEBUG_TYPE_POP_GROUP:33386,DEBUG_TYPE_PORTABILITY:33359,DEBUG_TYPE_PUSH_GROUP:33385,DEBUG_TYPE_UNDEFINED_BEHAVIOR:33358,DECR:7683,DECR_WRAP:34056,DELETE_STATUS:35712,DEPTH24_STENCIL8_OES:35056,DEPTH_ATTACHMENT:36096,DEPTH_STENCIL_ATTACHMENT:33306,DEPTH_BITS:3414,DEPTH_BUFFER_BIT:256,DEPTH_BUFFER_BIT0_QCOM:256,DEPTH_BUFFER_BIT1_QCOM:512,DEPTH_BUFFER_BIT2_QCOM:1024,DEPTH_BUFFER_BIT3_QCOM:2048,DEPTH_BUFFER_BIT4_QCOM:4096,DEPTH_BUFFER_BIT5_QCOM:8192,DEPTH_BUFFER_BIT6_QCOM:16384,DEPTH_BUFFER_BIT7_QCOM:32768,DEPTH_CLEAR_VALUE:2931,DEPTH_COMPONENT:6402,DEPTH_COMPONENT16:33189,DEPTH_COMPONENT16_NONLINEAR_NV:36396,DEPTH_COMPONENT16_OES:33189,DEPTH_COMPONENT24_OES:33190,DEPTH_COMPONENT32_OES:33191,DEPTH_EXT:6145,DEPTH_FUNC:2932,DEPTH_RANGE:2928,DEPTH_STENCIL:34041,DEPTH_STENCIL_OES:34041,DEPTH_TEST:2929,DEPTH_WRITEMASK:2930,DITHER:3024,DMP_shader_binary:1,DONT_CARE:4352,DRAW_BUFFER0_NV:34853,DRAW_BUFFER10_NV:34863,DRAW_BUFFER11_NV:34864,DRAW_BUFFER12_NV:34865,DRAW_BUFFER13_NV:34866,DRAW_BUFFER14_NV:34867,DRAW_BUFFER15_NV:34868,DRAW_BUFFER1_NV:34854,DRAW_BUFFER2_NV:34855,DRAW_BUFFER3_NV:34856,DRAW_BUFFER4_NV:34857,DRAW_BUFFER5_NV:34858,DRAW_BUFFER6_NV:34859,DRAW_BUFFER7_NV:34860,DRAW_BUFFER8_NV:34861,DRAW_BUFFER9_NV:34862,DRAW_BUFFER_EXT:3073,DRAW_FRAMEBUFFER_ANGLE:36009,DRAW_FRAMEBUFFER_APPLE:36009,DRAW_FRAMEBUFFER_BINDING_ANGLE:36006,DRAW_FRAMEBUFFER_BINDING_APPLE:36006,DRAW_FRAMEBUFFER_BINDING_NV:36006,DRAW_FRAMEBUFFER_NV:36009,DST_ALPHA:772,DST_COLOR:774,DYNAMIC_DRAW:35048,ELEMENT_ARRAY_BUFFER:34963,ELEMENT_ARRAY_BUFFER_BINDING:34965,EQUAL:514,ES_VERSION_2_0:1,ETC1_RGB8_OES:36196,ETC1_SRGB8_NV:35054,EXTENSIONS:7939,EXT_blend_minmax:1,EXT_color_buffer_half_float:1,EXT_debug_label:1,EXT_debug_marker:1,EXT_discard_framebuffer:1,EXT_map_buffer_range:1,EXT_multi_draw_arrays:1,EXT_multisampled_render_to_texture:1,EXT_multiview_draw_buffers:1,EXT_occlusion_query_boolean:1,EXT_read_format_bgra:1,EXT_robustness:1,EXT_sRGB:1,EXT_separate_shader_objects:1,EXT_shader_framebuffer_fetch:1,EXT_shader_texture_lod:1,EXT_shadow_samplers:1,EXT_texture_compression_dxt1:1,EXT_texture_filter_anisotropic:1,EXT_texture_format_BGRA8888:1,EXT_texture_rg:1,EXT_texture_storage:1,EXT_texture_type_2_10_10_10_REV:1,EXT_unpack_subimage:1,FALSE:0,FASTEST:4353,FENCE_CONDITION_NV:34036,FENCE_STATUS_NV:34035,FIXED:5132,FJ_shader_binary_GCCSO:1,FLOAT:5126,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,FRAGMENT_SHADER:35632,FRAGMENT_SHADER_BIT_EXT:2,FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723,FRAGMENT_SHADER_DISCARDS_SAMPLES_EXT:35410,FRAMEBUFFER:36160,FRAMEBUFFER_ATTACHMENT_ANGLE:37795,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_TEXTURE_3D_ZOFFSET_OES:36052,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_SAMPLES_EXT:36204,FRAMEBUFFER_BINDING:36006,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_ANGLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_APPLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_EXT:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_IMG:37172,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_NV:36182,FRAMEBUFFER_UNDEFINED_OES:33305,FRAMEBUFFER_UNSUPPORTED:36061,FRONT:1028,FRONT_AND_BACK:1032,FRONT_FACE:2886,FUNC_ADD:32774,FUNC_REVERSE_SUBTRACT:32779,FUNC_SUBTRACT:32778,GENERATE_MIPMAP_HINT:33170,GEQUAL:518,GPU_OPTIMIZED_QCOM:36786,GREATER:516,GREEN_BITS:3411,GUILTY_CONTEXT_RESET_EXT:33363,HALF_FLOAT_OES:36193,HIGH_FLOAT:36338,HIGH_INT:36341,IMG_multisampled_render_to_texture:1,IMG_program_binary:1,IMG_read_format:1,IMG_shader_binary:1,IMG_texture_compression_pvrtc:1,IMG_texture_compression_pvrtc2:1,IMPLEMENTATION_COLOR_READ_FORMAT:35739,IMPLEMENTATION_COLOR_READ_TYPE:35738,INCR:7682,INCR_WRAP:34055,INFO_LOG_LENGTH:35716,INNOCENT_CONTEXT_RESET_EXT:33364,INT:5124,INT_10_10_10_2_OES:36343,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,INVALID_ENUM:1280,INVALID_FRAMEBUFFER_OPERATION:1286,INVALID_OPERATION:1282,INVALID_VALUE:1281,INVERT:5386,KEEP:7680,KHR_debug:1,KHR_texture_compression_astc_ldr:1,LEFT:1030,LEQUAL:515,LESS:513,LINEAR:9729,LINEAR_MIPMAP_LINEAR:9987,LINEAR_MIPMAP_NEAREST:9985,LINES:1,LINE_LOOP:2,LINE_STRIP:3,LINE_WIDTH:2849,LINK_STATUS:35714,LOSE_CONTEXT_ON_RESET_EXT:33362,LOW_FLOAT:36336,LOW_INT:36339,LUMINANCE:6409,LUMINANCE16F_EXT:34846,LUMINANCE32F_EXT:34840,LUMINANCE4_ALPHA4_OES:32835,LUMINANCE8_ALPHA8_EXT:32837,LUMINANCE8_ALPHA8_OES:32837,LUMINANCE8_EXT:32832,LUMINANCE8_OES:32832,LUMINANCE_ALPHA:6410,LUMINANCE_ALPHA16F_EXT:34847,LUMINANCE_ALPHA32F_EXT:34841,MALI_PROGRAM_BINARY_ARM:36705,MALI_SHADER_BINARY_ARM:36704,MAP_FLUSH_EXPLICIT_BIT_EXT:16,MAP_INVALIDATE_BUFFER_BIT_EXT:8,MAP_INVALIDATE_RANGE_BIT_EXT:4,MAP_READ_BIT_EXT:1,MAP_UNSYNCHRONIZED_BIT_EXT:32,MAP_WRITE_BIT_EXT:2,MAX_3D_TEXTURE_SIZE_OES:32883,MAX_COLOR_ATTACHMENTS_NV:36063,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_CUBE_MAP_TEXTURE_SIZE:34076,MAX_DEBUG_GROUP_STACK_DEPTH:33388,MAX_DEBUG_LOGGED_MESSAGES:37188,MAX_DEBUG_MESSAGE_LENGTH:37187,MAX_DRAW_BUFFERS_NV:34852,MAX_EXT:32776,MAX_FRAGMENT_UNIFORM_VECTORS:36349,MAX_LABEL_LENGTH:33512,MAX_MULTIVIEW_BUFFERS_EXT:37106,MAX_RENDERBUFFER_SIZE:34024,MAX_SAMPLES_ANGLE:36183,MAX_SAMPLES_APPLE:36183,MAX_SAMPLES_EXT:36183,MAX_SAMPLES_IMG:37173,MAX_SAMPLES_NV:36183,MAX_SERVER_WAIT_TIMEOUT_APPLE:37137,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,MAX_TEXTURE_SIZE:3379,MAX_VARYING_VECTORS:36348,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VIEWPORT_DIMS:3386,MEDIUM_FLOAT:36337,MEDIUM_INT:36340,MIN_EXT:32775,MIRRORED_REPEAT:33648,MULTISAMPLE_BUFFER_BIT0_QCOM:16777216,MULTISAMPLE_BUFFER_BIT1_QCOM:33554432,MULTISAMPLE_BUFFER_BIT2_QCOM:67108864,MULTISAMPLE_BUFFER_BIT3_QCOM:134217728,MULTISAMPLE_BUFFER_BIT4_QCOM:268435456,MULTISAMPLE_BUFFER_BIT5_QCOM:536870912,MULTISAMPLE_BUFFER_BIT6_QCOM:1073741824,MULTISAMPLE_BUFFER_BIT7_QCOM:2147483648,MULTIVIEW_EXT:37105,NEAREST:9728,NEAREST_MIPMAP_LINEAR:9986,NEAREST_MIPMAP_NEAREST:9984,NEVER:512,NICEST:4354,NONE:0,NOTEQUAL:517,NO_ERROR:0,NO_RESET_NOTIFICATION_EXT:33377,NUM_COMPRESSED_TEXTURE_FORMATS:34466,NUM_PROGRAM_BINARY_FORMATS_OES:34814,NUM_SHADER_BINARY_FORMATS:36345,NV_coverage_sample:1,NV_depth_nonlinear:1,NV_draw_buffers:1,NV_draw_instanced:1,NV_fbo_color_attachments:1,NV_fence:1,NV_framebuffer_blit:1,NV_framebuffer_multisample:1,NV_generate_mipmap_sRGB:1,NV_instanced_arrays:1,NV_read_buffer:1,NV_read_buffer_front:1,NV_read_depth:1,NV_read_depth_stencil:1,NV_read_stencil:1,NV_sRGB_formats:1,NV_shadow_samplers_array:1,NV_shadow_samplers_cube:1,NV_texture_border_clamp:1,NV_texture_compression_s3tc_update:1,NV_texture_npot_2D_mipmap:1,OBJECT_TYPE_APPLE:37138,OES_EGL_image:1,OES_EGL_image_external:1,OES_compressed_ETC1_RGB8_texture:1,OES_compressed_paletted_texture:1,OES_depth24:1,OES_depth32:1,OES_depth_texture:1,OES_element_index_uint:1,OES_fbo_render_mipmap:1,OES_fragment_precision_high:1,OES_get_program_binary:1,OES_mapbuffer:1,OES_packed_depth_stencil:1,OES_required_internalformat:1,OES_rgb8_rgba8:1,OES_standard_derivatives:1,OES_stencil1:1,OES_stencil4:1,OES_surfaceless_context:1,OES_texture_3D:1,OES_texture_float:1,OES_texture_float_linear:1,OES_texture_half_float:1,OES_texture_half_float_linear:1,OES_texture_npot:1,OES_vertex_array_object:1,OES_vertex_half_float:1,OES_vertex_type_10_10_10_2:1,ONE:1,ONE_MINUS_CONSTANT_ALPHA:32772,ONE_MINUS_CONSTANT_COLOR:32770,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,OUT_OF_MEMORY:1285,PACK_ALIGNMENT:3333,PACK_REVERSE_ROW_ORDER_ANGLE:37796,PALETTE4_R5_G6_B5_OES:35730,PALETTE4_RGB5_A1_OES:35732,PALETTE4_RGB8_OES:35728,PALETTE4_RGBA4_OES:35731,PALETTE4_RGBA8_OES:35729,PALETTE8_R5_G6_B5_OES:35735,PALETTE8_RGB5_A1_OES:35737,PALETTE8_RGB8_OES:35733,PALETTE8_RGBA4_OES:35736,PALETTE8_RGBA8_OES:35734,PERCENTAGE_AMD:35779,PERFMON_GLOBAL_MODE_QCOM:36768,PERFMON_RESULT_AMD:35782,PERFMON_RESULT_AVAILABLE_AMD:35780,PERFMON_RESULT_SIZE_AMD:35781,POINTS:0,POLYGON_OFFSET_FACTOR:32824,POLYGON_OFFSET_FILL:32823,POLYGON_OFFSET_UNITS:10752,PROGRAM:33506,PROGRAM_BINARY_ANGLE:37798,PROGRAM_BINARY_FORMATS_OES:34815,PROGRAM_BINARY_LENGTH_OES:34625,PROGRAM_OBJECT_EXT:35648,PROGRAM_PIPELINE_BINDING_EXT:33370,PROGRAM_PIPELINE_OBJECT_EXT:35407,PROGRAM_SEPARABLE_EXT:33368,QCOM_alpha_test:1,QCOM_binning_control:1,QCOM_driver_control:1,QCOM_extended_get:1,QCOM_extended_get2:1,QCOM_perfmon_global_mode:1,QCOM_tiled_rendering:1,QCOM_writeonly_rendering:1,QUERY:33507,QUERY_OBJECT_EXT:37203,QUERY_RESULT_AVAILABLE_EXT:34919,QUERY_RESULT_EXT:34918,R16F_EXT:33325,R32F_EXT:33326,R8_EXT:33321,READ_BUFFER_EXT:3074,READ_BUFFER_NV:3074,READ_FRAMEBUFFER_ANGLE:36008,READ_FRAMEBUFFER_APPLE:36008,READ_FRAMEBUFFER_BINDING_ANGLE:36010,READ_FRAMEBUFFER_BINDING_APPLE:36010,READ_FRAMEBUFFER_BINDING_NV:36010,READ_FRAMEBUFFER_NV:36008,RED_BITS:3410,RED_EXT:6403,RENDERBUFFER:36161,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_BINDING:36007,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_SAMPLES_ANGLE:36011,RENDERBUFFER_SAMPLES_APPLE:36011,RENDERBUFFER_SAMPLES_EXT:36011,RENDERBUFFER_SAMPLES_IMG:37171,RENDERBUFFER_SAMPLES_NV:36011,RENDERBUFFER_STENCIL_SIZE:36181,RENDERBUFFER_WIDTH:36162,RENDERER:7937,RENDER_DIRECT_TO_FRAMEBUFFER_QCOM:36787,REPEAT:10497,REPLACE:7681,REQUIRED_TEXTURE_IMAGE_UNITS_OES:36200,RESET_NOTIFICATION_STRATEGY_EXT:33366,RG16F_EXT:33327,RG32F_EXT:33328,RG8_EXT:33323,RGB:6407,RGB10_A2_EXT:32857,RGB10_EXT:32850,RGB16F_EXT:34843,RGB32F_EXT:34837,RGB565:36194,RGB565_OES:36194,RGB5_A1:32855,RGB5_A1_OES:32855,RGB8_OES:32849,RGBA:6408,RGBA16F_EXT:34842,RGBA32F_EXT:34836,RGBA4:32854,RGBA4_OES:32854,RGBA8_OES:32856,RGB_422_APPLE:35359,RG_EXT:33319,RIGHT:1031,SAMPLER:33510,SAMPLER_2D:35678,SAMPLER_2D_ARRAY_SHADOW_NV:36292,SAMPLER_2D_SHADOW_EXT:35682,SAMPLER_3D_OES:35679,SAMPLER_CUBE:35680,SAMPLER_CUBE_SHADOW_NV:36293,SAMPLER_EXTERNAL_OES:36198,SAMPLES:32937,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_BUFFERS:32936,SAMPLE_COVERAGE:32928,SAMPLE_COVERAGE_INVERT:32939,SAMPLE_COVERAGE_VALUE:32938,SCISSOR_BOX:3088,SCISSOR_TEST:3089,SGX_BINARY_IMG:35850,SGX_PROGRAM_BINARY_IMG:37168,SHADER:33505,SHADER_BINARY_DMP:37456,SHADER_BINARY_FORMATS:36344,SHADER_BINARY_VIV:36804,SHADER_COMPILER:36346,SHADER_OBJECT_EXT:35656,SHADER_SOURCE_LENGTH:35720,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,SHORT:5122,SIGNALED_APPLE:37145,SLUMINANCE8_ALPHA8_NV:35909,SLUMINANCE8_NV:35911,SLUMINANCE_ALPHA_NV:35908,SLUMINANCE_NV:35910,SRC_ALPHA:770,SRC_ALPHA_SATURATE:776,SRC_COLOR:768,SRGB8_ALPHA8_EXT:35907,SRGB8_NV:35905,SRGB_ALPHA_EXT:35906,SRGB_EXT:35904,STACK_OVERFLOW:1283,STACK_UNDERFLOW:1284,STATE_RESTORE:35804,STATIC_DRAW:35044,STENCIL_ATTACHMENT:36128,STENCIL_BACK_FAIL:34817,STENCIL_BACK_FUNC:34816,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,STENCIL_BITS:3415,STENCIL_BUFFER_BIT:1024,STENCIL_BUFFER_BIT0_QCOM:65536,STENCIL_BUFFER_BIT1_QCOM:131072,STENCIL_BUFFER_BIT2_QCOM:262144,STENCIL_BUFFER_BIT3_QCOM:524288,STENCIL_BUFFER_BIT4_QCOM:1048576,STENCIL_BUFFER_BIT5_QCOM:2097152,STENCIL_BUFFER_BIT6_QCOM:4194304,STENCIL_BUFFER_BIT7_QCOM:8388608,STENCIL_CLEAR_VALUE:2961,STENCIL_EXT:6146,STENCIL_FAIL:2964,STENCIL_FUNC:2962,STENCIL_INDEX1_OES:36166,STENCIL_INDEX4_OES:36167,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_TEST:2960,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STREAM_DRAW:35040,SUBPIXEL_BITS:3408,SYNC_CONDITION_APPLE:37139,SYNC_FENCE_APPLE:37142,SYNC_FLAGS_APPLE:37141,SYNC_FLUSH_COMMANDS_BIT_APPLE:1,SYNC_GPU_COMMANDS_COMPLETE_APPLE:37143,SYNC_OBJECT_APPLE:35411,SYNC_STATUS_APPLE:37140,TEXTURE:5890,TEXTURE0:33984,TEXTURE1:33985,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE2:33986,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE3:33987,TEXTURE30:34014,TEXTURE31:34015,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE_2D:3553,TEXTURE_3D_OES:32879,TEXTURE_BINDING_2D:32873,TEXTURE_BINDING_3D_OES:32874,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_BINDING_EXTERNAL_OES:36199,TEXTURE_BORDER_COLOR_NV:4100,TEXTURE_COMPARE_FUNC_EXT:34893,TEXTURE_COMPARE_MODE_EXT:34892,TEXTURE_CUBE_MAP:34067,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_DEPTH_QCOM:35796,TEXTURE_EXTERNAL_OES:36197,TEXTURE_FORMAT_QCOM:35798,TEXTURE_HEIGHT_QCOM:35795,TEXTURE_IMAGE_VALID_QCOM:35800,TEXTURE_IMMUTABLE_FORMAT_EXT:37167,TEXTURE_INTERNAL_FORMAT_QCOM:35797,TEXTURE_MAG_FILTER:10240,TEXTURE_MAX_ANISOTROPY_EXT:34046,TEXTURE_MAX_LEVEL_APPLE:33085,TEXTURE_MIN_FILTER:10241,TEXTURE_NUM_LEVELS_QCOM:35801,TEXTURE_OBJECT_VALID_QCOM:35803,TEXTURE_SAMPLES_IMG:37174,TEXTURE_TARGET_QCOM:35802,TEXTURE_TYPE_QCOM:35799,TEXTURE_USAGE_ANGLE:37794,TEXTURE_WIDTH_QCOM:35794,TEXTURE_WRAP_R_OES:32882,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TIMEOUT_EXPIRED_APPLE:37147,TIMEOUT_IGNORED_APPLE:18446744073709552e3,TRANSLATED_SHADER_SOURCE_LENGTH_ANGLE:37792,TRIANGLES:4,TRIANGLE_FAN:6,TRIANGLE_STRIP:5,TRUE:1,UNKNOWN_CONTEXT_RESET_EXT:33365,UNPACK_ALIGNMENT:3317,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_PIXELS:3316,UNPACK_SKIP_ROWS:3315,UNSIGNALED_APPLE:37144,UNSIGNED_BYTE:5121,UNSIGNED_INT:5125,UNSIGNED_INT64_AMD:35778,UNSIGNED_INT_10_10_10_2_OES:36342,UNSIGNED_INT_24_8_OES:34042,UNSIGNED_INT_2_10_10_10_REV_EXT:33640,UNSIGNED_NORMALIZED_EXT:35863,UNSIGNED_SHORT:5123,UNSIGNED_SHORT_1_5_5_5_REV_EXT:33638,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_4_4_4_4_REV_EXT:33637,UNSIGNED_SHORT_4_4_4_4_REV_IMG:33637,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,UNSIGNED_SHORT_8_8_APPLE:34234,UNSIGNED_SHORT_8_8_REV_APPLE:34235,VALIDATE_STATUS:35715,VENDOR:7936,VERSION:7938,VERTEX_ARRAY_BINDING_OES:34229,VERTEX_ARRAY_OBJECT_EXT:37204,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,VERTEX_ATTRIB_ARRAY_DIVISOR_NV:35070,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_SHADER:35633,VERTEX_SHADER_BIT_EXT:1,VIEWPORT:2978,VIV_shader_binary:1,WAIT_FAILED_APPLE:37149,WRITEONLY_RENDERING_QCOM:34851,WRITE_ONLY_OES:35001,Z400_BINARY_AMD:34624,ZERO:0,RASTERIZER_DISCARD:35977,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444},U8={};function V8(e){var t=j8();return function(){var n=Ct(e),i;if(t){var o=Ct(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xn(this,i)}}function j8(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var kb=new Map,wA=new Map,$8=new Map,Vm=function(e){yn(r,e);var t=V8(r);function r(){var n;return $t(this,r),n=t.call(this),n.onabort=null,n.onerror=null,n.onload=null,n.onloadstart=null,n.onprogress=null,n.ontimeout=null,n.onloadend=null,n.onreadystatechange=null,n.readyState=0,n.response=null,n.responseText=null,n._responseType="text",n.responseXML=null,n.status=0,n.statusText="",n.upload={},n.withCredentials=!1,kb.set("requestHeader",{"content-type":"application/x-www-form-urlencoded"}),n}return Gt(r,[{key:"responseType",set:function(i){this._responseType=i}},{key:"abort",value:function(){var i=$8.get("requestTask");i&&i.abort()}},{key:"getAllResponseHeaders",value:function(){var i=wA.get("responseHeader");return Object.keys(i).map(function(o){return"".concat(o,": ").concat(i[o])}).join(`
`)}},{key:"getResponseHeader",value:function(i){return wA.get("responseHeader")[i]}},{key:"open",value:function(i,o,a){this._method=i,this._url=o}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){}},{key:"setRequestHeader",value:function(i,o){var a=kb.get("requestHeader");a[i]=o,kb.set("requestHeader",a)}},{key:"addEventListener",value:function(i,o){var a=this;typeof o=="function"&&(this["on"+i]=function(){var u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};u.target=u.target||a,o.call(a,u)})}},{key:"removeEventListener",value:function(i,o){this["on"+i]===o&&(this["on"+i]=null)}}]),r}(kE);Vm.UNSEND=0;Vm.OPENED=1;Vm.HEADERS_RECEIVED=2;Vm.LOADING=3;Vm.DONE=4;var AI=!1;function G8(e){AI=e}var H8=typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,W8=typeof wx<"u"&&wx!==null&&(typeof wx.request<"u"||typeof wx.miniProgram<"u"),gf=(H8||W8)&&AI,X8={atob:r8,btoa:pI,devicePixelRatio:a8,Blob:n8,document:Am,Element:mI,Event:dI,EventTarget:kE,HTMLCanvasElement:C8,HTMLElement:Tg,HTMLMediaElement:_I,HTMLVideoElement:xI,Image:bI,ImageData:M8,navigator:L8,Node:vI,requestAnimationFrame:D8,cancelAnimationFrame:F8,screen:wy,XMLHttpRequest:Vm,performance:k8,URL:N8,WebGLRenderingContext:z8,WebGL2RenderingContext:U8,addEventListener:function(t,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Am.addEventListener(t,r,n)},removeEventListener:function(t,r,n){Am.removeEventListener(t,r)},dispatchEvent:function(t){Am.dispatchEvent(t)},innerWidth:wy.availWidth,innerHeight:wy.availHeight,setTimeout,clearTimeout,setInterval,clearInterval},ja=gf?X8:eh,Y8=gf?Vm:eh.XMLHttpRequest;gf||eh.location;function q8(e){var t=Z8();return function(){var n=Ct(e),i;if(t){var o=Ct(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xn(this,i)}}function Z8(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var K8=function(e){yn(r,e);var t=q8(r);function r(n,i,o,a){var u;return $t(this,r),u=t.call(this,"AJAXError: ".concat(i," (").concat(n,"): ").concat(o)),u.status=n,u.statusText=i,u.url=o,u.body=a,u}return Gt(r)}(W2(Error));function TI(e,t){var r=new Y8,n=Array.isArray(e.url)?e.url[0]:e.url;r.open(e.method||"GET",n,!0),e.type==="arrayBuffer"&&(r.responseType="arraybuffer");for(var i in e.headers)e.headers.hasOwnProperty(i)&&r.setRequestHeader(i,e.headers[i]);return e.type==="json"&&(r.responseType="text",r.setRequestHeader("Accept","application/json")),r.withCredentials=e.credentials==="include",r.onerror=function(){t(new Error(r.statusText))},r.onload=function(){if((r.status>=200&&r.status<300||r.status===0)&&r.response!==null){var o=r.response;if(e.type==="json")try{o=JSON.parse(r.response)}catch(u){return t(u)}t(null,o,r.getResponseHeader("Cache-Control"),r.getResponseHeader("Expires"),r)}else{var a=new Blob([r.response],{type:r.getResponseHeader("Content-Type")});t(new K8(r.status,r.statusText,n.toString(),a))}},r.send(e.body),r}function Q8(e){return new Promise(function(t,r){TI(e,function(n,i,o,a,u){n?r({err:n,data:null,xhr:u}):t({err:null,data:i,cacheControl:o,expires:a,xhr:u})})})}function CI(e,t){return TI(e,t)}var J8=function(t,r){return CI(_t(_t({},t),{},{type:"json"}),r)},DE=function(t,r){return CI(_t(_t({},t),{},{type:"arrayBuffer"}),r)},EA="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function MI(e,t){var r=new ja.Image,n=ja.URL||ja.webkitURL;r.crossOrigin="anonymous",r.onload=function(){t(null,r),n.revokeObjectURL(r.src),r.onload=null,window.requestAnimationFrame(function(){r.src=EA})},r.onerror=function(){return t(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var i=new Blob([new Uint8Array(e)],{type:"image/png"});r.src=e.byteLength?n.createObjectURL(i):EA}function PI(e,t){var r=new Blob([new Uint8Array(e)],{type:"image/png"});createImageBitmap(r).then(function(n){t(null,n)}).catch(function(n){t(new Error("Could not load image because of ".concat(n.message,". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")))})}var Q2=function(t,r,n){var i=function(a,u){if(a)r(a);else if(u){var c=typeof createImageBitmap=="function",h=n?n(u):u;c?PI(h,r):MI(h,r)}};return t.type==="json"?J8(t,i):DE(t,i)},eF=function(t,r){var n=typeof createImageBitmap=="function";n?PI(t,r):MI(t,r)},tF=function(e){return e.CENTER="center",e.TOP="top",e["TOP-LEFT"]="top-left",e["TOP-RIGHT"]="top-right",e.BOTTOM="bottom",e["BOTTOM-LEFT"]="bottom-left",e["BOTTOM-RIGHT"]="bottom-right",e.LEFT="left",e.RIGHT="right",e}({}),J2={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function rF(e,t,r){var n=e.classList;for(var i in J2)J2.hasOwnProperty(i)&&n.remove("l7-".concat(r,"-anchor-").concat(i));n.add("l7-".concat(r,"-anchor-").concat(t))}function FE(e,t,r){e.prototype=t.prototype=r,r.constructor=e}function II(e,t){var r=Object.create(e.prototype);for(var n in t)r[n]=t[n];return r}function m_(){}var Fy=.7,$1=1/Fy,z0="\\s*([+-]?\\d+)\\s*",Ny="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",Bp="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",nF=/^#([0-9a-f]{3,8})$/,iF=new RegExp("^rgb\\("+[z0,z0,z0]+"\\)$"),aF=new RegExp("^rgb\\("+[Bp,Bp,Bp]+"\\)$"),oF=new RegExp("^rgba\\("+[z0,z0,z0,Ny]+"\\)$"),sF=new RegExp("^rgba\\("+[Bp,Bp,Bp,Ny]+"\\)$"),uF=new RegExp("^hsl\\("+[Ny,Bp,Bp]+"\\)$"),lF=new RegExp("^hsla\\("+[Ny,Bp,Bp,Ny]+"\\)$"),SA={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};FE(m_,H0,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:AA,formatHex:AA,formatHsl:cF,formatRgb:TA,toString:TA});function AA(){return this.rgb().formatHex()}function cF(){return RI(this).formatHsl()}function TA(){return this.rgb().formatRgb()}function H0(e){var t,r;return e=(e+"").trim().toLowerCase(),(t=nF.exec(e))?(r=t[1].length,t=parseInt(t[1],16),r===6?CA(t):r===3?new yf(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):r===8?K_(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):r===4?K_(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=iF.exec(e))?new yf(t[1],t[2],t[3],1):(t=aF.exec(e))?new yf(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=oF.exec(e))?K_(t[1],t[2],t[3],t[4]):(t=sF.exec(e))?K_(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=uF.exec(e))?IA(t[1],t[2]/100,t[3]/100,1):(t=lF.exec(e))?IA(t[1],t[2]/100,t[3]/100,t[4]):SA.hasOwnProperty(e)?CA(SA[e]):e==="transparent"?new yf(NaN,NaN,NaN,0):null}function CA(e){return new yf(e>>16&255,e>>8&255,e&255,1)}function K_(e,t,r,n){return n<=0&&(e=t=r=NaN),new yf(e,t,r,n)}function fF(e){return e instanceof m_||(e=H0(e)),e?(e=e.rgb(),new yf(e.r,e.g,e.b,e.opacity)):new yf}function G1(e,t,r,n){return arguments.length===1?fF(e):new yf(e,t,r,n??1)}function yf(e,t,r,n){this.r=+e,this.g=+t,this.b=+r,this.opacity=+n}FE(yf,G1,II(m_,{brighter:function(e){return e=e==null?$1:Math.pow($1,e),new yf(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=e==null?Fy:Math.pow(Fy,e),new yf(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:MA,formatHex:MA,formatRgb:PA,toString:PA}));function MA(){return"#"+Ob(this.r)+Ob(this.g)+Ob(this.b)}function PA(){var e=this.opacity;return e=isNaN(e)?1:Math.max(0,Math.min(1,e)),(e===1?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(e===1?")":", "+e+")")}function Ob(e){return e=Math.max(0,Math.min(255,Math.round(e)||0)),(e<16?"0":"")+e.toString(16)}function IA(e,t,r,n){return n<=0?e=t=r=NaN:r<=0||r>=1?e=t=NaN:t<=0&&(e=NaN),new Op(e,t,r,n)}function RI(e){if(e instanceof Op)return new Op(e.h,e.s,e.l,e.opacity);if(e instanceof m_||(e=H0(e)),!e)return new Op;if(e instanceof Op)return e;e=e.rgb();var t=e.r/255,r=e.g/255,n=e.b/255,i=Math.min(t,r,n),o=Math.max(t,r,n),a=NaN,u=o-i,c=(o+i)/2;return u?(t===o?a=(r-n)/u+(r<n)*6:r===o?a=(n-t)/u+2:a=(t-r)/u+4,u/=c<.5?o+i:2-o-i,a*=60):u=c>0&&c<1?0:a,new Op(a,u,c,e.opacity)}function hF(e,t,r,n){return arguments.length===1?RI(e):new Op(e,t,r,n??1)}function Op(e,t,r,n){this.h=+e,this.s=+t,this.l=+r,this.opacity=+n}FE(Op,hF,II(m_,{brighter:function(e){return e=e==null?$1:Math.pow($1,e),new Op(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=e==null?Fy:Math.pow(Fy,e),new Op(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,r=this.l,n=r+(r<.5?r:1-r)*t,i=2*r-n;return new yf(Db(e>=240?e-240:e+120,i,n),Db(e,i,n),Db(e<120?e+240:e-120,i,n),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return e=isNaN(e)?1:Math.max(0,Math.min(1,e)),(e===1?"hsl(":"hsla(")+(this.h||0)+", "+(this.s||0)*100+"%, "+(this.l||0)*100+"%"+(e===1?")":", "+e+")")}}));function Db(e,t,r){return(e<60?t+(r-t)*e/60:e<180?r:e<240?t+(r-t)*(240-e)/60:t)*255}function Da(e){var t=H0(e),r=[0,0,0,0];return t!=null&&(r[0]=t.r/255,r[1]=t.g/255,r[2]=t.b/255,r[3]=t.opacity),r}function Pm(e){var t=e&&e[0],r=e&&e[1],n=e&&e[2],i=t+r*256+n*65536-1;return i}function Dd(e){return[e+1&255,e+1>>8&255,e+1>>8>>8&255]}function LI(e){var t=ja.document.createElement("canvas"),r=t.getContext("2d");t.width=256,t.height=1;for(var n=null,i=r.createLinearGradient(0,0,256,1),o=e.positions[0],a=e.positions[e.positions.length-1],u=0;u<e.colors.length;++u){var c=(e.positions[u]-o)/(a-o);i.addColorStop(c,e.colors[u])}if(r.fillStyle=i,r.fillRect(0,0,256,1),gf)return n=new Uint8ClampedArray(r.getImageData(0,0,256,1).data),t=null,r=null,{data:n,width:256,height:1};n=r.getImageData(0,0,256,1).data;for(var h=r.createImageData(256,1),y=0;y<h.data.length;y+=4)h.data[y+0]=n[y+0],h.data[y+1]=n[y+1],h.data[y+2]=n[y+2],h.data[y+3]=n[y+3];return t=null,r=null,h}function pF(e,t){var r=ja.document.createElement("canvas"),n=r.getContext("2d");r.width=256,r.height=1;for(var i=n.createLinearGradient(0,0,256,1),o=t[1]-t[0],a=0;a<e.colors.length;++a){var u=Math.max((e.positions[a]-t[0])/o,0);i.addColorStop(u,e.colors[a])}n.fillStyle=i,n.fillRect(0,0,256,1);var c=n.getImageData(0,0,256,1).data,h=NE(n,c);return r=null,n=null,h}function dF(e){var t=ja.document.createElement("canvas"),r=t.getContext("2d");t.width=256,t.height=1;var n=r.createImageData(256,1);return n.data.fill(0),e.positions.forEach(function(i,o){var a=Da(e.colors[o]);n.data[i*4+0]=a[0]*255,n.data[i*4+1]=a[1]*255,n.data[i*4+2]=a[2]*255,n.data[i*4+3]=a[3]*255}),t=null,r=null,n}function vF(e){var t=ja.document.createElement("canvas"),r=t.getContext("2d");r.globalAlpha=1,t.width=256,t.height=1;for(var n=256/e.colors.length,i=0;i<e.colors.length;i++)r.beginPath(),r.lineWidth=2,r.strokeStyle=e.colors[i],r.moveTo(i*n,0),r.lineTo((i+1)*n,0),r.stroke();var o=r.getImageData(0,0,256,1).data,a=NE(r,o);return t=null,r=null,a}function mF(e,t){var r=ja.document.createElement("canvas"),n=r.getContext("2d");n.globalAlpha=1,r.width=256,r.height=1;var i=t[1]-t[0];e.positions.length-e.colors.length;for(var o=0;o<e.colors.length;o++)n.beginPath(),n.lineWidth=2,n.strokeStyle=e.colors[o],n.moveTo((e.positions[o]-t[0])/i*255,0),n.lineTo((e.positions[o+1]-t[0])/i*255,0),n.stroke();var a=n.getImageData(0,0,256,1).data,u=NE(n,a);return r=null,n=null,u}function NE(e,t){for(var r=e.createImageData(256,1),n=0;n<r.data.length;n+=4)r.data[n+0]=t[n+0],r.data[n+1]=t[n+1],r.data[n+2]=t[n+2],r.data[n+3]=t[n+3];return r}function BE(e){switch(e.type){case"cat":return[0,255];default:return[0,1]}}var dm={BACK:1029,FRONT:1028};function zE(e){switch(e){case"GAODE1.x":return dm.BACK;case"GAODE2.x":return dm.BACK;case"MAPBOX":return dm.FRONT;case"SIMPLE":return dm.FRONT;case"GLOBEL":return dm.BACK;case"DEBAULT":return dm.FRONT;default:return dm.FRONT}}function gF(e){if(Array.isArray(e))return e}function yF(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,i,o,a,u=[],c=!0,h=!1;try{if(o=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(u.push(n.value),u.length!==t);c=!0);}catch(y){h=!0,i=y}finally{try{if(!c&&r.return!=null&&(a=r.return(),Object(a)!==a))return}finally{if(h)throw i}}return u}}function _F(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ei(e,t){return gF(e)||yF(e,t)||Q5(e,t)||_F()}var H1={exports:{}};/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */H1.exports;(function(e,t){(function(){var r,n="4.17.21",i=200,o="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",a="Expected a function",u="Invalid `variable` option passed into `_.template`",c="__lodash_hash_undefined__",h=500,y="__lodash_placeholder__",x=1,E=2,T=4,I=1,k=2,D=1,V=2,O=4,F=8,N=16,H=32,q=64,Y=128,ee=256,pe=512,ue=30,ie="...",xe=800,Se=16,Ne=1,ze=2,Be=3,$e=1/0,it=9007199254740991,mt=17976931348623157e292,Qe=0/0,rt=4294967295,gt=rt-1,er=rt>>>1,zt=[["ary",Y],["bind",D],["bindKey",V],["curry",F],["curryRight",N],["flip",pe],["partial",H],["partialRight",q],["rearg",ee]],qt="[object Arguments]",Zr="[object Array]",Wr="[object AsyncFunction]",On="[object Boolean]",Ut="[object Date]",Ar="[object DOMException]",an="[object Error]",Ft="[object Function]",Mr="[object GeneratorFunction]",mn="[object Map]",Nn="[object Number]",Xn="[object Null]",qn="[object Object]",Li="[object Promise]",ci="[object Proxy]",Ai="[object RegExp]",Vi="[object Set]",za="[object String]",ia="[object Symbol]",X="[object Undefined]",Ht="[object WeakMap]",or="[object WeakSet]",Yr="[object ArrayBuffer]",wn="[object DataView]",Qi="[object Float32Array]",Zn="[object Float64Array]",Hn="[object Int8Array]",Dn="[object Int16Array]",di="[object Int32Array]",wt="[object Uint8Array]",rn="[object Uint8ClampedArray]",En="[object Uint16Array]",Ii="[object Uint32Array]",ki=/\b__p \+= '';/g,uo=/\b(__p \+=) '' \+/g,go=/(__e\(.*?\)|\b__t\)) \+\n'';/g,yo=/&(?:amp|lt|gt|quot|#39);/g,Fs=/[&<>"']/g,Ss=RegExp(yo.source),Su=RegExp(Fs.source),ha=/<%-([\s\S]+?)%>/g,Z=/<%([\s\S]+?)%>/g,re=/<%=([\s\S]+?)%>/g,oe=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,ge=/^\w*$/,Le=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Ke=/[\\^$.*+?()[\]{}|]/g,nt=RegExp(Ke.source),de=/^\s+/,Fe=/\s/,ht=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,nr=/\{\n\/\* \[wrapped with (.+)\] \*/,cr=/,? & /,kt=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,ir=/[()=,{}\[\]\/\s]/,Sr=/\\(\\)?/g,nn=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Dt=/\w*$/,Kr=/^[-+]0x[0-9a-f]+$/i,Ir=/^0b[01]+$/i,Dr=/^\[object .+?Constructor\]$/,ii=/^0o[0-7]+$/i,Fr=/^(?:0|[1-9]\d*)$/,fi=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Oi=/($^)/,oi=/['\n\r\u2028\u2029\\]/g,Si="\\ud800-\\udfff",Ti="\\u0300-\\u036f",Jo="\\ufe20-\\ufe2f",Ni="\\u20d0-\\u20ff",Hi=Ti+Jo+Ni,Di="\\u2700-\\u27bf",ti="a-z\\xdf-\\xf6\\xf8-\\xff",vi="\\xac\\xb1\\xd7\\xf7",Mo="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",As="\\u2000-\\u206f",Ma=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Go="A-Z\\xc0-\\xd6\\xd8-\\xde",$c="\\ufe0e\\ufe0f",Wu=vi+Mo+As+Ma,Wi="['’]",_l="["+Si+"]",Po="["+Wu+"]",Pa="["+Hi+"]",es="\\d+",ga="["+Di+"]",hs="["+ti+"]",Fa="[^"+Si+Wu+es+Di+ti+Go+"]",ic="\\ud83c[\\udffb-\\udfff]",Ts="(?:"+Pa+"|"+ic+")",ac="[^"+Si+"]",Ws="(?:\\ud83c[\\udde6-\\uddff]){2}",_o="[\\ud800-\\udbff][\\udc00-\\udfff]",ps="["+Go+"]",se="\\u200d",be="(?:"+hs+"|"+Fa+")",Xe="(?:"+ps+"|"+Fa+")",Lt="(?:"+Wi+"(?:d|ll|m|re|s|t|ve))?",xr="(?:"+Wi+"(?:D|LL|M|RE|S|T|VE))?",Sn=Ts+"?",Ci="["+$c+"]?",Io="(?:"+se+"(?:"+[ac,Ws,_o].join("|")+")"+Ci+Sn+")*",Oo="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",ts="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Do=Ci+Sn+Io,Wp="(?:"+[ga,Ws,_o].join("|")+")"+Do,sh="(?:"+[ac+Pa+"?",Pa,Ws,_o,_l].join("|")+")",Vd=RegExp(Wi,"g"),Qh=RegExp(Pa,"g"),Xs=RegExp(ic+"(?="+ic+")|"+sh+Do,"g"),oc=RegExp([ps+"?"+hs+"+"+Lt+"(?="+[Po,ps,"$"].join("|")+")",Xe+"+"+xr+"(?="+[Po,ps+be,"$"].join("|")+")",ps+"?"+be+"+"+Lt,ps+"+"+xr,ts,Oo,es,Wp].join("|"),"g"),sc=RegExp("["+se+Si+Hi+$c+"]"),Gc=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Ys=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],uc=-1,Na={};Na[Qi]=Na[Zn]=Na[Hn]=Na[Dn]=Na[di]=Na[wt]=Na[rn]=Na[En]=Na[Ii]=!0,Na[qt]=Na[Zr]=Na[Yr]=Na[On]=Na[wn]=Na[Ut]=Na[an]=Na[Ft]=Na[mn]=Na[Nn]=Na[qn]=Na[Ai]=Na[Vi]=Na[za]=Na[Ht]=!1;var Mi={};Mi[qt]=Mi[Zr]=Mi[Yr]=Mi[wn]=Mi[On]=Mi[Ut]=Mi[Qi]=Mi[Zn]=Mi[Hn]=Mi[Dn]=Mi[di]=Mi[mn]=Mi[Nn]=Mi[qn]=Mi[Ai]=Mi[Vi]=Mi[za]=Mi[ia]=Mi[wt]=Mi[rn]=Mi[En]=Mi[Ii]=!0,Mi[an]=Mi[Ft]=Mi[Ht]=!1;var ao={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},Hc={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Xp={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},Uv={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Yp=parseFloat,uh=parseInt,Xu=typeof mf=="object"&&mf&&mf.Object===Object&&mf,xf=typeof self=="object"&&self&&self.Object===Object&&self,Fo=Xu||xf||Function("return this")(),lh=t&&!t.nodeType&&t,lc=lh&&!0&&e&&!e.nodeType&&e,jd=lc&&lc.exports===lh,Wc=jd&&Xu.process,Cs=function(){try{var ft=lc&&lc.require&&lc.require("util").types;return ft||Wc&&Wc.binding&&Wc.binding("util")}catch{}}(),qp=Cs&&Cs.isArrayBuffer,Ho=Cs&&Cs.isDate,Jh=Cs&&Cs.isMap,Ms=Cs&&Cs.isRegExp,zl=Cs&&Cs.isSet,cc=Cs&&Cs.isTypedArray;function lo(ft,Jt,Nt){switch(Nt.length){case 0:return ft.call(Jt);case 1:return ft.call(Jt,Nt[0]);case 2:return ft.call(Jt,Nt[0],Nt[1]);case 3:return ft.call(Jt,Nt[0],Nt[1],Nt[2])}return ft.apply(Jt,Nt)}function fc(ft,Jt,Nt,jr){for(var si=-1,ji=ft==null?0:ft.length;++si<ji;){var Ua=ft[si];Jt(jr,Ua,Nt(Ua),ft)}return jr}function co(ft,Jt){for(var Nt=-1,jr=ft==null?0:ft.length;++Nt<jr&&Jt(ft[Nt],Nt,ft)!==!1;);return ft}function hc(ft,Jt){for(var Nt=ft==null?0:ft.length;Nt--&&Jt(ft[Nt],Nt,ft)!==!1;);return ft}function qs(ft,Jt){for(var Nt=-1,jr=ft==null?0:ft.length;++Nt<jr;)if(!Jt(ft[Nt],Nt,ft))return!1;return!0}function xl(ft,Jt){for(var Nt=-1,jr=ft==null?0:ft.length,si=0,ji=[];++Nt<jr;){var Ua=ft[Nt];Jt(Ua,Nt,ft)&&(ji[si++]=Ua)}return ji}function Yu(ft,Jt){var Nt=ft==null?0:ft.length;return!!Nt&&Ps(ft,Jt,0)>-1}function Ji(ft,Jt,Nt){for(var jr=-1,si=ft==null?0:ft.length;++jr<si;)if(Nt(Jt,ft[jr]))return!0;return!1}function oo(ft,Jt){for(var Nt=-1,jr=ft==null?0:ft.length,si=Array(jr);++Nt<jr;)si[Nt]=Jt(ft[Nt],Nt,ft);return si}function qu(ft,Jt){for(var Nt=-1,jr=Jt.length,si=ft.length;++Nt<jr;)ft[si+Nt]=Jt[Nt];return ft}function ep(ft,Jt,Nt,jr){var si=-1,ji=ft==null?0:ft.length;for(jr&&ji&&(Nt=ft[++si]);++si<ji;)Nt=Jt(Nt,ft[si],si,ft);return Nt}function Zp(ft,Jt,Nt,jr){var si=ft==null?0:ft.length;for(jr&&si&&(Nt=ft[--si]);si--;)Nt=Jt(Nt,ft[si],si,ft);return Nt}function tp(ft,Jt){for(var Nt=-1,jr=ft==null?0:ft.length;++Nt<jr;)if(Jt(ft[Nt],Nt,ft))return!0;return!1}var $d=Ku("length");function pc(ft){return ft.split("")}function wa(ft){return ft.match(kt)||[]}function Ul(ft,Jt,Nt){var jr;return Nt(ft,function(si,ji,Ua){if(Jt(si,ji,Ua))return jr=ji,!1}),jr}function ch(ft,Jt,Nt,jr){for(var si=ft.length,ji=Nt+(jr?1:-1);jr?ji--:++ji<si;)if(Jt(ft[ji],ji,ft))return ji;return-1}function Ps(ft,Jt,Nt){return Jt===Jt?ip(ft,Jt,Nt):ch(ft,Zu,Nt)}function fh(ft,Jt,Nt,jr){for(var si=Nt-1,ji=ft.length;++si<ji;)if(jr(ft[si],Jt))return si;return-1}function Zu(ft){return ft!==ft}function Vl(ft,Jt){var Nt=ft==null?0:ft.length;return Nt?pa(ft,Jt)/Nt:Qe}function Ku(ft){return function(Jt){return Jt==null?r:Jt[ft]}}function Au(ft){return function(Jt){return ft==null?r:ft[Jt]}}function Xc(ft,Jt,Nt,jr,si){return si(ft,function(ji,Ua,Tn){Nt=jr?(jr=!1,ji):Jt(Nt,ji,Ua,Tn)}),Nt}function dc(ft,Jt){var Nt=ft.length;for(ft.sort(Jt);Nt--;)ft[Nt]=ft[Nt].value;return ft}function pa(ft,Jt){for(var Nt,jr=-1,si=ft.length;++jr<si;){var ji=Jt(ft[jr]);ji!==r&&(Nt=Nt===r?ji:Nt+ji)}return Nt}function vc(ft,Jt){for(var Nt=-1,jr=Array(ft);++Nt<ft;)jr[Nt]=Jt(Nt);return jr}function Gd(ft,Jt){return oo(Jt,function(Nt){return[Nt,ft[Nt]]})}function Yc(ft){return ft&&ft.slice(0,Ef(ft)+1).replace(de,"")}function Zs(ft){return function(Jt){return ft(Jt)}}function Kp(ft,Jt){return oo(Jt,function(Nt){return ft[Nt]})}function bf(ft,Jt){return ft.has(Jt)}function qc(ft,Jt){for(var Nt=-1,jr=ft.length;++Nt<jr&&Ps(Jt,ft[Nt],0)>-1;);return Nt}function bl(ft,Jt){for(var Nt=ft.length;Nt--&&Ps(Jt,ft[Nt],0)>-1;);return Nt}function Zc(ft,Jt){for(var Nt=ft.length,jr=0;Nt--;)ft[Nt]===Jt&&++jr;return jr}var wf=Au(ao),wl=Au(Hc);function mc(ft){return"\\"+Uv[ft]}function rp(ft,Jt){return ft==null?r:ft[Jt]}function cu(ft){return sc.test(ft)}function fu(ft){return Gc.test(ft)}function Qp(ft){for(var Jt,Nt=[];!(Jt=ft.next()).done;)Nt.push(Jt.value);return Nt}function hh(ft){var Jt=-1,Nt=Array(ft.size);return ft.forEach(function(jr,si){Nt[++Jt]=[si,jr]}),Nt}function np(ft,Jt){return function(Nt){return ft(Jt(Nt))}}function Ns(ft,Jt){for(var Nt=-1,jr=ft.length,si=0,ji=[];++Nt<jr;){var Ua=ft[Nt];(Ua===Jt||Ua===y)&&(ft[Nt]=y,ji[si++]=Nt)}return ji}function jl(ft){var Jt=-1,Nt=Array(ft.size);return ft.forEach(function(jr){Nt[++Jt]=jr}),Nt}function ph(ft){var Jt=-1,Nt=Array(ft.size);return ft.forEach(function(jr){Nt[++Jt]=[jr,jr]}),Nt}function ip(ft,Jt,Nt){for(var jr=Nt-1,si=ft.length;++jr<si;)if(ft[jr]===Jt)return jr;return-1}function dh(ft,Jt,Nt){for(var jr=Nt+1;jr--;)if(ft[jr]===Jt)return jr;return jr}function Qu(ft){return cu(ft)?Hd(ft):$d(ft)}function Is(ft){return cu(ft)?ap(ft):pc(ft)}function Ef(ft){for(var Jt=ft.length;Jt--&&Fe.test(ft.charAt(Jt)););return Jt}var Sf=Au(Xp);function Hd(ft){for(var Jt=Xs.lastIndex=0;Xs.test(ft);)++Jt;return Jt}function ap(ft){return ft.match(Xs)||[]}function Jp(ft){return ft.match(oc)||[]}var vh=function ft(Jt){Jt=Jt==null?Fo:gc.defaults(Fo.Object(),Jt,gc.pick(Fo,Ys));var Nt=Jt.Array,jr=Jt.Date,si=Jt.Error,ji=Jt.Function,Ua=Jt.Math,Tn=Jt.Object,ya=Jt.RegExp,Rs=Jt.String,Ls=Jt.TypeError,$l=Nt.prototype,mh=ji.prototype,Af=Tn.prototype,op=Jt["__core-js_shared__"],yc=mh.toString,ua=Af.hasOwnProperty,El=0,$a=function(){var m=/[^.]+$/.exec(op&&op.keys&&op.keys.IE_PROTO||"");return m?"Symbol(src)_1."+m:""}(),_c=Af.toString,gh=yc.call(Tn),la=Fo._,Jr=ya("^"+yc.call(ua).replace(Ke,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),rs=jd?Jt.Buffer:r,Tu=Jt.Symbol,Sl=Jt.Uint8Array,hu=rs?rs.allocUnsafe:r,ns=np(Tn.getPrototypeOf,Tn),yh=Tn.create,Nr=Af.propertyIsEnumerable,Ju=$l.splice,xo=Tu?Tu.isConcatSpreadable:r,xc=Tu?Tu.iterator:r,Wo=Tu?Tu.toStringTag:r,fo=function(){try{var m=nu(Tn,"defineProperty");return m({},"",{}),m}catch{}}(),_h=Jt.clearTimeout!==Fo.clearTimeout&&Jt.clearTimeout,xh=jr&&jr.now!==Fo.Date.now&&jr.now,Ks=Jt.setTimeout!==Fo.setTimeout&&Jt.setTimeout,Cu=Ua.ceil,bh=Ua.floor,Kc=Tn.getOwnPropertySymbols,wh=rs?rs.isBuffer:r,Eh=Jt.isFinite,pu=$l.join,Qs=np(Tn.keys,Tn),Bn=Ua.max,Ga=Ua.min,du=jr.now,is=Jt.parseInt,el=Ua.random,bc=$l.reverse,No=nu(Jt,"DataView"),ho=nu(Jt,"Map"),wc=nu(Jt,"Promise"),_n=nu(Jt,"Set"),on=nu(Jt,"WeakMap"),Gl=nu(Tn,"create"),Bo=on&&new on,ds={},Xo=_a(No),tl=_a(ho),sp=_a(wc),Js=_a(_n),ea=_a(on),bo=Tu?Tu.prototype:r,eu=bo?bo.valueOf:r,Al=bo?bo.toString:r;function me(m){if(mo(m)&&!ni(m)&&!(m instanceof mi)){if(m instanceof os)return m;if(ua.call(m,"__wrapped__"))return gi(m)}return new os(m)}var vs=function(){function m(){}return function(b){if(!vo(b))return{};if(yh)return yh(b);m.prototype=b;var P=new m;return m.prototype=r,P}}();function as(){}function os(m,b){this.__wrapped__=m,this.__actions__=[],this.__chain__=!!b,this.__index__=0,this.__values__=r}me.templateSettings={escape:ha,evaluate:Z,interpolate:re,variable:"",imports:{_:me}},me.prototype=as.prototype,me.prototype.constructor=me,os.prototype=vs(as.prototype),os.prototype.constructor=os;function mi(m){this.__wrapped__=m,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=rt,this.__views__=[]}function Sh(){var m=new mi(this.__wrapped__);return m.__actions__=ru(this.__actions__),m.__dir__=this.__dir__,m.__filtered__=this.__filtered__,m.__iteratees__=ru(this.__iteratees__),m.__takeCount__=this.__takeCount__,m.__views__=ru(this.__views__),m}function Qc(){if(this.__filtered__){var m=new mi(this);m.__dir__=-1,m.__filtered__=!0}else m=this.clone(),m.__dir__*=-1;return m}function Ah(){var m=this.__wrapped__.value(),b=this.__dir__,P=ni(m),U=b<0,te=P?m.length:0,we=bt(0,te,this.__views__),qe=we.start,ot=we.end,yt=ot-qe,mr=U?ot:qe-1,yr=this.__iteratees__,Rr=yr.length,Mn=0,Kn=Ga(yt,this.__takeCount__);if(!P||!U&&te==yt&&Kn==yt)return Hv(m,this.__actions__);var bi=[];e:for(;yt--&&Mn<Kn;){mr+=b;for(var sa=-1,wi=m[mr];++sa<Rr;){var ba=yr[sa],ka=ba.iteratee,uf=ba.type,Jl=ka(wi);if(uf==ze)wi=Jl;else if(!Jl){if(uf==Ne)continue e;break e}}bi[Mn++]=wi}return bi}mi.prototype=vs(as.prototype),mi.prototype.constructor=mi;function Hl(m){var b=-1,P=m==null?0:m.length;for(this.clear();++b<P;){var U=m[b];this.set(U[0],U[1])}}function Tf(){this.__data__=Gl?Gl(null):{},this.size=0}function Jc(m){var b=this.has(m)&&delete this.__data__[m];return this.size-=b?1:0,b}function ed(m){var b=this.__data__;if(Gl){var P=b[m];return P===c?r:P}return ua.call(b,m)?b[m]:r}function Ec(m){var b=this.__data__;return Gl?b[m]!==r:ua.call(b,m)}function Sc(m,b){var P=this.__data__;return this.size+=this.has(m)?0:1,P[m]=Gl&&b===r?c:b,this}Hl.prototype.clear=Tf,Hl.prototype.delete=Jc,Hl.prototype.get=ed,Hl.prototype.has=Ec,Hl.prototype.set=Sc;function vu(m){var b=-1,P=m==null?0:m.length;for(this.clear();++b<P;){var U=m[b];this.set(U[0],U[1])}}function Wl(){this.__data__=[],this.size=0}function Mu(m){var b=this.__data__,P=Pt(b,m);if(P<0)return!1;var U=b.length-1;return P==U?b.pop():Ju.call(b,P,1),--this.size,!0}function td(m){var b=this.__data__,P=Pt(b,m);return P<0?r:b[P][1]}function ef(m){return Pt(this.__data__,m)>-1}function Cf(m,b){var P=this.__data__,U=Pt(P,m);return U<0?(++this.size,P.push([m,b])):P[U][1]=b,this}vu.prototype.clear=Wl,vu.prototype.delete=Mu,vu.prototype.get=td,vu.prototype.has=ef,vu.prototype.set=Cf;function Pu(m){var b=-1,P=m==null?0:m.length;for(this.clear();++b<P;){var U=m[b];this.set(U[0],U[1])}}function p(){this.size=0,this.__data__={hash:new Hl,map:new(ho||vu),string:new Hl}}function v(m){var b=va(this,m).delete(m);return this.size-=b?1:0,b}function d(m){return va(this,m).get(m)}function _(m){return va(this,m).has(m)}function A(m,b){var P=va(this,m),U=P.size;return P.set(m,b),this.size+=P.size==U?0:1,this}Pu.prototype.clear=p,Pu.prototype.delete=v,Pu.prototype.get=d,Pu.prototype.has=_,Pu.prototype.set=A;function M(m){var b=-1,P=m==null?0:m.length;for(this.__data__=new Pu;++b<P;)this.add(m[b])}function R(m){return this.__data__.set(m,c),this}function B(m){return this.__data__.has(m)}M.prototype.add=M.prototype.push=R,M.prototype.has=B;function G(m){var b=this.__data__=new vu(m);this.size=b.size}function J(){this.__data__=new vu,this.size=0}function ce(m){var b=this.__data__,P=b.delete(m);return this.size=b.size,P}function ve(m){return this.__data__.get(m)}function ye(m){return this.__data__.has(m)}function Oe(m,b){var P=this.__data__;if(P instanceof vu){var U=P.__data__;if(!ho||U.length<i-1)return U.push([m,b]),this.size=++P.size,this;P=this.__data__=new Pu(U)}return P.set(m,b),this.size=P.size,this}G.prototype.clear=J,G.prototype.delete=ce,G.prototype.get=ve,G.prototype.has=ye,G.prototype.set=Oe;function Re(m,b){var P=ni(m),U=!P&&Nu(m),te=!P&&!U&&Ql(m),we=!P&&!U&&!te&&Ff(m),qe=P||U||te||we,ot=qe?vc(m.length,Rs):[],yt=ot.length;for(var mr in m)(b||ua.call(m,mr))&&!(qe&&(mr=="length"||te&&(mr=="offset"||mr=="parent")||we&&(mr=="buffer"||mr=="byteLength"||mr=="byteOffset")||rr(mr,yt)))&&ot.push(mr);return ot}function Ge(m){var b=m.length;return b?m[Pf(0,b-1)]:r}function Me(m,b){return Pn(ru(m),Ur(b,0,m.length))}function He(m){return Pn(ru(m))}function et(m,b,P){(P!==r&&!Aa(m[b],P)||P===r&&!(b in m))&&sr(m,b,P)}function ct(m,b,P){var U=m[b];(!(ua.call(m,b)&&Aa(U,P))||P===r&&!(b in m))&&sr(m,b,P)}function Pt(m,b){for(var P=m.length;P--;)if(Aa(m[P][0],b))return P;return-1}function At(m,b,P,U){return Ln(m,function(te,we,qe){b(U,te,P(te),qe)}),U}function Ot(m,b){return m&&ku(b,Vs(b),m)}function tr(m,b){return m&&ku(b,Os(b),m)}function sr(m,b,P){b=="__proto__"&&fo?fo(m,b,{configurable:!0,enumerable:!0,value:P,writable:!0}):m[b]=P}function _r(m,b){for(var P=-1,U=b.length,te=Nt(U),we=m==null;++P<U;)te[P]=we?r:c0(m,b[P]);return te}function Ur(m,b,P){return m===m&&(P!==r&&(m=m<=P?m:P),b!==r&&(m=m>=b?m:b)),m}function hn(m,b,P,U,te,we){var qe,ot=b&x,yt=b&E,mr=b&T;if(P&&(qe=te?P(m,U,te,we):P(m)),qe!==r)return qe;if(!vo(m))return m;var yr=ni(m);if(yr){if(qe=Bt(m),!ot)return ru(m,qe)}else{var Rr=De(m),Mn=Rr==Ft||Rr==Mr;if(Ql(m))return sd(m,ot);if(Rr==qn||Rr==qt||Mn&&!te){if(qe=yt||Mn?{}:Kt(m),!ot)return yt?Rh(m,tr(qe,m)):Lf(m,Ot(qe,m))}else{if(!Mi[Rr])return te?m:{};qe=ur(m,Rr,ot)}}we||(we=new G);var Kn=we.get(m);if(Kn)return Kn;we.set(m,qe),vd(m)?m.forEach(function(wi){qe.add(hn(wi,b,P,wi,m,we))}):Nh(m)&&m.forEach(function(wi,ba){qe.set(ba,hn(wi,b,P,ba,m,we))});var bi=mr?yt?em:Jv:yt?Os:Vs,sa=yr?r:bi(m);return co(sa||m,function(wi,ba){sa&&(ba=wi,wi=m[ba]),ct(qe,ba,hn(wi,b,P,ba,m,we))}),qe}function An(m){var b=Vs(m);return function(P){return bn(P,m,b)}}function bn(m,b,P){var U=P.length;if(m==null)return!U;for(m=Tn(m);U--;){var te=P[U],we=b[te],qe=m[te];if(qe===r&&!(te in m)||!we(qe))return!1}return!0}function Fi(m,b,P){if(typeof m!="function")throw new Ls(a);return Gn(function(){m.apply(r,P)},b)}function $r(m,b,P,U){var te=-1,we=Yu,qe=!0,ot=m.length,yt=[],mr=b.length;if(!ot)return yt;P&&(b=oo(b,Zs(P))),U?(we=Ji,qe=!1):b.length>=i&&(we=bf,qe=!1,b=new M(b));e:for(;++te<ot;){var yr=m[te],Rr=P==null?yr:P(yr);if(yr=U||yr!==0?yr:0,qe&&Rr===Rr){for(var Mn=mr;Mn--;)if(b[Mn]===Rr)continue e;yt.push(yr)}else we(b,Rr,U)||yt.push(yr)}return yt}var Ln=Wv(Va),Yn=Wv(wo,!0);function $n(m,b){var P=!0;return Ln(m,function(U,te,we){return P=!!b(U,te,we),P}),P}function Fn(m,b,P){for(var U=-1,te=m.length;++U<te;){var we=m[U],qe=b(we);if(qe!=null&&(ot===r?qe===qe&&!ou(qe):P(qe,ot)))var ot=qe,yt=we}return yt}function ri(m,b,P,U){var te=m.length;for(P=zi(P),P<0&&(P=-P>te?0:te+P),U=U===r||U>te?te:zi(U),U<0&&(U+=te),U=P>U?0:k_(U);P<U;)m[P++]=b;return m}function zn(m,b){var P=[];return Ln(m,function(U,te,we){b(U,te,we)&&P.push(U)}),P}function pn(m,b,P,U,te){var we=-1,qe=m.length;for(P||(P=pr),te||(te=[]);++we<qe;){var ot=m[we];b>0&&P(ot)?b>1?pn(ot,b-1,P,U,te):qu(te,ot):U||(te[te.length]=ot)}return te}var Ja=Xv(),Ha=Xv(!0);function Va(m,b){return m&&Ja(m,b,Vs)}function wo(m,b){return m&&Ha(m,b,Vs)}function Ia(m,b){return xl(b,function(P){return Rc(m[P])})}function Ea(m,b){b=Il(b,m);for(var P=0,U=b.length;m!=null&&P<U;)m=m[Jn(b[P++])];return P&&P==U?m:r}function ms(m,b,P){var U=b(m);return ni(m)?U:qu(U,P(m))}function da(m){return m==null?m===r?X:Xn:Wo&&Wo in Tn(m)?wp(m):jt(m)}function rl(m,b){return m>b}function ks(m,b){return m!=null&&ua.call(m,b)}function Iu(m,b){return m!=null&&b in Tn(m)}function mu(m,b,P){return m>=Ga(b,P)&&m<Bn(b,P)}function Xl(m,b,P){for(var U=P?Ji:Yu,te=m[0].length,we=m.length,qe=we,ot=Nt(we),yt=1/0,mr=[];qe--;){var yr=m[qe];qe&&b&&(yr=oo(yr,Zs(b))),yt=Ga(yr.length,yt),ot[qe]=!P&&(b||te>=120&&yr.length>=120)?new M(qe&&yr):r}yr=m[0];var Rr=-1,Mn=ot[0];e:for(;++Rr<te&&mr.length<yt;){var Kn=yr[Rr],bi=b?b(Kn):Kn;if(Kn=P||Kn!==0?Kn:0,!(Mn?bf(Mn,bi):U(mr,bi,P))){for(qe=we;--qe;){var sa=ot[qe];if(!(sa?bf(sa,bi):U(m[qe],bi,P)))continue e}Mn&&Mn.push(bi),mr.push(Kn)}}return mr}function tf(m,b,P,U){return Va(m,function(te,we,qe){b(U,P(te),we,qe)}),U}function gu(m,b,P){b=Il(b,m),m=Pr(m,b);var U=m==null?m:m[Jn(Ue(b))];return U==null?r:lo(U,m,P)}function Yl(m){return mo(m)&&da(m)==qt}function rf(m){return mo(m)&&da(m)==Yr}function nl(m){return mo(m)&&da(m)==Ut}function il(m,b,P,U,te){return m===b?!0:m==null||b==null||!mo(m)&&!mo(b)?m!==m&&b!==b:al(m,b,P,U,il,te)}function al(m,b,P,U,te,we){var qe=ni(m),ot=ni(b),yt=qe?Zr:De(m),mr=ot?Zr:De(b);yt=yt==qt?qn:yt,mr=mr==qt?qn:mr;var yr=yt==qn,Rr=mr==qn,Mn=yt==mr;if(Mn&&Ql(m)){if(!Ql(b))return!1;qe=!0,yr=!1}if(Mn&&!yr)return we||(we=new G),qe||Ff(m)?Zm(m,b,P,U,te,we):Km(m,b,yt,P,U,te,we);if(!(P&I)){var Kn=yr&&ua.call(m,"__wrapped__"),bi=Rr&&ua.call(b,"__wrapped__");if(Kn||bi){var sa=Kn?m.value():m,wi=bi?b.value():b;return we||(we=new G),te(sa,wi,P,U,we)}}return Mn?(we||(we=new G),Rg(m,b,P,U,te,we)):!1}function Ro(m){return mo(m)&&De(m)==mn}function yu(m,b,P,U){var te=P.length,we=te,qe=!U;if(m==null)return!we;for(m=Tn(m);te--;){var ot=P[te];if(qe&&ot[2]?ot[1]!==m[ot[0]]:!(ot[0]in m))return!1}for(;++te<we;){ot=P[te];var yt=ot[0],mr=m[yt],yr=ot[1];if(qe&&ot[2]){if(mr===r&&!(yt in m))return!1}else{var Rr=new G;if(U)var Mn=U(mr,yr,yt,m,b,Rr);if(!(Mn===r?il(yr,mr,I|k,U,Rr):Mn))return!1}}return!0}function Tl(m){if(!vo(m)||Rt(m))return!1;var b=Rc(m)?Jr:Dr;return b.test(_a(m))}function Ac(m){return mo(m)&&da(m)==Ai}function $i(m){return mo(m)&&De(m)==Vi}function Bs(m){return mo(m)&&Lc(m.length)&&!!Na[da(m)]}function zo(m){return typeof m=="function"?m:m==null?kc:typeof m=="object"?ni(m)?nf(m[0],m[1]):Ru(m):tA(m)}function Cl(m){if(!Br(m))return Qs(m);var b=[];for(var P in Tn(m))ua.call(m,P)&&P!="constructor"&&b.push(P);return b}function up(m){if(!vo(m))return Wt(m);var b=Br(m),P=[];for(var U in m)U=="constructor"&&(b||!ua.call(m,U))||P.push(U);return P}function tu(m,b){return m<b}function Mf(m,b){var P=-1,U=oa(m)?Nt(m.length):[];return Ln(m,function(te,we,qe){U[++P]=b(te,we,qe)}),U}function Ru(m){var b=Zd(m);return b.length==1&&b[0][2]?br(b[0][0],b[0][1]):function(P){return P===m||yu(P,m,b)}}function nf(m,b){return ar(m)&&Zt(b)?br(Jn(m),b):function(P){var U=c0(P,m);return U===r&&U===b?iv(P,m):il(b,U,I|k)}}function _u(m,b,P,U,te){m!==b&&Ja(b,function(we,qe){if(te||(te=new G),vo(we))Ml(m,b,qe,P,_u,U,te);else{var ot=U?U(zr(m,qe),we,qe+"",m,b,te):r;ot===r&&(ot=we),et(m,qe,ot)}},Os)}function Ml(m,b,P,U,te,we,qe){var ot=zr(m,P),yt=zr(b,P),mr=qe.get(yt);if(mr){et(m,P,mr);return}var yr=we?we(ot,yt,P+"",m,b,qe):r,Rr=yr===r;if(Rr){var Mn=ni(yt),Kn=!Mn&&Ql(yt),bi=!Mn&&!Kn&&Ff(yt);yr=yt,Mn||Kn||bi?ni(ot)?yr=ot:Ya(ot)?yr=ru(ot):Kn?(Rr=!1,yr=sd(yt,!0)):bi?(Rr=!1,yr=If(yt,!0)):yr=[]:Bh(yt)||Nu(yt)?(yr=ot,Nu(ot)?yr=To(ot):(!vo(ot)||Rc(ot))&&(yr=Kt(yt))):Rr=!1}Rr&&(qe.set(yt,yr),te(yr,yt,U,we,qe),qe.delete(yt)),et(m,P,yr)}function Tc(m,b){var P=m.length;if(P)return b+=b<0?P:0,rr(b,P)?m[b]:r}function Lu(m,b,P){b.length?b=oo(b,function(we){return ni(we)?function(qe){return Ea(qe,we.length===1?we[0]:we)}:we}):b=[kc];var U=-1;b=oo(b,Zs(Qn()));var te=Mf(m,function(we,qe,ot){var yt=oo(b,function(mr){return mr(we)});return{criteria:yt,index:++U,value:we}});return dc(te,function(we,qe){return xu(we,qe,P)})}function gs(m,b){return rd(m,b,function(P,U){return iv(m,U)})}function rd(m,b,P){for(var U=-1,te=b.length,we={};++U<te;){var qe=b[U],ot=Ea(m,qe);P(ot,qe)&&ol(we,Il(qe,m),ot)}return we}function lp(m){return function(b){return Ea(b,m)}}function nd(m,b,P,U){var te=U?fh:Ps,we=-1,qe=b.length,ot=m;for(m===b&&(b=ru(b)),P&&(ot=oo(m,Zs(P)));++we<qe;)for(var yt=0,mr=b[we],yr=P?P(mr):mr;(yt=te(ot,yr,yt,U))>-1;)ot!==m&&Ju.call(ot,yt,1),Ju.call(m,yt,1);return m}function Wd(m,b){for(var P=m?b.length:0,U=P-1;P--;){var te=b[P];if(P==U||te!==we){var we=te;rr(te)?Ju.call(m,te,1):Gv(m,te)}}return m}function Pf(m,b){return m+bh(el()*(b-m+1))}function cp(m,b,P,U){for(var te=-1,we=Bn(Cu((b-m)/(P||1)),0),qe=Nt(we);we--;)qe[U?we:++te]=m,m+=P;return qe}function id(m,b){var P="";if(!m||b<1||b>it)return P;do b%2&&(P+=m),b=bh(b/2),b&&(m+=m);while(b);return P}function Xi(m,b){return Vn(kr(m,b,kc),m+"")}function ad(m){return Ge(_d(m))}function Vv(m,b){var P=_d(m);return Pn(P,Ur(b,0,P.length))}function ol(m,b,P,U){if(!vo(m))return m;b=Il(b,m);for(var te=-1,we=b.length,qe=we-1,ot=m;ot!=null&&++te<we;){var yt=Jn(b[te]),mr=P;if(yt==="__proto__"||yt==="constructor"||yt==="prototype")return m;if(te!=qe){var yr=ot[yt];mr=U?U(yr,yt,ot):r,mr===r&&(mr=vo(yr)?yr:rr(b[te+1])?[]:{})}ct(ot,yt,mr),ot=ot[yt]}return m}var fp=Bo?function(m,b){return Bo.set(m,b),m}:kc,hp=fo?function(m,b){return fo(m,"toString",{configurable:!0,enumerable:!1,value:gb(b),writable:!0})}:kc;function jv(m){return Pn(_d(m))}function Pl(m,b,P){var U=-1,te=m.length;b<0&&(b=-b>te?0:te+b),P=P>te?te:P,P<0&&(P+=te),te=b>P?0:P-b>>>0,b>>>=0;for(var we=Nt(te);++U<te;)we[U]=m[U+b];return we}function Ig(m,b){var P;return Ln(m,function(U,te,we){return P=b(U,te,we),!P}),!!P}function od(m,b,P){var U=0,te=m==null?U:m.length;if(typeof b=="number"&&b===b&&te<=er){for(;U<te;){var we=U+te>>>1,qe=m[we];qe!==null&&!ou(qe)&&(P?qe<=b:qe<b)?U=we+1:te=we}return te}return $v(m,b,kc,P)}function $v(m,b,P,U){var te=0,we=m==null?0:m.length;if(we===0)return 0;b=P(b);for(var qe=b!==b,ot=b===null,yt=ou(b),mr=b===r;te<we;){var yr=bh((te+we)/2),Rr=P(m[yr]),Mn=Rr!==r,Kn=Rr===null,bi=Rr===Rr,sa=ou(Rr);if(qe)var wi=U||bi;else mr?wi=bi&&(U||Mn):ot?wi=bi&&Mn&&(U||!Kn):yt?wi=bi&&Mn&&!Kn&&(U||!sa):Kn||sa?wi=!1:wi=U?Rr<=b:Rr<b;wi?te=yr+1:we=yr}return Ga(we,gt)}function Xm(m,b){for(var P=-1,U=m.length,te=0,we=[];++P<U;){var qe=m[P],ot=b?b(qe):qe;if(!P||!Aa(ot,yt)){var yt=ot;we[te++]=qe===0?0:qe}}return we}function Xd(m){return typeof m=="number"?m:ou(m)?Qe:+m}function sl(m){if(typeof m=="string")return m;if(ni(m))return oo(m,sl)+"";if(ou(m))return Al?Al.call(m):"";var b=m+"";return b=="0"&&1/m==-$e?"-0":b}function ul(m,b,P){var U=-1,te=Yu,we=m.length,qe=!0,ot=[],yt=ot;if(P)qe=!1,te=Ji;else if(we>=i){var mr=b?null:qi(m);if(mr)return jl(mr);qe=!1,te=bf,yt=new M}else yt=b?[]:ot;e:for(;++U<we;){var yr=m[U],Rr=b?b(yr):yr;if(yr=P||yr!==0?yr:0,qe&&Rr===Rr){for(var Mn=yt.length;Mn--;)if(yt[Mn]===Rr)continue e;b&&yt.push(Rr),ot.push(yr)}else te(yt,Rr,P)||(yt!==ot&&yt.push(Rr),ot.push(yr))}return ot}function Gv(m,b){return b=Il(b,m),m=Pr(m,b),m==null||delete m[Jn(Ue(b))]}function Eo(m,b,P,U){return ol(m,b,P(Ea(m,b)),U)}function Th(m,b,P,U){for(var te=m.length,we=U?te:-1;(U?we--:++we<te)&&b(m[we],we,m););return P?Pl(m,U?0:we,U?we+1:te):Pl(m,U?we+1:0,U?te:we)}function Hv(m,b){var P=m;return P instanceof mi&&(P=P.value()),ep(b,function(U,te){return te.func.apply(te.thisArg,qu([U],te.args))},P)}function pp(m,b,P){var U=m.length;if(U<2)return U?ul(m[0]):[];for(var te=-1,we=Nt(U);++te<U;)for(var qe=m[te],ot=-1;++ot<U;)ot!=te&&(we[te]=$r(we[te]||qe,m[ot],b,P));return ul(pn(we,1),b,P)}function Ch(m,b,P){for(var U=-1,te=m.length,we=b.length,qe={};++U<te;){var ot=U<we?b[U]:r;P(qe,m[U],ot)}return qe}function Cc(m){return Ya(m)?m:[]}function Mh(m){return typeof m=="function"?m:kc}function Il(m,b){return ni(m)?m:ar(m,b)?[m]:Wn(qa(m))}var Ph=Xi;function ll(m,b,P){var U=m.length;return P=P===r?U:P,!b&&P>=U?m:Pl(m,b,P)}var Ih=_h||function(m){return Fo.clearTimeout(m)};function sd(m,b){if(b)return m.slice();var P=m.length,U=hu?hu(P):new m.constructor(P);return m.copy(U),U}function af(m){var b=new m.constructor(m.byteLength);return new Sl(b).set(new Sl(m)),b}function Yd(m,b){var P=b?af(m.buffer):m.buffer;return new m.constructor(P,m.byteOffset,m.byteLength)}function dp(m){var b=new m.constructor(m.source,Dt.exec(m));return b.lastIndex=m.lastIndex,b}function qd(m){return eu?Tn(eu.call(m)):{}}function If(m,b){var P=b?af(m.buffer):m.buffer;return new m.constructor(P,m.byteOffset,m.length)}function Rf(m,b){if(m!==b){var P=m!==r,U=m===null,te=m===m,we=ou(m),qe=b!==r,ot=b===null,yt=b===b,mr=ou(b);if(!ot&&!mr&&!we&&m>b||we&&qe&&yt&&!ot&&!mr||U&&qe&&yt||!P&&yt||!te)return 1;if(!U&&!we&&!mr&&m<b||mr&&P&&te&&!U&&!we||ot&&P&&te||!qe&&te||!yt)return-1}return 0}function xu(m,b,P){for(var U=-1,te=m.criteria,we=b.criteria,qe=te.length,ot=P.length;++U<qe;){var yt=Rf(te[U],we[U]);if(yt){if(U>=ot)return yt;var mr=P[U];return yt*(mr=="desc"?-1:1)}}return m.index-b.index}function vp(m,b,P,U){for(var te=-1,we=m.length,qe=P.length,ot=-1,yt=b.length,mr=Bn(we-qe,0),yr=Nt(yt+mr),Rr=!U;++ot<yt;)yr[ot]=b[ot];for(;++te<qe;)(Rr||te<we)&&(yr[P[te]]=m[te]);for(;mr--;)yr[ot++]=m[te++];return yr}function mp(m,b,P,U){for(var te=-1,we=m.length,qe=-1,ot=P.length,yt=-1,mr=b.length,yr=Bn(we-ot,0),Rr=Nt(yr+mr),Mn=!U;++te<yr;)Rr[te]=m[te];for(var Kn=te;++yt<mr;)Rr[Kn+yt]=b[yt];for(;++qe<ot;)(Mn||te<we)&&(Rr[Kn+P[qe]]=m[te++]);return Rr}function ru(m,b){var P=-1,U=m.length;for(b||(b=Nt(U));++P<U;)b[P]=m[P];return b}function ku(m,b,P,U){var te=!P;P||(P={});for(var we=-1,qe=b.length;++we<qe;){var ot=b[we],yt=U?U(P[ot],m[ot],ot,P,m):r;yt===r&&(yt=m[ot]),te?sr(P,ot,yt):ct(P,ot,yt)}return P}function Lf(m,b){return ku(m,j(m),b)}function Rh(m,b){return ku(m,_e(m),b)}function gp(m,b){return function(P,U){var te=ni(P)?fc:At,we=b?b():{};return te(P,m,Qn(U,2),we)}}function yp(m){return Xi(function(b,P){var U=-1,te=P.length,we=te>1?P[te-1]:r,qe=te>2?P[2]:r;for(we=m.length>3&&typeof we=="function"?(te--,we):r,qe&&hr(P[0],P[1],qe)&&(we=te<3?r:we,te=1),b=Tn(b);++U<te;){var ot=P[U];ot&&m(b,ot,U,we)}return b})}function Wv(m,b){return function(P,U){if(P==null)return P;if(!oa(P))return m(P,U);for(var te=P.length,we=b?te:-1,qe=Tn(P);(b?we--:++we<te)&&U(qe[we],we,qe)!==!1;);return P}}function Xv(m){return function(b,P,U){for(var te=-1,we=Tn(b),qe=U(b),ot=qe.length;ot--;){var yt=qe[m?ot:++te];if(P(we[yt],yt,we)===!1)break}return b}}function kf(m,b,P){var U=b&D,te=_p(m);function we(){var qe=this&&this!==Fo&&this instanceof we?te:m;return qe.apply(U?P:this,arguments)}return we}function Yv(m){return function(b){b=qa(b);var P=cu(b)?Is(b):r,U=P?P[0]:b.charAt(0),te=P?ll(P,1).join(""):b.slice(1);return U[m]()+te}}function Rl(m){return function(b){return ep(JS(jg(b).replace(Vd,"")),m,"")}}function _p(m){return function(){var b=arguments;switch(b.length){case 0:return new m;case 1:return new m(b[0]);case 2:return new m(b[0],b[1]);case 3:return new m(b[0],b[1],b[2]);case 4:return new m(b[0],b[1],b[2],b[3]);case 5:return new m(b[0],b[1],b[2],b[3],b[4]);case 6:return new m(b[0],b[1],b[2],b[3],b[4],b[5]);case 7:return new m(b[0],b[1],b[2],b[3],b[4],b[5],b[6])}var P=vs(m.prototype),U=m.apply(P,b);return vo(U)?U:P}}function qv(m,b,P){var U=_p(m);function te(){for(var we=arguments.length,qe=Nt(we),ot=we,yt=Of(te);ot--;)qe[ot]=arguments[ot];var mr=we<3&&qe[0]!==yt&&qe[we-1]!==yt?[]:Ns(qe,yt);if(we-=mr.length,we<P)return Yo(m,b,cl,te.placeholder,r,qe,mr,r,r,P-we);var yr=this&&this!==Fo&&this instanceof te?U:m;return lo(yr,this,qe)}return te}function Lh(m){return function(b,P,U){var te=Tn(b);if(!oa(b)){var we=Qn(P,3);b=Vs(b),P=function(ot){return we(te[ot],ot,te)}}var qe=m(b,P,U);return qe>-1?te[we?b[qe]:qe]:r}}function Ll(m){return Mc(function(b){var P=b.length,U=P,te=os.prototype.thru;for(m&&b.reverse();U--;){var we=b[U];if(typeof we!="function")throw new Ls(a);if(te&&!qe&&bp(we)=="wrapper")var qe=new os([],!0)}for(U=qe?U:P;++U<P;){we=b[U];var ot=bp(we),yt=ot=="wrapper"?kh(we):r;yt&&lt(yt[0])&&yt[1]==(Y|F|H|ee)&&!yt[4].length&&yt[9]==1?qe=qe[bp(yt[0])].apply(qe,yt[3]):qe=we.length==1&&lt(we)?qe[ot]():qe.thru(we)}return function(){var mr=arguments,yr=mr[0];if(qe&&mr.length==1&&ni(yr))return qe.plant(yr).value();for(var Rr=0,Mn=P?b[Rr].apply(this,mr):yr;++Rr<P;)Mn=b[Rr].call(this,Mn);return Mn}})}function cl(m,b,P,U,te,we,qe,ot,yt,mr){var yr=b&Y,Rr=b&D,Mn=b&V,Kn=b&(F|N),bi=b&pe,sa=Mn?r:_p(m);function wi(){for(var ba=arguments.length,ka=Nt(ba),uf=ba;uf--;)ka[uf]=arguments[uf];if(Kn)var Jl=Of(wi),lf=Zc(ka,Jl);if(U&&(ka=vp(ka,U,te,Kn)),we&&(ka=mp(ka,we,qe,Kn)),ba-=lf,Kn&&ba<mr){var js=Ns(ka,Jl);return Yo(m,b,cl,wi.placeholder,P,ka,js,ot,yt,mr-ba)}var Uh=Rr?P:this,xd=Mn?Uh[m]:m;return ba=ka.length,ot?ka=fr(ka,ot):bi&&ba>1&&ka.reverse(),yr&&yt<ba&&(ka.length=yt),this&&this!==Fo&&this instanceof wi&&(xd=sa||_p(xd)),xd.apply(Uh,ka)}return wi}function Zv(m,b){return function(P,U){return tf(P,m,b(U),{})}}function of(m,b){return function(P,U){var te;if(P===r&&U===r)return b;if(P!==r&&(te=P),U!==r){if(te===r)return U;typeof P=="string"||typeof U=="string"?(P=sl(P),U=sl(U)):(P=Xd(P),U=Xd(U)),te=m(P,U)}return te}}function Ou(m){return Mc(function(b){return b=oo(b,Zs(Qn())),Xi(function(P){var U=this;return m(b,function(te){return lo(te,U,P)})})})}function xp(m,b){b=b===r?" ":sl(b);var P=b.length;if(P<2)return P?id(b,m):b;var U=id(b,Cu(m/Qu(b)));return cu(b)?ll(Is(U),0,m).join(""):U.slice(0,m)}function Kv(m,b,P,U){var te=b&D,we=_p(m);function qe(){for(var ot=-1,yt=arguments.length,mr=-1,yr=U.length,Rr=Nt(yr+yt),Mn=this&&this!==Fo&&this instanceof qe?we:m;++mr<yr;)Rr[mr]=U[mr];for(;yt--;)Rr[mr++]=arguments[++ot];return lo(Mn,te?P:this,Rr)}return qe}function ud(m){return function(b,P,U){return U&&typeof U!="number"&&hr(b,P,U)&&(P=U=r),b=Nf(b),P===r?(P=b,b=0):P=Nf(P),U=U===r?b<P?1:-1:Nf(U),cp(b,P,U,m)}}function ld(m){return function(b,P){return typeof b=="string"&&typeof P=="string"||(b=Bu(b),P=Bu(P)),m(b,P)}}function Yo(m,b,P,U,te,we,qe,ot,yt,mr){var yr=b&F,Rr=yr?qe:r,Mn=yr?r:qe,Kn=yr?we:r,bi=yr?r:we;b|=yr?H:q,b&=~(yr?q:H),b&O||(b&=~(D|V));var sa=[m,b,te,Kn,Rr,bi,Mn,ot,yt,mr],wi=P.apply(r,sa);return lt(m)&&Vr(wi,sa),wi.placeholder=U,Gr(wi,m,b)}function ql(m){var b=Ua[m];return function(P,U){if(P=Bu(P),U=U==null?0:Ga(zi(U),292),U&&Eh(P)){var te=(qa(P)+"e").split("e"),we=b(te[0]+"e"+(+te[1]+U));return te=(qa(we)+"e").split("e"),+(te[0]+"e"+(+te[1]-U))}return b(P)}}var qi=_n&&1/jl(new _n([,-0]))[1]==$e?function(m){return new _n(m)}:xb;function bu(m){return function(b){var P=De(b);return P==mn?hh(b):P==Vi?ph(b):Gd(b,m(b))}}function Zl(m,b,P,U,te,we,qe,ot){var yt=b&V;if(!yt&&typeof m!="function")throw new Ls(a);var mr=U?U.length:0;if(mr||(b&=~(H|q),U=te=r),qe=qe===r?qe:Bn(zi(qe),0),ot=ot===r?ot:zi(ot),mr-=te?te.length:0,b&q){var yr=U,Rr=te;U=te=r}var Mn=yt?r:kh(m),Kn=[m,b,P,U,te,yr,Rr,we,qe,ot];if(Mn&&sn(Kn,Mn),m=Kn[0],b=Kn[1],P=Kn[2],U=Kn[3],te=Kn[4],ot=Kn[9]=Kn[9]===r?yt?0:m.length:Bn(Kn[9]-mr,0),!ot&&b&(F|N)&&(b&=~(F|N)),!b||b==D)var bi=kf(m,b,P);else b==F||b==N?bi=qv(m,b,ot):(b==H||b==(D|H))&&!te.length?bi=Kv(m,b,P,U):bi=cl.apply(r,Kn);var sa=Mn?fp:Vr;return Gr(sa(bi,Kn),m,b)}function Qv(m,b,P,U){return m===r||Aa(m,Af[P])&&!ua.call(U,P)?b:m}function Ym(m,b,P,U,te,we){return vo(m)&&vo(b)&&(we.set(b,m),_u(m,b,r,Ym,we),we.delete(b)),m}function qm(m){return Bh(m)?r:m}function Zm(m,b,P,U,te,we){var qe=P&I,ot=m.length,yt=b.length;if(ot!=yt&&!(qe&&yt>ot))return!1;var mr=we.get(m),yr=we.get(b);if(mr&&yr)return mr==b&&yr==m;var Rr=-1,Mn=!0,Kn=P&k?new M:r;for(we.set(m,b),we.set(b,m);++Rr<ot;){var bi=m[Rr],sa=b[Rr];if(U)var wi=qe?U(sa,bi,Rr,b,m,we):U(bi,sa,Rr,m,b,we);if(wi!==r){if(wi)continue;Mn=!1;break}if(Kn){if(!tp(b,function(ba,ka){if(!bf(Kn,ka)&&(bi===ba||te(bi,ba,P,U,we)))return Kn.push(ka)})){Mn=!1;break}}else if(!(bi===sa||te(bi,sa,P,U,we))){Mn=!1;break}}return we.delete(m),we.delete(b),Mn}function Km(m,b,P,U,te,we,qe){switch(P){case wn:if(m.byteLength!=b.byteLength||m.byteOffset!=b.byteOffset)return!1;m=m.buffer,b=b.buffer;case Yr:return!(m.byteLength!=b.byteLength||!we(new Sl(m),new Sl(b)));case On:case Ut:case Nn:return Aa(+m,+b);case an:return m.name==b.name&&m.message==b.message;case Ai:case za:return m==b+"";case mn:var ot=hh;case Vi:var yt=U&I;if(ot||(ot=jl),m.size!=b.size&&!yt)return!1;var mr=qe.get(m);if(mr)return mr==b;U|=k,qe.set(m,b);var yr=Zm(ot(m),ot(b),U,te,we,qe);return qe.delete(m),yr;case ia:if(eu)return eu.call(m)==eu.call(b)}return!1}function Rg(m,b,P,U,te,we){var qe=P&I,ot=Jv(m),yt=ot.length,mr=Jv(b),yr=mr.length;if(yt!=yr&&!qe)return!1;for(var Rr=yt;Rr--;){var Mn=ot[Rr];if(!(qe?Mn in b:ua.call(b,Mn)))return!1}var Kn=we.get(m),bi=we.get(b);if(Kn&&bi)return Kn==b&&bi==m;var sa=!0;we.set(m,b),we.set(b,m);for(var wi=qe;++Rr<yt;){Mn=ot[Rr];var ba=m[Mn],ka=b[Mn];if(U)var uf=qe?U(ka,ba,Mn,b,m,we):U(ba,ka,Mn,m,b,we);if(!(uf===r?ba===ka||te(ba,ka,P,U,we):uf)){sa=!1;break}wi||(wi=Mn=="constructor")}if(sa&&!wi){var Jl=m.constructor,lf=b.constructor;Jl!=lf&&"constructor"in m&&"constructor"in b&&!(typeof Jl=="function"&&Jl instanceof Jl&&typeof lf=="function"&&lf instanceof lf)&&(sa=!1)}return we.delete(m),we.delete(b),sa}function Mc(m){return Vn(kr(m,r,yi),m+"")}function Jv(m){return ms(m,Vs,j)}function em(m){return ms(m,Os,_e)}var kh=Bo?function(m){return Bo.get(m)}:xb;function bp(m){for(var b=m.name+"",P=ds[b],U=ua.call(ds,b)?P.length:0;U--;){var te=P[U],we=te.func;if(we==null||we==m)return te.name}return b}function Of(m){var b=ua.call(me,"placeholder")?me:m;return b.placeholder}function Qn(){var m=me.iteratee||yb;return m=m===yb?zo:m,arguments.length?m(arguments[0],arguments[1]):m}function va(m,b){var P=m.__data__;return vr(b)?P[typeof b=="string"?"string":"hash"]:P.map}function Zd(m){for(var b=Vs(m),P=b.length;P--;){var U=b[P],te=m[U];b[P]=[U,te,Zt(te)]}return b}function nu(m,b){var P=rp(m,b);return Tl(P)?P:r}function wp(m){var b=ua.call(m,Wo),P=m[Wo];try{m[Wo]=r;var U=!0}catch{}var te=_c.call(m);return U&&(b?m[Wo]=P:delete m[Wo]),te}var j=Kc?function(m){return m==null?[]:(m=Tn(m),xl(Kc(m),function(b){return Nr.call(m,b)}))}:bb,_e=Kc?function(m){for(var b=[];m;)qu(b,j(m)),m=ns(m);return b}:bb,De=da;(No&&De(new No(new ArrayBuffer(1)))!=wn||ho&&De(new ho)!=mn||wc&&De(wc.resolve())!=Li||_n&&De(new _n)!=Vi||on&&De(new on)!=Ht)&&(De=function(m){var b=da(m),P=b==qn?m.constructor:r,U=P?_a(P):"";if(U)switch(U){case Xo:return wn;case tl:return mn;case sp:return Li;case Js:return Vi;case ea:return Ht}return b});function bt(m,b,P){for(var U=-1,te=P.length;++U<te;){var we=P[U],qe=we.size;switch(we.type){case"drop":m+=qe;break;case"dropRight":b-=qe;break;case"take":b=Ga(b,m+qe);break;case"takeRight":m=Bn(m,b-qe);break}}return{start:m,end:b}}function Xt(m){var b=m.match(nr);return b?b[1].split(cr):[]}function xt(m,b,P){b=Il(b,m);for(var U=-1,te=b.length,we=!1;++U<te;){var qe=Jn(b[U]);if(!(we=m!=null&&P(m,qe)))break;m=m[qe]}return we||++U!=te?we:(te=m==null?0:m.length,!!te&&Lc(te)&&rr(qe,te)&&(ni(m)||Nu(m)))}function Bt(m){var b=m.length,P=new m.constructor(b);return b&&typeof m[0]=="string"&&ua.call(m,"index")&&(P.index=m.index,P.input=m.input),P}function Kt(m){return typeof m.constructor=="function"&&!Br(m)?vs(ns(m)):{}}function ur(m,b,P){var U=m.constructor;switch(b){case Yr:return af(m);case On:case Ut:return new U(+m);case wn:return Yd(m,P);case Qi:case Zn:case Hn:case Dn:case di:case wt:case rn:case En:case Ii:return If(m,P);case mn:return new U;case Nn:case za:return new U(m);case Ai:return dp(m);case Vi:return new U;case ia:return qd(m)}}function dr(m,b){var P=b.length;if(!P)return m;var U=P-1;return b[U]=(P>1?"& ":"")+b[U],b=b.join(P>2?", ":" "),m.replace(ht,`{
/* [wrapped with `+b+`] */
`)}function pr(m){return ni(m)||Nu(m)||!!(xo&&m&&m[xo])}function rr(m,b){var P=typeof m;return b=b??it,!!b&&(P=="number"||P!="symbol"&&Fr.test(m))&&m>-1&&m%1==0&&m<b}function hr(m,b,P){if(!vo(P))return!1;var U=typeof b;return(U=="number"?oa(P)&&rr(b,P.length):U=="string"&&b in P)?Aa(P[b],m):!1}function ar(m,b){if(ni(m))return!1;var P=typeof m;return P=="number"||P=="symbol"||P=="boolean"||m==null||ou(m)?!0:ge.test(m)||!oe.test(m)||b!=null&&m in Tn(b)}function vr(m){var b=typeof m;return b=="string"||b=="number"||b=="symbol"||b=="boolean"?m!=="__proto__":m===null}function lt(m){var b=bp(m),P=me[b];if(typeof P!="function"||!(b in mi.prototype))return!1;if(m===P)return!0;var U=kh(P);return!!U&&m===U[0]}function Rt(m){return!!$a&&$a in m}var lr=op?Rc:wb;function Br(m){var b=m&&m.constructor,P=typeof b=="function"&&b.prototype||Af;return m===P}function Zt(m){return m===m&&!vo(m)}function br(m,b){return function(P){return P==null?!1:P[m]===b&&(b!==r||m in Tn(P))}}function Lr(m){var b=to(m,function(U){return P.size===h&&P.clear(),U}),P=b.cache;return b}function sn(m,b){var P=m[1],U=b[1],te=P|U,we=te<(D|V|Y),qe=U==Y&&P==F||U==Y&&P==ee&&m[7].length<=b[8]||U==(Y|ee)&&b[7].length<=b[8]&&P==F;if(!(we||qe))return m;U&D&&(m[2]=b[2],te|=P&D?0:O);var ot=b[3];if(ot){var yt=m[3];m[3]=yt?vp(yt,ot,b[4]):ot,m[4]=yt?Ns(m[3],y):b[4]}return ot=b[5],ot&&(yt=m[5],m[5]=yt?mp(yt,ot,b[6]):ot,m[6]=yt?Ns(m[5],y):b[6]),ot=b[7],ot&&(m[7]=ot),U&Y&&(m[8]=m[8]==null?b[8]:Ga(m[8],b[8])),m[9]==null&&(m[9]=b[9]),m[0]=b[0],m[1]=te,m}function Wt(m){var b=[];if(m!=null)for(var P in Tn(m))b.push(P);return b}function jt(m){return _c.call(m)}function kr(m,b,P){return b=Bn(b===r?m.length-1:b,0),function(){for(var U=arguments,te=-1,we=Bn(U.length-b,0),qe=Nt(we);++te<we;)qe[te]=U[b+te];te=-1;for(var ot=Nt(b+1);++te<b;)ot[te]=U[te];return ot[b]=P(qe),lo(m,this,ot)}}function Pr(m,b){return b.length<2?m:Ea(m,Pl(b,0,-1))}function fr(m,b){for(var P=m.length,U=Ga(b.length,P),te=ru(m);U--;){var we=b[U];m[U]=rr(we,P)?te[we]:r}return m}function zr(m,b){if(!(b==="constructor"&&typeof m[b]=="function")&&b!="__proto__")return m[b]}var Vr=Xr(fp),Gn=Ks||function(m,b){return Fo.setTimeout(m,b)},Vn=Xr(hp);function Gr(m,b,P){var U=b+"";return Vn(m,dr(U,po(Xt(U),P)))}function Xr(m){var b=0,P=0;return function(){var U=du(),te=Se-(U-P);if(P=U,te>0){if(++b>=xe)return arguments[0]}else b=0;return m.apply(r,arguments)}}function Pn(m,b){var P=-1,U=m.length,te=U-1;for(b=b===r?U:b;++P<b;){var we=Pf(P,te),qe=m[we];m[we]=m[P],m[P]=qe}return m.length=b,m}var Wn=Lr(function(m){var b=[];return m.charCodeAt(0)===46&&b.push(""),m.replace(Le,function(P,U,te,we){b.push(te?we.replace(Sr,"$1"):U||P)}),b});function Jn(m){if(typeof m=="string"||ou(m))return m;var b=m+"";return b=="0"&&1/m==-$e?"-0":b}function _a(m){if(m!=null){try{return yc.call(m)}catch{}try{return m+""}catch{}}return""}function po(m,b){return co(zt,function(P){var U="_."+P[0];b&P[1]&&!Yu(m,U)&&m.push(U)}),m.sort()}function gi(m){if(m instanceof mi)return m.clone();var b=new os(m.__wrapped__,m.__chain__);return b.__actions__=ru(m.__actions__),b.__index__=m.__index__,b.__values__=m.__values__,b}function ss(m,b,P){(P?hr(m,b,P):b===r)?b=1:b=Bn(zi(b),0);var U=m==null?0:m.length;if(!U||b<1)return[];for(var te=0,we=0,qe=Nt(Cu(U/b));te<U;)qe[we++]=Pl(m,te,te+=b);return qe}function Ba(m){for(var b=-1,P=m==null?0:m.length,U=0,te=[];++b<P;){var we=m[b];we&&(te[U++]=we)}return te}function Uo(){var m=arguments.length;if(!m)return[];for(var b=Nt(m-1),P=arguments[0],U=m;U--;)b[U-1]=arguments[U];return qu(ni(P)?ru(P):[P],pn(b,1))}var Lo=Xi(function(m,b){return Ya(m)?$r(m,pn(b,1,Ya,!0)):[]}),us=Xi(function(m,b){var P=Ue(b);return Ya(P)&&(P=r),Ya(m)?$r(m,pn(b,1,Ya,!0),Qn(P,2)):[]}),ls=Xi(function(m,b){var P=Ue(b);return Ya(P)&&(P=r),Ya(m)?$r(m,pn(b,1,Ya,!0),r,P):[]});function ys(m,b,P){var U=m==null?0:m.length;return U?(b=P||b===r?1:zi(b),Pl(m,b<0?0:b,U)):[]}function so(m,b,P){var U=m==null?0:m.length;return U?(b=P||b===r?1:zi(b),b=U-b,Pl(m,0,b<0?0:b)):[]}function ui(m,b){return m&&m.length?Th(m,Qn(b,3),!0,!0):[]}function Vo(m,b){return m&&m.length?Th(m,Qn(b,3),!0):[]}function Zi(m,b,P,U){var te=m==null?0:m.length;return te?(P&&typeof P!="number"&&hr(m,b,P)&&(P=0,U=te),ri(m,b,P,U)):[]}function So(m,b,P){var U=m==null?0:m.length;if(!U)return-1;var te=P==null?0:zi(P);return te<0&&(te=Bn(U+te,0)),ch(m,Qn(b,3),te)}function kn(m,b,P){var U=m==null?0:m.length;if(!U)return-1;var te=U-1;return P!==r&&(te=zi(P),te=P<0?Bn(U+te,0):Ga(te,U-1)),ch(m,Qn(b,3),te,!0)}function yi(m){var b=m==null?0:m.length;return b?pn(m,1):[]}function Sa(m){var b=m==null?0:m.length;return b?pn(m,$e):[]}function jo(m,b){var P=m==null?0:m.length;return P?(b=b===r?1:zi(b),pn(m,b)):[]}function Du(m){for(var b=-1,P=m==null?0:m.length,U={};++b<P;){var te=m[b];U[te[0]]=te[1]}return U}function Pe(m){return m&&m.length?m[0]:r}function St(m,b,P){var U=m==null?0:m.length;if(!U)return-1;var te=P==null?0:zi(P);return te<0&&(te=Bn(U+te,0)),Ps(m,b,te)}function pt(m){var b=m==null?0:m.length;return b?Pl(m,0,-1):[]}var en=Xi(function(m){var b=oo(m,Cc);return b.length&&b[0]===m[0]?Xl(b):[]}),_i=Xi(function(m){var b=Ue(m),P=oo(m,Cc);return b===Ue(P)?b=r:P.pop(),P.length&&P[0]===m[0]?Xl(P,Qn(b,2)):[]}),Ae=Xi(function(m){var b=Ue(m),P=oo(m,Cc);return b=typeof b=="function"?b:r,b&&P.pop(),P.length&&P[0]===m[0]?Xl(P,r,b):[]});function fe(m,b){return m==null?"":pu.call(m,b)}function Ue(m){var b=m==null?0:m.length;return b?m[b-1]:r}function ut(m,b,P){var U=m==null?0:m.length;if(!U)return-1;var te=U;return P!==r&&(te=zi(P),te=te<0?Bn(U+te,0):Ga(te,U-1)),b===b?dh(m,b,te):ch(m,Zu,te,!0)}function Et(m,b){return m&&m.length?Tc(m,zi(b)):r}var Je=Xi(We);function We(m,b){return m&&m.length&&b&&b.length?nd(m,b):m}function tt(m,b,P){return m&&m.length&&b&&b.length?nd(m,b,Qn(P,2)):m}function he(m,b,P){return m&&m.length&&b&&b.length?nd(m,b,r,P):m}var je=Mc(function(m,b){var P=m==null?0:m.length,U=_r(m,b);return Wd(m,oo(b,function(te){return rr(te,P)?+te:te}).sort(Rf)),U});function Te(m,b){var P=[];if(!(m&&m.length))return P;var U=-1,te=[],we=m.length;for(b=Qn(b,3);++U<we;){var qe=m[U];b(qe,U,m)&&(P.push(qe),te.push(U))}return Wd(m,te),P}function at(m){return m==null?m:bc.call(m)}function dt(m,b,P){var U=m==null?0:m.length;return U?(P&&typeof P!="number"&&hr(m,b,P)?(b=0,P=U):(b=b==null?0:zi(b),P=P===r?U:zi(P)),Pl(m,b,P)):[]}function Qt(m,b){return od(m,b)}function Tr(m,b,P){return $v(m,b,Qn(P,2))}function Cr(m,b){var P=m==null?0:m.length;if(P){var U=od(m,b);if(U<P&&Aa(m[U],b))return U}return-1}function Hr(m,b){return od(m,b,!0)}function wr(m,b,P){return $v(m,b,Qn(P,2),!0)}function dn(m,b){var P=m==null?0:m.length;if(P){var U=od(m,b,!0)-1;if(Aa(m[U],b))return U}return-1}function Qr(m){return m&&m.length?Xm(m):[]}function un(m,b){return m&&m.length?Xm(m,Qn(b,2)):[]}function ln(m){var b=m==null?0:m.length;return b?Pl(m,1,b):[]}function fn(m,b,P){return m&&m.length?(b=P||b===r?1:zi(b),Pl(m,0,b<0?0:b)):[]}function Un(m,b,P){var U=m==null?0:m.length;return U?(b=P||b===r?1:zi(b),b=U-b,Pl(m,b<0?0:b,U)):[]}function aa(m,b){return m&&m.length?Th(m,Qn(b,3),!1,!0):[]}function qo(m,b){return m&&m.length?Th(m,Qn(b,3)):[]}var Fu=Xi(function(m){return ul(pn(m,1,Ya,!0))}),Pc=Xi(function(m){var b=Ue(m);return Ya(b)&&(b=r),ul(pn(m,1,Ya,!0),Qn(b,2))}),Ra=Xi(function(m){var b=Ue(m);return b=typeof b=="function"?b:r,ul(pn(m,1,Ya,!0),r,b)});function Pi(m){return m&&m.length?ul(m):[]}function Kl(m,b){return m&&m.length?ul(m,Qn(b,2)):[]}function fl(m,b){return b=typeof b=="function"?b:r,m&&m.length?ul(m,r,b):[]}function cd(m){if(!(m&&m.length))return[];var b=0;return m=xl(m,function(P){if(Ya(P))return b=Bn(P.length,b),!0}),vc(b,function(P){return oo(m,Ku(P))})}function hl(m,b){if(!(m&&m.length))return[];var P=cd(m);return b==null?P:oo(P,function(U){return lo(b,r,U)})}var tm=Xi(function(m,b){return Ya(m)?$r(m,b):[]}),Lg=Xi(function(m){return pp(xl(m,Ya))}),fd=Xi(function(m){var b=Ue(m);return Ya(b)&&(b=r),pp(xl(m,Ya),Qn(b,2))}),hd=Xi(function(m){var b=Ue(m);return b=typeof b=="function"?b:r,pp(xl(m,Ya),r,b)}),M_=Xi(cd);function Zo(m,b){return Ch(m||[],b||[],ct)}function rm(m,b){return Ch(m||[],b||[],ol)}var Oh=Xi(function(m){var b=m.length,P=b>1?m[b-1]:r;return P=typeof P=="function"?(m.pop(),P):r,hl(m,P)});function nm(m){var b=me(m);return b.__chain__=!0,b}function Qm(m,b){return b(m),m}function Kd(m,b){return b(m)}var Qd=Mc(function(m){var b=m.length,P=b?m[0]:0,U=this.__wrapped__,te=function(we){return _r(we,m)};return b>1||this.__actions__.length||!(U instanceof mi)||!rr(P)?this.thru(te):(U=U.slice(P,+P+(b?1:0)),U.__actions__.push({func:Kd,args:[te],thisArg:r}),new os(U,this.__chain__).thru(function(we){return b&&!we.length&&we.push(r),we}))});function Dh(){return nm(this)}function P_(){return new os(this.value(),this.__chain__)}function I_(){this.__values__===r&&(this.__values__=i0(this.value()));var m=this.__index__>=this.__values__.length,b=m?r:this.__values__[this.__index__++];return{done:m,value:b}}function ob(){return this}function _s(m){for(var b,P=this;P instanceof as;){var U=gi(P);U.__index__=0,U.__values__=r,b?te.__wrapped__=U:b=U;var te=U;P=P.__wrapped__}return te.__wrapped__=m,b}function Ep(){var m=this.__wrapped__;if(m instanceof mi){var b=m;return this.__actions__.length&&(b=new mi(this)),b=b.reverse(),b.__actions__.push({func:Kd,args:[at],thisArg:r}),new os(b,this.__chain__)}return this.thru(at)}function R_(){return Hv(this.__wrapped__,this.__actions__)}var s=gp(function(m,b,P){ua.call(m,P)?++m[P]:sr(m,P,1)});function l(m,b,P){var U=ni(m)?qs:$n;return P&&hr(m,b,P)&&(b=r),U(m,Qn(b,3))}function f(m,b){var P=ni(m)?xl:zn;return P(m,Qn(b,3))}var g=Lh(So),w=Lh(kn);function S(m,b){return pn(Ie(m,b),1)}function C(m,b){return pn(Ie(m,b),$e)}function L(m,b,P){return P=P===r?1:zi(P),pn(Ie(m,b),P)}function z(m,b){var P=ni(m)?co:Ln;return P(m,Qn(b,3))}function $(m,b){var P=ni(m)?hc:Yn;return P(m,Qn(b,3))}var W=gp(function(m,b,P){ua.call(m,P)?m[P].push(b):sr(m,P,[b])});function K(m,b,P,U){m=oa(m)?m:_d(m),P=P&&!U?zi(P):0;var te=m.length;return P<0&&(P=Bn(te+P,0)),md(m)?P<=te&&m.indexOf(b,P)>-1:!!te&&Ps(m,b,P)>-1}var ne=Xi(function(m,b,P){var U=-1,te=typeof b=="function",we=oa(m)?Nt(m.length):[];return Ln(m,function(qe){we[++U]=te?lo(b,qe,P):gu(qe,b,P)}),we}),le=gp(function(m,b,P){sr(m,P,b)});function Ie(m,b){var P=ni(m)?oo:Mf;return P(m,Qn(b,3))}function ke(m,b,P,U){return m==null?[]:(ni(b)||(b=b==null?[]:[b]),P=U?r:P,ni(P)||(P=P==null?[]:[P]),Lu(m,b,P))}var Ze=gp(function(m,b,P){m[P?0:1].push(b)},function(){return[[],[]]});function Ve(m,b,P){var U=ni(m)?ep:Xc,te=arguments.length<3;return U(m,Qn(b,4),P,te,Ln)}function st(m,b,P){var U=ni(m)?Zp:Xc,te=arguments.length<3;return U(m,Qn(b,4),P,te,Yn)}function vt(m,b){var P=ni(m)?xl:zn;return P(m,Wa(Qn(b,3)))}function Tt(m){var b=ni(m)?Ge:ad;return b(m)}function It(m,b,P){(P?hr(m,b,P):b===r)?b=1:b=zi(b);var U=ni(m)?Me:Vv;return U(m,b)}function Yt(m){var b=ni(m)?He:jv;return b(m)}function gr(m){if(m==null)return 0;if(oa(m))return md(m)?Qu(m):m.length;var b=De(m);return b==mn||b==Vi?m.size:Cl(m).length}function Or(m,b,P){var U=ni(m)?tp:Ig;return P&&hr(m,b,P)&&(b=r),U(m,Qn(b,3))}var Cn=Xi(function(m,b){if(m==null)return[];var P=b.length;return P>1&&hr(m,b[0],b[1])?b=[]:P>2&&hr(b[0],b[1],b[2])&&(b=[b[0]]),Lu(m,pn(b,1),[])}),qr=xh||function(){return Fo.Date.now()};function In(m,b){if(typeof b!="function")throw new Ls(a);return m=zi(m),function(){if(--m<1)return b.apply(this,arguments)}}function tn(m,b,P){return b=P?r:b,b=m&&b==null?m.length:b,Zl(m,Y,r,r,r,r,b)}function hi(m,b){var P;if(typeof b!="function")throw new Ls(a);return m=zi(m),function(){return--m>0&&(P=b.apply(this,arguments)),m<=1&&(b=r),P}}var jn=Xi(function(m,b,P){var U=D;if(P.length){var te=Ns(P,Of(jn));U|=H}return Zl(m,U,b,P,te)}),vn=Xi(function(m,b,P){var U=D|V;if(P.length){var te=Ns(P,Of(vn));U|=H}return Zl(b,U,m,P,te)});function xi(m,b,P){b=P?r:b;var U=Zl(m,F,r,r,r,r,r,b);return U.placeholder=xi.placeholder,U}function ai(m,b,P){b=P?r:b;var U=Zl(m,N,r,r,r,r,r,b);return U.placeholder=ai.placeholder,U}function Bi(m,b,P){var U,te,we,qe,ot,yt,mr=0,yr=!1,Rr=!1,Mn=!0;if(typeof m!="function")throw new Ls(a);b=Bu(b)||0,vo(P)&&(yr=!!P.leading,Rr="maxWait"in P,we=Rr?Bn(Bu(P.maxWait)||0,b):we,Mn="trailing"in P?!!P.trailing:Mn);function Kn(js){var Uh=U,xd=te;return U=te=r,mr=js,qe=m.apply(xd,Uh),qe}function bi(js){return mr=js,ot=Gn(ba,b),yr?Kn(js):qe}function sa(js){var Uh=js-yt,xd=js-mr,rA=b-Uh;return Rr?Ga(rA,we-xd):rA}function wi(js){var Uh=js-yt,xd=js-mr;return yt===r||Uh>=b||Uh<0||Rr&&xd>=we}function ba(){var js=qr();if(wi(js))return ka(js);ot=Gn(ba,sa(js))}function ka(js){return ot=r,Mn&&U?Kn(js):(U=te=r,qe)}function uf(){ot!==r&&Ih(ot),mr=0,U=yt=te=ot=r}function Jl(){return ot===r?qe:ka(qr())}function lf(){var js=qr(),Uh=wi(js);if(U=arguments,te=this,yt=js,Uh){if(ot===r)return bi(yt);if(Rr)return Ih(ot),ot=Gn(ba,b),Kn(yt)}return ot===r&&(ot=Gn(ba,b)),qe}return lf.cancel=uf,lf.flush=Jl,lf}var Rn=Xi(function(m,b){return Fi(m,1,b)}),ta=Xi(function(m,b,P){return Fi(m,Bu(b)||0,P)});function eo(m){return Zl(m,pe)}function to(m,b){if(typeof m!="function"||b!=null&&typeof b!="function")throw new Ls(a);var P=function(){var U=arguments,te=b?b.apply(this,U):U[0],we=P.cache;if(we.has(te))return we.get(te);var qe=m.apply(this,U);return P.cache=we.set(te,qe)||we,qe};return P.cache=new(to.Cache||Pu),P}to.Cache=Pu;function Wa(m){if(typeof m!="function")throw new Ls(a);return function(){var b=arguments;switch(b.length){case 0:return!m.call(this);case 1:return!m.call(this,b[0]);case 2:return!m.call(this,b[0],b[1]);case 3:return!m.call(this,b[0],b[1],b[2])}return!m.apply(this,b)}}function ro(m){return hi(2,m)}var Ao=Ph(function(m,b){b=b.length==1&&ni(b[0])?oo(b[0],Zs(Qn())):oo(pn(b,1),Zs(Qn()));var P=b.length;return Xi(function(U){for(var te=-1,we=Ga(U.length,P);++te<we;)U[te]=b[te].call(this,U[te]);return lo(m,this,U)})}),$o=Xi(function(m,b){var P=Ns(b,Of($o));return Zl(m,H,r,b,P)}),Ko=Xi(function(m,b){var P=Ns(b,Of(Ko));return Zl(m,q,r,b,P)}),iu=Mc(function(m,b){return Zl(m,ee,r,r,r,b)});function xs(m,b){if(typeof m!="function")throw new Ls(a);return b=b===r?b:zi(b),Xi(m,b)}function au(m,b){if(typeof m!="function")throw new Ls(a);return b=b==null?0:Bn(zi(b),0),Xi(function(P){var U=P[b],te=ll(P,0,b);return U&&qu(te,U),lo(m,this,te)})}function ko(m,b,P){var U=!0,te=!0;if(typeof m!="function")throw new Ls(a);return vo(P)&&(U="leading"in P?!!P.leading:U,te="trailing"in P?!!P.trailing:te),Bi(m,b,{leading:U,maxWait:b,trailing:te})}function bs(m){return tn(m,1)}function Ri(m,b){return $o(Mh(b),m)}function La(){if(!arguments.length)return[];var m=arguments[0];return ni(m)?m:[m]}function xa(m){return hn(m,T)}function Yi(m,b){return b=typeof b=="function"?b:r,hn(m,T,b)}function wu(m){return hn(m,x|T)}function zs(m,b){return b=typeof b=="function"?b:r,hn(m,x|T,b)}function Xa(m,b){return b==null||bn(m,b,Vs(b))}function Aa(m,b){return m===b||m!==m&&b!==b}var Us=ld(rl),ra=ld(function(m,b){return m>=b}),Nu=Yl(function(){return arguments}())?Yl:function(m){return mo(m)&&ua.call(m,"callee")&&!Nr.call(m,"callee")},ni=Nt.isArray,Df=qp?Zs(qp):rf;function oa(m){return m!=null&&Lc(m.length)&&!Rc(m)}function Ya(m){return mo(m)&&oa(m)}function Ic(m){return m===!0||m===!1||mo(m)&&da(m)==On}var Ql=wh||wb,pd=Ho?Zs(Ho):nl;function Jd(m){return mo(m)&&m.nodeType===1&&!Bh(m)}function Fh(m){if(m==null)return!0;if(oa(m)&&(ni(m)||typeof m=="string"||typeof m.splice=="function"||Ql(m)||Ff(m)||Nu(m)))return!m.length;var b=De(m);if(b==mn||b==Vi)return!m.size;if(Br(m))return!Cl(m).length;for(var P in m)if(ua.call(m,P))return!1;return!0}function ev(m,b){return il(m,b)}function Jm(m,b,P){P=typeof P=="function"?P:r;var U=P?P(m,b):r;return U===r?il(m,b,r,P):!!U}function Sp(m){if(!mo(m))return!1;var b=da(m);return b==an||b==Ar||typeof m.message=="string"&&typeof m.name=="string"&&!Bh(m)}function im(m){return typeof m=="number"&&Eh(m)}function Rc(m){if(!vo(m))return!1;var b=da(m);return b==Ft||b==Mr||b==Wr||b==ci}function am(m){return typeof m=="number"&&m==zi(m)}function Lc(m){return typeof m=="number"&&m>-1&&m%1==0&&m<=it}function vo(m){var b=typeof m;return m!=null&&(b=="object"||b=="function")}function mo(m){return m!=null&&typeof m=="object"}var Nh=Jh?Zs(Jh):Ro;function tv(m,b){return m===b||yu(m,b,Zd(b))}function e0(m,b,P){return P=typeof P=="function"?P:r,yu(m,b,Zd(b),P)}function t0(m){return rv(m)&&m!=+m}function om(m){if(lr(m))throw new si(o);return Tl(m)}function sm(m){return m===null}function r0(m){return m==null}function rv(m){return typeof m=="number"||mo(m)&&da(m)==Nn}function Bh(m){if(!mo(m)||da(m)!=qn)return!1;var b=ns(m);if(b===null)return!0;var P=ua.call(b,"constructor")&&b.constructor;return typeof P=="function"&&P instanceof P&&yc.call(P)==gh}var dd=Ms?Zs(Ms):Ac;function n0(m){return am(m)&&m>=-it&&m<=it}var vd=zl?Zs(zl):$i;function md(m){return typeof m=="string"||!ni(m)&&mo(m)&&da(m)==za}function ou(m){return typeof m=="symbol"||mo(m)&&da(m)==ia}var Ff=cc?Zs(cc):Bs;function gd(m){return m===r}function um(m){return mo(m)&&De(m)==Ht}function nv(m){return mo(m)&&da(m)==or}var kg=ld(tu),L_=ld(function(m,b){return m<=b});function i0(m){if(!m)return[];if(oa(m))return md(m)?Is(m):ru(m);if(xc&&m[xc])return Qp(m[xc]());var b=De(m),P=b==mn?hh:b==Vi?jl:_d;return P(m)}function Nf(m){if(!m)return m===0?m:0;if(m=Bu(m),m===$e||m===-$e){var b=m<0?-1:1;return b*mt}return m===m?m:0}function zi(m){var b=Nf(m),P=b%1;return b===b?P?b-P:b:0}function k_(m){return m?Ur(zi(m),0,rt):0}function Bu(m){if(typeof m=="number")return m;if(ou(m))return Qe;if(vo(m)){var b=typeof m.valueOf=="function"?m.valueOf():m;m=vo(b)?b+"":b}if(typeof m!="string")return m===0?m:+m;m=Yc(m);var P=Ir.test(m);return P||ii.test(m)?uh(m.slice(2),P?2:8):Kr.test(m)?Qe:+m}function To(m){return ku(m,Os(m))}function sf(m){return m?Ur(zi(m),-it,it):m===0?m:0}function qa(m){return m==null?"":sl(m)}var Ap=yp(function(m,b){if(Br(b)||oa(b)){ku(b,Vs(b),m);return}for(var P in b)ua.call(b,P)&&ct(m,P,b[P])}),a0=yp(function(m,b){ku(b,Os(b),m)}),lm=yp(function(m,b,P,U){ku(b,Os(b),m,U)}),o0=yp(function(m,b,P,U){ku(b,Vs(b),m,U)}),Bf=Mc(_r);function s0(m,b){var P=vs(m);return b==null?P:Ot(P,b)}var cm=Xi(function(m,b){m=Tn(m);var P=-1,U=b.length,te=U>2?b[2]:r;for(te&&hr(b[0],b[1],te)&&(U=1);++P<U;)for(var we=b[P],qe=Os(we),ot=-1,yt=qe.length;++ot<yt;){var mr=qe[ot],yr=m[mr];(yr===r||Aa(yr,Af[mr])&&!ua.call(m,mr))&&(m[mr]=we[mr])}return m}),u0=Xi(function(m){return m.push(r,Ym),lo(yd,r,m)});function l0(m,b){return Ul(m,Qn(b,3),Va)}function Og(m,b){return Ul(m,Qn(b,3),wo)}function O_(m,b){return m==null?m:Ja(m,Qn(b,3),Os)}function fm(m,b){return m==null?m:Ha(m,Qn(b,3),Os)}function D_(m,b){return m&&Va(m,Qn(b,3))}function F_(m,b){return m&&wo(m,Qn(b,3))}function N_(m){return m==null?[]:Ia(m,Vs(m))}function B_(m){return m==null?[]:Ia(m,Os(m))}function c0(m,b,P){var U=m==null?r:Ea(m,b);return U===r?P:U}function kl(m,b){return m!=null&&xt(m,b,ks)}function iv(m,b){return m!=null&&xt(m,b,Iu)}var z_=Zv(function(m,b,P){b!=null&&typeof b.toString!="function"&&(b=_c.call(b)),m[b]=P},gb(kc)),zf=Zv(function(m,b,P){b!=null&&typeof b.toString!="function"&&(b=_c.call(b)),ua.call(m,b)?m[b].push(P):m[b]=[P]},Qn),sb=Xi(gu);function Vs(m){return oa(m)?Re(m):Cl(m)}function Os(m){return oa(m)?Re(m,!0):up(m)}function av(m,b){var P={};return b=Qn(b,3),Va(m,function(U,te,we){sr(P,b(U,te,we),U)}),P}function ov(m,b){var P={};return b=Qn(b,3),Va(m,function(U,te,we){sr(P,te,b(U,te,we))}),P}var sv=yp(function(m,b,P){_u(m,b,P)}),yd=yp(function(m,b,P,U){_u(m,b,P,U)}),U_=Mc(function(m,b){var P={};if(m==null)return P;var U=!1;b=oo(b,function(we){return we=Il(we,m),U||(U=we.length>1),we}),ku(m,em(m),P),U&&(P=hn(P,x|E|T,qm));for(var te=b.length;te--;)Gv(P,b[te]);return P});function V_(m,b){return Dg(m,Wa(Qn(b)))}var j_=Mc(function(m,b){return m==null?{}:gs(m,b)});function Dg(m,b){if(m==null)return{};var P=oo(em(m),function(U){return[U]});return b=Qn(b),rd(m,P,function(U,te){return b(U,te[0])})}function Fg(m,b,P){b=Il(b,m);var U=-1,te=b.length;for(te||(te=1,m=r);++U<te;){var we=m==null?r:m[Jn(b[U])];we===r&&(U=te,we=P),m=Rc(we)?we.call(m):we}return m}function Ng(m,b,P){return m==null?m:ol(m,b,P)}function zh(m,b,P,U){return U=typeof U=="function"?U:r,m==null?m:ol(m,b,P,U)}var Bg=bu(Vs),f0=bu(Os);function zg(m,b,P){var U=ni(m),te=U||Ql(m)||Ff(m);if(b=Qn(b,4),P==null){var we=m&&m.constructor;te?P=U?new we:[]:vo(m)?P=Rc(we)?vs(ns(m)):{}:P={}}return(te?co:Va)(m,function(qe,ot,yt){return b(P,qe,ot,yt)}),P}function $_(m,b){return m==null?!0:Gv(m,b)}function Ug(m,b,P){return m==null?m:Eo(m,b,Mh(P))}function G_(m,b,P,U){return U=typeof U=="function"?U:r,m==null?m:Eo(m,b,Mh(P),U)}function _d(m){return m==null?[]:Kp(m,Vs(m))}function Vg(m){return m==null?[]:Kp(m,Os(m))}function H_(m,b,P){return P===r&&(P=b,b=r),P!==r&&(P=Bu(P),P=P===P?P:0),b!==r&&(b=Bu(b),b=b===b?b:0),Ur(Bu(m),b,P)}function hm(m,b,P){return b=Nf(b),P===r?(P=b,b=0):P=Nf(P),m=Bu(m),mu(m,b,P)}function W_(m,b,P){if(P&&typeof P!="boolean"&&hr(m,b,P)&&(b=P=r),P===r&&(typeof b=="boolean"?(P=b,b=r):typeof m=="boolean"&&(P=m,m=r)),m===r&&b===r?(m=0,b=1):(m=Nf(m),b===r?(b=m,m=0):b=Nf(b)),m>b){var U=m;m=b,b=U}if(P||m%1||b%1){var te=el();return Ga(m+te*(b-m+Yp("1e-"+((te+"").length-1))),b)}return Pf(m,b)}var h0=Rl(function(m,b,P){return b=b.toLowerCase(),m+(P?X_(b):b)});function X_(m){return mb(qa(m).toLowerCase())}function jg(m){return m=qa(m),m&&m.replace(fi,wf).replace(Qh,"")}function ub(m,b,P){m=qa(m),b=sl(b);var U=m.length;P=P===r?U:Ur(zi(P),0,U);var te=P;return P-=b.length,P>=0&&m.slice(P,te)==b}function lb(m){return m=qa(m),m&&Su.test(m)?m.replace(Fs,wl):m}function cb(m){return m=qa(m),m&&nt.test(m)?m.replace(Ke,"\\$&"):m}var fb=Rl(function(m,b,P){return m+(P?"-":"")+b.toLowerCase()}),hb=Rl(function(m,b,P){return m+(P?" ":"")+b.toLowerCase()}),pb=Yv("toLowerCase");function db(m,b,P){m=qa(m),b=zi(b);var U=b?Qu(m):0;if(!b||U>=b)return m;var te=(b-U)/2;return xp(bh(te),P)+m+xp(Cu(te),P)}function vb(m,b,P){m=qa(m),b=zi(b);var U=b?Qu(m):0;return b&&U<b?m+xp(b-U,P):m}function Uf(m,b,P){m=qa(m),b=zi(b);var U=b?Qu(m):0;return b&&U<b?xp(b-U,P)+m:m}function p0(m,b,P){return P||b==null?b=0:b&&(b=+b),is(qa(m).replace(de,""),b||0)}function Y_(m,b,P){return(P?hr(m,b,P):b===r)?b=1:b=zi(b),id(qa(m),b)}function pm(){var m=arguments,b=qa(m[0]);return m.length<3?b:b.replace(m[1],m[2])}var q_=Rl(function(m,b,P){return m+(P?"_":"")+b.toLowerCase()});function NO(m,b,P){return P&&typeof P!="number"&&hr(m,b,P)&&(b=P=r),P=P===r?rt:P>>>0,P?(m=qa(m),m&&(typeof b=="string"||b!=null&&!dd(b))&&(b=sl(b),!b&&cu(m))?ll(Is(m),0,P):m.split(b,P)):[]}var BO=Rl(function(m,b,P){return m+(P?" ":"")+mb(b)});function zO(m,b,P){return m=qa(m),P=P==null?0:Ur(zi(P),0,m.length),b=sl(b),m.slice(P,P+b.length)==b}function UO(m,b,P){var U=me.templateSettings;P&&hr(m,b,P)&&(b=r),m=qa(m),b=lm({},b,U,Qv);var te=lm({},b.imports,U.imports,Qv),we=Vs(te),qe=Kp(te,we),ot,yt,mr=0,yr=b.interpolate||Oi,Rr="__p += '",Mn=ya((b.escape||Oi).source+"|"+yr.source+"|"+(yr===re?nn:Oi).source+"|"+(b.evaluate||Oi).source+"|$","g"),Kn="//# sourceURL="+(ua.call(b,"sourceURL")?(b.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++uc+"]")+`
`;m.replace(Mn,function(wi,ba,ka,uf,Jl,lf){return ka||(ka=uf),Rr+=m.slice(mr,lf).replace(oi,mc),ba&&(ot=!0,Rr+=`' +
__e(`+ba+`) +
'`),Jl&&(yt=!0,Rr+=`';
`+Jl+`;
__p += '`),ka&&(Rr+=`' +
((__t = (`+ka+`)) == null ? '' : __t) +
'`),mr=lf+wi.length,wi}),Rr+=`';
`;var bi=ua.call(b,"variable")&&b.variable;if(!bi)Rr=`with (obj) {
`+Rr+`
}
`;else if(ir.test(bi))throw new si(u);Rr=(yt?Rr.replace(ki,""):Rr).replace(uo,"$1").replace(go,"$1;"),Rr="function("+(bi||"obj")+`) {
`+(bi?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(ot?", __e = _.escape":"")+(yt?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+Rr+`return __p
}`;var sa=eA(function(){return ji(we,Kn+"return "+Rr).apply(r,qe)});if(sa.source=Rr,Sp(sa))throw sa;return sa}function VO(m){return qa(m).toLowerCase()}function jO(m){return qa(m).toUpperCase()}function $O(m,b,P){if(m=qa(m),m&&(P||b===r))return Yc(m);if(!m||!(b=sl(b)))return m;var U=Is(m),te=Is(b),we=qc(U,te),qe=bl(U,te)+1;return ll(U,we,qe).join("")}function GO(m,b,P){if(m=qa(m),m&&(P||b===r))return m.slice(0,Ef(m)+1);if(!m||!(b=sl(b)))return m;var U=Is(m),te=bl(U,Is(b))+1;return ll(U,0,te).join("")}function HO(m,b,P){if(m=qa(m),m&&(P||b===r))return m.replace(de,"");if(!m||!(b=sl(b)))return m;var U=Is(m),te=qc(U,Is(b));return ll(U,te).join("")}function WO(m,b){var P=ue,U=ie;if(vo(b)){var te="separator"in b?b.separator:te;P="length"in b?zi(b.length):P,U="omission"in b?sl(b.omission):U}m=qa(m);var we=m.length;if(cu(m)){var qe=Is(m);we=qe.length}if(P>=we)return m;var ot=P-Qu(U);if(ot<1)return U;var yt=qe?ll(qe,0,ot).join(""):m.slice(0,ot);if(te===r)return yt+U;if(qe&&(ot+=yt.length-ot),dd(te)){if(m.slice(ot).search(te)){var mr,yr=yt;for(te.global||(te=ya(te.source,qa(Dt.exec(te))+"g")),te.lastIndex=0;mr=te.exec(yr);)var Rr=mr.index;yt=yt.slice(0,Rr===r?ot:Rr)}}else if(m.indexOf(sl(te),ot)!=ot){var Mn=yt.lastIndexOf(te);Mn>-1&&(yt=yt.slice(0,Mn))}return yt+U}function XO(m){return m=qa(m),m&&Ss.test(m)?m.replace(yo,Sf):m}var YO=Rl(function(m,b,P){return m+(P?" ":"")+b.toUpperCase()}),mb=Yv("toUpperCase");function JS(m,b,P){return m=qa(m),b=P?r:b,b===r?fu(m)?Jp(m):wa(m):m.match(b)||[]}var eA=Xi(function(m,b){try{return lo(m,r,b)}catch(P){return Sp(P)?P:new si(P)}}),qO=Mc(function(m,b){return co(b,function(P){P=Jn(P),sr(m,P,jn(m[P],m))}),m});function ZO(m){var b=m==null?0:m.length,P=Qn();return m=b?oo(m,function(U){if(typeof U[1]!="function")throw new Ls(a);return[P(U[0]),U[1]]}):[],Xi(function(U){for(var te=-1;++te<b;){var we=m[te];if(lo(we[0],this,U))return lo(we[1],this,U)}})}function KO(m){return An(hn(m,x))}function gb(m){return function(){return m}}function QO(m,b){return m==null||m!==m?b:m}var JO=Ll(),eD=Ll(!0);function kc(m){return m}function yb(m){return zo(typeof m=="function"?m:hn(m,x))}function tD(m){return Ru(hn(m,x))}function rD(m,b){return nf(m,hn(b,x))}var nD=Xi(function(m,b){return function(P){return gu(P,m,b)}}),iD=Xi(function(m,b){return function(P){return gu(m,P,b)}});function _b(m,b,P){var U=Vs(b),te=Ia(b,U);P==null&&!(vo(b)&&(te.length||!U.length))&&(P=b,b=m,m=this,te=Ia(b,Vs(b)));var we=!(vo(P)&&"chain"in P)||!!P.chain,qe=Rc(m);return co(te,function(ot){var yt=b[ot];m[ot]=yt,qe&&(m.prototype[ot]=function(){var mr=this.__chain__;if(we||mr){var yr=m(this.__wrapped__),Rr=yr.__actions__=ru(this.__actions__);return Rr.push({func:yt,args:arguments,thisArg:m}),yr.__chain__=mr,yr}return yt.apply(m,qu([this.value()],arguments))})}),m}function aD(){return Fo._===this&&(Fo._=la),this}function xb(){}function oD(m){return m=zi(m),Xi(function(b){return Tc(b,m)})}var sD=Ou(oo),uD=Ou(qs),lD=Ou(tp);function tA(m){return ar(m)?Ku(Jn(m)):lp(m)}function cD(m){return function(b){return m==null?r:Ea(m,b)}}var fD=ud(),hD=ud(!0);function bb(){return[]}function wb(){return!1}function pD(){return{}}function dD(){return""}function vD(){return!0}function mD(m,b){if(m=zi(m),m<1||m>it)return[];var P=rt,U=Ga(m,rt);b=Qn(b),m-=rt;for(var te=vc(U,b);++P<m;)b(P);return te}function gD(m){return ni(m)?oo(m,Jn):ou(m)?[m]:ru(Wn(qa(m)))}function yD(m){var b=++El;return qa(m)+b}var _D=of(function(m,b){return m+b},0),xD=ql("ceil"),bD=of(function(m,b){return m/b},1),wD=ql("floor");function ED(m){return m&&m.length?Fn(m,kc,rl):r}function SD(m,b){return m&&m.length?Fn(m,Qn(b,2),rl):r}function AD(m){return Vl(m,kc)}function TD(m,b){return Vl(m,Qn(b,2))}function CD(m){return m&&m.length?Fn(m,kc,tu):r}function MD(m,b){return m&&m.length?Fn(m,Qn(b,2),tu):r}var PD=of(function(m,b){return m*b},1),ID=ql("round"),RD=of(function(m,b){return m-b},0);function LD(m){return m&&m.length?pa(m,kc):0}function kD(m,b){return m&&m.length?pa(m,Qn(b,2)):0}return me.after=In,me.ary=tn,me.assign=Ap,me.assignIn=a0,me.assignInWith=lm,me.assignWith=o0,me.at=Bf,me.before=hi,me.bind=jn,me.bindAll=qO,me.bindKey=vn,me.castArray=La,me.chain=nm,me.chunk=ss,me.compact=Ba,me.concat=Uo,me.cond=ZO,me.conforms=KO,me.constant=gb,me.countBy=s,me.create=s0,me.curry=xi,me.curryRight=ai,me.debounce=Bi,me.defaults=cm,me.defaultsDeep=u0,me.defer=Rn,me.delay=ta,me.difference=Lo,me.differenceBy=us,me.differenceWith=ls,me.drop=ys,me.dropRight=so,me.dropRightWhile=ui,me.dropWhile=Vo,me.fill=Zi,me.filter=f,me.flatMap=S,me.flatMapDeep=C,me.flatMapDepth=L,me.flatten=yi,me.flattenDeep=Sa,me.flattenDepth=jo,me.flip=eo,me.flow=JO,me.flowRight=eD,me.fromPairs=Du,me.functions=N_,me.functionsIn=B_,me.groupBy=W,me.initial=pt,me.intersection=en,me.intersectionBy=_i,me.intersectionWith=Ae,me.invert=z_,me.invertBy=zf,me.invokeMap=ne,me.iteratee=yb,me.keyBy=le,me.keys=Vs,me.keysIn=Os,me.map=Ie,me.mapKeys=av,me.mapValues=ov,me.matches=tD,me.matchesProperty=rD,me.memoize=to,me.merge=sv,me.mergeWith=yd,me.method=nD,me.methodOf=iD,me.mixin=_b,me.negate=Wa,me.nthArg=oD,me.omit=U_,me.omitBy=V_,me.once=ro,me.orderBy=ke,me.over=sD,me.overArgs=Ao,me.overEvery=uD,me.overSome=lD,me.partial=$o,me.partialRight=Ko,me.partition=Ze,me.pick=j_,me.pickBy=Dg,me.property=tA,me.propertyOf=cD,me.pull=Je,me.pullAll=We,me.pullAllBy=tt,me.pullAllWith=he,me.pullAt=je,me.range=fD,me.rangeRight=hD,me.rearg=iu,me.reject=vt,me.remove=Te,me.rest=xs,me.reverse=at,me.sampleSize=It,me.set=Ng,me.setWith=zh,me.shuffle=Yt,me.slice=dt,me.sortBy=Cn,me.sortedUniq=Qr,me.sortedUniqBy=un,me.split=NO,me.spread=au,me.tail=ln,me.take=fn,me.takeRight=Un,me.takeRightWhile=aa,me.takeWhile=qo,me.tap=Qm,me.throttle=ko,me.thru=Kd,me.toArray=i0,me.toPairs=Bg,me.toPairsIn=f0,me.toPath=gD,me.toPlainObject=To,me.transform=zg,me.unary=bs,me.union=Fu,me.unionBy=Pc,me.unionWith=Ra,me.uniq=Pi,me.uniqBy=Kl,me.uniqWith=fl,me.unset=$_,me.unzip=cd,me.unzipWith=hl,me.update=Ug,me.updateWith=G_,me.values=_d,me.valuesIn=Vg,me.without=tm,me.words=JS,me.wrap=Ri,me.xor=Lg,me.xorBy=fd,me.xorWith=hd,me.zip=M_,me.zipObject=Zo,me.zipObjectDeep=rm,me.zipWith=Oh,me.entries=Bg,me.entriesIn=f0,me.extend=a0,me.extendWith=lm,_b(me,me),me.add=_D,me.attempt=eA,me.camelCase=h0,me.capitalize=X_,me.ceil=xD,me.clamp=H_,me.clone=xa,me.cloneDeep=wu,me.cloneDeepWith=zs,me.cloneWith=Yi,me.conformsTo=Xa,me.deburr=jg,me.defaultTo=QO,me.divide=bD,me.endsWith=ub,me.eq=Aa,me.escape=lb,me.escapeRegExp=cb,me.every=l,me.find=g,me.findIndex=So,me.findKey=l0,me.findLast=w,me.findLastIndex=kn,me.findLastKey=Og,me.floor=wD,me.forEach=z,me.forEachRight=$,me.forIn=O_,me.forInRight=fm,me.forOwn=D_,me.forOwnRight=F_,me.get=c0,me.gt=Us,me.gte=ra,me.has=kl,me.hasIn=iv,me.head=Pe,me.identity=kc,me.includes=K,me.indexOf=St,me.inRange=hm,me.invoke=sb,me.isArguments=Nu,me.isArray=ni,me.isArrayBuffer=Df,me.isArrayLike=oa,me.isArrayLikeObject=Ya,me.isBoolean=Ic,me.isBuffer=Ql,me.isDate=pd,me.isElement=Jd,me.isEmpty=Fh,me.isEqual=ev,me.isEqualWith=Jm,me.isError=Sp,me.isFinite=im,me.isFunction=Rc,me.isInteger=am,me.isLength=Lc,me.isMap=Nh,me.isMatch=tv,me.isMatchWith=e0,me.isNaN=t0,me.isNative=om,me.isNil=r0,me.isNull=sm,me.isNumber=rv,me.isObject=vo,me.isObjectLike=mo,me.isPlainObject=Bh,me.isRegExp=dd,me.isSafeInteger=n0,me.isSet=vd,me.isString=md,me.isSymbol=ou,me.isTypedArray=Ff,me.isUndefined=gd,me.isWeakMap=um,me.isWeakSet=nv,me.join=fe,me.kebabCase=fb,me.last=Ue,me.lastIndexOf=ut,me.lowerCase=hb,me.lowerFirst=pb,me.lt=kg,me.lte=L_,me.max=ED,me.maxBy=SD,me.mean=AD,me.meanBy=TD,me.min=CD,me.minBy=MD,me.stubArray=bb,me.stubFalse=wb,me.stubObject=pD,me.stubString=dD,me.stubTrue=vD,me.multiply=PD,me.nth=Et,me.noConflict=aD,me.noop=xb,me.now=qr,me.pad=db,me.padEnd=vb,me.padStart=Uf,me.parseInt=p0,me.random=W_,me.reduce=Ve,me.reduceRight=st,me.repeat=Y_,me.replace=pm,me.result=Fg,me.round=ID,me.runInContext=ft,me.sample=Tt,me.size=gr,me.snakeCase=q_,me.some=Or,me.sortedIndex=Qt,me.sortedIndexBy=Tr,me.sortedIndexOf=Cr,me.sortedLastIndex=Hr,me.sortedLastIndexBy=wr,me.sortedLastIndexOf=dn,me.startCase=BO,me.startsWith=zO,me.subtract=RD,me.sum=LD,me.sumBy=kD,me.template=UO,me.times=mD,me.toFinite=Nf,me.toInteger=zi,me.toLength=k_,me.toLower=VO,me.toNumber=Bu,me.toSafeInteger=sf,me.toString=qa,me.toUpper=jO,me.trim=$O,me.trimEnd=GO,me.trimStart=HO,me.truncate=WO,me.unescape=XO,me.uniqueId=yD,me.upperCase=YO,me.upperFirst=mb,me.each=z,me.eachRight=$,me.first=Pe,_b(me,function(){var m={};return Va(me,function(b,P){ua.call(me.prototype,P)||(m[P]=b)}),m}(),{chain:!1}),me.VERSION=n,co(["bind","bindKey","curry","curryRight","partial","partialRight"],function(m){me[m].placeholder=me}),co(["drop","take"],function(m,b){mi.prototype[m]=function(P){P=P===r?1:Bn(zi(P),0);var U=this.__filtered__&&!b?new mi(this):this.clone();return U.__filtered__?U.__takeCount__=Ga(P,U.__takeCount__):U.__views__.push({size:Ga(P,rt),type:m+(U.__dir__<0?"Right":"")}),U},mi.prototype[m+"Right"]=function(P){return this.reverse()[m](P).reverse()}}),co(["filter","map","takeWhile"],function(m,b){var P=b+1,U=P==Ne||P==Be;mi.prototype[m]=function(te){var we=this.clone();return we.__iteratees__.push({iteratee:Qn(te,3),type:P}),we.__filtered__=we.__filtered__||U,we}}),co(["head","last"],function(m,b){var P="take"+(b?"Right":"");mi.prototype[m]=function(){return this[P](1).value()[0]}}),co(["initial","tail"],function(m,b){var P="drop"+(b?"":"Right");mi.prototype[m]=function(){return this.__filtered__?new mi(this):this[P](1)}}),mi.prototype.compact=function(){return this.filter(kc)},mi.prototype.find=function(m){return this.filter(m).head()},mi.prototype.findLast=function(m){return this.reverse().find(m)},mi.prototype.invokeMap=Xi(function(m,b){return typeof m=="function"?new mi(this):this.map(function(P){return gu(P,m,b)})}),mi.prototype.reject=function(m){return this.filter(Wa(Qn(m)))},mi.prototype.slice=function(m,b){m=zi(m);var P=this;return P.__filtered__&&(m>0||b<0)?new mi(P):(m<0?P=P.takeRight(-m):m&&(P=P.drop(m)),b!==r&&(b=zi(b),P=b<0?P.dropRight(-b):P.take(b-m)),P)},mi.prototype.takeRightWhile=function(m){return this.reverse().takeWhile(m).reverse()},mi.prototype.toArray=function(){return this.take(rt)},Va(mi.prototype,function(m,b){var P=/^(?:filter|find|map|reject)|While$/.test(b),U=/^(?:head|last)$/.test(b),te=me[U?"take"+(b=="last"?"Right":""):b],we=U||/^find/.test(b);te&&(me.prototype[b]=function(){var qe=this.__wrapped__,ot=U?[1]:arguments,yt=qe instanceof mi,mr=ot[0],yr=yt||ni(qe),Rr=function(ba){var ka=te.apply(me,qu([ba],ot));return U&&Mn?ka[0]:ka};yr&&P&&typeof mr=="function"&&mr.length!=1&&(yt=yr=!1);var Mn=this.__chain__,Kn=!!this.__actions__.length,bi=we&&!Mn,sa=yt&&!Kn;if(!we&&yr){qe=sa?qe:new mi(this);var wi=m.apply(qe,ot);return wi.__actions__.push({func:Kd,args:[Rr],thisArg:r}),new os(wi,Mn)}return bi&&sa?m.apply(this,ot):(wi=this.thru(Rr),bi?U?wi.value()[0]:wi.value():wi)})}),co(["pop","push","shift","sort","splice","unshift"],function(m){var b=$l[m],P=/^(?:push|sort|unshift)$/.test(m)?"tap":"thru",U=/^(?:pop|shift)$/.test(m);me.prototype[m]=function(){var te=arguments;if(U&&!this.__chain__){var we=this.value();return b.apply(ni(we)?we:[],te)}return this[P](function(qe){return b.apply(ni(qe)?qe:[],te)})}}),Va(mi.prototype,function(m,b){var P=me[b];if(P){var U=P.name+"";ua.call(ds,U)||(ds[U]=[]),ds[U].push({name:b,func:P})}}),ds[cl(r,V).name]=[{name:"wrapper",func:r}],mi.prototype.clone=Sh,mi.prototype.reverse=Qc,mi.prototype.value=Ah,me.prototype.at=Qd,me.prototype.chain=Dh,me.prototype.commit=P_,me.prototype.next=I_,me.prototype.plant=_s,me.prototype.reverse=Ep,me.prototype.toJSON=me.prototype.valueOf=me.prototype.value=R_,me.prototype.first=me.prototype.head,xc&&(me.prototype[xc]=ob),me},gc=vh();lc?((lc.exports=gc)._=gc,lh._=gc):Fo._=gc}).call(mf)})(H1,H1.exports);var Er=H1.exports;function xF(e){var t=e;return typeof e=="string"&&(t=ja.document.getElementById(e)),t}function kI(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function OI(e){return kI(e).split(/\s+/)}function bF(e){var t,r,n=ja==null||(t=ja.document)===null||t===void 0||(r=t.documentElement)===null||r===void 0?void 0:r.style;if(!n)return e[0];for(var i in e)if(e[i]&&e[i]in n)return e[i];return e[0]}function $u(e,t,r){var n=ja.document.createElement(e);return t&&(n.className=t||""),r&&r.appendChild(n),n}function Td(e){var t=e.parentNode;t&&t.removeChild(e)}function Im(e,t){if(e.classList!==void 0)for(var r=OI(t),n=0,i=r.length;n<i;n++)e.classList.add(r[n]);else if(!wF(e,t)){var o=UE(e);DI(e,(o?o+" ":"")+t)}}function W1(e,t){if(e.classList!==void 0){var r=OI(t);r.forEach(function(n){e.classList.remove(n)})}else DI(e,kI((" "+UE(e)+" ").replace(" "+t+" "," ")))}function wF(e,t){if(e.classList!==void 0)return e.classList.contains(t);var r=UE(e);return r.length>0&&new RegExp("(^|\\s)"+t+"(\\s|$)").test(r)}function DI(e,t){e instanceof HTMLElement?e.className=t:e.className.baseVal=t}function UE(e){return e instanceof SVGElement&&(e=e.correspondingElement),e.className.baseVal===void 0?e.className:e.className.baseVal}var EF=bF(["transform","WebkitTransform"]);function SF(e,t){e.style[EF]=t}function AF(){if(typeof Event=="function")ja.dispatchEvent(new Event("resize"));else{var e=ja.document.createEvent("UIEvents");e.initUIEvent("resize",!0,!1,ja,0),ja.dispatchEvent(e)}}function TF(){var e,t=ja.document.querySelector('meta[name="viewport"]');if(!t)return 1;var r=(e=t.content)===null||e===void 0?void 0:e.split(","),n=r.find(function(i){var o=i.split("="),a=ei(o,1),u=a[0];return u==="initial-scale"});return n?n.split("=")[1]*1:1}var ws=TF()<1?1:ja.devicePixelRatio;function CF(e,t){e.setAttribute("style","".concat(e.style.cssText).concat(t))}function MF(e){return Object.entries(e).map(function(t){var r=ei(t,2),n=r[0],i=r[1];return"".concat(n,": ").concat(i)}).join(";")}function PF(e,t){return{left:e.left-t.left,top:e.top-t.top,right:t.left+t.width-e.left-e.width,bottom:t.top+t.height-e.top-e.height}}function VE(e){e.innerHTML=""}function IF(e){e.setAttribute("draggable","false")}function RA(e,t){if(typeof t=="string"){var r=document.createElement("div");for(r.innerHTML=t;r.firstChild;)e.append(r.firstChild)}else Array.isArray(t)?e.append.apply(e,cn(t)):e.append(t)}var Fb;function RF(e){return typeof ImageBitmap<"u"&&e instanceof ImageBitmap}var ew=(Fb=navigator)===null||Fb===void 0?void 0:Fb.userAgent;ew.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);ew.indexOf("Android")>-1||ew.indexOf("Adr")>-1;function By(e){var t=[1/0,1/0,-1/0,-1/0];return Nd(e,function(r){t[0]>r[0]&&(t[0]=r[0]),t[1]>r[1]&&(t[1]=r[1]),t[2]<r[0]&&(t[2]=r[0]),t[3]<r[1]&&(t[3]=r[1])}),t}By.default=By;const LF=Object.freeze(Object.defineProperty({__proto__:null,default:By},Symbol.toStringTag,{value:"Module"}));function Nb(e){return typeof e=="number"}var X1=2*Math.PI*6378137/2;function kF(e,t){var r=ei(t,4),n=r[0],i=r[1],o=r[2],a=r[3];return e.lng>n&&e.lng<=o&&e.lat>i&&e.lat<=a}function OF(e){var t=[1/0,1/0,-1/0,-1/0];return e.forEach(function(r){var n=r.coordinates;FI(t,n)}),t}function FI(e,t){return Array.isArray(t[0])?t.forEach(function(r){FI(e,r)}):(e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1])),e}function C1(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{enable:!0,decimal:1};e=NF(e,t);var n=e[0],i=e[1],o=n*X1/180,a=Math.log(Math.tan((90+i)*Math.PI/360))/(Math.PI/180);return a=a*X1/180,r.enable&&(o=Number(o.toFixed(r.decimal)),a=Number(a.toFixed(r.decimal))),e.length===3?[o,a,e[2]]:[o,a]}function Bb(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,r=e[0],n=e[1],i=r/X1*180,o=n/X1*180;return o=180/Math.PI*(2*Math.atan(Math.exp(o*Math.PI/180))-Math.PI/2),t!=null&&(i=Number(i.toFixed(t)),o=Number(o.toFixed(t))),e.length===3?[i,o,e[2]]:[i,o]}function DF(e){if(e==null)throw new Error("lng is required");return(e>180||e<-180)&&(e=e%360,e>180&&(e=-360+e),e<-180&&(e=360+e),e===0&&(e=0)),e}function FF(e){if(e==null)throw new Error("lat is required");return(e>90||e<-90)&&(e=e%180,e>90&&(e=-180+e),e<-90&&(e=180+e),e===0&&(e=0)),e}function NF(e,t){if(t===!1)return e;var r=DF(e[0]),n=FF(e[1]);return n>85&&(n=85),n<-85&&(n=-85),e.length===3?[r,n,e[2]]:[r,n]}function Vu(e){var t=85.0511287798,r=Math.max(Math.min(t,e[1]),-t),n=256<<20,i=Math.PI/180,o=e[0]*i,a=r*i;a=Math.log(Math.tan(Math.PI/4+a/2));var u=.5/Math.PI,c=.5,h=-.5/Math.PI;return i=.5,o=n*(u*o+c),a=n*(h*a+i),[Math.floor(o),Math.floor(a)]}function jE(e,t){var r=Math.abs(e[1][1]-e[0][1])*t,n=Math.abs(e[1][0]-e[0][0])*t;return[[e[0][0]-n,e[0][1]-r],[e[1][0]+n,e[1][1]+r]]}function NI(e,t){return e[0][0]<=t[0][0]&&e[0][1]<=t[0][1]&&e[1][0]>=t[1][0]&&e[1][1]>=t[1][1]}function Y1(e){return[[e[0],e[1]],[e[2],e[3]]]}function BI(e){var t=BF(e,[0,0]);return[e[0]/t,e[1]/t]}function BF(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}function Id(e){if(Nb(e[0]))return e;if(Nb(e[0][0]))throw new Error("当前数据不支持标注");if(Nb(e[0][0][0])){var t=e,r=0,n=0,i=0;return t.forEach(function(o){o.forEach(function(a){r+=a[0],n+=a[1],i++})}),[r/i,n/i,0]}else throw new Error("当前数据不支持标注")}function zF(e){for(var t=e[0],r=e[1],n=e[0],i=e[1],o=0,a=0,u=0,c=0;c<e.length;c+=2){var h=e[c],y=e[c+1];h&&y&&(t=Math.max(h,t),r=Math.max(y,r),n=Math.min(h,n),i=Math.min(y,i),o+=h,a+=y,u++)}return{center:[o/u,a/u],radius:Math.sqrt(Math.pow(t-n,2)+Math.pow(r-i,2))/2}}function UF(e){return By(Qo([yl(e)]))}function VF(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,r=e==="x"?t:t&3|8;return r.toString(16)})}var jF=function(){function e(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,r=arguments.length>1?arguments[1]:void 0;$t(this,e),this.limit=t,this.destroy=r||this.defaultDestroy,this.order=[],this.clear()}return Gt(e,[{key:"clear",value:function(){var r=this;this.order.forEach(function(n){r.delete(n)}),this.cache={},this.order=[]}},{key:"get",value:function(r){var n=this.cache[r];return n&&(this.deleteOrder(r),this.appendOrder(r)),n}},{key:"set",value:function(r,n){this.cache[r]?(this.delete(r),this.cache[r]=n,this.appendOrder(r)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[r]=n,this.appendOrder(r))}},{key:"delete",value:function(r){var n=this.cache[r];n&&(this.deleteCache(r),this.deleteOrder(r),this.destroy(n,r))}},{key:"deleteCache",value:function(r){delete this.cache[r]}},{key:"deleteOrder",value:function(r){var n=this.order.findIndex(function(i){return i===r});n>=0&&this.order.splice(n,1)}},{key:"appendOrder",value:function(r){this.order.push(r)}},{key:"defaultDestroy",value:function(r,n){return null}}]),e}();function $F(e){if(e.length===0)throw new Error("max requires at least one data point");for(var t=e[0],r=1;r<e.length;r++)e[r]>t&&(t=e[r]);return t*1}function GF(e){if(e.length===0)throw new Error("min requires at least one data point");for(var t=e[0],r=1;r<e.length;r++)e[r]<t&&(t=e[r]);return t*1}function zI(e){if(e.length===0)return 0;for(var t=e[0]*1,r=1;r<e.length;r++)t+=e[r]*1;return t}function HF(e){if(e.length===0)throw new Error("mean requires at least one data point");return zI(e)/e.length}function WF(e){if(e.length===0)throw new Error("mean requires at least one data point");if(e.length<3)return e[0];e.sort();for(var t=e[0],r=NaN,n=0,i=1,o=1;o<e.length+1;o++)e[o]!==t?(i>n&&(n=i,r=t),i=1,t=e[o]):i++;return r*1}var UI={min:GF,max:$F,mean:HF,sum:zI,mode:WF};function VI(e,t){return e.map(function(r){return r[t]})}function XF(e,t){t===void 0&&(t={});var r=Number(e[0]),n=Number(e[1]),i=Number(e[2]),o=Number(e[3]);if(e.length===6)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var a=[r,n],u=[r,o],c=[i,o],h=[i,n];return Um([[a,h,c,u,a]],t.properties,{bbox:e,id:t.id})}var jI={exports:{}};(function(e){var t=Object.prototype.hasOwnProperty,r="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(r=!1));function i(c,h,y){this.fn=c,this.context=h,this.once=y||!1}function o(c,h,y,x,E){if(typeof y!="function")throw new TypeError("The listener must be a function");var T=new i(y,x||c,E),I=r?r+h:h;return c._events[I]?c._events[I].fn?c._events[I]=[c._events[I],T]:c._events[I].push(T):(c._events[I]=T,c._eventsCount++),c}function a(c,h){--c._eventsCount===0?c._events=new n:delete c._events[h]}function u(){this._events=new n,this._eventsCount=0}u.prototype.eventNames=function(){var h=[],y,x;if(this._eventsCount===0)return h;for(x in y=this._events)t.call(y,x)&&h.push(r?x.slice(1):x);return Object.getOwnPropertySymbols?h.concat(Object.getOwnPropertySymbols(y)):h},u.prototype.listeners=function(h){var y=r?r+h:h,x=this._events[y];if(!x)return[];if(x.fn)return[x.fn];for(var E=0,T=x.length,I=new Array(T);E<T;E++)I[E]=x[E].fn;return I},u.prototype.listenerCount=function(h){var y=r?r+h:h,x=this._events[y];return x?x.fn?1:x.length:0},u.prototype.emit=function(h,y,x,E,T,I){var k=r?r+h:h;if(!this._events[k])return!1;var D=this._events[k],V=arguments.length,O,F;if(D.fn){switch(D.once&&this.removeListener(h,D.fn,void 0,!0),V){case 1:return D.fn.call(D.context),!0;case 2:return D.fn.call(D.context,y),!0;case 3:return D.fn.call(D.context,y,x),!0;case 4:return D.fn.call(D.context,y,x,E),!0;case 5:return D.fn.call(D.context,y,x,E,T),!0;case 6:return D.fn.call(D.context,y,x,E,T,I),!0}for(F=1,O=new Array(V-1);F<V;F++)O[F-1]=arguments[F];D.fn.apply(D.context,O)}else{var N=D.length,H;for(F=0;F<N;F++)switch(D[F].once&&this.removeListener(h,D[F].fn,void 0,!0),V){case 1:D[F].fn.call(D[F].context);break;case 2:D[F].fn.call(D[F].context,y);break;case 3:D[F].fn.call(D[F].context,y,x);break;case 4:D[F].fn.call(D[F].context,y,x,E);break;default:if(!O)for(H=1,O=new Array(V-1);H<V;H++)O[H-1]=arguments[H];D[F].fn.apply(D[F].context,O)}}return!0},u.prototype.on=function(h,y,x){return o(this,h,y,x,!1)},u.prototype.once=function(h,y,x){return o(this,h,y,x,!0)},u.prototype.removeListener=function(h,y,x,E){var T=r?r+h:h;if(!this._events[T])return this;if(!y)return a(this,T),this;var I=this._events[T];if(I.fn)I.fn===y&&(!E||I.once)&&(!x||I.context===x)&&a(this,T);else{for(var k=0,D=[],V=I.length;k<V;k++)(I[k].fn!==y||E&&!I[k].once||x&&I[k].context!==x)&&D.push(I[k]);D.length?this._events[T]=D.length===1?D[0]:D:a(this,T)}return this},u.prototype.removeAllListeners=function(h){var y;return h?(y=r?r+h:h,this._events[y]&&a(this,y)):(this._events=new n,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=r,u.EventEmitter=u,e.exports=u})(jI);var tc=jI.exports;const Cg=jc(tc);var M1=function(e){return e.Realtime="realtime",e.Overlap="overlap",e.Replace="replace",e}({}),Vh=function(e){return e.Loading="Loading",e.Loaded="Loaded",e.Failure="Failure",e.Cancelled="Cancelled",e}({}),$I=0,LA=1,Dx=2;function YF(e){e.forEach(function(t){t.isCurrent&&(t.isVisible=t.isLoaded)})}function qF(e){e.forEach(function(t){t.properties.state=$I}),e.forEach(function(t){t.isCurrent&&!GI(t)&&$E(t)}),e.forEach(function(t){t.isVisible=!!(t.properties.state&Dx)})}function ZF(e){e.forEach(function(r){r.properties.state=$I}),e.forEach(function(r){r.isCurrent&&GI(r)});var t=e.slice().sort(function(r,n){return r.z-n.z});t.forEach(function(r){r.isVisible=!!(r.properties.state&Dx),r.children.length&&(r.isVisible||r.properties.state&LA)?r.children.forEach(function(n){n.properties.state=LA}):r.isCurrent&&$E(r)})}function GI(e){for(;e;){if(e.isLoaded)return e.properties.state|=Dx,!0;e=e.parent}return!1}function $E(e){e.children.forEach(function(t){t.isLoaded?t.properties.state|=Dx:$E(t)})}var Wg,HI=[-1/0,-1/0,1/0,1/0],KF=.2,QF=5,JF=(Wg={},Q(Wg,M1.Realtime,YF),Q(Wg,M1.Overlap,qF),Q(Wg,M1.Replace,ZF),Wg),e7=function(){};function tw(e,t,r){var n=Math.floor((e+180)/360*Math.pow(2,r)),i=Math.floor((1-Math.log(Math.tan(t*Math.PI/180)+1/Math.cos(t*Math.PI/180))/Math.PI)/2*Math.pow(2,r));return[n,i]}function kA(e,t,r){var n=e/Math.pow(2,r)*360-180,i=Math.PI-2*Math.PI*t/Math.pow(2,r),o=180/Math.PI*Math.atan(.5*(Math.exp(i)-Math.exp(-i)));return[n,o]}var WI=function(t,r,n){var i=kA(t,r,n),o=ei(i,2),a=o[0],u=o[1],c=kA(t+1,r+1,n),h=ei(c,2),y=h[0],x=h[1];return[a,x,y,u]};function t7(e){var t=e.zoom,r=e.latLonBounds,n=e.maxZoom,i=n===void 0?1/0:n,o=e.minZoom,a=o===void 0?0:o,u=e.zoomOffset,c=u===void 0?0:u,h=e.extent,y=h===void 0?HI:h,x=Math.ceil(t)+c;if(Number.isFinite(a)&&x<a)return[];Number.isFinite(i)&&x>i&&(x=i);for(var E=ei(r,4),T=E[0],I=E[1],k=E[2],D=E[3],V=[Math.max(T,y[0]),Math.max(I,y[1]),Math.min(k,y[2]),Math.min(D,y[3])],O=[],F=tw(V[0],V[1],x),N=ei(F,2),H=N[0],q=N[1],Y=tw(V[2],V[3],x),ee=ei(Y,2),pe=ee[0],ue=ee[1],ie=H;ie<=pe;ie++)for(var xe=ue;xe<=q;xe++)O.push({x:ie,y:xe,z:x});var Se=(pe+H)/2,Ne=(q+ue)/2,ze=function($e,it){return Math.abs($e-Se)+Math.abs(it-Ne)};return O.sort(function(Be,$e){return ze(Be.x,Be.y)-ze($e.x,$e.y)}),O}var r7=function(t,r,n){var i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0,o=Math.pow(2,n),a=o-1,u=o,c=t,h=r;return i&&(c<0?c=c+u:c>a&&(c=c%u)),{warpX:c,warpY:h}};function n7(e){var t=i7();return function(){var n=Ct(e),i;if(t){var o=Ct(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xn(this,i)}}function i7(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var a7=function(e){yn(r,e);var t=n7(r);function r(n){var i;$t(this,r),i=t.call(this),Q(Ye(i),"tileSize",256),Q(Ye(i),"isVisible",!1),Q(Ye(i),"isCurrent",!1),Q(Ye(i),"isVisibleChange",!1),Q(Ye(i),"loadedLayers",0),Q(Ye(i),"isLayerLoaded",!1),Q(Ye(i),"isLoad",!1),Q(Ye(i),"isChildLoad",!1),Q(Ye(i),"parent",null),Q(Ye(i),"children",[]),Q(Ye(i),"data",null),Q(Ye(i),"properties",{}),Q(Ye(i),"loadDataId",0);var o=n.x,a=n.y,u=n.z,c=n.tileSize,h=n.warp,y=h===void 0?!0:h;return i.x=o,i.y=a,i.z=u,i.warp=y||!0,i.tileSize=c,i}return Gt(r,[{key:"isLoading",get:function(){return this.loadStatus===Vh.Loading}},{key:"isLoaded",get:function(){return this.loadStatus===Vh.Loaded}},{key:"isFailure",get:function(){return this.loadStatus===Vh.Failure}},{key:"setTileLayerLoaded",value:function(){this.isLayerLoaded=!0}},{key:"isCancelled",get:function(){return this.loadStatus===Vh.Cancelled}},{key:"isDone",get:function(){return[Vh.Loaded,Vh.Cancelled,Vh.Failure].includes(this.loadStatus)}},{key:"bounds",get:function(){return WI(this.x,this.y,this.z)}},{key:"bboxPolygon",get:function(){var i=ei(this.bounds,4),o=i[0],a=i[1],u=i[2],c=i[3],h=[(u-o)/2,(c-a)/2],y=XF(this.bounds,{properties:{key:this.key,id:this.key,bbox:this.bounds,center:h,meta:`
      `.concat(this.key,`
      `)}});return y}},{key:"key",get:function(){var i="".concat(this.x,"_").concat(this.y,"_").concat(this.z);return i}},{key:"layerLoad",value:function(){this.loadedLayers++,this.emit("layerLoaded")}},{key:"loadData",value:function(){var n=Vt(Ce.mark(function o(a){var u,c,h,y,x,E,T,I,k,D,V,O,F,N,H,q,Y;return Ce.wrap(function(pe){for(;;)switch(pe.prev=pe.next){case 0:return u=a.getData,c=a.onLoad,h=a.onError,this.loadDataId++,y=this.loadDataId,this.isLoading&&this.abortLoad(),this.abortController=new AbortController,this.loadStatus=Vh.Loading,x=null,pe.prev=7,T=this.x,I=this.y,k=this.z,D=this.bounds,V=this.tileSize,O=this.warp,F=r7(T,I,k,O),N=F.warpX,H=F.warpY,q=this.abortController.signal,Y={x:N,y:H,z:k,bounds:D,tileSize:V,signal:q,warp:O},pe.next=14,u(Y,this);case 14:x=pe.sent,pe.next=20;break;case 17:pe.prev=17,pe.t0=pe.catch(7),E=pe.t0;case 20:if(y===this.loadDataId){pe.next=22;break}return pe.abrupt("return");case 22:if(!(this.isCancelled&&!x)){pe.next=24;break}return pe.abrupt("return");case 24:if(!(E||!x)){pe.next=28;break}return this.loadStatus=Vh.Failure,h(E,this),pe.abrupt("return");case 28:this.loadStatus=Vh.Loaded,this.data=x,c(this);case 31:case"end":return pe.stop()}},o,this,[[7,17]])}));function i(o){return n.apply(this,arguments)}return i}()},{key:"reloadData",value:function(i){this.isLoading&&this.abortLoad(),this.loadData(i)}},{key:"abortLoad",value:function(){this.isLoaded||this.isCancelled||(this.loadStatus=Vh.Cancelled,this.abortController.abort(),this.xhrCancel&&this.xhrCancel())}}]),r}(tc.EventEmitter),o7=function(t,r){var n=Y1(t),i=jE(n,r),o=360*3-180,a=85.0511287798065,u=[Math.max(i[0][0],-o),Math.max(i[0][1],-a),Math.min(i[1][0],o),Math.min(i[1][1],a)];return u},s7=function(t,r){var n=Y1(t),i=Y1(r),o=NI(n,i);return o};function uv(e,t){var r=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=u7(e))||t&&e&&typeof e.length=="number"){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(h){throw h},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,a=!1,u;return{s:function(){r=r.call(e)},n:function(){var h=r.next();return o=h.done,h},e:function(h){a=!0,u=h},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(a)throw u}}}}function u7(e,t){if(e){if(typeof e=="string")return OA(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return OA(e,t)}}function OA(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function l7(e){var t=c7();return function(){var n=Ct(e),i;if(t){var o=Ct(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xn(this,i)}}function c7(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var v0=function(e){return e.TilesLoadStart="tiles-load-start",e.TileLoaded="tile-loaded",e.TileError="tile-error",e.TileUnload="tile-unload",e.TileUpdate="tile-update",e.TilesLoadFinished="tiles-load-finished",e}({}),f7=function(e){yn(r,e);var t=l7(r);function r(n){var i;return $t(this,r),i=t.call(this),Q(Ye(i),"currentTiles",[]),Q(Ye(i),"cacheTiles",new Map),Q(Ye(i),"throttleUpdate",Er.throttle(function(o,a){i.update(o,a)},16)),Q(Ye(i),"onTileLoad",function(o){i.emit(v0.TileLoaded,o),i.updateTileVisible(),i.loadFinished()}),Q(Ye(i),"onTileError",function(o,a){i.emit(v0.TileError,{error:o,tile:a}),i.updateTileVisible(),i.loadFinished()}),Q(Ye(i),"onTileUnload",function(o){i.emit(v0.TileUnload,o),i.loadFinished()}),i.options={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0,extent:HI,getTileData:e7,warp:!0,updateStrategy:M1.Overlap},i.updateOptions(n),i}return Gt(r,[{key:"isLoaded",get:function(){return this.currentTiles.every(function(i){return i.isDone})}},{key:"tiles",get:function(){var i=Array.from(this.cacheTiles.values()).sort(function(o,a){return o.z-a.z});return i}},{key:"updateOptions",value:function(i){var o=i.minZoom===void 0?this.options.minZoom:Math.ceil(i.minZoom),a=i.maxZoom===void 0?this.options.maxZoom:Math.floor(i.maxZoom);this.options=_t(_t(_t({},this.options),i),{},{minZoom:o,maxZoom:a})}},{key:"update",value:function(i,o){var a=this,u=Math.max(0,Math.ceil(i));if(!(this.lastViewStates&&this.lastViewStates.zoom===u&&s7(this.lastViewStates.latLonBoundsBuffer,o))){var c=o7(o,KF);this.lastViewStates={zoom:u,latLonBounds:o,latLonBoundsBuffer:c},this.currentZoom=u;var h=!1,y=this.getTileIndices(u,c).filter(function(x){return a.options.warp||x.x>=0&&x.x<Math.pow(2,u)});this.emit(v0.TilesLoadStart),this.currentTiles=y.map(function(x){var E=x.x,T=x.y,I=x.z,k=a.getTile(E,T,I);if(k){var D,V,O=((D=k)===null||D===void 0?void 0:D.isFailure)||((V=k)===null||V===void 0?void 0:V.isCancelled);return O&&k.loadData({getData:a.options.getTileData,onLoad:a.onTileLoad,onError:a.onTileError}),k}return k=a.createTile(E,T,I),h=!0,k}),h&&this.resizeCacheTiles(),this.updateTileVisible(),this.pruneRequests()}}},{key:"reloadAll",value:function(){var i=uv(this.cacheTiles),o;try{for(i.s();!(o=i.n()).done;){var a=ei(o.value,2),u=a[0],c=a[1];if(!this.currentTiles.includes(c)){this.cacheTiles.delete(u),this.onTileUnload(c);return}this.onTileUnload(c),c.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError})}}catch(h){i.e(h)}finally{i.f()}}},{key:"reloadTileById",value:function(i,o,a){var u=this.cacheTiles.get("".concat(o,",").concat(a,",").concat(i));u&&(this.onTileUnload(u),u.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}))}},{key:"reloadTileByLnglat",value:function(i,o,a){var u=this.getTileByLngLat(i,o,a);u&&this.reloadTileById(u.z,u.x,u.y)}},{key:"reloadTileByExtent",value:function(i,o){var a=this,u=this.getTileIndices(o,i);u.forEach(function(c){a.reloadTileById(c.z,c.x,c.y)})}},{key:"pruneRequests",value:function(){var i=[],o=uv(this.cacheTiles.values()),a;try{for(o.s();!(a=o.n()).done;){var u=a.value;u.isLoading&&!u.isCurrent&&!u.isVisible&&i.push(u)}}catch(h){o.e(h)}finally{o.f()}for(;i.length>0;){var c=i.shift();c.abortLoad()}}},{key:"getTileByLngLat",value:function(i,o,a){var u=this.options.zoomOffset,c=Math.ceil(a)+u,h=tw(i,o,c),y=this.tiles.filter(function(x){return x.key==="".concat(h[0],"_").concat(h[1],"_").concat(c)});return y[0]}},{key:"getTileExtent",value:function(i,o){return this.getTileIndices(o,i)}},{key:"getTileByZXY",value:function(i,o,a){var u=this.tiles.filter(function(c){return c.key==="".concat(o,"_").concat(a,"_").concat(i)});return u[0]}},{key:"clear",value:function(){var i=uv(this.cacheTiles.values()),o;try{for(i.s();!(o=i.n()).done;){var a=o.value;a.isLoading?a.abortLoad():this.onTileUnload(a)}}catch(u){i.e(u)}finally{i.f()}this.lastViewStates=void 0,this.cacheTiles.clear(),this.currentTiles=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"updateTileVisible",value:function(){var i=this.options.updateStrategy,o=new Map,a=uv(this.cacheTiles.values()),u;try{for(a.s();!(u=a.n()).done;){var c=u.value;o.set(c.key,c.isVisible),c.isCurrent=!1,c.isVisible=!1}}catch(I){a.e(I)}finally{a.f()}var h=uv(this.currentTiles),y;try{for(h.s();!(y=h.n()).done;){var x=y.value;x.isCurrent=!0,x.isVisible=!0}}catch(I){h.e(I)}finally{h.f()}var E=Array.from(this.cacheTiles.values());typeof i=="function"?i(E):JF[i](E);var T=!1;Array.from(this.cacheTiles.values()).forEach(function(I){I.isVisible!==o.get(I.key)?(I.isVisibleChange=!0,T=!0):I.isVisibleChange=!1}),T&&this.emit(v0.TileUpdate)}},{key:"getTileIndices",value:function(i,o){var a=this.options,u=a.tileSize,c=a.extent,h=a.zoomOffset,y=Math.floor(this.options.maxZoom),x=Math.ceil(this.options.minZoom),E=t7({maxZoom:y,minZoom:x,zoomOffset:h,tileSize:u,zoom:i,latLonBounds:o,extent:c});return E}},{key:"getTileId",value:function(i,o,a){var u="".concat(i,",").concat(o,",").concat(a);return u}},{key:"loadFinished",value:function(){var i=!this.currentTiles.some(function(o){return!o.isDone});return i&&this.emit(v0.TilesLoadFinished),i}},{key:"getTile",value:function(i,o,a){var u=this.getTileId(i,o,a),c=this.cacheTiles.get(u);return c}},{key:"createTile",value:function(i,o,a){var u=this.getTileId(i,o,a),c=new a7({x:i,y:o,z:a,tileSize:this.options.tileSize,warp:this.options.warp});return this.cacheTiles.set(u,c),c.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}),c}},{key:"resizeCacheTiles",value:function(){var i=QF*this.currentTiles.length,o=this.cacheTiles.size>i;if(o){var a=uv(this.cacheTiles),u;try{for(a.s();!(u=a.n()).done;){var c=ei(u.value,2),h=c[0],y=c[1];if(!y.isVisible&&!this.currentTiles.includes(y)&&(this.cacheTiles.delete(h),this.onTileUnload(y)),this.cacheTiles.size<=i)break}}catch(x){a.e(x)}finally{a.f()}}this.rebuildTileTree()}},{key:"rebuildTileTree",value:function(){var i=uv(this.cacheTiles.values()),o;try{for(i.s();!(o=i.n()).done;){var a=o.value;a.parent=null,a.children.length=0}}catch(x){i.e(x)}finally{i.f()}var u=uv(this.cacheTiles.values()),c;try{for(u.s();!(c=u.n()).done;){var h=c.value,y=this.getNearestAncestor(h.x,h.y,h.z);h.parent=y,y!=null&&y.children&&y.children.push(h)}}catch(x){u.e(x)}finally{u.f()}}},{key:"getNearestAncestor",value:function(i,o,a){for(;a>this.options.minZoom;){i=Math.floor(i/2),o=Math.floor(o/2),a=a-1;var u=this.getTile(i,o,a);if(u)return u}return null}}]),r}(Cg);function h7(e){var t=[],r=/\{([a-z])-([a-z])\}/.exec(e);if(r){var n=r[1].charCodeAt(0),i=r[2].charCodeAt(0),o;for(o=n;o<=i;++o)t.push(e.replace(r[0],String.fromCharCode(o)));return t}if(r=/\{(\d+)-(\d+)\}/.exec(e),r){for(var a=parseInt(r[2],10),u=parseInt(r[1],10);u<=a;u++)t.push(e.replace(r[0],u.toString()));return t}return t.push(e),t}function Ey(e,t){if(!e||!e.length)throw new Error("url is not allowed to be empty");var r=t.x,n=t.y,i=t.z,o=h7(e),a=Math.abs(r+n)%o.length,u=o[a];return u.replace(/\{x\}/g,r.toString()).replace(/\{y\}/g,n.toString()).replace(/\{z\}/g,i.toString()).replace(/\{bbox\}/g,WI(r,n,i).join(",")).replace(/\{-y\}/g,(Math.pow(2,i)-n-1).toString())}function p7(e,t){var r=t.x,n=t.y,i=t.z,o=t.layer,a=t.version,u=a===void 0?"1.0.0":a,c=t.style,h=c===void 0?"default":c,y=t.format,x=t.service,E=x===void 0?"WMTS":x,T=t.tileMatrixset,I="".concat(e,"&SERVICE=").concat(E,"&REQUEST=GetTile&VERSION=").concat(u,"&LAYER=").concat(o,"&STYLE=").concat(h,"&TILEMATRIXSET=").concat(T,"&FORMAT=").concat(y,"&TILECOL=").concat(r,"&TILEROW=").concat(n,"&TILEMATRIX=").concat(i);return I}function rw(e,t){if(!e)throw new Error(t||"web worker helper assertion failed.")}var zb=new Map;function d7(e){rw(e.source&&!e.url||!e.source&&e.url);var t=zb.get(e.source||e.url);return t||(e.url&&(t=v7(e.url),zb.set(e.url,t)),e.source&&(t=XI(e.source),zb.set(e.source,t))),rw(t),t}function v7(e){if(!e.startsWith("http"))return e;var t=m7(e);return XI(t)}function XI(e){var t=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(t)}function m7(e){return`try {
  importScripts('`+e+`');
} catch (error) {
  console.error(error);
  throw error;
}`}function GE(e,t,r){t===void 0&&(t=!0);var n=r||new Set;if(e){if(DA(e))n.add(e);else if(DA(e.buffer))n.add(e.buffer);else if(!ArrayBuffer.isView(e)){if(t&&typeof e=="object")for(var i in e)GE(e[i],t,n)}}return r===void 0?Array.from(n):[]}function DA(e){return e?e instanceof ArrayBuffer||typeof MessagePort<"u"&&e instanceof MessagePort||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas:!1}var Ub=function(){};(function(){function e(t){this.terminated=!1,this.loadableURL="";var r=t.name,n=t.source,i=t.url;rw(n||i),this.name=r,this.source=n,this.url=i,this.onMessage=Ub,this.onError=function(o){},this.worker=this.createBrowserWorker()}return e.isSupported=function(){return typeof Worker<"u"},e.prototype.destroy=function(){this.onMessage=Ub,this.onError=Ub,this.worker.terminate(),this.terminated=!0},Object.defineProperty(e.prototype,"isRunning",{get:function(){return!!this.onMessage},enumerable:!1,configurable:!0}),e.prototype.postMessage=function(t,r){r=r||GE(t),this.worker.postMessage(t,r)},e.prototype.getErrorFromErrorEvent=function(t){var r="Failed to load ";return r+="worker "+this.name+" from "+this.url+". ",t.message&&(r+=t.message+" in "),t.lineno&&(r+=":"+t.lineno+":"+t.colno),new Error(r)},e.prototype.createBrowserWorker=function(){var t=this;this.loadableURL=d7({source:this.source,url:this.url});var r=new Worker(this.loadableURL,{name:this.name});return r.onmessage=function(n){n.data?t.onMessage(n.data):t.onError(new Error("No data received"))},r.onerror=function(n){t.onError(t.getErrorFromErrorEvent(n)),t.terminated=!0},r.onmessageerror=function(n){},r},e})();var FA=globalThis&&globalThis.__assign||function(){return FA=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},FA.apply(this,arguments)};globalThis&&globalThis.__awaiter;globalThis&&globalThis.__generator;var NA=globalThis&&globalThis.__assign||function(){return NA=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},NA.apply(this,arguments)};globalThis&&globalThis.__values;var Vb=new Map,Cd=function(){function e(){}return Object.defineProperty(e,"onmessage",{set:function(t){self.onmessage=function(r){if(BA(r)){var n=r.data,i=n.type,o=n.payload;t(i,o)}}},enumerable:!1,configurable:!0}),e.addEventListener=function(t){var r=Vb.get(t);r||(r=function(n){if(BA(n)){var i=n.data,o=i.type,a=i.payload;t(o,a)}}),self.addEventListener("message",r)},e.removeEventListener=function(t){var r=Vb.get(t);Vb.delete(t),self.removeEventListener("message",r)},e.postMessage=function(t,r){if(self){var n={source:"Worker thread",type:t,payload:r},i=GE(r);self.postMessage(n,i)}},e}();function BA(e){var t=e.type,r=e.data;return t==="message"&&r&&typeof r.source=="string"&&r.source==="Main thread"}globalThis&&globalThis.__awaiter;globalThis&&globalThis.__generator;var g7=function(){function e(){this._values=[],this._settlers=[],this._closed=!1}return e.prototype[Symbol.asyncIterator]=function(){return this},e.prototype.push=function(t){return this.enqueue(t)},e.prototype.enqueue=function(t){if(this._closed)throw new Error("Closed");if(this._settlers.length>0){if(this._values.length>0)throw new Error("Illegal internal state");var r=this._settlers.shift();t instanceof Error?r.reject(t):r.resolve({value:t})}else this._values.push(t)},e.prototype.close=function(){for(;this._settlers.length>0;){var t=this._settlers.shift();t.resolve({done:!0})}this._closed=!0},e.prototype.next=function(){var t=this;if(this._values.length>0){var r=this._values.shift();return r instanceof Error?Promise.reject(r):Promise.resolve({done:!1,value:r})}if(this._closed){if(this._settlers.length>0)throw new Error("Illegal internal state");return Promise.resolve({done:!0,value:void 0})}return new Promise(function(n,i){t._settlers.push({resolve:n,reject:i})})},e}(),y7=globalThis&&globalThis.__awaiter||function(e,t,r,n){function i(o){return o instanceof r?o:new r(function(a){a(o)})}return new(r||(r=Promise))(function(o,a){function u(y){try{h(n.next(y))}catch(x){a(x)}}function c(y){try{h(n.throw(y))}catch(x){a(x)}}function h(y){y.done?o(y.value):i(y.value).then(u,c)}h((n=n.apply(e,t||[])).next())})},_7=globalThis&&globalThis.__generator||function(e,t){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,a;return a={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function u(h){return function(y){return c([h,y])}}function c(h){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(o=h[0]&2?i.return:h[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,h[1])).done)return o;switch(i=0,o&&(h=[h[0]&2,o.value]),h[0]){case 0:case 1:o=h;break;case 4:return r.label++,{value:h[1],done:!1};case 5:r.label++,i=h[1],h=[0];continue;case 7:h=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(h[0]===6||h[0]===2)){r=0;continue}if(h[0]===3&&(!o||h[1]>o[0]&&h[1]<o[3])){r.label=h[1];break}if(h[0]===6&&r.label<o[1]){r.label=o[1],o=h;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(h);break}o[2]&&r.ops.pop(),r.trys.pop();continue}h=t.call(e,r)}catch(y){h=[6,y],i=0}finally{n=o=0}if(h[0]&5)throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}},x7=globalThis&&globalThis.__asyncValues||function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],r;return t?t.call(e):(e=typeof __values=="function"?__values(e):e[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(o){r[o]=e[o]&&function(a){return new Promise(function(u,c){a=e[o](a),i(u,c,a.done,a.value)})}}function i(o,a,u,c){Promise.resolve(c).then(function(h){o({value:h,done:u})},a)}},b7=0,Q_,zA;function w7(e,t){var r=this;if(!(typeof self>"u")){var n={process:E7};Cd.onmessage=function(i,o){return y7(r,void 0,void 0,function(){var a,u,c,h,y,x,E,T,I,k,D;return _7(this,function(V){switch(V.label){case 0:switch(V.trys.push([0,19,,20]),a=i,a){case"process":return[3,1];case"process-in-batches":return[3,3];case"input-batch":return[3,16];case"input-done":return[3,17]}return[3,18];case 1:if(!e)throw new Error("Worker does not support atomic processing");return[4,e(o.input,o.options||{},n)];case 2:return u=V.sent(),Cd.postMessage("done",{result:u}),[3,18];case 3:if(!t)throw new Error("Worker does not support batched processing");Q_=new g7,zA=o.options||{},c=t(Q_,zA,n),V.label=4;case 4:V.trys.push([4,9,10,15]),h=x7(c),V.label=5;case 5:return[4,h.next()];case 6:if(y=V.sent(),!!y.done)return[3,8];x=y.value,Cd.postMessage("output-batch",{result:x}),V.label=7;case 7:return[3,5];case 8:return[3,15];case 9:return E=V.sent(),k={error:E},[3,15];case 10:return V.trys.push([10,,13,14]),y&&!y.done&&(D=h.return)?[4,D.call(h)]:[3,12];case 11:V.sent(),V.label=12;case 12:return[3,14];case 13:if(k)throw k.error;return[7];case 14:return[7];case 15:return Cd.postMessage("done",{}),[3,18];case 16:return Q_.push(o.input),[3,18];case 17:return Q_.close(),[3,18];case 18:return[3,20];case 19:return T=V.sent(),I=T instanceof Error?T.message:"",Cd.postMessage("error",{error:I}),[3,20];case 20:return[2]}})})}}}function E7(e,t){return t===void 0&&(t={}),new Promise(function(r,n){var i=b7++,o=function(u,c){if(c.id===i)switch(u){case"done":Cd.removeEventListener(o),r(c.result);break;case"error":Cd.removeEventListener(o),n(c.error);break}};Cd.addEventListener(o);var a={id:i,input:e,options:t};Cd.postMessage("process",a)})}globalThis&&globalThis.__awaiter;globalThis&&globalThis.__generator;function HE(e){var t=e.color;return!t||!t.length?[1,1,1,1]:t}function WE(e,t,r){return r.length===2?[r[0],r[1],0]:[r[0],r[1],r[2]]}function XE(e){var t=e.filter;return t?[1]:[0]}function YE(e,t){return[t]}var qE={exports:{}};qE.exports=Fx;qE.exports.default=Fx;function Fx(e,t,r){r=r||2;var n=t&&t.length,i=n?t[0]*r:e.length,o=YI(e,0,i,r,!0),a=[];if(!o||o.next===o.prev)return a;var u,c,h,y,x,E,T;if(n&&(o=M7(e,t,o,r)),e.length>80*r){u=h=e[0],c=y=e[1];for(var I=r;I<i;I+=r)x=e[I],E=e[I+1],x<u&&(u=x),E<c&&(c=E),x>h&&(h=x),E>y&&(y=E);T=Math.max(h-u,y-c),T=T!==0?32767/T:0}return zy(o,a,r,u,c,T,0),a}function YI(e,t,r,n,i){var o,a;if(i===aw(e,t,r,n)>0)for(o=t;o<r;o+=n)a=UA(o,e[o],e[o+1],a);else for(o=r-n;o>=t;o-=n)a=UA(o,e[o],e[o+1],a);return a&&Nx(a,a.next)&&(Vy(a),a=a.next),a}function km(e,t){if(!e)return e;t||(t=e);var r=e,n;do if(n=!1,!r.steiner&&(Nx(r,r.next)||Es(r.prev,r,r.next)===0)){if(Vy(r),r=t=r.prev,r===r.next)break;n=!0}else r=r.next;while(n||r!==t);return t}function zy(e,t,r,n,i,o,a){if(e){!a&&o&&k7(e,n,i,o);for(var u=e,c,h;e.prev!==e.next;){if(c=e.prev,h=e.next,o?A7(e,n,i,o):S7(e)){t.push(c.i/r|0),t.push(e.i/r|0),t.push(h.i/r|0),Vy(e),e=h.next,u=h.next;continue}if(e=h,e===u){a?a===1?(e=T7(km(e),t,r),zy(e,t,r,n,i,o,2)):a===2&&C7(e,t,r,n,i,o):zy(km(e),t,r,n,i,o,1);break}}}}function S7(e){var t=e.prev,r=e,n=e.next;if(Es(t,r,n)>=0)return!1;for(var i=t.x,o=r.x,a=n.x,u=t.y,c=r.y,h=n.y,y=i<o?i<a?i:a:o<a?o:a,x=u<c?u<h?u:h:c<h?c:h,E=i>o?i>a?i:a:o>a?o:a,T=u>c?u>h?u:h:c>h?c:h,I=n.next;I!==t;){if(I.x>=y&&I.x<=E&&I.y>=x&&I.y<=T&&O0(i,u,o,c,a,h,I.x,I.y)&&Es(I.prev,I,I.next)>=0)return!1;I=I.next}return!0}function A7(e,t,r,n){var i=e.prev,o=e,a=e.next;if(Es(i,o,a)>=0)return!1;for(var u=i.x,c=o.x,h=a.x,y=i.y,x=o.y,E=a.y,T=u<c?u<h?u:h:c<h?c:h,I=y<x?y<E?y:E:x<E?x:E,k=u>c?u>h?u:h:c>h?c:h,D=y>x?y>E?y:E:x>E?x:E,V=nw(T,I,t,r,n),O=nw(k,D,t,r,n),F=e.prevZ,N=e.nextZ;F&&F.z>=V&&N&&N.z<=O;){if(F.x>=T&&F.x<=k&&F.y>=I&&F.y<=D&&F!==i&&F!==a&&O0(u,y,c,x,h,E,F.x,F.y)&&Es(F.prev,F,F.next)>=0||(F=F.prevZ,N.x>=T&&N.x<=k&&N.y>=I&&N.y<=D&&N!==i&&N!==a&&O0(u,y,c,x,h,E,N.x,N.y)&&Es(N.prev,N,N.next)>=0))return!1;N=N.nextZ}for(;F&&F.z>=V;){if(F.x>=T&&F.x<=k&&F.y>=I&&F.y<=D&&F!==i&&F!==a&&O0(u,y,c,x,h,E,F.x,F.y)&&Es(F.prev,F,F.next)>=0)return!1;F=F.prevZ}for(;N&&N.z<=O;){if(N.x>=T&&N.x<=k&&N.y>=I&&N.y<=D&&N!==i&&N!==a&&O0(u,y,c,x,h,E,N.x,N.y)&&Es(N.prev,N,N.next)>=0)return!1;N=N.nextZ}return!0}function T7(e,t,r){var n=e;do{var i=n.prev,o=n.next.next;!Nx(i,o)&&qI(i,n,n.next,o)&&Uy(i,o)&&Uy(o,i)&&(t.push(i.i/r|0),t.push(n.i/r|0),t.push(o.i/r|0),Vy(n),Vy(n.next),n=e=o),n=n.next}while(n!==e);return km(n)}function C7(e,t,r,n,i,o){var a=e;do{for(var u=a.next.next;u!==a.prev;){if(a.i!==u.i&&F7(a,u)){var c=ZI(a,u);a=km(a,a.next),c=km(c,c.next),zy(a,t,r,n,i,o,0),zy(c,t,r,n,i,o,0);return}u=u.next}a=a.next}while(a!==e)}function M7(e,t,r,n){var i=[],o,a,u,c,h;for(o=0,a=t.length;o<a;o++)u=t[o]*n,c=o<a-1?t[o+1]*n:e.length,h=YI(e,u,c,n,!1),h===h.next&&(h.steiner=!0),i.push(D7(h));for(i.sort(P7),o=0;o<i.length;o++)r=I7(i[o],r);return r}function P7(e,t){return e.x-t.x}function I7(e,t){var r=R7(e,t);if(!r)return t;var n=ZI(r,e);return km(n,n.next),km(r,r.next)}function R7(e,t){var r=t,n=e.x,i=e.y,o=-1/0,a;do{if(i<=r.y&&i>=r.next.y&&r.next.y!==r.y){var u=r.x+(i-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(u<=n&&u>o&&(o=u,a=r.x<r.next.x?r:r.next,u===n))return a}r=r.next}while(r!==t);if(!a)return null;var c=a,h=a.x,y=a.y,x=1/0,E;r=a;do n>=r.x&&r.x>=h&&n!==r.x&&O0(i<y?n:o,i,h,y,i<y?o:n,i,r.x,r.y)&&(E=Math.abs(i-r.y)/(n-r.x),Uy(r,e)&&(E<x||E===x&&(r.x>a.x||r.x===a.x&&L7(a,r)))&&(a=r,x=E)),r=r.next;while(r!==c);return a}function L7(e,t){return Es(e.prev,e,t.prev)<0&&Es(t.next,e,e.next)<0}function k7(e,t,r,n){var i=e;do i.z===0&&(i.z=nw(i.x,i.y,t,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,O7(i)}function O7(e){var t,r,n,i,o,a,u,c,h=1;do{for(r=e,e=null,o=null,a=0;r;){for(a++,n=r,u=0,t=0;t<h&&(u++,n=n.nextZ,!!n);t++);for(c=h;u>0||c>0&&n;)u!==0&&(c===0||!n||r.z<=n.z)?(i=r,r=r.nextZ,u--):(i=n,n=n.nextZ,c--),o?o.nextZ=i:e=i,i.prevZ=o,o=i;r=n}o.nextZ=null,h*=2}while(a>1);return e}function nw(e,t,r,n,i){return e=(e-r)*i|0,t=(t-n)*i|0,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e|t<<1}function D7(e){var t=e,r=e;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==e);return r}function O0(e,t,r,n,i,o,a,u){return(i-a)*(t-u)>=(e-a)*(o-u)&&(e-a)*(n-u)>=(r-a)*(t-u)&&(r-a)*(o-u)>=(i-a)*(n-u)}function F7(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!N7(e,t)&&(Uy(e,t)&&Uy(t,e)&&B7(e,t)&&(Es(e.prev,e,t.prev)||Es(e,t.prev,t))||Nx(e,t)&&Es(e.prev,e,e.next)>0&&Es(t.prev,t,t.next)>0)}function Es(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function Nx(e,t){return e.x===t.x&&e.y===t.y}function qI(e,t,r,n){var i=e1(Es(e,t,r)),o=e1(Es(e,t,n)),a=e1(Es(r,n,e)),u=e1(Es(r,n,t));return!!(i!==o&&a!==u||i===0&&J_(e,r,t)||o===0&&J_(e,n,t)||a===0&&J_(r,e,n)||u===0&&J_(r,t,n))}function J_(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function e1(e){return e>0?1:e<0?-1:0}function N7(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&qI(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}function Uy(e,t){return Es(e.prev,e,e.next)<0?Es(e,t,e.next)>=0&&Es(e,e.prev,t)>=0:Es(e,t,e.prev)<0||Es(e,e.next,t)<0}function B7(e,t){var r=e,n=!1,i=(e.x+t.x)/2,o=(e.y+t.y)/2;do r.y>o!=r.next.y>o&&r.next.y!==r.y&&i<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next;while(r!==e);return n}function ZI(e,t){var r=new iw(e.i,e.x,e.y),n=new iw(t.i,t.x,t.y),i=e.next,o=t.prev;return e.next=t,t.prev=e,r.next=i,i.prev=r,n.next=r,r.prev=n,o.next=n,n.prev=o,n}function UA(e,t,r,n){var i=new iw(e,t,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function Vy(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function iw(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}Fx.deviation=function(e,t,r,n){var i=t&&t.length,o=i?t[0]*r:e.length,a=Math.abs(aw(e,0,o,r));if(i)for(var u=0,c=t.length;u<c;u++){var h=t[u]*r,y=u<c-1?t[u+1]*r:e.length;a-=Math.abs(aw(e,h,y,r))}var x=0;for(u=0;u<n.length;u+=3){var E=n[u]*r,T=n[u+1]*r,I=n[u+2]*r;x+=Math.abs((e[E]-e[I])*(e[T+1]-e[E+1])-(e[E]-e[T])*(e[I+1]-e[E+1]))}return a===0&&x===0?0:Math.abs((x-a)/a)};function aw(e,t,r,n){for(var i=0,o=t,a=r-n;o<r;o+=n)i+=(e[a]-e[o])*(e[o+1]+e[a+1]),a=o;return i}Fx.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},n=0,i=0;i<e.length;i++){for(var o=0;o<e[i].length;o++)for(var a=0;a<t;a++)r.vertices.push(e[i][o][a]);i>0&&(n+=e[i-1].length,r.holes.push(n))}return r};var z7=qE.exports;const Iv=jc(z7);var cs=1e-6,Bl=typeof Float32Array<"u"?Float32Array:Array,VA=Math.random;Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});function Tm(){var e=new Bl(16);return Bl!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function U7(e){var t=new Bl(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function V7(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function KI(e,t,r,n,i,o,a,u,c,h,y,x,E,T,I,k){var D=new Bl(16);return D[0]=e,D[1]=t,D[2]=r,D[3]=n,D[4]=i,D[5]=o,D[6]=a,D[7]=u,D[8]=c,D[9]=h,D[10]=y,D[11]=x,D[12]=E,D[13]=T,D[14]=I,D[15]=k,D}function j7(e,t,r,n,i,o,a,u,c,h,y,x,E,T,I,k,D){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e[4]=o,e[5]=a,e[6]=u,e[7]=c,e[8]=h,e[9]=y,e[10]=x,e[11]=E,e[12]=T,e[13]=I,e[14]=k,e[15]=D,e}function QI(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function $7(e,t){if(e===t){var r=t[1],n=t[2],i=t[3],o=t[6],a=t[7],u=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=n,e[9]=o,e[11]=t[14],e[12]=i,e[13]=a,e[14]=u}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function ZE(e,t){var r=t[0],n=t[1],i=t[2],o=t[3],a=t[4],u=t[5],c=t[6],h=t[7],y=t[8],x=t[9],E=t[10],T=t[11],I=t[12],k=t[13],D=t[14],V=t[15],O=r*u-n*a,F=r*c-i*a,N=r*h-o*a,H=n*c-i*u,q=n*h-o*u,Y=i*h-o*c,ee=y*k-x*I,pe=y*D-E*I,ue=y*V-T*I,ie=x*D-E*k,xe=x*V-T*k,Se=E*V-T*D,Ne=O*Se-F*xe+N*ie+H*ue-q*pe+Y*ee;return Ne?(Ne=1/Ne,e[0]=(u*Se-c*xe+h*ie)*Ne,e[1]=(i*xe-n*Se-o*ie)*Ne,e[2]=(k*Y-D*q+V*H)*Ne,e[3]=(E*q-x*Y-T*H)*Ne,e[4]=(c*ue-a*Se-h*pe)*Ne,e[5]=(r*Se-i*ue+o*pe)*Ne,e[6]=(D*N-I*Y-V*F)*Ne,e[7]=(y*Y-E*N+T*F)*Ne,e[8]=(a*xe-u*ue+h*ee)*Ne,e[9]=(n*ue-r*xe-o*ee)*Ne,e[10]=(I*q-k*N+V*O)*Ne,e[11]=(x*N-y*q-T*O)*Ne,e[12]=(u*pe-a*ie-c*ee)*Ne,e[13]=(r*ie-n*pe+i*ee)*Ne,e[14]=(k*F-I*H-D*O)*Ne,e[15]=(y*H-x*F+E*O)*Ne,e):null}function G7(e,t){var r=t[0],n=t[1],i=t[2],o=t[3],a=t[4],u=t[5],c=t[6],h=t[7],y=t[8],x=t[9],E=t[10],T=t[11],I=t[12],k=t[13],D=t[14],V=t[15];return e[0]=u*(E*V-T*D)-x*(c*V-h*D)+k*(c*T-h*E),e[1]=-(n*(E*V-T*D)-x*(i*V-o*D)+k*(i*T-o*E)),e[2]=n*(c*V-h*D)-u*(i*V-o*D)+k*(i*h-o*c),e[3]=-(n*(c*T-h*E)-u*(i*T-o*E)+x*(i*h-o*c)),e[4]=-(a*(E*V-T*D)-y*(c*V-h*D)+I*(c*T-h*E)),e[5]=r*(E*V-T*D)-y*(i*V-o*D)+I*(i*T-o*E),e[6]=-(r*(c*V-h*D)-a*(i*V-o*D)+I*(i*h-o*c)),e[7]=r*(c*T-h*E)-a*(i*T-o*E)+y*(i*h-o*c),e[8]=a*(x*V-T*k)-y*(u*V-h*k)+I*(u*T-h*x),e[9]=-(r*(x*V-T*k)-y*(n*V-o*k)+I*(n*T-o*x)),e[10]=r*(u*V-h*k)-a*(n*V-o*k)+I*(n*h-o*u),e[11]=-(r*(u*T-h*x)-a*(n*T-o*x)+y*(n*h-o*u)),e[12]=-(a*(x*D-E*k)-y*(u*D-c*k)+I*(u*E-c*x)),e[13]=r*(x*D-E*k)-y*(n*D-i*k)+I*(n*E-i*x),e[14]=-(r*(u*D-c*k)-a*(n*D-i*k)+I*(n*c-i*u)),e[15]=r*(u*E-c*x)-a*(n*E-i*x)+y*(n*c-i*u),e}function H7(e){var t=e[0],r=e[1],n=e[2],i=e[3],o=e[4],a=e[5],u=e[6],c=e[7],h=e[8],y=e[9],x=e[10],E=e[11],T=e[12],I=e[13],k=e[14],D=e[15],V=t*a-r*o,O=t*u-n*o,F=t*c-i*o,N=r*u-n*a,H=r*c-i*a,q=n*c-i*u,Y=h*I-y*T,ee=h*k-x*T,pe=h*D-E*T,ue=y*k-x*I,ie=y*D-E*I,xe=x*D-E*k;return V*xe-O*ie+F*ue+N*pe-H*ee+q*Y}function zp(e,t,r){var n=t[0],i=t[1],o=t[2],a=t[3],u=t[4],c=t[5],h=t[6],y=t[7],x=t[8],E=t[9],T=t[10],I=t[11],k=t[12],D=t[13],V=t[14],O=t[15],F=r[0],N=r[1],H=r[2],q=r[3];return e[0]=F*n+N*u+H*x+q*k,e[1]=F*i+N*c+H*E+q*D,e[2]=F*o+N*h+H*T+q*V,e[3]=F*a+N*y+H*I+q*O,F=r[4],N=r[5],H=r[6],q=r[7],e[4]=F*n+N*u+H*x+q*k,e[5]=F*i+N*c+H*E+q*D,e[6]=F*o+N*h+H*T+q*V,e[7]=F*a+N*y+H*I+q*O,F=r[8],N=r[9],H=r[10],q=r[11],e[8]=F*n+N*u+H*x+q*k,e[9]=F*i+N*c+H*E+q*D,e[10]=F*o+N*h+H*T+q*V,e[11]=F*a+N*y+H*I+q*O,F=r[12],N=r[13],H=r[14],q=r[15],e[12]=F*n+N*u+H*x+q*k,e[13]=F*i+N*c+H*E+q*D,e[14]=F*o+N*h+H*T+q*V,e[15]=F*a+N*y+H*I+q*O,e}function jy(e,t,r){var n=r[0],i=r[1],o=r[2],a,u,c,h,y,x,E,T,I,k,D,V;return t===e?(e[12]=t[0]*n+t[4]*i+t[8]*o+t[12],e[13]=t[1]*n+t[5]*i+t[9]*o+t[13],e[14]=t[2]*n+t[6]*i+t[10]*o+t[14],e[15]=t[3]*n+t[7]*i+t[11]*o+t[15]):(a=t[0],u=t[1],c=t[2],h=t[3],y=t[4],x=t[5],E=t[6],T=t[7],I=t[8],k=t[9],D=t[10],V=t[11],e[0]=a,e[1]=u,e[2]=c,e[3]=h,e[4]=y,e[5]=x,e[6]=E,e[7]=T,e[8]=I,e[9]=k,e[10]=D,e[11]=V,e[12]=a*n+y*i+I*o+t[12],e[13]=u*n+x*i+k*o+t[13],e[14]=c*n+E*i+D*o+t[14],e[15]=h*n+T*i+V*o+t[15]),e}function $y(e,t,r){var n=r[0],i=r[1],o=r[2];return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function W7(e,t,r,n){var i=n[0],o=n[1],a=n[2],u=Math.hypot(i,o,a),c,h,y,x,E,T,I,k,D,V,O,F,N,H,q,Y,ee,pe,ue,ie,xe,Se,Ne,ze;return u<cs?null:(u=1/u,i*=u,o*=u,a*=u,c=Math.sin(r),h=Math.cos(r),y=1-h,x=t[0],E=t[1],T=t[2],I=t[3],k=t[4],D=t[5],V=t[6],O=t[7],F=t[8],N=t[9],H=t[10],q=t[11],Y=i*i*y+h,ee=o*i*y+a*c,pe=a*i*y-o*c,ue=i*o*y-a*c,ie=o*o*y+h,xe=a*o*y+i*c,Se=i*a*y+o*c,Ne=o*a*y-i*c,ze=a*a*y+h,e[0]=x*Y+k*ee+F*pe,e[1]=E*Y+D*ee+N*pe,e[2]=T*Y+V*ee+H*pe,e[3]=I*Y+O*ee+q*pe,e[4]=x*ue+k*ie+F*xe,e[5]=E*ue+D*ie+N*xe,e[6]=T*ue+V*ie+H*xe,e[7]=I*ue+O*ie+q*xe,e[8]=x*Se+k*Ne+F*ze,e[9]=E*Se+D*Ne+N*ze,e[10]=T*Se+V*Ne+H*ze,e[11]=I*Se+O*Ne+q*ze,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function Bx(e,t,r){var n=Math.sin(r),i=Math.cos(r),o=t[4],a=t[5],u=t[6],c=t[7],h=t[8],y=t[9],x=t[10],E=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=o*i+h*n,e[5]=a*i+y*n,e[6]=u*i+x*n,e[7]=c*i+E*n,e[8]=h*i-o*n,e[9]=y*i-a*n,e[10]=x*i-u*n,e[11]=E*i-c*n,e}function KE(e,t,r){var n=Math.sin(r),i=Math.cos(r),o=t[0],a=t[1],u=t[2],c=t[3],h=t[8],y=t[9],x=t[10],E=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*i-h*n,e[1]=a*i-y*n,e[2]=u*i-x*n,e[3]=c*i-E*n,e[8]=o*n+h*i,e[9]=a*n+y*i,e[10]=u*n+x*i,e[11]=c*n+E*i,e}function QE(e,t,r){var n=Math.sin(r),i=Math.cos(r),o=t[0],a=t[1],u=t[2],c=t[3],h=t[4],y=t[5],x=t[6],E=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*i+h*n,e[1]=a*i+y*n,e[2]=u*i+x*n,e[3]=c*i+E*n,e[4]=h*i-o*n,e[5]=y*i-a*n,e[6]=x*i-u*n,e[7]=E*i-c*n,e}function JI(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function X7(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Y7(e,t,r){var n=r[0],i=r[1],o=r[2],a=Math.hypot(n,i,o),u,c,h;return a<cs?null:(a=1/a,n*=a,i*=a,o*=a,u=Math.sin(t),c=Math.cos(t),h=1-c,e[0]=n*n*h+c,e[1]=i*n*h+o*u,e[2]=o*n*h-i*u,e[3]=0,e[4]=n*i*h-o*u,e[5]=i*i*h+c,e[6]=o*i*h+n*u,e[7]=0,e[8]=n*o*h+i*u,e[9]=i*o*h-n*u,e[10]=o*o*h+c,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function q7(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Z7(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function K7(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function eR(e,t,r){var n=t[0],i=t[1],o=t[2],a=t[3],u=n+n,c=i+i,h=o+o,y=n*u,x=n*c,E=n*h,T=i*c,I=i*h,k=o*h,D=a*u,V=a*c,O=a*h;return e[0]=1-(T+k),e[1]=x+O,e[2]=E-V,e[3]=0,e[4]=x-O,e[5]=1-(y+k),e[6]=I+D,e[7]=0,e[8]=E+V,e[9]=I-D,e[10]=1-(y+T),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function Q7(e,t){var r=new Bl(3),n=-t[0],i=-t[1],o=-t[2],a=t[3],u=t[4],c=t[5],h=t[6],y=t[7],x=n*n+i*i+o*o+a*a;return x>0?(r[0]=(u*a+y*n+c*o-h*i)*2/x,r[1]=(c*a+y*i+h*n-u*o)*2/x,r[2]=(h*a+y*o+u*i-c*n)*2/x):(r[0]=(u*a+y*n+c*o-h*i)*2,r[1]=(c*a+y*i+h*n-u*o)*2,r[2]=(h*a+y*o+u*i-c*n)*2),eR(e,t,r),e}function J7(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function tR(e,t){var r=t[0],n=t[1],i=t[2],o=t[4],a=t[5],u=t[6],c=t[8],h=t[9],y=t[10];return e[0]=Math.hypot(r,n,i),e[1]=Math.hypot(o,a,u),e[2]=Math.hypot(c,h,y),e}function eN(e,t){var r=new Bl(3);tR(r,t);var n=1/r[0],i=1/r[1],o=1/r[2],a=t[0]*n,u=t[1]*i,c=t[2]*o,h=t[4]*n,y=t[5]*i,x=t[6]*o,E=t[8]*n,T=t[9]*i,I=t[10]*o,k=a+y+I,D=0;return k>0?(D=Math.sqrt(k+1)*2,e[3]=.25*D,e[0]=(x-T)/D,e[1]=(E-c)/D,e[2]=(u-h)/D):a>y&&a>I?(D=Math.sqrt(1+a-y-I)*2,e[3]=(x-T)/D,e[0]=.25*D,e[1]=(u+h)/D,e[2]=(E+c)/D):y>I?(D=Math.sqrt(1+y-a-I)*2,e[3]=(E-c)/D,e[0]=(u+h)/D,e[1]=.25*D,e[2]=(x+T)/D):(D=Math.sqrt(1+I-a-y)*2,e[3]=(u-h)/D,e[0]=(E+c)/D,e[1]=(x+T)/D,e[2]=.25*D),e}function tN(e,t,r,n){var i=t[0],o=t[1],a=t[2],u=t[3],c=i+i,h=o+o,y=a+a,x=i*c,E=i*h,T=i*y,I=o*h,k=o*y,D=a*y,V=u*c,O=u*h,F=u*y,N=n[0],H=n[1],q=n[2];return e[0]=(1-(I+D))*N,e[1]=(E+F)*N,e[2]=(T-O)*N,e[3]=0,e[4]=(E-F)*H,e[5]=(1-(x+D))*H,e[6]=(k+V)*H,e[7]=0,e[8]=(T+O)*q,e[9]=(k-V)*q,e[10]=(1-(x+I))*q,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function rN(e,t,r,n,i){var o=t[0],a=t[1],u=t[2],c=t[3],h=o+o,y=a+a,x=u+u,E=o*h,T=o*y,I=o*x,k=a*y,D=a*x,V=u*x,O=c*h,F=c*y,N=c*x,H=n[0],q=n[1],Y=n[2],ee=i[0],pe=i[1],ue=i[2],ie=(1-(k+V))*H,xe=(T+N)*H,Se=(I-F)*H,Ne=(T-N)*q,ze=(1-(E+V))*q,Be=(D+O)*q,$e=(I+F)*Y,it=(D-O)*Y,mt=(1-(E+k))*Y;return e[0]=ie,e[1]=xe,e[2]=Se,e[3]=0,e[4]=Ne,e[5]=ze,e[6]=Be,e[7]=0,e[8]=$e,e[9]=it,e[10]=mt,e[11]=0,e[12]=r[0]+ee-(ie*ee+Ne*pe+$e*ue),e[13]=r[1]+pe-(xe*ee+ze*pe+it*ue),e[14]=r[2]+ue-(Se*ee+Be*pe+mt*ue),e[15]=1,e}function nN(e,t){var r=t[0],n=t[1],i=t[2],o=t[3],a=r+r,u=n+n,c=i+i,h=r*a,y=n*a,x=n*u,E=i*a,T=i*u,I=i*c,k=o*a,D=o*u,V=o*c;return e[0]=1-x-I,e[1]=y+V,e[2]=E-D,e[3]=0,e[4]=y-V,e[5]=1-h-I,e[6]=T+k,e[7]=0,e[8]=E+D,e[9]=T-k,e[10]=1-h-x,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function iN(e,t,r,n,i,o,a){var u=1/(r-t),c=1/(i-n),h=1/(o-a);return e[0]=o*2*u,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o*2*c,e[6]=0,e[7]=0,e[8]=(r+t)*u,e[9]=(i+n)*c,e[10]=(a+o)*h,e[11]=-1,e[12]=0,e[13]=0,e[14]=a*o*2*h,e[15]=0,e}function rR(e,t,r,n,i){var o=1/Math.tan(t/2),a;return e[0]=o/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,i!=null&&i!==1/0?(a=1/(n-i),e[10]=(i+n)*a,e[14]=2*i*n*a):(e[10]=-1,e[14]=-2*n),e}var nR=rR;function aN(e,t,r,n,i){var o=1/Math.tan(t/2),a;return e[0]=o/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,i!=null&&i!==1/0?(a=1/(n-i),e[10]=i*a,e[14]=i*n*a):(e[10]=-1,e[14]=-n),e}function oN(e,t,r,n){var i=Math.tan(t.upDegrees*Math.PI/180),o=Math.tan(t.downDegrees*Math.PI/180),a=Math.tan(t.leftDegrees*Math.PI/180),u=Math.tan(t.rightDegrees*Math.PI/180),c=2/(a+u),h=2/(i+o);return e[0]=c,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=h,e[6]=0,e[7]=0,e[8]=-((a-u)*c*.5),e[9]=(i-o)*h*.5,e[10]=n/(r-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*r/(r-n),e[15]=0,e}function iR(e,t,r,n,i,o,a){var u=1/(t-r),c=1/(n-i),h=1/(o-a);return e[0]=-2*u,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*c,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*h,e[11]=0,e[12]=(t+r)*u,e[13]=(i+n)*c,e[14]=(a+o)*h,e[15]=1,e}var sN=iR;function uN(e,t,r,n,i,o,a){var u=1/(t-r),c=1/(n-i),h=1/(o-a);return e[0]=-2*u,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*c,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=h,e[11]=0,e[12]=(t+r)*u,e[13]=(i+n)*c,e[14]=o*h,e[15]=1,e}function lN(e,t,r,n){var i,o,a,u,c,h,y,x,E,T,I=t[0],k=t[1],D=t[2],V=n[0],O=n[1],F=n[2],N=r[0],H=r[1],q=r[2];return Math.abs(I-N)<cs&&Math.abs(k-H)<cs&&Math.abs(D-q)<cs?QI(e):(y=I-N,x=k-H,E=D-q,T=1/Math.hypot(y,x,E),y*=T,x*=T,E*=T,i=O*E-F*x,o=F*y-V*E,a=V*x-O*y,T=Math.hypot(i,o,a),T?(T=1/T,i*=T,o*=T,a*=T):(i=0,o=0,a=0),u=x*a-E*o,c=E*i-y*a,h=y*o-x*i,T=Math.hypot(u,c,h),T?(T=1/T,u*=T,c*=T,h*=T):(u=0,c=0,h=0),e[0]=i,e[1]=u,e[2]=y,e[3]=0,e[4]=o,e[5]=c,e[6]=x,e[7]=0,e[8]=a,e[9]=h,e[10]=E,e[11]=0,e[12]=-(i*I+o*k+a*D),e[13]=-(u*I+c*k+h*D),e[14]=-(y*I+x*k+E*D),e[15]=1,e)}function cN(e,t,r,n){var i=t[0],o=t[1],a=t[2],u=n[0],c=n[1],h=n[2],y=i-r[0],x=o-r[1],E=a-r[2],T=y*y+x*x+E*E;T>0&&(T=1/Math.sqrt(T),y*=T,x*=T,E*=T);var I=c*E-h*x,k=h*y-u*E,D=u*x-c*y;return T=I*I+k*k+D*D,T>0&&(T=1/Math.sqrt(T),I*=T,k*=T,D*=T),e[0]=I,e[1]=k,e[2]=D,e[3]=0,e[4]=x*D-E*k,e[5]=E*I-y*D,e[6]=y*k-x*I,e[7]=0,e[8]=y,e[9]=x,e[10]=E,e[11]=0,e[12]=i,e[13]=o,e[14]=a,e[15]=1,e}function fN(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function hN(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function pN(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e[9]=t[9]+r[9],e[10]=t[10]+r[10],e[11]=t[11]+r[11],e[12]=t[12]+r[12],e[13]=t[13]+r[13],e[14]=t[14]+r[14],e[15]=t[15]+r[15],e}function aR(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e[9]=t[9]-r[9],e[10]=t[10]-r[10],e[11]=t[11]-r[11],e[12]=t[12]-r[12],e[13]=t[13]-r[13],e[14]=t[14]-r[14],e[15]=t[15]-r[15],e}function dN(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12]*r,e[13]=t[13]*r,e[14]=t[14]*r,e[15]=t[15]*r,e}function vN(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e[4]=t[4]+r[4]*n,e[5]=t[5]+r[5]*n,e[6]=t[6]+r[6]*n,e[7]=t[7]+r[7]*n,e[8]=t[8]+r[8]*n,e[9]=t[9]+r[9]*n,e[10]=t[10]+r[10]*n,e[11]=t[11]+r[11]*n,e[12]=t[12]+r[12]*n,e[13]=t[13]+r[13]*n,e[14]=t[14]+r[14]*n,e[15]=t[15]+r[15]*n,e}function mN(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function ow(e,t){var r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],u=e[5],c=e[6],h=e[7],y=e[8],x=e[9],E=e[10],T=e[11],I=e[12],k=e[13],D=e[14],V=e[15],O=t[0],F=t[1],N=t[2],H=t[3],q=t[4],Y=t[5],ee=t[6],pe=t[7],ue=t[8],ie=t[9],xe=t[10],Se=t[11],Ne=t[12],ze=t[13],Be=t[14],$e=t[15];return Math.abs(r-O)<=cs*Math.max(1,Math.abs(r),Math.abs(O))&&Math.abs(n-F)<=cs*Math.max(1,Math.abs(n),Math.abs(F))&&Math.abs(i-N)<=cs*Math.max(1,Math.abs(i),Math.abs(N))&&Math.abs(o-H)<=cs*Math.max(1,Math.abs(o),Math.abs(H))&&Math.abs(a-q)<=cs*Math.max(1,Math.abs(a),Math.abs(q))&&Math.abs(u-Y)<=cs*Math.max(1,Math.abs(u),Math.abs(Y))&&Math.abs(c-ee)<=cs*Math.max(1,Math.abs(c),Math.abs(ee))&&Math.abs(h-pe)<=cs*Math.max(1,Math.abs(h),Math.abs(pe))&&Math.abs(y-ue)<=cs*Math.max(1,Math.abs(y),Math.abs(ue))&&Math.abs(x-ie)<=cs*Math.max(1,Math.abs(x),Math.abs(ie))&&Math.abs(E-xe)<=cs*Math.max(1,Math.abs(E),Math.abs(xe))&&Math.abs(T-Se)<=cs*Math.max(1,Math.abs(T),Math.abs(Se))&&Math.abs(I-Ne)<=cs*Math.max(1,Math.abs(I),Math.abs(Ne))&&Math.abs(k-ze)<=cs*Math.max(1,Math.abs(k),Math.abs(ze))&&Math.abs(D-Be)<=cs*Math.max(1,Math.abs(D),Math.abs(Be))&&Math.abs(V-$e)<=cs*Math.max(1,Math.abs(V),Math.abs($e))}var gN=zp,yN=aR;const _N=Object.freeze(Object.defineProperty({__proto__:null,add:pN,adjoint:G7,clone:U7,copy:V7,create:Tm,determinant:H7,equals:ow,exactEquals:mN,frob:hN,fromQuat:nN,fromQuat2:Q7,fromRotation:Y7,fromRotationTranslation:eR,fromRotationTranslationScale:tN,fromRotationTranslationScaleOrigin:rN,fromScaling:X7,fromTranslation:JI,fromValues:KI,fromXRotation:q7,fromYRotation:Z7,fromZRotation:K7,frustum:iN,getRotation:eN,getScaling:tR,getTranslation:J7,identity:QI,invert:ZE,lookAt:lN,mul:gN,multiply:zp,multiplyScalar:dN,multiplyScalarAndAdd:vN,ortho:sN,orthoNO:iR,orthoZO:uN,perspective:nR,perspectiveFromFieldOfView:oN,perspectiveNO:rR,perspectiveZO:aN,rotate:W7,rotateX:Bx,rotateY:KE,rotateZ:QE,scale:$y,set:j7,str:fN,sub:yN,subtract:aR,targetTo:cN,translate:jy,transpose:$7},Symbol.toStringTag,{value:"Module"}));function D0(){var e=new Bl(3);return Bl!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function xN(e){var t=new Bl(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function oR(e){var t=e[0],r=e[1],n=e[2];return Math.hypot(t,r,n)}function Kf(e,t,r){var n=new Bl(3);return n[0]=e,n[1]=t,n[2]=r,n}function bN(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function wN(e,t,r,n){return e[0]=t,e[1]=r,e[2]=n,e}function EN(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e}function sR(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function uR(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e}function lR(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e}function SN(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function AN(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function TN(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e}function CN(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e}function MN(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e}function PN(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e}function IN(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e}function cR(e,t){var r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2];return Math.hypot(r,n,i)}function fR(e,t){var r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2];return r*r+n*n+i*i}function hR(e){var t=e[0],r=e[1],n=e[2];return t*t+r*r+n*n}function pR(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function RN(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function F0(e,t){var r=t[0],n=t[1],i=t[2],o=r*r+n*n+i*i;return o>0&&(o=1/Math.sqrt(o)),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e}function dR(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function vR(e,t,r){var n=t[0],i=t[1],o=t[2],a=r[0],u=r[1],c=r[2];return e[0]=i*c-o*u,e[1]=o*a-n*c,e[2]=n*u-i*a,e}function LN(e,t,r,n){var i=t[0],o=t[1],a=t[2];return e[0]=i+n*(r[0]-i),e[1]=o+n*(r[1]-o),e[2]=a+n*(r[2]-a),e}function kN(e,t,r,n,i,o){var a=o*o,u=a*(2*o-3)+1,c=a*(o-2)+o,h=a*(o-1),y=a*(3-2*o);return e[0]=t[0]*u+r[0]*c+n[0]*h+i[0]*y,e[1]=t[1]*u+r[1]*c+n[1]*h+i[1]*y,e[2]=t[2]*u+r[2]*c+n[2]*h+i[2]*y,e}function ON(e,t,r,n,i,o){var a=1-o,u=a*a,c=o*o,h=u*a,y=3*o*u,x=3*c*a,E=c*o;return e[0]=t[0]*h+r[0]*y+n[0]*x+i[0]*E,e[1]=t[1]*h+r[1]*y+n[1]*x+i[1]*E,e[2]=t[2]*h+r[2]*y+n[2]*x+i[2]*E,e}function DN(e,t){t=t||1;var r=VA()*2*Math.PI,n=VA()*2-1,i=Math.sqrt(1-n*n)*t;return e[0]=Math.cos(r)*i,e[1]=Math.sin(r)*i,e[2]=n*t,e}function dy(e,t,r){var n=t[0],i=t[1],o=t[2],a=r[3]*n+r[7]*i+r[11]*o+r[15];return a=a||1,e[0]=(r[0]*n+r[4]*i+r[8]*o+r[12])/a,e[1]=(r[1]*n+r[5]*i+r[9]*o+r[13])/a,e[2]=(r[2]*n+r[6]*i+r[10]*o+r[14])/a,e}function FN(e,t,r){var n=t[0],i=t[1],o=t[2];return e[0]=n*r[0]+i*r[3]+o*r[6],e[1]=n*r[1]+i*r[4]+o*r[7],e[2]=n*r[2]+i*r[5]+o*r[8],e}function NN(e,t,r){var n=r[0],i=r[1],o=r[2],a=r[3],u=t[0],c=t[1],h=t[2],y=i*h-o*c,x=o*u-n*h,E=n*c-i*u,T=i*E-o*x,I=o*y-n*E,k=n*x-i*y,D=a*2;return y*=D,x*=D,E*=D,T*=2,I*=2,k*=2,e[0]=u+y+T,e[1]=c+x+I,e[2]=h+E+k,e}function BN(e,t,r,n){var i=[],o=[];return i[0]=t[0]-r[0],i[1]=t[1]-r[1],i[2]=t[2]-r[2],o[0]=i[0],o[1]=i[1]*Math.cos(n)-i[2]*Math.sin(n),o[2]=i[1]*Math.sin(n)+i[2]*Math.cos(n),e[0]=o[0]+r[0],e[1]=o[1]+r[1],e[2]=o[2]+r[2],e}function zN(e,t,r,n){var i=[],o=[];return i[0]=t[0]-r[0],i[1]=t[1]-r[1],i[2]=t[2]-r[2],o[0]=i[2]*Math.sin(n)+i[0]*Math.cos(n),o[1]=i[1],o[2]=i[2]*Math.cos(n)-i[0]*Math.sin(n),e[0]=o[0]+r[0],e[1]=o[1]+r[1],e[2]=o[2]+r[2],e}function UN(e,t,r,n){var i=[],o=[];return i[0]=t[0]-r[0],i[1]=t[1]-r[1],i[2]=t[2]-r[2],o[0]=i[0]*Math.cos(n)-i[1]*Math.sin(n),o[1]=i[0]*Math.sin(n)+i[1]*Math.cos(n),o[2]=i[2],e[0]=o[0]+r[0],e[1]=o[1]+r[1],e[2]=o[2]+r[2],e}function sw(e,t){var r=e[0],n=e[1],i=e[2],o=t[0],a=t[1],u=t[2],c=Math.sqrt(r*r+n*n+i*i),h=Math.sqrt(o*o+a*a+u*u),y=c*h,x=y&&dR(e,t)/y;return Math.acos(Math.min(Math.max(x,-1),1))}function VN(e){return e[0]=0,e[1]=0,e[2]=0,e}function jN(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function $N(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function GN(e,t){var r=e[0],n=e[1],i=e[2],o=t[0],a=t[1],u=t[2];return Math.abs(r-o)<=cs*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(n-a)<=cs*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(i-u)<=cs*Math.max(1,Math.abs(i),Math.abs(u))}var uw=sR,HN=uR,WN=lR,XN=cR,YN=fR,qN=oR,ZN=hR,KN=function(){var e=D0();return function(t,r,n,i,o,a){var u,c;for(r||(r=3),n||(n=0),i?c=Math.min(i*r+n,t.length):c=t.length,u=n;u<c;u+=r)e[0]=t[u],e[1]=t[u+1],e[2]=t[u+2],o(e,e,a),t[u]=e[0],t[u+1]=e[1],t[u+2]=e[2];return t}}();const jb=Object.freeze(Object.defineProperty({__proto__:null,add:EN,angle:sw,bezier:ON,ceil:SN,clone:xN,copy:bN,create:D0,cross:vR,dist:XN,distance:cR,div:WN,divide:lR,dot:dR,equals:GN,exactEquals:$N,floor:AN,forEach:KN,fromValues:Kf,hermite:kN,inverse:RN,len:qN,length:oR,lerp:LN,max:CN,min:TN,mul:HN,multiply:uR,negate:pR,normalize:F0,random:DN,rotateX:BN,rotateY:zN,rotateZ:UN,round:MN,scale:PN,scaleAndAdd:IN,set:wN,sqrDist:YN,sqrLen:ZN,squaredDistance:fR,squaredLength:hR,str:jN,sub:uw,subtract:sR,transformMat3:FN,transformMat4:dy,transformQuat:NN,zero:VN},Symbol.toStringTag,{value:"Module"}));function mR(){var e=new Bl(4);return Bl!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function QN(e,t,r,n){var i=new Bl(4);return i[0]=e,i[1]=t,i[2]=r,i[3]=n,i}function JN(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function JE(e,t,r){var n=t[0],i=t[1],o=t[2],a=t[3];return e[0]=r[0]*n+r[4]*i+r[8]*o+r[12]*a,e[1]=r[1]*n+r[5]*i+r[9]*o+r[13]*a,e[2]=r[2]*n+r[6]*i+r[10]*o+r[14]*a,e[3]=r[3]*n+r[7]*i+r[11]*o+r[15]*a,e}(function(){var e=mR();return function(t,r,n,i,o,a){var u,c;for(r||(r=4),n||(n=0),i?c=Math.min(i*r+n,t.length):c=t.length,u=n;u<c;u+=r)e[0]=t[u],e[1]=t[u+1],e[2]=t[u+2],e[3]=t[u+3],o(e,e,a),t[u]=e[0],t[u+1]=e[1],t[u+2]=e[2],t[u+3]=e[3];return t}})();function ca(){var e=new Bl(2);return Bl!=Float32Array&&(e[0]=0,e[1]=0),e}function W0(e,t){var r=new Bl(2);return r[0]=e,r[1]=t,r}function Dp(e,t){return e[0]=t[0],e[1]=t[1],e}function gR(e,t,r){return e[0]=t,e[1]=r,e}function Ds(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e}function Rm(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}function eB(e,t){return e[0]=-t[0],e[1]=-t[1],e}function Up(e,t){var r=t[0],n=t[1],i=r*r+n*n;return i>0&&(i=1/Math.sqrt(i)),e[0]=t[0]*i,e[1]=t[1]*i,e}function Tv(e,t){return e[0]*t[0]+e[1]*t[1]}function tB(e,t,r,n){var i=t[0],o=t[1];return e[0]=i+n*(r[0]-i),e[1]=o+n*(r[1]-o),e}var X0=Rm;(function(){var e=ca();return function(t,r,n,i,o,a){var u,c;for(r||(r=2),n||(n=0),i?c=Math.min(i*r+n,t.length):c=t.length,u=n;u<c;u+=r)e[0]=t[u],e[1]=t[u+1],o(e,e,a),t[u]=e[0],t[u+1]=e[1];return t}})();var t1=ca();ca();var su=ca(),lv=ca(),m0=ca();function $b(e,t,r,n,i){Ds(e,r,n),Up(e,e),t=W0(-e[1],e[0]);var o=W0(-r[1],r[0]);return[i/Tv(t,o),t]}function cv(e,t){return gR(e,-t[1],t[0])}function g0(e,t,r){return X0(e,t,r),Up(e,e),e}function Gb(e,t){return e[0]===t[0]&&e[1]===t[1]}var rB=function(){function e(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};$t(this,e),Q(this,"lastFlip",-1),Q(this,"miter",W0(0,0)),Q(this,"started",!1),Q(this,"dash",!1),Q(this,"totalDistance",0),Q(this,"currentIndex",0),this.join=t.join||"miter",this.cap=t.cap||"butt",this.miterLimit=t.miterLimit||10,this.thickness=t.thickness||1,this.dash=t.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return Gt(e,[{key:"extrude_gaode2",value:function(r,n){var i=this.complex;if(r.length<=1)return i;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var o=r.length,a=i.startIndex,u=1;u<o;u++){var c,h,y,x=r[u-1];x.push((c=n[u-1][2])!==null&&c!==void 0?c:0);var E=n[u-1],T=r[u];T.push((h=n[u][2])!==null&&h!==void 0?h:0);var I=n[u],k=u<r.length-1?[].concat(cn(r[u+1]),[(y=n[u+1][2])!==null&&y!==void 0?y:0]):null,D=u<n.length-1?n[u+1]:null,V=this.segment_gaode2(i,a,x,T,k,E,I,D);a+=V}if(this.dash)for(var O=0;O<i.positions.length/6;O++)i.positions[O*6+5]=this.totalDistance;return i.startIndex=i.positions.length/6,i}},{key:"simpleExtrude_gaode2",value:function(r,n){var i=this.complex;if(r.length<=1)return i;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var o=r.length,a=i.startIndex,u=1;u<o;u++){var c,h,y,x=r[u-1];x.push((c=n[u-1][2])!==null&&c!==void 0?c:0);var E=n[u-1],T=r[u];T.push((h=n[u][2])!==null&&h!==void 0?h:0);var I=n[u],k=u<r.length-1?[].concat(cn(r[u+1]),[(y=n[u+1][2])!==null&&y!==void 0?y:0]):null,D=u<n.length-1?n[u+1]:null,V=this.simpleSegment(i,a,x,T,k,E,I,D);a+=V}if(this.dash)for(var O=0;O<i.positions.length/6;O++)i.positions[O*6+5]=this.totalDistance;return i.startIndex=i.positions.length/6,i}},{key:"extrude",value:function(r){var n=this.complex;if(r.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var i=r.length,o=n.startIndex,a=1;a<i;a++){var u=r[a-1],c=r[a],h=a<r.length-1?r[a+1]:null,y=this.segment(n,o,u,c,h);o+=y}if(this.dash)for(var x=0;x<n.positions.length/6;x++)n.positions[x*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleExtrude",value:function(r){var n=this.complex;if(r.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var i=r.length,o=n.startIndex,a=1;a<i;a++){var u=r[a-1],c=r[a],h=a<r.length-1?r[a+1]:null,y=this.simpleSegment(n,o,u,c,h);o+=y}if(this.dash)for(var x=0;x<n.positions.length/6;x++)n.positions[x*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"segment_gaode2",value:function(r,n,i,o,a,u,c,h){var y=0,x=r.indices,E=r.positions,T=r.normals,I=this.cap==="square",k=this.join==="bevel",D=Vu([c[0],c[1]]),V=Vu([u[0],u[1]]);g0(su,o,i);var O=0;if(this.dash&&(O=this.lineSegmentDistance(D,V),this.totalDistance+=O),this.normal||(this.normal=ca(),cv(this.normal,su)),!this.started)if(this.started=!0,I){var F=ca(),N=ca();Ds(F,this.normal,su),Ds(N,this.normal,su),T.push(N[0],N[1],0),T.push(F[0],F[1],0),E.push(i[0],i[1],i[2]|0,this.totalDistance-O,-this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),E.push(i[0],i[1],i[2]|0,this.totalDistance-O,this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(E,T,i,this.normal,this.thickness,this.totalDistance-O);if(x.push(n+0,n+1,n+2),a){Gb(o,a)&&Ds(a,o,Up(a,Rm(a,o,i))),g0(lv,a,o);var Y=$b(m0,ca(),su,lv,this.thickness),ee=ei(Y,2),pe=ee[0],ue=ee[1],ie=Tv(m0,this.normal)<0?-1:1,xe=k;if(!xe&&this.join==="miter"){var Se=pe;Se>this.miterLimit&&(xe=!0)}xe?(T.push(this.normal[0],this.normal[1],0),T.push(ue[0],ue[1],0),E.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*ie,o[2]|0),this.complex.indexes.push(this.currentIndex),E.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness*ie,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,x.push.apply(x,cn(this.lastFlip!==-ie?[n,n+2,n+3]:[n+2,n+1,n+3])),x.push(n+2,n+3,n+4),cv(t1,lv),Dp(this.normal,t1),T.push(this.normal[0],this.normal[1],0),E.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*ie,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,y+=3):(this.extrusions(E,T,o,ue,pe,this.totalDistance),x.push.apply(x,cn(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),ie=-1,Dp(this.normal,ue),y+=2),this.lastFlip=ie}else{if(cv(this.normal,su),I){var H=ca(),q=ca();X0(q,su,this.normal),Ds(H,su,this.normal),T.push(q[0],q[1],0),T.push(H[0],H[1],0),E.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),E.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(E,T,o,this.normal,this.thickness,this.totalDistance);x.push.apply(x,cn(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),y+=2}return y}},{key:"simpleSegment",value:function(r,n,i,o,a){var u=0,c=r.indices,h=r.positions,y=r.normals,x=Vu([o[0],o[1]]),E=Vu([i[0],i[1]]);g0(su,x,E);var T=0;if(this.dash&&(T=this.lineSegmentDistance(x,E),this.totalDistance+=T),this.normal||(this.normal=ca(),cv(this.normal,su)),this.started||(this.started=!0,this.extrusions(h,y,i,this.normal,this.thickness,this.totalDistance-T)),c.push(n+0,n+1,n+2),!a)cv(this.normal,su),this.extrusions(h,y,o,this.normal,this.thickness,this.totalDistance),c.push.apply(c,cn(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),u+=2;else{var I=Vu([a[0],a[1]]);Gb(x,I)&&Ds(I,x,Up(I,Rm(I,x,E))),g0(lv,I,x);var k=$b(m0,ca(),su,lv,this.thickness),D=ei(k,2),V=D[0],O=D[1],F=Tv(m0,this.normal)<0?-1:1;this.extrusions(h,y,o,O,V,this.totalDistance),c.push.apply(c,cn(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),F=-1,Dp(this.normal,O),u+=2,this.lastFlip=F}return u}},{key:"segment",value:function(r,n,i,o,a){var u=0,c=r.indices,h=r.positions,y=r.normals,x=this.cap==="square",E=this.join==="bevel",T=Vu([o[0],o[1]]),I=Vu([i[0],i[1]]);g0(su,T,I);var k=0;if(this.dash&&(k=this.lineSegmentDistance(T,I),this.totalDistance+=k),this.normal||(this.normal=ca(),cv(this.normal,su)),!this.started)if(this.started=!0,x){var D=ca(),V=ca();Ds(D,this.normal,su),Ds(V,this.normal,su),y.push(V[0],V[1],0),y.push(D[0],D[1],0),h.push(i[0],i[1],i[2]|0,this.totalDistance-k,-this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),h.push(i[0],i[1],i[2]|0,this.totalDistance-k,this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(h,y,i,this.normal,this.thickness,this.totalDistance-k);if(c.push(n+0,n+1,n+2),a){var N=Vu([a[0],a[1]]);Gb(T,N)&&Ds(N,T,Up(N,Rm(N,T,I))),g0(lv,N,T);var H=$b(m0,ca(),su,lv,this.thickness),q=ei(H,2),Y=q[0],ee=q[1],pe=Tv(m0,this.normal)<0?-1:1,ue=E;if(!ue&&this.join==="miter"){var ie=Y;ie>this.miterLimit&&(ue=!0)}ue?(y.push(this.normal[0],this.normal[1],0),y.push(ee[0],ee[1],0),h.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*pe,o[2]|0),this.complex.indexes.push(this.currentIndex),h.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness*pe,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,c.push.apply(c,cn(this.lastFlip!==-pe?[n,n+2,n+3]:[n+2,n+1,n+3])),c.push(n+2,n+3,n+4),cv(t1,lv),Dp(this.normal,t1),y.push(this.normal[0],this.normal[1],0),h.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*pe,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,u+=3):(this.extrusions(h,y,o,ee,Y,this.totalDistance),c.push.apply(c,cn(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),pe=-1,Dp(this.normal,ee),u+=2),this.lastFlip=pe}else{if(cv(this.normal,su),x){var O=ca(),F=ca();X0(F,su,this.normal),Ds(O,su,this.normal),y.push(F[0],F[1],0),y.push(O[0],O[1],0),h.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),h.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(h,y,o,this.normal,this.thickness,this.totalDistance);c.push.apply(c,cn(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),u+=2}return u}},{key:"extrusions",value:function(r,n,i,o,a,u){n.push(o[0],o[1],0),n.push(o[0],o[1],0),r.push(i[0],i[1],i[2]|0,u,-a,i[2]|0),this.complex.indexes.push(this.currentIndex),r.push(i[0],i[1],i[2]|0,u,a,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(r,n){var i=n[0]-r[0],o=n[1]-r[1];return Math.sqrt(i*i+o*o)}}]),e}();function lw(e){var t=e.coordinates,r=e.originCoordinates,n=e.version,i=new rB({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var o=t;Array.isArray(o[0][0])||(o=[t]);var a=r;Array.isArray(a[0][0])||(a=[r]);for(var u=0;u<o.length;u++){var c=o[u],h=a[u];i.extrude_gaode2(c,h)}}else{var y=t;y[0]&&!Array.isArray(y[0][0])&&(y=[t]),y.forEach(function(E){i.extrude(E)})}var x=i.complex;return{vertices:x.positions,indices:x.indices,normals:x.normals,indexes:x.indexes,size:6}}function P1(e){var t=Id(e.coordinates);return{vertices:[].concat(cn(t),cn(t),cn(t),cn(t)),indices:[0,1,2,2,3,0],size:t.length}}function yR(e){var t=e.coordinates,r=Iv.flatten(t),n=r.vertices,i=r.dimensions,o=r.holes,a=Iv(n,o,i);return{indices:a,vertices:n,size:i}}var nB=function(){var e=Vt(Ce.mark(function t(r){var n,i,o,a,u,c,h,y,x;return Ce.wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return n=r.descriptors,i=r.features,o=r.enablePicking,a=r.iconMap,u={a_Color:HE,a_Position:WE,filter:XE,a_vertexId:YE,a_PickingColor:function(k){var D=k.id;return o?Dd(D):[0,0,0]},a_DistanceAndIndex:function(k,D,V,O,F,N){return N===void 0?[V[3],10]:[V[3],N]},a_Total_Distance:function(k,D,V){return[V[5]]},a_Size:function(k){var D=k.size,V=D===void 0?1:D;return Array.isArray(V)?[V[0],V[1]]:[V,0]},a_Normal:function(k,D,V,O,F){return F},a_Miter:function(k,D,V){return[V[4]]},a_iconMapUV:function(k){var D=k.texture,V=a[D]||{x:0,y:0},O=V.x,F=V.y;return[O,F]}},c={sizePerElement:0,elements:[]},h=0,y=[],x=3,i.forEach(function(I,k){var D=lw(I),V=D.indices,O=D.vertices,F=D.normals,N=D.size,H=D.indexes;V.forEach(function(pe){y.push(pe+h)}),x=N;var q=O.length/N;c.sizePerElement=x,c.elements.push({featureIdx:k,vertices:O,normals:F,offset:h}),h+=q;for(var Y=function(ue){var ie=(F==null?void 0:F.slice(ue*3,ue*3+3))||[],xe=O.slice(ue*N,ue*N+N),Se=0;H&&H[ue]!==void 0&&(Se=H[ue]),n.forEach(function(Ne){if(Ne&&u[Ne.name]){var ze;(ze=Ne.buffer.data).push.apply(ze,cn(u[Ne.name](I,k,xe,ue,ie,Se)))}})},ee=0;ee<q;ee++)Y(ee)}),T.abrupt("return",{descriptors:n,featureLayout:c,indices:y});case 8:case"end":return T.stop()}},t)}));return function(r){return e.apply(this,arguments)}}(),iB=function(){var e=Vt(Ce.mark(function t(r){var n,i,o,a,u,c,h,y,x;return Ce.wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return n=r.descriptors,i=r.features,o=r.enablePicking,a=r.shape2d,u={a_Color:HE,a_Position:WE,filter:XE,a_vertexId:YE,a_PickingColor:function(k){var D=k.id;return o?Dd(D):[0,0,0]},a_Shape:function(k){var D=k.shape,V=D===void 0?2:D,O=a.indexOf(V);return[O]},a_Extrude:function(k,D,V,O){var F=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],N=O%4*3;return[F[N],F[N+1],F[N+2]]},a_Size:function(k){var D=k.size,V=D===void 0?5:D;return Array.isArray(V)?[V[0]]:[V]}},c={sizePerElement:0,elements:[]},h=0,y=[],x=3,i.forEach(function(I,k){var D=P1(I),V=D.indices,O=D.vertices,F=D.normals,N=D.size,H=D.indexes;V.forEach(function(pe){y.push(pe+h)}),x=N;var q=O.length/N;c.sizePerElement=x,c.elements.push({featureIdx:k,vertices:O,normals:F,offset:h}),h+=q;for(var Y=function(ue){var ie=(F==null?void 0:F.slice(ue*3,ue*3+3))||[],xe=O.slice(ue*N,ue*N+N),Se=0;H&&H[ue]!==void 0&&(Se=H[ue]),n.forEach(function(Ne){if(Ne&&u[Ne.name]){var ze;(ze=Ne.buffer.data).push.apply(ze,cn(u[Ne.name](I,k,xe,ue,ie,Se)))}})},ee=0;ee<q;ee++)Y(ee)}),T.abrupt("return",{descriptors:n,featureLayout:c,indices:y});case 8:case"end":return T.stop()}},t)}));return function(r){return e.apply(this,arguments)}}(),aB=function(){var e=Vt(Ce.mark(function t(r){var n,i,o,a,u,c,h,y;return Ce.wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return n=r.descriptors,i=r.features,o=r.enablePicking,a={a_Color:HE,a_Position:WE,filter:XE,a_vertexId:YE,a_PickingColor:function(I){var k=I.id;return o?Dd(k):[0,0,0]}},u={sizePerElement:0,elements:[]},c=0,h=[],y=3,i.forEach(function(T,I){var k=yR(T),D=k.indices,V=k.vertices,O=k.normals,F=k.size,N=k.indexes;D.forEach(function(ee){h.push(ee+c)}),y=F;var H=V.length/F;u.sizePerElement=y,u.elements.push({featureIdx:I,vertices:V,normals:O,offset:c}),c+=H;for(var q=function(pe){var ue=(O==null?void 0:O.slice(pe*3,pe*3+3))||[],ie=V.slice(pe*F,pe*F+F),xe=0;N&&N[pe]!==void 0&&(xe=N[pe]),n.forEach(function(Se){if(Se&&a[Se.name]){var Ne;(Ne=Se.buffer.data).push.apply(Ne,cn(a[Se.name](T,I,ie,pe,ue,xe)))}})},Y=0;Y<H;Y++)q(Y)}),E.abrupt("return",{descriptors:n,featureLayout:u,indices:h});case 8:case"end":return E.stop()}},t)}));return function(r){return e.apply(this,arguments)}}(),oB={pointFill:iB,line:nB,polygonFill:aB},jA=_t({},oB);function sB(e){return cw.apply(this,arguments)}function cw(){return cw=Vt(Ce.mark(function e(t){var r,n;return Ce.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(r=t.workerType,n=t.data,!jA[r]){o.next=3;break}return o.abrupt("return",jA[r](n));case 3:return o.abrupt("return",Promise.reject(new Error('Worker with type "'.concat(r,'" non-existent.'))));case 4:case"end":return o.stop()}},e)})),cw.apply(this,arguments)}w7(sB);var uB=new Map;function lB(e,t){uB.set(e,t)}var cB=`var L7=function(t){"use strict";function e(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function r(){r=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function c(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function f(t,e,r,n){var i=e&&e.prototype instanceof p?e:p,a=Object.create(i.prototype),u=new T(n||[]);return o(a,"_invoke",{value:E(t,r,u)}),a}function l(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=f;var h={};function p(){}function v(){}function d(){}var y={};c(y,a,(function(){return this}));var g=Object.getPrototypeOf,m=g&&g(g(k([])));m&&m!==e&&n.call(m,a)&&(y=m);var b=d.prototype=p.prototype=Object.create(y);function x(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){var r;o(this,"_invoke",{value:function(o,i){function a(){return new e((function(r,a){!function r(o,i,a,u){var s=l(t[o],t,i);if("throw"!==s.type){var c=s.arg,f=c.value;return f&&"object"==typeof f&&n.call(f,"__await")?e.resolve(f.__await).then((function(t){r("next",t,a,u)}),(function(t){r("throw",t,a,u)})):e.resolve(f).then((function(t){c.value=t,a(c)}),(function(t){return r("throw",t,a,u)}))}u(s.arg)}(o,i,r,a)}))}return r=r?r.then(a,a):a()}})}function E(t,e,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return I()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var u=A(a,r);if(u){if(u===h)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var s=l(t,e,r);if("normal"===s.type){if(n=r.done?"completed":"suspendedYield",s.arg===h)continue;return{value:s.arg,done:r.done}}"throw"===s.type&&(n="completed",r.method="throw",r.arg=s.arg)}}}function A(t,e){var r=e.method,n=t.iterator[r];if(void 0===n)return e.delegate=null,"throw"===r&&t.iterator.return&&(e.method="return",e.arg=void 0,A(t,e),"throw"===e.method)||"return"!==r&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+r+"' method")),h;var o=l(n,t.iterator,e.arg);if("throw"===o.type)return e.method="throw",e.arg=o.arg,e.delegate=null,h;var i=o.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,h):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,h)}function O(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function S(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function T(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(O,this),this.reset(!0)}function k(t){if(t){var e=t[a];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:I}}function I(){return{value:void 0,done:!0}}return v.prototype=d,o(b,"constructor",{value:d,configurable:!0}),o(d,"constructor",{value:v,configurable:!0}),v.displayName=c(d,s,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===v||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,c(t,s,"GeneratorFunction")),t.prototype=Object.create(b),t},t.awrap=function(t){return{__await:t}},x(w.prototype),c(w.prototype,u,(function(){return this})),t.AsyncIterator=w,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new w(f(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},x(b),c(b,s,"Generator"),c(b,a,(function(){return this})),c(b,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},t.values=k,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(S),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),s=n.call(i,"finallyLoc");if(u&&s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,h):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),h},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),S(r),h}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;S(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:k(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),h}},t}function n(t,e,r,n,o,i,a){try{var u=t[i](a),s=u.value}catch(t){return void r(t)}u.done?e(s):Promise.resolve(s).then(n,o)}function o(t){return function(){var e=this,r=arguments;return new Promise((function(o,i){var a=t.apply(e,r);function u(t){n(a,o,i,u,s,"next",t)}function s(t){n(a,o,i,u,s,"throw",t)}u(void 0)}))}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,b(n.key),n)}}function u(t,e,r){return e&&a(t.prototype,e),r&&a(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function s(t,e,r){return(e=b(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function c(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&l(t,e)}function f(t){return(f=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function l(t,e){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function h(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function p(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return h(t)}function v(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=f(t);if(e){var o=f(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return p(this,r)}}function d(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,u=[],s=!0,c=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;s=!1}else for(;!(s=(n=i.call(r)).done)&&(u.push(n.value),u.length!==e);s=!0);}catch(t){c=!0,o=t}finally{try{if(!s&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw o}}return u}}(t,e)||g(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(t){return function(t){if(Array.isArray(t))return m(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||g(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function g(t,e){if(t){if("string"==typeof t)return m(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?m(t,e):void 0}}function m(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function b(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}var x="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function w(t,e){return t(e={exports:{}},e.exports),e.exports}var E,A,O=function(t){return t&&t.Math==Math&&t},S=O("object"==typeof globalThis&&globalThis)||O("object"==typeof window&&window)||O("object"==typeof self&&self)||O("object"==typeof x&&x)||function(){return this}()||x||Function("return this")(),T=Object.defineProperty,k=function(t,e){try{T(S,t,{value:e,configurable:!0,writable:!0})}catch(r){S[t]=e}return e},I=S["__core-js_shared__"]||k("__core-js_shared__",{}),j=w((function(t){(t.exports=function(t,e){return I[t]||(I[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.30.2",mode:"global",copyright:"© 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.30.2/LICENSE",source:"https://github.com/zloirock/core-js"})})),P=function(t){try{return!!t()}catch(t){return!0}},_=!P((function(){var t=function(){}.bind();return"function"!=typeof t||t.hasOwnProperty("prototype")})),M=Function.prototype,L=M.call,R=_&&M.bind.bind(L,L),N=_?R:function(t){return function(){return L.apply(t,arguments)}},C=function(t){return null==t},D=TypeError,F=function(t){if(C(t))throw D("Can't call method on "+t);return t},W=Object,z=function(t){return W(F(t))},B=N({}.hasOwnProperty),U=Object.hasOwn||function(t,e){return B(z(t),e)},G=0,V=Math.random(),H=N(1..toString),q=function(t){return"Symbol("+(void 0===t?"":t)+")_"+H(++G+V,36)},Z="undefined"!=typeof navigator&&String(navigator.userAgent)||"",Y=S.process,$=S.Deno,K=Y&&Y.versions||$&&$.version,Q=K&&K.v8;Q&&(A=(E=Q.split("."))[0]>0&&E[0]<4?1:+(E[0]+E[1])),!A&&Z&&(!(E=Z.match(/Edge\\/(\\d+)/))||E[1]>=74)&&(E=Z.match(/Chrome\\/(\\d+)/))&&(A=+E[1]);var X=A,J=S.String,tt=!!Object.getOwnPropertySymbols&&!P((function(){var t=Symbol();return!J(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&X&&X<41})),et=tt&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,rt=S.Symbol,nt=j("wks"),ot=et?rt.for||rt:rt&&rt.withoutSetter||q,it=function(t){return U(nt,t)||(nt[t]=tt&&U(rt,t)?rt[t]:ot("Symbol."+t)),nt[t]},at={};at[it("toStringTag")]="z";var ut="[object z]"===String(at),st="object"==typeof document&&document.all,ct={all:st,IS_HTMLDDA:void 0===st&&void 0!==st},ft=ct.all,lt=ct.IS_HTMLDDA?function(t){return"function"==typeof t||t===ft}:function(t){return"function"==typeof t},ht=!P((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),pt=ct.all,vt=ct.IS_HTMLDDA?function(t){return"object"==typeof t?null!==t:lt(t)||t===pt}:function(t){return"object"==typeof t?null!==t:lt(t)},dt=S.document,yt=vt(dt)&&vt(dt.createElement),gt=function(t){return yt?dt.createElement(t):{}},mt=!ht&&!P((function(){return 7!=Object.defineProperty(gt("div"),"a",{get:function(){return 7}}).a})),bt=ht&&P((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),xt=String,wt=TypeError,Et=function(t){if(vt(t))return t;throw wt(xt(t)+" is not an object")},At=Function.prototype.call,Ot=_?At.bind(At):function(){return At.apply(At,arguments)},St=function(t){return lt(t)?t:void 0},Tt=function(t,e){return arguments.length<2?St(S[t]):S[t]&&S[t][e]},kt=N({}.isPrototypeOf),It=Object,jt=et?function(t){return"symbol"==typeof t}:function(t){var e=Tt("Symbol");return lt(e)&&kt(e.prototype,It(t))},Pt=String,_t=function(t){try{return Pt(t)}catch(t){return"Object"}},Mt=TypeError,Lt=function(t){if(lt(t))return t;throw Mt(_t(t)+" is not a function")},Rt=function(t,e){var r=t[e];return C(r)?void 0:Lt(r)},Nt=TypeError,Ct=TypeError,Dt=it("toPrimitive"),Ft=function(t,e){if(!vt(t)||jt(t))return t;var r,n=Rt(t,Dt);if(n){if(void 0===e&&(e="default"),r=Ot(n,t,e),!vt(r)||jt(r))return r;throw Ct("Can't convert object to primitive value")}return void 0===e&&(e="number"),function(t,e){var r,n;if("string"===e&&lt(r=t.toString)&&!vt(n=Ot(r,t)))return n;if(lt(r=t.valueOf)&&!vt(n=Ot(r,t)))return n;if("string"!==e&&lt(r=t.toString)&&!vt(n=Ot(r,t)))return n;throw Nt("Can't convert object to primitive value")}(t,e)},Wt=function(t){var e=Ft(t,"string");return jt(e)?e:e+""},zt=TypeError,Bt=Object.defineProperty,Ut=Object.getOwnPropertyDescriptor,Gt={f:ht?bt?function(t,e,r){if(Et(t),e=Wt(e),Et(r),"function"==typeof t&&"prototype"===e&&"value"in r&&"writable"in r&&!r.writable){var n=Ut(t,e);n&&n.writable&&(t[e]=r.value,r={configurable:"configurable"in r?r.configurable:n.configurable,enumerable:"enumerable"in r?r.enumerable:n.enumerable,writable:!1})}return Bt(t,e,r)}:Bt:function(t,e,r){if(Et(t),e=Wt(e),Et(r),mt)try{return Bt(t,e,r)}catch(t){}if("get"in r||"set"in r)throw zt("Accessors not supported");return"value"in r&&(t[e]=r.value),t}},Vt=Function.prototype,Ht=ht&&Object.getOwnPropertyDescriptor,qt=U(Vt,"name"),Zt={EXISTS:qt,PROPER:qt&&"something"===function(){}.name,CONFIGURABLE:qt&&(!ht||ht&&Ht(Vt,"name").configurable)},Yt=N(Function.toString);lt(I.inspectSource)||(I.inspectSource=function(t){return Yt(t)});var $t,Kt,Qt,Xt=I.inspectSource,Jt=S.WeakMap,te=lt(Jt)&&/native code/.test(String(Jt)),ee=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},re=ht?function(t,e,r){return Gt.f(t,e,ee(1,r))}:function(t,e,r){return t[e]=r,t},ne=j("keys"),oe=function(t){return ne[t]||(ne[t]=q(t))},ie={},ae=S.TypeError,ue=S.WeakMap;if(te||I.state){var se=I.state||(I.state=new ue);se.get=se.get,se.has=se.has,se.set=se.set,$t=function(t,e){if(se.has(t))throw ae("Object already initialized");return e.facade=t,se.set(t,e),e},Kt=function(t){return se.get(t)||{}},Qt=function(t){return se.has(t)}}else{var ce=oe("state");ie[ce]=!0,$t=function(t,e){if(U(t,ce))throw ae("Object already initialized");return e.facade=t,re(t,ce,e),e},Kt=function(t){return U(t,ce)?t[ce]:{}},Qt=function(t){return U(t,ce)}}var fe={set:$t,get:Kt,has:Qt,enforce:function(t){return Qt(t)?Kt(t):$t(t,{})},getterFor:function(t){return function(e){var r;if(!vt(e)||(r=Kt(e)).type!==t)throw ae("Incompatible receiver, "+t+" required");return r}}},le=w((function(t){var e=Zt.CONFIGURABLE,r=fe.enforce,n=fe.get,o=String,i=Object.defineProperty,a=N("".slice),u=N("".replace),s=N([].join),c=ht&&!P((function(){return 8!==i((function(){}),"length",{value:8}).length})),f=String(String).split("String"),l=t.exports=function(t,n,l){"Symbol("===a(o(n),0,7)&&(n="["+u(o(n),/^Symbol\\(([^)]*)\\)/,"$1")+"]"),l&&l.getter&&(n="get "+n),l&&l.setter&&(n="set "+n),(!U(t,"name")||e&&t.name!==n)&&(ht?i(t,"name",{value:n,configurable:!0}):t.name=n),c&&l&&U(l,"arity")&&t.length!==l.arity&&i(t,"length",{value:l.arity});try{l&&U(l,"constructor")&&l.constructor?ht&&i(t,"prototype",{writable:!1}):t.prototype&&(t.prototype=void 0)}catch(t){}var h=r(t);return U(h,"source")||(h.source=s(f,"string"==typeof n?n:"")),t};Function.prototype.toString=l((function(){return lt(this)&&n(this).source||Xt(this)}),"toString")})),he=function(t,e,r,n){n||(n={});var o=n.enumerable,i=void 0!==n.name?n.name:e;if(lt(r)&&le(r,i,n),n.global)o?t[e]=r:k(e,r);else{try{n.unsafe?t[e]&&(o=!0):delete t[e]}catch(t){}o?t[e]=r:Gt.f(t,e,{value:r,enumerable:!1,configurable:!n.nonConfigurable,writable:!n.nonWritable})}return t},pe=N({}.toString),ve=N("".slice),de=function(t){return ve(pe(t),8,-1)},ye=it("toStringTag"),ge=Object,me="Arguments"==de(function(){return arguments}()),be=ut?de:function(t){var e,r,n;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(r=function(t,e){try{return t[e]}catch(t){}}(e=ge(t),ye))?r:me?de(e):"Object"==(n=de(e))&&lt(e.callee)?"Arguments":n},xe=ut?{}.toString:function(){return"[object "+be(this)+"]"};ut||he(Object.prototype,"toString",xe,{unsafe:!0});var we={}.propertyIsEnumerable,Ee=Object.getOwnPropertyDescriptor,Ae={f:Ee&&!we.call({1:2},1)?function(t){var e=Ee(this,t);return!!e&&e.enumerable}:we},Oe=Object,Se=N("".split),Te=P((function(){return!Oe("z").propertyIsEnumerable(0)}))?function(t){return"String"==de(t)?Se(t,""):Oe(t)}:Oe,ke=function(t){return Te(F(t))},Ie=Object.getOwnPropertyDescriptor,je={f:ht?Ie:function(t,e){if(t=ke(t),e=Wt(e),mt)try{return Ie(t,e)}catch(t){}if(U(t,e))return ee(!Ot(Ae.f,t,e),t[e])}},Pe=Math.ceil,_e=Math.floor,Me=Math.trunc||function(t){var e=+t;return(e>0?_e:Pe)(e)},Le=function(t){var e=+t;return e!=e||0===e?0:Me(e)},Re=Math.max,Ne=Math.min,Ce=function(t,e){var r=Le(t);return r<0?Re(r+e,0):Ne(r,e)},De=Math.min,Fe=function(t){return t>0?De(Le(t),9007199254740991):0},We=function(t){return Fe(t.length)},ze=function(t){return function(e,r,n){var o,i=ke(e),a=We(i),u=Ce(n,a);if(t&&r!=r){for(;a>u;)if((o=i[u++])!=o)return!0}else for(;a>u;u++)if((t||u in i)&&i[u]===r)return t||u||0;return!t&&-1}},Be={includes:ze(!0),indexOf:ze(!1)},Ue=Be.indexOf,Ge=N([].push),Ve=function(t,e){var r,n=ke(t),o=0,i=[];for(r in n)!U(ie,r)&&U(n,r)&&Ge(i,r);for(;e.length>o;)U(n,r=e[o++])&&(~Ue(i,r)||Ge(i,r));return i},He=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],qe=He.concat("length","prototype"),Ze={f:Object.getOwnPropertyNames||function(t){return Ve(t,qe)}},Ye={f:Object.getOwnPropertySymbols},$e=N([].concat),Ke=Tt("Reflect","ownKeys")||function(t){var e=Ze.f(Et(t)),r=Ye.f;return r?$e(e,r(t)):e},Qe=function(t,e,r){for(var n=Ke(e),o=Gt.f,i=je.f,a=0;a<n.length;a++){var u=n[a];U(t,u)||r&&U(r,u)||o(t,u,i(e,u))}},Xe=/#|\\.prototype\\./,Je=function(t,e){var r=er[tr(t)];return r==nr||r!=rr&&(lt(e)?P(e):!!e)},tr=Je.normalize=function(t){return String(t).replace(Xe,".").toLowerCase()},er=Je.data={},rr=Je.NATIVE="N",nr=Je.POLYFILL="P",or=Je,ir=je.f,ar=function(t,e){var r,n,o,i,a,u=t.target,s=t.global,c=t.stat;if(r=s?S:c?S[u]||k(u,{}):(S[u]||{}).prototype)for(n in e){if(i=e[n],o=t.dontCallGetSet?(a=ir(r,n))&&a.value:r[n],!or(s?n:u+(c?".":"#")+n,t.forced)&&void 0!==o){if(typeof i==typeof o)continue;Qe(i,o)}(t.sham||o&&o.sham)&&re(i,"sham",!0),he(r,n,i,t)}},ur="undefined"!=typeof process&&"process"==de(process),sr=String,cr=TypeError,fr=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,r={};try{(t=function(t,e,r){try{return N(Lt(Object.getOwnPropertyDescriptor(t,e)[r]))}catch(t){}}(Object.prototype,"__proto__","set"))(r,[]),e=r instanceof Array}catch(t){}return function(r,n){return Et(r),function(t){if("object"==typeof t||lt(t))return t;throw cr("Can't set "+sr(t)+" as a prototype")}(n),e?t(r,n):r.__proto__=n,r}}():void 0),lr=Gt.f,hr=it("toStringTag"),pr=function(t,e,r){t&&!r&&(t=t.prototype),t&&!U(t,hr)&&lr(t,hr,{configurable:!0,value:e})},vr=function(t,e,r){return r.get&&le(r.get,e,{getter:!0}),r.set&&le(r.set,e,{setter:!0}),Gt.f(t,e,r)},dr=it("species"),yr=function(t){var e=Tt(t);ht&&e&&!e[dr]&&vr(e,dr,{configurable:!0,get:function(){return this}})},gr=TypeError,mr=function(t,e){if(kt(e,t))return t;throw gr("Incorrect invocation")},br=function(){},xr=[],wr=Tt("Reflect","construct"),Er=/^\\s*(?:class|function)\\b/,Ar=N(Er.exec),Or=!Er.exec(br),Sr=function(t){if(!lt(t))return!1;try{return wr(br,xr,t),!0}catch(t){return!1}},Tr=function(t){if(!lt(t))return!1;switch(be(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return Or||!!Ar(Er,Xt(t))}catch(t){return!0}};Tr.sham=!0;var kr,Ir,jr,Pr,_r=!wr||P((function(){var t;return Sr(Sr.call)||!Sr(Object)||!Sr((function(){t=!0}))||t}))?Tr:Sr,Mr=TypeError,Lr=function(t){if(_r(t))return t;throw Mr(_t(t)+" is not a constructor")},Rr=it("species"),Nr=function(t,e){var r,n=Et(t).constructor;return void 0===n||C(r=Et(n)[Rr])?e:Lr(r)},Cr=Function.prototype,Dr=Cr.apply,Fr=Cr.call,Wr="object"==typeof Reflect&&Reflect.apply||(_?Fr.bind(Dr):function(){return Fr.apply(Dr,arguments)}),zr=function(t){if("Function"===de(t))return N(t)},Br=zr(zr.bind),Ur=function(t,e){return Lt(t),void 0===e?t:_?Br(t,e):function(){return t.apply(e,arguments)}},Gr=Tt("document","documentElement"),Vr=N([].slice),Hr=TypeError,qr=function(t,e){if(t<e)throw Hr("Not enough arguments");return t},Zr=/(?:ipad|iphone|ipod).*applewebkit/i.test(Z),Yr=S.setImmediate,$r=S.clearImmediate,Kr=S.process,Qr=S.Dispatch,Xr=S.Function,Jr=S.MessageChannel,tn=S.String,en=0,rn={};P((function(){kr=S.location}));var nn=function(t){if(U(rn,t)){var e=rn[t];delete rn[t],e()}},on=function(t){return function(){nn(t)}},an=function(t){nn(t.data)},un=function(t){S.postMessage(tn(t),kr.protocol+"//"+kr.host)};Yr&&$r||(Yr=function(t){qr(arguments.length,1);var e=lt(t)?t:Xr(t),r=Vr(arguments,1);return rn[++en]=function(){Wr(e,void 0,r)},Ir(en),en},$r=function(t){delete rn[t]},ur?Ir=function(t){Kr.nextTick(on(t))}:Qr&&Qr.now?Ir=function(t){Qr.now(on(t))}:Jr&&!Zr?(Pr=(jr=new Jr).port2,jr.port1.onmessage=an,Ir=Ur(Pr.postMessage,Pr)):S.addEventListener&&lt(S.postMessage)&&!S.importScripts&&kr&&"file:"!==kr.protocol&&!P(un)?(Ir=un,S.addEventListener("message",an,!1)):Ir="onreadystatechange"in gt("script")?function(t){Gr.appendChild(gt("script")).onreadystatechange=function(){Gr.removeChild(this),nn(t)}}:function(t){setTimeout(on(t),0)});var sn={set:Yr,clear:$r},cn=function(){this.head=null,this.tail=null};cn.prototype={add:function(t){var e={item:t,next:null},r=this.tail;r?r.next=e:this.head=e,this.tail=e},get:function(){var t=this.head;if(t)return null===(this.head=t.next)&&(this.tail=null),t.item}};var fn,ln,hn,pn,vn,dn=cn,yn=/ipad|iphone|ipod/i.test(Z)&&"undefined"!=typeof Pebble,gn=/web0s(?!.*chrome)/i.test(Z),mn=je.f,bn=sn.set,xn=S.MutationObserver||S.WebKitMutationObserver,wn=S.document,En=S.process,An=S.Promise,On=mn(S,"queueMicrotask"),Sn=On&&On.value;if(!Sn){var Tn=new dn,kn=function(){var t,e;for(ur&&(t=En.domain)&&t.exit();e=Tn.get();)try{e()}catch(t){throw Tn.head&&fn(),t}t&&t.enter()};Zr||ur||gn||!xn||!wn?!yn&&An&&An.resolve?((pn=An.resolve(void 0)).constructor=An,vn=Ur(pn.then,pn),fn=function(){vn(kn)}):ur?fn=function(){En.nextTick(kn)}:(bn=Ur(bn,S),fn=function(){bn(kn)}):(ln=!0,hn=wn.createTextNode(""),new xn(kn).observe(hn,{characterData:!0}),fn=function(){hn.data=ln=!ln}),Sn=function(t){Tn.head||fn(),Tn.add(t)}}var In,jn,Pn,_n=Sn,Mn=function(t){try{return{error:!1,value:t()}}catch(t){return{error:!0,value:t}}},Ln=S.Promise,Rn="object"==typeof Deno&&Deno&&"object"==typeof Deno.version,Nn=!Rn&&!ur&&"object"==typeof window&&"object"==typeof document,Cn=(Ln&&Ln.prototype,it("species")),Dn=!1,Fn=lt(S.PromiseRejectionEvent),Wn={CONSTRUCTOR:or("Promise",(function(){var t=Xt(Ln),e=t!==String(Ln);if(!e&&66===X)return!0;if(!X||X<51||!/native code/.test(t)){var r=new Ln((function(t){t(1)})),n=function(t){t((function(){}),(function(){}))};if((r.constructor={})[Cn]=n,!(Dn=r.then((function(){}))instanceof n))return!0}return!e&&(Nn||Rn)&&!Fn})),REJECTION_EVENT:Fn,SUBCLASSING:Dn},zn=TypeError,Bn=function(t){var e,r;this.promise=new t((function(t,n){if(void 0!==e||void 0!==r)throw zn("Bad Promise constructor");e=t,r=n})),this.resolve=Lt(e),this.reject=Lt(r)},Un={f:function(t){return new Bn(t)}},Gn=sn.set,Vn=Wn.CONSTRUCTOR,Hn=Wn.REJECTION_EVENT,qn=Wn.SUBCLASSING,Zn=fe.getterFor("Promise"),Yn=fe.set,$n=Ln&&Ln.prototype,Kn=Ln,Qn=$n,Xn=S.TypeError,Jn=S.document,to=S.process,eo=Un.f,ro=eo,no=!!(Jn&&Jn.createEvent&&S.dispatchEvent),oo=function(t){var e;return!(!vt(t)||!lt(e=t.then))&&e},io=function(t,e){var r,n,o,i=e.value,a=1==e.state,u=a?t.ok:t.fail,s=t.resolve,c=t.reject,f=t.domain;try{u?(a||(2===e.rejection&&fo(e),e.rejection=1),!0===u?r=i:(f&&f.enter(),r=u(i),f&&(f.exit(),o=!0)),r===t.promise?c(Xn("Promise-chain cycle")):(n=oo(r))?Ot(n,r,s,c):s(r)):c(i)}catch(t){f&&!o&&f.exit(),c(t)}},ao=function(t,e){t.notified||(t.notified=!0,_n((function(){for(var r,n=t.reactions;r=n.get();)io(r,t);t.notified=!1,e&&!t.rejection&&so(t)})))},uo=function(t,e,r){var n,o;no?((n=Jn.createEvent("Event")).promise=e,n.reason=r,n.initEvent(t,!1,!0),S.dispatchEvent(n)):n={promise:e,reason:r},!Hn&&(o=S["on"+t])?o(n):"unhandledrejection"===t&&function(t,e){try{1==arguments.length?console.error(t):console.error(t,e)}catch(t){}}("Unhandled promise rejection",r)},so=function(t){Ot(Gn,S,(function(){var e,r=t.facade,n=t.value;if(co(t)&&(e=Mn((function(){ur?to.emit("unhandledRejection",n,r):uo("unhandledrejection",r,n)})),t.rejection=ur||co(t)?2:1,e.error))throw e.value}))},co=function(t){return 1!==t.rejection&&!t.parent},fo=function(t){Ot(Gn,S,(function(){var e=t.facade;ur?to.emit("rejectionHandled",e):uo("rejectionhandled",e,t.value)}))},lo=function(t,e,r){return function(n){t(e,n,r)}},ho=function(t,e,r){t.done||(t.done=!0,r&&(t=r),t.value=e,t.state=2,ao(t,!0))},po=function(t,e,r){if(!t.done){t.done=!0,r&&(t=r);try{if(t.facade===e)throw Xn("Promise can't be resolved itself");var n=oo(e);n?_n((function(){var r={done:!1};try{Ot(n,e,lo(po,r,t),lo(ho,r,t))}catch(e){ho(r,e,t)}})):(t.value=e,t.state=1,ao(t,!1))}catch(e){ho({done:!1},e,t)}}};if(Vn&&(Qn=(Kn=function(t){mr(this,Qn),Lt(t),Ot(In,this);var e=Zn(this);try{t(lo(po,e),lo(ho,e))}catch(t){ho(e,t)}}).prototype,(In=function(t){Yn(this,{type:"Promise",done:!1,notified:!1,parent:!1,reactions:new dn,rejection:!1,state:0,value:void 0})}).prototype=he(Qn,"then",(function(t,e){var r=Zn(this),n=eo(Nr(this,Kn));return r.parent=!0,n.ok=!lt(t)||t,n.fail=lt(e)&&e,n.domain=ur?to.domain:void 0,0==r.state?r.reactions.add(n):_n((function(){io(n,r)})),n.promise})),jn=function(){var t=new In,e=Zn(t);this.promise=t,this.resolve=lo(po,e),this.reject=lo(ho,e)},Un.f=eo=function(t){return t===Kn||void 0===t?new jn(t):ro(t)},lt(Ln)&&$n!==Object.prototype)){Pn=$n.then,qn||he($n,"then",(function(t,e){var r=this;return new Kn((function(t,e){Ot(Pn,r,t,e)})).then(t,e)}),{unsafe:!0});try{delete $n.constructor}catch(t){}fr&&fr($n,Qn)}ar({global:!0,constructor:!0,wrap:!0,forced:Vn},{Promise:Kn}),pr(Kn,"Promise",!1),yr("Promise");var vo={},yo=it("iterator"),go=Array.prototype,mo=function(t){return void 0!==t&&(vo.Array===t||go[yo]===t)},bo=it("iterator"),xo=function(t){if(!C(t))return Rt(t,bo)||Rt(t,"@@iterator")||vo[be(t)]},wo=TypeError,Eo=function(t,e){var r=arguments.length<2?xo(t):e;if(Lt(r))return Et(Ot(r,t));throw wo(_t(t)+" is not iterable")},Ao=function(t,e,r){var n,o;Et(t);try{if(!(n=Rt(t,"return"))){if("throw"===e)throw r;return r}n=Ot(n,t)}catch(t){o=!0,n=t}if("throw"===e)throw r;if(o)throw n;return Et(n),r},Oo=TypeError,So=function(t,e){this.stopped=t,this.result=e},To=So.prototype,ko=function(t,e,r){var n,o,i,a,u,s,c,f=r&&r.that,l=!(!r||!r.AS_ENTRIES),h=!(!r||!r.IS_RECORD),p=!(!r||!r.IS_ITERATOR),v=!(!r||!r.INTERRUPTED),d=Ur(e,f),y=function(t){return n&&Ao(n,"normal",t),new So(!0,t)},g=function(t){return l?(Et(t),v?d(t[0],t[1],y):d(t[0],t[1])):v?d(t,y):d(t)};if(h)n=t.iterator;else if(p)n=t;else{if(!(o=xo(t)))throw Oo(_t(t)+" is not iterable");if(mo(o)){for(i=0,a=We(t);a>i;i++)if((u=g(t[i]))&&kt(To,u))return u;return new So(!1)}n=Eo(t,o)}for(s=h?t.next:n.next;!(c=Ot(s,n)).done;){try{u=g(c.value)}catch(t){Ao(n,"throw",t)}if("object"==typeof u&&u&&kt(To,u))return u}return new So(!1)},Io=it("iterator"),jo=!1;try{var Po=0,_o={next:function(){return{done:!!Po++}},return:function(){jo=!0}};_o[Io]=function(){return this},Array.from(_o,(function(){throw 2}))}catch(t){}var Mo=function(t,e){if(!e&&!jo)return!1;var r=!1;try{var n={};n[Io]=function(){return{next:function(){return{done:r=!0}}}},t(n)}catch(t){}return r},Lo=Wn.CONSTRUCTOR||!Mo((function(t){Ln.all(t).then(void 0,(function(){}))}));ar({target:"Promise",stat:!0,forced:Lo},{all:function(t){var e=this,r=Un.f(e),n=r.resolve,o=r.reject,i=Mn((function(){var r=Lt(e.resolve),i=[],a=0,u=1;ko(t,(function(t){var s=a++,c=!1;u++,Ot(r,e,t).then((function(t){c||(c=!0,i[s]=t,--u||n(i))}),o)})),--u||n(i)}));return i.error&&o(i.value),r.promise}});var Ro=Wn.CONSTRUCTOR,No=Ln&&Ln.prototype;if(ar({target:"Promise",proto:!0,forced:Ro,real:!0},{catch:function(t){return this.then(void 0,t)}}),lt(Ln)){var Co=Tt("Promise").prototype.catch;No.catch!==Co&&he(No,"catch",Co,{unsafe:!0})}ar({target:"Promise",stat:!0,forced:Lo},{race:function(t){var e=this,r=Un.f(e),n=r.reject,o=Mn((function(){var o=Lt(e.resolve);ko(t,(function(t){Ot(o,e,t).then(r.resolve,n)}))}));return o.error&&n(o.value),r.promise}}),ar({target:"Promise",stat:!0,forced:Wn.CONSTRUCTOR},{reject:function(t){var e=Un.f(this);return Ot(e.reject,void 0,t),e.promise}});var Do=Wn.CONSTRUCTOR;Tt("Promise");function Fo(t,e){if(!t)throw new Error(e||"web worker helper assertion failed.")}ar({target:"Promise",stat:!0,forced:Do},{resolve:function(t){return function(t,e){if(Et(t),vt(e)&&e.constructor===t)return e;var r=Un.f(t);return(0,r.resolve)(e),r.promise}(this,t)}});var Wo="undefined"!=typeof window&&void 0!==window.orientation,zo=function(){function t(t,e){var r=this;this.name=t,this.workerThread=e,this.isRunning=!0,this.resolve=function(){},this.reject=function(){},this.result=new Promise((function(t,e){r.resolve=t,r.reject=e}))}return t.prototype.postMessage=function(t,e){this.workerThread.postMessage({source:"Main thread",type:t,payload:e})},t.prototype.done=function(t){Fo(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.resolve(t)},t.prototype.error=function(t){Fo(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.reject(t)},t}(),Bo=new Map;function Uo(t){Fo(t.source&&!t.url||!t.source&&t.url);var e=Bo.get(t.source||t.url);return e||(t.url&&(e=function(t){if(!t.startsWith("http"))return t;return Go((e=t,"try {\\n  importScripts('"+e+"');\\n} catch (error) {\\n  console.error(error);\\n  throw error;\\n}"));var e}(t.url),Bo.set(t.url,e)),t.source&&(e=Go(t.source),Bo.set(t.source,e))),Fo(e),e}function Go(t){var e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function Vo(t,e,r){void 0===e&&(e=!0);var n=r||new Set;if(t){if(Ho(t))n.add(t);else if(Ho(t.buffer))n.add(t.buffer);else if(ArrayBuffer.isView(t));else if(e&&"object"==typeof t)for(var o in t)Vo(t[o],e,n)}else;return void 0===r?Array.from(n):[]}function Ho(t){return!!t&&(t instanceof ArrayBuffer||("undefined"!=typeof MessagePort&&t instanceof MessagePort||("undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&t instanceof OffscreenCanvas)))}var qo=function(){},Zo=function(){function t(t){this.terminated=!1,this.loadableURL="";var e=t.name,r=t.source,n=t.url;Fo(r||n),this.name=e,this.source=r,this.url=n,this.onMessage=qo,this.onError=function(t){return console.log(t)},this.worker=this.createBrowserWorker()}return t.isSupported=function(){return"undefined"!=typeof Worker},t.prototype.destroy=function(){this.onMessage=qo,this.onError=qo,this.worker.terminate(),this.terminated=!0},Object.defineProperty(t.prototype,"isRunning",{get:function(){return Boolean(this.onMessage)},enumerable:!1,configurable:!0}),t.prototype.postMessage=function(t,e){e=e||Vo(t),this.worker.postMessage(t,e)},t.prototype.getErrorFromErrorEvent=function(t){var e="Failed to load ";return e+="worker "+this.name+" from "+this.url+". ",t.message&&(e+=t.message+" in "),t.lineno&&(e+=":"+t.lineno+":"+t.colno),new Error(e)},t.prototype.createBrowserWorker=function(){var t=this;this.loadableURL=Uo({source:this.source,url:this.url});var e=new Worker(this.loadableURL,{name:this.name});return e.onmessage=function(e){e.data?t.onMessage(e.data):t.onError(new Error("No data received"))},e.onerror=function(e){t.onError(t.getErrorFromErrorEvent(e)),t.terminated=!0},e.onmessageerror=function(e){return console.error("worker "+t.name+", message error: "+e)},e},t}(),Yo=self&&self.__assign||function(){return(Yo=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},$o=self&&self.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{s(n.next(t))}catch(t){i(t)}}function u(t){try{s(n.throw(t))}catch(t){i(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,u)}s((n=n.apply(t,e||[])).next())}))},Ko=self&&self.__generator||function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},Qo=function(){function t(t){this.name="unnamed",this.maxConcurrency=1,this.maxMobileConcurrency=1,this.onDebug=function(){},this.reuseWorkers=!0,this.props={},this.jobQueue=[],this.idleQueue=[],this.count=0,this.isDestroyed=!1,this.source=t.source,this.url=t.url,this.setProps(t)}return t.prototype.destroy=function(){this.idleQueue.forEach((function(t){return t.destroy()})),this.isDestroyed=!0},t.prototype.setProps=function(t){this.props=Yo(Yo({},this.props),t),void 0!==t.name&&(this.name=t.name),void 0!==t.maxConcurrency&&(this.maxConcurrency=t.maxConcurrency),void 0!==t.maxMobileConcurrency&&(this.maxMobileConcurrency=t.maxMobileConcurrency),void 0!==t.reuseWorkers&&(this.reuseWorkers=t.reuseWorkers),void 0!==t.onDebug&&(this.onDebug=t.onDebug)},t.prototype.startJob=function(t,e,r){return void 0===e&&(e=function(t,e,r){return t.done(r)}),void 0===r&&(r=function(t,e){return t.error(e)}),$o(this,void 0,void 0,(function(){var n,o=this;return Ko(this,(function(i){switch(i.label){case 0:return n=new Promise((function(n){return o.jobQueue.push({name:t,onMessage:e,onError:r,onStart:n}),o})),this.startQueuedJob(),[4,n];case 1:return[2,i.sent()]}}))}))},t.prototype.startQueuedJob=function(){return $o(this,void 0,void 0,(function(){var t,e,r;return Ko(this,(function(n){switch(n.label){case 0:if(!this.jobQueue.length)return[2];if(!(t=this.getAvailableWorker()))return[2];if(!(e=this.jobQueue.shift()))return[3,4];this.onDebug({message:"Starting job",name:e.name,backlog:this.jobQueue.length,workerThread:t}),r=new zo(e.name,t),t.onMessage=function(t){return e.onMessage(r,t.type,t.payload)},t.onError=function(t){return e.onError(r,t)},e.onStart(r),n.label=1;case 1:return n.trys.push([1,,3,4]),[4,r.result];case 2:return n.sent(),[3,4];case 3:return this.returnWorkerToQueue(t),[7];case 4:return[2]}}))}))},t.prototype.returnWorkerToQueue=function(t){this.isDestroyed||!this.reuseWorkers||this.count>this.getMaxConcurrency()?(t.destroy(),this.count--):this.idleQueue.push(t),this.isDestroyed||this.startQueuedJob()},t.prototype.getAvailableWorker=function(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this.getMaxConcurrency()){this.count++;var t=this.name.toLowerCase()+" (#"+this.count+" of "+this.maxConcurrency+")";return new Zo({name:t,source:this.source,url:this.url})}return null},t.prototype.getMaxConcurrency=function(){return Wo?this.maxMobileConcurrency:this.maxConcurrency},t}(),Xo=self&&self.__assign||function(){return(Xo=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},Jo=self&&self.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},ti={maxConcurrency:3,maxMobileConcurrency:1,onDebug:function(){},reuseWorkers:!0},ei=(function(){function t(t){this.workerPools=new Map,this.props=Xo({},ti),this.setProps(t),this.workerPools=new Map}t.isSupported=function(){return Zo.isSupported()},t.getWorkerFarm=function(e){return void 0===e&&(e={}),t.workerFarm=t.workerFarm||new t({}),t.workerFarm.setProps(e),t.workerFarm},t.prototype.destroy=function(){var t,e;try{for(var r=Jo(this.workerPools.values()),n=r.next();!n.done;n=r.next()){n.value.destroy()}}catch(e){t={error:e}}finally{try{n&&!n.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}},t.prototype.setProps=function(t){var e,r;this.props=Xo(Xo({},this.props),t);try{for(var n=Jo(this.workerPools.values()),o=n.next();!o.done;o=n.next()){o.value.setProps(this.getWorkerPoolProps())}}catch(t){e={error:t}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(e)throw e.error}}},t.prototype.getWorkerPool=function(t){var e=t.name,r=t.source,n=t.url,o=this.workerPools.get(e);return o||((o=new Qo({name:e,source:r,url:n})).setProps(this.getWorkerPoolProps()),this.workerPools.set(e,o)),o},t.prototype.getWorkerPoolProps=function(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}(),new Map),ri=function(){function t(){}return Object.defineProperty(t,"onmessage",{set:function(t){self.onmessage=function(e){if(ni(e)){var r=e.data,n=r.type,o=r.payload;t(n,o)}}},enumerable:!1,configurable:!0}),t.addEventListener=function(t){var e=ei.get(t);e||(e=function(e){if(ni(e)){var r=e.data,n=r.type,o=r.payload;t(n,o)}}),self.addEventListener("message",e)},t.removeEventListener=function(t){var e=ei.get(t);ei.delete(t),self.removeEventListener("message",e)},t.postMessage=function(t,e){if(self){var r={source:"Worker thread",type:t,payload:e},n=Vo(e);self.postMessage(r,n)}},t}();function ni(t){var e=t.type,r=t.data;return"message"===e&&r&&"string"==typeof r.source&&"Main thread"===r.source}self&&self.__awaiter,self&&self.__generator;var oi,ii,ai=function(){function t(){this._values=[],this._settlers=[],this._closed=!1}return t.prototype[Symbol.asyncIterator]=function(){return this},t.prototype.push=function(t){return this.enqueue(t)},t.prototype.enqueue=function(t){if(this._closed)throw new Error("Closed");if(this._settlers.length>0){if(this._values.length>0)throw new Error("Illegal internal state");var e=this._settlers.shift();t instanceof Error?e.reject(t):e.resolve({value:t})}else this._values.push(t)},t.prototype.close=function(){for(;this._settlers.length>0;){this._settlers.shift().resolve({done:!0})}this._closed=!0},t.prototype.next=function(){var t=this;if(this._values.length>0){var e=this._values.shift();return e instanceof Error?Promise.reject(e):Promise.resolve({done:!1,value:e})}if(this._closed){if(this._settlers.length>0)throw new Error("Illegal internal state");return Promise.resolve({done:!0,value:void 0})}return new Promise((function(e,r){t._settlers.push({resolve:e,reject:r})}))},t}(),ui=self&&self.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{s(n.next(t))}catch(t){i(t)}}function u(t){try{s(n.throw(t))}catch(t){i(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,u)}s((n=n.apply(t,e||[])).next())}))},si=self&&self.__generator||function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},ci=self&&self.__asyncValues||function(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,r=t[Symbol.asyncIterator];return r?r.call(t):(t="function"==typeof __values?__values(t):t[Symbol.iterator](),e={},n("next"),n("throw"),n("return"),e[Symbol.asyncIterator]=function(){return this},e);function n(r){e[r]=t[r]&&function(e){return new Promise((function(n,o){(function(t,e,r,n){Promise.resolve(n).then((function(e){t({value:e,done:r})}),e)})(n,o,(e=t[r](e)).done,e.value)}))}}},fi=0;function li(t,e){var r=this;if("undefined"!=typeof self){var n={process:hi};ri.onmessage=function(o,i){return ui(r,void 0,void 0,(function(){var r,a,u,s,c,f,l,h,p,v;return si(this,(function(d){switch(d.label){case 0:switch(d.trys.push([0,19,,20]),o){case"process":return[3,1];case"process-in-batches":return[3,3];case"input-batch":return[3,16];case"input-done":return[3,17]}return[3,18];case 1:if(!t)throw new Error("Worker does not support atomic processing");return[4,t(i.input,i.options||{},n)];case 2:return r=d.sent(),ri.postMessage("done",{result:r}),[3,18];case 3:if(!e)throw new Error("Worker does not support batched processing");oi=new ai,ii=i.options||{},a=e(oi,ii,n),d.label=4;case 4:d.trys.push([4,9,10,15]),u=ci(a),d.label=5;case 5:return[4,u.next()];case 6:if((s=d.sent()).done)return[3,8];c=s.value,ri.postMessage("output-batch",{result:c}),d.label=7;case 7:return[3,5];case 8:return[3,15];case 9:return f=d.sent(),p={error:f},[3,15];case 10:return d.trys.push([10,,13,14]),s&&!s.done&&(v=u.return)?[4,v.call(u)]:[3,12];case 11:d.sent(),d.label=12;case 12:return[3,14];case 13:if(p)throw p.error;return[7];case 14:return[7];case 15:return ri.postMessage("done",{}),[3,18];case 16:return oi.push(i.input),[3,18];case 17:return oi.close(),[3,18];case 18:return[3,20];case 19:return l=d.sent(),h=l instanceof Error?l.message:"",ri.postMessage("error",{error:h}),[3,20];case 20:return[2]}}))}))}}}function hi(t,e){return void 0===e&&(e={}),new Promise((function(r,n){var o=fi++,i=function(t,e){if(e.id===o)switch(t){case"done":ri.removeEventListener(i),r(e.result);break;case"error":ri.removeEventListener(i),n(e.error)}};ri.addEventListener(i);var a={id:o,input:t,options:e};ri.postMessage("process",a)}))}self&&self.__awaiter,self&&self.__generator;var pi={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},vi=gt("span").classList,di=vi&&vi.constructor&&vi.constructor.prototype,yi=di===Object.prototype?void 0:di,gi=Array.isArray||function(t){return"Array"==de(t)},mi=it("species"),bi=Array,xi=function(t,e){return new(function(t){var e;return gi(t)&&(e=t.constructor,(_r(e)&&(e===bi||gi(e.prototype))||vt(e)&&null===(e=e[mi]))&&(e=void 0)),void 0===e?bi:e}(t))(0===e?0:e)},wi=N([].push),Ei=function(t){var e=1==t,r=2==t,n=3==t,o=4==t,i=6==t,a=7==t,u=5==t||i;return function(s,c,f,l){for(var h,p,v=z(s),d=Te(v),y=Ur(c,f),g=We(d),m=0,b=l||xi,x=e?b(s,g):r||a?b(s,0):void 0;g>m;m++)if((u||m in d)&&(p=y(h=d[m],m,v),t))if(e)x[m]=p;else if(p)switch(t){case 3:return!0;case 5:return h;case 6:return m;case 2:wi(x,h)}else switch(t){case 4:return!1;case 7:wi(x,h)}return i?-1:n||o?o:x}},Ai={forEach:Ei(0),map:Ei(1),filter:Ei(2),some:Ei(3),every:Ei(4),find:Ei(5),findIndex:Ei(6),filterReject:Ei(7)},Oi=function(t,e){var r=[][t];return!!r&&P((function(){r.call(null,e||function(){return 1},1)}))},Si=Ai.forEach,Ti=Oi("forEach")?[].forEach:function(t){return Si(this,t,arguments.length>1?arguments[1]:void 0)},ki=function(t){if(t&&t.forEach!==Ti)try{re(t,"forEach",Ti)}catch(e){t.forEach=Ti}};for(var Ii in pi)pi[Ii]&&ki(S[Ii]&&S[Ii].prototype);ki(yi);var ji=function(t,e,r){var n=Wt(e);n in t?Gt.f(t,n,ee(0,r)):t[n]=r},Pi=it("species"),_i=function(t){return X>=51||!P((function(){var e=[];return(e.constructor={})[Pi]=function(){return{foo:1}},1!==e[t](Boolean).foo}))},Mi=_i("slice"),Li=it("species"),Ri=Array,Ni=Math.max;ar({target:"Array",proto:!0,forced:!Mi},{slice:function(t,e){var r,n,o,i=ke(this),a=We(i),u=Ce(t,a),s=Ce(void 0===e?a:e,a);if(gi(i)&&(r=i.constructor,(_r(r)&&(r===Ri||gi(r.prototype))||vt(r)&&null===(r=r[Li]))&&(r=void 0),r===Ri||void 0===r))return Vr(i,u,s);for(n=new(void 0===r?Ri:r)(Ni(s-u,0)),o=0;u<s;u++,o++)u in i&&ji(n,o,i[u]);return n.length=o,n}});var Ci=Zt.EXISTS,Di=Function.prototype,Fi=N(Di.toString),Wi=/function\\b(?:\\s|\\/\\*[\\S\\s]*?\\*\\/|\\/\\/[^\\n\\r]*[\\n\\r]+)*([^\\s(/]*)/,zi=N(Wi.exec);ht&&!Ci&&vr(Di,"name",{configurable:!0,get:function(){try{return zi(Wi,Fi(this))[1]}catch(t){return""}}});var Bi,Ui=Object.keys||function(t){return Ve(t,He)},Gi={f:ht&&!bt?Object.defineProperties:function(t,e){Et(t);for(var r,n=ke(e),o=Ui(e),i=o.length,a=0;i>a;)Gt.f(t,r=o[a++],n[r]);return t}},Vi=oe("IE_PROTO"),Hi=function(){},qi=function(t){return"<script>"+t+"<\\/script>"},Zi=function(t){t.write(qi("")),t.close();var e=t.parentWindow.Object;return t=null,e},Yi=function(){try{Bi=new ActiveXObject("htmlfile")}catch(t){}var t,e;Yi="undefined"!=typeof document?document.domain&&Bi?Zi(Bi):((e=gt("iframe")).style.display="none",Gr.appendChild(e),e.src=String("javascript:"),(t=e.contentWindow.document).open(),t.write(qi("document.F=Object")),t.close(),t.F):Zi(Bi);for(var r=He.length;r--;)delete Yi.prototype[He[r]];return Yi()};ie[Vi]=!0;var $i=Object.create||function(t,e){var r;return null!==t?(Hi.prototype=Et(t),r=new Hi,Hi.prototype=null,r[Vi]=t):r=Yi(),void 0===e?r:Gi.f(r,e)},Ki=Gt.f,Qi=it("unscopables"),Xi=Array.prototype;null==Xi[Qi]&&Ki(Xi,Qi,{configurable:!0,value:$i(null)});var Ji,ta,ea,ra=function(t){Xi[Qi][t]=!0},na=!P((function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype})),oa=oe("IE_PROTO"),ia=Object,aa=ia.prototype,ua=na?ia.getPrototypeOf:function(t){var e=z(t);if(U(e,oa))return e[oa];var r=e.constructor;return lt(r)&&e instanceof r?r.prototype:e instanceof ia?aa:null},sa=it("iterator"),ca=!1;[].keys&&("next"in(ea=[].keys())?(ta=ua(ua(ea)))!==Object.prototype&&(Ji=ta):ca=!0),(!vt(Ji)||P((function(){var t={};return Ji[sa].call(t)!==t})))&&(Ji={}),lt(Ji[sa])||he(Ji,sa,(function(){return this}));var fa={IteratorPrototype:Ji,BUGGY_SAFARI_ITERATORS:ca},la=fa.IteratorPrototype,ha=function(){return this},pa=Zt.PROPER,va=Zt.CONFIGURABLE,da=fa.IteratorPrototype,ya=fa.BUGGY_SAFARI_ITERATORS,ga=it("iterator"),ma=function(){return this},ba=function(t,e,r,n,o,i,a){!function(t,e,r,n){var o=e+" Iterator";t.prototype=$i(la,{next:ee(+!n,r)}),pr(t,o,!1),vo[o]=ha}(r,e,n);var u,s,c,f=function(t){if(t===o&&d)return d;if(!ya&&t in p)return p[t];switch(t){case"keys":case"values":case"entries":return function(){return new r(this,t)}}return function(){return new r(this)}},l=e+" Iterator",h=!1,p=t.prototype,v=p[ga]||p["@@iterator"]||o&&p[o],d=!ya&&v||f(o),y="Array"==e&&p.entries||v;if(y&&(u=ua(y.call(new t)))!==Object.prototype&&u.next&&(ua(u)!==da&&(fr?fr(u,da):lt(u[ga])||he(u,ga,ma)),pr(u,l,!0)),pa&&"values"==o&&v&&"values"!==v.name&&(va?re(p,"name","values"):(h=!0,d=function(){return Ot(v,this)})),o)if(s={values:f("values"),keys:i?d:f("keys"),entries:f("entries")},a)for(c in s)(ya||h||!(c in p))&&he(p,c,s[c]);else ar({target:e,proto:!0,forced:ya||h},s);return p[ga]!==d&&he(p,ga,d,{name:o}),vo[e]=d,s},xa=function(t,e){return{value:t,done:e}},wa=Gt.f,Ea=fe.set,Aa=fe.getterFor("Array Iterator"),Oa=ba(Array,"Array",(function(t,e){Ea(this,{type:"Array Iterator",target:ke(t),index:0,kind:e})}),(function(){var t=Aa(this),e=t.target,r=t.kind,n=t.index++;return!e||n>=e.length?(t.target=void 0,xa(void 0,!0)):xa("keys"==r?n:"values"==r?e[n]:[n,e[n]],!1)}),"values"),Sa=vo.Arguments=vo.Array;if(ra("keys"),ra("values"),ra("entries"),ht&&"values"!==Sa.name)try{wa(Sa,"name",{value:"values"})}catch(t){}var Ta,ka,Ia,ja="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView,Pa=fe.enforce,_a=fe.get,Ma=S.Int8Array,La=Ma&&Ma.prototype,Ra=S.Uint8ClampedArray,Na=Ra&&Ra.prototype,Ca=Ma&&ua(Ma),Da=La&&ua(La),Fa=Object.prototype,Wa=S.TypeError,za=it("toStringTag"),Ba=q("TYPED_ARRAY_TAG"),Ua=ja&&!!fr&&"Opera"!==be(S.opera),Ga=!1,Va={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},Ha={BigInt64Array:8,BigUint64Array:8},qa=function(t){var e=ua(t);if(vt(e)){var r=_a(e);return r&&U(r,"TypedArrayConstructor")?r.TypedArrayConstructor:qa(e)}},Za=function(t){if(!vt(t))return!1;var e=be(t);return U(Va,e)||U(Ha,e)};for(Ta in Va)(Ia=(ka=S[Ta])&&ka.prototype)?Pa(Ia).TypedArrayConstructor=ka:Ua=!1;for(Ta in Ha)(Ia=(ka=S[Ta])&&ka.prototype)&&(Pa(Ia).TypedArrayConstructor=ka);if((!Ua||!lt(Ca)||Ca===Function.prototype)&&(Ca=function(){throw Wa("Incorrect invocation")},Ua))for(Ta in Va)S[Ta]&&fr(S[Ta],Ca);if((!Ua||!Da||Da===Fa)&&(Da=Ca.prototype,Ua))for(Ta in Va)S[Ta]&&fr(S[Ta].prototype,Da);if(Ua&&ua(Na)!==Da&&fr(Na,Da),ht&&!U(Da,za))for(Ta in Ga=!0,vr(Da,za,{configurable:!0,get:function(){return vt(this)?this[Ba]:void 0}}),Va)S[Ta]&&re(S[Ta],Ba,Ta);var Ya={NATIVE_ARRAY_BUFFER_VIEWS:Ua,TYPED_ARRAY_TAG:Ga&&Ba,aTypedArray:function(t){if(Za(t))return t;throw Wa("Target is not a typed array")},aTypedArrayConstructor:function(t){if(lt(t)&&(!fr||kt(Ca,t)))return t;throw Wa(_t(t)+" is not a typed array constructor")},exportTypedArrayMethod:function(t,e,r,n){if(ht){if(r)for(var o in Va){var i=S[o];if(i&&U(i.prototype,t))try{delete i.prototype[t]}catch(r){try{i.prototype[t]=e}catch(t){}}}Da[t]&&!r||he(Da,t,r?e:Ua&&La[t]||e,n)}},exportTypedArrayStaticMethod:function(t,e,r){var n,o;if(ht){if(fr){if(r)for(n in Va)if((o=S[n])&&U(o,t))try{delete o[t]}catch(t){}if(Ca[t]&&!r)return;try{return he(Ca,t,r?e:Ua&&Ca[t]||e)}catch(t){}}for(n in Va)!(o=S[n])||o[t]&&!r||he(o,t,e)}},getTypedArrayConstructor:qa,isView:function(t){if(!vt(t))return!1;var e=be(t);return"DataView"===e||U(Va,e)||U(Ha,e)},isTypedArray:Za,TypedArray:Ca,TypedArrayPrototype:Da},$a=Ya.NATIVE_ARRAY_BUFFER_VIEWS,Ka=S.ArrayBuffer,Qa=S.Int8Array,Xa=!$a||!P((function(){Qa(1)}))||!P((function(){new Qa(-1)}))||!Mo((function(t){new Qa,new Qa(null),new Qa(1.5),new Qa(t)}),!0)||P((function(){return 1!==new Qa(new Ka(2),1,void 0).length})),Ja=function(t,e,r){for(var n in e)he(t,n,e[n],r);return t},tu=RangeError,eu=function(t){if(void 0===t)return 0;var e=Le(t),r=Fe(e);if(e!==r)throw tu("Wrong length or index");return r},ru=Array,nu=Math.abs,ou=Math.pow,iu=Math.floor,au=Math.log,uu=Math.LN2,su=function(t,e,r){var n,o,i,a=ru(r),u=8*r-e-1,s=(1<<u)-1,c=s>>1,f=23===e?ou(2,-24)-ou(2,-77):0,l=t<0||0===t&&1/t<0?1:0,h=0;for((t=nu(t))!=t||t===1/0?(o=t!=t?1:0,n=s):(n=iu(au(t)/uu),t*(i=ou(2,-n))<1&&(n--,i*=2),(t+=n+c>=1?f/i:f*ou(2,1-c))*i>=2&&(n++,i/=2),n+c>=s?(o=0,n=s):n+c>=1?(o=(t*i-1)*ou(2,e),n+=c):(o=t*ou(2,c-1)*ou(2,e),n=0));e>=8;)a[h++]=255&o,o/=256,e-=8;for(n=n<<e|o,u+=e;u>0;)a[h++]=255&n,n/=256,u-=8;return a[--h]|=128*l,a},cu=function(t,e){var r,n=t.length,o=8*n-e-1,i=(1<<o)-1,a=i>>1,u=o-7,s=n-1,c=t[s--],f=127&c;for(c>>=7;u>0;)f=256*f+t[s--],u-=8;for(r=f&(1<<-u)-1,f>>=-u,u+=e;u>0;)r=256*r+t[s--],u-=8;if(0===f)f=1-a;else{if(f===i)return r?NaN:c?-1/0:1/0;r+=ou(2,e),f-=a}return(c?-1:1)*r*ou(2,f-e)},fu=function(t){for(var e=z(this),r=We(e),n=arguments.length,o=Ce(n>1?arguments[1]:void 0,r),i=n>2?arguments[2]:void 0,a=void 0===i?r:Ce(i,r);a>o;)e[o++]=t;return e},lu=Array,hu=Math.max,pu=function(t,e,r){for(var n=We(t),o=Ce(e,n),i=Ce(void 0===r?n:r,n),a=lu(hu(i-o,0)),u=0;o<i;o++,u++)ji(a,u,t[o]);return a.length=u,a},vu=Ze.f,du=Zt.PROPER,yu=Zt.CONFIGURABLE,gu=fe.getterFor("ArrayBuffer"),mu=fe.getterFor("DataView"),bu=fe.set,xu=S.ArrayBuffer,wu=xu,Eu=wu&&wu.prototype,Au=S.DataView,Ou=Au&&Au.prototype,Su=Object.prototype,Tu=S.Array,ku=S.RangeError,Iu=N(fu),ju=N([].reverse),Pu=su,_u=cu,Mu=function(t){return[255&t]},Lu=function(t){return[255&t,t>>8&255]},Ru=function(t){return[255&t,t>>8&255,t>>16&255,t>>24&255]},Nu=function(t){return t[3]<<24|t[2]<<16|t[1]<<8|t[0]},Cu=function(t){return Pu(t,23,4)},Du=function(t){return Pu(t,52,8)},Fu=function(t,e,r){vr(t.prototype,e,{configurable:!0,get:function(){return r(this)[e]}})},Wu=function(t,e,r,n){var o=eu(r),i=mu(t);if(o+e>i.byteLength)throw ku("Wrong index");var a=i.bytes,u=o+i.byteOffset,s=pu(a,u,u+e);return n?s:ju(s)},zu=function(t,e,r,n,o,i){var a=eu(r),u=mu(t);if(a+e>u.byteLength)throw ku("Wrong index");for(var s=u.bytes,c=a+u.byteOffset,f=n(+o),l=0;l<e;l++)s[c+l]=f[i?l:e-l-1]};if(ja){var Bu=du&&"ArrayBuffer"!==xu.name;if(P((function(){xu(1)}))&&P((function(){new xu(-1)}))&&!P((function(){return new xu,new xu(1.5),new xu(NaN),1!=xu.length||Bu&&!yu})))Bu&&yu&&re(xu,"name","ArrayBuffer");else{(wu=function(t){return mr(this,Eu),new xu(eu(t))}).prototype=Eu;for(var Uu,Gu=vu(xu),Vu=0;Gu.length>Vu;)(Uu=Gu[Vu++])in wu||re(wu,Uu,xu[Uu]);Eu.constructor=wu}fr&&ua(Ou)!==Su&&fr(Ou,Su);var Hu=new Au(new wu(2)),qu=N(Ou.setInt8);Hu.setInt8(0,2147483648),Hu.setInt8(1,2147483649),!Hu.getInt8(0)&&Hu.getInt8(1)||Ja(Ou,{setInt8:function(t,e){qu(this,t,e<<24>>24)},setUint8:function(t,e){qu(this,t,e<<24>>24)}},{unsafe:!0})}else Eu=(wu=function(t){mr(this,Eu);var e=eu(t);bu(this,{type:"ArrayBuffer",bytes:Iu(Tu(e),0),byteLength:e}),ht||(this.byteLength=e,this.detached=!1)}).prototype,Ou=(Au=function(t,e,r){mr(this,Ou),mr(t,Eu);var n=gu(t),o=n.byteLength,i=Le(e);if(i<0||i>o)throw ku("Wrong offset");if(i+(r=void 0===r?o-i:Fe(r))>o)throw ku("Wrong length");bu(this,{type:"DataView",buffer:t,byteLength:r,byteOffset:i,bytes:n.bytes}),ht||(this.buffer=t,this.byteLength=r,this.byteOffset=i)}).prototype,ht&&(Fu(wu,"byteLength",gu),Fu(Au,"buffer",mu),Fu(Au,"byteLength",mu),Fu(Au,"byteOffset",mu)),Ja(Ou,{getInt8:function(t){return Wu(this,1,t)[0]<<24>>24},getUint8:function(t){return Wu(this,1,t)[0]},getInt16:function(t){var e=Wu(this,2,t,arguments.length>1?arguments[1]:void 0);return(e[1]<<8|e[0])<<16>>16},getUint16:function(t){var e=Wu(this,2,t,arguments.length>1?arguments[1]:void 0);return e[1]<<8|e[0]},getInt32:function(t){return Nu(Wu(this,4,t,arguments.length>1?arguments[1]:void 0))},getUint32:function(t){return Nu(Wu(this,4,t,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function(t){return _u(Wu(this,4,t,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function(t){return _u(Wu(this,8,t,arguments.length>1?arguments[1]:void 0),52)},setInt8:function(t,e){zu(this,1,t,Mu,e)},setUint8:function(t,e){zu(this,1,t,Mu,e)},setInt16:function(t,e){zu(this,2,t,Lu,e,arguments.length>2?arguments[2]:void 0)},setUint16:function(t,e){zu(this,2,t,Lu,e,arguments.length>2?arguments[2]:void 0)},setInt32:function(t,e){zu(this,4,t,Ru,e,arguments.length>2?arguments[2]:void 0)},setUint32:function(t,e){zu(this,4,t,Ru,e,arguments.length>2?arguments[2]:void 0)},setFloat32:function(t,e){zu(this,4,t,Cu,e,arguments.length>2?arguments[2]:void 0)},setFloat64:function(t,e){zu(this,8,t,Du,e,arguments.length>2?arguments[2]:void 0)}});pr(wu,"ArrayBuffer"),pr(Au,"DataView");var Zu={ArrayBuffer:wu,DataView:Au},Yu=Math.floor,$u=Number.isInteger||function(t){return!vt(t)&&isFinite(t)&&Yu(t)===t},Ku=RangeError,Qu=RangeError,Xu=function(t,e){var r=function(t){var e=Le(t);if(e<0)throw Ku("The argument can't be less than 0");return e}(t);if(r%e)throw Qu("Wrong offset");return r},Ju=function(t){var e=be(t);return"BigInt64Array"==e||"BigUint64Array"==e},ts=TypeError,es=function(t){var e=Ft(t,"number");if("number"==typeof e)throw ts("Can't convert number to bigint");return BigInt(e)},rs=Ya.aTypedArrayConstructor,ns=function(t){var e,r,n,o,i,a,u,s,c=Lr(this),f=z(t),l=arguments.length,h=l>1?arguments[1]:void 0,p=void 0!==h,v=xo(f);if(v&&!mo(v))for(s=(u=Eo(f,v)).next,f=[];!(a=Ot(s,u)).done;)f.push(a.value);for(p&&l>2&&(h=Ur(h,arguments[2])),r=We(f),n=new(rs(c))(r),o=Ju(n),e=0;r>e;e++)i=p?h(f[e],e):f[e],n[e]=o?es(i):+i;return n},os=function(t,e,r){var n,o;return fr&&lt(n=e.constructor)&&n!==r&&vt(o=n.prototype)&&o!==r.prototype&&fr(t,o),t},is=w((function(t){var e=Ze.f,r=Ai.forEach,n=fe.get,o=fe.set,i=fe.enforce,a=Gt.f,u=je.f,s=Math.round,c=S.RangeError,f=Zu.ArrayBuffer,l=f.prototype,h=Zu.DataView,p=Ya.NATIVE_ARRAY_BUFFER_VIEWS,v=Ya.TYPED_ARRAY_TAG,d=Ya.TypedArray,y=Ya.TypedArrayPrototype,g=Ya.aTypedArrayConstructor,m=Ya.isTypedArray,b=function(t,e){g(t);for(var r=0,n=e.length,o=new t(n);n>r;)o[r]=e[r++];return o},x=function(t,e){vr(t,e,{configurable:!0,get:function(){return n(this)[e]}})},w=function(t){var e;return kt(l,t)||"ArrayBuffer"==(e=be(t))||"SharedArrayBuffer"==e},E=function(t,e){return m(t)&&!jt(e)&&e in t&&$u(+e)&&e>=0},A=function(t,e){return e=Wt(e),E(t,e)?ee(2,t[e]):u(t,e)},O=function(t,e,r){return e=Wt(e),!(E(t,e)&&vt(r)&&U(r,"value"))||U(r,"get")||U(r,"set")||r.configurable||U(r,"writable")&&!r.writable||U(r,"enumerable")&&!r.enumerable?a(t,e,r):(t[e]=r.value,t)};ht?(p||(je.f=A,Gt.f=O,x(y,"buffer"),x(y,"byteOffset"),x(y,"byteLength"),x(y,"length")),ar({target:"Object",stat:!0,forced:!p},{getOwnPropertyDescriptor:A,defineProperty:O}),t.exports=function(t,u,l){var g=t.match(/\\d+/)[0]/8,x=t+(l?"Clamped":"")+"Array",E="get"+t,A="set"+t,O=S[x],T=O,k=T&&T.prototype,I={},j=function(t,e){a(t,e,{get:function(){return function(t,e){var r=n(t);return r.view[E](e*g+r.byteOffset,!0)}(this,e)},set:function(t){return function(t,e,r){var o=n(t);l&&(r=(r=s(r))<0?0:r>255?255:255&r),o.view[A](e*g+o.byteOffset,r,!0)}(this,e,t)},enumerable:!0})};p?Xa&&(T=u((function(t,e,r,n){return mr(t,k),os(vt(e)?w(e)?void 0!==n?new O(e,Xu(r,g),n):void 0!==r?new O(e,Xu(r,g)):new O(e):m(e)?b(T,e):Ot(ns,T,e):new O(eu(e)),t,T)})),fr&&fr(T,d),r(e(O),(function(t){t in T||re(T,t,O[t])})),T.prototype=k):(T=u((function(t,e,r,n){mr(t,k);var i,a,u,s=0,l=0;if(vt(e)){if(!w(e))return m(e)?b(T,e):Ot(ns,T,e);i=e,l=Xu(r,g);var p=e.byteLength;if(void 0===n){if(p%g)throw c("Wrong length");if((a=p-l)<0)throw c("Wrong length")}else if((a=Fe(n)*g)+l>p)throw c("Wrong length");u=a/g}else u=eu(e),i=new f(a=u*g);for(o(t,{buffer:i,byteOffset:l,byteLength:a,length:u,view:new h(i)});s<u;)j(t,s++)})),fr&&fr(T,d),k=T.prototype=$i(y)),k.constructor!==T&&re(k,"constructor",T),i(k).TypedArrayConstructor=T,v&&re(k,v,x);var P=T!=O;I[x]=T,ar({global:!0,constructor:!0,forced:P,sham:!p},I),"BYTES_PER_ELEMENT"in T||re(T,"BYTES_PER_ELEMENT",g),"BYTES_PER_ELEMENT"in k||re(k,"BYTES_PER_ELEMENT",g),yr(x)}):t.exports=function(){}}));is("Uint8",(function(t){return function(e,r,n){return t(this,e,r,n)}}),!0);var as=TypeError,us=function(t,e){if(!delete t[e])throw as("Cannot delete property "+_t(e)+" of "+_t(t))},ss=Math.min,cs=N([].copyWithin||function(t,e){var r=z(this),n=We(r),o=Ce(t,n),i=Ce(e,n),a=arguments.length>2?arguments[2]:void 0,u=ss((void 0===a?n:Ce(a,n))-i,n-o),s=1;for(i<o&&o<i+u&&(s=-1,i+=u-1,o+=u-1);u-- >0;)i in r?r[o]=r[i]:us(r,o),o+=s,i+=s;return r}),fs=Ya.aTypedArray;(0,Ya.exportTypedArrayMethod)("copyWithin",(function(t,e){return cs(fs(this),t,e,arguments.length>2?arguments[2]:void 0)}));var ls=Ai.every,hs=Ya.aTypedArray;(0,Ya.exportTypedArrayMethod)("every",(function(t){return ls(hs(this),t,arguments.length>1?arguments[1]:void 0)}));var ps=Ya.aTypedArray,vs=Ya.exportTypedArrayMethod,ds=N("".slice);vs("fill",(function(t){var e=arguments.length;ps(this);var r="Big"===ds(be(this),0,3)?es(t):+t;return Ot(fu,this,r,e>1?arguments[1]:void 0,e>2?arguments[2]:void 0)}),P((function(){var t=0;return new Int8Array(2).fill({valueOf:function(){return t++}}),1!==t})));var ys=Ya.aTypedArrayConstructor,gs=Ya.getTypedArrayConstructor,ms=function(t){return ys(Nr(t,gs(t)))},bs=function(t,e){return function(t,e){for(var r=0,n=We(e),o=new t(n);n>r;)o[r]=e[r++];return o}(ms(t),e)},xs=Ai.filter,ws=Ya.aTypedArray;(0,Ya.exportTypedArrayMethod)("filter",(function(t){var e=xs(ws(this),t,arguments.length>1?arguments[1]:void 0);return bs(this,e)}));var Es=Ai.find,As=Ya.aTypedArray;(0,Ya.exportTypedArrayMethod)("find",(function(t){return Es(As(this),t,arguments.length>1?arguments[1]:void 0)}));var Os=Ai.findIndex,Ss=Ya.aTypedArray;(0,Ya.exportTypedArrayMethod)("findIndex",(function(t){return Os(Ss(this),t,arguments.length>1?arguments[1]:void 0)}));var Ts=Ai.forEach,ks=Ya.aTypedArray;(0,Ya.exportTypedArrayMethod)("forEach",(function(t){Ts(ks(this),t,arguments.length>1?arguments[1]:void 0)}));var Is=Be.includes,js=Ya.aTypedArray;(0,Ya.exportTypedArrayMethod)("includes",(function(t){return Is(js(this),t,arguments.length>1?arguments[1]:void 0)}));var Ps=Be.indexOf,_s=Ya.aTypedArray;(0,Ya.exportTypedArrayMethod)("indexOf",(function(t){return Ps(_s(this),t,arguments.length>1?arguments[1]:void 0)}));var Ms=it("iterator"),Ls=S.Uint8Array,Rs=N(Oa.values),Ns=N(Oa.keys),Cs=N(Oa.entries),Ds=Ya.aTypedArray,Fs=Ya.exportTypedArrayMethod,Ws=Ls&&Ls.prototype,zs=!P((function(){Ws[Ms].call([1])})),Bs=!!Ws&&Ws.values&&Ws[Ms]===Ws.values&&"values"===Ws.values.name,Us=function(){return Rs(Ds(this))};Fs("entries",(function(){return Cs(Ds(this))}),zs),Fs("keys",(function(){return Ns(Ds(this))}),zs),Fs("values",Us,zs||!Bs,{name:"values"}),Fs(Ms,Us,zs||!Bs,{name:"values"});var Gs=Ya.aTypedArray,Vs=Ya.exportTypedArrayMethod,Hs=N([].join);Vs("join",(function(t){return Hs(Gs(this),t)}));var qs=Math.min,Zs=[].lastIndexOf,Ys=!!Zs&&1/[1].lastIndexOf(1,-0)<0,$s=Oi("lastIndexOf"),Ks=Ys||!$s?function(t){if(Ys)return Wr(Zs,this,arguments)||0;var e=ke(this),r=We(e),n=r-1;for(arguments.length>1&&(n=qs(n,Le(arguments[1]))),n<0&&(n=r+n);n>=0;n--)if(n in e&&e[n]===t)return n||0;return-1}:Zs,Qs=Ya.aTypedArray;(0,Ya.exportTypedArrayMethod)("lastIndexOf",(function(t){var e=arguments.length;return Wr(Ks,Qs(this),e>1?[t,arguments[1]]:[t])}));var Xs=Ai.map,Js=Ya.aTypedArray;(0,Ya.exportTypedArrayMethod)("map",(function(t){return Xs(Js(this),t,arguments.length>1?arguments[1]:void 0,(function(t,e){return new(ms(t))(e)}))}));var tc=TypeError,ec=function(t){return function(e,r,n,o){Lt(r);var i=z(e),a=Te(i),u=We(i),s=t?u-1:0,c=t?-1:1;if(n<2)for(;;){if(s in a){o=a[s],s+=c;break}if(s+=c,t?s<0:u<=s)throw tc("Reduce of empty array with no initial value")}for(;t?s>=0:u>s;s+=c)s in a&&(o=r(o,a[s],s,i));return o}},rc={left:ec(!1),right:ec(!0)},nc=rc.left,oc=Ya.aTypedArray;(0,Ya.exportTypedArrayMethod)("reduce",(function(t){var e=arguments.length;return nc(oc(this),t,e,e>1?arguments[1]:void 0)}));var ic=rc.right,ac=Ya.aTypedArray;(0,Ya.exportTypedArrayMethod)("reduceRight",(function(t){var e=arguments.length;return ic(ac(this),t,e,e>1?arguments[1]:void 0)}));var uc=Ya.aTypedArray,sc=Ya.exportTypedArrayMethod,cc=Math.floor;sc("reverse",(function(){for(var t,e=uc(this).length,r=cc(e/2),n=0;n<r;)t=this[n],this[n++]=this[--e],this[e]=t;return this}));var fc=S.RangeError,lc=S.Int8Array,hc=lc&&lc.prototype,pc=hc&&hc.set,vc=Ya.aTypedArray,dc=Ya.exportTypedArrayMethod,yc=!P((function(){var t=new Uint8ClampedArray(2);return Ot(pc,t,{length:1,0:3},1),3!==t[1]})),gc=yc&&Ya.NATIVE_ARRAY_BUFFER_VIEWS&&P((function(){var t=new lc(2);return t.set(1),t.set("2",1),0!==t[0]||2!==t[1]}));dc("set",(function(t){vc(this);var e=Xu(arguments.length>1?arguments[1]:void 0,1),r=z(t);if(yc)return Ot(pc,this,r,e);var n=this.length,o=We(r),i=0;if(o+e>n)throw fc("Wrong length");for(;i<o;)this[e+i]=r[i++]}),!yc||gc);var mc=Ya.aTypedArray;(0,Ya.exportTypedArrayMethod)("slice",(function(t,e){for(var r=Vr(mc(this),t,e),n=ms(this),o=0,i=r.length,a=new n(i);i>o;)a[o]=r[o++];return a}),P((function(){new Int8Array(1).slice()})));var bc=Ai.some,xc=Ya.aTypedArray;(0,Ya.exportTypedArrayMethod)("some",(function(t){return bc(xc(this),t,arguments.length>1?arguments[1]:void 0)}));var wc=Math.floor,Ec=function(t,e){var r=t.length,n=wc(r/2);return r<8?Ac(t,e):Oc(t,Ec(pu(t,0,n),e),Ec(pu(t,n),e),e)},Ac=function(t,e){for(var r,n,o=t.length,i=1;i<o;){for(n=i,r=t[i];n&&e(t[n-1],r)>0;)t[n]=t[--n];n!==i++&&(t[n]=r)}return t},Oc=function(t,e,r,n){for(var o=e.length,i=r.length,a=0,u=0;a<o||u<i;)t[a+u]=a<o&&u<i?n(e[a],r[u])<=0?e[a++]:r[u++]:a<o?e[a++]:r[u++];return t},Sc=Ec,Tc=Z.match(/firefox\\/(\\d+)/i),kc=!!Tc&&+Tc[1],Ic=/MSIE|Trident/.test(Z),jc=Z.match(/AppleWebKit\\/(\\d+)\\./),Pc=!!jc&&+jc[1],_c=Ya.aTypedArray,Mc=Ya.exportTypedArrayMethod,Lc=S.Uint16Array,Rc=Lc&&zr(Lc.prototype.sort),Nc=!(!Rc||P((function(){Rc(new Lc(2),null)}))&&P((function(){Rc(new Lc(2),{})}))),Cc=!!Rc&&!P((function(){if(X)return X<74;if(kc)return kc<67;if(Ic)return!0;if(Pc)return Pc<602;var t,e,r=new Lc(516),n=Array(516);for(t=0;t<516;t++)e=t%4,r[t]=515-t,n[t]=t-2*e+3;for(Rc(r,(function(t,e){return(t/4|0)-(e/4|0)})),t=0;t<516;t++)if(r[t]!==n[t])return!0}));Mc("sort",(function(t){return void 0!==t&&Lt(t),Cc?Rc(this,t):Sc(_c(this),function(t){return function(e,r){return void 0!==t?+t(e,r)||0:r!=r?-1:e!=e?1:0===e&&0===r?1/e>0&&1/r<0?1:-1:e>r}}(t))}),!Cc||Nc);var Dc=Ya.aTypedArray;(0,Ya.exportTypedArrayMethod)("subarray",(function(t,e){var r=Dc(this),n=r.length,o=Ce(t,n);return new(ms(r))(r.buffer,r.byteOffset+o*r.BYTES_PER_ELEMENT,Fe((void 0===e?n:Ce(e,n))-o))}));var Fc=S.Int8Array,Wc=Ya.aTypedArray,zc=Ya.exportTypedArrayMethod,Bc=[].toLocaleString,Uc=!!Fc&&P((function(){Bc.call(new Fc(1))}));zc("toLocaleString",(function(){return Wr(Bc,Uc?Vr(Wc(this)):Wc(this),Vr(arguments))}),P((function(){return[1,2].toLocaleString()!=new Fc([1,2]).toLocaleString()}))||!P((function(){Fc.prototype.toLocaleString.call([1,2])})));var Gc=Ya.exportTypedArrayMethod,Vc=S.Uint8Array,Hc=Vc&&Vc.prototype||{},qc=[].toString,Zc=N([].join);P((function(){qc.call({})}))&&(qc=function(){return Zc(this)});var Yc=Hc.toString!=qc;Gc("toString",qc,Yc),ar({target:"Array",proto:!0},{fill:fu}),ra("fill");var $c,Kc,Qc=String,Xc=function(t){if("Symbol"===be(t))throw TypeError("Cannot convert a Symbol value to a string");return Qc(t)},Jc=function(){var t=Et(this),e="";return t.hasIndices&&(e+="d"),t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.dotAll&&(e+="s"),t.unicode&&(e+="u"),t.unicodeSets&&(e+="v"),t.sticky&&(e+="y"),e},tf=S.RegExp,ef=P((function(){var t=tf("a","y");return t.lastIndex=2,null!=t.exec("abcd")})),rf=ef||P((function(){return!tf("a","y").sticky})),nf={BROKEN_CARET:ef||P((function(){var t=tf("^r","gy");return t.lastIndex=2,null!=t.exec("str")})),MISSED_STICKY:rf,UNSUPPORTED_Y:ef},of=S.RegExp,af=P((function(){var t=of(".","s");return!(t.dotAll&&t.exec("\\n")&&"s"===t.flags)})),uf=S.RegExp,sf=P((function(){var t=uf("(?<a>b)","g");return"b"!==t.exec("b").groups.a||"bc"!=="b".replace(t,"$<a>c")})),cf=fe.get,ff=j("native-string-replace",String.prototype.replace),lf=RegExp.prototype.exec,hf=lf,pf=N("".charAt),vf=N("".indexOf),df=N("".replace),yf=N("".slice),gf=(Kc=/b*/g,Ot(lf,$c=/a/,"a"),Ot(lf,Kc,"a"),0!==$c.lastIndex||0!==Kc.lastIndex),mf=nf.BROKEN_CARET,bf=void 0!==/()??/.exec("")[1];(gf||bf||mf||af||sf)&&(hf=function(t){var e,r,n,o,i,a,u,s=this,c=cf(s),f=Xc(t),l=c.raw;if(l)return l.lastIndex=s.lastIndex,e=Ot(hf,l,f),s.lastIndex=l.lastIndex,e;var h=c.groups,p=mf&&s.sticky,v=Ot(Jc,s),d=s.source,y=0,g=f;if(p&&(v=df(v,"y",""),-1===vf(v,"g")&&(v+="g"),g=yf(f,s.lastIndex),s.lastIndex>0&&(!s.multiline||s.multiline&&"\\n"!==pf(f,s.lastIndex-1))&&(d="(?: "+d+")",g=" "+g,y++),r=new RegExp("^(?:"+d+")",v)),bf&&(r=new RegExp("^"+d+"$(?!\\\\s)",v)),gf&&(n=s.lastIndex),o=Ot(lf,p?r:s,g),p?o?(o.input=yf(o.input,y),o[0]=yf(o[0],y),o.index=s.lastIndex,s.lastIndex+=o[0].length):s.lastIndex=0:gf&&o&&(s.lastIndex=s.global?o.index+o[0].length:n),bf&&o&&o.length>1&&Ot(ff,o[0],r,(function(){for(i=1;i<arguments.length-2;i++)void 0===arguments[i]&&(o[i]=void 0)})),o&&h)for(o.groups=a=$i(null),i=0;i<h.length;i++)a[(u=h[i])[0]]=o[u[1]];return o});var xf=hf;ar({target:"RegExp",proto:!0,forced:/./.exec!==xf},{exec:xf});var wf,Ef=it("species"),Af=RegExp.prototype,Of=function(t,e,r,n){var o=it(t),i=!P((function(){var e={};return e[o]=function(){return 7},7!=""[t](e)})),a=i&&!P((function(){var e=!1,r=/a/;return"split"===t&&((r={}).constructor={},r.constructor[Ef]=function(){return r},r.flags="",r[o]=/./[o]),r.exec=function(){return e=!0,null},r[o](""),!e}));if(!i||!a||r){var u=zr(/./[o]),s=e(o,""[t],(function(t,e,r,n,o){var a=zr(t),s=e.exec;return s===xf||s===Af.exec?i&&!o?{done:!0,value:u(e,r,n)}:{done:!0,value:a(r,e,n)}:{done:!1}}));he(String.prototype,t,s[0]),he(Af,o,s[1])}n&&re(Af[o],"sham",!0)},Sf=N("".charAt),Tf=N("".charCodeAt),kf=N("".slice),If=function(t){return function(e,r){var n,o,i=Xc(F(e)),a=Le(r),u=i.length;return a<0||a>=u?t?"":void 0:(n=Tf(i,a))<55296||n>56319||a+1===u||(o=Tf(i,a+1))<56320||o>57343?t?Sf(i,a):n:t?kf(i,a,a+2):o-56320+(n-55296<<10)+65536}},jf={codeAt:If(!1),charAt:If(!0)},Pf=jf.charAt,_f=function(t,e,r){return e+(r?Pf(t,e).length:1)},Mf=Math.floor,Lf=N("".charAt),Rf=N("".replace),Nf=N("".slice),Cf=/\\$([$&'\`]|\\d{1,2}|<[^>]*>)/g,Df=/\\$([$&'\`]|\\d{1,2})/g,Ff=function(t,e,r,n,o,i){var a=r+t.length,u=n.length,s=Df;return void 0!==o&&(o=z(o),s=Cf),Rf(i,s,(function(i,s){var c;switch(Lf(s,0)){case"$":return"$";case"&":return t;case"\`":return Nf(e,0,r);case"'":return Nf(e,a);case"<":c=o[Nf(s,1,-1)];break;default:var f=+s;if(0===f)return i;if(f>u){var l=Mf(f/10);return 0===l?i:l<=u?void 0===n[l-1]?Lf(s,1):n[l-1]+Lf(s,1):i}c=n[f-1]}return void 0===c?"":c}))},Wf=TypeError,zf=function(t,e){var r=t.exec;if(lt(r)){var n=Ot(r,t,e);return null!==n&&Et(n),n}if("RegExp"===de(t))return Ot(xf,t,e);throw Wf("RegExp#exec called on incompatible receiver")},Bf=it("replace"),Uf=Math.max,Gf=Math.min,Vf=N([].concat),Hf=N([].push),qf=N("".indexOf),Zf=N("".slice),Yf="$0"==="a".replace(/./,"$0"),$f=!!/./[Bf]&&""===/./[Bf]("a","$0");function Kf(t){this.message=t}Of("replace",(function(t,e,r){var n=$f?"$":"$0";return[function(t,r){var n=F(this),o=C(t)?void 0:Rt(t,Bf);return o?Ot(o,t,n,r):Ot(e,Xc(n),t,r)},function(t,o){var i=Et(this),a=Xc(t);if("string"==typeof o&&-1===qf(o,n)&&-1===qf(o,"$<")){var u=r(e,i,a,o);if(u.done)return u.value}var s=lt(o);s||(o=Xc(o));var c=i.global;if(c){var f=i.unicode;i.lastIndex=0}for(var l=[];;){var h=zf(i,a);if(null===h)break;if(Hf(l,h),!c)break;""===Xc(h[0])&&(i.lastIndex=_f(a,Fe(i.lastIndex),f))}for(var p,v="",d=0,y=0;y<l.length;y++){for(var g=Xc((h=l[y])[0]),m=Uf(Gf(Le(h.index),a.length),0),b=[],x=1;x<h.length;x++)Hf(b,void 0===(p=h[x])?p:String(p));var w=h.groups;if(s){var E=Vf([g],b,m,a);void 0!==w&&Hf(E,w);var A=Xc(Wr(o,void 0,E))}else A=Ff(g,a,m,b,w,o);m>=d&&(v+=Zf(a,d,m)+A,d=m+g.length)}return v+Zf(a,d)}]}),!!P((function(){var t=/./;return t.exec=function(){var t=[];return t.groups={a:"7"},t},"7"!=="".replace(t,"$<a>")}))||!Yf||$f),Kf.prototype=new Error,Kf.prototype.name="InvalidCharacterError",ar({global:!0,forced:S.globalThis!==S},{globalThis:S}),wf="undefined"==typeof window?{devicePixelRatio:1,navigator:{userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36",browserLanguage:"zh-CN",language:"zh-CN",platform:""},location:"",document:{documentElement:{style:{}},createEvent:function(){return!0},getElementById:function(t){return!0},createElement:function(){return{className:"",classList:{add:function(){return""}}}},createElementNS:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},querySelector:function(){return!1}},performance:{mark:function(t){return null},clearMeasures:function(t){return null},clearMarks:function(t){return null},measure:function(t,e,r){return{duration:0}},now:function(){return(new Date).getTime()}},Blob:"",dispatchEvent:function(t){return!0},Event:function(t,e){return!0},createElement:function(){return!0},createElementNS:function(){return!0},XMLHttpRequest:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},requestAnimationFrame:function(){return!0},cancelAnimationFrame:function(){return!0},clearTimeout:function(){return!0}}:window,"undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM?my.getSystemInfoSync().pixelRatio:wf.devicePixelRatio;var Qf=TypeError,Xf=Object.getOwnPropertyDescriptor,Jf=ht&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(t){return t instanceof TypeError}}()?function(t,e){if(gi(t)&&!Xf(t,"length").writable)throw Qf("Cannot set read only .length");return t.length=e}:function(t,e){return t.length=e},tl=TypeError,el=function(t){if(t>9007199254740991)throw tl("Maximum allowed index exceeded");return t},rl=_i("splice"),nl=Math.max,ol=Math.min;ar({target:"Array",proto:!0,forced:!rl},{splice:function(t,e){var r,n,o,i,a,u,s=z(this),c=We(s),f=Ce(t,c),l=arguments.length;for(0===l?r=n=0:1===l?(r=0,n=c-f):(r=l-2,n=ol(nl(Le(e),0),c-f)),el(c+r-n),o=xi(s,n),i=0;i<n;i++)(a=f+i)in s&&ji(o,i,s[a]);if(o.length=n,r<n){for(i=f;i<c-n;i++)u=i+r,(a=i+n)in s?s[u]=s[a]:us(s,u);for(i=c;i>c-n+r;i--)us(s,i-1)}else if(r>n)for(i=c-n;i>f;i--)u=i+r-1,(a=i+n-1)in s?s[u]=s[a]:us(s,u);for(i=0;i<r;i++)s[i+f]=arguments[i+2];return Jf(s,c-n+r),o}});var il=u((function t(e,r){i(this,t),s(this,"cancelBubble",void 0),s(this,"cancelable",void 0),s(this,"target",void 0),s(this,"currentTarget",void 0),s(this,"preventDefault",void 0),s(this,"stopPropagation",void 0),s(this,"type",void 0),s(this,"timeStamp",void 0),this.cancelBubble=!1,this.cancelable=!1,this.target=null,this.currentTarget=null,this.preventDefault=function(){},this.stopPropagation=function(){},this.type=e,this.timeStamp=Date.now()})),al=Object.assign,ul=Object.defineProperty,sl=N([].concat),cl=!al||P((function(){if(ht&&1!==al({b:1},al(ul({},"a",{enumerable:!0,get:function(){ul(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var t={},e={},r=Symbol();return t[r]=7,"abcdefghijklmnopqrst".split("").forEach((function(t){e[t]=t})),7!=al({},t)[r]||"abcdefghijklmnopqrst"!=Ui(al({},e)).join("")}))?function(t,e){for(var r=z(t),n=arguments.length,o=1,i=Ye.f,a=Ae.f;n>o;)for(var u,s=Te(arguments[o++]),c=i?sl(Ui(s),i(s)):Ui(s),f=c.length,l=0;f>l;)u=c[l++],ht&&!Ot(a,s,u)||(r[u]=s[u]);return r}:al;ar({target:"Object",stat:!0,arity:2,forced:Object.assign!==cl},{assign:cl});var fl=Ai.findIndex,ll=!0;"findIndex"in[]&&Array(1).findIndex((function(){ll=!1})),ar({target:"Array",proto:!0,forced:ll},{findIndex:function(t){return fl(this,t,arguments.length>1?arguments[1]:void 0)}}),ra("findIndex");var hl=jf.charAt,pl=fe.set,vl=fe.getterFor("String Iterator");ba(String,"String",(function(t){pl(this,{type:"String Iterator",string:Xc(t),index:0})}),(function(){var t,e=vl(this),r=e.string,n=e.index;return n>=r.length?xa(void 0,!0):(t=hl(r,n),e.index+=t.length,xa(t,!1))}));var dl=!P((function(){return Object.isExtensible(Object.preventExtensions({}))})),yl=Ze.f,gl="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],ml={f:function(t){return gl&&"Window"==de(t)?function(t){try{return yl(t)}catch(t){return pu(gl)}}(t):yl(ke(t))}},bl=P((function(){if("function"==typeof ArrayBuffer){var t=new ArrayBuffer(8);Object.isExtensible(t)&&Object.defineProperty(t,"a",{value:8})}})),xl=Object.isExtensible,wl=P((function(){xl(1)}))||bl?function(t){return!!vt(t)&&((!bl||"ArrayBuffer"!=de(t))&&(!xl||xl(t)))}:xl,El=w((function(t){var e=Gt.f,r=!1,n=q("meta"),o=0,i=function(t){e(t,n,{value:{objectID:"O"+o++,weakData:{}}})},a=t.exports={enable:function(){a.enable=function(){},r=!0;var t=Ze.f,e=N([].splice),o={};o[n]=1,t(o).length&&(Ze.f=function(r){for(var o=t(r),i=0,a=o.length;i<a;i++)if(o[i]===n){e(o,i,1);break}return o},ar({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:ml.f}))},fastKey:function(t,e){if(!vt(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!U(t,n)){if(!wl(t))return"F";if(!e)return"E";i(t)}return t[n].objectID},getWeakData:function(t,e){if(!U(t,n)){if(!wl(t))return!0;if(!e)return!1;i(t)}return t[n].weakData},onFreeze:function(t){return dl&&r&&wl(t)&&!U(t,n)&&i(t),t}};ie[n]=!0})),Al=(El.enable,El.fastKey,El.getWeakData,El.onFreeze,function(t,e,r){var n=-1!==t.indexOf("Map"),o=-1!==t.indexOf("Weak"),i=n?"set":"add",a=S[t],u=a&&a.prototype,s=a,c={},f=function(t){var e=N(u[t]);he(u,t,"add"==t?function(t){return e(this,0===t?0:t),this}:"delete"==t?function(t){return!(o&&!vt(t))&&e(this,0===t?0:t)}:"get"==t?function(t){return o&&!vt(t)?void 0:e(this,0===t?0:t)}:"has"==t?function(t){return!(o&&!vt(t))&&e(this,0===t?0:t)}:function(t,r){return e(this,0===t?0:t,r),this})};if(or(t,!lt(a)||!(o||u.forEach&&!P((function(){(new a).entries().next()})))))s=r.getConstructor(e,t,n,i),El.enable();else if(or(t,!0)){var l=new s,h=l[i](o?{}:-0,1)!=l,p=P((function(){l.has(1)})),v=Mo((function(t){new a(t)})),d=!o&&P((function(){for(var t=new a,e=5;e--;)t[i](e,e);return!t.has(-0)}));v||((s=e((function(t,e){mr(t,u);var r=os(new a,t,s);return C(e)||ko(e,r[i],{that:r,AS_ENTRIES:n}),r}))).prototype=u,u.constructor=s),(p||d)&&(f("delete"),f("has"),n&&f("get")),(d||h)&&f(i),o&&u.clear&&delete u.clear}return c[t]=s,ar({global:!0,constructor:!0,forced:s!=a},c),pr(s,t),o||r.setStrong(s,t,n),s}),Ol=El.getWeakData,Sl=fe.set,Tl=fe.getterFor,kl=Ai.find,Il=Ai.findIndex,jl=N([].splice),Pl=0,_l=function(t){return t.frozen||(t.frozen=new Ml)},Ml=function(){this.entries=[]},Ll=function(t,e){return kl(t.entries,(function(t){return t[0]===e}))};Ml.prototype={get:function(t){var e=Ll(this,t);if(e)return e[1]},has:function(t){return!!Ll(this,t)},set:function(t,e){var r=Ll(this,t);r?r[1]=e:this.entries.push([t,e])},delete:function(t){var e=Il(this.entries,(function(e){return e[0]===t}));return~e&&jl(this.entries,e,1),!!~e}};var Rl,Nl={getConstructor:function(t,e,r,n){var o=t((function(t,o){mr(t,i),Sl(t,{type:e,id:Pl++,frozen:void 0}),C(o)||ko(o,t[n],{that:t,AS_ENTRIES:r})})),i=o.prototype,a=Tl(e),u=function(t,e,r){var n=a(t),o=Ol(Et(e),!0);return!0===o?_l(n).set(e,r):o[n.id]=r,t};return Ja(i,{delete:function(t){var e=a(this);if(!vt(t))return!1;var r=Ol(t);return!0===r?_l(e).delete(t):r&&U(r,e.id)&&delete r[e.id]},has:function(t){var e=a(this);if(!vt(t))return!1;var r=Ol(t);return!0===r?_l(e).has(t):r&&U(r,e.id)}}),Ja(i,r?{get:function(t){var e=a(this);if(vt(t)){var r=Ol(t);return!0===r?_l(e).get(t):r?r[e.id]:void 0}},set:function(t,e){return u(this,t,e)}}:{add:function(t){return u(this,t,!0)}}),o}},Cl=fe.enforce,Dl=Object,Fl=Array.isArray,Wl=Dl.isExtensible,zl=Dl.isFrozen,Bl=Dl.isSealed,Ul=Dl.freeze,Gl=Dl.seal,Vl={},Hl={},ql=!S.ActiveXObject&&"ActiveXObject"in S,Zl=function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}},Yl=Al("WeakMap",Zl,Nl),$l=Yl.prototype,Kl=N($l.set);if(te)if(ql){Rl=Nl.getConstructor(Zl,"WeakMap",!0),El.enable();var Ql=N($l.delete),Xl=N($l.has),Jl=N($l.get);Ja($l,{delete:function(t){if(vt(t)&&!Wl(t)){var e=Cl(this);return e.frozen||(e.frozen=new Rl),Ql(this,t)||e.frozen.delete(t)}return Ql(this,t)},has:function(t){if(vt(t)&&!Wl(t)){var e=Cl(this);return e.frozen||(e.frozen=new Rl),Xl(this,t)||e.frozen.has(t)}return Xl(this,t)},get:function(t){if(vt(t)&&!Wl(t)){var e=Cl(this);return e.frozen||(e.frozen=new Rl),Xl(this,t)?Jl(this,t):e.frozen.get(t)}return Jl(this,t)},set:function(t,e){if(vt(t)&&!Wl(t)){var r=Cl(this);r.frozen||(r.frozen=new Rl),Xl(this,t)?Kl(this,t,e):r.frozen.set(t,e)}else Kl(this,t,e);return this}})}else dl&&P((function(){var t=Ul([]);return Kl(new Yl,t,1),!zl(t)}))&&Ja($l,{set:function(t,e){var r;return Fl(t)&&(zl(t)?r=Vl:Bl(t)&&(r=Hl)),Kl(this,t,e),r==Vl&&Ul(t),r==Hl&&Gl(t),this}});var th=it("iterator"),eh=it("toStringTag"),rh=Oa.values,nh=function(t,e){if(t){if(t[th]!==rh)try{re(t,th,rh)}catch(e){t[th]=rh}if(t[eh]||re(t,eh,e),pi[e])for(var r in Oa)if(t[r]!==Oa[r])try{re(t,r,Oa[r])}catch(e){t[r]=Oa[r]}}};for(var oh in pi)nh(S[oh]&&S[oh].prototype,oh);nh(yi,"DOMTokenList");var ih,ah,uh,sh,ch=new WeakMap,fh=function(){function t(){i(this,t),ch.set(this,{})}return u(t,[{key:"addEventListener",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=ch.get(this);n||(n={}),n[t]||(n[t]=[]),n[t].push(e),ch.set(this,n),r.capture,r.once,r.passive}},{key:"removeEventListener",value:function(t,e){var r=ch.get(this);if(r){var n=r[t];if(n&&n.length>0)for(var o=n.length;o--;o>0)if(n[o]===e){n.splice(o,1);break}}}},{key:"dispatchEvent",value:function(t){var e=ch.get(this)[t.type];if(e){var r,n=function(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=g(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return a=t.done,t},e:function(t){u=!0,i=t},f:function(){try{a||null==r.return||r.return()}finally{if(u)throw i}}}}(e);try{for(n.s();!(r=n.n()).done;){(0,r.value)(t)}}catch(t){n.e(t)}finally{n.f()}}}}]),t}(),lh=function(t){c(r,t);var e=v(r);function r(){var t;return i(this,r),s(h(t=e.call(this)),"className",void 0),s(h(t),"children",void 0),t.className="",t.children=[],t}return u(r,[{key:"setAttribute",value:function(t,e){this[t]=e}},{key:"getAttribute",value:function(t){return this[t]}},{key:"setAttributeNS",value:function(t,e){this[t]=e}},{key:"getAttributeNS",value:function(t){return this[t]}}]),r}(function(t){c(r,t);var e=v(r);function r(){var t;return i(this,r),s(h(t=e.call(this)),"childNodes",void 0),t.childNodes=[],t}return u(r,[{key:"appendChild",value:function(t){this.childNodes.push(t)}},{key:"cloneNode",value:function(){var t=Object.create(this);return Object.assign(t,this),t}},{key:"removeChild",value:function(t){var e=this.childNodes.findIndex((function(e){return e===t}));return e>-1?this.childNodes.splice(e,1):null}}]),r}(fh));if("undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM){var hh=my.getSystemInfoSync();ih=hh.screenWidth,ah=hh.screenHeight,uh=hh.windowWidth,sh=hh.windowHeight}else{var ph=wf.innerWidth,vh=wf.innerHeight;ih=ph,ah=vh,uh=ph,sh=vh}var dh={width:ih,height:ah,availWidth:uh,availHeight:sh,availLeft:0,availTop:0},yh=dh.availWidth,gh=dh.availHeight,mh={style:[]};function bh(t,e){var r,n;"parentNode"in t||(r=0===e?function(){return null}:1===e?function(){return mh}:function(){return null},Object.defineProperty(t,"parentNode",{enumerable:!0,get:r}));"parentElement"in t||(n=0===e?function(){return null}:1===e?function(){return mh}:function(){return null},Object.defineProperty(t,"parentElement",{enumerable:!0,get:n}))}function xh(t){t.style=t.style||{},Object.assign(t.style,{top:"0px",left:"0px",width:yh+"px",height:gh+"px",margin:"0px",padding:"0px"})}function wh(t){"clientLeft"in t||(t.clientLeft=0,t.clientTop=0),"clientWidth"in t||(t.clientWidth=yh,t.clientHeight=gh),"getBoundingClientRect"in t||(t.getBoundingClientRect=function(){return{x:0,y:0,top:0,left:0,width:this.clientWidth,height:this.clientHeight,right:this.clientWidth,bottom:this.clientHeight}})}function Eh(t){"offsetLeft"in t||(t.offsetLeft=0,t.offsetTop=0),"offsetWidth"in t||(t.offsetWidth=yh,t.offsetHeight=gh)}function Ah(t){"scrollLeft"in t||(t.scrollLeft=0,t.scrollTop=0),"scrollWidth"in t||(t.scrollWidth=yh,t.scrollHeight=gh)}function Oh(t){var e=function(){return!0};t.classList=[],t.classList.add=e,t.classList.remove=e,t.classList.contains=e,t.classList.toggle=e}function Sh(){}var Th=function(t){c(r,t);var e=v(r);function r(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",o=arguments.length>1?arguments[1]:void 0;return i(this,r),s(h(t=e.call(this)),"className",void 0),s(h(t),"children",void 0),s(h(t),"focus",void 0),s(h(t),"blur",void 0),s(h(t),"insertBefore",void 0),s(h(t),"appendChild",void 0),s(h(t),"removeChild",void 0),s(h(t),"remove",void 0),s(h(t),"innerHTML",void 0),s(h(t),"tagName",void 0),t.className="",t.children=[],t.focus=Sh,t.blur=Sh,t.insertBefore=Sh,t.appendChild=Sh,t.removeChild=Sh,t.remove=Sh,t.innerHTML="",t.tagName=n.toUpperCase(),bh(h(t),o),xh(h(t)),Oh(h(t)),wh(h(t)),Eh(h(t)),Ah(h(t)),t}return u(r)}(lh),kh=function(t){c(r,t);var e=v(r);function r(){return i(this,r),e.call(this,"video")}return u(r)}(function(t){c(r,t);var e=v(r);function r(t){return i(this,r),e.call(this,t)}return u(r,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),r}(Th)),Ih={};function jh(){return Ih}var Ph=u((function t(){i(this,t);var e=jh(),r=e.createImage&&e.createImage()||{};return"tagName"in r||(r.tagName="IMG",r.__proto__=t.prototype),bh(r),Oh(r),Object.assign(r,{addEventListener:function(t,e){r["on".concat(t)]=e.bind(r)},removeEventListener:function(t){r["on".concat(t)]=null}}),r})),_h={href:"",protocol:"",host:""},Mh=function(t){c(r,t);var e=v(r);function r(){return i(this,r),e.call(this,"body",0)}return u(r,[{key:"addEventListener",value:function(t,e){}},{key:"removeEventListener",value:function(t,e,r){}},{key:"dispatchEvent",value:function(t){}}]),r}(Th),Lh=function(t){c(r,t);var e=v(r);function r(){return i(this,r),e.call(this,"html",0)}return u(r,[{key:"addEventListener",value:function(t,e){}},{key:"removeEventListener",value:function(t,e){}},{key:"dispatchEvent",value:function(t){}}]),r}(Th),Rh={},Nh={readyState:"complete",visibilityState:"visible",hidden:!1,fullscreen:!0,scripts:[],style:{},location:_h,ontouchstart:null,ontouchmove:null,ontouchend:null,onvisibilitychange:null,parentNode:null,parentElement:null,head:null,body:null,documentElement:{style:[]},createElement:function(t){return"canvas"===(t=t.toLowerCase())?my.createOffscreenCanvas(1024,128,"2d"):"img"===t?new Ph:"video"===t?new kh:new Th(t)},createElementNS:function(t,e){return this.createElement(e)},createTextNode:function(t){return t},getElementById:function(t){return null},getElementsByTagName:function(t){return t=t.toLowerCase(),[]},getElementsByTagNameNS:function(t,e){return this.getElementsByTagName(e)},getElementsByName:function(t){return[]},querySelector:function(t){return null},querySelectorAll:function(t){return[]},addEventListener:function(t,e,r){Rh[t]||(Rh[t]=[]),Rh[t].push(e)},removeEventListener:function(t,e){var r=Rh[t];if(r&&r.length>0)for(var n=r.length;n--;n>0)if(r[n]===e){r.splice(n,1);break}},dispatchEvent:function(t){var e=t.type,r=Rh[e];if(r)for(var n=0;n<r.length;n++)r[n](t);t.target&&"function"==typeof t.target["on"+e]&&t.target["on"+e](t)},createEvent:function(t){return new il(t)}};Nh.documentElement=new Lh,Nh.head=new Th("head"),Nh.body=new Mh,Of("match",(function(t,e,r){return[function(e){var r=F(this),n=C(e)?void 0:Rt(e,t);return n?Ot(n,e,r):new RegExp(e)[t](Xc(r))},function(t){var n=Et(this),o=Xc(t),i=r(e,n,o);if(i.done)return i.value;if(!n.global)return zf(n,o);var a=n.unicode;n.lastIndex=0;for(var u,s=[],c=0;null!==(u=zf(n,o));){var f=Xc(u[0]);s[c]=f,""===f&&(n.lastIndex=_f(o,Fe(n.lastIndex),a)),c++}return 0===c?null:s}]}));var Ch,Dh,Fh=it("isConcatSpreadable"),Wh=X>=51||!P((function(){var t=[];return t[Fh]=!1,t.concat()[0]!==t})),zh=function(t){if(!vt(t))return!1;var e=t[Fh];return void 0!==e?!!e:gi(t)},Bh=!Wh||!_i("concat");if(ar({target:"Array",proto:!0,arity:1,forced:Bh},{concat:function(t){var e,r,n,o,i,a=z(this),u=xi(a,0),s=0;for(e=-1,n=arguments.length;e<n;e++)if(zh(i=-1===e?a:arguments[e]))for(o=We(i),el(s+o),r=0;r<o;r++,s++)r in i&&ji(u,s,i[r]);else el(s+1),ji(u,s++,i);return u.length=s,u}}),"undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM){var Uh=my.getSystemInfoSync();Ch=Uh.system,Uh.platform,Uh.language}else{var Gh={versions:(Dh=wf.navigator.userAgent,{trident:Dh.indexOf("Trident")>-1,presto:Dh.indexOf("Presto")>-1,webKit:Dh.indexOf("AppleWebKit")>-1,gecko:Dh.indexOf("Gecko")>-1&&-1===Dh.indexOf("KHTML"),mobile:!!Dh.match(/AppleWebKit.*Mobile.*/),ios:!!Dh.match(/\\(i[^;]+;( U;)? CPU.+Mac OS X/),android:Dh.indexOf("Android")>-1||Dh.indexOf("Linux")>-1,iPhone:Dh.indexOf("iPhone")>-1,iPad:Dh.indexOf("iPad")>-1,webApp:-1===Dh.indexOf("Safari"),weixin:Dh.indexOf("MicroMessenger")>-1,qq:" qq"===Dh.match(/\\sQQ/i)}),language:(wf.navigator.browserLanguage||wf.navigator.language).toLowerCase()};Gh.versions.android?"android":Gh.versions.trident?"IE":Gh.versions.presto?"Opera":Gh.versions.webKit?"webKit":Gh.versions.gecko?"Firefox":Gh.versions.mobile?"mobile":Gh.versions.ios?"ios":Gh.versions.iPhone?"iPhone":Gh.versions.iPad?"ipad":Gh.versions.webApp?"webApp":Gh.versions.weixin?"weixin":Gh.versions.qq&&"qq",Ch=wf.navigator.userAgent,Gh.language}Ch.toLowerCase().indexOf("android");is("Uint8",(function(t){return function(e,r,n){return t(this,e,r,n)}}));var Vh=El.fastKey,Hh=fe.set,qh=fe.getterFor;Al("Map",(function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}}),{getConstructor:function(t,e,r,n){var o=t((function(t,o){mr(t,i),Hh(t,{type:e,index:$i(null),first:void 0,last:void 0,size:0}),ht||(t.size=0),C(o)||ko(o,t[n],{that:t,AS_ENTRIES:r})})),i=o.prototype,a=qh(e),u=function(t,e,r){var n,o,i=a(t),u=s(t,e);return u?u.value=r:(i.last=u={index:o=Vh(e,!0),key:e,value:r,previous:n=i.last,next:void 0,removed:!1},i.first||(i.first=u),n&&(n.next=u),ht?i.size++:t.size++,"F"!==o&&(i.index[o]=u)),t},s=function(t,e){var r,n=a(t),o=Vh(e);if("F"!==o)return n.index[o];for(r=n.first;r;r=r.next)if(r.key==e)return r};return Ja(i,{clear:function(){for(var t=a(this),e=t.index,r=t.first;r;)r.removed=!0,r.previous&&(r.previous=r.previous.next=void 0),delete e[r.index],r=r.next;t.first=t.last=void 0,ht?t.size=0:this.size=0},delete:function(t){var e=a(this),r=s(this,t);if(r){var n=r.next,o=r.previous;delete e.index[r.index],r.removed=!0,o&&(o.next=n),n&&(n.previous=o),e.first==r&&(e.first=n),e.last==r&&(e.last=o),ht?e.size--:this.size--}return!!r},forEach:function(t){for(var e,r=a(this),n=Ur(t,arguments.length>1?arguments[1]:void 0);e=e?e.next:r.first;)for(n(e.value,e.key,this);e&&e.removed;)e=e.previous},has:function(t){return!!s(this,t)}}),Ja(i,r?{get:function(t){var e=s(this,t);return e&&e.value},set:function(t,e){return u(this,0===t?0:t,e)}}:{add:function(t){return u(this,t=0===t?0:t,t)}}),ht&&vr(i,"size",{configurable:!0,get:function(){return a(this).size}}),o},setStrong:function(t,e,r){var n=e+" Iterator",o=qh(e),i=qh(n);ba(t,e,(function(t,e){Hh(this,{type:n,target:t,state:o(t),kind:e,last:void 0})}),(function(){for(var t=i(this),e=t.kind,r=t.last;r&&r.removed;)r=r.previous;return t.target&&(t.last=r=r?r.next:t.state.first)?xa("keys"==e?r.key:"values"==e?r.value:[r.key,r.value],!1):(t.target=void 0,xa(void 0,!0))}),r?"entries":"values",!r,!0),yr(e)}});var Zh=N([].join),Yh=Te!=Object||!Oi("join",",");ar({target:"Array",proto:!0,forced:Yh},{join:function(t){return Zh(ke(this),void 0===t?",":t)}});var $h=Ai.map,Kh=_i("map");ar({target:"Array",proto:!0,forced:!Kh},{map:function(t){return $h(this,t,arguments.length>1?arguments[1]:void 0)}});var Qh=P((function(){Ui(1)}));ar({target:"Object",stat:!0,forced:Qh},{keys:function(t){return Ui(z(t))}});var Xh=new Map,Jh=new Map,tp=new Map,ep=function(t){c(r,t);var e=v(r);function r(){var t;return i(this,r),s(h(t=e.call(this)),"onabort",void 0),s(h(t),"onerror",void 0),s(h(t),"onload",void 0),s(h(t),"onloadstart",void 0),s(h(t),"onprogress",void 0),s(h(t),"ontimeout",void 0),s(h(t),"onloadend",void 0),s(h(t),"onreadystatechange",void 0),s(h(t),"readyState",void 0),s(h(t),"response",void 0),s(h(t),"responseText",void 0),s(h(t),"_responseType",void 0),s(h(t),"responseXML",void 0),s(h(t),"status",void 0),s(h(t),"statusText",void 0),s(h(t),"upload",void 0),s(h(t),"withCredentials",void 0),s(h(t),"timeout",void 0),s(h(t),"_url",void 0),s(h(t),"_method",void 0),t.onabort=null,t.onerror=null,t.onload=null,t.onloadstart=null,t.onprogress=null,t.ontimeout=null,t.onloadend=null,t.onreadystatechange=null,t.readyState=0,t.response=null,t.responseText=null,t._responseType="text",t.responseXML=null,t.status=0,t.statusText="",t.upload={},t.withCredentials=!1,Xh.set("requestHeader",{"content-type":"application/x-www-form-urlencoded"}),t}return u(r,[{key:"responseType",set:function(t){this._responseType=t}},{key:"abort",value:function(){var t=tp.get("requestTask");t&&t.abort()}},{key:"getAllResponseHeaders",value:function(){var t=Jh.get("responseHeader");return Object.keys(t).map((function(e){return"".concat(e,": ").concat(t[e])})).join("\\n")}},{key:"getResponseHeader",value:function(t){return Jh.get("responseHeader")[t]}},{key:"open",value:function(t,e,r){this._method=t,this._url=e}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){}},{key:"setRequestHeader",value:function(t,e){var r=Xh.get("requestHeader");r[t]=e,Xh.set("requestHeader",r)}},{key:"addEventListener",value:function(t,e){var r=this;"function"==typeof e&&(this["on"+t]=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.target=t.target||r,e.call(r,t)})}},{key:"removeEventListener",value:function(t,e){this["on"+t]===e&&(this["on"+t]=null)}}]),r}(fh);s(ep,"UNSEND",void 0),s(ep,"OPENED",void 0),s(ep,"HEADERS_RECEIVED",void 0),s(ep,"LOADING",void 0),s(ep,"DONE",void 0),ep.UNSEND=0,ep.OPENED=1,ep.HEADERS_RECEIVED=2,ep.LOADING=3,ep.DONE=4;var rp="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,np="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram),op=(rp||np)&&!1;op||wf.XMLHttpRequest,op||wf.location;function ip(t){return[t+1&255,t+1>>8&255,t+1>>8>>8&255]}var ap=Ai.filter,up=_i("filter");function sp(t){var e=t.color;return e&&e.length?e:[1,1,1,1]}function cp(t,e,r){return 2===r.length?[r[0],r[1],0]:[r[0],r[1],r[2]]}function fp(t){return t.filter?[1]:[0]}function lp(t,e){return[e]}ar({target:"Array",proto:!0,forced:!up},{filter:function(t){return ap(this,t,arguments.length>1?arguments[1]:void 0)}});var hp=vp,pp=vp;function vp(t,e,r){r=r||2;var n,o,i,a,u,s,c,f=e&&e.length,l=f?e[0]*r:t.length,h=dp(t,0,l,r,!0),p=[];if(!h||h.next===h.prev)return p;if(f&&(h=function(t,e,r,n){var o,i,a,u,s,c=[];for(o=0,i=e.length;o<i;o++)a=e[o]*n,u=o<i-1?e[o+1]*n:t.length,(s=dp(t,a,u,n,!1))===s.next&&(s.steiner=!0),c.push(Tp(s));for(c.sort(Ep),o=0;o<c.length;o++)r=Ap(c[o],r);return r}(t,e,h,r)),t.length>80*r){n=i=t[0],o=a=t[1];for(var v=r;v<l;v+=r)(u=t[v])<n&&(n=u),(s=t[v+1])<o&&(o=s),u>i&&(i=u),s>a&&(a=s);c=0!==(c=Math.max(i-n,a-o))?32767/c:0}return gp(h,p,r,n,o,c,0),p}function dp(t,e,r,n,o){var i,a;if(o===Wp(t,e,r,n)>0)for(i=e;i<r;i+=n)a=Cp(i,t[i],t[i+1],a);else for(i=r-n;i>=e;i-=n)a=Cp(i,t[i],t[i+1],a);return a&&Pp(a,a.next)&&(Dp(a),a=a.next),a}function yp(t,e){if(!t)return t;e||(e=t);var r,n=t;do{if(r=!1,n.steiner||!Pp(n,n.next)&&0!==jp(n.prev,n,n.next))n=n.next;else{if(Dp(n),(n=e=n.prev)===n.next)break;r=!0}}while(r||n!==e);return e}function gp(t,e,r,n,o,i,a){if(t){!a&&i&&function(t,e,r,n){var o=t;do{0===o.z&&(o.z=Sp(o.x,o.y,e,r,n)),o.prevZ=o.prev,o.nextZ=o.next,o=o.next}while(o!==t);o.prevZ.nextZ=null,o.prevZ=null,function(t){var e,r,n,o,i,a,u,s,c=1;do{for(r=t,t=null,i=null,a=0;r;){for(a++,n=r,u=0,e=0;e<c&&(u++,n=n.nextZ);e++);for(s=c;u>0||s>0&&n;)0!==u&&(0===s||!n||r.z<=n.z)?(o=r,r=r.nextZ,u--):(o=n,n=n.nextZ,s--),i?i.nextZ=o:t=o,o.prevZ=i,i=o;r=n}i.nextZ=null,c*=2}while(a>1)}(o)}(t,n,o,i);for(var u,s,c=t;t.prev!==t.next;)if(u=t.prev,s=t.next,i?bp(t,n,o,i):mp(t))e.push(u.i/r|0),e.push(t.i/r|0),e.push(s.i/r|0),Dp(t),t=s.next,c=s.next;else if((t=s)===c){a?1===a?gp(t=xp(yp(t),e,r),e,r,n,o,i,2):2===a&&wp(t,e,r,n,o,i):gp(yp(t),e,r,n,o,i,1);break}}}function mp(t){var e=t.prev,r=t,n=t.next;if(jp(e,r,n)>=0)return!1;for(var o=e.x,i=r.x,a=n.x,u=e.y,s=r.y,c=n.y,f=o<i?o<a?o:a:i<a?i:a,l=u<s?u<c?u:c:s<c?s:c,h=o>i?o>a?o:a:i>a?i:a,p=u>s?u>c?u:c:s>c?s:c,v=n.next;v!==e;){if(v.x>=f&&v.x<=h&&v.y>=l&&v.y<=p&&kp(o,u,i,s,a,c,v.x,v.y)&&jp(v.prev,v,v.next)>=0)return!1;v=v.next}return!0}function bp(t,e,r,n){var o=t.prev,i=t,a=t.next;if(jp(o,i,a)>=0)return!1;for(var u=o.x,s=i.x,c=a.x,f=o.y,l=i.y,h=a.y,p=u<s?u<c?u:c:s<c?s:c,v=f<l?f<h?f:h:l<h?l:h,d=u>s?u>c?u:c:s>c?s:c,y=f>l?f>h?f:h:l>h?l:h,g=Sp(p,v,e,r,n),m=Sp(d,y,e,r,n),b=t.prevZ,x=t.nextZ;b&&b.z>=g&&x&&x.z<=m;){if(b.x>=p&&b.x<=d&&b.y>=v&&b.y<=y&&b!==o&&b!==a&&kp(u,f,s,l,c,h,b.x,b.y)&&jp(b.prev,b,b.next)>=0)return!1;if(b=b.prevZ,x.x>=p&&x.x<=d&&x.y>=v&&x.y<=y&&x!==o&&x!==a&&kp(u,f,s,l,c,h,x.x,x.y)&&jp(x.prev,x,x.next)>=0)return!1;x=x.nextZ}for(;b&&b.z>=g;){if(b.x>=p&&b.x<=d&&b.y>=v&&b.y<=y&&b!==o&&b!==a&&kp(u,f,s,l,c,h,b.x,b.y)&&jp(b.prev,b,b.next)>=0)return!1;b=b.prevZ}for(;x&&x.z<=m;){if(x.x>=p&&x.x<=d&&x.y>=v&&x.y<=y&&x!==o&&x!==a&&kp(u,f,s,l,c,h,x.x,x.y)&&jp(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function xp(t,e,r){var n=t;do{var o=n.prev,i=n.next.next;!Pp(o,i)&&_p(o,n,n.next,i)&&Rp(o,i)&&Rp(i,o)&&(e.push(o.i/r|0),e.push(n.i/r|0),e.push(i.i/r|0),Dp(n),Dp(n.next),n=t=i),n=n.next}while(n!==t);return yp(n)}function wp(t,e,r,n,o,i){var a=t;do{for(var u=a.next.next;u!==a.prev;){if(a.i!==u.i&&Ip(a,u)){var s=Np(a,u);return a=yp(a,a.next),s=yp(s,s.next),gp(a,e,r,n,o,i,0),void gp(s,e,r,n,o,i,0)}u=u.next}a=a.next}while(a!==t)}function Ep(t,e){return t.x-e.x}function Ap(t,e){var r=function(t,e){var r,n=e,o=t.x,i=t.y,a=-1/0;do{if(i<=n.y&&i>=n.next.y&&n.next.y!==n.y){var u=n.x+(i-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(u<=o&&u>a&&(a=u,r=n.x<n.next.x?n:n.next,u===o))return r}n=n.next}while(n!==e);if(!r)return null;var s,c=r,f=r.x,l=r.y,h=1/0;n=r;do{o>=n.x&&n.x>=f&&o!==n.x&&kp(i<l?o:a,i,f,l,i<l?a:o,i,n.x,n.y)&&(s=Math.abs(i-n.y)/(o-n.x),Rp(n,t)&&(s<h||s===h&&(n.x>r.x||n.x===r.x&&Op(r,n)))&&(r=n,h=s)),n=n.next}while(n!==c);return r}(t,e);if(!r)return e;var n=Np(r,t);return yp(n,n.next),yp(r,r.next)}function Op(t,e){return jp(t.prev,t,e.prev)<0&&jp(e.next,t,t.next)<0}function Sp(t,e,r,n,o){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*o|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*o|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Tp(t){var e=t,r=t;do{(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next}while(e!==t);return r}function kp(t,e,r,n,o,i,a,u){return(o-a)*(e-u)>=(t-a)*(i-u)&&(t-a)*(n-u)>=(r-a)*(e-u)&&(r-a)*(i-u)>=(o-a)*(n-u)}function Ip(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&_p(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}(t,e)&&(Rp(t,e)&&Rp(e,t)&&function(t,e){var r=t,n=!1,o=(t.x+e.x)/2,i=(t.y+e.y)/2;do{r.y>i!=r.next.y>i&&r.next.y!==r.y&&o<(r.next.x-r.x)*(i-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==t);return n}(t,e)&&(jp(t.prev,t,e.prev)||jp(t,e.prev,e))||Pp(t,e)&&jp(t.prev,t,t.next)>0&&jp(e.prev,e,e.next)>0)}function jp(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function Pp(t,e){return t.x===e.x&&t.y===e.y}function _p(t,e,r,n){var o=Lp(jp(t,e,r)),i=Lp(jp(t,e,n)),a=Lp(jp(r,n,t)),u=Lp(jp(r,n,e));return o!==i&&a!==u||(!(0!==o||!Mp(t,r,e))||(!(0!==i||!Mp(t,n,e))||(!(0!==a||!Mp(r,t,n))||!(0!==u||!Mp(r,e,n)))))}function Mp(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function Lp(t){return t>0?1:t<0?-1:0}function Rp(t,e){return jp(t.prev,t,t.next)<0?jp(t,e,t.next)>=0&&jp(t,t.prev,e)>=0:jp(t,e,t.prev)<0||jp(t,t.next,e)<0}function Np(t,e){var r=new Fp(t.i,t.x,t.y),n=new Fp(e.i,e.x,e.y),o=t.next,i=e.prev;return t.next=e,e.prev=t,r.next=o,o.prev=r,n.next=r,r.prev=n,i.next=n,n.prev=i,n}function Cp(t,e,r,n){var o=new Fp(t,e,r);return n?(o.next=n.next,o.prev=n,n.next.prev=o,n.next=o):(o.prev=o,o.next=o),o}function Dp(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Fp(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Wp(t,e,r,n){for(var o=0,i=e,a=r-n;i<r;i+=n)o+=(t[a]-t[i])*(t[i+1]+t[a+1]),a=i;return o}vp.deviation=function(t,e,r,n){var o=e&&e.length,i=o?e[0]*r:t.length,a=Math.abs(Wp(t,0,i,r));if(o)for(var u=0,s=e.length;u<s;u++){var c=e[u]*r,f=u<s-1?e[u+1]*r:t.length;a-=Math.abs(Wp(t,c,f,r))}var l=0;for(u=0;u<n.length;u+=3){var h=n[u]*r,p=n[u+1]*r,v=n[u+2]*r;l+=Math.abs((t[h]-t[v])*(t[p+1]-t[h+1])-(t[h]-t[p])*(t[v+1]-t[h+1]))}return 0===a&&0===l?0:Math.abs((l-a)/a)},vp.flatten=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},n=0,o=0;o<t.length;o++){for(var i=0;i<t[o].length;i++)for(var a=0;a<e;a++)r.vertices.push(t[o][i][a]);o>0&&(n+=t[o-1].length,r.holes.push(n))}return r},hp.default=pp;var zp=S,Bp=N(1..valueOf),Up="\\t\\n\\v\\f\\r                　\\u2028\\u2029\\ufeff",Gp=N("".replace),Vp=RegExp("^["+Up+"]+"),Hp=RegExp("(^|[^"+Up+"])["+Up+"]+$"),qp=function(t){return function(e){var r=Xc(F(e));return 1&t&&(r=Gp(r,Vp,"")),2&t&&(r=Gp(r,Hp,"$1")),r}},Zp={start:qp(1),end:qp(2),trim:qp(3)},Yp=Ze.f,$p=je.f,Kp=Gt.f,Qp=Zp.trim,Xp=S.Number,Jp=(zp.Number,Xp.prototype),tv=S.TypeError,ev=N("".slice),rv=N("".charCodeAt),nv=function(t){var e=Ft(t,"number");return"bigint"==typeof e?e:ov(e)},ov=function(t){var e,r,n,o,i,a,u,s,c=Ft(t,"number");if(jt(c))throw tv("Cannot convert a Symbol value to a number");if("string"==typeof c&&c.length>2)if(c=Qp(c),43===(e=rv(c,0))||45===e){if(88===(r=rv(c,2))||120===r)return NaN}else if(48===e){switch(rv(c,1)){case 66:case 98:n=2,o=49;break;case 79:case 111:n=8,o=55;break;default:return+c}for(a=(i=ev(c,2)).length,u=0;u<a;u++)if((s=rv(i,u))<48||s>o)return NaN;return parseInt(i,n)}return+c},iv=or("Number",!Xp(" 0o1")||!Xp("0b1")||Xp("+0x1")),av=function(t){return kt(Jp,t)&&P((function(){Bp(t)}))},uv=function(t){var e=arguments.length<1?0:Xp(nv(t));return av(this)?os(Object(e),this,uv):e};uv.prototype=Jp,iv&&(Jp.constructor=uv),ar({global:!0,constructor:!0,wrap:!0,forced:iv},{Number:uv});iv&&function(t,e){for(var r,n=ht?Yp(e):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),o=0;n.length>o;o++)U(e,r=n[o])&&!U(t,r)&&Kp(t,r,$p(e,r))}(zp.Number,Xp);var sv=RangeError,cv=RangeError,fv=String,lv=Math.floor,hv=N((function(t){var e=Xc(F(this)),r="",n=Le(t);if(n<0||n==1/0)throw sv("Wrong number of repetitions");for(;n>0;(n>>>=1)&&(e+=e))1&n&&(r+=e);return r})),pv=N("".slice),vv=N(1..toFixed),dv=function(t,e,r){return 0===e?r:e%2==1?dv(t,e-1,r*t):dv(t*t,e/2,r)},yv=function(t,e,r){for(var n=-1,o=r;++n<6;)o+=e*t[n],t[n]=o%1e7,o=lv(o/1e7)},gv=function(t,e){for(var r=6,n=0;--r>=0;)n+=t[r],t[r]=lv(n/e),n=n%e*1e7},mv=function(t){for(var e=6,r="";--e>=0;)if(""!==r||0===e||0!==t[e]){var n=fv(t[e]);r=""===r?n:r+hv("0",7-n.length)+n}return r},bv=P((function(){return"0.000"!==vv(8e-5,3)||"1"!==vv(.9,0)||"1.25"!==vv(1.255,2)||"1000000000000000128"!==vv(0xde0b6b3a7640080,0)}))||!P((function(){vv({})}));function xv(t){return"number"==typeof t}function wv(t){var e=Math.max(Math.min(85.0511287798,t[1]),-85.0511287798),r=Math.PI/180,n=t[0]*r,o=e*r;o=Math.log(Math.tan(Math.PI/4+o/2));return n=(256<<20)*(.5/Math.PI*n+.5),o=(256<<20)*(-.5/Math.PI*o+(r=.5)),[Math.floor(n),Math.floor(o)]}ar({target:"Number",proto:!0,forced:bv},{toFixed:function(t){var e,r,n,o,i=Bp(this),a=Le(t),u=[0,0,0,0,0,0],s="",c="0";if(a<0||a>20)throw cv("Incorrect fraction digits");if(i!=i)return"NaN";if(i<=-1e21||i>=1e21)return fv(i);if(i<0&&(s="-",i=-i),i>1e-21)if(r=(e=function(t){for(var e=0,r=t;r>=4096;)e+=12,r/=4096;for(;r>=2;)e+=1,r/=2;return e}(i*dv(2,69,1))-69)<0?i*dv(2,-e,1):i/dv(2,e,1),r*=4503599627370496,(e=52-e)>0){for(yv(u,0,r),n=a;n>=7;)yv(u,1e7,0),n-=7;for(yv(u,dv(10,n,1),0),n=e-1;n>=23;)gv(u,1<<23),n-=23;gv(u,1<<n),yv(u,1,1),gv(u,2),c=mv(u)}else yv(u,0,r),yv(u,1<<-e,0),c=mv(u)+hv("0",a);return c=a>0?s+((o=c.length)<=a?"0."+hv("0",a-o)+c:pv(c,0,o-a)+"."+pv(c,o-a)):s+c}});var Ev,Av=/"/g,Ov=N("".replace);ar({target:"String",proto:!0,forced:(Ev="sub",P((function(){var t=""[Ev]('"');return t!==t.toLowerCase()||t.split('"').length>3})))},{sub:function(){return t="sub",e="",r="",n=Xc(F(this)),o="<"+t,""!==e&&(o+=" "+e+'="'+Ov(Xc(r),Av,"&quot;")+'"'),o+">"+n+"</"+t+">";var t,e,r,n,o}});var Sv=RegExp.prototype,Tv=Zt.PROPER,kv=RegExp.prototype.toString,Iv=P((function(){return"/a/b"!=kv.call({source:"a",flags:"b"})})),jv=Tv&&"toString"!=kv.name;(Iv||jv)&&he(RegExp.prototype,"toString",(function(){var t=Et(this);return"/"+Xc(t.source)+"/"+Xc(function(t){var e=t.flags;return void 0!==e||"flags"in Sv||U(t,"flags")||!kt(Sv,t)?e:Ot(Jc,t)}(t))}),{unsafe:!0});var Pv="undefined"!=typeof Float32Array?Float32Array:Array;function _v(){var t=new Pv(2);return Pv!=Float32Array&&(t[0]=0,t[1]=0),t}function Mv(t,e){var r=new Pv(2);return r[0]=t,r[1]=e,r}function Lv(t,e){return t[0]=e[0],t[1]=e[1],t}function Rv(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}function Nv(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function Cv(t,e){var r=e[0],n=e[1],o=r*r+n*n;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t}function Dv(t,e){return t[0]*e[0]+t[1]*e[1]}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var Fv,Wv=Nv,zv=(Fv=_v(),_v()),Bv=(_v(),_v()),Uv=_v(),Gv=_v();function Vv(t,e,r,n,o){return Rv(t,r,n),Cv(t,t),[o/Dv(e=Mv(-t[1],t[0]),Mv(-r[1],r[0])),e]}function Hv(t,e){return function(t,e,r){return t[0]=e,t[1]=r,t}(t,-e[1],e[0])}function qv(t,e,r){return Wv(t,e,r),Cv(t,t),t}function Zv(t,e){return t[0]===e[0]&&t[1]===e[1]}var Yv=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,t),s(this,"complex",void 0),s(this,"join",void 0),s(this,"cap",void 0),s(this,"miterLimit",void 0),s(this,"thickness",void 0),s(this,"normal",void 0),s(this,"lastFlip",-1),s(this,"miter",Mv(0,0)),s(this,"started",!1),s(this,"dash",!1),s(this,"totalDistance",0),s(this,"currentIndex",0),this.join=e.join||"miter",this.cap=e.cap||"butt",this.miterLimit=e.miterLimit||10,this.thickness=e.thickness||1,this.dash=e.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return u(t,[{key:"extrude_gaode2",value:function(t,e){var r=this.complex;if(t.length<=1)return r;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=t.length,o=r.startIndex,i=1;i<n;i++){var a,u,s,c=t[i-1];c.push(null!==(a=e[i-1][2])&&void 0!==a?a:0);var f=e[i-1],l=t[i];l.push(null!==(u=e[i][2])&&void 0!==u?u:0);var h=e[i],p=i<t.length-1?[].concat(y(t[i+1]),[null!==(s=e[i+1][2])&&void 0!==s?s:0]):null,v=i<e.length-1?e[i+1]:null;o+=this.segment_gaode2(r,o,c,l,p,f,h,v)}if(this.dash)for(var d=0;d<r.positions.length/6;d++)r.positions[6*d+5]=this.totalDistance;return r.startIndex=r.positions.length/6,r}},{key:"simpleExtrude_gaode2",value:function(t,e){var r=this.complex;if(t.length<=1)return r;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=t.length,o=r.startIndex,i=1;i<n;i++){var a,u,s,c=t[i-1];c.push(null!==(a=e[i-1][2])&&void 0!==a?a:0);var f=e[i-1],l=t[i];l.push(null!==(u=e[i][2])&&void 0!==u?u:0);var h=e[i],p=i<t.length-1?[].concat(y(t[i+1]),[null!==(s=e[i+1][2])&&void 0!==s?s:0]):null,v=i<e.length-1?e[i+1]:null;o+=this.simpleSegment(r,o,c,l,p,f,h,v)}if(this.dash)for(var d=0;d<r.positions.length/6;d++)r.positions[6*d+5]=this.totalDistance;return r.startIndex=r.positions.length/6,r}},{key:"extrude",value:function(t){var e=this.complex;if(t.length<=1)return e;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=t.length,n=e.startIndex,o=1;o<r;o++){var i=t[o-1],a=t[o],u=o<t.length-1?t[o+1]:null;n+=this.segment(e,n,i,a,u)}if(this.dash)for(var s=0;s<e.positions.length/6;s++)e.positions[6*s+5]=this.totalDistance;return e.startIndex=e.positions.length/6,e}},{key:"simpleExtrude",value:function(t){var e=this.complex;if(t.length<=1)return e;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=t.length,n=e.startIndex,o=1;o<r;o++){var i=t[o-1],a=t[o],u=o<t.length-1?t[o+1]:null;n+=this.simpleSegment(e,n,i,a,u)}if(this.dash)for(var s=0;s<e.positions.length/6;s++)e.positions[6*s+5]=this.totalDistance;return e.startIndex=e.positions.length/6,e}},{key:"segment_gaode2",value:function(t,e,r,n,o,i,a,u){var s=0,c=t.indices,f=t.positions,l=t.normals,h="square"===this.cap,p="bevel"===this.join,v=wv([a[0],a[1]]),g=wv([i[0],i[1]]);qv(Bv,n,r);var m=0;if(this.dash&&(m=this.lineSegmentDistance(v,g),this.totalDistance+=m),this.normal||(this.normal=_v(),Hv(this.normal,Bv)),!this.started)if(this.started=!0,h){var b=_v(),x=_v();Rv(b,this.normal,Bv),Rv(x,this.normal,Bv),l.push(x[0],x[1],0),l.push(b[0],b[1],0),f.push(r[0],r[1],0|r[2],this.totalDistance-m,-this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),f.push(r[0],r[1],0|r[2],this.totalDistance-m,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(f,l,r,this.normal,this.thickness,this.totalDistance-m);if(c.push(e+0,e+1,e+2),o){Zv(n,o)&&Rv(o,n,Cv(o,Nv(o,n,r))),qv(Uv,o,n);var w=d(Vv(Gv,_v(),Bv,Uv,this.thickness),2),E=w[0],A=w[1],O=Dv(Gv,this.normal)<0?-1:1,S=p;if(!S&&"miter"===this.join)E>this.miterLimit&&(S=!0);S?(l.push(this.normal[0],this.normal[1],0),l.push(A[0],A[1],0),f.push(n[0],n[1],0|n[2],this.totalDistance,-this.thickness*O,0|n[2]),this.complex.indexes.push(this.currentIndex),f.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness*O,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,c.push.apply(c,y(this.lastFlip!==-O?[e,e+2,e+3]:[e+2,e+1,e+3])),c.push(e+2,e+3,e+4),Hv(zv,Uv),Lv(this.normal,zv),l.push(this.normal[0],this.normal[1],0),f.push(n[0],n[1],0|n[2],this.totalDistance,-this.thickness*O,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,s+=3):(this.extrusions(f,l,n,A,E,this.totalDistance),c.push.apply(c,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),O=-1,Lv(this.normal,A),s+=2),this.lastFlip=O}else{if(Hv(this.normal,Bv),h){var T=_v(),k=_v();Wv(k,Bv,this.normal),Rv(T,Bv,this.normal),l.push(k[0],k[1],0),l.push(T[0],T[1],0),f.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),f.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(f,l,n,this.normal,this.thickness,this.totalDistance);c.push.apply(c,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),s+=2}return s}},{key:"simpleSegment",value:function(t,e,r,n,o){var i=0,a=t.indices,u=t.positions,s=t.normals,c=wv([n[0],n[1]]),f=wv([r[0],r[1]]);qv(Bv,c,f);var l=0;if(this.dash&&(l=this.lineSegmentDistance(c,f),this.totalDistance+=l),this.normal||(this.normal=_v(),Hv(this.normal,Bv)),this.started||(this.started=!0,this.extrusions(u,s,r,this.normal,this.thickness,this.totalDistance-l)),a.push(e+0,e+1,e+2),o){var h=wv([o[0],o[1]]);Zv(c,h)&&Rv(h,c,Cv(h,Nv(h,c,f))),qv(Uv,h,c);var p=d(Vv(Gv,_v(),Bv,Uv,this.thickness),2),v=p[0],g=p[1];Dv(Gv,this.normal);this.extrusions(u,s,n,g,v,this.totalDistance),a.push.apply(a,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),-1,Lv(this.normal,g),i+=2,this.lastFlip=-1}else Hv(this.normal,Bv),this.extrusions(u,s,n,this.normal,this.thickness,this.totalDistance),a.push.apply(a,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),i+=2;return i}},{key:"segment",value:function(t,e,r,n,o){var i=0,a=t.indices,u=t.positions,s=t.normals,c="square"===this.cap,f="bevel"===this.join,l=wv([n[0],n[1]]),h=wv([r[0],r[1]]);qv(Bv,l,h);var p=0;if(this.dash&&(p=this.lineSegmentDistance(l,h),this.totalDistance+=p),this.normal||(this.normal=_v(),Hv(this.normal,Bv)),!this.started)if(this.started=!0,c){var v=_v(),g=_v();Rv(v,this.normal,Bv),Rv(g,this.normal,Bv),s.push(g[0],g[1],0),s.push(v[0],v[1],0),u.push(r[0],r[1],0|r[2],this.totalDistance-p,-this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),u.push(r[0],r[1],0|r[2],this.totalDistance-p,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(u,s,r,this.normal,this.thickness,this.totalDistance-p);if(a.push(e+0,e+1,e+2),o){var m=wv([o[0],o[1]]);Zv(l,m)&&Rv(m,l,Cv(m,Nv(m,l,h))),qv(Uv,m,l);var b=d(Vv(Gv,_v(),Bv,Uv,this.thickness),2),x=b[0],w=b[1],E=Dv(Gv,this.normal)<0?-1:1,A=f;if(!A&&"miter"===this.join)x>this.miterLimit&&(A=!0);A?(s.push(this.normal[0],this.normal[1],0),s.push(w[0],w[1],0),u.push(n[0],n[1],0|n[2],this.totalDistance,-this.thickness*E,0|n[2]),this.complex.indexes.push(this.currentIndex),u.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness*E,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,a.push.apply(a,y(this.lastFlip!==-E?[e,e+2,e+3]:[e+2,e+1,e+3])),a.push(e+2,e+3,e+4),Hv(zv,Uv),Lv(this.normal,zv),s.push(this.normal[0],this.normal[1],0),u.push(n[0],n[1],0|n[2],this.totalDistance,-this.thickness*E,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,i+=3):(this.extrusions(u,s,n,w,x,this.totalDistance),a.push.apply(a,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),E=-1,Lv(this.normal,w),i+=2),this.lastFlip=E}else{if(Hv(this.normal,Bv),c){var O=_v(),S=_v();Wv(S,Bv,this.normal),Rv(O,Bv,this.normal),s.push(S[0],S[1],0),s.push(O[0],O[1],0),u.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),u.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(u,s,n,this.normal,this.thickness,this.totalDistance);a.push.apply(a,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),i+=2}return i}},{key:"extrusions",value:function(t,e,r,n,o,i){e.push(n[0],n[1],0),e.push(n[0],n[1],0),t.push(r[0],r[1],0|r[2],i,-o,0|r[2]),this.complex.indexes.push(this.currentIndex),t.push(r[0],r[1],0|r[2],i,o,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(t,e){var r=e[0]-t[0],n=e[1]-t[1];return Math.sqrt(r*r+n*n)}}]),t}();function $v(t){var e=t.coordinates,r=t.originCoordinates,n=t.version,o=new Yv({dash:!0,join:"bevel"});if("GAODE2.x"===n){var i=e;Array.isArray(i[0][0])||(i=[e]);var a=r;Array.isArray(a[0][0])||(a=[r]);for(var u=0;u<i.length;u++){var s=i[u],c=a[u];o.extrude_gaode2(s,c)}}else{var f=e;f[0]&&!Array.isArray(f[0][0])&&(f=[e]),f.forEach((function(t){o.extrude(t)}))}var l=o.complex;return{vertices:l.positions,indices:l.indices,normals:l.normals,indexes:l.indexes,size:6}}function Kv(t){var e=function(t){if(xv(t[0]))return t;if(xv(t[0][0]))throw new Error("当前数据不支持标注");if(xv(t[0][0][0])){var e=0,r=0,n=0;return t.forEach((function(t){t.forEach((function(t){e+=t[0],r+=t[1],n++}))})),[e/n,r/n,0]}throw new Error("当前数据不支持标注")}(t.coordinates);return{vertices:[].concat(y(e),y(e),y(e),y(e)),indices:[0,1,2,2,3,0],size:e.length}}function Qv(t){var e=t.coordinates,r=hp.flatten(e),n=r.vertices,o=r.dimensions,i=r.holes;return{indices:hp(n,i,o),vertices:n,size:o}}var Xv=function(){var t=o(r().mark((function t(e){var n,o,i,a,u,s,c,f,l;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.descriptors,o=e.features,i=e.enablePicking,a=e.iconMap,u={a_Color:sp,a_Position:cp,filter:fp,a_vertexId:lp,a_PickingColor:function(t){var e=t.id;return i?ip(e):[0,0,0]},a_DistanceAndIndex:function(t,e,r,n,o,i){return void 0===i?[r[3],10]:[r[3],i]},a_Total_Distance:function(t,e,r){return[r[5]]},a_Size:function(t){var e=t.size,r=void 0===e?1:e;return Array.isArray(r)?[r[0],r[1]]:[r,0]},a_Normal:function(t,e,r,n,o){return o},a_Miter:function(t,e,r){return[r[4]]},a_iconMapUV:function(t){var e=t.texture,r=a[e]||{x:0,y:0};return[r.x,r.y]}},s={sizePerElement:0,elements:[]},c=0,f=[],l=3,o.forEach((function(t,e){var r=$v(t),o=r.indices,i=r.vertices,a=r.normals,h=r.size,p=r.indexes;o.forEach((function(t){f.push(t+c)})),l=h;var v=i.length/h;s.sizePerElement=l,s.elements.push({featureIdx:e,vertices:i,normals:a,offset:c}),c+=v;for(var d=function(r){var o=(null==a?void 0:a.slice(3*r,3*r+3))||[],s=i.slice(r*h,r*h+h),c=0;p&&void 0!==p[r]&&(c=p[r]),n.forEach((function(n){var i;n&&u[n.name]&&(i=n.buffer.data).push.apply(i,y(u[n.name](t,e,s,r,o,c)))}))},g=0;g<v;g++)d(g)})),t.abrupt("return",{descriptors:n,featureLayout:s,indices:f});case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),Jv={pointFill:function(){var t=o(r().mark((function t(e){var n,o,i,a,u,s,c,f,l;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.descriptors,o=e.features,i=e.enablePicking,a=e.shape2d,u={a_Color:sp,a_Position:cp,filter:fp,a_vertexId:lp,a_PickingColor:function(t){var e=t.id;return i?ip(e):[0,0,0]},a_Shape:function(t){var e=t.shape,r=void 0===e?2:e;return[a.indexOf(r)]},a_Extrude:function(t,e,r,n){var o=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],i=n%4*3;return[o[i],o[i+1],o[i+2]]},a_Size:function(t){var e=t.size,r=void 0===e?5:e;return Array.isArray(r)?[r[0]]:[r]}},s={sizePerElement:0,elements:[]},c=0,f=[],l=3,o.forEach((function(t,e){var r=Kv(t),o=r.indices,i=r.vertices,a=r.normals,h=r.size;o.forEach((function(t){f.push(t+c)})),l=h;var p=i.length/h;s.sizePerElement=l,s.elements.push({featureIdx:e,vertices:i,normals:a,offset:c}),c+=p;for(var v=function(r){var o=[],a=i.slice(r*h,r*h+h);n.forEach((function(n){var i;n&&u[n.name]&&(i=n.buffer.data).push.apply(i,y(u[n.name](t,e,a,r,o,0)))}))},d=0;d<p;d++)v(d)})),t.abrupt("return",{descriptors:n,featureLayout:s,indices:f});case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),line:Xv,polygonFill:function(){var t=o(r().mark((function t(e){var n,o,i,a,u,s,c,f;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.descriptors,o=e.features,i=e.enablePicking,a={a_Color:sp,a_Position:cp,filter:fp,a_vertexId:lp,a_PickingColor:function(t){var e=t.id;return i?ip(e):[0,0,0]}},u={sizePerElement:0,elements:[]},s=0,c=[],f=3,o.forEach((function(t,e){var r=Qv(t),o=r.indices,i=r.vertices,l=r.normals,h=r.size;o.forEach((function(t){c.push(t+s)})),f=h;var p=i.length/h;u.sizePerElement=f,u.elements.push({featureIdx:e,vertices:i,normals:l,offset:s}),s+=p;for(var v=function(r){var o=[],u=i.slice(r*h,r*h+h);n.forEach((function(n){var i;n&&a[n.name]&&(i=n.buffer.data).push.apply(i,y(a[n.name](t,e,u,r,o,0)))}))},d=0;d<p;d++)v(d)})),t.abrupt("return",{descriptors:n,featureLayout:u,indices:c});case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},td=function(t){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?e(Object(n),!0).forEach((function(e){s(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):e(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},Jv);function ed(t){return rd.apply(this,arguments)}function rd(){return(rd=o(r().mark((function t(e){var n,o;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.workerType,o=e.data,!td[n]){t.next=3;break}return t.abrupt("return",td[n](o));case 3:return t.abrupt("return",Promise.reject(new Error('Worker with type "'.concat(n,'" non-existent.'))));case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return li(ed),t.WorkerSourceMap=Jv,t.createWorker=li,t.worker=ed,t}({});
`,fB="l7-worker";function hB(e){lB(fB,e)}hB(cB);function _R(e,t){var r=t.extent,n=r===void 0?[121.168,30.2828,121.384,30.4219]:r,i=new Promise(function(a){e instanceof HTMLImageElement||RF(e)?a([e]):pB(e,function(u){a(u)})}),o={originData:e,images:i,_id:1,dataArray:[{_id:0,coordinates:[[n[0],n[1]],[n[2],n[3]]]}]};return o}function pB(e,t){var r=e,n=[];if(typeof r=="string")Q2({url:r},function(a,u){u&&(n.push(u),t(n))});else{var i=r.length,o=0;r.forEach(function(a){Q2({url:a},function(u,c){o++,c&&n.push(c),o===i&&t(n)})})}return _R}var dB=U0;function U0(e,t){this.x=e,this.y=t}U0.prototype={clone:function(){return new U0(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,r=e.y-this.y;return t*t+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[0]*this.x+e[1]*this.y,r=e[2]*this.x+e[3]*this.y;return this.x=t,this.y=r,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),r=Math.sin(e),n=t*this.x-r*this.y,i=r*this.x+t*this.y;return this.x=n,this.y=i,this},_rotateAround:function(e,t){var r=Math.cos(e),n=Math.sin(e),i=t.x+r*(this.x-t.x)-n*(this.y-t.y),o=t.y+n*(this.x-t.x)+r*(this.y-t.y);return this.x=i,this.y=o,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}};U0.convert=function(e){return e instanceof U0?e:Array.isArray(e)?new U0(e[0],e[1]):e};var vB=dB,mB=Y0;function Y0(e,t,r,n,i){this.properties={},this.extent=r,this.type=0,this._pbf=e,this._geometry=-1,this._keys=n,this._values=i,e.readFields(gB,this,t)}function gB(e,t,r){e==1?t.id=r.readVarint():e==2?yB(r,t):e==3?t.type=r.readVarint():e==4&&(t._geometry=r.pos)}function yB(e,t){for(var r=e.readVarint()+e.pos;e.pos<r;){var n=t._keys[e.readVarint()],i=t._values[e.readVarint()];t.properties[n]=i}}Y0.types=["Unknown","Point","LineString","Polygon"];Y0.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,r=1,n=0,i=0,o=0,a=[],u;e.pos<t;){if(n<=0){var c=e.readVarint();r=c&7,n=c>>3}if(n--,r===1||r===2)i+=e.readSVarint(),o+=e.readSVarint(),r===1&&(u&&a.push(u),u=[]),u.push(new vB(i,o));else if(r===7)u&&u.push(u[0].clone());else throw new Error("unknown command "+r)}return u&&a.push(u),a};Y0.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,r=1,n=0,i=0,o=0,a=1/0,u=-1/0,c=1/0,h=-1/0;e.pos<t;){if(n<=0){var y=e.readVarint();r=y&7,n=y>>3}if(n--,r===1||r===2)i+=e.readSVarint(),o+=e.readSVarint(),i<a&&(a=i),i>u&&(u=i),o<c&&(c=o),o>h&&(h=o);else if(r!==7)throw new Error("unknown command "+r)}return[a,c,u,h]};Y0.prototype.toGeoJSON=function(e,t,r){var n=this.extent*Math.pow(2,r),i=this.extent*e,o=this.extent*t,a=this.loadGeometry(),u=Y0.types[this.type],c,h;function y(T){for(var I=0;I<T.length;I++){var k=T[I],D=180-(k.y+o)*360/n;T[I]=[(k.x+i)*360/n-180,360/Math.PI*Math.atan(Math.exp(D*Math.PI/180))-90]}}switch(this.type){case 1:var x=[];for(c=0;c<a.length;c++)x[c]=a[c][0];a=x,y(a);break;case 2:for(c=0;c<a.length;c++)y(a[c]);break;case 3:for(a=_B(a),c=0;c<a.length;c++)for(h=0;h<a[c].length;h++)y(a[c][h]);break}a.length===1?a=a[0]:u="Multi"+u;var E={type:"Feature",geometry:{type:u,coordinates:a},properties:this.properties};return"id"in this&&(E.id=this.id),E};function _B(e){var t=e.length;if(t<=1)return[e];for(var r=[],n,i,o=0;o<t;o++){var a=xB(e[o]);a!==0&&(i===void 0&&(i=a<0),i===a<0?(n&&r.push(n),n=[e[o]]):n.push(e[o]))}return n&&r.push(n),r}function xB(e){for(var t=0,r=0,n=e.length,i=n-1,o,a;r<n;i=r++)o=e[r],a=e[i],t+=(a.x-o.x)*(o.y+a.y);return t}var bB=mB,wB=xR;function xR(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(EB,this,t),this.length=this._features.length}function EB(e,t,r){e===15?t.version=r.readVarint():e===1?t.name=r.readString():e===5?t.extent=r.readVarint():e===2?t._features.push(r.pos):e===3?t._keys.push(r.readString()):e===4&&t._values.push(SB(r))}function SB(e){for(var t=null,r=e.readVarint()+e.pos;e.pos<r;){var n=e.readVarint()>>3;t=n===1?e.readString():n===2?e.readFloat():n===3?e.readDouble():n===4?e.readVarint64():n===5?e.readVarint():n===6?e.readSVarint():n===7?e.readBoolean():null}return t}xR.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new bB(this._pbf,t,this.extent,this._keys,this._values)};var AB=wB,TB=CB;function CB(e,t){this.layers=e.readFields(MB,{},t)}function MB(e,t,r){if(e===3){var n=new AB(r,r.readVarint()+r.pos);n.length&&(t[n.name]=n)}}var PB=TB,eS={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */eS.read=function(e,t,r,n,i){var o,a,u=i*8-n-1,c=(1<<u)-1,h=c>>1,y=-7,x=r?i-1:0,E=r?-1:1,T=e[t+x];for(x+=E,o=T&(1<<-y)-1,T>>=-y,y+=u;y>0;o=o*256+e[t+x],x+=E,y-=8);for(a=o&(1<<-y)-1,o>>=-y,y+=n;y>0;a=a*256+e[t+x],x+=E,y-=8);if(o===0)o=1-h;else{if(o===c)return a?NaN:(T?-1:1)*(1/0);a=a+Math.pow(2,n),o=o-h}return(T?-1:1)*a*Math.pow(2,o-n)};eS.write=function(e,t,r,n,i,o){var a,u,c,h=o*8-i-1,y=(1<<h)-1,x=y>>1,E=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,T=n?0:o-1,I=n?1:-1,k=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(u=isNaN(t)?1:0,a=y):(a=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-a))<1&&(a--,c*=2),a+x>=1?t+=E/c:t+=E*Math.pow(2,1-x),t*c>=2&&(a++,c/=2),a+x>=y?(u=0,a=y):a+x>=1?(u=(t*c-1)*Math.pow(2,i),a=a+x):(u=t*Math.pow(2,x-1)*Math.pow(2,i),a=0));i>=8;e[r+T]=u&255,T+=I,u/=256,i-=8);for(a=a<<i|u,h+=i;h>0;e[r+T]=a&255,T+=I,a/=256,h-=8);e[r+T-I]|=k*128};var IB=no,r1=eS;function no(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}no.Varint=0;no.Fixed64=1;no.Bytes=2;no.Fixed32=5;var fw=65536*65536,$A=1/fw,RB=12,bR=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");no.prototype={destroy:function(){this.buf=null},readFields:function(e,t,r){for(r=r||this.length;this.pos<r;){var n=this.readVarint(),i=n>>3,o=this.pos;this.type=n&7,e(i,t,this),this.pos===o&&this.skip(n)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=n1(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=HA(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=n1(this.buf,this.pos)+n1(this.buf,this.pos+4)*fw;return this.pos+=8,e},readSFixed64:function(){var e=n1(this.buf,this.pos)+HA(this.buf,this.pos+4)*fw;return this.pos+=8,e},readFloat:function(){var e=r1.read(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=r1.read(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t=this.buf,r,n;return n=t[this.pos++],r=n&127,n<128||(n=t[this.pos++],r|=(n&127)<<7,n<128)||(n=t[this.pos++],r|=(n&127)<<14,n<128)||(n=t[this.pos++],r|=(n&127)<<21,n<128)?r:(n=t[this.pos],r|=(n&15)<<28,LB(r,e,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2===1?(e+1)/-2:e/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=RB&&bR?WB(this.buf,t,e):HB(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==no.Bytes)return e.push(this.readVarint(t));var r=bd(this);for(e=e||[];this.pos<r;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==no.Bytes)return e.push(this.readSVarint());var t=bd(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==no.Bytes)return e.push(this.readBoolean());var t=bd(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==no.Bytes)return e.push(this.readFloat());var t=bd(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==no.Bytes)return e.push(this.readDouble());var t=bd(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==no.Bytes)return e.push(this.readFixed32());var t=bd(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==no.Bytes)return e.push(this.readSFixed32());var t=bd(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==no.Bytes)return e.push(this.readFixed64());var t=bd(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==no.Bytes)return e.push(this.readSFixed64());var t=bd(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=e&7;if(t===no.Varint)for(;this.buf[this.pos++]>127;);else if(t===no.Bytes)this.pos=this.readVarint()+this.pos;else if(t===no.Fixed32)this.pos+=4;else if(t===no.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+t)},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var r=new Uint8Array(t);r.set(this.buf),this.buf=r,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),_0(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),_0(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),_0(this.buf,e&-1,this.pos),_0(this.buf,Math.floor(e*$A),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),_0(this.buf,e&-1,this.pos),_0(this.buf,Math.floor(e*$A),this.pos+4),this.pos+=8},writeVarint:function(e){if(e=+e||0,e>268435455||e<0){kB(e,this);return}this.realloc(4),this.buf[this.pos++]=e&127|(e>127?128:0),!(e<=127)&&(this.buf[this.pos++]=(e>>>=7)&127|(e>127?128:0),!(e<=127)&&(this.buf[this.pos++]=(e>>>=7)&127|(e>127?128:0),!(e<=127)&&(this.buf[this.pos++]=e>>>7&127)))},writeSVarint:function(e){this.writeVarint(e<0?-e*2-1:e*2)},writeBoolean:function(e){this.writeVarint(!!e)},writeString:function(e){e=String(e),this.realloc(e.length*4),this.pos++;var t=this.pos;this.pos=XB(this.buf,e,this.pos);var r=this.pos-t;r>=128&&GA(t,r,this),this.pos=t-1,this.writeVarint(r),this.pos+=r},writeFloat:function(e){this.realloc(4),r1.write(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),r1.write(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var r=0;r<t;r++)this.buf[this.pos++]=e[r]},writeRawMessage:function(e,t){this.pos++;var r=this.pos;e(t,this);var n=this.pos-r;n>=128&&GA(r,n,this),this.pos=r-1,this.writeVarint(n),this.pos+=n},writeMessage:function(e,t,r){this.writeTag(e,no.Bytes),this.writeRawMessage(t,r)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,FB,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,NB,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,UB,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,BB,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,zB,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,VB,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,jB,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,$B,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,GB,t)},writeBytesField:function(e,t){this.writeTag(e,no.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,no.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,no.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,no.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,no.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,no.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,no.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,no.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,no.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,no.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,!!t)}};function LB(e,t,r){var n=r.buf,i,o;if(o=n[r.pos++],i=(o&112)>>4,o<128||(o=n[r.pos++],i|=(o&127)<<3,o<128)||(o=n[r.pos++],i|=(o&127)<<10,o<128)||(o=n[r.pos++],i|=(o&127)<<17,o<128)||(o=n[r.pos++],i|=(o&127)<<24,o<128)||(o=n[r.pos++],i|=(o&1)<<31,o<128))return y0(e,i,t);throw new Error("Expected varint not more than 10 bytes")}function bd(e){return e.type===no.Bytes?e.readVarint()+e.pos:e.pos+1}function y0(e,t,r){return r?t*4294967296+(e>>>0):(t>>>0)*4294967296+(e>>>0)}function kB(e,t){var r,n;if(e>=0?(r=e%4294967296|0,n=e/4294967296|0):(r=~(-e%4294967296),n=~(-e/4294967296),r^4294967295?r=r+1|0:(r=0,n=n+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),OB(r,n,t),DB(n,t)}function OB(e,t,r){r.buf[r.pos++]=e&127|128,e>>>=7,r.buf[r.pos++]=e&127|128,e>>>=7,r.buf[r.pos++]=e&127|128,e>>>=7,r.buf[r.pos++]=e&127|128,e>>>=7,r.buf[r.pos]=e&127}function DB(e,t){var r=(e&7)<<4;t.buf[t.pos++]|=r|((e>>>=3)?128:0),e&&(t.buf[t.pos++]=e&127|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=e&127|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=e&127|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=e&127|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=e&127)))))}function GA(e,t,r){var n=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(Math.LN2*7));r.realloc(n);for(var i=r.pos-1;i>=e;i--)r.buf[i+n]=r.buf[i]}function FB(e,t){for(var r=0;r<e.length;r++)t.writeVarint(e[r])}function NB(e,t){for(var r=0;r<e.length;r++)t.writeSVarint(e[r])}function BB(e,t){for(var r=0;r<e.length;r++)t.writeFloat(e[r])}function zB(e,t){for(var r=0;r<e.length;r++)t.writeDouble(e[r])}function UB(e,t){for(var r=0;r<e.length;r++)t.writeBoolean(e[r])}function VB(e,t){for(var r=0;r<e.length;r++)t.writeFixed32(e[r])}function jB(e,t){for(var r=0;r<e.length;r++)t.writeSFixed32(e[r])}function $B(e,t){for(var r=0;r<e.length;r++)t.writeFixed64(e[r])}function GB(e,t){for(var r=0;r<e.length;r++)t.writeSFixed64(e[r])}function n1(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+e[t+3]*16777216}function _0(e,t,r){e[r]=t,e[r+1]=t>>>8,e[r+2]=t>>>16,e[r+3]=t>>>24}function HA(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}function HB(e,t,r){for(var n="",i=t;i<r;){var o=e[i],a=null,u=o>239?4:o>223?3:o>191?2:1;if(i+u>r)break;var c,h,y;u===1?o<128&&(a=o):u===2?(c=e[i+1],(c&192)===128&&(a=(o&31)<<6|c&63,a<=127&&(a=null))):u===3?(c=e[i+1],h=e[i+2],(c&192)===128&&(h&192)===128&&(a=(o&15)<<12|(c&63)<<6|h&63,(a<=2047||a>=55296&&a<=57343)&&(a=null))):u===4&&(c=e[i+1],h=e[i+2],y=e[i+3],(c&192)===128&&(h&192)===128&&(y&192)===128&&(a=(o&15)<<18|(c&63)<<12|(h&63)<<6|y&63,(a<=65535||a>=1114112)&&(a=null))),a===null?(a=65533,u=1):a>65535&&(a-=65536,n+=String.fromCharCode(a>>>10&1023|55296),a=56320|a&1023),n+=String.fromCharCode(a),i+=u}return n}function WB(e,t,r){return bR.decode(e.subarray(t,r))}function XB(e,t,r){for(var n=0,i,o;n<t.length;n++){if(i=t.charCodeAt(n),i>55295&&i<57344)if(o)if(i<56320){e[r++]=239,e[r++]=191,e[r++]=189,o=i;continue}else i=o-55296<<10|i-56320|65536,o=null;else{i>56319||n+1===t.length?(e[r++]=239,e[r++]=191,e[r++]=189):o=i;continue}else o&&(e[r++]=239,e[r++]=191,e[r++]=189,o=null);i<128?e[r++]=i:(i<2048?e[r++]=i>>6|192:(i<65536?e[r++]=i>>12|224:(e[r++]=i>>18|240,e[r++]=i>>12&63|128),e[r++]=i>>6&63|128),e[r++]=i&63|128)}return r}const YB=jc(IB);var WA=function(){function e(t,r,n,i){$t(this,e),Q(this,"vectorLayerCache",{}),this.x=r,this.y=n,this.z=i,this.vectorTile=new PB(new YB(t))}return Gt(e,[{key:"getTileData",value:function(r){if(!r||!this.vectorTile.layers[r])return[];if(this.vectorLayerCache[r])return this.vectorLayerCache[r];var n=this.vectorTile.layers[r];if(Array.isArray(n.features))return this.vectorLayerCache[r]=n.features,n.features;for(var i=[],o=0;o<n.length;o++){var a=n.feature(o),u=a.toGeoJSON(this.x,this.y,this.z);i.push(_t(_t({},u),{},{properties:_t({id:u.id},u.properties)}))}return this.vectorLayerCache[r]=i,i}},{key:"getFeatureById",value:function(){throw new Error("Method not implemented.")}}]),e}(),qB={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0,warp:!0},ZB=function(){var e=Vt(Ce.mark(function t(r,n,i,o,a){var u;return Ce.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return u=Ey(r,n),h.abrupt("return",new Promise(function(y){if(a)a({x:i.x,y:i.y,z:i.z},function(E,T){if(E||!T)y(void 0);else{var I=new WA(T,i.x,i.y,i.z);y(I)}});else{var x=DE(_t(_t({},o),{},{url:u}),function(E,T){if(E||!T)y(void 0);else{var I=new WA(T,i.x,i.y,i.z);y(I)}});i.xhrCancel=function(){return x.abort()}}}));case 2:case"end":return h.stop()}},t)}));return function(r,n,i,o,a){return e.apply(this,arguments)}}();function KB(e,t){var r=Array.isArray(e)?e[0]:e,n=function(a,u){return ZB(r,a,u,t==null?void 0:t.requestParameters,t==null?void 0:t.getCustomData)},i=_t(_t(_t({},qB),t),{},{getTileData:n});return{data:r,dataArray:[],tilesetOptions:i,isTile:!0}}function QB(e,t,r){switch(e){case"+":return t+r;case"-":return t-r;case"*":return t*r;case"/":return t/r;case"%":return t%r;case"^":return Math.pow(t,r);case"abs":return Math.abs(t);case"floor":return Math.floor(t);case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"sin":return Math.sin(t);case"cos":return Math.cos(t);case"atan":return r===-1?Math.atan(t):Math.atan2(t,r);case"min":return Math.min(t,r);case"max":return Math.max(t,r);case"log10":return Math.log(t);case"log2":return Math.log2(t);default:return 0}}function Sy(e,t){for(var r=t[0],n=r.width,i=r.height,o=t.map(function(T){return T.rasterData}),a=n*i,u=[],c=JSON.stringify(e),h=0;h<a;h++){var y=JSON.parse(c),x=wR(y,o,h);if(typeof x=="number")u.push(x);else{var E=hw(y);u.push(E)}}return u}function wR(e,t,r){if(e.length===2&&e[0]==="band"&&typeof e[1]=="number")try{return t[e[1]][r]}catch{return 0}e.map(function(n,i){if(Array.isArray(n)&&n.length>0)switch(n[0]){case"band":try{e[i]=t[n[1]][r]}catch{e[i]=0}break;default:wR(n,t,r)}})}function JB(e){var t=ei(e,3),r=t[0],n=t[1],i=n===void 0?-1:n,o=t[2],a=o===void 0?-1:o;if(r===void 0)return["+",0,0];var u=r.replace(/\s+/g,"");return[u,i,a]}function hw(e){var t=JB(e),r=t[0],n=t[1],i=t[2];return Array.isArray(n)&&(n=hw(e[1])),Array.isArray(i)&&(i=hw(e[2])),QB(r,n,i)}var e9={nd:{type:"operation",expression:["/",["-",["band",1],["band",0]],["+",["band",1],["band",0]]]},rgb:{type:"function",method:t9}};function t9(e,t){for(var r=e[0].rasterData,n=e[1].rasterData,i=e[2].rasterData,o=[],a=(t==null?void 0:t.countCut)||[2,98],u=ei(a,2),c=u[0],h=u[1],y=(t==null?void 0:t.RMinMax)||Hb(r,c,h),x=(t==null?void 0:t.GMinMax)||Hb(n,c,h),E=(t==null?void 0:t.BMinMax)||Hb(i,c,h),T=0;T<r.length;T++)o.push(Math.max(0,r[T]-y[0])),o.push(Math.max(0,n[T]-x[0])),o.push(Math.max(0,i[T]-E[0]));return{rasterData:o,rMinMax:y,gMinMax:x,bMinMax:E}}function Hb(e,t,r){var n=e.slice().sort(function(u,c){return u-c}),i=n.length,o=n[Math.ceil(i*t/100)],a=n[Math.ceil(i*r/100)];return[o,a]}function tS(e,t,r){return pw.apply(this,arguments)}function pw(){return pw=Vt(Ce.mark(function e(t,r,n){var i,o,a,u,c,h;return Ce.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(t.length!==0){x.next=2;break}return x.abrupt("return",{rasterData:[0],width:1,heigh:1});case 2:return x.next=4,Promise.all(t.map(function(E){var T=E.data,I=E.bands,k=I===void 0?[0]:I;return r(T,k)}));case 4:i=x.sent,o=[],i.forEach(function(E){Array.isArray(E)?o.push.apply(o,cn(E)):o.push(E)}),a=o[0],u=a.width,c=a.height,x.t0=qh(n),x.next=x.t0==="function"?11:x.t0==="object"?13:15;break;case 11:return h=n(o),x.abrupt("break",16);case 13:return Array.isArray(n)?h={rasterData:Sy(n,o)}:h=r9(n,o),x.abrupt("break",16);case 15:h={rasterData:o[0].rasterData};case 16:return x.abrupt("return",_t(_t({},h),{},{width:u,height:c}));case 17:case"end":return x.stop()}},e)})),pw.apply(this,arguments)}function r9(e,t){var r=e9[e.type];if(r.type==="function")return r.method(t,e==null?void 0:e.options);if(r.type==="operation")return e.type==="rgb"?n9(r.expression,t):{rasterData:Sy(r.expression,t)}}function n9(e,t){e.r,e.g,e.b;var r=Sy(e.r||["band",0],t),n=Sy(e.g||["band",0],t),i=Sy(e.b||["band",0],t);return[r,n,i]}function dw(e,t,r,n){return vw.apply(this,arguments)}function vw(){return vw=Vt(Ce.mark(function e(t,r,n,i){var o;return Ce.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,tS(t,r,n);case 2:o=u.sent,i(null,{data:o});case 4:case"end":return u.stop()}},e)})),vw.apply(this,arguments)}function i9(e,t){return e.map(function(r){return r[t]*1})}function ER(e){return Array.isArray(e)?e.length===0||typeof e[0]=="number":!1}function a9(e,t){var r=t.extent,n=t.width,i=t.height,o=t.min,a=t.max,u=t.format,c=t.operation,h,y,x;if(u===void 0||ER(e))h=Array.from(e),y=n,x=i;else{var E=Array.isArray(e)?e:[e];h=tS(E,u,c)}var T={_id:1,dataArray:[{_id:1,data:h,width:y,height:x,min:o,max:a,coordinates:[[r[0],r[1]],[r[2],r[3]]]}]};return T}/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var XA;(function(e){(function(t){var r=typeof mf=="object"?mf:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),n=i(e);typeof r.Reflect>"u"?r.Reflect=e:n=i(r.Reflect,n),t(n);function i(o,a){return function(u,c){typeof o[u]!="function"&&Object.defineProperty(o,u,{configurable:!0,writable:!0,value:c}),a&&a(u,c)}}})(function(t){var r=Object.prototype.hasOwnProperty,n=typeof Symbol=="function",i=n&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",o=n&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",a=typeof Object.create=="function",u={__proto__:[]}instanceof Array,c=!a&&!u,h={create:a?function(){return ia(Object.create(null))}:u?function(){return ia({__proto__:null})}:function(){return ia({})},has:c?function(X,Ht){return r.call(X,Ht)}:function(X,Ht){return Ht in X},get:c?function(X,Ht){return r.call(X,Ht)?X[Ht]:void 0}:function(X,Ht){return X[Ht]}},y=Object.getPrototypeOf(Function),x=typeof process=="object"&&process["env"]&&process["env"].REFLECT_METADATA_USE_MAP_POLYFILL==="true",E=!x&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:Ai(),T=!x&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Vi(),I=!x&&typeof WeakMap=="function"?WeakMap:za(),k=new I;function D(X,Ht,or,Yr){if(rt(or)){if(!Ar(X))throw new TypeError;if(!Ft(Ht))throw new TypeError;return ue(X,Ht)}else{if(!Ar(X))throw new TypeError;if(!zt(Ht))throw new TypeError;if(!zt(Yr)&&!rt(Yr)&&!gt(Yr))throw new TypeError;return gt(Yr)&&(Yr=void 0),or=Ut(or),ie(X,Ht,or,Yr)}}t("decorate",D);function V(X,Ht){function or(Yr,wn){if(!zt(Yr))throw new TypeError;if(!rt(wn)&&!Mr(wn))throw new TypeError;$e(X,Ht,Yr,wn)}return or}t("metadata",V);function O(X,Ht,or,Yr){if(!zt(or))throw new TypeError;return rt(Yr)||(Yr=Ut(Yr)),$e(X,Ht,or,Yr)}t("defineMetadata",O);function F(X,Ht,or){if(!zt(Ht))throw new TypeError;return rt(or)||(or=Ut(or)),Se(X,Ht,or)}t("hasMetadata",F);function N(X,Ht,or){if(!zt(Ht))throw new TypeError;return rt(or)||(or=Ut(or)),Ne(X,Ht,or)}t("hasOwnMetadata",N);function H(X,Ht,or){if(!zt(Ht))throw new TypeError;return rt(or)||(or=Ut(or)),ze(X,Ht,or)}t("getMetadata",H);function q(X,Ht,or){if(!zt(Ht))throw new TypeError;return rt(or)||(or=Ut(or)),Be(X,Ht,or)}t("getOwnMetadata",q);function Y(X,Ht){if(!zt(X))throw new TypeError;return rt(Ht)||(Ht=Ut(Ht)),it(X,Ht)}t("getMetadataKeys",Y);function ee(X,Ht){if(!zt(X))throw new TypeError;return rt(Ht)||(Ht=Ut(Ht)),mt(X,Ht)}t("getOwnMetadataKeys",ee);function pe(X,Ht,or){if(!zt(Ht))throw new TypeError;rt(or)||(or=Ut(or));var Yr=xe(Ht,or,!1);if(rt(Yr)||!Yr.delete(X))return!1;if(Yr.size>0)return!0;var wn=k.get(Ht);return wn.delete(or),wn.size>0||k.delete(Ht),!0}t("deleteMetadata",pe);function ue(X,Ht){for(var or=X.length-1;or>=0;--or){var Yr=X[or],wn=Yr(Ht);if(!rt(wn)&&!gt(wn)){if(!Ft(wn))throw new TypeError;Ht=wn}}return Ht}function ie(X,Ht,or,Yr){for(var wn=X.length-1;wn>=0;--wn){var Qi=X[wn],Zn=Qi(Ht,or,Yr);if(!rt(Zn)&&!gt(Zn)){if(!zt(Zn))throw new TypeError;Yr=Zn}}return Yr}function xe(X,Ht,or){var Yr=k.get(X);if(rt(Yr)){if(!or)return;Yr=new E,k.set(X,Yr)}var wn=Yr.get(Ht);if(rt(wn)){if(!or)return;wn=new E,Yr.set(Ht,wn)}return wn}function Se(X,Ht,or){var Yr=Ne(X,Ht,or);if(Yr)return!0;var wn=ci(Ht);return gt(wn)?!1:Se(X,wn,or)}function Ne(X,Ht,or){var Yr=xe(Ht,or,!1);return rt(Yr)?!1:Wr(Yr.has(X))}function ze(X,Ht,or){var Yr=Ne(X,Ht,or);if(Yr)return Be(X,Ht,or);var wn=ci(Ht);if(!gt(wn))return ze(X,wn,or)}function Be(X,Ht,or){var Yr=xe(Ht,or,!1);if(!rt(Yr))return Yr.get(X)}function $e(X,Ht,or,Yr){var wn=xe(or,Yr,!0);wn.set(X,Ht)}function it(X,Ht){var or=mt(X,Ht),Yr=ci(X);if(Yr===null)return or;var wn=it(Yr,Ht);if(wn.length<=0)return or;if(or.length<=0)return wn;for(var Qi=new T,Zn=[],Hn=0,Dn=or;Hn<Dn.length;Hn++){var di=Dn[Hn],wt=Qi.has(di);wt||(Qi.add(di),Zn.push(di))}for(var rn=0,En=wn;rn<En.length;rn++){var di=En[rn],wt=Qi.has(di);wt||(Qi.add(di),Zn.push(di))}return Zn}function mt(X,Ht){var or=[],Yr=xe(X,Ht,!1);if(rt(Yr))return or;for(var wn=Yr.keys(),Qi=Nn(wn),Zn=0;;){var Hn=qn(Qi);if(!Hn)return or.length=Zn,or;var Dn=Xn(Hn);try{or[Zn]=Dn}catch(di){try{Li(Qi)}finally{throw di}}Zn++}}function Qe(X){if(X===null)return 1;switch(typeof X){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return X===null?1:6;default:return 6}}function rt(X){return X===void 0}function gt(X){return X===null}function er(X){return typeof X=="symbol"}function zt(X){return typeof X=="object"?X!==null:typeof X=="function"}function qt(X,Ht){switch(Qe(X)){case 0:return X;case 1:return X;case 2:return X;case 3:return X;case 4:return X;case 5:return X}var or=Ht===3?"string":Ht===5?"number":"default",Yr=mn(X,i);if(Yr!==void 0){var wn=Yr.call(X,or);if(zt(wn))throw new TypeError;return wn}return Zr(X,or==="default"?"number":or)}function Zr(X,Ht){if(Ht==="string"){var or=X.toString;if(an(or)){var Yr=or.call(X);if(!zt(Yr))return Yr}var wn=X.valueOf;if(an(wn)){var Yr=wn.call(X);if(!zt(Yr))return Yr}}else{var wn=X.valueOf;if(an(wn)){var Yr=wn.call(X);if(!zt(Yr))return Yr}var Qi=X.toString;if(an(Qi)){var Yr=Qi.call(X);if(!zt(Yr))return Yr}}throw new TypeError}function Wr(X){return!!X}function On(X){return""+X}function Ut(X){var Ht=qt(X,3);return er(Ht)?Ht:On(Ht)}function Ar(X){return Array.isArray?Array.isArray(X):X instanceof Object?X instanceof Array:Object.prototype.toString.call(X)==="[object Array]"}function an(X){return typeof X=="function"}function Ft(X){return typeof X=="function"}function Mr(X){switch(Qe(X)){case 3:return!0;case 4:return!0;default:return!1}}function mn(X,Ht){var or=X[Ht];if(or!=null){if(!an(or))throw new TypeError;return or}}function Nn(X){var Ht=mn(X,o);if(!an(Ht))throw new TypeError;var or=Ht.call(X);if(!zt(or))throw new TypeError;return or}function Xn(X){return X.value}function qn(X){var Ht=X.next();return Ht.done?!1:Ht}function Li(X){var Ht=X.return;Ht&&Ht.call(X)}function ci(X){var Ht=Object.getPrototypeOf(X);if(typeof X!="function"||X===y||Ht!==y)return Ht;var or=X.prototype,Yr=or&&Object.getPrototypeOf(or);if(Yr==null||Yr===Object.prototype)return Ht;var wn=Yr.constructor;return typeof wn!="function"||wn===X?Ht:wn}function Ai(){var X={},Ht=[],or=function(){function Zn(Hn,Dn,di){this._index=0,this._keys=Hn,this._values=Dn,this._selector=di}return Zn.prototype["@@iterator"]=function(){return this},Zn.prototype[o]=function(){return this},Zn.prototype.next=function(){var Hn=this._index;if(Hn>=0&&Hn<this._keys.length){var Dn=this._selector(this._keys[Hn],this._values[Hn]);return Hn+1>=this._keys.length?(this._index=-1,this._keys=Ht,this._values=Ht):this._index++,{value:Dn,done:!1}}return{value:void 0,done:!0}},Zn.prototype.throw=function(Hn){throw this._index>=0&&(this._index=-1,this._keys=Ht,this._values=Ht),Hn},Zn.prototype.return=function(Hn){return this._index>=0&&(this._index=-1,this._keys=Ht,this._values=Ht),{value:Hn,done:!0}},Zn}();return function(){function Zn(){this._keys=[],this._values=[],this._cacheKey=X,this._cacheIndex=-2}return Object.defineProperty(Zn.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),Zn.prototype.has=function(Hn){return this._find(Hn,!1)>=0},Zn.prototype.get=function(Hn){var Dn=this._find(Hn,!1);return Dn>=0?this._values[Dn]:void 0},Zn.prototype.set=function(Hn,Dn){var di=this._find(Hn,!0);return this._values[di]=Dn,this},Zn.prototype.delete=function(Hn){var Dn=this._find(Hn,!1);if(Dn>=0){for(var di=this._keys.length,wt=Dn+1;wt<di;wt++)this._keys[wt-1]=this._keys[wt],this._values[wt-1]=this._values[wt];return this._keys.length--,this._values.length--,Hn===this._cacheKey&&(this._cacheKey=X,this._cacheIndex=-2),!0}return!1},Zn.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=X,this._cacheIndex=-2},Zn.prototype.keys=function(){return new or(this._keys,this._values,Yr)},Zn.prototype.values=function(){return new or(this._keys,this._values,wn)},Zn.prototype.entries=function(){return new or(this._keys,this._values,Qi)},Zn.prototype["@@iterator"]=function(){return this.entries()},Zn.prototype[o]=function(){return this.entries()},Zn.prototype._find=function(Hn,Dn){return this._cacheKey!==Hn&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=Hn)),this._cacheIndex<0&&Dn&&(this._cacheIndex=this._keys.length,this._keys.push(Hn),this._values.push(void 0)),this._cacheIndex},Zn}();function Yr(Zn,Hn){return Zn}function wn(Zn,Hn){return Hn}function Qi(Zn,Hn){return[Zn,Hn]}}function Vi(){return function(){function X(){this._map=new E}return Object.defineProperty(X.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),X.prototype.has=function(Ht){return this._map.has(Ht)},X.prototype.add=function(Ht){return this._map.set(Ht,Ht),this},X.prototype.delete=function(Ht){return this._map.delete(Ht)},X.prototype.clear=function(){this._map.clear()},X.prototype.keys=function(){return this._map.keys()},X.prototype.values=function(){return this._map.values()},X.prototype.entries=function(){return this._map.entries()},X.prototype["@@iterator"]=function(){return this.keys()},X.prototype[o]=function(){return this.keys()},X}()}function za(){var X=16,Ht=h.create(),or=Yr();return function(){function Dn(){this._key=Yr()}return Dn.prototype.has=function(di){var wt=wn(di,!1);return wt!==void 0?h.has(wt,this._key):!1},Dn.prototype.get=function(di){var wt=wn(di,!1);return wt!==void 0?h.get(wt,this._key):void 0},Dn.prototype.set=function(di,wt){var rn=wn(di,!0);return rn[this._key]=wt,this},Dn.prototype.delete=function(di){var wt=wn(di,!1);return wt!==void 0?delete wt[this._key]:!1},Dn.prototype.clear=function(){this._key=Yr()},Dn}();function Yr(){var Dn;do Dn="@@WeakMap@@"+Hn();while(h.has(Ht,Dn));return Ht[Dn]=!0,Dn}function wn(Dn,di){if(!r.call(Dn,or)){if(!di)return;Object.defineProperty(Dn,or,{value:h.create()})}return Dn[or]}function Qi(Dn,di){for(var wt=0;wt<di;++wt)Dn[wt]=Math.random()*255|0;return Dn}function Zn(Dn){return typeof Uint8Array=="function"?typeof crypto<"u"?crypto.getRandomValues(new Uint8Array(Dn)):typeof msCrypto<"u"?msCrypto.getRandomValues(new Uint8Array(Dn)):Qi(new Uint8Array(Dn),Dn):Qi(new Array(Dn),Dn)}function Hn(){var Dn=Zn(X);Dn[6]=Dn[6]&79|64,Dn[8]=Dn[8]&191|128;for(var di="",wt=0;wt<X;++wt){var rn=Dn[wt];(wt===4||wt===6||wt===8)&&(di+="-"),rn<16&&(di+="0"),di+=rn.toString(16).toLowerCase()}return di}}function ia(X){return X.__=void 0,delete X.__,X}})})(XA||(XA={}));var Fp="named",SR="name",rS="unmanaged",AR="optional",zx="inject",Gy="multi_inject",TR="inversify:tagged",CR="inversify:tagged_props",mw="inversify:paramtypes",o9="design:paramtypes",Ay="post_construct";function s9(){return[zx,Gy,SR,rS,Fp,AR]}var YA=s9(),gl={Request:"Request",Singleton:"Singleton",Transient:"Transient"},ml={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"},Md={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"},u9=0;function g_(){return u9++}var l9=function(){function e(t,r){this.id=g_(),this.activated=!1,this.serviceIdentifier=t,this.scope=r,this.type=ml.Invalid,this.constraint=function(n){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return e.prototype.clone=function(){var t=new e(this.serviceIdentifier,this.scope);return t.activated=t.scope===gl.Singleton?this.activated:!1,t.implementationType=this.implementationType,t.dynamicValue=this.dynamicValue,t.scope=this.scope,t.type=this.type,t.factory=this.factory,t.provider=this.provider,t.constraint=this.constraint,t.onActivation=this.onActivation,t.cache=this.cache,t},e}(),c9="Cannot apply @injectable decorator multiple times.",f9="Metadata key was used more than once in a parameter:",Xg="NULL argument",qA="Key Not Found",h9="Ambiguous match found for serviceIdentifier:",p9="Could not unbind serviceIdentifier:",d9="No matching bindings found for serviceIdentifier:",v9="Missing required @injectable annotation in:",m9="Missing required @inject or @multiInject annotation in:",g9=function(e){return"@inject called with undefined this could mean that the class "+e+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."},y9="Circular dependency found:",_9="Invalid binding type:",x9="No snapshot available to restore.",b9="Invalid return type in middleware. Middleware must return!",w9="Value provided to function binding must be a function!",E9="The toSelf function can only be applied when a constructor is used as service identifier",S9="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.",A9=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return"The number of constructor arguments in the derived class "+(e[0]+" must be >= than the number of constructor arguments of its base class.")},T9="Invalid Container constructor argument. Container options must be an object.",C9="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",M9="Invalid Container option. Auto bind injectable must be a boolean",P9="Invalid Container option. Skip base check must be a boolean",I9="Cannot apply @postConstruct decorator multiple times in the same class",R9=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return"@postConstruct error in class "+e[0]+": "+e[1]},L9=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return"It looks like there is a circular dependency "+("in one of the '"+e[0]+"' bindings. Please investigate bindings with")+("service identifier '"+e[1]+"'.")},k9="Maximum call stack size exceeded",O9=function(){function e(){}return e.prototype.getConstructorMetadata=function(t){var r=Reflect.getMetadata(mw,t),n=Reflect.getMetadata(TR,t);return{compilerGeneratedMetadata:r,userGeneratedMetadata:n||{}}},e.prototype.getPropertiesMetadata=function(t){var r=Reflect.getMetadata(CR,t)||[];return r},e}(),I1={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};function MR(e){return e instanceof RangeError||e.message===k9}function Hy(e){if(typeof e=="function"){var t=e;return t.name}else{if(typeof e=="symbol")return e.toString();var t=e;return t}}function ZA(e,t,r){var n="",i=r(e,t);return i.length!==0&&(n=`
Registered bindings:`,i.forEach(function(o){var a="Object";o.implementationType!==null&&(a=Ux(o.implementationType)),n=n+`
 `+a,o.constraint.metaData&&(n=n+" - "+o.constraint.metaData)})),n}function PR(e,t){return e.parentRequest===null?!1:e.parentRequest.serviceIdentifier===t?!0:PR(e.parentRequest,t)}function D9(e){function t(n,i){i===void 0&&(i=[]);var o=Hy(n.serviceIdentifier);return i.push(o),n.parentRequest!==null?t(n.parentRequest,i):i}var r=t(e);return r.reverse().join(" --> ")}function IR(e){e.childRequests.forEach(function(t){if(PR(t,t.serviceIdentifier)){var r=D9(t);throw new Error(y9+" "+r)}else IR(t)})}function F9(e,t){if(t.isTagged()||t.isNamed()){var r="",n=t.getNamedTag(),i=t.getCustomTags();return n!==null&&(r+=n.toString()+`
`),i!==null&&i.forEach(function(o){r+=o.toString()+`
`})," "+e+`
 `+e+" - "+r}else return" "+e}function Ux(e){if(e.name)return e.name;var t=e.toString(),r=t.match(/^function\s*([^\s(]+)/);return r?r[1]:"Anonymous function: "+t}var RR=function(){function e(t){this.id=g_(),this.container=t}return e.prototype.addPlan=function(t){this.plan=t},e.prototype.setCurrentRequest=function(t){this.currentRequest=t},e}(),Rv=function(){function e(t,r){this.key=t,this.value=r}return e.prototype.toString=function(){return this.key===Fp?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},e}(),N9=function(){function e(t,r){this.parentContext=t,this.rootRequest=r}return e}();function B9(e,t,r,n){var i=TR;LR(i,e,t,n,r)}function z9(e,t,r){var n=CR;LR(n,e.constructor,t,r)}function LR(e,t,r,n,i){var o={},a=typeof i=="number",u=i!==void 0&&a?i.toString():r;if(a&&r!==void 0)throw new Error(S9);Reflect.hasOwnMetadata(e,t)&&(o=Reflect.getMetadata(e,t));var c=o[u];if(!Array.isArray(c))c=[];else for(var h=0,y=c;h<y.length;h++){var x=y[h];if(x.key===n.key)throw new Error(f9+" "+x.key.toString())}c.push(n),o[u]=c,Reflect.defineMetadata(e,o,t)}function KA(e,t){Reflect.decorate(e,t)}function U9(e,t){return function(r,n){t(r,n,e)}}function V9(e,t,r){typeof r=="number"?KA([U9(r,e)],t):typeof r=="string"?Reflect.decorate([e],t,r):KA([e],t)}var j9=function(){function e(t){this._cb=t}return e.prototype.unwrap=function(){return this._cb()},e}();function na(e){return function(t,r,n){if(e===void 0)throw new Error(g9(t.name));var i=new Rv(zx,e);typeof n=="number"?B9(t,r,n,i):z9(t,r,i)}}var $9=function(){function e(t){this.str=t}return e.prototype.startsWith=function(t){return this.str.indexOf(t)===0},e.prototype.endsWith=function(t){var r="",n=t.split("").reverse().join("");return r=this.str.split("").reverse().join(""),this.startsWith.call({str:r},n)},e.prototype.contains=function(t){return this.str.indexOf(t)!==-1},e.prototype.equals=function(t){return this.str===t},e.prototype.value=function(){return this.str},e}(),Vx=function(){function e(t,r,n,i){this.id=g_(),this.type=t,this.serviceIdentifier=n,this.name=new $9(r||""),this.metadata=new Array;var o=null;typeof i=="string"?o=new Rv(Fp,i):i instanceof Rv&&(o=i),o!==null&&this.metadata.push(o)}return e.prototype.hasTag=function(t){for(var r=0,n=this.metadata;r<n.length;r++){var i=n[r];if(i.key===t)return!0}return!1},e.prototype.isArray=function(){return this.hasTag(Gy)},e.prototype.matchesArray=function(t){return this.matchesTag(Gy)(t)},e.prototype.isNamed=function(){return this.hasTag(Fp)},e.prototype.isTagged=function(){return this.metadata.some(function(t){return YA.every(function(r){return t.key!==r})})},e.prototype.isOptional=function(){return this.matchesTag(AR)(!0)},e.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(t){return t.key===Fp})[0]:null},e.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(t){return YA.every(function(r){return t.key!==r})}):null},e.prototype.matchesNamedTag=function(t){return this.matchesTag(Fp)(t)},e.prototype.matchesTag=function(t){var r=this;return function(n){for(var i=0,o=r.metadata;i<o.length;i++){var a=o[i];if(a.key===t&&a.value===n)return!0}return!1}},e}(),q1=globalThis&&globalThis.__spreadArray||function(e,t){for(var r=0,n=t.length,i=e.length;r<n;r++,i++)e[i]=t[r];return e};function G9(e,t){var r=Ux(t),n=kR(e,r,t,!1);return n}function kR(e,t,r,n){var i=e.getConstructorMetadata(r),o=i.compilerGeneratedMetadata;if(o===void 0){var a=v9+" "+t+".";throw new Error(a)}var u=i.userGeneratedMetadata,c=Object.keys(u),h=r.length===0&&c.length>0,y=c.length>r.length,x=h||y?c.length:r.length,E=W9(n,t,o,u,x),T=OR(e,r),I=q1(q1([],E),T);return I}function H9(e,t,r,n,i){var o=i[e.toString()]||[],a=FR(o),u=a.unmanaged!==!0,c=n[e],h=a.inject||a.multiInject;if(c=h||c,c instanceof j9&&(c=c.unwrap()),u){var y=c===Object,x=c===Function,E=c===void 0,T=y||x||E;if(!t&&T){var I=m9+" argument "+e+" in class "+r+".";throw new Error(I)}var k=new Vx(Md.ConstructorArgument,a.targetName,c);return k.metadata=o,k}return null}function W9(e,t,r,n,i){for(var o=[],a=0;a<i;a++){var u=a,c=H9(u,e,t,r,n);c!==null&&o.push(c)}return o}function OR(e,t){for(var r=e.getPropertiesMetadata(t),n=[],i=Object.keys(r),o=0,a=i;o<a.length;o++){var u=a[o],c=r[u],h=FR(r[u]),y=h.targetName||u,x=h.inject||h.multiInject,E=new Vx(Md.ClassProperty,y,x);E.metadata=c,n.push(E)}var T=Object.getPrototypeOf(t.prototype).constructor;if(T!==Object){var I=OR(e,T);n=q1(q1([],n),I)}return n}function DR(e,t){var r=Object.getPrototypeOf(t.prototype).constructor;if(r!==Object){var n=Ux(r),i=kR(e,n,r,!0),o=i.map(function(c){return c.metadata.filter(function(h){return h.key===rS})}),a=[].concat.apply([],o).length,u=i.length-a;return u>0?u:DR(e,r)}else return 0}function FR(e){var t={};return e.forEach(function(r){t[r.key.toString()]=r.value}),{inject:t[zx],multiInject:t[Gy],targetName:t[SR],unmanaged:t[rS]}}var nS=function(){function e(t,r,n,i,o){this.id=g_(),this.serviceIdentifier=t,this.parentContext=r,this.parentRequest=n,this.target=o,this.childRequests=[],this.bindings=Array.isArray(i)?i:[i],this.requestScope=n===null?new Map:null}return e.prototype.addChildRequest=function(t,r,n){var i=new e(t,this.parentContext,this,r,n);return this.childRequests.push(i),i},e}();function gw(e){return e._bindingDictionary}function X9(e,t,r,n,i,o){var a=e?Gy:zx,u=new Rv(a,r),c=new Vx(t,n,r,u);if(i!==void 0){var h=new Rv(i,o);c.metadata.push(h)}return c}function QA(e,t,r,n,i){var o=Wy(r.container,i.serviceIdentifier),a=[];return o.length===I1.NoBindingsAvailable&&r.container.options.autoBindInjectable&&typeof i.serviceIdentifier=="function"&&e.getConstructorMetadata(i.serviceIdentifier).compilerGeneratedMetadata&&(r.container.bind(i.serviceIdentifier).toSelf(),o=Wy(r.container,i.serviceIdentifier)),t?a=o:a=o.filter(function(u){var c=new nS(u.serviceIdentifier,r,n,u,i);return u.constraint(c)}),Y9(i.serviceIdentifier,a,i,r.container),a}function Y9(e,t,r,n){switch(t.length){case I1.NoBindingsAvailable:if(r.isOptional())return t;var i=Hy(e),o=d9;throw o+=F9(i,r),o+=ZA(n,i,Wy),new Error(o);case I1.OnlyOneBindingAvailable:if(!r.isArray())return t;case I1.MultipleBindingsAvailable:default:if(r.isArray())return t;var i=Hy(e),o=h9+" "+i;throw o+=ZA(n,i,Wy),new Error(o)}}function NR(e,t,r,n,i,o){var a,u;if(i===null){a=QA(e,t,n,null,o),u=new nS(r,n,null,a,o);var c=new N9(n,u);n.addPlan(c)}else a=QA(e,t,n,i,o),u=i.addChildRequest(o.serviceIdentifier,a,o);a.forEach(function(h){var y=null;if(o.isArray())y=u.addChildRequest(h.serviceIdentifier,h,o);else{if(h.cache)return;y=u}if(h.type===ml.Instance&&h.implementationType!==null){var x=G9(e,h.implementationType);if(!n.container.options.skipBaseClassChecks){var E=DR(e,h.implementationType);if(x.length<E){var T=A9(Ux(h.implementationType));throw new Error(T)}}x.forEach(function(I){NR(e,!1,I.serviceIdentifier,n,y,I)})}})}function Wy(e,t){var r=[],n=gw(e);return n.hasKey(t)?r=n.get(t):e.parent!==null&&(r=Wy(e.parent,t)),r}function q9(e,t,r,n,i,o,a,u){u===void 0&&(u=!1);var c=new RR(t),h=X9(r,n,i,"",o,a);try{return NR(e,u,i,c,null,h),c}catch(y){throw MR(y)&&c.plan&&IR(c.plan.rootRequest),y}}function Z9(e,t,r,n){var i=new Vx(Md.Variable,"",t,new Rv(r,n)),o=new RR(e),a=new nS(t,o,null,[],i);return a}var K9=globalThis&&globalThis.__spreadArray||function(e,t){for(var r=0,n=t.length,i=e.length;r<n;r++,i++)e[i]=t[r];return e};function Q9(e,t,r){var n=t.filter(function(o){return o.target!==null&&o.target.type===Md.ClassProperty}),i=n.map(r);return n.forEach(function(o,a){var u="";u=o.target.name.value();var c=i[a];e[u]=c}),e}function J9(e,t){return new(e.bind.apply(e,K9([void 0],t)))}function ez(e,t){if(Reflect.hasMetadata(Ay,e)){var r=Reflect.getMetadata(Ay,e);try{t[r.value]()}catch(n){throw new Error(R9(e.name,n.message))}}}function tz(e,t,r){var n=null;if(t.length>0){var i=t.filter(function(a){return a.target!==null&&a.target.type===Md.ConstructorArgument}),o=i.map(r);n=J9(e,o),n=Q9(n,t,r)}else n=new e;return ez(e,n),n}var Wb=function(e,t,r){try{return r()}catch(n){throw MR(n)?new Error(L9(e,t.toString())):n}},yw=function(e){return function(t){t.parentContext.setCurrentRequest(t);var r=t.bindings,n=t.childRequests,i=t.target&&t.target.isArray(),o=!t.parentRequest||!t.parentRequest.target||!t.target||!t.parentRequest.target.matchesArray(t.target.serviceIdentifier);if(i&&o)return n.map(function(x){var E=yw(e);return E(x)});var a=null;if(t.target.isOptional()&&r.length===0)return;var u=r[0],c=u.scope===gl.Singleton,h=u.scope===gl.Request;if(c&&u.activated)return u.cache;if(h&&e!==null&&e.has(u.id))return e.get(u.id);if(u.type===ml.ConstantValue)a=u.cache,u.activated=!0;else if(u.type===ml.Function)a=u.cache,u.activated=!0;else if(u.type===ml.Constructor)a=u.implementationType;else if(u.type===ml.DynamicValue&&u.dynamicValue!==null)a=Wb("toDynamicValue",u.serviceIdentifier,function(){return u.dynamicValue(t.parentContext)});else if(u.type===ml.Factory&&u.factory!==null)a=Wb("toFactory",u.serviceIdentifier,function(){return u.factory(t.parentContext)});else if(u.type===ml.Provider&&u.provider!==null)a=Wb("toProvider",u.serviceIdentifier,function(){return u.provider(t.parentContext)});else if(u.type===ml.Instance&&u.implementationType!==null)a=tz(u.implementationType,n,yw(e));else{var y=Hy(t.serviceIdentifier);throw new Error(_9+" "+y)}return typeof u.onActivation=="function"&&(a=u.onActivation(t.parentContext,a)),c&&(u.cache=a,u.activated=!0),h&&e!==null&&!e.has(u.id)&&e.set(u.id,a),a}};function rz(e){var t=yw(e.plan.rootRequest.requestScope);return t(e.plan.rootRequest)}var Sd=function(e,t){var r=e.parentRequest;return r!==null?t(r)?!0:Sd(r,t):!1},vy=function(e){return function(t){var r=function(n){return n!==null&&n.target!==null&&n.target.matchesTag(e)(t)};return r.metaData=new Rv(e,t),r}},i1=vy(Fp),Xb=function(e){return function(t){var r=null;if(t!==null)if(r=t.bindings[0],typeof e=="string"){var n=r.serviceIdentifier;return n===e}else{var i=t.bindings[0].implementationType;return e===i}return!1}},iS=function(){function e(t){this._binding=t}return e.prototype.when=function(t){return this._binding.constraint=t,new dl(this._binding)},e.prototype.whenTargetNamed=function(t){return this._binding.constraint=i1(t),new dl(this._binding)},e.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(t){var r=t.target!==null&&!t.target.isNamed()&&!t.target.isTagged();return r},new dl(this._binding)},e.prototype.whenTargetTagged=function(t,r){return this._binding.constraint=vy(t)(r),new dl(this._binding)},e.prototype.whenInjectedInto=function(t){return this._binding.constraint=function(r){return Xb(t)(r.parentRequest)},new dl(this._binding)},e.prototype.whenParentNamed=function(t){return this._binding.constraint=function(r){return i1(t)(r.parentRequest)},new dl(this._binding)},e.prototype.whenParentTagged=function(t,r){return this._binding.constraint=function(n){return vy(t)(r)(n.parentRequest)},new dl(this._binding)},e.prototype.whenAnyAncestorIs=function(t){return this._binding.constraint=function(r){return Sd(r,Xb(t))},new dl(this._binding)},e.prototype.whenNoAncestorIs=function(t){return this._binding.constraint=function(r){return!Sd(r,Xb(t))},new dl(this._binding)},e.prototype.whenAnyAncestorNamed=function(t){return this._binding.constraint=function(r){return Sd(r,i1(t))},new dl(this._binding)},e.prototype.whenNoAncestorNamed=function(t){return this._binding.constraint=function(r){return!Sd(r,i1(t))},new dl(this._binding)},e.prototype.whenAnyAncestorTagged=function(t,r){return this._binding.constraint=function(n){return Sd(n,vy(t)(r))},new dl(this._binding)},e.prototype.whenNoAncestorTagged=function(t,r){return this._binding.constraint=function(n){return!Sd(n,vy(t)(r))},new dl(this._binding)},e.prototype.whenAnyAncestorMatches=function(t){return this._binding.constraint=function(r){return Sd(r,t)},new dl(this._binding)},e.prototype.whenNoAncestorMatches=function(t){return this._binding.constraint=function(r){return!Sd(r,t)},new dl(this._binding)},e}(),dl=function(){function e(t){this._binding=t}return e.prototype.onActivation=function(t){return this._binding.onActivation=t,new iS(this._binding)},e}(),bv=function(){function e(t){this._binding=t,this._bindingWhenSyntax=new iS(this._binding),this._bindingOnSyntax=new dl(this._binding)}return e.prototype.when=function(t){return this._bindingWhenSyntax.when(t)},e.prototype.whenTargetNamed=function(t){return this._bindingWhenSyntax.whenTargetNamed(t)},e.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},e.prototype.whenTargetTagged=function(t,r){return this._bindingWhenSyntax.whenTargetTagged(t,r)},e.prototype.whenInjectedInto=function(t){return this._bindingWhenSyntax.whenInjectedInto(t)},e.prototype.whenParentNamed=function(t){return this._bindingWhenSyntax.whenParentNamed(t)},e.prototype.whenParentTagged=function(t,r){return this._bindingWhenSyntax.whenParentTagged(t,r)},e.prototype.whenAnyAncestorIs=function(t){return this._bindingWhenSyntax.whenAnyAncestorIs(t)},e.prototype.whenNoAncestorIs=function(t){return this._bindingWhenSyntax.whenNoAncestorIs(t)},e.prototype.whenAnyAncestorNamed=function(t){return this._bindingWhenSyntax.whenAnyAncestorNamed(t)},e.prototype.whenAnyAncestorTagged=function(t,r){return this._bindingWhenSyntax.whenAnyAncestorTagged(t,r)},e.prototype.whenNoAncestorNamed=function(t){return this._bindingWhenSyntax.whenNoAncestorNamed(t)},e.prototype.whenNoAncestorTagged=function(t,r){return this._bindingWhenSyntax.whenNoAncestorTagged(t,r)},e.prototype.whenAnyAncestorMatches=function(t){return this._bindingWhenSyntax.whenAnyAncestorMatches(t)},e.prototype.whenNoAncestorMatches=function(t){return this._bindingWhenSyntax.whenNoAncestorMatches(t)},e.prototype.onActivation=function(t){return this._bindingOnSyntax.onActivation(t)},e}(),nz=function(){function e(t){this._binding=t}return e.prototype.inRequestScope=function(){return this._binding.scope=gl.Request,new bv(this._binding)},e.prototype.inSingletonScope=function(){return this._binding.scope=gl.Singleton,new bv(this._binding)},e.prototype.inTransientScope=function(){return this._binding.scope=gl.Transient,new bv(this._binding)},e}(),JA=function(){function e(t){this._binding=t,this._bindingWhenSyntax=new iS(this._binding),this._bindingOnSyntax=new dl(this._binding),this._bindingInSyntax=new nz(t)}return e.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},e.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},e.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},e.prototype.when=function(t){return this._bindingWhenSyntax.when(t)},e.prototype.whenTargetNamed=function(t){return this._bindingWhenSyntax.whenTargetNamed(t)},e.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},e.prototype.whenTargetTagged=function(t,r){return this._bindingWhenSyntax.whenTargetTagged(t,r)},e.prototype.whenInjectedInto=function(t){return this._bindingWhenSyntax.whenInjectedInto(t)},e.prototype.whenParentNamed=function(t){return this._bindingWhenSyntax.whenParentNamed(t)},e.prototype.whenParentTagged=function(t,r){return this._bindingWhenSyntax.whenParentTagged(t,r)},e.prototype.whenAnyAncestorIs=function(t){return this._bindingWhenSyntax.whenAnyAncestorIs(t)},e.prototype.whenNoAncestorIs=function(t){return this._bindingWhenSyntax.whenNoAncestorIs(t)},e.prototype.whenAnyAncestorNamed=function(t){return this._bindingWhenSyntax.whenAnyAncestorNamed(t)},e.prototype.whenAnyAncestorTagged=function(t,r){return this._bindingWhenSyntax.whenAnyAncestorTagged(t,r)},e.prototype.whenNoAncestorNamed=function(t){return this._bindingWhenSyntax.whenNoAncestorNamed(t)},e.prototype.whenNoAncestorTagged=function(t,r){return this._bindingWhenSyntax.whenNoAncestorTagged(t,r)},e.prototype.whenAnyAncestorMatches=function(t){return this._bindingWhenSyntax.whenAnyAncestorMatches(t)},e.prototype.whenNoAncestorMatches=function(t){return this._bindingWhenSyntax.whenNoAncestorMatches(t)},e.prototype.onActivation=function(t){return this._bindingOnSyntax.onActivation(t)},e}(),iz=function(){function e(t){this._binding=t}return e.prototype.to=function(t){return this._binding.type=ml.Instance,this._binding.implementationType=t,new JA(this._binding)},e.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+E9);var t=this._binding.serviceIdentifier;return this.to(t)},e.prototype.toConstantValue=function(t){return this._binding.type=ml.ConstantValue,this._binding.cache=t,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=gl.Singleton,new bv(this._binding)},e.prototype.toDynamicValue=function(t){return this._binding.type=ml.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=t,this._binding.implementationType=null,new JA(this._binding)},e.prototype.toConstructor=function(t){return this._binding.type=ml.Constructor,this._binding.implementationType=t,this._binding.scope=gl.Singleton,new bv(this._binding)},e.prototype.toFactory=function(t){return this._binding.type=ml.Factory,this._binding.factory=t,this._binding.scope=gl.Singleton,new bv(this._binding)},e.prototype.toFunction=function(t){if(typeof t!="function")throw new Error(w9);var r=this.toConstantValue(t);return this._binding.type=ml.Function,this._binding.scope=gl.Singleton,r},e.prototype.toAutoFactory=function(t){return this._binding.type=ml.Factory,this._binding.factory=function(r){var n=function(){return r.container.get(t)};return n},this._binding.scope=gl.Singleton,new bv(this._binding)},e.prototype.toProvider=function(t){return this._binding.type=ml.Provider,this._binding.provider=t,this._binding.scope=gl.Singleton,new bv(this._binding)},e.prototype.toService=function(t){this.toDynamicValue(function(r){return r.container.get(t)})},e}(),az=function(){function e(){}return e.of=function(t,r){var n=new e;return n.bindings=t,n.middleware=r,n},e}(),eT=function(){function e(){this._map=new Map}return e.prototype.getMap=function(){return this._map},e.prototype.add=function(t,r){if(t==null)throw new Error(Xg);if(r==null)throw new Error(Xg);var n=this._map.get(t);n!==void 0?(n.push(r),this._map.set(t,n)):this._map.set(t,[r])},e.prototype.get=function(t){if(t==null)throw new Error(Xg);var r=this._map.get(t);if(r!==void 0)return r;throw new Error(qA)},e.prototype.remove=function(t){if(t==null)throw new Error(Xg);if(!this._map.delete(t))throw new Error(qA)},e.prototype.removeByCondition=function(t){var r=this;this._map.forEach(function(n,i){var o=n.filter(function(a){return!t(a)});o.length>0?r._map.set(i,o):r._map.delete(i)})},e.prototype.hasKey=function(t){if(t==null)throw new Error(Xg);return this._map.has(t)},e.prototype.clone=function(){var t=new e;return this._map.forEach(function(r,n){r.forEach(function(i){return t.add(n,i.clone())})}),t},e.prototype.traverse=function(t){this._map.forEach(function(r,n){t(n,r)})},e}(),oz=globalThis&&globalThis.__awaiter||function(e,t,r,n){function i(o){return o instanceof r?o:new r(function(a){a(o)})}return new(r||(r=Promise))(function(o,a){function u(y){try{h(n.next(y))}catch(x){a(x)}}function c(y){try{h(n.throw(y))}catch(x){a(x)}}function h(y){y.done?o(y.value):i(y.value).then(u,c)}h((n=n.apply(e,t||[])).next())})},sz=globalThis&&globalThis.__generator||function(e,t){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,a;return a={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function u(h){return function(y){return c([h,y])}}function c(h){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(o=h[0]&2?i.return:h[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,h[1])).done)return o;switch(i=0,o&&(h=[h[0]&2,o.value]),h[0]){case 0:case 1:o=h;break;case 4:return r.label++,{value:h[1],done:!1};case 5:r.label++,i=h[1],h=[0];continue;case 7:h=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(h[0]===6||h[0]===2)){r=0;continue}if(h[0]===3&&(!o||h[1]>o[0]&&h[1]<o[3])){r.label=h[1];break}if(h[0]===6&&r.label<o[1]){r.label=o[1],o=h;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(h);break}o[2]&&r.ops.pop(),r.trys.pop();continue}h=t.call(e,r)}catch(y){h=[6,y],i=0}finally{n=o=0}if(h[0]&5)throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}},uz=globalThis&&globalThis.__spreadArray||function(e,t){for(var r=0,n=t.length,i=e.length;r<n;r++,i++)e[i]=t[r];return e},aS=function(){function e(t){this._appliedMiddleware=[];var r=t||{};if(typeof r!="object")throw new Error(""+T9);if(r.defaultScope===void 0)r.defaultScope=gl.Transient;else if(r.defaultScope!==gl.Singleton&&r.defaultScope!==gl.Transient&&r.defaultScope!==gl.Request)throw new Error(""+C9);if(r.autoBindInjectable===void 0)r.autoBindInjectable=!1;else if(typeof r.autoBindInjectable!="boolean")throw new Error(""+M9);if(r.skipBaseClassChecks===void 0)r.skipBaseClassChecks=!1;else if(typeof r.skipBaseClassChecks!="boolean")throw new Error(""+P9);this.options={autoBindInjectable:r.autoBindInjectable,defaultScope:r.defaultScope,skipBaseClassChecks:r.skipBaseClassChecks},this.id=g_(),this._bindingDictionary=new eT,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new O9}return e.merge=function(t,r){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];var o=new e,a=uz([t,r],n).map(function(h){return gw(h)}),u=gw(o);function c(h,y){h.traverse(function(x,E){E.forEach(function(T){y.add(T.serviceIdentifier,T.clone())})})}return a.forEach(function(h){c(h,u)}),o},e.prototype.load=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];for(var n=this._getContainerModuleHelpersFactory(),i=0,o=t;i<o.length;i++){var a=o[i],u=n(a.id);a.registry(u.bindFunction,u.unbindFunction,u.isboundFunction,u.rebindFunction)}},e.prototype.loadAsync=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return oz(this,void 0,void 0,function(){var n,i,o,a,u;return sz(this,function(c){switch(c.label){case 0:n=this._getContainerModuleHelpersFactory(),i=0,o=t,c.label=1;case 1:return i<o.length?(a=o[i],u=n(a.id),[4,a.registry(u.bindFunction,u.unbindFunction,u.isboundFunction,u.rebindFunction)]):[3,4];case 2:c.sent(),c.label=3;case 3:return i++,[3,1];case 4:return[2]}})})},e.prototype.unload=function(){for(var t=this,r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i=function(o){return function(a){return a.moduleId===o}};r.forEach(function(o){var a=i(o.id);t._bindingDictionary.removeByCondition(a)})},e.prototype.bind=function(t){var r=this.options.defaultScope||gl.Transient,n=new l9(t,r);return this._bindingDictionary.add(t,n),new iz(n)},e.prototype.rebind=function(t){return this.unbind(t),this.bind(t)},e.prototype.unbind=function(t){try{this._bindingDictionary.remove(t)}catch{throw new Error(p9+" "+Hy(t))}},e.prototype.unbindAll=function(){this._bindingDictionary=new eT},e.prototype.isBound=function(t){var r=this._bindingDictionary.hasKey(t);return!r&&this.parent&&(r=this.parent.isBound(t)),r},e.prototype.isBoundNamed=function(t,r){return this.isBoundTagged(t,Fp,r)},e.prototype.isBoundTagged=function(t,r,n){var i=!1;if(this._bindingDictionary.hasKey(t)){var o=this._bindingDictionary.get(t),a=Z9(this,t,r,n);i=o.some(function(u){return u.constraint(a)})}return!i&&this.parent&&(i=this.parent.isBoundTagged(t,r,n)),i},e.prototype.snapshot=function(){this._snapshots.push(az.of(this._bindingDictionary.clone(),this._middleware))},e.prototype.restore=function(){var t=this._snapshots.pop();if(t===void 0)throw new Error(x9);this._bindingDictionary=t.bindings,this._middleware=t.middleware},e.prototype.createChild=function(t){var r=new e(t||this.options);return r.parent=this,r},e.prototype.applyMiddleware=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];this._appliedMiddleware=this._appliedMiddleware.concat(t);var n=this._middleware?this._middleware:this._planAndResolve();this._middleware=t.reduce(function(i,o){return o(i)},n)},e.prototype.applyCustomMetadataReader=function(t){this._metadataReader=t},e.prototype.get=function(t){return this._get(!1,!1,Md.Variable,t)},e.prototype.getTagged=function(t,r,n){return this._get(!1,!1,Md.Variable,t,r,n)},e.prototype.getNamed=function(t,r){return this.getTagged(t,Fp,r)},e.prototype.getAll=function(t){return this._get(!0,!0,Md.Variable,t)},e.prototype.getAllTagged=function(t,r,n){return this._get(!1,!0,Md.Variable,t,r,n)},e.prototype.getAllNamed=function(t,r){return this.getAllTagged(t,Fp,r)},e.prototype.resolve=function(t){var r=this.createChild();return r.bind(t).toSelf(),this._appliedMiddleware.forEach(function(n){r.applyMiddleware(n)}),r.get(t)},e.prototype._getContainerModuleHelpersFactory=function(){var t=this,r=function(u,c){u._binding.moduleId=c},n=function(u){return function(c){var h=t.bind.bind(t),y=h(c);return r(y,u),y}},i=function(u){return function(c){var h=t.unbind.bind(t);h(c)}},o=function(u){return function(c){var h=t.isBound.bind(t);return h(c)}},a=function(u){return function(c){var h=t.rebind.bind(t),y=h(c);return r(y,u),y}};return function(u){return{bindFunction:n(u),isboundFunction:o(),rebindFunction:a(u),unbindFunction:i()}}},e.prototype._get=function(t,r,n,i,o,a){var u=null,c={avoidConstraints:t,contextInterceptor:function(h){return h},isMultiInject:r,key:o,serviceIdentifier:i,targetType:n,value:a};if(this._middleware){if(u=this._middleware(c),u==null)throw new Error(b9)}else u=this._planAndResolve()(c);return u},e.prototype._planAndResolve=function(){var t=this;return function(r){var n=q9(t._metadataReader,t,r.isMultiInject,r.targetType,r.serviceIdentifier,r.key,r.value,r.avoidConstraints);n=r.contextInterceptor(n);var i=rz(n);return i}},e}();function Ei(){return function(e){if(Reflect.hasOwnMetadata(mw,e))throw new Error(c9);var t=Reflect.getMetadata(o9,e)||[];return Reflect.defineMetadata(mw,t,e),e}}function lz(){return function(e,t,r){var n=new Rv(Ay,t);if(Reflect.hasOwnMetadata(Ay,e.constructor))throw new Error(I9);Reflect.defineMetadata(Ay,n,e.constructor)}}var Yg=Symbol.for("INJECTION");function jx(e,t,r,n){function i(){return n&&!Reflect.hasMetadata(Yg,this,t)&&Reflect.defineMetadata(Yg,r(),this,t),Reflect.hasMetadata(Yg,this,t)?Reflect.getMetadata(Yg,this,t):r()}function o(a){Reflect.defineMetadata(Yg,a,this,t)}Object.defineProperty(e,t,{configurable:!0,enumerable:!0,get:i,set:o})}function cz(e,t){return function(r){return function(n,i){var o=function(){return e.get(r)};jx(n,i,o,t)}}}function fz(e,t){return function(r,n){return function(i,o){var a=function(){return e.getNamed(r,n)};jx(i,o,a,t)}}}function hz(e,t){return function(r,n,i){return function(o,a){var u=function(){return e.getTagged(r,n,i)};jx(o,a,u,t)}}}function pz(e,t){return function(r){return function(n,i){var o=function(){return e.getAll(r)};jx(n,i,o,t)}}}function dz(e,t){t===void 0&&(t=!0);var r=cz(e,t),n=fz(e,t),i=hz(e,t),o=pz(e,t);return{lazyInject:r,lazyInjectNamed:n,lazyInjectTagged:i,lazyMultiInject:o}}var Mt={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),IDebugService:Symbol.for("IDebugService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")},oS={exports:{}};oS.exports=y_;oS.exports.default=y_;var V0=1e20;function y_(e,t,r,n,i,o){this.fontSize=e||24,this.buffer=t===void 0?3:t,this.cutoff=n||.25,this.fontFamily=i||"sans-serif",this.fontWeight=o||"normal",this.radius=r||8;var a=this.size=this.fontSize+this.buffer*2,u=a+this.buffer*2,c=typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;c?this.canvas=my.createOffscreenCanvas(a,a,"2d"):(this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=a),this.ctx=this.canvas.getContext("2d",{willReadFrequently:!0}),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(u*u),this.gridInner=new Float64Array(u*u),this.f=new Float64Array(u),this.z=new Float64Array(u+1),this.v=new Uint16Array(u),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,c?this.middle=Math.round(a/2*1):this.middle=Math.round(a/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function vz(e,t,r,n,i,o,a){o.fill(V0,0,t*r),a.fill(0,0,t*r);for(var u=(t-n)/2,c=0;c<i;c++)for(var h=0;h<n;h++){var y=(c+u)*t+h+u,x=e.data[4*(c*n+h)+3]/255;if(x===1)o[y]=0,a[y]=V0;else if(x===0)o[y]=V0,a[y]=0;else{var E=Math.max(0,.5-x),T=Math.max(0,x-.5);o[y]=E*E,a[y]=T*T}}}function mz(e,t,r,n,i,o,a){for(var u=0;u<t*r;u++){var c=Math.sqrt(n[u])-Math.sqrt(i[u]);e[u]=Math.round(255-255*(c/o+a))}}y_.prototype._draw=function(e,t){var r=this.ctx.measureText(e),n=r.width,i=2*this.buffer,o,a,u,c,h,y,x,E;t&&this.useMetrics?(h=Math.floor(r.actualBoundingBoxAscent),E=this.buffer+Math.ceil(r.actualBoundingBoxAscent),y=this.buffer,x=this.buffer,a=Math.min(this.size,Math.ceil(r.actualBoundingBoxRight-r.actualBoundingBoxLeft)),c=Math.min(this.size-y,Math.ceil(r.actualBoundingBoxAscent+r.actualBoundingBoxDescent)),o=a+i,u=c+i,this.ctx.textBaseline="alphabetic"):(o=a=this.size,u=c=this.size,h=19*this.fontSize/24,y=x=0,E=this.middle,this.ctx.textBaseline="middle");var T;a&&c&&(this.ctx.clearRect(x,y,a,c),this.ctx.fillText(e,this.buffer,E),T=this.ctx.getImageData(x,y,a,c));var I=new Uint8ClampedArray(o*u);return vz(T,o,u,a,c,this.gridOuter,this.gridInner),tT(this.gridOuter,o,u,this.f,this.v,this.z),tT(this.gridInner,o,u,this.f,this.v,this.z),mz(I,o,u,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:I,metrics:{width:a,height:c,sdfWidth:o,sdfHeight:u,top:h,left:0,advance:n}}};y_.prototype.draw=function(e){return this._draw(e,!1).data};y_.prototype.drawWithMetrics=function(e){return this._draw(e,!0)};function tT(e,t,r,n,i,o){for(var a=0;a<t;a++)rT(e,a,t,r,n,i,o);for(var u=0;u<r;u++)rT(e,u*t,1,t,n,i,o)}function rT(e,t,r,n,i,o,a){var u,c,h,y;for(o[0]=0,a[0]=-V0,a[1]=V0,u=0;u<n;u++)i[u]=e[t+u*r];for(u=1,c=0,h=0;u<n;u++){do y=o[c],h=(i[u]-i[y]+u*u-y*y)/(u-y)/2;while(h<=a[c]&&--c>-1);c++,o[c]=u,a[c]=h,a[c+1]=V0}for(u=0,c=0;u<n;u++){for(;a[c+1]<u;)c++;y=o[c],e[t+u*r]=i[y]+(u-y)*(u-y)}}var gz=oS.exports;const yz=jc(gz);function BR(e,t){var r=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=_z(e))||t&&e&&typeof e.length=="number"){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(h){throw h},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,a=!1,u;return{s:function(){r=r.call(e)},n:function(){var h=r.next();return o=h.done,h},e:function(h){a=!0,u=h},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(a)throw u}}}}function _z(e,t){if(e){if(typeof e=="string")return nT(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return nT(e,t)}}function nT(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var qg=30;function xz(e){var t=e.characterSet,r=e.getFontWidth,n=e.fontHeight,i=e.buffer,o=e.maxCanvasWidth,a=e.mapping,u=a===void 0?{}:a,c=e.xOffset,h=c===void 0?0:c,y=e.yOffset,x=y===void 0?0:y,E=0,T=h;Array.from(t).forEach(function(k,D){if(!u[k]){var V=r(k,D);T+qg>o&&(T=0,E++),u[k]={x:T,y:x+E*qg,width:qg,height:qg,advance:V},T+=qg}});var I=n+i*2;return{mapping:u,xOffset:T,yOffset:x+E*I,canvasHeight:zR(x+(E+1)*I)}}function bz(e,t,r){var n=0,i=0,o=0,a=[],u={},c=BR(e),h;try{for(c.s();!(h=c.n()).done;){var y=h.value;if(!u[y.id]){var x=y.size;n+x+t>r&&(iT(u,a,i),n=0,i=o+i+t,o=0,a=[]),a.push({icon:y,xOffset:n}),n=n+x+t,o=Math.max(o,x)}}}catch(T){c.e(T)}finally{c.f()}a.length>0&&iT(u,a,i);var E=zR(o+i+t);return{mapping:u,canvasHeight:E}}function iT(e,t,r){var n=BR(t),i;try{for(n.s();!(i=n.n()).done;){var o=i.value,a=o.icon,u=o.xOffset;e[a.id]=_t(_t({},a),{},{x:u,y:r,image:a.image,width:a.width,height:a.height})}}catch(c){n.e(c)}finally{n.f()}}function zR(e){return Math.pow(2,Math.ceil(Math.log2(e)))}var aT,oT;function sT(e,t){var r=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=wz(e))||t&&e&&typeof e.length=="number"){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(h){throw h},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,a=!1,u;return{s:function(){r=r.call(e)},n:function(){var h=r.next();return o=h.done,h},e:function(h){a=!0,u=h},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(a)throw u}}}}function wz(e,t){if(e){if(typeof e=="string")return uT(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return uT(e,t)}}function uT(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Ez(e){var t=Sz();return function(){var n=Ct(e),i;if(t){var o=Ct(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xn(this,i)}}function Sz(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Az=Oz(),Tz="sans-serif",Cz="normal",Mz=24,Pz=3,Iz=.25,Rz=8,lT=1024,Lz=1,cT=1,kz=3;function Oz(){for(var e=[],t=32;t<128;t++)e.push(String.fromCharCode(t));return e}function fT(e,t,r,n){e.font="".concat(n," ").concat(r,"px ").concat(t),e.fillStyle="black",e.textBaseline="middle"}function hT(e,t){for(var r=0;r<e.length;r++)t.data[4*r+3]=e[r]}var Dz=(aT=Ei(),aT(oT=function(e){yn(r,e);var t=Ez(r);function r(){var n;$t(this,r);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return n=t.call.apply(t,[this].concat(o)),Q(Ye(n),"fontAtlas",void 0),Q(Ye(n),"iconFontMap",void 0),Q(Ye(n),"iconFontGlyphs",{}),Q(Ye(n),"fontOptions",void 0),Q(Ye(n),"key",void 0),Q(Ye(n),"cache",new jF(kz)),n}return Gt(r,[{key:"scale",get:function(){return cT}},{key:"canvas",get:function(){var i=this.cache.get(this.key);return i&&i.data}},{key:"mapping",get:function(){var i=this.cache.get(this.key);return i&&i.mapping||{}}},{key:"getCanvasByKey",value:function(i){var o=this.cache.get(i);return o&&o.data}},{key:"getMappingByKey",value:function(i){var o=this.cache.get(i);return o&&o.mapping||{}}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:Tz,fontWeight:Cz,characterSet:Az,fontSize:Mz,buffer:Pz,sdf:!0,cutoff:Iz,radius:Rz,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(i){var o=this;i.forEach(function(a){o.iconFontGlyphs[a.name]=a.unicode})}},{key:"addIconFont",value:function(i,o){this.iconFontMap.set(i,o)}},{key:"getIconFontKey",value:function(i){return this.iconFontMap.get(i)||i}},{key:"getGlyph",value:function(i){return this.iconFontGlyphs[i]?String.fromCharCode(parseInt(this.iconFontGlyphs[i],16)):""}},{key:"setFontOptions",value:function(i){this.fontOptions=_t(_t({},this.fontOptions),i),this.key=this.getKey();var o=this.getNewChars(this.key,this.fontOptions.characterSet),a=this.cache.get(this.key);if(!(a&&o.length===0)){var u=this.generateFontAtlas(this.key,o,a);this.fontAtlas=u,this.cache.set(this.key,u)}}},{key:"addFontFace",value:function(i,o){var a=this,u=document.createElement("style");u.type="text/css",u.innerText=`
        @font-face{
            font-family: '`.concat(i,`';
            src: url('`).concat(o,`') format('woff2'),
            url('`).concat(o,`') format('woff'),
            url('`).concat(o,`') format('truetype');
        }`),u.onload=function(){if(document.fonts)try{document.fonts.load("24px ".concat(i),"L7text"),document.fonts.ready.then(function(){a.emit("fontloaded",{fontFamily:i})})}catch{}},document.getElementsByTagName("head")[0].appendChild(u)}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(i,o,a){var u=this.fontOptions,c=u.fontFamily,h=u.fontWeight,y=u.fontSize,x=u.buffer,E=u.sdf,T=u.radius,I=u.cutoff,k=u.iconfont,D=a&&a.data;D||(D=ja.document.createElement("canvas"),D.width=lT);var V=D.getContext("2d",{willReadFrequently:!0});fT(V,c,y,h);var O=xz(_t({getFontWidth:function(mt){return V.measureText(mt).width},fontHeight:y*cT,buffer:x,characterSet:o,maxCanvasWidth:lT},a&&{mapping:a.mapping,xOffset:a.xOffset,yOffset:a.yOffset})),F=O.mapping,N=O.canvasHeight,H=O.xOffset,q=O.yOffset,Y=V.getImageData(0,0,D.width,D.height);if(D.height=N,V.putImageData(Y,0,0),fT(V,c,y,h),E){var ee=new yz(y,x,T,I,c,h),pe=V.getImageData(0,0,ee.size,ee.size),ue=sT(o),ie;try{for(ue.s();!(ie=ue.n()).done;){var xe=ie.value;if(k){var Se=String.fromCharCode(parseInt(xe.replace("&#x","").replace(";",""),16)),Ne=ee.draw(Se);hT(Ne,pe)}else hT(ee.draw(xe),pe);V.putImageData(pe,F[xe].x,F[xe].y)}}catch(it){ue.e(it)}finally{ue.f()}}else{var ze=sT(o),Be;try{for(ze.s();!(Be=ze.n()).done;){var $e=Be.value;V.fillText($e,F[$e].x,F[$e].y+y*Lz)}}catch(it){ze.e(it)}finally{ze.f()}}return{xOffset:H,yOffset:q,mapping:F,data:D,width:D.width,height:D.height}}},{key:"getKey",value:function(){var i=this.fontOptions,o=i.fontFamily,a=i.fontWeight;return"".concat(o,"_").concat(a)}},{key:"getNewChars",value:function(i,o){var a=this.cache.get(i);if(!a)return o;var u=[],c=a.mapping,h=new Set(Object.keys(c)),y=new Set(o);return y.forEach(function(x){h.has(x)||u.push(x)}),u}}]),r}(tc.EventEmitter))||oT),pT,dT;function Fz(e){var t=Nz();return function(){var n=Ct(e),i;if(t){var o=Ct(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xn(this,i)}}function Nz(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Bz=3,vT=1024,Zg=64,zz=(pT=Ei(),pT(dT=function(e){yn(r,e);var t=Fz(r);function r(){var n;$t(this,r);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return n=t.call.apply(t,[this].concat(o)),Q(Ye(n),"canvasHeight",128),Q(Ye(n),"texture",void 0),Q(Ye(n),"canvas",void 0),Q(Ye(n),"iconData",void 0),Q(Ye(n),"iconMap",void 0),Q(Ye(n),"ctx",void 0),Q(Ye(n),"loadingImageCount",0),n}return Gt(r,[{key:"isLoading",value:function(){return this.loadingImageCount===0}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=ja.document.createElement("canvas"),this.canvas.width=128,this.canvas.height=128,this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(){var n=Vt(Ce.mark(function o(a,u){var c,h;return Ce.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return c=new Image,this.loadingImageCount++,this.hasImage(a)||this.iconData.push({id:a,size:Zg}),this.updateIconMap(),x.next=6,this.loadImage(u);case 6:c=x.sent,h=this.iconData.find(function(E){return E.id===a}),h&&(h.image=c,h.width=c.width,h.height=c.height),this.update();case 10:case"end":return x.stop()}},o,this)}));function i(o,a){return n.apply(this,arguments)}return i}()},{key:"addImageMini",value:function(i,o,a){var u=this,c=a.getSceneConfig().canvas,h=c.createImage();if(this.loadingImageCount++,this.hasImage(i))throw new Error("Image Id already exists");this.iconData.push({id:i,size:Zg}),this.updateIconMap(),this.loadImageMini(o,c).then(function(y){h=y;var x=u.iconData.find(function(E){return E.id===i});x&&(x.image=h,x.width=h.width,x.height=h.height),u.update()})}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(i){return this.iconMap.hasOwnProperty(i)}},{key:"removeImage",value:function(i){this.hasImage(i)&&(this.iconData=this.iconData.filter(function(o){return o.id!==i}),delete this.iconMap[i],this.update())}},{key:"destroy",value:function(){this.removeAllListeners("imageUpdate"),this.iconData=[],this.iconMap={}}},{key:"loadImage",value:function(i){return new Promise(function(o,a){if(i instanceof HTMLImageElement){o(i);return}var u=new Image;u.crossOrigin="anonymous",u.onload=function(){o(u)},u.onerror=function(){a(new Error("Could not load image at "+i))},u.src=i instanceof File?URL.createObjectURL(i):i})}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var i=this;this.canvas.width=vT,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(function(o){var a=i.iconMap[o],u=a.x,c=a.y,h=a.image,y=a.width,x=y===void 0?64:y,E=a.height,T=E===void 0?64:E,I=Math.max(x,T),k=I/Zg,D=T/k,V=x/k;h&&i.ctx.drawImage(h,u+(Zg-V)/2,c+(Zg-D)/2,V,D)})}},{key:"updateIconMap",value:function(){var i=bz(this.iconData,Bz,vT),o=i.mapping,a=i.canvasHeight;this.iconMap=o,this.canvasHeight=a}},{key:"loadImageMini",value:function(i,o){return new Promise(function(a,u){var c=o.createImage();c.crossOrigin="anonymous",c.onload=function(){a(c)},c.onerror=function(){u(new Error("Could not load image at "+i))},c.src=i})}}]),r}(tc.EventEmitter))||dT),mT,gT,Uz=(mT=Ei(),mT(gT=function(){function e(){$t(this,e),Q(this,"viewport",void 0),Q(this,"overridedViewProjectionMatrix",void 0),Q(this,"jitteredViewProjectionMatrix",void 0),Q(this,"jitteredProjectionMatrix",void 0),Q(this,"viewMatrixInverse",void 0),Q(this,"cameraPosition",void 0)}return Gt(e,[{key:"init",value:function(){}},{key:"update",value:function(r){this.viewport=r,this.viewMatrixInverse=Tm(),ZE(this.viewMatrixInverse,r.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getModelMatrix",value:function(){return this.viewport.getModelMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var r=this.viewport.getCenter(),n=ei(r,2),i=n[0],o=n[1];return[i,o]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(r,n){return this.viewport.projectFlat(r,n)}},{key:"setViewProjectionMatrix",value:function(r){this.overridedViewProjectionMatrix=r}},{key:"jitterProjectionMatrix",value:function(r,n){var i=JI(Tm(),[r,n,0]);this.jitteredProjectionMatrix=zp(Tm(),i,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=zp(Tm(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),e}())||gT),q0;(function(e){e.TOPRIGHT="topright",e.TOPLEFT="topleft",e.BOTTOMRIGHT="bottomright",e.BOTTOMLEFT="bottomleft",e.TOPCENTER="topcenter",e.BOTTOMCENTER="bottomcenter",e.LEFTCENTER="leftcenter",e.RIGHTCENTER="rightcenter",e.LEFTTOP="lefttop",e.RIGHTTOP="righttop",e.LEFTBOTTOM="leftbottom",e.RIGHTBOTTOM="rightbottom"})(q0||(q0={}));var yT,_T;function Vz(e,t){var r=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=jz(e))||t&&e&&typeof e.length=="number"){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(h){throw h},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,a=!1,u;return{s:function(){r=r.call(e)},n:function(){var h=r.next();return o=h.done,h},e:function(h){a=!0,u=h},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(a)throw u}}}}function jz(e,t){if(e){if(typeof e=="string")return xT(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return xT(e,t)}}function xT(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var $z={topleft:"column",topright:"column",bottomright:"column",bottomleft:"column",leftcenter:"column",rightcenter:"column",topcenter:"row",bottomcenter:"row",lefttop:"row",righttop:"row",leftbottom:"row",rightbottom:"row"},Gz=(yT=Ei(),yT(_T=function(){function e(){$t(this,e),Q(this,"container",void 0),Q(this,"controlCorners",void 0),Q(this,"controlContainer",void 0),Q(this,"scene",void 0),Q(this,"mapsService",void 0),Q(this,"controls",[]),Q(this,"unAddControls",[])}return Gt(e,[{key:"init",value:function(r,n){this.container=r.container,this.scene=n,this.mapsService=n.get(Mt.IMapService),this.initControlPos()}},{key:"addControl",value:function(r,n){var i=n.get(Mt.IMapService);i.map?(r.addTo(this.scene),this.controls.push(r)):this.unAddControls.push(r)}},{key:"getControlByName",value:function(r){return this.controls.find(function(n){return n.controlOption.name===r})}},{key:"removeControl",value:function(r){var n=this.controls.indexOf(r);return n>-1&&this.controls.splice(n,1),r.remove(),this}},{key:"addControls",value:function(){var r=this;this.unAddControls.forEach(function(n){n.addTo(r.scene),r.controls.push(n)}),this.unAddControls=[]}},{key:"destroy",value:function(){var r=Vz(this.controls),n;try{for(r.s();!(n=r.n()).done;){var i=n.value;i.remove()}}catch(o){r.e(o)}finally{r.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var r=this.controlCorners={},n="l7-",i=this.controlContainer=$u("div",n+"control-container",this.container);function o(){var u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],c=u.map(function(h){return n+h}).join(" ");r[u.filter(function(h){return!["row","column"].includes(h)}).join("")]=$u("div",c,i)}function a(u){var c=u.replace(/^(top|bottom|left|right|center)/,"$1-").split("-");return[].concat(cn(c),[$z[u]])}Object.values(q0).forEach(function(u){o(a(u))}),this.checkCornerOverlap()}},{key:"clearControlPos",value:function(){for(var r in this.controlCorners)this.controlCorners[r]&&Td(this.controlCorners[r]);this.controlContainer&&Td(this.controlContainer)}},{key:"checkCornerOverlap",value:function(){var r=this,n=window.MutationObserver;if(n)for(var i=function(){var c=a[o],h=c.match(/^(top|bottom)(left|right)$/);if(h){var y=ei(h,3),x=y[1],E=y[2],T=r.controlCorners["".concat(x).concat(E)],I=new n(function(k){var D=ei(k,1),V=D[0].target;T&&(T.style[x]=V.clientHeight+"px")});I.observe(r.controlCorners["".concat(E).concat(x)],{childList:!0,attributes:!0})}},o=0,a=Object.keys(this.controlCorners);o<a.length;o++)i()}}]),e}())||_T),bT,wT,Hz=(bT=Ei(),bT(wT=function(){function e(){$t(this,e),Q(this,"container",void 0),Q(this,"scene",void 0),Q(this,"mapsService",void 0),Q(this,"markers",[]),Q(this,"markerLayers",[]),Q(this,"unAddMarkers",[]),Q(this,"unAddMarkerLayers",[])}return Gt(e,[{key:"addMarkerLayer",value:function(r){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(r),r.addTo(this.scene)):this.unAddMarkerLayers.push(r)}},{key:"removeMarkerLayer",value:function(r){r.destroy(),this.markerLayers.indexOf(r);var n=this.markerLayers.indexOf(r);n>-1&&this.markerLayers.splice(n,1)}},{key:"addMarker",value:function(r){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(r),r.addTo(this.scene)):this.unAddMarkers.push(r)}},{key:"addMarkers",value:function(){var r=this;this.unAddMarkers.forEach(function(n){n.addTo(r.scene),r.markers.push(n)}),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var r=this;this.unAddMarkerLayers.forEach(function(n){r.markerLayers.push(n),n.addTo(r.scene)}),this.unAddMarkers=[]}},{key:"removeMarker",value:function(r){r.remove(),this.markers.indexOf(r);var n=this.markers.indexOf(r);n>-1&&this.markers.splice(n,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(r){this.scene=r,this.mapsService=r.get(Mt.IMapService)}},{key:"destroy",value:function(){this.markers.forEach(function(r){r.remove()}),this.markers=[],this.markerLayers.forEach(function(r){r.destroy()}),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(r){r.destroy()}}]),e}())||wT),ET,ST,Wz=(ET=Ei(),ET(ST=function(){function e(){$t(this,e),Q(this,"scene",void 0),Q(this,"mapsService",void 0),Q(this,"popups",[]),Q(this,"unAddPopups",[])}return Gt(e,[{key:"isMarkerReady",get:function(){return this.mapsService.map&&this.mapsService.getMarkerContainer()}},{key:"removePopup",value:function(r){r!=null&&r.isOpen()&&r.remove();var n=this.popups.indexOf(r);n>-1&&this.popups.splice(n,1);var i=this.unAddPopups.indexOf(r);i>-1&&this.unAddPopups.splice(i,1)}},{key:"destroy",value:function(){this.popups.forEach(function(r){return r.remove()})}},{key:"addPopup",value:function(r){var n=this;r&&r.getOptions().autoClose&&[].concat(cn(this.popups),cn(this.unAddPopups)).forEach(function(i){i.getOptions().autoClose&&n.removePopup(i)}),this.isMarkerReady?(r.addTo(this.scene),this.popups.push(r)):this.unAddPopups.push(r),r.on("close",function(){n.removePopup(r)})}},{key:"initPopup",value:function(){var r=this;this.unAddPopups.length&&this.unAddPopups.forEach(function(n){r.addPopup(n),r.unAddPopups=[]})}},{key:"init",value:function(r){this.scene=r,this.mapsService=r.get(Mt.IMapService)}}]),e}())||ST),Lp;(function(e){e.normal="normal",e.additive="additive",e.subtractive="subtractive",e.min="min",e.max="max",e.none="none"})(Lp||(Lp={}));var Pd;(function(e){e.MULTIPLE="MULTIPLE",e.SINGLE="SINGLE"})(Pd||(Pd={}));var Z0;(function(e){e.AND="and",e.OR="or"})(Z0||(Z0={}));var Hs;(function(e){e.INIT="init",e.UPDATE="update"})(Hs||(Hs={}));var Xz={MapToken:"您正在使用 Demo 测试 Token, 生产环境务必自行注册 Token 确保服务稳定",SDK:"请确认引入了mapbox-gl api且在L7之前引入"},AT,TT,Yz={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,stencil:!0,isMini:!1,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},qz={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",maskLayers:[],enableMask:!0,maskOperation:Z0.AND,pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",activeMix:0,selectColor:"blue",selectMix:0,enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},Zz=(AT=Ei(),AT(TT=function(){function e(){$t(this,e),Q(this,"sceneConfigCache",{}),Q(this,"layerConfigCache",{}),Q(this,"layerAttributeConfigCache",{})}return Gt(e,[{key:"getSceneConfig",value:function(r){return this.sceneConfigCache[r]}},{key:"getSceneWarninfo",value:function(r){return Xz[r]}},{key:"setSceneConfig",value:function(r,n){this.sceneConfigCache[r]=_t(_t({},Yz),n)}},{key:"getLayerConfig",value:function(r){return this.layerConfigCache[r]}},{key:"setLayerConfig",value:function(r,n,i){this.layerConfigCache[n]=_t({},Er.merge({},this.sceneConfigCache[r],qz,i))}},{key:"getAttributeConfig",value:function(r){return this.layerAttributeConfigCache[r]}},{key:"setAttributeConfig",value:function(r,n){this.layerAttributeConfigCache[r]=_t(_t({},this.layerAttributeConfigCache[r]),n)}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),e}())||TT);function Gi(e,t,r,n){r&&Object.defineProperty(e,t,{enumerable:r.enumerable,configurable:r.configurable,writable:r.writable,value:r.initializer?r.initializer.call(n):void 0})}function Ui(e,t,r,n,i){var o={};return Object.keys(n).forEach(function(a){o[a]=n[a]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=r.slice().reverse().reduce(function(a,u){return u(e,t,a)||a},o),i&&o.initializer!==void 0&&(o.value=o.initializer?o.initializer.call(i):void 0,o.initializer=void 0),o.initializer===void 0&&(Object.defineProperty(e,t,o),o=null),o}var Yb=Math.PI/180,Kz=512,CT=4003e4;function MT(e){var t=e.latitude,r=t===void 0?0:t,n=e.zoom,i=n===void 0?0:n,o=e.scale,a=e.highPrecision,u=a===void 0?!1:a,c=e.flipY,h=c===void 0?!1:c;o=o!==void 0?o:Math.pow(2,i);var y={},x=Kz*o,E=Math.cos(r*Yb),T=x/360,I=T/E,k=x/CT/E;if(y.pixelsPerMeter=[k,-k,k],y.metersPerPixel=[1/k,-1/k,1/k],y.pixelsPerDegree=[T,-I,k],y.degreesPerPixel=[1/T,-1/I,1/k],u){var D=Yb*Math.tan(r*Yb)/E,V=T*D/2,O=x/CT*D,F=O/I*k;y.pixelsPerDegree2=[0,-V,O],y.pixelsPerMeter2=[F,0,F],h&&(y.pixelsPerDegree2[1]=-y.pixelsPerDegree2[1],y.pixelsPerMeter2[1]=-y.pixelsPerMeter2[1])}return h&&(y.pixelsPerMeter[1]=-y.pixelsPerMeter[1],y.metersPerPixel[1]=-y.metersPerPixel[1],y.pixelsPerDegree[1]=-y.pixelsPerDegree[1],y.degreesPerPixel[1]=-y.degreesPerPixel[1]),y}var Sv;(function(e){e[e.LNGLAT=1]="LNGLAT",e[e.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",e[e.VECTOR_TILE=3]="VECTOR_TILE",e[e.IDENTITY=4]="IDENTITY",e[e.P20=5]="P20",e[e.P20_OFFSET=6]="P20_OFFSET",e[e.METER_OFFSET=7]="METER_OFFSET",e[e.P20_2=8]="P20_2"})(Sv||(Sv={}));var vm={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"},PT,IT,RT,qb,LT,Qz=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],Jz=(PT=Ei(),IT=na(Mt.ICameraService),PT(RT=(qb=function(){function e(){$t(this,e),Q(this,"needRefresh",!0),Gi(this,"cameraService",LT,this),Q(this,"coordinateSystem",void 0),Q(this,"viewportCenter",void 0),Q(this,"viewportCenterProjection",void 0),Q(this,"pixelsPerDegree",void 0),Q(this,"pixelsPerDegree2",void 0),Q(this,"pixelsPerMeter",void 0)}return Gt(e,[{key:"refresh",value:function(r){var n=this.cameraService.getZoom(),i=this.cameraService.getZoomScale(),o=r||this.cameraService.getCenter(),a=MT({latitude:o[1],zoom:n}),u=a.pixelsPerMeter,c=a.pixelsPerDegree;this.viewportCenter=o,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=u,this.pixelsPerDegree=c,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===Sv.LNGLAT||this.coordinateSystem===Sv.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===Sv.LNGLAT_OFFSET?this.calculateLnglatOffset(o,n):this.coordinateSystem===Sv.P20_OFFSET&&this.calculateLnglatOffset(o,n,i,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(r){this.coordinateSystem=r}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(r,n,i,o){var a=MT({latitude:r[1],zoom:n,scale:i,flipY:o,highPrecision:!0}),u=a.pixelsPerMeter,c=a.pixelsPerDegree,h=a.pixelsPerDegree2,y=this.cameraService.getViewMatrix(),x=this.cameraService.getProjectionMatrix(),E=zp([],x,y),T=this.cameraService.projectFlat([Math.fround(r[0]),Math.fround(r[1])],Math.pow(2,n));this.viewportCenterProjection=JE([],[T[0],T[1],0,1],E),y=this.cameraService.getViewMatrixUncentered()||y,E=zp([],x,y),E=zp([],E,Qz),this.cameraService.setViewProjectionMatrix(E),this.pixelsPerMeter=u,this.pixelsPerDegree=c,this.pixelsPerDegree2=h}}]),e}(),LT=Ui(qb.prototype,"cameraService",[IT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qb))||RT),kT,OT;function eU(e){var t=tU();return function(){var n=Ct(e),i;if(t){var o=Ct(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xn(this,i)}}function tU(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var rU=(kT=Ei(),kT(OT=function(e){yn(r,e);var t=eU(r);function r(){var n;$t(this,r);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return n=t.call.apply(t,[this].concat(o)),Q(Ye(n),"renderMap",new Map),Q(Ye(n),"enable",!1),Q(Ye(n),"renderEnable",!1),Q(Ye(n),"cacheLogs",{}),n}return Gt(r,[{key:"setEnable",value:function(i){this.enable=!!i}},{key:"log",value:function(i,o){var a=this;if(this.enable){var u=i.split("."),c=null;u.forEach(function(h,y){c!==null?(c[h]||(c[h]={}),y!==u.length-1&&(c=c[h])):(a.cacheLogs[h]||(a.cacheLogs[h]={}),y!==u.length-1&&(c=a.cacheLogs[h])),y===u.length-1&&(c[h]=_t(_t({time:Date.now()},c[h]),o))})}}},{key:"getLog",value:function(i){var o=this;switch(qh(i)){case"string":return this.cacheLogs[i];case"object":return i.map(function(a){return o.cacheLogs[a]}).filter(function(a){return a!==void 0});case"undefined":return this.cacheLogs}}},{key:"removeLog",value:function(i){delete this.cacheLogs[i]}},{key:"generateRenderUid",value:function(){return this.renderEnable?VF():""}},{key:"renderDebug",value:function(i){this.renderEnable=i}},{key:"renderStart",value:function(i){if(!(!this.renderEnable||!this.enable)){var o=this.renderMap.get(i)||{};this.renderMap.set(i,_t(_t({},o),{},{renderUid:i,renderStart:Date.now()}))}}},{key:"renderEnd",value:function(i){if(!(!this.renderEnable||!this.enable)){var o=this.renderMap.get(i);if(o){var a=o.renderStart,u=Date.now();this.emit("renderEnd",_t(_t({},o),{},{renderEnd:u,renderDuration:u-a})),this.renderMap.delete(i)}}}},{key:"destroy",value:function(){this.cacheLogs=null,this.renderMap.clear()}}]),r}(tc.EventEmitter))||OT),UR={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(e){(function(t,r,n,i){var o=typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,a=typeof wx<"u"&&wx!==null&&(typeof wx.request<"u"||typeof wx.miniProgram<"u"),u=o||a,c=["","webkit","Moz","MS","ms","o"],h=u?"":r.createElement("div"),y="function",x=Math.round,E=Math.abs,T=Date.now;function I(se,be,Xe){return setTimeout(q(se,Xe),be)}function k(se,be,Xe){return Array.isArray(se)?(D(se,Xe[be],Xe),!0):!1}function D(se,be,Xe){var Lt;if(se)if(se.forEach)se.forEach(be,Xe);else if(se.length!==i)for(Lt=0;Lt<se.length;)be.call(Xe,se[Lt],Lt,se),Lt++;else for(Lt in se)se.hasOwnProperty(Lt)&&be.call(Xe,se[Lt],Lt,se)}function V(se,be,Xe){var Lt="DEPRECATED METHOD: "+be+`
`+Xe+` AT 
`;return function(){var xr=new Error("get-stack-trace"),Sn=xr&&xr.stack?xr.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Ci=t.console&&(t.console.warn||t.console.log);return Ci&&Ci.call(t.console,Lt,Sn),se.apply(this,arguments)}}var O;typeof Object.assign!="function"?O=function(be){if(be===i||be===null)throw new TypeError("Cannot convert undefined or null to object");for(var Xe=Object(be),Lt=1;Lt<arguments.length;Lt++){var xr=arguments[Lt];if(xr!==i&&xr!==null)for(var Sn in xr)xr.hasOwnProperty(Sn)&&(Xe[Sn]=xr[Sn])}return Xe}:O=Object.assign;var F=V(function(be,Xe,Lt){for(var xr=Object.keys(Xe),Sn=0;Sn<xr.length;)(!Lt||Lt&&be[xr[Sn]]===i)&&(be[xr[Sn]]=Xe[xr[Sn]]),Sn++;return be},"extend","Use `assign`."),N=V(function(be,Xe){return F(be,Xe,!0)},"merge","Use `assign`.");function H(se,be,Xe){var Lt=be.prototype,xr;xr=se.prototype=Object.create(Lt),xr.constructor=se,xr._super=Lt,Xe&&O(xr,Xe)}function q(se,be){return function(){return se.apply(be,arguments)}}function Y(se,be){return typeof se==y?se.apply(be&&be[0]||i,be):se}function ee(se,be){return se===i?be:se}function pe(se,be,Xe){D(Se(be),function(Lt){se.addEventListener(Lt,Xe,!1)})}function ue(se,be,Xe){D(Se(be),function(Lt){se.removeEventListener(Lt,Xe,!1)})}function ie(se,be){for(;se;){if(se==be)return!0;se=se.parentNode}return!1}function xe(se,be){return se.indexOf(be)>-1}function Se(se){return se.trim().split(/\s+/g)}function Ne(se,be,Xe){if(se.indexOf&&!Xe)return se.indexOf(be);for(var Lt=0;Lt<se.length;){if(Xe&&se[Lt][Xe]==be||!Xe&&se[Lt]===be)return Lt;Lt++}return-1}function ze(se){return Array.prototype.slice.call(se,0)}function Be(se,be,Xe){for(var Lt=[],xr=[],Sn=0;Sn<se.length;){var Ci=be?se[Sn][be]:se[Sn];Ne(xr,Ci)<0&&Lt.push(se[Sn]),xr[Sn]=Ci,Sn++}return Xe&&(be?Lt=Lt.sort(function(Oo,ts){return Oo[be]>ts[be]}):Lt=Lt.sort()),Lt}function $e(se,be){for(var Xe,Lt,xr=be[0].toUpperCase()+be.slice(1),Sn=0;Sn<c.length;){if(Xe=c[Sn],Lt=Xe?Xe+xr:be,Lt in se)return Lt;Sn++}return i}var it=1;function mt(){return it++}function Qe(se){var be=se.ownerDocument||se;return be.defaultView||be.parentWindow||t}var rt=/mobile|tablet|ip(ad|hone|od)|android/i,gt="ontouchstart"in t,er=$e(t,"PointerEvent")!==i,zt=gt&&rt.test(navigator.userAgent),qt="touch",Zr="pen",Wr="mouse",On="kinect",Ut=25,Ar=1,an=2,Ft=4,Mr=8,mn=1,Nn=2,Xn=4,qn=8,Li=16,ci=Nn|Xn,Ai=qn|Li,Vi=ci|Ai,za=["x","y"],ia=["clientX","clientY"];function X(se,be){var Xe=this;this.manager=se,this.callback=be,this.element=se.element,this.target=se.options.inputTarget,this.domHandler=function(Lt){Y(se.options.enable,[se])&&Xe.handler(Lt)},this.init()}X.prototype={handler:function(){},init:function(){this.evEl&&pe(this.element,this.evEl,this.domHandler),this.evTarget&&pe(this.target,this.evTarget,this.domHandler),this.evWin&&pe(Qe(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&ue(this.element,this.evEl,this.domHandler),this.evTarget&&ue(this.target,this.evTarget,this.domHandler),this.evWin&&ue(Qe(this.element),this.evWin,this.domHandler)}};function Ht(se){var be,Xe=se.options.inputClass;return Xe?be=Xe:er?be=Z:zt?be=Fe:gt?be=kt:be=yo,new be(se,or)}function or(se,be,Xe){var Lt=Xe.pointers.length,xr=Xe.changedPointers.length,Sn=be&Ar&&Lt-xr===0,Ci=be&(Ft|Mr)&&Lt-xr===0;Xe.isFirst=!!Sn,Xe.isFinal=!!Ci,Sn&&(se.session={}),Xe.eventType=be,Yr(se,Xe),se.emit("hammer.input",Xe),se.recognize(Xe),se.session.prevInput=Xe}function Yr(se,be){var Xe=se.session,Lt=be.pointers,xr=Lt.length;Xe.firstInput||(Xe.firstInput=Zn(be)),xr>1&&!Xe.firstMultiple?Xe.firstMultiple=Zn(be):xr===1&&(Xe.firstMultiple=!1);var Sn=Xe.firstInput,Ci=Xe.firstMultiple,Io=Ci?Ci.center:Sn.center,Oo=be.center=Hn(Lt);be.timeStamp=T(),be.deltaTime=be.timeStamp-Sn.timeStamp,be.angle=rn(Io,Oo),be.distance=wt(Io,Oo),wn(Xe,be),be.offsetDirection=di(be.deltaX,be.deltaY);var ts=Dn(be.deltaTime,be.deltaX,be.deltaY);be.overallVelocityX=ts.x,be.overallVelocityY=ts.y,be.overallVelocity=E(ts.x)>E(ts.y)?ts.x:ts.y,be.scale=Ci?Ii(Ci.pointers,Lt):1,be.rotation=Ci?En(Ci.pointers,Lt):0,be.maxPointers=Xe.prevInput?be.pointers.length>Xe.prevInput.maxPointers?be.pointers.length:Xe.prevInput.maxPointers:be.pointers.length,Qi(Xe,be);var Do=se.element;ie(be.srcEvent.target,Do)&&(Do=be.srcEvent.target),be.target=Do}function wn(se,be){var Xe=be.center,Lt=se.offsetDelta||{},xr=se.prevDelta||{},Sn=se.prevInput||{};(be.eventType===Ar||Sn.eventType===Ft)&&(xr=se.prevDelta={x:Sn.deltaX||0,y:Sn.deltaY||0},Lt=se.offsetDelta={x:Xe.x,y:Xe.y}),be.deltaX=xr.x+(Xe.x-Lt.x),be.deltaY=xr.y+(Xe.y-Lt.y)}function Qi(se,be){var Xe=se.lastInterval||be,Lt=be.timeStamp-Xe.timeStamp,xr,Sn,Ci,Io;if(be.eventType!=Mr&&(Lt>Ut||Xe.velocity===i)){var Oo=be.deltaX-Xe.deltaX,ts=be.deltaY-Xe.deltaY,Do=Dn(Lt,Oo,ts);Sn=Do.x,Ci=Do.y,xr=E(Do.x)>E(Do.y)?Do.x:Do.y,Io=di(Oo,ts),se.lastInterval=be}else xr=Xe.velocity,Sn=Xe.velocityX,Ci=Xe.velocityY,Io=Xe.direction;be.velocity=xr,be.velocityX=Sn,be.velocityY=Ci,be.direction=Io}function Zn(se){for(var be=[],Xe=0;Xe<se.pointers.length;)be[Xe]={clientX:x(se.pointers[Xe].clientX),clientY:x(se.pointers[Xe].clientY)},Xe++;return{timeStamp:T(),pointers:be,center:Hn(be),deltaX:se.deltaX,deltaY:se.deltaY}}function Hn(se){var be=se.length;if(be===1)return{x:x(se[0].clientX),y:x(se[0].clientY)};for(var Xe=0,Lt=0,xr=0;xr<be;)Xe+=se[xr].clientX,Lt+=se[xr].clientY,xr++;return{x:x(Xe/be),y:x(Lt/be)}}function Dn(se,be,Xe){return{x:be/se||0,y:Xe/se||0}}function di(se,be){return se===be?mn:E(se)>=E(be)?se<0?Nn:Xn:be<0?qn:Li}function wt(se,be,Xe){Xe||(Xe=za);var Lt=be[Xe[0]]-se[Xe[0]],xr=be[Xe[1]]-se[Xe[1]];return Math.sqrt(Lt*Lt+xr*xr)}function rn(se,be,Xe){Xe||(Xe=za);var Lt=be[Xe[0]]-se[Xe[0]],xr=be[Xe[1]]-se[Xe[1]];return Math.atan2(xr,Lt)*180/Math.PI}function En(se,be){return rn(be[1],be[0],ia)+rn(se[1],se[0],ia)}function Ii(se,be){return wt(be[0],be[1],ia)/wt(se[0],se[1],ia)}var ki={mousedown:Ar,mousemove:an,mouseup:Ft},uo="mousedown",go="mousemove mouseup";function yo(){this.evEl=uo,this.evWin=go,this.pressed=!1,X.apply(this,arguments)}H(yo,X,{handler:function(be){var Xe=ki[be.type];Xe&Ar&&be.button===0&&(this.pressed=!0),Xe&an&&be.which!==1&&(Xe=Ft),this.pressed&&(Xe&Ft&&(this.pressed=!1),this.callback(this.manager,Xe,{pointers:[be],changedPointers:[be],pointerType:Wr,srcEvent:be}))}});var Fs={pointerdown:Ar,pointermove:an,pointerup:Ft,pointercancel:Mr,pointerout:Mr},Ss={2:qt,3:Zr,4:Wr,5:On},Su="pointerdown",ha="pointermove pointerup pointercancel";!u&&t.MSPointerEvent&&!t.PointerEvent&&(Su="MSPointerDown",ha="MSPointerMove MSPointerUp MSPointerCancel");function Z(){this.evEl=Su,this.evWin=ha,X.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}H(Z,X,{handler:function(be){var Xe=this.store,Lt=!1,xr=be.type.toLowerCase().replace("ms",""),Sn=Fs[xr],Ci=Ss[be.pointerType]||be.pointerType,Io=Ci==qt,Oo=Ne(Xe,be.pointerId,"pointerId");Sn&Ar&&(be.button===0||Io)?Oo<0&&(Xe.push(be),Oo=Xe.length-1):Sn&(Ft|Mr)&&(Lt=!0),!(Oo<0)&&(Xe[Oo]=be,this.callback(this.manager,Sn,{pointers:Xe,changedPointers:[be],pointerType:Ci,srcEvent:be}),Lt&&Xe.splice(Oo,1))}});var re={touchstart:Ar,touchmove:an,touchend:Ft,touchcancel:Mr},oe="touchstart",ge="touchstart touchmove touchend touchcancel";function Le(){this.evTarget=oe,this.evWin=ge,this.started=!1,X.apply(this,arguments)}H(Le,X,{handler:function(be){var Xe=re[be.type];if(Xe===Ar&&(this.started=!0),!!this.started){var Lt=Ke.call(this,be,Xe);Xe&(Ft|Mr)&&Lt[0].length-Lt[1].length===0&&(this.started=!1),this.callback(this.manager,Xe,{pointers:Lt[0],changedPointers:Lt[1],pointerType:qt,srcEvent:be})}}});function Ke(se,be){var Xe=ze(se.touches),Lt=ze(se.changedTouches);return be&(Ft|Mr)&&(Xe=Be(Xe.concat(Lt),"identifier",!0)),[Xe,Lt]}var nt={touchstart:Ar,touchmove:an,touchend:Ft,touchcancel:Mr},de="touchstart touchmove touchend touchcancel";function Fe(){this.evTarget=de,this.targetIds={},X.apply(this,arguments)}H(Fe,X,{handler:function(be){var Xe=nt[be.type],Lt=ht.call(this,be,Xe);Lt&&this.callback(this.manager,Xe,{pointers:Lt[0],changedPointers:Lt[1],pointerType:qt,srcEvent:be})}});function ht(se,be){var Xe=ze(se.touches),Lt=this.targetIds;if(be&(Ar|an)&&Xe.length===1)return Lt[Xe[0].identifier]=!0,[Xe,Xe];var xr,Sn,Ci=ze(se.changedTouches),Io=[],Oo=this.target;if(Sn=Xe.filter(function(ts){return ie(ts.target,Oo)}),be===Ar)for(xr=0;xr<Sn.length;)Lt[Sn[xr].identifier]=!0,xr++;for(xr=0;xr<Ci.length;)Lt[Ci[xr].identifier]&&Io.push(Ci[xr]),be&(Ft|Mr)&&delete Lt[Ci[xr].identifier],xr++;if(Io.length)return[Be(Sn.concat(Io),"identifier",!0),Io]}var nr=2500,cr=25;function kt(){X.apply(this,arguments);var se=q(this.handler,this);this.touch=new Fe(this.manager,se),this.mouse=new yo(this.manager,se),this.primaryTouch=null,this.lastTouches=[]}H(kt,X,{handler:function(be,Xe,Lt){var xr=Lt.pointerType==qt,Sn=Lt.pointerType==Wr;if(!(Sn&&Lt.sourceCapabilities&&Lt.sourceCapabilities.firesTouchEvents)){if(xr)ir.call(this,Xe,Lt);else if(Sn&&nn.call(this,Lt))return;this.callback(be,Xe,Lt)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function ir(se,be){se&Ar?(this.primaryTouch=be.changedPointers[0].identifier,Sr.call(this,be)):se&(Ft|Mr)&&Sr.call(this,be)}function Sr(se){var be=se.changedPointers[0];if(be.identifier===this.primaryTouch){var Xe={x:be.clientX,y:be.clientY};this.lastTouches.push(Xe);var Lt=this.lastTouches,xr=function(){var Sn=Lt.indexOf(Xe);Sn>-1&&Lt.splice(Sn,1)};setTimeout(xr,nr)}}function nn(se){for(var be=se.srcEvent.clientX,Xe=se.srcEvent.clientY,Lt=0;Lt<this.lastTouches.length;Lt++){var xr=this.lastTouches[Lt],Sn=Math.abs(be-xr.x),Ci=Math.abs(Xe-xr.y);if(Sn<=cr&&Ci<=cr)return!0}return!1}var Dt=u?i:$e(h.style,"touchAction"),Kr=Dt!==i,Ir="compute",Dr="auto",ii="manipulation",Fr="none",fi="pan-x",Oi="pan-y",oi=Jo();function Si(se,be){this.manager=se,this.set(be)}Si.prototype={set:function(se){se==Ir&&(se=this.compute()),Kr&&this.manager.element.style&&oi[se]&&(this.manager.element.style[Dt]=se),this.actions=se.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var se=[];return D(this.manager.recognizers,function(be){Y(be.options.enable,[be])&&(se=se.concat(be.getTouchAction()))}),Ti(se.join(" "))},preventDefaults:function(se){var be=se.srcEvent,Xe=se.offsetDirection;if(this.manager.session.prevented){be.preventDefault();return}var Lt=this.actions,xr=xe(Lt,Fr)&&!oi[Fr],Sn=xe(Lt,Oi)&&!oi[Oi],Ci=xe(Lt,fi)&&!oi[fi];if(xr){var Io=se.pointers.length===1,Oo=se.distance<2,ts=se.deltaTime<250;if(Io&&Oo&&ts)return}if(!(Ci&&Sn)&&(xr||Sn&&Xe&ci||Ci&&Xe&Ai))return this.preventSrc(be)},preventSrc:function(se){this.manager.session.prevented=!0,se.preventDefault()}};function Ti(se){if(xe(se,Fr))return Fr;var be=xe(se,fi),Xe=xe(se,Oi);return be&&Xe?Fr:be||Xe?be?fi:Oi:xe(se,ii)?ii:Dr}function Jo(){if(!Kr)return!1;var se={};if(u)return se;var be=t.CSS&&t.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(Xe){se[Xe]=be?t.CSS.supports("touch-action",Xe):!0}),se}var Ni=1,Hi=2,Di=4,ti=8,vi=ti,Mo=16,As=32;function Ma(se){this.options=O({},this.defaults,se||{}),this.id=mt(),this.manager=null,this.options.enable=ee(this.options.enable,!0),this.state=Ni,this.simultaneous={},this.requireFail=[]}Ma.prototype={defaults:{},set:function(se){return O(this.options,se),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(se){if(k(se,"recognizeWith",this))return this;var be=this.simultaneous;return se=Wu(se,this),be[se.id]||(be[se.id]=se,se.recognizeWith(this)),this},dropRecognizeWith:function(se){return k(se,"dropRecognizeWith",this)?this:(se=Wu(se,this),delete this.simultaneous[se.id],this)},requireFailure:function(se){if(k(se,"requireFailure",this))return this;var be=this.requireFail;return se=Wu(se,this),Ne(be,se)===-1&&(be.push(se),se.requireFailure(this)),this},dropRequireFailure:function(se){if(k(se,"dropRequireFailure",this))return this;se=Wu(se,this);var be=Ne(this.requireFail,se);return be>-1&&this.requireFail.splice(be,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(se){return!!this.simultaneous[se.id]},emit:function(se){var be=this,Xe=this.state;function Lt(xr){be.manager.emit(xr,se)}Xe<ti&&Lt(be.options.event+Go(Xe)),Lt(be.options.event),se.additionalEvent&&Lt(se.additionalEvent),Xe>=ti&&Lt(be.options.event+Go(Xe))},tryEmit:function(se){if(this.canEmit())return this.emit(se);this.state=As},canEmit:function(){for(var se=0;se<this.requireFail.length;){if(!(this.requireFail[se].state&(As|Ni)))return!1;se++}return!0},recognize:function(se){var be=O({},se);if(!Y(this.options.enable,[this,be])){this.reset(),this.state=As;return}this.state&(vi|Mo|As)&&(this.state=Ni),this.state=this.process(be),this.state&(Hi|Di|ti|Mo)&&this.tryEmit(be)},process:function(se){},getTouchAction:function(){},reset:function(){}};function Go(se){return se&Mo?"cancel":se&ti?"end":se&Di?"move":se&Hi?"start":""}function $c(se){return se==Li?"down":se==qn?"up":se==Nn?"left":se==Xn?"right":""}function Wu(se,be){var Xe=be.manager;return Xe?Xe.get(se):se}function Wi(){Ma.apply(this,arguments)}H(Wi,Ma,{defaults:{pointers:1},attrTest:function(se){var be=this.options.pointers;return be===0||se.pointers.length===be},process:function(se){var be=this.state,Xe=se.eventType,Lt=be&(Hi|Di),xr=this.attrTest(se);return Lt&&(Xe&Mr||!xr)?be|Mo:Lt||xr?Xe&Ft?be|ti:be&Hi?be|Di:Hi:As}});function _l(){Wi.apply(this,arguments),this.pX=null,this.pY=null}H(_l,Wi,{defaults:{event:"pan",threshold:10,pointers:1,direction:Vi},getTouchAction:function(){var se=this.options.direction,be=[];return se&ci&&be.push(Oi),se&Ai&&be.push(fi),be},directionTest:function(se){var be=this.options,Xe=!0,Lt=se.distance,xr=se.direction,Sn=se.deltaX,Ci=se.deltaY;return xr&be.direction||(be.direction&ci?(xr=Sn===0?mn:Sn<0?Nn:Xn,Xe=Sn!=this.pX,Lt=Math.abs(se.deltaX)):(xr=Ci===0?mn:Ci<0?qn:Li,Xe=Ci!=this.pY,Lt=Math.abs(se.deltaY))),se.direction=xr,Xe&&Lt>be.threshold&&xr&be.direction},attrTest:function(se){return Wi.prototype.attrTest.call(this,se)&&(this.state&Hi||!(this.state&Hi)&&this.directionTest(se))},emit:function(se){this.pX=se.deltaX,this.pY=se.deltaY;var be=$c(se.direction);be&&(se.additionalEvent=this.options.event+be),this._super.emit.call(this,se)}});function Po(){Wi.apply(this,arguments)}H(Po,Wi,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Fr]},attrTest:function(se){return this._super.attrTest.call(this,se)&&(Math.abs(se.scale-1)>this.options.threshold||this.state&Hi)},emit:function(se){if(se.scale!==1){var be=se.scale<1?"in":"out";se.additionalEvent=this.options.event+be}this._super.emit.call(this,se)}});function Pa(){Ma.apply(this,arguments),this._timer=null,this._input=null}H(Pa,Ma,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Dr]},process:function(se){var be=this.options,Xe=se.pointers.length===be.pointers,Lt=se.distance<be.threshold,xr=se.deltaTime>be.time;if(this._input=se,!Lt||!Xe||se.eventType&(Ft|Mr)&&!xr)this.reset();else if(se.eventType&Ar)this.reset(),this._timer=I(function(){this.state=vi,this.tryEmit()},be.time,this);else if(se.eventType&Ft)return vi;return As},reset:function(){clearTimeout(this._timer)},emit:function(se){this.state===vi&&(se&&se.eventType&Ft?this.manager.emit(this.options.event+"up",se):(this._input.timeStamp=T(),this.manager.emit(this.options.event,this._input)))}});function es(){Wi.apply(this,arguments)}H(es,Wi,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Fr]},attrTest:function(se){return this._super.attrTest.call(this,se)&&(Math.abs(se.rotation)>this.options.threshold||this.state&Hi)}});function ga(){Wi.apply(this,arguments)}H(ga,Wi,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:ci|Ai,pointers:1},getTouchAction:function(){return _l.prototype.getTouchAction.call(this)},attrTest:function(se){var be=this.options.direction,Xe;return be&(ci|Ai)?Xe=se.overallVelocity:be&ci?Xe=se.overallVelocityX:be&Ai&&(Xe=se.overallVelocityY),this._super.attrTest.call(this,se)&&be&se.offsetDirection&&se.distance>this.options.threshold&&se.maxPointers==this.options.pointers&&E(Xe)>this.options.velocity&&se.eventType&Ft},emit:function(se){var be=$c(se.offsetDirection);be&&this.manager.emit(this.options.event+be,se),this.manager.emit(this.options.event,se)}});function hs(){Ma.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}H(hs,Ma,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[ii]},process:function(se){var be=this.options,Xe=se.pointers.length===be.pointers,Lt=se.distance<be.threshold,xr=se.deltaTime<be.time;if(this.reset(),se.eventType&Ar&&this.count===0)return this.failTimeout();if(Lt&&xr&&Xe){if(se.eventType!=Ft)return this.failTimeout();var Sn=this.pTime?se.timeStamp-this.pTime<be.interval:!0,Ci=!this.pCenter||wt(this.pCenter,se.center)<be.posThreshold;this.pTime=se.timeStamp,this.pCenter=se.center,!Ci||!Sn?this.count=1:this.count+=1,this._input=se;var Io=this.count%be.taps;if(Io===0)return this.hasRequireFailures()?(this._timer=I(function(){this.state=vi,this.tryEmit()},be.interval,this),Hi):vi}return As},failTimeout:function(){return this._timer=I(function(){this.state=As},this.options.interval,this),As},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==vi&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Fa(se,be){return be=be||{},be.recognizers=ee(be.recognizers,Fa.defaults.preset),new ac(se,be)}Fa.VERSION="2.0.7",Fa.defaults={domEvents:!1,touchAction:Ir,enable:!0,inputTarget:null,inputClass:null,preset:[[es,{enable:!1}],[Po,{enable:!1},["rotate"]],[ga,{direction:ci}],[_l,{direction:ci},["swipe"]],[hs],[hs,{event:"doubletap",taps:2},["tap"]],[Pa]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var ic=1,Ts=2;function ac(se,be){this.options=O({},Fa.defaults,be||{}),this.options.inputTarget=this.options.inputTarget||se,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=se,this.input=Ht(this),this.touchAction=new Si(this,this.options.touchAction),Ws(this,!0),D(this.options.recognizers,function(Xe){var Lt=this.add(new Xe[0](Xe[1]));Xe[2]&&Lt.recognizeWith(Xe[2]),Xe[3]&&Lt.requireFailure(Xe[3])},this)}ac.prototype={set:function(se){return O(this.options,se),se.touchAction&&this.touchAction.update(),se.inputTarget&&(this.input.destroy(),this.input.target=se.inputTarget,this.input.init()),this},stop:function(se){this.session.stopped=se?Ts:ic},recognize:function(se){var be=this.session;if(!be.stopped){this.touchAction.preventDefaults(se);var Xe,Lt=this.recognizers,xr=be.curRecognizer;(!xr||xr&&xr.state&vi)&&(xr=be.curRecognizer=null);for(var Sn=0;Sn<Lt.length;)Xe=Lt[Sn],be.stopped!==Ts&&(!xr||Xe==xr||Xe.canRecognizeWith(xr))?Xe.recognize(se):Xe.reset(),!xr&&Xe.state&(Hi|Di|ti)&&(xr=be.curRecognizer=Xe),Sn++}},get:function(se){if(se instanceof Ma)return se;for(var be=this.recognizers,Xe=0;Xe<be.length;Xe++)if(be[Xe].options.event==se)return be[Xe];return null},add:function(se){if(k(se,"add",this))return this;var be=this.get(se.options.event);return be&&this.remove(be),this.recognizers.push(se),se.manager=this,this.touchAction.update(),se},remove:function(se){if(k(se,"remove",this))return this;if(se=this.get(se),se){var be=this.recognizers,Xe=Ne(be,se);Xe!==-1&&(be.splice(Xe,1),this.touchAction.update())}return this},on:function(se,be){if(se!==i&&be!==i){var Xe=this.handlers;return D(Se(se),function(Lt){Xe[Lt]=Xe[Lt]||[],Xe[Lt].push(be)}),this}},off:function(se,be){if(se!==i){var Xe=this.handlers;return D(Se(se),function(Lt){be?Xe[Lt]&&Xe[Lt].splice(Ne(Xe[Lt],be),1):delete Xe[Lt]}),this}},emit:function(se,be){this.options.domEvents&&_o(se,be);var Xe=this.handlers[se]&&this.handlers[se].slice();if(!(!Xe||!Xe.length)){be.type=se,be.preventDefault=function(){be.srcEvent.preventDefault()};for(var Lt=0;Lt<Xe.length;)Xe[Lt](be),Lt++}},destroy:function(){this.element&&Ws(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Ws(se,be){var Xe=se.element;if(Xe.style){var Lt;D(se.options.cssProps,function(xr,Sn){Lt=$e(Xe.style,Sn),be?(se.oldCssProps[Lt]=Xe.style[Lt],Xe.style[Lt]=xr):Xe.style[Lt]=se.oldCssProps[Lt]||""}),be||(se.oldCssProps={})}}function _o(se,be){if(!u){var Xe=r.createEvent("Event");Xe.initEvent(se,!0,!0),Xe.gesture=be,be.target.dispatchEvent(Xe)}}if(!u){O(Fa,{INPUT_START:Ar,INPUT_MOVE:an,INPUT_END:Ft,INPUT_CANCEL:Mr,STATE_POSSIBLE:Ni,STATE_BEGAN:Hi,STATE_CHANGED:Di,STATE_ENDED:ti,STATE_RECOGNIZED:vi,STATE_CANCELLED:Mo,STATE_FAILED:As,DIRECTION_NONE:mn,DIRECTION_LEFT:Nn,DIRECTION_RIGHT:Xn,DIRECTION_UP:qn,DIRECTION_DOWN:Li,DIRECTION_HORIZONTAL:ci,DIRECTION_VERTICAL:Ai,DIRECTION_ALL:Vi,Manager:ac,Input:X,TouchAction:Si,TouchInput:Fe,MouseInput:yo,PointerEventInput:Z,TouchMouseInput:kt,SingleTouchInput:Le,Recognizer:Ma,AttrRecognizer:Wi,Tap:hs,Pan:_l,Swipe:ga,Pinch:Po,Rotate:es,Press:Pa,on:pe,off:ue,each:D,merge:N,extend:F,assign:O,inherit:H,bindFn:q,prefixed:$e});var ps=typeof window<"u"?window:typeof self<"u"?self:{};ps.Hammer=Fa,typeof i=="function"&&i.amd?i(function(){return Fa}):e.exports?e.exports=Fa:t[n]=Fa}})(typeof window<"u"?window:{console:null,MSPointerEvent:null,PointerEvent:null,CSS:null},document,"Hammer")})(UR);var nU=UR.exports;const Kg=jc(nU);var vl;(function(e){e.Hover="hover",e.Click="click",e.Select="select",e.Active="active",e.Drag="drag"})(vl||(vl={}));var DT,FT,NT,Zb,BT;function iU(e){var t=aU();return function(){var n=Ct(e),i;if(t){var o=Ct(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xn(this,i)}}function aU(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var oU={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},sU=(DT=Ei(),FT=na(Mt.IMapService),DT(NT=(Zb=function(e){yn(r,e);var t=iU(r);function r(){var n;$t(this,r);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return n=t.call.apply(t,[this].concat(o)),Q(Ye(n),"indragging",!1),Gi(Ye(n),"mapService",BT,Ye(n)),Q(Ye(n),"hammertime",void 0),Q(Ye(n),"lastClickTime",0),Q(Ye(n),"lastClickXY",[-1,-1]),Q(Ye(n),"clickTimer",void 0),Q(Ye(n),"$containter",void 0),Q(Ye(n),"onDrag",function(u){var c=n.interactionEvent(u);c.type=oU[c.type],c.type==="dragging"?n.indragging=!0:n.indragging=!1,n.emit(vl.Drag,c)}),Q(Ye(n),"onHammer",function(u){u.srcEvent.stopPropagation();var c=n.interactionEvent(u);n.emit(vl.Hover,c)}),Q(Ye(n),"onTouch",function(u){var c=u.touches[0];n.onHover({x:c.pageX,y:c.pageY,type:"touch"})}),Q(Ye(n),"onHover",function(u){var c=u.clientX,h=u.clientY,y=c,x=h,E=u.type,T=n.mapService.getMapContainer();if(T)if(gf)y=y-T.left-0,x=x-T.top-0;else{var I=T.getBoundingClientRect(),k=I.top,D=I.left;y=y-D-T.clientLeft,x=x-k-T.clientTop}var V=n.mapService.containerToLngLat([y,x]);if(E==="click"){if(!gf&&"ontouchstart"in document.documentElement)return;n.isDoubleTap(y,x,V);return}if(E==="touch"){n.isDoubleTap(y,x,V);return}E!=="click"&&E!=="dblclick"&&n.emit(vl.Hover,{x:y,y:x,lngLat:V,type:E,target:u})}),n}return Gt(r,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(vl.Hover)}},{key:"triggerHover",value:function(i){var o=i.x,a=i.y;this.emit(vl.Hover,{x:o,y:a})}},{key:"triggerSelect",value:function(i){this.emit(vl.Select,{featureId:i})}},{key:"triggerActive",value:function(i){this.emit(vl.Active,{featureId:i})}},{key:"handleMiniEvent",value:function(i){this.onHover({clientX:i.touches[0].pageX,clientY:i.touches[0].pageY,type:"touch"})}},{key:"addEventListenerOnMap",value:function(){var i=this.mapService.getMapContainer();if(i)if(gf)ja.document.addEventListener("touchstart",this.handleMiniEvent.bind(this));else{var o=new Kg.Manager(i);o.add(new Kg.Tap({event:"dblclick",taps:2})),o.add(new Kg.Tap({event:"click"})),o.add(new Kg.Pan({threshold:0,pointers:0})),o.add(new Kg.Press({})),o.on("dblclick click",this.onHammer),o.on("panstart panmove panend pancancel",this.onDrag),i.addEventListener("mousemove",this.onHover),i.addEventListener("mousedown",this.onHover,!0),i.addEventListener("mouseup",this.onHover),i.addEventListener("contextmenu",this.onHover),this.hammertime=o}}},{key:"removeEventListenerOnMap",value:function(){if(gf)ja.document.removeEventListener("touchstart",this.handleMiniEvent.bind(this));else{var i=this.mapService.getMapContainer();i&&(i.removeEventListener("mousemove",this.onHover),this.hammertime.off("dblclick click",this.onHammer),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),i.removeEventListener("mousedown",this.onHover),i.removeEventListener("mouseup",this.onHover),i.removeEventListener("contextmenu",this.onHover))}}},{key:"interactionEvent",value:function(i){var o=i.type,a=i.pointerType,u,c;a==="touch"?(c=Math.floor(i.pointers[0].clientY),u=Math.floor(i.pointers[0].clientX)):(c=Math.floor(i.srcEvent.y),u=Math.floor(i.srcEvent.x));var h=this.mapService.getMapContainer();if(h){var y=h.getBoundingClientRect(),x=y.top,E=y.left;u-=E,c-=x}var T=this.mapService.containerToLngLat([u,c]);return{x:u,y:c,lngLat:T,type:o,target:i.srcEvent}}},{key:"isDoubleTap",value:function(i,o,a){var u=this,c=new Date().getTime(),h="click";c-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-i)<10&&Math.abs(this.lastClickXY[1]-o)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),h="dblclick",this.emit(vl.Hover,{x:i,y:o,lngLat:a,type:h})):(this.lastClickTime=c,this.lastClickXY=[i,o],this.clickTimer=setTimeout(function(){h="click",u.emit(vl.Hover,{x:i,y:o,lngLat:a,type:h})},400))}}]),r}(Cg),BT=Ui(Zb.prototype,"mapService",[FT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zb))||NT),uU=0;function lU(e){if(gf)return null;var t=e;if(typeof e=="string"&&(t=document.getElementById(e)),t){var r=document.createElement("div");return r.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,r.id="l7-scene-".concat(uU++),r.classList.add("l7-scene"),t.appendChild(r),r}return null}function cU(e){var t,r=!0;if((e==null||(t=e.target)===null||t===void 0?void 0:t.target)instanceof HTMLElement)for(var n,i=e==null||(n=e.target)===null||n===void 0?void 0:n.target;i;){var o,a=Array.from(i.classList);if(a.includes("l7-marker")||a.includes("l7-popup")){r=!1;break}i=(o=i)===null||o===void 0?void 0:o.parentElement}return r}var ae;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.CULL_FACE=2884]="CULL_FACE",e[e.BLEND=3042]="BLEND",e[e.DITHER=3024]="DITHER",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.TEXTURE1=33985]="TEXTURE1",e[e.TEXTURE2=33986]="TEXTURE2",e[e.TEXTURE3=33987]="TEXTURE3",e[e.TEXTURE4=33988]="TEXTURE4",e[e.TEXTURE5=33989]="TEXTURE5",e[e.TEXTURE6=33990]="TEXTURE6",e[e.TEXTURE7=33991]="TEXTURE7",e[e.TEXTURE8=33992]="TEXTURE8",e[e.TEXTURE9=33993]="TEXTURE9",e[e.TEXTURE10=33994]="TEXTURE10",e[e.TEXTURE11=33995]="TEXTURE11",e[e.TEXTURE12=33996]="TEXTURE12",e[e.TEXTURE13=33997]="TEXTURE13",e[e.TEXTURE14=33998]="TEXTURE14",e[e.TEXTURE15=33999]="TEXTURE15",e[e.TEXTURE16=34e3]="TEXTURE16",e[e.TEXTURE17=34001]="TEXTURE17",e[e.TEXTURE18=34002]="TEXTURE18",e[e.TEXTURE19=34003]="TEXTURE19",e[e.TEXTURE20=34004]="TEXTURE20",e[e.TEXTURE21=34005]="TEXTURE21",e[e.TEXTURE22=34006]="TEXTURE22",e[e.TEXTURE23=34007]="TEXTURE23",e[e.TEXTURE24=34008]="TEXTURE24",e[e.TEXTURE25=34009]="TEXTURE25",e[e.TEXTURE26=34010]="TEXTURE26",e[e.TEXTURE27=34011]="TEXTURE27",e[e.TEXTURE28=34012]="TEXTURE28",e[e.TEXTURE29=34013]="TEXTURE29",e[e.TEXTURE30=34014]="TEXTURE30",e[e.TEXTURE31=34015]="TEXTURE31",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL"})(ae||(ae={}));var zT,UT,VT,jT,$T,GT,HT,mm,WT,XT,YT,qT,ZT,fU=(zT=Ei(),UT=na(Mt.IMapService),VT=na(Mt.IRendererService),jT=na(Mt.IGlobalConfigService),$T=na(Mt.IInteractionService),GT=na(Mt.ILayerService),zT(HT=(mm=function(){function e(){var t=this;$t(this,e),Q(this,"pickedColors",void 0),Q(this,"pickedTileLayers",[]),Gi(this,"mapService",WT,this),Gi(this,"rendererService",XT,this),Gi(this,"configService",YT,this),Gi(this,"interactionService",qT,this),Gi(this,"layerService",ZT,this),Q(this,"pickingFBO",void 0),Q(this,"width",0),Q(this,"height",0),Q(this,"alreadyInPicking",!1),Q(this,"pickBufferScale",1),Q(this,"pickFromPickingFBO",function(r,n){var i=n.x,o=n.y,a=n.lngLat,u=n.type,c=n.target,h=!1,y=t.rendererService,x=y.readPixels,E=y.getContainer,T=t.getContainerSize(E()),I=T.width,k=T.height;I*=ws,k*=ws;var D=r.getLayerConfig(),V=D.enableHighlight,O=D.enableSelect,F=i*ws,N=o*ws;if(F>I-1*ws||F<0||N>k-1*ws||N<0)return!1;var H=x({x:Math.floor(F/t.pickBufferScale),y:Math.floor((k-(o+1)*ws)/t.pickBufferScale),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:t.pickingFBO});if(t.pickedColors=H,H[0]!==0||H[1]!==0||H[2]!==0){var q=Pm(H),Y=r.layerPickService.getFeatureById(q);q!==r.getCurrentPickId()&&u==="mousemove"&&(u="mouseenter");var ee={x:i,y:o,type:u,lngLat:a,featureId:q,feature:Y,target:c};Y&&(h=!0,r.setCurrentPickId(q),t.triggerHoverOnLayer(r,ee))}else{var pe={x:i,y:o,lngLat:a,type:r.getCurrentPickId()!==null&&u==="mousemove"?"mouseout":"un"+u,featureId:null,target:c,feature:null};t.triggerHoverOnLayer(r,_t(_t({},pe),{},{type:"unpick"})),t.triggerHoverOnLayer(r,pe),r.setCurrentPickId(null)}if(V&&r.layerPickService.highlightPickedFeature(H),O&&u==="click"&&(H==null?void 0:H.toString())!==[0,0,0,0].toString()){var ue=Pm(H);r.getCurrentSelectedId()===null||ue!==r.getCurrentSelectedId()?(r.layerPickService.selectFeature(H),r.setCurrentSelectedId(ue)):(r.layerPickService.selectFeature(new Uint8Array([0,0,0,0])),r.setCurrentSelectedId(null))}return h})}return Gt(e,[{key:"init",value:function(r){var n=this.rendererService,i=n.createTexture2D,o=n.createFramebuffer,a=n.getContainer,u=this.getContainerSize(a()),c=u.width,h=u.height;c*=ws,h*=ws,this.pickBufferScale=this.configService.getSceneConfig(r).pickBufferScale||1,this.pickingFBO=o({color:i({width:Math.round(c/this.pickBufferScale),height:Math.round(h/this.pickBufferScale),wrapS:ae.CLAMP_TO_EDGE,wrapT:ae.CLAMP_TO_EDGE})}),this.interactionService.on(vl.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:function(){var t=Vt(Ce.mark(function n(i,o,a){var u=this,c,h,y;return Ce.wrap(function(E){for(;;)switch(E.prev=E.next){case 0:c=this.rendererService,h=c.useFramebuffer,y=c.clear,this.resizePickingFBO(),h(this.pickingFBO,function(){y({framebuffer:u.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),i.hooks.beforePickingEncode.call(),i.renderModels({ispick:!0}),i.hooks.afterPickingEncode.call();var T=u.pickBox(i,o);a(T)});case 3:case"end":return E.stop()}},n,this)}));function r(n,i,o){return t.apply(this,arguments)}return r}()},{key:"pickBox",value:function(r,n){var i=this,o=n.map(function(ue){var ie=ue<0?0:ue;return Math.floor(ie*ws/i.pickBufferScale)}),a=ei(o,4),u=a[0],c=a[1],h=a[2],y=a[3],x=this.rendererService,E=x.readPixels,T=x.getContainer,I=this.getContainerSize(T()),k=I.width,D=I.height;if(k*=ws,D*=ws,u>(k-1)*ws/this.pickBufferScale||h<0||c>(D-1)*ws/this.pickBufferScale||y<0)return[];for(var V=Math.min(k/this.pickBufferScale,h)-u,O=Math.min(D/this.pickBufferScale,y)-c,F=E({x:u,y:Math.floor(D/this.pickBufferScale-(y+1)),width:V,height:O,data:new Uint8Array(V*O*4),framebuffer:this.pickingFBO}),N=[],H={},q=0;q<F.length/4;q=q+1){var Y=F.slice(q*4,q*4+4),ee=Pm(Y);if(ee!==-1&&!H[ee]){var pe=r.layerPickService.getFeatureById(ee);N.push(_t(_t({},pe),{},{pickedFeatureIdx:ee})),H[ee]=!0}}return N}},{key:"handleCursor",value:function(r,n){var i=r.getLayerConfig(),o=i.cursor,a=o===void 0?"":o,u=i.cursorEnabled;if(u){var c=this.mapService.version,h=c==="GAODE2.x"?this.mapService.getMapContainer():this.mapService.getMarkerContainer(),y=h==null?void 0:h.style.getPropertyValue("cursor");n==="unmousemove"&&y!==""?h==null||h.style.setProperty("cursor",""):n==="mousemove"&&(h==null||h.style.setProperty("cursor",a))}}},{key:"destroy",value:function(){this.pickingFBO.destroy(),this.pickingFBO=null}},{key:"getContainerSize",value:function(r){return r.getContext?{width:r.width/ws,height:r.height/ws}:r.getBoundingClientRect()}},{key:"pickingAllLayer",value:function(){var t=Vt(Ce.mark(function n(i){return Ce.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(!(!this.layerService.needPick(i.type)||!this.isPickingAllLayer())){a.next=2;break}return a.abrupt("return");case 2:return this.alreadyInPicking=!0,a.next=5,this.pickingLayers(i);case 5:this.layerService.renderLayers(),this.alreadyInPicking=!1;case 7:case"end":return a.stop()}},n,this)}));function r(n){return t.apply(this,arguments)}return r}()},{key:"isPickingAllLayer",value:function(){return!(this.alreadyInPicking||this.layerService.alreadyInRendering||this.interactionService.indragging||!this.layerService.getShaderPickStat())}},{key:"resizePickingFBO",value:function(){var r=this.rendererService.getContainer,n=this.getContainerSize(r()),i=n.width,o=n.height;i*=ws,o*=ws,(this.width!==i||this.height!==o)&&(this.pickingFBO.resize({width:Math.round(i/this.pickBufferScale),height:Math.round(o/this.pickBufferScale)}),this.width=i,this.height=o)}},{key:"pickingLayers",value:function(){var t=Vt(Ce.mark(function n(i){var o=this,a,u,c;return Ce.wrap(function(y){for(;;)switch(y.prev=y.next){case 0:a=this.rendererService,u=a.useFramebuffer,c=a.clear,this.resizePickingFBO(),u(this.pickingFBO,function(){var x=o.layerService.getRenderList();x.filter(function(E){return E.needPick(i.type)}).reverse().some(function(E){c({framebuffer:o.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),E.layerPickService.pickRender(i);var T=o.pickFromPickingFBO(E,i);return o.layerService.pickedLayerId=T?+E.id:-1,T&&!E.getLayerConfig().enablePropagation})});case 3:case"end":return y.stop()}},n,this)}));function r(n){return t.apply(this,arguments)}return r}()},{key:"triggerHoverOnLayer",value:function(r,n){cU(n)&&(this.handleCursor(r,n.type),r.emit(n.type,n))}}]),e}(),WT=Ui(mm.prototype,"mapService",[UT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),XT=Ui(mm.prototype,"rendererService",[VT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),YT=Ui(mm.prototype,"configService",[jT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qT=Ui(mm.prototype,"interactionService",[$T],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ZT=Ui(mm.prototype,"layerService",[GT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mm))||HT),hU=function(){function e(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;$t(this,e),Q(this,"autoStart",void 0),Q(this,"startTime",0),Q(this,"oldTime",0),Q(this,"running",!1),Q(this,"elapsedTime",0),this.autoStart=t}return Gt(e,[{key:"start",value:function(){this.startTime=(typeof performance>"u"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var r=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var n=(typeof performance>"u"?Date:performance).now();r=(n-this.oldTime)/1e3,this.oldTime=n,this.elapsedTime+=r}return r}}]),e}(),KT,QT,JT,e3,t3,Qg,r3,n3,i3;function Kb(e,t){var r=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=pU(e))||t&&e&&typeof e.length=="number"){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(h){throw h},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,a=!1,u;return{s:function(){r=r.call(e)},n:function(){var h=r.next();return o=h.done,h},e:function(h){a=!0,u=h},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(a)throw u}}}}function pU(e,t){if(e){if(typeof e=="string")return a3(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return a3(e,t)}}function a3(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function dU(e){var t=vU();return function(){var n=Ct(e),i;if(t){var o=Ct(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xn(this,i)}}function vU(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var mU=(KT=Ei(),QT=na(Mt.IRendererService),JT=na(Mt.IMapService),e3=na(Mt.IDebugService),KT(t3=(Qg=function(e){yn(r,e);var t=dU(r);function r(){var n;$t(this,r);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return n=t.call.apply(t,[this].concat(o)),Q(Ye(n),"pickedLayerId",-1),Q(Ye(n),"clock",new hU),Q(Ye(n),"alreadyInRendering",!1),Q(Ye(n),"layers",[]),Q(Ye(n),"layerList",[]),Q(Ye(n),"layerRenderID",void 0),Q(Ye(n),"sceneInited",!1),Q(Ye(n),"animateInstanceCount",0),Q(Ye(n),"shaderPicking",!0),Q(Ye(n),"enableRender",!0),Gi(Ye(n),"renderService",r3,Ye(n)),Gi(Ye(n),"mapService",n3,Ye(n)),Gi(Ye(n),"debugService",i3,Ye(n)),Q(Ye(n),"reRender",Er.throttle(function(){n.renderLayers()},32)),Q(Ye(n),"throttleRenderLayers",Er.throttle(function(){n.renderLayers()},16)),n}return Gt(r,[{key:"needPick",value:function(i){return this.layerList.some(function(o){return o.needPick(i)})}},{key:"add",value:function(i){var o=this;this.layers.push(i),this.sceneInited&&i.init().then(function(){o.renderLayers()})}},{key:"addMask",value:function(i){var o=this;this.sceneInited&&i.init().then(function(){o.renderLayers()})}},{key:"initLayers",value:function(){var n=Vt(Ce.mark(function o(){var a=this;return Ce.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:this.sceneInited=!0,this.layers.forEach(function(){var h=Vt(Ce.mark(function y(x){return Ce.wrap(function(T){for(;;)switch(T.prev=T.next){case 0:if(x.startInit){T.next=4;break}return T.next=3,x.init();case 3:a.updateLayerRenderList();case 4:case"end":return T.stop()}},y)}));return function(y){return h.apply(this,arguments)}}());case 2:case"end":return c.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getSceneInited",value:function(){return this.sceneInited}},{key:"getRenderList",value:function(){return this.layerList}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(i){return this.layers.find(function(o){return o.id===i})}},{key:"getLayerByName",value:function(i){return this.layers.find(function(o){return o.name===i})}},{key:"remove",value:function(){var n=Vt(Ce.mark(function o(a,u){var c,h;return Ce.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:u?(c=u.layerChildren.indexOf(a),c>-1&&u.layerChildren.splice(c,1)):(h=this.layers.indexOf(a),h>-1&&this.layers.splice(h,1)),a.destroy(),this.reRender(),this.emit("layerChange",this.layers);case 4:case"end":return x.stop()}},o,this)}));function i(o,a){return n.apply(this,arguments)}return i}()},{key:"removeAllLayers",value:function(){var n=Vt(Ce.mark(function o(){return Ce.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:this.destroy(),this.reRender();case 2:case"end":return u.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"setEnableRender",value:function(i){this.enableRender=i}},{key:"renderLayers",value:function(){var n=Vt(Ce.mark(function o(){var a,u,c,h,y,x;return Ce.wrap(function(T){for(;;)switch(T.prev=T.next){case 0:if(!(this.alreadyInRendering||!this.enableRender)){T.next=2;break}return T.abrupt("return");case 2:this.updateLayerRenderList(),a=this.debugService.generateRenderUid(),this.debugService.renderStart(a),this.alreadyInRendering=!0,this.clear(),u=Kb(this.layerList),T.prev=8,u.s();case 10:if((c=u.n()).done){T.next=23;break}if(h=c.value,y=h.getLayerConfig(),x=y.enableMask,h.masks.filter(function(I){return I.inited}).length>0&&x&&this.renderMask(h.masks),!h.getLayerConfig().enableMultiPassRenderer){T.next=19;break}return T.next=17,h.renderMultiPass();case 17:T.next=21;break;case 19:return T.next=21,h.render();case 21:T.next=10;break;case 23:T.next=28;break;case 25:T.prev=25,T.t0=T.catch(8),u.e(T.t0);case 28:return T.prev=28,u.f(),T.finish(28);case 31:this.debugService.renderEnd(a),this.alreadyInRendering=!1;case 33:case"end":return T.stop()}},o,this,[[8,25,28,31]])}));function i(){return n.apply(this,arguments)}return i}()},{key:"renderMask",value:function(i){var o=0;this.renderService.clear({stencil:0,depth:1,framebuffer:null});var a=i.length>1?Pd.MULTIPLE:Pd.SINGLE,u=Kb(i),c;try{for(u.s();!(c=u.n()).done;){var h=c.value;h.render({isStencil:!0,stencilType:a,stencilIndex:o++})}}catch(y){u.e(y)}finally{u.f()}}},{key:"beforeRenderData",value:function(){var n=Vt(Ce.mark(function o(a){var u;return Ce.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,a.hooks.beforeRenderData.promise();case 2:u=h.sent,u&&this.renderLayers();case 4:case"end":return h.stop()}},o,this)}));function i(o){return n.apply(this,arguments)}return i}()},{key:"renderTileLayerMask",value:function(i){var o=0,a=i.getLayerConfig(),u=a.enableMask,c=u===void 0?!0:u,h=i.tileMask?1:0,y=i.masks.filter(function(k){return k.inited});h=h+(c?y.length:1);var x=h>1?Pd.MULTIPLE:Pd.SINGLE;if((i.tileMask||y.length&&c)&&this.renderService.clear({stencil:0,depth:1,framebuffer:null}),y.length&&c){var E=Kb(y),T;try{for(E.s();!(T=E.n()).done;){var I=T.value;I.render({isStencil:!0,stencilType:x,stencilIndex:o++})}}catch(k){E.e(k)}finally{E.f()}}i.tileMask&&i.tileMask.render({isStencil:!0,stencilType:x,stencilIndex:o++,stencilOperation:Z0.OR})}},{key:"renderTileLayer",value:function(){var n=Vt(Ce.mark(function o(a){return Ce.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(this.renderTileLayerMask(a),!a.getLayerConfig().enableMultiPassRenderer){c.next=6;break}return c.next=4,a.renderMultiPass();case 4:c.next=8;break;case 6:return c.next=8,a.render();case 8:case"end":return c.stop()}},o,this)}));function i(o){return n.apply(this,arguments)}return i}()},{key:"updateLayerRenderList",value:function(){var i=this;this.layerList=[],this.layers.filter(function(o){return o.inited}).filter(function(o){return o.isVisible()}).sort(function(o,a){return o.zIndex-a.zIndex}).forEach(function(o){i.layerList.push(o)})}},{key:"destroy",value:function(){this.layers.forEach(function(i){i.destroy()}),this.layers=[],this.layerList=[],this.emit("layerChange",this.layers)}},{key:"startAnimate",value:function(){this.animateInstanceCount++===0&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){--this.animateInstanceCount===0&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"enableShaderPick",value:function(){this.shaderPicking=!0}},{key:"disableShaderPick",value:function(){this.shaderPicking=!1}},{key:"getShaderPickStat",value:function(){return this.shaderPicking}},{key:"clear",value:function(){var i=Da(this.mapService.bgColor);this.renderService.clear({color:i,depth:1,stencil:0,framebuffer:null})}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=ja.requestAnimationFrame(this.runRender.bind(this))}},{key:"stopRender",value:function(){ja.cancelAnimationFrame(this.layerRenderID)}}]),r}(tc.EventEmitter),r3=Ui(Qg.prototype,"renderService",[QT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n3=Ui(Qg.prototype,"mapService",[JT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),i3=Ui(Qg.prototype,"debugService",[e3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qg))||t3);function gU(e,t){if(e==null)return{};var r={},n=Object.keys(e),i,o;for(o=0;o<n.length;o++)i=n[o],!(t.indexOf(i)>=0)&&(r[i]=e[i]);return r}function Zh(e,t){if(e==null)return{};var r=gU(e,t),n,i;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var yU=function(){function e(t){var r=this;$t(this,e),Q(this,"name",void 0),Q(this,"type",void 0),Q(this,"scale",void 0),Q(this,"descriptor",void 0),Q(this,"featureBufferLayout",[]),Q(this,"needRescale",!1),Q(this,"needRemapping",!1),Q(this,"needRegenerateVertices",!1),Q(this,"featureRange",{startIndex:0,endIndex:1/0}),Q(this,"vertexAttribute",void 0),Q(this,"defaultCallback",function(n){if(n.length===0){var i;return((i=r.scale)===null||i===void 0?void 0:i.defaultValues)||[]}return n.map(function(o,a){var u,c=(u=r.scale)===null||u===void 0?void 0:u.scalers[a].func,h=c(o);return h})}),this.setProps(t)}return Gt(e,[{key:"setProps",value:function(r){Object.assign(this,r)}},{key:"mapping",value:function(r){var n;if((n=this.scale)!==null&&n!==void 0&&n.callback){var i,o=(i=this.scale)===null||i===void 0?void 0:i.callback.apply(i,cn(r));if(!Er.isNil(o))return[o]}return this.defaultCallback(r)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),e}(),_U=["buffer","update","name"],xU=["buffer","update","name"],Jg,o3,s3,u3,Qb,l3,bU=(Jg={},Q(Jg,ae.FLOAT,4),Q(Jg,ae.UNSIGNED_BYTE,1),Q(Jg,ae.UNSIGNED_SHORT,2),Jg),wU=(o3=Ei(),s3=na(Mt.IRendererService),o3(u3=(Qb=function(){function e(){$t(this,e),Q(this,"attributesAndIndices",void 0),Gi(this,"rendererService",l3,this),Q(this,"attributes",[]),Q(this,"triangulation",void 0),Q(this,"featureLayout",{sizePerElement:0,elements:[]})}return Gt(e,[{key:"registerStyleAttribute",value:function(r){var n=this.getLayerStyleAttribute(r.name||"");return n?n.setProps(r):(n=new yU(r),this.attributes.push(n)),n}},{key:"unRegisterStyleAttribute",value:function(r){var n=this.attributes.findIndex(function(i){return i.name===r});n>-1&&this.attributes.splice(n,1)}},{key:"updateScaleAttribute",value:function(r){this.attributes.forEach(function(n){var i,o=n.name,a=(i=n.scale)===null||i===void 0?void 0:i.field;(r[o]||a&&r[a])&&(n.needRescale=!0,n.needRemapping=!0,n.needRegenerateVertices=!0)})}},{key:"updateStyleAttribute",value:function(r,n,i){var o=this.getLayerStyleAttribute(r);o||(o=this.registerStyleAttribute(_t(_t({},n),{},{name:r})));var a=n.scale;a&&o&&(o.scale=a,o.needRescale=!0,o.needRemapping=!0,o.needRegenerateVertices=!0,i&&i.featureRange&&(o.featureRange=i.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(r){return this.attributes.find(function(n){return n.name===r})}},{key:"getLayerAttributeScale",value:function(r){var n,i=this.getLayerStyleAttribute(r),o=i==null||(n=i.scale)===null||n===void 0?void 0:n.scalers;return o&&o[0]?o[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(r,n){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,o=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0,u=this.attributes.find(function(H){return H.name===r});if(u&&u.descriptor){var c=u.descriptor,h=c.update,y=c.buffer,x=c.size,E=x===void 0?0:x,T=bU[y.type||ae.FLOAT];if(h){var I=this.featureLayout,k=I.elements,D=I.sizePerElement,V=k.slice(i,o);if(!V.length)return;var O=V[0].offset,F=O*E*T,N=V.map(function(H,q){for(var Y=H.featureIdx,ee=H.vertices,pe=H.normals,ue=ee.length/D,ie=[],xe=0;xe<ue;xe++){var Se=pe?pe.slice(xe*3,xe*3+3):[];ie.push.apply(ie,cn(h(n[Y],Y,ee.slice(xe*D,xe*D+D),q,Se)))}return ie}).reduce(function(H,q){return H.push.apply(H,cn(q)),H},[]);u.vertexAttribute.updateBuffer({data:N,offset:F}),a==null||a.emit("legend:".concat(r),{type:r,attr:u})}}}},{key:"createAttributesAndIndices",value:function(r,n,i){var o=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var a=this.attributes.map(function(V){return V.resetDescriptor(),V.descriptor}),u=0,c=0,h=[],y=3;r.forEach(function(V,O){var F=o.triangulation(V,i),N=F.indices,H=F.vertices,q=F.normals,Y=F.size,ee=F.indexes,pe=F.count;typeof pe=="number"&&(c+=pe),N.forEach(function(Se){h.push(Se+u)}),y=Y;var ue=H.length/Y;o.featureLayout.sizePerElement=y,o.featureLayout.elements.push({featureIdx:O,vertices:H,normals:q,offset:u}),u+=ue;for(var ie=function(Ne){var ze=(q==null?void 0:q.slice(Ne*3,Ne*3+3))||[],Be=H.slice(Ne*Y,Ne*Y+Y),$e=0;ee&&ee[Ne]!==void 0&&($e=ee[Ne]),a.forEach(function(it,mt){if(it&&it.update){var Qe;(Qe=it.buffer.data).push.apply(Qe,cn(it.update(V,O,Be,Ne,ze,$e)))}})},xe=0;xe<ue;xe++)ie(xe)});var x=this.rendererService,E=x.createAttribute,T=x.createBuffer,I=x.createElements,k={};a.forEach(function(V,O){if(V){var F=V.buffer;V.update,V.name;var N=Zh(V,_U),H=E(_t({buffer:T(F)},N));k[V.name||""]=H,o.attributes[O].vertexAttribute=H}});var D=I({data:h,type:ae.UNSIGNED_INT,count:h.length});return this.attributesAndIndices={attributes:k,elements:D,count:c},this.attributesAndIndices}},{key:"createAttributes",value:function(r,n){var i=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var o=this.attributes.map(function(E){return E.resetDescriptor(),E.descriptor}),a=0,u=3;r.forEach(function(E,T){var I=i.triangulation(E),k=I.indices,D=I.vertices,V=I.normals,O=I.size,F=I.indexes;k.forEach(function(Y){}),u=O;var N=D.length/O;i.featureLayout.sizePerElement=u,i.featureLayout.elements.push({featureIdx:T,vertices:D,normals:V,offset:a}),a+=N;for(var H=function(ee){var pe=(V==null?void 0:V.slice(ee*3,ee*3+3))||[],ue=D.slice(ee*O,ee*O+O),ie=0;F&&F[ee]!==void 0&&(ie=F[ee]),o.forEach(function(xe,Se){if(xe&&xe.update){var Ne;(Ne=xe.buffer.data).push.apply(Ne,cn(xe.update(E,T,ue,ee,pe,ie)))}})},q=0;q<N;q++)H(q)});var c=this.rendererService,h=c.createAttribute,y=c.createBuffer,x={};return o.forEach(function(E,T){if(E){var I=E.buffer;E.update,E.name;var k=Zh(E,xU),D=h(_t({buffer:y(I)},k));x[E.name||""]=D,i.attributes[T].vertexAttribute=D}}),{attributes:x}}},{key:"clearAllAttributes",value:function(){var r;this.attributes.forEach(function(n){n.vertexAttribute&&n.vertexAttribute.destroy()}),(r=this.attributesAndIndices)===null||r===void 0||r.elements.destroy(),this.attributes=[]}}]),e}(),l3=Ui(Qb.prototype,"rendererService",[s3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qb))||u3);function VR(e,t,r,n){function i(o){return o instanceof r?o:new r(function(a){a(o)})}return new(r||(r=Promise))(function(o,a){function u(y){try{h(n.next(y))}catch(x){a(x)}}function c(y){try{h(n.throw(y))}catch(x){a(x)}}function h(y){y.done?o(y.value):i(y.value).then(u,c)}h((n=n.apply(e,t||[])).next())})}function jR(e,t){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,a;return a={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function u(h){return function(y){return c([h,y])}}function c(h){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(o=h[0]&2?i.return:h[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,h[1])).done)return o;switch(i=0,o&&(h=[h[0]&2,o.value]),h[0]){case 0:case 1:o=h;break;case 4:return r.label++,{value:h[1],done:!1};case 5:r.label++,i=h[1],h=[0];continue;case 7:h=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(h[0]===6||h[0]===2)){r=0;continue}if(h[0]===3&&(!o||h[1]>o[0]&&h[1]<o[3])){r.label=h[1];break}if(h[0]===6&&r.label<o[1]){r.label=o[1],o=h;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(h);break}o[2]&&r.ops.pop(),r.trys.pop();continue}h=t.call(e,r)}catch(y){h=[6,y],i=0}finally{n=o=0}if(h[0]&5)throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}}function sS(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),i,o=[],a;try{for(;(t===void 0||t-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(u){a={error:u}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(a)throw a.error}}return o}function uS(e,t,r){if(r||arguments.length===2)for(var n=0,i=t.length,o;n<i;n++)(o||!(n in t))&&(o||(o=Array.prototype.slice.call(t,0,n)),o[n]=t[n]);return e.concat(o||Array.prototype.slice.call(t))}function $R(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var _w={exports:{}},Z1={exports:{}},Xy={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=r;function r(n){return n&&typeof n.length=="number"&&n.length>=0&&n.length%1===0}e.exports=t.default})(Xy,Xy.exports);var zc={},xw={exports:{}},bw={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(r){return function(){for(var n=[],i=arguments.length;i--;)n[i]=arguments[i];var o=n.pop();return r.call(this,n,o)}},e.exports=t.default})(bw,bw.exports);var Fv={};Object.defineProperty(Fv,"__esModule",{value:!0});Fv.fallback=GR;Fv.wrap=HR;var EU=Fv.hasQueueMicrotask=typeof queueMicrotask=="function"&&queueMicrotask,SU=Fv.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,AU=Fv.hasNextTick=typeof process=="object"&&typeof process.nextTick=="function";function GR(e){setTimeout(e,0)}function HR(e){return function(t){for(var r=[],n=arguments.length-1;n-- >0;)r[n]=arguments[n+1];return e(function(){return t.apply(void 0,r)})}}var gy;EU?gy=queueMicrotask:SU?gy=setImmediate:AU?gy=process.nextTick:gy=GR;Fv.default=HR(gy);(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=c;var r=bw.exports,n=u(r),i=Fv,o=u(i),a=zc;function u(x){return x&&x.__esModule?x:{default:x}}function c(x){return(0,a.isAsync)(x)?function(){for(var E=[],T=arguments.length;T--;)E[T]=arguments[T];var I=E.pop(),k=x.apply(this,E);return h(k,I)}:(0,n.default)(function(E,T){var I;try{I=x.apply(this,E)}catch(k){return T(k)}if(I&&typeof I.then=="function")return h(I,T);T(null,I)})}function h(x,E){return x.then(function(T){y(E,null,T)},function(T){y(E,T&&T.message?T:new Error(T))})}function y(x,E,T){try{x(E,T)}catch(I){(0,o.default)(function(k){throw k},I)}}e.exports=t.default})(xw,xw.exports);Object.defineProperty(zc,"__esModule",{value:!0});zc.isAsyncIterable=zc.isAsyncGenerator=zc.isAsync=void 0;var TU=xw.exports,CU=MU(TU);function MU(e){return e&&e.__esModule?e:{default:e}}function WR(e){return e[Symbol.toStringTag]==="AsyncFunction"}function PU(e){return e[Symbol.toStringTag]==="AsyncGenerator"}function IU(e){return typeof e[Symbol.asyncIterator]=="function"}function RU(e){if(typeof e!="function")throw new Error("expected a function");return WR(e)?(0,CU.default)(e):e}zc.default=RU;zc.isAsync=WR;zc.isAsyncGenerator=PU;zc.isAsyncIterable=IU;var Om={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=r;function r(n,i){if(i===void 0&&(i=n.length),!i)throw new Error("arity is undefined");function o(){for(var a=this,u=[],c=arguments.length;c--;)u[c]=arguments[c];return typeof u[i-1]=="function"?n.apply(this,u):new Promise(function(h,y){u[i-1]=function(x){for(var E=[],T=arguments.length-1;T-- >0;)E[T]=arguments[T+1];if(x)return y(x);h(E.length>1?E:E[0])},n.apply(a,u)})}return o}e.exports=t.default})(Om,Om.exports);(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=Xy.exports,n=c(r),i=zc,o=c(i),a=Om.exports,u=c(a);function c(h){return h&&h.__esModule?h:{default:h}}t.default=(0,u.default)(function(h,y,x){var E=(0,n.default)(y)?[]:{};h(y,function(T,I,k){(0,o.default)(T)(function(D){for(var V,O=[],F=arguments.length-1;F-- >0;)O[F]=arguments[F+1];O.length<2&&(V=O,O=V[0]),E[I]=O,k(D)})},function(T){return x(T,E)})},3),e.exports=t.default})(Z1,Z1.exports);var ww={exports:{}},K1={exports:{}},Ew={exports:{}},Yy={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=r;function r(n){function i(){for(var o=[],a=arguments.length;a--;)o[a]=arguments[a];if(n!==null){var u=n;n=null,u.apply(this,o)}}return Object.assign(i,n),i}e.exports=t.default})(Yy,Yy.exports);var Sw={exports:{}},Aw={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(r){return r[Symbol.iterator]&&r[Symbol.iterator]()},e.exports=t.default})(Aw,Aw.exports);(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=y;var r=Xy.exports,n=a(r),i=Aw.exports,o=a(i);function a(x){return x&&x.__esModule?x:{default:x}}function u(x){var E=-1,T=x.length;return function(){return++E<T?{value:x[E],key:E}:null}}function c(x){var E=-1;return function(){var I=x.next();return I.done?null:(E++,{value:I.value,key:E})}}function h(x){var E=x?Object.keys(x):[],T=-1,I=E.length;return function k(){var D=E[++T];return D==="__proto__"?k():T<I?{value:x[D],key:D}:null}}function y(x){if((0,n.default)(x))return u(x);var E=(0,o.default)(x);return E?c(E):h(x)}e.exports=t.default})(Sw,Sw.exports);var qy={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=r;function r(n){return function(){for(var i=[],o=arguments.length;o--;)i[o]=arguments[o];if(n===null)throw new Error("Callback was already called.");var a=n;n=null,a.apply(this,i)}}e.exports=t.default})(qy,qy.exports);var Tw={exports:{}},Zy={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r={};t.default=r,e.exports=t.default})(Zy,Zy.exports);(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=o;var r=Zy.exports,n=i(r);function i(a){return a&&a.__esModule?a:{default:a}}function o(a,u,c,h){var y=!1,x=!1,E=!1,T=0,I=0;function k(){T>=u||E||y||(E=!0,a.next().then(function(O){var F=O.value,N=O.done;if(!(x||y)){if(E=!1,N){y=!0,T<=0&&h(null);return}T++,c(F,I,D),I++,k()}}).catch(V))}function D(O,F){if(T-=1,!x){if(O)return V(O);if(O===!1){y=!0,x=!0;return}if(F===n.default||y&&T<=0)return y=!0,h(null);k()}}function V(O){x||(E=!1,y=!0,h(O))}k()}e.exports=t.default})(Tw,Tw.exports);(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=Yy.exports,n=T(r),i=Sw.exports,o=T(i),a=qy.exports,u=T(a),c=zc,h=Tw.exports,y=T(h),x=Zy.exports,E=T(x);function T(I){return I&&I.__esModule?I:{default:I}}t.default=function(I){return function(k,D,V){if(V=(0,n.default)(V),I<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!k)return V(null);if((0,c.isAsyncGenerator)(k))return(0,y.default)(k,I,D,V);if((0,c.isAsyncIterable)(k))return(0,y.default)(k[Symbol.asyncIterator](),I,D,V);var O=(0,o.default)(k),F=!1,N=!1,H=0,q=!1;function Y(pe,ue){if(!N)if(H-=1,pe)F=!0,V(pe);else if(pe===!1)F=!0,N=!0;else{if(ue===E.default||F&&H<=0)return F=!0,V(null);q||ee()}}function ee(){for(q=!0;H<I&&!F;){var pe=O();if(pe===null){F=!0,H<=0&&V(null);return}H+=1,D(pe.value,pe.key,(0,u.default)(Y))}q=!1}ee()}},e.exports=t.default})(Ew,Ew.exports);(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=Ew.exports,n=c(r),i=zc,o=c(i),a=Om.exports,u=c(a);function c(y){return y&&y.__esModule?y:{default:y}}function h(y,x,E,T){return(0,n.default)(x)(y,(0,o.default)(E),T)}t.default=(0,u.default)(h,4),e.exports=t.default})(K1,K1.exports);(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=K1.exports,n=a(r),i=Om.exports,o=a(i);function a(c){return c&&c.__esModule?c:{default:c}}function u(c,h,y){return(0,n.default)(c,1,h,y)}t.default=(0,o.default)(u,3),e.exports=t.default})(ww,ww.exports);(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=u;var r=Z1.exports,n=a(r),i=ww.exports,o=a(i);function a(c){return c&&c.__esModule?c:{default:c}}function u(c,h){return(0,n.default)(o.default,c,h)}e.exports=t.default})(_w,_w.exports);var $x=$R(_w.exports),Rp=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.call=function(){for(var t=arguments,r=[],n=0;n<arguments.length;n++)r[n]=t[n];return this.args=r,$x(this.tasks)},e.prototype.tap=function(t,r){var n=this;this.tasks.push(function(i){r.apply(void 0,uS([],sS(n.args),!1)),i(null,t)})},e}(),c3={exports:{}},Cw={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=Xy.exports,n=D(r),i=Zy.exports,o=D(i),a=K1.exports,u=D(a),c=Yy.exports,h=D(c),y=qy.exports,x=D(y),E=zc,T=D(E),I=Om.exports,k=D(I);function D(N){return N&&N.__esModule?N:{default:N}}function V(N,H,q){q=(0,h.default)(q);var Y=0,ee=0,pe=N.length,ue=!1;pe===0&&q(null);function ie(xe,Se){xe===!1&&(ue=!0),ue!==!0&&(xe?q(xe):(++ee===pe||Se===o.default)&&q(null))}for(;Y<pe;Y++)H(N[Y],Y,(0,x.default)(ie))}function O(N,H,q){return(0,u.default)(N,1/0,H,q)}function F(N,H,q){var Y=(0,n.default)(N)?V:O;return Y(N,(0,T.default)(H),q)}t.default=(0,k.default)(F,3),e.exports=t.default})(Cw,Cw.exports);(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=u;var r=Cw.exports,n=a(r),i=Z1.exports,o=a(i);function a(c){return c&&c.__esModule?c:{default:c}}function u(c,h){return(0,o.default)(n.default,c,h)}e.exports=t.default})(c3,c3.exports);var Mw={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=Yy.exports,n=y(r),i=qy.exports,o=y(i),a=zc,u=y(a),c=Om.exports,h=y(c);function y(E){return E&&E.__esModule?E:{default:E}}function x(E,T){if(T=(0,n.default)(T),!Array.isArray(E))return T(new Error("First argument to waterfall must be an array of functions"));if(!E.length)return T();var I=0;function k(V){var O=(0,u.default)(E[I++]);O.apply(void 0,V.concat([(0,o.default)(D)]))}function D(V){for(var O=[],F=arguments.length-1;F-- >0;)O[F]=arguments[F+1];if(V!==!1){if(V||I===E.length)return T.apply(void 0,[V].concat(O));k(O)}}k([])}t.default=(0,h.default)(x),e.exports=t.default})(Mw,Mw.exports);var LU=$R(Mw.exports),f3=function(){function e(){this.tasks=[]}return e.prototype.call=function(){return $x(this.tasks)},e.prototype.tap=function(t,r){this.tasks.push(function(n){var i=r();n(i,t)})},e}(),kU=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.promise=function(){for(var t=arguments,r=[],n=0;n<arguments.length;n++)r[n]=t[n];return this.args=r,$x(this.tasks)},e.prototype.tapPromise=function(t,r){var n=this;this.tasks.push(function(i){return VR(n,void 0,void 0,function(){return jR(this,function(o){switch(o.label){case 0:return[4,r.apply(void 0,uS([],sS(this.args),!1))];case 1:return o.sent(),i(null,t),[2]}})})})},e}(),OU=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.promise=function(){for(var t=arguments,r=[],n=0;n<arguments.length;n++)r[n]=t[n];return this.args=r,$x(this.tasks)},e.prototype.tapPromise=function(t,r){var n=this;this.tasks.push(function(i){return VR(n,void 0,void 0,function(){var o;return jR(this,function(a){switch(a.label){case 0:return[4,r.apply(void 0,uS([],sS(this.args),!1))];case 1:return o=a.sent(),i(o,t),[2]}})})})},e}(),DU=function(){function e(){this.tasks=[]}return e.prototype.promise=function(){return LU(this.tasks)},e.prototype.tapPromise=function(t,r){this.tasks.length===0?this.tasks.push(function(n){r().then(function(i){n(null,i)})}):this.tasks.push(function(n,i){r(n).then(function(o){i(null,o)})})},e}(),lS={exports:{}};function Q1(e){var t=e.target||e.srcElement;t.__resizeRAF__&&cancelAnimationFrame(t.__resizeRAF__),t.__resizeRAF__=requestAnimationFrame(function(){var r=t.__resizeTrigger__,n=r&&r.__resizeListeners__;n&&n.forEach(function(i){i.call(r,e)})})}var h3=function(t,r){var n=this,i=n.document,o,a=i.attachEvent;typeof navigator<"u"&&(o=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/));function u(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",Q1)}if(!t.__resizeListeners__)if(t.__resizeListeners__=[],a)t.__resizeTrigger__=t,t.attachEvent("onresize",Q1);else{getComputedStyle(t).position==="static"&&(t.style.position="relative");var c=t.__resizeTrigger__=i.createElement("object");c.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),c.setAttribute("class","resize-sensor"),c.setAttribute("tabindex","-1"),c.setAttribute("title",""),c.__resizeElement__=t,c.onload=u,c.type="text/html",o&&t.appendChild(c),c.data="about:blank",o||t.appendChild(c)}t.__resizeListeners__.push(r)};lS.exports=typeof window>"u"?h3:h3.bind(window);var FU=lS.exports.unbind=function(e,t){var r=document.attachEvent,n=e.__resizeListeners__||[];if(t){var i=n.indexOf(t);i!==-1&&n.splice(i,1)}else n=e.__resizeListeners__=[];if(!n.length){if(r)e.detachEvent("onresize",Q1);else if(e.__resizeTrigger__){var o=e.__resizeTrigger__.contentDocument,a=o&&o.defaultView;a&&(a.removeEventListener("resize",Q1),delete a.__resizeTrigger__),e.__resizeTrigger__=!e.removeChild(e.__resizeTrigger__)}delete e.__resizeListeners__}},NU=lS.exports;const BU=jc(NU);var p3,d3,v3,m3,g3,y3,_3,x3,b3,w3,E3,S3,A3,T3,C3,M3,P3,I3,zu,R3,L3,k3,O3,D3,F3,N3,B3,z3,U3,V3,j3,$3,G3,H3,W3;function zU(e){var t=UU();return function(){var n=Ct(e),i;if(t){var o=Ct(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xn(this,i)}}function UU(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var VU=(p3=Ei(),d3=na(Mt.SceneID),v3=na(Mt.IIconService),m3=na(Mt.IFontService),g3=na(Mt.IControlService),y3=na(Mt.IGlobalConfigService),_3=na(Mt.IMapService),x3=na(Mt.ICoordinateSystemService),b3=na(Mt.IRendererService),w3=na(Mt.ILayerService),E3=na(Mt.IDebugService),S3=na(Mt.ICameraService),A3=na(Mt.IInteractionService),T3=na(Mt.IPickingService),C3=na(Mt.IShaderModuleService),M3=na(Mt.IMarkerService),P3=na(Mt.IPopupService),p3(I3=(zu=function(e){yn(r,e);var t=zU(r);function r(){var n;return $t(this,r),n=t.call(this),Q(Ye(n),"destroyed",!1),Q(Ye(n),"loaded",!1),Gi(Ye(n),"id",R3,Ye(n)),Gi(Ye(n),"iconService",L3,Ye(n)),Gi(Ye(n),"fontService",k3,Ye(n)),Gi(Ye(n),"controlService",O3,Ye(n)),Gi(Ye(n),"configService",D3,Ye(n)),Gi(Ye(n),"map",F3,Ye(n)),Gi(Ye(n),"coordinateSystemService",N3,Ye(n)),Gi(Ye(n),"rendererService",B3,Ye(n)),Gi(Ye(n),"layerService",z3,Ye(n)),Gi(Ye(n),"debugService",U3,Ye(n)),Gi(Ye(n),"cameraService",V3,Ye(n)),Gi(Ye(n),"interactionService",j3,Ye(n)),Gi(Ye(n),"pickingService",$3,Ye(n)),Gi(Ye(n),"shaderModuleService",G3,Ye(n)),Gi(Ye(n),"markerService",H3,Ye(n)),Gi(Ye(n),"popupService",W3,Ye(n)),Q(Ye(n),"inited",!1),Q(Ye(n),"initPromise",void 0),Q(Ye(n),"rendering",!1),Q(Ye(n),"$container",void 0),Q(Ye(n),"canvas",void 0),Q(Ye(n),"markerContainer",void 0),Q(Ye(n),"hooks",void 0),Q(Ye(n),"handleWindowResized",function(){n.emit("resize"),n.$container&&(n.initContainer(),AF(),n.coordinateSystemService.needRefresh=!0,n.render())}),Q(Ye(n),"handleMapCameraChanged",function(i){n.cameraService.update(i),n.render()}),n.hooks={init:new kU},n}return Gt(r,[{key:"init",value:function(i){var o=this;this.configService.setSceneConfig(this.id,i),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return o.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",Vt(Ce.mark(function a(){return Ce.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return o.debugService.log("map.mapInitStart",{type:o.map.version}),c.next=3,new Promise(function(h){o.map.onCameraChanged(function(y){o.cameraService.init(),o.cameraService.update(y),h()}),o.map.init()});case 3:o.map.onCameraChanged(o.handleMapCameraChanged),o.map.addMarkerContainer(),o.markerService.addMarkers(),o.markerService.addMarkerLayers(),o.popupService.initPopup(),o.interactionService.init(),o.interactionService.on(vl.Drag,o.addSceneEvent.bind(o));case 10:case"end":return c.stop()}},a)}))),this.hooks.init.tapPromise("initRenderer",Vt(Ce.mark(function a(){var u,c;return Ce.wrap(function(y){for(;;)switch(y.prev=y.next){case 0:if(u=o.map.getOverlayContainer(),u?o.$container=u:o.$container=lU(o.configService.getSceneConfig(o.id).id||""),!o.$container){y.next=13;break}return o.canvas=$u("canvas","",o.$container),o.setCanvas(),y.next=7,o.rendererService.init(o.canvas,o.configService.getSceneConfig(o.id),i.gl);case 7:o.registerContextLost(),o.initContainer(),BU(o.$container,o.handleWindowResized),ja.matchMedia&&((c=ja.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)"))===null||c===void 0||c.addListener(o.handleWindowResized)),y.next=14;break;case 13:case 14:o.pickingService.init(o.id);case 15:case"end":return y.stop()}},a)}))),this.render()}},{key:"registerContextLost",value:function(){var i=this,o=this.rendererService.getCanvas();o&&o.addEventListener("webglcontextlost",function(){return i.emit("webglcontextlost")})}},{key:"initMiniScene",value:function(i){var o=this;this.configService.setSceneConfig(this.id,i),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return o.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",Vt(Ce.mark(function a(){return Ce.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,new Promise(function(h){o.map.onCameraChanged(function(y){o.cameraService.init(),o.cameraService.update(y),o.map.version!=="GAODE2.x"&&h()}),o.map.initMiniMap()});case 2:o.map.onCameraChanged(o.handleMapCameraChanged),o.interactionService.init(),o.interactionService.on(vl.Drag,o.addSceneEvent.bind(o));case 5:case"end":return c.stop()}},a)}))),this.hooks.init.tapPromise("initRenderer",Vt(Ce.mark(function a(){var u;return Ce.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:if(u=i.canvas,o.$container=u||null,!o.$container){h.next=7;break}return h.next=5,o.rendererService.init(i.canvas,o.configService.getSceneConfig(o.id),void 0);case 5:h.next=8;break;case 7:case 8:o.pickingService.init(o.id);case 9:case"end":return h.stop()}},a)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(i){this.layerService.sceneService=this,this.layerService.add(i)}},{key:"addMask",value:function(i){this.layerService.sceneService=this,this.layerService.addMask(i)}},{key:"render",value:function(){var n=Vt(Ce.mark(function o(){return Ce.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(!(this.rendering||this.destroyed)){u.next=2;break}return u.abrupt("return");case 2:if(this.rendering=!0,this.inited){u.next=16;break}return u.next=6,this.hooks.init.promise();case 6:return this.destroyed&&this.destroy(),u.next=9,this.layerService.initLayers();case 9:this.layerService.renderLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0,u.next=20;break;case 16:return u.next=18,this.layerService.initLayers();case 18:return u.next=20,this.layerService.renderLayers();case 20:this.rendering=!1;case 21:case"end":return u.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"addFontFace",value:function(i,o){this.fontService.addFontFace(i,o)}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(){var n=Vt(Ce.mark(function o(a){var u,c,h;return Ce.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return c=(u=this.$container)===null||u===void 0?void 0:u.getElementsByTagName("canvas")[0],x.next=3,this.render();case 3:return h=a==="jpg"?c==null?void 0:c.toDataURL("image/jpeg"):c==null?void 0:c.toDataURL("image/png"),x.abrupt("return",h);case 5:case"end":return x.stop()}},o,this)}));function i(o){return n.apply(this,arguments)}return i}()},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"getPointSizeRange",value:function(){return this.rendererService.getPointSizeRange()}},{key:"addMarkerContainer",value:function(){var i=this.$container.parentElement;i!==null&&(this.markerContainer=$u("div","l7-marker-container",i))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){var i=this,o,a;if(!this.inited){this.destroyed=!0;return}if(FU(this.$container,this.handleWindowResized),ja.matchMedia){var u;(u=ja.matchMedia("screen and (min-resolution: 2dppx)"))===null||u===void 0||u.removeListener(this.handleWindowResized)}this.pickingService.destroy(),this.layerService.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.fontService.destroy(),this.iconService.destroy(),this.removeAllListeners(),this.inited=!1,this.map.destroy(),setTimeout(function(){var c;(c=i.$container)===null||c===void 0||c.removeChild(i.canvas),i.canvas=null,i.rendererService.destroy()}),(o=this.$container)===null||o===void 0||(a=o.parentNode)===null||a===void 0||a.removeChild(this.$container),this.emit("destroy")}},{key:"initContainer",value:function(){var i,o,a=ws,u=((i=this.$container)===null||i===void 0?void 0:i.clientWidth)||400,c=((o=this.$container)===null||o===void 0?void 0:o.clientHeight)||300,h=this.canvas;h&&(h.width=u*a,h.height=c*a),this.rendererService.viewport({x:0,y:0,width:a*u,height:a*c})}},{key:"setCanvas",value:function(){var i,o,a=ws,u=((i=this.$container)===null||i===void 0?void 0:i.clientWidth)||400,c=((o=this.$container)===null||o===void 0?void 0:o.clientHeight)||300,h=this.canvas;h.width=u*a,h.height=c*a,h.style.width="100%",h.style.height="100%"}},{key:"addSceneEvent",value:function(i){this.emit(i.type,i)}}]),r}(tc.EventEmitter),R3=Ui(zu.prototype,"id",[d3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),L3=Ui(zu.prototype,"iconService",[v3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),k3=Ui(zu.prototype,"fontService",[m3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),O3=Ui(zu.prototype,"controlService",[g3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D3=Ui(zu.prototype,"configService",[y3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),F3=Ui(zu.prototype,"map",[_3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),N3=Ui(zu.prototype,"coordinateSystemService",[x3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),B3=Ui(zu.prototype,"rendererService",[b3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),z3=Ui(zu.prototype,"layerService",[w3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),U3=Ui(zu.prototype,"debugService",[E3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),V3=Ui(zu.prototype,"cameraService",[S3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),j3=Ui(zu.prototype,"interactionService",[A3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$3=Ui(zu.prototype,"pickingService",[T3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),G3=Ui(zu.prototype,"shaderModuleService",[C3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H3=Ui(zu.prototype,"markerService",[M3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),W3=Ui(zu.prototype,"popupService",[P3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zu))||I3);function jU(e){var t=0;switch(e){case"vec2":case"ivec2":t=2;break;case"vec3":case"ivec3":t=3;break;case"vec4":case"ivec4":case"mat2":t=4;break;case"mat3":t=9;break;case"mat4":t=16;break}return t}var $U=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function Jb(e){var t={};return e=e.replace($U,function(r,n,i){var o=i.split(":"),a=o[0].trim(),u="";switch(o.length>1&&(u=o[1].trim()),n){case"bool":u=u==="true";break;case"float":case"int":u=Number(u);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":u?u=u.replace("[","").replace("]","").split(",").reduce(function(c,h){return c.push(Number(h.trim())),c},[]):u=new Array(jU(n)).fill(0);break}return t[a]=u,"uniform ".concat(n," ").concat(a,`;
`)}),{content:e,uniforms:t}}var X3,Y3,q3="#define PI 3.14159265359",GU=`#ifdef USE_ATTRIBUTE_OPACITY
  attribute float a_Opacity;
#endif

#ifdef USE_ATTRIBUTE_OFFSETS
  attribute vec2 a_Offsets;
#endif

#ifdef USE_ATTRIBUTE_STROKE
  attribute vec4 a_Stroke;
#endif`,HU=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,WU=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,XU=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}

// vec3 calc_spot_light(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {
//   vec3 lightDir = normalize(light.position - fragPos);
//   // diffuse shading
//   float diff = max(dot(normal, lightDir), 0.0);
//   // specular shading
//   vec3 reflectDir = reflect(-lightDir, normal);
//   float spec = pow(max(dot(viewDir, reflectDir), 0.0), SHININESS);
//   // attenuation
//   float distance = length(light.position - fragPos);
//   float attenuation = 1.0 / (light.constant + light.linear * distance +
//           light.quadratic * (distance * distance));

//   vec3 ambient = light.ambient * u_Ambient;
//   vec3 diffuse = light.diffuse * diff * u_Diffuse;
//   vec3 specular = light.specular * spec * u_Specular;

//   float spotEffect = dot(normalize(light.direction), -lightDir);
//   float spotCosCutoff = cos(light.angle / 180.0 * PI);
//   float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);
//   float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);
//   if (spotEffect > spotCosCutoff) {
//     spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);
//   } else {
//     spotEffect = 0.0;
//   }

//   return ambient + attenuation * (spotEffect * diffuse + specular);
// }

vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  // for (int i = 0; i < MAX_NUM_OF_SPOT_LIGHTS; i++) {
  //   if (i >= u_NumOfSpotLights) {
  //     break;
  //   }
  //   weight += calc_spot_light(u_SpotLights[i], normal, position, viewDir);
  // }
  return weight;
}
`,YU=`float opacity = u_opacity;

#ifdef USE_ATTRIBUTE_OPACITY
    opacity = a_Opacity;
#endif`,qU=`varying vec4 v_PickingResult;
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_shaderPick;

uniform float u_activeMix: 0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define HIGHLIGHT 1.0
#define SELECT 2.0

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color, float weight) {
  // float selected = v_PickingResult.a;
  bool selected = bool(v_PickingResult.a);

  // if (selected == SELECT) {
  if (selected) {
  //   // 点击选中状态
  //   vec4 selectColor = u_SelectColor * COLOR_SCALE;
  //   return selectColor;
  // } else if (selected == HIGHLIGHT) {
  //   // hover 高亮状态
    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;

    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));

    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(mix(resultRGB * weight, color.rgb, u_activeMix), color.a);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  // 过滤多余的 shader 计算
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // 暂时去除 直接取消计算在选中时拖拽地图会有问题
  } else {
    return filterPickingColor(filterHighlightColor(color, 1.0));
  }
  
}

vec4 filterColorAlpha(vec4 color, float alpha) {
  // 过滤多余的 shader 计算
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // 暂时去除 直接取消计算在选中时拖拽地图会有问题
  } else {
    return filterPickingColor(filterHighlightColor(color, alpha));
  }
}

`,ZU=`attribute vec3 a_PickingColor;
varying vec4 v_PickingResult;

uniform vec3 u_PickingColor : [0, 0, 0];
uniform vec3 u_CurrentSelectedId : [0, 0, 0];
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_PickingThreshold : 1.0;
uniform float u_PickingBuffer: 0.0;
uniform float u_shaderPick;
uniform float u_EnableSelect: 0.0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define NORMAL 0.0
#define HIGHLIGHT 1.0
#define SELECT 2.0

bool isVertexPicked(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;
}

// 判断当前点是否已经被 select 选中
bool isVertexSelected(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_CurrentSelectedId.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_CurrentSelectedId.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_CurrentSelectedId.b) < u_PickingThreshold;
}

void setPickingColor(vec3 pickingColor) {
  if(u_shaderPick < 0.5) {
    return;
  }
  // compares only in highlight stage

  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));

  // if (u_EnableSelect == 1.0 && u_PickingStage == PICKING_HIGHLIGHT && isVertexSelected(pickingColor)) {
  //   // 选中态
  //   v_PickingResult.a = SELECT;
  // } else if (u_PickingStage == PICKING_HIGHLIGHT && isVertexPicked(pickingColor)) {
  //   // 高亮态
  //   v_PickingResult.a = HIGHLIGHT;
  // } else {
  //   v_PickingResult.a = NORMAL;
  // }

  // Stores the picking color so that the fragment shader can render it during picking
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,KU=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // 经纬度 => 平面坐标
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // 平面坐标 => 经纬度
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,QU=`#define TILE_SIZE 512.0
#define PI 3.1415926536
#define WORLD_SCALE TILE_SIZE / (PI * 2.0)

#define COORDINATE_SYSTEM_LNGLAT 1.0        // mapbox
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0 // mapbox offset
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0           // amap
#define COORDINATE_SYSTEM_P20_OFFSET 6.0    // amap offset
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0         // amap2.0

uniform mat4 u_ViewMatrix;
uniform mat4 u_ProjectionMatrix;
uniform mat4 u_ViewProjectionMatrix;
uniform float u_Zoom : 1;
uniform float u_ZoomScale : 1;

uniform float u_CoordinateSystem;
uniform vec2 u_ViewportCenter;
uniform vec4 u_ViewportCenterProjection;
uniform vec3 u_PixelsPerDegree;
uniform vec3 u_PixelsPerDegree2;
uniform vec3 u_PixelsPerMeter;

uniform vec2 u_ViewportSize;
uniform float u_DevicePixelRatio;
uniform float u_FocalDistance;
uniform vec3 u_CameraPosition;

// uniform mat4 u_Mvp;

// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
  float x = lnglat.x;
  return vec2(
    radians(x) + PI,
    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))
  );
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}


// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1., 1.);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01
    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}
// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01
// reverse Y
vec3 reverse_offset_normal(vec3 vector) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {
    return vector * vec3(1.0, -1.0, 1.0);
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return vector;
  }
  return vector;
}

vec4 project_mvt_offset_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return project_offset(vec4(0.0, 0.0, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }
  return position;
}

vec4 project_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(vec4(X, Y, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return vec4(
      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),
      project_scale(position.z),
      position.w
    );
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // return vec4(
    //   (position.xy * WORLD_SCALE * u_ZoomScale) * vec2(1., -1.), 
    //   project_scale(position.z), 
    //   position.w);

     return vec4(
      position.xy, 
      project_scale(position.z), 
      position.w);
  }
  return position;

  // TODO: 瓦片坐标系 & 常规世界坐标系
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}

float project_pixel_allmap(float pixel) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    return pixel * pow(2.0, u_Zoom);
  }
  return pixel * u_FocalDistance ;
}

// 适配纹理贴图的等像素大小
float project_pixel_texture(float pixel) {
  // mapbox zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    return pixel * pow(0.5, u_Zoom) * u_FocalDistance ;
  }

  // amap2 zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))* u_FocalDistance ;
  }

  // amap zoom > 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return pixel * pow(0.5, u_Zoom)* u_FocalDistance ;
  }
  
  // amap zoom < 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return pixel * pow(2.0, (20.0 - u_Zoom))* u_FocalDistance ;
  }
  return pixel * 2.0 *  u_FocalDistance;;
}

// 在不论什么底图下需要统一处理的时候使用
float project_float_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // mapbox P20 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减1
    return pixel * pow(2.0, (19.0 - u_Zoom))  * u_FocalDistance ;
  }
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))* u_FocalDistance ;
  }
  return pixel * u_FocalDistance;
}

float project_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减1
    return pixel * pow(2.0, (19.0 - u_Zoom)) * u_FocalDistance ;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom)) * u_FocalDistance ;
  }
  return pixel * u_FocalDistance;
}
vec2 project_pixel(vec2 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减1
    return pixel * pow(2.0, (19.0 - u_Zoom)) * u_FocalDistance ;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom)) * u_FocalDistance ;
  }
  return pixel * -1. * u_FocalDistance;
}
vec3 project_pixel(vec3 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减1
    return pixel * pow(2.0, (19.0 - u_Zoom)) *  u_FocalDistance ;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))  * u_FocalDistance ;
  }
  return pixel * -1. * u_FocalDistance;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
     pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}


bool isEqual( float a,  float b) {
    return  a< b + 0.001 && a > b - 0.001;
}`,JU=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,eV=/precision\s+(high|low|medium)p\s+float/,tV=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,rV=/#pragma include (["^+"]?["[a-zA-Z_0-9](.*)"]*?)/g,nV=/void\s+main\s*\([^)]*\)\s*\{\n?/,iV=(X3=Ei(),X3(Y3=function(){function e(){$t(this,e),Q(this,"moduleCache",{}),Q(this,"rawContentCache",{})}return Gt(e,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:q3,fs:q3}),this.registerModule("decode",{vs:HU,fs:""}),this.registerModule("projection",{vs:QU,fs:""}),this.registerModule("project",{vs:KU,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:JU}),this.registerModule("lighting",{vs:XU,fs:""}),this.registerModule("light",{vs:WU,fs:""}),this.registerModule("picking",{vs:ZU,fs:qU}),this.registerModule("commom_attr_vert",{vs:GU,fs:""}),this.registerModule("opacity_attr_vert",{vs:YU,fs:""})}},{key:"registerModule",value:function(r,n){var i=n.vs,o=n.fs,a=n.uniforms,u=n.inject,c=Jb(i),h=c.content,y=c.uniforms,x=Jb(o),E=x.content,T=x.uniforms;this.rawContentCache[r]={fs:E,inject:u,uniforms:_t(_t(_t({},y),T),a),vs:h}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(r){var n=this,i=this.rawContentCache[r].vs,o=this.rawContentCache[r].fs,a=this.rawContentCache[r].inject,u={};a!=null&&a["vs:#decl"]&&(i=(a==null?void 0:a["vs:#decl"])+i,u=Jb(a==null?void 0:a["vs:#decl"]).uniforms),a!=null&&a["vs:#main-start"]&&(i=i.replace(nV,function(D){return D+(a==null?void 0:a["vs:#main-start"])}));var c=this.processModule(i,[],"vs"),h=c.content,y=c.includeList,x=this.processModule(o,[],"fs"),E=x.content,T=x.includeList,I="",k=Er.uniq(y.concat(T).concat(r)).reduce(function(D,V){return _t(_t({},D),n.rawContentCache[V].uniforms)},_t({},u));return eV.test(E)||(I=I+tV),I=I+E,this.moduleCache[r]={fs:I.trim(),uniforms:k,vs:h.trim()},this.moduleCache[r]}},{key:"processModule",value:function(r,n,i){var o=this,a=r.replace(rV,function(u,c){var h=c.split(" "),y=h[0].replace(/"/g,"");if(n.indexOf(y)>-1)return"";var x=o.rawContentCache[y][i];n.push(y);var E=o.processModule(x,n,i),T=E.content;return T});return{content:a,includeList:n}}},{key:"injectDefines",value:function(r){var n=Object.keys(r).reduce(function(i,o){return i+"#define ".concat(o.toUpperCase()," ").concat(r[o],`;
`)},`
`);return n}}]),e}())||Y3);function aV(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&(e=Ct(e),e!==null););return e}function Cv(){return typeof Reflect<"u"&&Reflect.get?Cv=Reflect.get.bind():Cv=function(t,r,n){var i=aV(t,r);if(i){var o=Object.getOwnPropertyDescriptor(i,r);return o.get?o.get.call(arguments.length<3?t:n):o.value}},Cv.apply(this,arguments)}var Lv;(function(e){e.Normal="normal",e.PostProcessing="post-processing"})(Lv||(Lv={}));var Z3,K3,Gx=(Z3=Ei(),Z3(K3=function(){function e(){$t(this,e),Q(this,"shaderModuleService",void 0),Q(this,"rendererService",void 0),Q(this,"cameraService",void 0),Q(this,"mapService",void 0),Q(this,"interactionService",void 0),Q(this,"layerService",void 0),Q(this,"config",void 0)}return Gt(e,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return Lv.Normal}},{key:"init",value:function(r,n){this.config=n,this.rendererService=r.getContainer().get(Mt.IRendererService),this.cameraService=r.getContainer().get(Mt.ICameraService),this.mapService=r.getContainer().get(Mt.IMapService),this.interactionService=r.getContainer().get(Mt.IInteractionService),this.layerService=r.getContainer().get(Mt.ILayerService),this.shaderModuleService=r.getContainer().get(Mt.IShaderModuleService)}},{key:"render",value:function(r){}}]),e}())||K3),Q3,J3;function oV(e){var t=sV();return function(){var n=Ct(e),i;if(t){var o=Ct(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xn(this,i)}}function sV(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var uV=(Q3=Ei(),Q3(J3=function(e){yn(r,e);var t=oV(r);function r(){return $t(this,r),t.apply(this,arguments)}return Gt(r,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(i,o){Cv(Ct(r.prototype),"init",this).call(this,i,o)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),r}(Gx))||J3),eC,tC,rC,e2,nC;function lV(e,t){var r=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=cV(e))||t&&e&&typeof e.length=="number"){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(h){throw h},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,a=!1,u;return{s:function(){r=r.call(e)},n:function(){var h=r.next();return o=h.done,h},e:function(h){a=!0,u=h},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(a)throw u}}}}function cV(e,t){if(e){if(typeof e=="string")return iC(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return iC(e,t)}}function iC(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var fV=(eC=Ei(),tC=na(Mt.IPostProcessor),eC(rC=(e2=function(){function e(){$t(this,e),Q(this,"passes",[]),Gi(this,"postProcessor",nC,this),Q(this,"layer",void 0),Q(this,"renderFlag",void 0),Q(this,"width",0),Q(this,"height",0)}return Gt(e,[{key:"setLayer",value:function(r){this.layer=r}},{key:"setRenderFlag",value:function(r){this.renderFlag=r}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:function(){var t=Vt(Ce.mark(function n(){var i,o,a;return Ce.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:i=lV(this.passes),c.prev=1,i.s();case 3:if((o=i.n()).done){c.next=9;break}return a=o.value,c.next=7,a.render(this.layer);case 7:c.next=3;break;case 9:c.next=14;break;case 11:c.prev=11,c.t0=c.catch(1),i.e(c.t0);case 14:return c.prev=14,i.f(),c.finish(14);case 17:return c.next=19,this.postProcessor.render(this.layer);case 19:case"end":return c.stop()}},n,this,[[1,11,14,17]])}));function r(){return t.apply(this,arguments)}return r}()},{key:"resize",value:function(r,n){(this.width!==r||this.height!==n)&&(this.postProcessor.resize(r,n),this.width=r,this.height=n)}},{key:"add",value:function(r,n){r.getType()===Lv.PostProcessing?this.postProcessor.add(r,this.layer,n):(r.init(this.layer,n),this.passes.push(r))}},{key:"insert",value:function(r,n,i){r.init(this.layer,n),this.passes.splice(i,0,r)}},{key:"destroy",value:function(){this.passes.length=0}}]),e}(),nC=Ui(e2.prototype,"postProcessor",[tC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),e2))||rC),aC,oC;function hV(e){var t=pV();return function(){var n=Ct(e),i;if(t){var o=Ct(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xn(this,i)}}function pV(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var dV=(aC=Ei(),aC(oC=function(e){yn(r,e);var t=hV(r);function r(){var n;$t(this,r);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return n=t.call.apply(t,[this].concat(o)),Q(Ye(n),"pickingFBO",void 0),Q(Ye(n),"layer",void 0),Q(Ye(n),"width",0),Q(Ye(n),"height",0),Q(Ye(n),"alreadyInRendering",!1),Q(Ye(n),"pickFromPickingFBO",function(u){var c=u.x,h=u.y,y=u.lngLat,x=u.type;if(!(!n.layer.isVisible()||!n.layer.needPick(x))){var E=n.rendererService,T=E.getViewportSize,I=E.readPixels,k=E.useFramebuffer,D=T(),V=D.width,O=D.height,F=n.layer.getLayerConfig(),N=F.enableHighlight,H=F.enableSelect,q=c*ws,Y=h*ws;if(!(q>V||q<0||Y>O||Y<0)){var ee;k(n.pickingFBO,function(){var pe;if(ee=I({x:Math.round(q),y:Math.round(O-(h+1)*ws),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:n.pickingFBO}),ee[0]!==0||ee[1]!==0||ee[2]!==0){var ue=Pm(ee),ie=n.layer.getSource().getFeatureById(ue),xe={x:c,y:h,type:x,lngLat:y,featureId:ue,feature:ie};ie&&(n.layer.setCurrentPickId(ue),n.triggerHoverOnLayer(xe))}else{var Se={x:c,y:h,lngLat:y,type:n.layer.getCurrentPickId()===null?"un"+x:"mouseout",featureId:null,feature:null};n.triggerHoverOnLayer(_t(_t({},Se),{},{type:"unpick"})),n.triggerHoverOnLayer(Se),n.layer.setCurrentPickId(null)}N&&n.highlightPickedFeature(ee),H&&x==="click"&&((pe=ee)===null||pe===void 0?void 0:pe.toString())!==[0,0,0,0].toString()&&n.selectFeature(ee)})}}}),n}return Gt(r,[{key:"getType",value:function(){return Lv.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(i,o){Cv(Ct(r.prototype),"init",this).call(this,i,o),this.layer=i;var a=this.rendererService,u=a.createTexture2D,c=a.createFramebuffer,h=a.getViewportSize,y=h(),x=y.width,E=y.height;this.pickingFBO=c({color:u({width:x,height:E,wrapS:ae.CLAMP_TO_EDGE,wrapT:ae.CLAMP_TO_EDGE})}),this.interactionService.on(vl.Hover,this.pickFromPickingFBO),this.interactionService.on(vl.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(vl.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(i){var o=this;if(!this.alreadyInRendering){var a=this.rendererService,u=a.getViewportSize,c=a.useFramebuffer,h=a.clear,y=u(),x=y.width,E=y.height;this.alreadyInRendering=!0,(this.width!==x||this.height!==E)&&(this.pickingFBO.resize({width:x,height:E}),this.width=x,this.height=E),c(this.pickingFBO,function(){h({framebuffer:o.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var T=o.layer.multiPassRenderer.getRenderFlag();o.layer.multiPassRenderer.setRenderFlag(!1),i.hooks.beforePickingEncode.call(),i.render(),i.hooks.afterPickingEncode.call(),o.layer.multiPassRenderer.setRenderFlag(T),o.alreadyInRendering=!1})}}},{key:"triggerHoverOnLayer",value:function(i){this.layer.emit(i.type,i)}},{key:"highlightPickedFeature",value:function(i){var o=ei(i,3),a=o[0],u=o[1],c=o[2];this.layer.hooks.beforeHighlight.call([a,u,c]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(i){var o=ei(i,3),a=o[0],u=o[1],c=o[2];this.layer.hooks.beforeSelect.call([a,u,c]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(i){var o=i.featureId,a=Dd(o);this.selectFeature(new Uint8Array(a))}},{key:"highlightFeatureHandle",value:function(i){var o=i.featureId,a=Dd(o);this.highlightPickedFeature(new Uint8Array(a))}}]),r}(Gx))||oC),sC,uC,lC,t2,cC,vV=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Bd=(sC=Ei(),uC=na(Mt.IShaderModuleService),sC(lC=(t2=function(){function e(){$t(this,e),Gi(this,"shaderModuleService",cC,this),Q(this,"rendererService",void 0),Q(this,"config",void 0),Q(this,"quad",vV),Q(this,"enabled",!0),Q(this,"renderToScreen",!1),Q(this,"model",void 0),Q(this,"name",void 0),Q(this,"optionsToUpdate",{})}return Gt(e,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(r){this.name=r}},{key:"getType",value:function(){return Lv.PostProcessing}},{key:"init",value:function(r,n){this.config=n,this.rendererService=r.getContainer().get(Mt.IRendererService),this.shaderModuleService=r.getContainer().get(Mt.IShaderModuleService);var i=this.rendererService,o=i.createAttribute,a=i.createBuffer,u=i.createModel,c=this.setupShaders(),h=c.vs,y=c.fs,x=c.uniforms;this.model=u({vs:h,fs:y,attributes:{a_Position:o({buffer:a({data:[-4,-4,4,-4,0,4],type:ae.FLOAT}),size:2})},uniforms:_t(_t({u_Texture:null},x),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}},{key:"render",value:function(r,n){var i=this,o=r.multiPassRenderer.getPostProcessor(),a=this.rendererService,u=a.useFramebuffer,c=a.getViewportSize,h=a.clear,y=c(),x=y.width,E=y.height;u(this.renderToScreen?null:o.getWriteFBO(),function(){h({framebuffer:o.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0});var T=_t({u_BloomFinal:0,u_Texture:o.getReadFBO(),u_ViewportSize:[x,E]},i.convertOptionsToUniforms(i.optionsToUpdate));n&&(T.u_BloomFinal=1,T.u_Texture2=n),i.model.draw({uniforms:T})})}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(r){this.enabled=r}},{key:"setRenderToScreen",value:function(r){this.renderToScreen=r}},{key:"updateOptions",value:function(r){this.optionsToUpdate=_t(_t({},this.optionsToUpdate),r)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(r){var n={};return Object.keys(r).forEach(function(i){Er.isNil(r[i])||(n["u_".concat(Er.upperFirst(Er.camelCase(i)))]=r[i])}),n}}]),e}(),cC=Ui(t2.prototype,"shaderModuleService",[uC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),t2))||lC),fC,hC;function mV(e){var t=gV();return function(){var n=Ct(e),i;if(t){var o=Ct(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xn(this,i)}}function gV(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var yV=`varying vec2 v_UV;

uniform float u_BloomFinal: 0.0;
uniform sampler2D u_Texture;
uniform sampler2D u_Texture2;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_radius: 5.0;
uniform float u_intensity: 0.3;
uniform float u_baseRadio: 0.5;

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

float luminance(vec4 color) {
  return  0.2125 * color.r + 0.7154 * color.g + 0.0721 * color.b;
}

void main() {
  // vec4 baseColor = texture2D(u_Texture, v_UV);

  float r = sqrt(u_radius);

  vec4 c1 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(u_radius, 0.0));
  // c1 *= luminance(c1);
  vec4 c2 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(0.0, u_radius));
  // c2 *= luminance(c2);
  vec4 c3 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, r));
  // c3 *= luminance(c3);
  vec4 c4 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, -r));
  // c4 *= luminance(c4);
  vec4 inbloomColor = (c1 + c2 + c3 + c4) * 0.25;

  // float lum = luminance(inbloomColor);
  // inbloomColor.rgb *= lum;

  if(u_BloomFinal > 0.0) {
    vec4 baseColor = texture2D(u_Texture2, v_UV);
    float baselum = luminance(baseColor);
    gl_FragColor = mix(inbloomColor, baseColor, u_baseRadio);
    if(baselum <= 0.2) {
      gl_FragColor = inbloomColor * u_intensity;
    }
  } else {
    gl_FragColor = inbloomColor;
  }
}`,_V=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,xV=(fC=Ei(),fC(hC=function(e){yn(r,e);var t=mV(r);function r(){return $t(this,r),t.apply(this,arguments)}return Gt(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:_V,fs:yV});var i=this.shaderModuleService.getModule("blur-pass"),o=i.vs,a=i.fs,u=i.uniforms,c=this.rendererService.getViewportSize(),h=c.width,y=c.height;return{vs:o,fs:a,uniforms:_t(_t({},u),{},{u_ViewportSize:[h,y]})}}},{key:"convertOptionsToUniforms",value:function(i){var o={};return Er.isNil(i.bloomRadius)||(o.u_radius=i.bloomRadius),Er.isNil(i.bloomIntensity)||(o.u_intensity=i.bloomIntensity),Er.isNil(i.bloomBaseRadio)||(o.u_baseRadio=i.bloomBaseRadio),o}}]),r}(Bd))||hC),pC,dC;function bV(e){var t=wV();return function(){var n=Ct(e),i;if(t){var o=Ct(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xn(this,i)}}function wV(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var EV=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,SV=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,AV=(pC=Ei(),pC(dC=function(e){yn(r,e);var t=bV(r);function r(){return $t(this,r),t.apply(this,arguments)}return Gt(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:SV,fs:EV});var i=this.shaderModuleService.getModule("blur-pass"),o=i.vs,a=i.fs,u=i.uniforms,c=this.rendererService.getViewportSize(),h=c.width,y=c.height;return{vs:o,fs:a,uniforms:_t(_t({},u),{},{u_ViewportSize:[h,y]})}}},{key:"convertOptionsToUniforms",value:function(i){var o={};return Er.isNil(i.blurRadius)||(o.u_BlurDir=[i.blurRadius,0]),o}}]),r}(Bd))||dC),vC,mC;function TV(e){var t=CV();return function(){var n=Ct(e),i;if(t){var o=Ct(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xn(this,i)}}function CV(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var MV=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,PV=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,IV=(vC=Ei(),vC(mC=function(e){yn(r,e);var t=TV(r);function r(){return $t(this,r),t.apply(this,arguments)}return Gt(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:PV,fs:MV});var i=this.shaderModuleService.getModule("blur-pass"),o=i.vs,a=i.fs,u=i.uniforms,c=this.rendererService.getViewportSize(),h=c.width,y=c.height;return{vs:o,fs:a,uniforms:_t(_t({},u),{},{u_ViewportSize:[h,y]})}}},{key:"convertOptionsToUniforms",value:function(i){var o={};return Er.isNil(i.blurRadius)||(o.u_BlurDir=[0,i.blurRadius]),o}}]),r}(Bd))||mC),gC,yC;function RV(e){var t=LV();return function(){var n=Ct(e),i;if(t){var o=Ct(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xn(this,i)}}function LV(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var kV=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,OV=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,DV=(gC=Ei(),gC(yC=function(e){yn(r,e);var t=RV(r);function r(){return $t(this,r),t.apply(this,arguments)}return Gt(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:OV,fs:kV});var i=this.shaderModuleService.getModule("colorhalftone-pass"),o=i.vs,a=i.fs,u=i.uniforms,c=this.rendererService.getViewportSize(),h=c.width,y=c.height;return{vs:o,fs:a,uniforms:_t(_t({},u),{},{u_ViewportSize:[h,y]})}}}]),r}(Bd))||yC),_C,xC;function FV(e){var t=NV();return function(){var n=Ct(e),i;if(t){var o=Ct(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xn(this,i)}}function NV(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var BV=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,zV=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,UV=(_C=Ei(),_C(xC=function(e){yn(r,e);var t=FV(r);function r(){return $t(this,r),t.apply(this,arguments)}return Gt(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:zV,fs:BV}),this.shaderModuleService.getModule("copy-pass")}}]),r}(Bd))||xC),bC,wC;function VV(e){var t=jV();return function(){var n=Ct(e),i;if(t){var o=Ct(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xn(this,i)}}function jV(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var $V=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,GV=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,HV=(bC=Ei(),bC(wC=function(e){yn(r,e);var t=VV(r);function r(){return $t(this,r),t.apply(this,arguments)}return Gt(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:GV,fs:$V});var i=this.shaderModuleService.getModule("hexagonalpixelate-pass"),o=i.vs,a=i.fs,u=i.uniforms,c=this.rendererService.getViewportSize(),h=c.width,y=c.height;return{vs:o,fs:a,uniforms:_t(_t({},u),{},{u_ViewportSize:[h,y]})}}}]),r}(Bd))||wC),EC,SC;function WV(e){var t=XV();return function(){var n=Ct(e),i;if(t){var o=Ct(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xn(this,i)}}function XV(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var YV=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,qV=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,ZV=(EC=Ei(),EC(SC=function(e){yn(r,e);var t=WV(r);function r(){return $t(this,r),t.apply(this,arguments)}return Gt(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:qV,fs:YV});var i=this.shaderModuleService.getModule("ink-pass"),o=i.vs,a=i.fs,u=i.uniforms,c=this.rendererService.getViewportSize(),h=c.width,y=c.height;return{vs:o,fs:a,uniforms:_t(_t({},u),{},{u_ViewportSize:[h,y]})}}}]),r}(Bd))||SC),AC,TC;function KV(e){var t=QV();return function(){var n=Ct(e),i;if(t){var o=Ct(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xn(this,i)}}function QV(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var JV=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,ej=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,tj=(AC=Ei(),AC(TC=function(e){yn(r,e);var t=KV(r);function r(){return $t(this,r),t.apply(this,arguments)}return Gt(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:ej,fs:JV}),this.shaderModuleService.getModule("noise-pass")}}]),r}(Bd))||TC),CC,MC;function rj(e){var t=nj();return function(){var n=Ct(e),i;if(t){var o=Ct(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xn(this,i)}}function nj(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var ij=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,aj=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`,oj=(CC=Ei(),CC(MC=function(e){yn(r,e);var t=rj(r);function r(){return $t(this,r),t.apply(this,arguments)}return Gt(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:ij,fs:aj}),this.shaderModuleService.getModule("sepia-pass")}}]),r}(Bd))||MC),PC,IC,RC,LC,x0,kC,sj=(PC=Ei(),IC=na(Mt.IRendererService),RC=lz(),PC(LC=(x0=function(){function e(){$t(this,e),Gi(this,"rendererService",kC,this),Q(this,"passes",[]),Q(this,"readFBO",void 0),Q(this,"writeFBO",void 0)}return Gt(e,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"getCurrentFBOTex",value:function(){var r=this.rendererService,n=r.getViewportSize,i=r.createTexture2D,o=n(),a=o.width,u=o.height;return i({x:0,y:0,width:a,height:u,copy:!0})}},{key:"getReadFBOTex",value:function(){var r=this,n=this.rendererService.useFramebuffer;return new Promise(function(i){n(r.readFBO,Vt(Ce.mark(function o(){return Ce.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:i(r.getCurrentFBOTex());case 1:case"end":return u.stop()}},o)})))})}},{key:"renderBloomPass",value:function(){var t=Vt(Ce.mark(function n(i,o){var a,u;return Ce.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,this.getReadFBOTex();case 2:a=h.sent,u=0;case 4:if(!(u<4)){h.next=11;break}return h.next=7,o.render(i,a);case 7:this.swap(),u++,h.next=4;break;case 11:case"end":return h.stop()}},n,this)}));function r(n,i){return t.apply(this,arguments)}return r}()},{key:"render",value:function(){var t=Vt(Ce.mark(function n(i){var o,a;return Ce.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:o=0;case 1:if(!(o<this.passes.length)){c.next=15;break}if(a=this.passes[o],a.setRenderToScreen(this.isLastEnabledPass(o)),a.getName()!=="bloom"){c.next=9;break}return c.next=7,this.renderBloomPass(i,a);case 7:c.next=12;break;case 9:return c.next=11,a.render(i);case 11:o!==this.passes.length-1&&this.swap();case 12:o++,c.next=1;break;case 15:case"end":return c.stop()}},n,this)}));function r(n){return t.apply(this,arguments)}return r}()},{key:"resize",value:function(r,n){this.readFBO.resize({width:r,height:n}),this.writeFBO.resize({width:r,height:n})}},{key:"add",value:function(r,n,i){r.init(n,i),this.passes.push(r)}},{key:"insert",value:function(r,n,i,o){r.init(i,o),this.passes.splice(n,0,r)}},{key:"getPostProcessingPassByName",value:function(r){return this.passes.find(function(n){return n.getName()===r})}},{key:"init",value:function(){var r=this.rendererService,n=r.createFramebuffer,i=r.createTexture2D;this.readFBO=n({color:i({width:1,height:1,wrapS:ae.CLAMP_TO_EDGE,wrapT:ae.CLAMP_TO_EDGE})}),this.writeFBO=n({color:i({width:1,height:1,wrapS:ae.CLAMP_TO_EDGE,wrapT:ae.CLAMP_TO_EDGE})})}},{key:"isLastEnabledPass",value:function(r){for(var n=r+1;n<this.passes.length;n++)if(this.passes[n].isEnabled())return!1;return!0}},{key:"swap",value:function(){var r=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=r}}]),e}(),kC=Ui(x0.prototype,"rendererService",[IC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ui(x0.prototype,"init",[RC],Object.getOwnPropertyDescriptor(x0.prototype,"init"),x0.prototype),x0))||LC),OC,DC;function uj(e){var t=lj();return function(){var n=Ct(e),i;if(t){var o=Ct(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xn(this,i)}}function lj(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var cj=(OC=Ei(),OC(DC=function(e){yn(r,e);var t=uj(r);function r(){return $t(this,r),t.apply(this,arguments)}return Gt(r,[{key:"getType",value:function(){return Lv.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(i,o){Cv(Ct(r.prototype),"init",this).call(this,i,o)}},{key:"render",value:function(i){var o=this.rendererService,a=o.useFramebuffer,u=o.clear,c=i.multiPassRenderer.getPostProcessor().getReadFBO();a(c,function(){u({color:[0,0,0,0],depth:1,stencil:0,framebuffer:c}),i.multiPassRenderer.setRenderFlag(!1),i.models.forEach(function(h){h.draw({uniforms:i.layerModel.getUninforms()})}),i.multiPassRenderer.setRenderFlag(!0)})}}]),r}(Gx))||DC),FC,NC,BC,r2,zC;function fj(e){var t=hj();return function(){var n=Ct(e),i;if(t){var o=Ct(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xn(this,i)}}function hj(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var pj=`uniform float u_opacity : 1.0;
uniform float u_MixRatio : 0.5;

uniform sampler2D u_Diffuse1;
uniform sampler2D u_Diffuse2;

varying vec2 v_UV;

void main() {
  vec4 texel1 = texture2D(u_Diffuse1, v_UV);
  vec4 texel2 = texture2D(u_Diffuse2, v_UV);
  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);
}
`,UC=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,dj=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;function VC(e,t){for(var r=0,n=1/t,i=e;i>0;)r=r+n*(i%t),i=Math.floor(i/t),n=n/t;return r}var vj=1,mj=(FC=Ei(),NC=na(Mt.IShaderModuleService),FC(BC=(r2=function(e){yn(r,e);var t=fj(r);function r(){var n;$t(this,r);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return n=t.call.apply(t,[this].concat(o)),Gi(Ye(n),"shaderModuleService",zC,Ye(n)),Q(Ye(n),"haltonSequence",[]),Q(Ye(n),"accumulatingId",0),Q(Ye(n),"frame",0),Q(Ye(n),"timer",void 0),Q(Ye(n),"sampleRenderTarget",void 0),Q(Ye(n),"prevRenderTarget",void 0),Q(Ye(n),"outputRenderTarget",void 0),Q(Ye(n),"copyRenderTarget",void 0),Q(Ye(n),"blendModel",void 0),Q(Ye(n),"outputModel",void 0),Q(Ye(n),"copyModel",void 0),n}return Gt(r,[{key:"getType",value:function(){return Lv.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(i,o){Cv(Ct(r.prototype),"init",this).call(this,i,o);var a=this.rendererService,u=a.createFramebuffer,c=a.createTexture2D;this.sampleRenderTarget=u({color:c({width:1,height:1,wrapS:ae.CLAMP_TO_EDGE,wrapT:ae.CLAMP_TO_EDGE})}),this.prevRenderTarget=u({color:c({width:1,height:1,wrapS:ae.CLAMP_TO_EDGE,wrapT:ae.CLAMP_TO_EDGE})}),this.outputRenderTarget=u({color:c({width:1,height:1,wrapS:ae.CLAMP_TO_EDGE,wrapT:ae.CLAMP_TO_EDGE})}),this.copyRenderTarget=u({color:c({width:1,height:1,wrapS:ae.CLAMP_TO_EDGE,wrapT:ae.CLAMP_TO_EDGE})});for(var h=0;h<30;h++)this.haltonSequence.push([VC(h,2),VC(h,3)]);this.blendModel=this.createTriangleModel("blend-pass",pj),this.outputModel=this.createTriangleModel("copy-pass",UC,{blend:{enable:!0,func:{srcRGB:ae.ONE,dstRGB:ae.ONE_MINUS_SRC_ALPHA,srcAlpha:ae.ONE,dstAlpha:ae.ONE_MINUS_SRC_ALPHA},equation:{rgb:ae.FUNC_ADD,alpha:ae.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",UC)}},{key:"render",value:function(i){var o=this,a=this.rendererService,u=a.clear,c=a.getViewportSize,h=a.useFramebuffer,y=c(),x=y.width,E=y.height;this.sampleRenderTarget.resize({width:x,height:E}),this.prevRenderTarget.resize({width:x,height:E}),this.outputRenderTarget.resize({width:x,height:E}),this.copyRenderTarget.resize({width:x,height:E}),this.resetFrame(),this.stopAccumulating();var T=i.multiPassRenderer.getPostProcessor().getReadFBO();h(T,function(){u({color:[0,0,0,0],depth:1,stencil:0,framebuffer:T}),i.multiPassRenderer.setRenderFlag(!1),i.render(),i.multiPassRenderer.setRenderFlag(!0)});var I=function k(D){!o.accumulatingId||D!==o.accumulatingId||o.isFinished()||(o.doRender(i),ja.requestAnimationFrame(function(){k(D)}))};this.accumulatingId=vj++,this.timer=ja.setTimeout(function(){I(o.accumulatingId)},50)}},{key:"doRender",value:function(i){var o=this,a=this.rendererService,u=a.clear,c=a.getViewportSize,h=a.useFramebuffer,y=c(),x=y.width,E=y.height,T=i.getLayerConfig(),I=T.jitterScale,k=I===void 0?1:I,D=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((D[0]*2-1)/x*k,(D[1]*2-1)/E*k),i.multiPassRenderer.setRenderFlag(!1),i.hooks.beforeRender.call(),h(this.sampleRenderTarget,function(){u({color:[0,0,0,0],depth:1,stencil:0,framebuffer:o.sampleRenderTarget}),i.render()}),i.hooks.afterRender.call(),i.multiPassRenderer.setRenderFlag(!0);var V=i.getLayerConfig();h(this.outputRenderTarget,function(){o.blendModel.draw({uniforms:{u_opacity:V.opacity||1,u_MixRatio:o.frame===0?1:.9,u_Diffuse1:o.sampleRenderTarget,u_Diffuse2:o.frame===0?i.multiPassRenderer.getPostProcessor().getReadFBO():o.prevRenderTarget}})}),this.frame===0&&u({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(h(this.copyRenderTarget,function(){o.outputModel.draw({uniforms:{u_Texture:o.outputRenderTarget}})}),h(i.multiPassRenderer.getPostProcessor().getReadFBO(),function(){o.copyModel.draw({uniforms:{u_Texture:o.copyRenderTarget}})}),i.multiPassRenderer.getPostProcessor().render(i));var O=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=O,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,ja.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(i,o,a){this.shaderModuleService.registerModule(i,{vs:dj,fs:o});var u=this.shaderModuleService.getModule(i),c=u.vs,h=u.fs,y=u.uniforms,x=this.rendererService,E=x.createAttribute,T=x.createBuffer,I=x.createModel;return I(_t({vs:c,fs:h,attributes:{a_Position:E({buffer:T({data:[-4,-4,4,-4,0,4],type:ae.FLOAT}),size:2})},uniforms:_t({},y),depth:{enable:!1},count:3},a))}}]),r}(Gx),zC=Ui(r2.prototype,"shaderModuleService",[NC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),r2))||BC),Gu=new aS;Gu.bind(Mt.IGlobalConfigService).to(Zz).inSingletonScope();V9(Ei(),tc.EventEmitter);Gu.bind(Mt.IEventEmitter).to(tc.EventEmitter);var gj=dz(Gu,!1),cS=function(t){var r=gj.lazyInject(t);return function(n,i,o){r.call(this,n,i),o&&(o.initializer=function(){return n[i]})}},yj=0;function _j(){var e=new aS;return e.parent=Gu,e.bind(Mt.SceneID).toConstantValue("".concat(yj++)),e.bind(Mt.IShaderModuleService).to(iV).inSingletonScope(),e.bind(Mt.ILayerService).to(mU).inSingletonScope(),e.bind(Mt.IDebugService).to(rU).inSingletonScope(),e.bind(Mt.ISceneService).to(VU).inSingletonScope(),e.bind(Mt.ICameraService).to(Uz).inSingletonScope(),e.bind(Mt.ICoordinateSystemService).to(Jz).inSingletonScope(),e.bind(Mt.IInteractionService).to(sU).inSingletonScope(),e.bind(Mt.IPickingService).to(fU).inSingletonScope(),e.bind(Mt.IControlService).to(Gz).inSingletonScope(),e.bind(Mt.IMarkerService).to(Hz).inSingletonScope(),e.bind(Mt.IIconService).to(zz).inSingletonScope(),e.bind(Mt.IFontService).to(Dz).inSingletonScope(),e.bind(Mt.IPopupService).to(Wz).inSingletonScope(),e.bind(Mt.INormalPass).to(uV).whenTargetNamed("clear"),e.bind(Mt.INormalPass).to(dV).whenTargetNamed("pixelPicking"),e.bind(Mt.INormalPass).to(cj).whenTargetNamed("render"),e.bind(Mt.INormalPass).to(mj).whenTargetNamed("taa"),e.bind(Mt.IFactoryNormalPass).toFactory(function(t){return function(r){return t.container.getNamed(Mt.INormalPass,r)}}),e.bind(Mt.IPostProcessingPass).to(UV).whenTargetNamed("copy"),e.bind(Mt.IPostProcessingPass).to(xV).whenTargetNamed("bloom"),e.bind(Mt.IPostProcessingPass).to(AV).whenTargetNamed("blurH"),e.bind(Mt.IPostProcessingPass).to(IV).whenTargetNamed("blurV"),e.bind(Mt.IPostProcessingPass).to(tj).whenTargetNamed("noise"),e.bind(Mt.IPostProcessingPass).to(oj).whenTargetNamed("sepia"),e.bind(Mt.IPostProcessingPass).to(DV).whenTargetNamed("colorHalftone"),e.bind(Mt.IPostProcessingPass).to(HV).whenTargetNamed("hexagonalPixelate"),e.bind(Mt.IPostProcessingPass).to(ZV).whenTargetNamed("ink"),e.bind(Mt.IFactoryPostProcessingPass).toFactory(function(t){return function(r){var n=t.container.getNamed(Mt.IPostProcessingPass,r);return n.setName(r),n}}),e}function Ty(e){var t=new aS;return t.parent=e,t.bind(Mt.IStyleAttributeService).to(wU).inSingletonScope(),t.bind(Mt.IMultiPassRenderer).to(fV).inSingletonScope(),t.bind(Mt.IPostProcessor).to(sj).inSingletonScope(),t}var gm={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"},$s={MapInitStart:"mapInitStart",LayerInitStart:"layerInitStart",LayerInitEnd:"layerInitEnd",SourceInitStart:"sourceInitStart",SourceInitEnd:"sourceInitEnd",ScaleInitStart:"scaleInitStart",ScaleInitEnd:"scaleInitEnd",MappingStart:"mappingStart",MappingEnd:"mappingEnd",BuildModelStart:"buildModelStart",BuildModelEnd:"buildModelEnd"},io;(function(e){e.LINEAR="linear",e.SEQUENTIAL="sequential",e.POWER="power",e.LOG="log",e.IDENTITY="identity",e.TIME="time",e.QUANTILE="quantile",e.QUANTIZE="quantize",e.THRESHOLD="threshold",e.CAT="cat",e.DIVERGING="diverging"})(io||(io={}));var _v;(function(e){e.CONSTANT="constant",e.VARIABLE="variable"})(_v||(_v={}));var gn;(function(e){e[e.Attribute=0]="Attribute",e[e.InstancedAttribute=1]="InstancedAttribute",e[e.Uniform=2]="Uniform"})(gn||(gn={}));var xj=["mapload","mapchange","mapAfterFrameChange"],a1=["loaded","fontloaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"],Eu;(function(e){e.IMAGE="image",e.CUSTOMIMAGE="customImage",e.ARRAYBUFFER="arraybuffer",e.RGB="rgb",e.TERRAINRGB="terrainRGB",e.CUSTOMRGB="customRGB",e.CUSTOMARRAYBUFFER="customArrayBuffer",e.CUSTOMTERRAINRGB="customTerrainRGB"})(Eu||(Eu={}));var bj=function(){var e=Vt(Ce.mark(function t(r,n,i,o){return Ce.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",new Promise(function(c,h){n({x:r.x,y:r.y,z:r.z},function(y,x){if(y||x.length===0){h(y);return}x&&dw([{data:x,bands:[0]}],i,o,function(E,T){E?h(E):T&&c(T)})})}));case 1:case"end":return u.stop()}},t)}));return function(r,n,i,o){return e.apply(this,arguments)}}(),wj=function(){var e=Vt(Ce.mark(function t(r,n){return Ce.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",new Promise(function(a,u){n({x:r.x,y:r.y,z:r.z},function(c,h){if(c||!h){u(c);return}h instanceof ArrayBuffer?eF(h,function(y,x){y&&u(y),a(x)}):h instanceof HTMLImageElement?a(h):u(c)})}));case 1:case"end":return o.stop()}},t)}));return function(r,n){return e.apply(this,arguments)}}();function Ej(e,t){return Array.isArray(e)?typeof e[0]=="string"?e.map(function(r){return Ey(r,t)}):e.map(function(r){return{url:Ey(r.url,t),bands:r.bands||[0]}}):Ey(e,t)}function Sj(e){return typeof e=="string"?[{url:e,bands:[0]}]:typeof e[0]=="string"?e.map(function(t){return{url:t,bands:[0]}}):e}function jC(e,t){e.xhrCancel=function(){t.map(function(r){r.abort()})}}var Aj=function(){var e=Vt(Ce.mark(function t(r,n,i,o,a){var u,c,h,y,x,E;return Ce.wrap(function(I){for(;;)switch(I.prev=I.next){case 0:if(u=Sj(n.url),!(u.length>1)){I.next=15;break}return I.next=4,Tj(u,n);case 4:if(c=I.sent,h=c.rasterFiles,y=c.xhrList,x=c.errList,jC(r,y),!(x.length>0)){I.next=12;break}return i(x,null),I.abrupt("return");case 12:dw(h,o,a,i),I.next=17;break;case 15:E=DE(n,function(k,D){if(k)i(k);else if(D){var V=[{data:D,bands:u[0].bands}];dw(V,o,a,i)}}),jC(r,[E]);case 17:case"end":return I.stop()}},t)}));return function(r,n,i,o,a){return e.apply(this,arguments)}}();function Tj(e,t){return Pw.apply(this,arguments)}function Pw(){return Pw=Vt(Ce.mark(function e(t,r){var n,i,o,a,u,c,h,y,x,E,T;return Ce.wrap(function(k){for(;;)switch(k.prev=k.next){case 0:n=[],i=[],o=[],a=0;case 4:if(!(a<t.length)){k.next=20;break}return u=t[a],c=_t(_t({},r),{},{url:u.url}),h=u.bands,k.next=10,Q8(_t(_t({},c),{},{type:"arrayBuffer"}));case 10:y=k.sent,x=y.err,E=y.data,T=y.xhr,x&&o.push(x),i.push(T),n.push({data:E,bands:h});case 17:a++,k.next=4;break;case 20:return k.abrupt("return",{rasterFiles:n,xhrList:i,errList:o});case 21:case"end":return k.stop()}},e)})),Pw.apply(this,arguments)}var Cj=function(){var e=Vt(Ce.mark(function t(r,n,i,o,a){var u;return Ce.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return u={url:Ej(r,n)},h.abrupt("return",new Promise(function(y,x){Aj(i,u,function(E,T){E?x(E):T&&y(T)},o,a)}));case 2:case"end":return h.stop()}},t)}));return function(r,n,i,o,a){return e.apply(this,arguments)}}(),$C=function(){var e=Vt(Ce.mark(function t(r,n,i,o){var a,u,c,h;return Ce.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return u=Array.isArray(r)?r[0]:r,o.wmtsOptions?(c=(o==null?void 0:o.getURLFromTemplate)||p7,a=c(u,_t(_t({},n),o.wmtsOptions))):(h=(o==null?void 0:o.getURLFromTemplate)||Ey,a=h(u,n)),x.abrupt("return",new Promise(function(E,T){var I,k=Q2({url:a,type:(o==null||(I=o.requestParameters)===null||I===void 0?void 0:I.type)||"arrayBuffer"},function(D,V){D?T(D):V&&E(V)},o.transformResponse);i.xhrCancel=function(){return k.abort()}}));case 3:case"end":return x.stop()}},t)}));return function(r,n,i,o){return e.apply(this,arguments)}}(),GC=function(){return{rasterData:new Uint8Array([0]),width:1,height:1}},Mj={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0,warp:!0};Eu.ARRAYBUFFER,Eu.RGB;function Pj(e){return!!(Array.isArray(e)&&e.length===0||!Array.isArray(e)&&typeof e!="string")}function Ij(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(Pj(e))throw new Error("tile server url is error");var r=(t==null?void 0:t.dataType)||Eu.IMAGE;r===Eu.RGB&&(r=Eu.ARRAYBUFFER);var n=function(a,u){switch(r){case Eu.IMAGE:return $C(e,a,u,t);case Eu.CUSTOMIMAGE:case Eu.CUSTOMTERRAINRGB:return wj(u,t==null?void 0:t.getCustomData);case Eu.ARRAYBUFFER:return Cj(e,a,u,(t==null?void 0:t.format)||GC,t==null?void 0:t.operation);case Eu.CUSTOMARRAYBUFFER:case Eu.CUSTOMRGB:return bj(u,t==null?void 0:t.getCustomData,(t==null?void 0:t.format)||GC,t==null?void 0:t.operation);default:return $C(e,a,u,t)}},i=_t(_t(_t({},Mj),t),{},{getTileData:n});return{data:e,dataArray:[],tilesetOptions:i,isTile:!0}}var Rj=["extent","min","max","width","height","format","operation"];function Lj(e,t){var r=t.extent,n=t.min,i=t.max,o=t.width,a=t.height,u=t.format,c=t.operation,h=Zh(t,Rj),y;if(u===void 0||ER(e))y=Array.from(e);else{var x=Array.isArray(e)?e:[e];y=tS(x,u,c)}var E={_id:1,dataArray:[_t(_t({_id:1,data:y,width:o,height:a},h),{},{min:n,max:i,coordinates:[[r[0],r[1]],[r[2],r[3]]]})]};return E}var kj={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0},Oj=function(){var e=Vt(Ce.mark(function t(r){return Ce.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",new Promise(function(o){var a=ei(r.bounds,4),u=a[0],c=a[1],h=a[2],y=a[3],x={layers:{testTile:{features:[{type:"Feature",properties:{key:r.x+"/"+r.y+"/"+r.z,x:(u+h)/2,y:(c+y)/2},geometry:{type:"LineString",coordinates:[[h,y],[h,c],[u,c],[u,c]]}}]}}};o(x)}));case 1:case"end":return i.stop()}},t)}));return function(r){return e.apply(this,arguments)}}();function Dj(e,t){var r=function(o){return Oj(o)},n=_t(_t(_t({},kj),t),{},{getTileData:r});return{data:e,dataArray:[],tilesetOptions:n,isTile:!0}}var XR={exports:{}};(function(e,t){(function(r,n){e.exports=n()})(mf,function(){function r(ue,ie,xe,Se,Ne,ze){if(!(Ne-Se<=xe)){var Be=Se+Ne>>1;n(ue,ie,Be,Se,Ne,ze%2),r(ue,ie,xe,Se,Be-1,ze+1),r(ue,ie,xe,Be+1,Ne,ze+1)}}function n(ue,ie,xe,Se,Ne,ze){for(;Ne>Se;){if(Ne-Se>600){var Be=Ne-Se+1,$e=xe-Se+1,it=Math.log(Be),mt=.5*Math.exp(2*it/3),Qe=.5*Math.sqrt(it*mt*(Be-mt)/Be)*($e-Be/2<0?-1:1),rt=Math.max(Se,Math.floor(xe-$e*mt/Be+Qe)),gt=Math.min(Ne,Math.floor(xe+(Be-$e)*mt/Be+Qe));n(ue,ie,xe,rt,gt,ze)}var er=ie[2*xe+ze],zt=Se,qt=Ne;for(i(ue,ie,Se,xe),ie[2*Ne+ze]>er&&i(ue,ie,Se,Ne);zt<qt;){for(i(ue,ie,zt,qt),zt++,qt--;ie[2*zt+ze]<er;)zt++;for(;ie[2*qt+ze]>er;)qt--}ie[2*Se+ze]===er?i(ue,ie,Se,qt):(qt++,i(ue,ie,qt,Ne)),qt<=xe&&(Se=qt+1),xe<=qt&&(Ne=qt-1)}}function i(ue,ie,xe,Se){o(ue,xe,Se),o(ie,2*xe,2*Se),o(ie,2*xe+1,2*Se+1)}function o(ue,ie,xe){var Se=ue[ie];ue[ie]=ue[xe],ue[xe]=Se}function a(ue,ie,xe,Se,Ne,ze,Be){for(var $e=[0,ue.length-1,0],it=[],mt,Qe;$e.length;){var rt=$e.pop(),gt=$e.pop(),er=$e.pop();if(gt-er<=Be){for(var zt=er;zt<=gt;zt++)mt=ie[2*zt],Qe=ie[2*zt+1],mt>=xe&&mt<=Ne&&Qe>=Se&&Qe<=ze&&it.push(ue[zt]);continue}var qt=Math.floor((er+gt)/2);mt=ie[2*qt],Qe=ie[2*qt+1],mt>=xe&&mt<=Ne&&Qe>=Se&&Qe<=ze&&it.push(ue[qt]);var Zr=(rt+1)%2;(rt===0?xe<=mt:Se<=Qe)&&($e.push(er),$e.push(qt-1),$e.push(Zr)),(rt===0?Ne>=mt:ze>=Qe)&&($e.push(qt+1),$e.push(gt),$e.push(Zr))}return it}function u(ue,ie,xe,Se,Ne,ze){for(var Be=[0,ue.length-1,0],$e=[],it=Ne*Ne;Be.length;){var mt=Be.pop(),Qe=Be.pop(),rt=Be.pop();if(Qe-rt<=ze){for(var gt=rt;gt<=Qe;gt++)c(ie[2*gt],ie[2*gt+1],xe,Se)<=it&&$e.push(ue[gt]);continue}var er=Math.floor((rt+Qe)/2),zt=ie[2*er],qt=ie[2*er+1];c(zt,qt,xe,Se)<=it&&$e.push(ue[er]);var Zr=(mt+1)%2;(mt===0?xe-Ne<=zt:Se-Ne<=qt)&&(Be.push(rt),Be.push(er-1),Be.push(Zr)),(mt===0?xe+Ne>=zt:Se+Ne>=qt)&&(Be.push(er+1),Be.push(Qe),Be.push(Zr))}return $e}function c(ue,ie,xe,Se){var Ne=ue-xe,ze=ie-Se;return Ne*Ne+ze*ze}var h=function(ue){return ue[0]},y=function(ue){return ue[1]},x=function(ie,xe,Se,Ne,ze){xe===void 0&&(xe=h),Se===void 0&&(Se=y),Ne===void 0&&(Ne=64),ze===void 0&&(ze=Float64Array),this.nodeSize=Ne,this.points=ie;for(var Be=ie.length<65536?Uint16Array:Uint32Array,$e=this.ids=new Be(ie.length),it=this.coords=new ze(ie.length*2),mt=0;mt<ie.length;mt++)$e[mt]=mt,it[2*mt]=xe(ie[mt]),it[2*mt+1]=Se(ie[mt]);r($e,it,Ne,0,$e.length-1,0)};x.prototype.range=function(ie,xe,Se,Ne){return a(this.ids,this.coords,ie,xe,Se,Ne,this.nodeSize)},x.prototype.within=function(ie,xe,Se){return u(this.ids,this.coords,ie,xe,Se,this.nodeSize)};var E={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(ue){return ue}},T=Math.fround||function(ue){return function(ie){return ue[0]=+ie,ue[0]}}(new Float32Array(1)),I=function(ie){this.options=Y(Object.create(E),ie),this.trees=new Array(this.options.maxZoom+1)};I.prototype.load=function(ie){var xe=this.options,Se=xe.log,Ne=xe.minZoom,ze=xe.maxZoom,Be=xe.nodeSize,$e="prepare "+ie.length+" points";this.points=ie;for(var it=[],mt=0;mt<ie.length;mt++)ie[mt].geometry&&it.push(D(ie[mt],mt));this.trees[ze+1]=new x(it,ee,pe,Be,Float32Array);for(var Qe=ze;Qe>=Ne;Qe--){var rt=+Date.now();it=this._cluster(it,Qe),this.trees[Qe]=new x(it,ee,pe,Be,Float32Array)}return this},I.prototype.getClusters=function(ie,xe){var Se=((ie[0]+180)%360+360)%360-180,Ne=Math.max(-90,Math.min(90,ie[1])),ze=ie[2]===180?180:((ie[2]+180)%360+360)%360-180,Be=Math.max(-90,Math.min(90,ie[3]));if(ie[2]-ie[0]>=360)Se=-180,ze=180;else if(Se>ze){var $e=this.getClusters([Se,Ne,180,Be],xe),it=this.getClusters([-180,Ne,ze,Be],xe);return $e.concat(it)}for(var mt=this.trees[this._limitZoom(xe)],Qe=mt.range(F(Se),N(Be),F(ze),N(Ne)),rt=[],gt=0,er=Qe;gt<er.length;gt+=1){var zt=er[gt],qt=mt.points[zt];rt.push(qt.numPoints?V(qt):this.points[qt.index])}return rt},I.prototype.getChildren=function(ie){var xe=this._getOriginId(ie),Se=this._getOriginZoom(ie),Ne="No cluster with the specified id.",ze=this.trees[Se];if(!ze)throw new Error(Ne);var Be=ze.points[xe];if(!Be)throw new Error(Ne);for(var $e=this.options.radius/(this.options.extent*Math.pow(2,Se-1)),it=ze.within(Be.x,Be.y,$e),mt=[],Qe=0,rt=it;Qe<rt.length;Qe+=1){var gt=rt[Qe],er=ze.points[gt];er.parentId===ie&&mt.push(er.numPoints?V(er):this.points[er.index])}if(mt.length===0)throw new Error(Ne);return mt},I.prototype.getLeaves=function(ie,xe,Se){xe=xe||10,Se=Se||0;var Ne=[];return this._appendLeaves(Ne,ie,xe,Se,0),Ne},I.prototype.getTile=function(ie,xe,Se){var Ne=this.trees[this._limitZoom(ie)],ze=Math.pow(2,ie),Be=this.options,$e=Be.extent,it=Be.radius,mt=it/$e,Qe=(Se-mt)/ze,rt=(Se+1+mt)/ze,gt={features:[]};return this._addTileFeatures(Ne.range((xe-mt)/ze,Qe,(xe+1+mt)/ze,rt),Ne.points,xe,Se,ze,gt),xe===0&&this._addTileFeatures(Ne.range(1-mt/ze,Qe,1,rt),Ne.points,ze,Se,ze,gt),xe===ze-1&&this._addTileFeatures(Ne.range(0,Qe,mt/ze,rt),Ne.points,-1,Se,ze,gt),gt.features.length?gt:null},I.prototype.getClusterExpansionZoom=function(ie){for(var xe=this._getOriginZoom(ie)-1;xe<=this.options.maxZoom;){var Se=this.getChildren(ie);if(xe++,Se.length!==1)break;ie=Se[0].properties.cluster_id}return xe},I.prototype._appendLeaves=function(ie,xe,Se,Ne,ze){for(var Be=this.getChildren(xe),$e=0,it=Be;$e<it.length;$e+=1){var mt=it[$e],Qe=mt.properties;if(Qe&&Qe.cluster?ze+Qe.point_count<=Ne?ze+=Qe.point_count:ze=this._appendLeaves(ie,Qe.cluster_id,Se,Ne,ze):ze<Ne?ze++:ie.push(mt),ie.length===Se)break}return ze},I.prototype._addTileFeatures=function(ie,xe,Se,Ne,ze,Be){for(var $e=0,it=ie;$e<it.length;$e+=1){var mt=it[$e],Qe=xe[mt],rt=Qe.numPoints,gt=void 0,er=void 0,zt=void 0;if(rt)gt=O(Qe),er=Qe.x,zt=Qe.y;else{var qt=this.points[Qe.index];gt=qt.properties,er=F(qt.geometry.coordinates[0]),zt=N(qt.geometry.coordinates[1])}var Zr={type:1,geometry:[[Math.round(this.options.extent*(er*ze-Se)),Math.round(this.options.extent*(zt*ze-Ne))]],tags:gt},Wr=void 0;rt?Wr=Qe.id:this.options.generateId?Wr=Qe.index:this.points[Qe.index].id&&(Wr=this.points[Qe.index].id),Wr!==void 0&&(Zr.id=Wr),Be.features.push(Zr)}},I.prototype._limitZoom=function(ie){return Math.max(this.options.minZoom,Math.min(Math.floor(+ie),this.options.maxZoom+1))},I.prototype._cluster=function(ie,xe){for(var Se=[],Ne=this.options,ze=Ne.radius,Be=Ne.extent,$e=Ne.reduce,it=Ne.minPoints,mt=ze/(Be*Math.pow(2,xe)),Qe=0;Qe<ie.length;Qe++){var rt=ie[Qe];if(!(rt.zoom<=xe)){rt.zoom=xe;for(var gt=this.trees[xe+1],er=gt.within(rt.x,rt.y,mt),zt=rt.numPoints||1,qt=zt,Zr=0,Wr=er;Zr<Wr.length;Zr+=1){var On=Wr[Zr],Ut=gt.points[On];Ut.zoom>xe&&(qt+=Ut.numPoints||1)}if(qt>zt&&qt>=it){for(var Ar=rt.x*zt,an=rt.y*zt,Ft=$e&&zt>1?this._map(rt,!0):null,Mr=(Qe<<5)+(xe+1)+this.points.length,mn=0,Nn=er;mn<Nn.length;mn+=1){var Xn=Nn[mn],qn=gt.points[Xn];if(!(qn.zoom<=xe)){qn.zoom=xe;var Li=qn.numPoints||1;Ar+=qn.x*Li,an+=qn.y*Li,qn.parentId=Mr,$e&&(Ft||(Ft=this._map(rt,!0)),$e(Ft,this._map(qn)))}}rt.parentId=Mr,Se.push(k(Ar/qt,an/qt,Mr,qt,Ft))}else if(Se.push(rt),qt>1)for(var ci=0,Ai=er;ci<Ai.length;ci+=1){var Vi=Ai[ci],za=gt.points[Vi];za.zoom<=xe||(za.zoom=xe,Se.push(za))}}}return Se},I.prototype._getOriginId=function(ie){return ie-this.points.length>>5},I.prototype._getOriginZoom=function(ie){return(ie-this.points.length)%32},I.prototype._map=function(ie,xe){if(ie.numPoints)return xe?Y({},ie.properties):ie.properties;var Se=this.points[ie.index].properties,Ne=this.options.map(Se);return xe&&Ne===Se?Y({},Ne):Ne};function k(ue,ie,xe,Se,Ne){return{x:T(ue),y:T(ie),zoom:1/0,id:xe,parentId:-1,numPoints:Se,properties:Ne}}function D(ue,ie){var xe=ue.geometry.coordinates,Se=xe[0],Ne=xe[1];return{x:T(F(Se)),y:T(N(Ne)),zoom:1/0,index:ie,parentId:-1}}function V(ue){return{type:"Feature",id:ue.id,properties:O(ue),geometry:{type:"Point",coordinates:[H(ue.x),q(ue.y)]}}}function O(ue){var ie=ue.numPoints,xe=ie>=1e4?Math.round(ie/1e3)+"k":ie>=1e3?Math.round(ie/100)/10+"k":ie;return Y(Y({},ue.properties),{cluster:!0,cluster_id:ue.id,point_count:ie,point_count_abbreviated:xe})}function F(ue){return ue/360+.5}function N(ue){var ie=Math.sin(ue*Math.PI/180),xe=.5-.25*Math.log((1+ie)/(1-ie))/Math.PI;return xe<0?0:xe>1?1:xe}function H(ue){return(ue-.5)*360}function q(ue){var ie=(180-ue*360)*Math.PI/180;return 360*Math.atan(Math.exp(ie))/Math.PI-90}function Y(ue,ie){for(var xe in ie)ue[xe]=ie[xe];return ue}function ee(ue){return ue.x}function pe(ue){return ue.y}return I})})(XR);var Fj=XR.exports;const Nj=jc(Fj);function YR(e,t){var r=t.radius,n=r===void 0?40:r,i=t.maxZoom,o=i===void 0?18:i,a=t.minZoom,u=a===void 0?0:a,c=t.zoom,h=c===void 0?2:c;if(e.pointIndex){var y=e.pointIndex.getClusters(e.extent,Math.floor(h));return e.dataArray=Bj(y),e}var x=new Nj({radius:n,minZoom:u,maxZoom:o}),E={type:"FeatureCollection",features:[]};return E.features=e.dataArray.map(function(T){return{type:"Feature",geometry:{type:"Point",coordinates:T.coordinates},properties:_t({},T)}}),x.load(E.features),x}function Bj(e){return e.map(function(t,r){return _t({coordinates:t.geometry.coordinates,_id:r+1},t.properties)})}function zj(e){if(e.length===0)throw new Error("max requires at least one data point");for(var t=e[0],r=1;r<e.length;r++)e[r]>t&&(t=e[r]);return t}function Uj(e){if(e.length===0)throw new Error("min requires at least one data point");for(var t=e[0],r=1;r<e.length;r++)e[r]<t&&(t=e[r]);return t}function qR(e){if(e.length===0)return 0;for(var t=e[0],r=0,n,i=1;i<e.length;i++)n=t+e[i]*1,Math.abs(t)>=Math.abs(e[i])?r+=t-n+e[i]:r+=e[i]-n+t,t=n;return t+r*1}function Vj(e){if(e.length===0)throw new Error("mean requires at least one data point");return qR(e)/e.length}var jj={min:Uj,max:zj,mean:Vj,sum:qR};function $j(e){var t=Gj();return function(){var n=Ct(e),i;if(t){var o=Ct(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xn(this,i)}}function Gj(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Hj(e,t){if(Array.isArray(t))return t}var fS=function(e){yn(r,e);var t=$j(r);function r(n,i){var o;return $t(this,r),o=t.call(this),Q(Ye(o),"type","source"),Q(Ye(o),"isTile",!1),Q(Ye(o),"inited",!1),Q(Ye(o),"hooks",{init:new Rp}),Q(Ye(o),"parser",{type:"geojson"}),Q(Ye(o),"transforms",[]),Q(Ye(o),"cluster",!1),Q(Ye(o),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),Q(Ye(o),"invalidExtent",!1),Q(Ye(o),"dataArrayChanged",!1),Q(Ye(o),"cfg",{autoRender:!0}),o.originData=n,o.initCfg(i),o.init().then(function(){o.inited=!0,o.emit("update",{type:"inited"})}),o}return Gt(r,[{key:"getSourceCfg",value:function(){return this.cfg}},{key:"getClusters",value:function(i){return this.clusterIndex.getClusters(this.caculClusterExtent(2),i)}},{key:"getClustersLeaves",value:function(i){return this.clusterIndex.getLeaves(i,1/0)}},{key:"getParserType",value:function(){return this.parser.type}},{key:"updateClusterData",value:function(i){var o=this,a=this.clusterOptions,u=a.method,c=u===void 0?"sum":u,h=a.field,y=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(i));this.clusterOptions.zoom=i,y.forEach(function(x){x.id||(x.properties.point_count=1)}),(h||Er.isFunction(c))&&(y=y.map(function(x){var E=x.id;if(E){var T=o.clusterIndex.getLeaves(E,1/0),I=T.map(function(V){return V.properties}),k;if(Er.isString(c)&&h){var D=i9(I,h);k=jj[c](D)}Er.isFunction(c)&&(k=c(I)),x.properties.stat=k}else x.properties.point_count=1;return x})),this.data=nA("geojson")({type:"FeatureCollection",features:y}),this.executeTrans()}},{key:"getFeatureById",value:function(i){var o=this.parser,a=o.type,u=a===void 0?"geojson":a,c=o.geometry;if(u==="geojson"&&!this.cluster){var h=i<this.originData.features.length?this.originData.features[i]:"null",y=Er.cloneDeep(h);if(y!=null&&y.properties&&(this.transforms.length!==0||this.dataArrayChanged)){var x=this.data.dataArray.find(function(E){return E._id===i});y.properties=x}return y}else return u==="json"&&c?this.data.dataArray.find(function(E){return E._id===i}):i<this.data.dataArray.length?this.data.dataArray[i]:"null"}},{key:"updateFeaturePropertiesById",value:function(i,o){this.data.dataArray=this.data.dataArray.map(function(a){return a._id===i?_t(_t({},a),o):a}),this.dataArrayChanged=!0,this.emit("update",{type:"update"})}},{key:"getFeatureId",value:function(i,o){var a=this.data.dataArray.find(function(u){return u[i]===o});return a==null?void 0:a._id}},{key:"setData",value:function(i,o){var a=this;this.originData=i,this.dataArrayChanged=!1,this.initCfg(o),this.init().then(function(){a.emit("update",{type:"update"})})}},{key:"reloadAllTile",value:function(){var i;(i=this.tileset)===null||i===void 0||i.reloadAll()}},{key:"reloadTilebyId",value:function(i,o,a){var u;(u=this.tileset)===null||u===void 0||u.reloadTileById(i,o,a)}},{key:"reloadTileByLnglat",value:function(i,o,a){var u;(u=this.tileset)===null||u===void 0||u.reloadTileByLnglat(i,o,a)}},{key:"getTileExtent",value:function(i,o){var a;return(a=this.tileset)===null||a===void 0?void 0:a.getTileExtent(i,o)}},{key:"getTileByZXY",value:function(i,o,a){var u;return(u=this.tileset)===null||u===void 0?void 0:u.getTileByZXY(i,o,a)}},{key:"reloadTileByExtent",value:function(i,o){var a;(a=this.tileset)===null||a===void 0||a.reloadTileByExtent(i,o)}},{key:"destroy",value:function(){var i;this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null,(i=this.tileset)===null||i===void 0||i.destroy()}},{key:"processData",value:function(){var n=Vt(Ce.mark(function o(){var a=this;return Ce.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",new Promise(function(h,y){try{a.excuteParser(),a.initCluster(),a.executeTrans(),h({})}catch(x){y(x)}}));case 1:case"end":return c.stop()}},o)}));function i(){return n.apply(this,arguments)}return i}()},{key:"initCfg",value:function(i){this.cfg=Er.mergeWith(this.cfg,i,Hj);var o=this.cfg;o&&(o.parser&&(this.parser=o.parser),o.transforms&&(this.transforms=o.transforms),this.cluster=o.cluster||!1,o.clusterOptions&&(this.cluster=!0,this.clusterOptions=_t(_t({},this.clusterOptions),o.clusterOptions)))}},{key:"init",value:function(){var n=Vt(Ce.mark(function o(){return Ce.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return this.inited=!1,u.next=3,this.processData();case 3:this.inited=!0;case 4:case"end":return u.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"excuteParser",value:function(){var i=this.parser,o=i.type||"geojson",a=nA(o);this.data=a(this.originData,i),this.tileset=this.initTileset(),!i.cancelExtent&&(this.extent=OF(this.data.dataArray),this.setCenter(this.extent),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3])}},{key:"setCenter",value:function(i){this.center=[(i[0]+i[2])/2,(i[1]+i[3])/2],(isNaN(this.center[0])||isNaN(this.center[1]))&&(this.center=[108.92361111111111,34.54083333333333])}},{key:"initTileset",value:function(){var i=this.data.tilesetOptions;if(i){if(this.isTile=!0,this.tileset)return this.tileset.updateOptions(i),this.tileset;var o=new f7(_t({},i));return o}}},{key:"executeTrans",value:function(){var i=this,o=this.transforms;o.forEach(function(a){var u=a.type,c=WD(u)(i.data,a);Object.assign(i.data,c)})}},{key:"initCluster",value:function(){if(this.cluster){var i=this.clusterOptions||{};this.clusterIndex=YR(this.data,i)}}},{key:"caculClusterExtent",value:function(i){var o=[[-1/0,-1/0],[1/0,1/0]];return this.invalidExtent||(o=jE(Y1(this.extent),i)),o[0].concat(o[1])}}]),r}(tc.EventEmitter);function Wj(e,t){var r=t.callback;return r&&(e.dataArray=e.dataArray.filter(r)),e}function HC(e,t){var r=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Xj(e))||t&&e&&typeof e.length=="number"){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(h){throw h},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,a=!1,u;return{s:function(){r=r.call(e)},n:function(){var h=r.next();return o=h.done,h},e:function(h){a=!0,u=h},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(a)throw u}}}}function Xj(e,t){if(e){if(typeof e=="string")return WC(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return WC(e,t)}}function WC(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var hS=6378e3;function Yj(e,t){var r=e.dataArray,n=t.size,i=n===void 0?10:n,o=i/(2*Math.PI*hS)*(256<<20)/2,a=qj(r,i),u=a.gridHash,c=a.gridOffset,h=Jj(u,c,t);return{yOffset:o,xOffset:o,radius:o,type:"grid",dataArray:h}}function qj(e,t){var r=1/0,n=-1/0,i,o=HC(e),a;try{for(o.s();!(a=o.n()).done;){var u=a.value;i=u.coordinates[1],Number.isFinite(i)&&(r=i<r?i:r,n=i>n?i:n)}}catch(F){o.e(F)}finally{o.f()}var c=(r+n)/2,h=Zj(t,c);if(h.xOffset<=0||h.yOffset<=0)return{gridHash:{},gridOffset:h};var y={},x=HC(e),E;try{for(x.s();!(E=x.n()).done;){var T=E.value,I=T.coordinates[1],k=T.coordinates[0];if(Number.isFinite(I)&&Number.isFinite(k)){var D=Math.floor((I+90)/h.yOffset),V=Math.floor((k+180)/h.xOffset),O="".concat(D,"-").concat(V);y[O]=y[O]||{count:0,points:[]},y[O].count+=1,y[O].points.push(T)}}}catch(F){x.e(F)}finally{x.f()}return{gridHash:y,gridOffset:h}}function Zj(e,t){var r=Kj(e),n=Qj(t,e);return{yOffset:r,xOffset:n}}function Kj(e){return e/hS*(180/Math.PI)}function Qj(e,t){return t/hS*(180/Math.PI)/Math.cos(e*Math.PI/180)}function Jj(e,t,r){return Object.keys(e).reduce(function(n,i,o){var a=i.split("-"),u=parseInt(a[0],10),c=parseInt(a[1],10),h={};if(r.field&&r.method){var y=VI(e[i].points,r.field);h[r.method]=UI[r.method](y)}return Object.assign(h,{_id:o,coordinates:Vu([-180+t.xOffset*(c+.5),-90+t.yOffset*(u+.5)]),rawData:e[i].points,count:e[i].count}),n.push(h),n},[])}var R0=Math.PI/3,e$=[0,R0,2*R0,3*R0,4*R0,5*R0];function t$(e){return e[0]}function r$(e){return e[1]}function n$(){var e=0,t=0,r=1,n=1,i=t$,o=r$,a,u,c;function h(x){var E={},T=[],I,k=x.length;for(I=0;I<k;++I)if(!(isNaN(V=+i.call(null,D=x[I],I,x))||isNaN(O=+o.call(null,D,I,x)))){var D,V,O,F=Math.round(O=O/c),N=Math.round(V=V/u-(F&1)/2),H=O-F;if(Math.abs(H)*3>1){var q=V-N,Y=N+(V<N?-1:1)/2,ee=F+(O<F?-1:1),pe=V-Y,ue=O-ee;q*q+H*H>pe*pe+ue*ue&&(N=Y+(F&1?1:-1)/2,F=ee)}var ie=N+"-"+F,xe=E[ie];xe?xe.push(D):(T.push(xe=E[ie]=[D]),xe.x=(N+(F&1)/2)*u,xe.y=F*c)}return T}function y(x){var E=0,T=0;return e$.map(function(I){var k=Math.sin(I)*x,D=-Math.cos(I)*x,V=k-E,O=D-T;return E=k,T=D,[V,O]})}return h.hexagon=function(x){return"m"+y(x==null?a:+x).join("l")+"z"},h.centers=function(){for(var x=[],E=Math.round(t/c),T=Math.round(e/u),I=E*c;I<n+a;I+=c,++E)for(var k=T*u+(E&1)*u/2;k<r+u/2;k+=u)x.push([k,I]);return x},h.mesh=function(){var x=y(a).slice(0,4).join("l");return h.centers().map(function(E){return"M"+E+"m"+x}).join("")},h.x=function(x){return arguments.length?(i=x,h):i},h.y=function(x){return arguments.length?(o=x,h):o},h.radius=function(x){return arguments.length?(a=+x,u=a*2*Math.sin(R0),c=a*1.5,h):a},h.size=function(x){return arguments.length?(e=t=0,r=+x[0],n=+x[1],h):[r-e,n-t]},h.extent=function(x){return arguments.length?(e=+x[0][0],t=+x[0][1],r=+x[1][0],n=+x[1][1],h):[[e,t],[r,n]]},h.radius(1)}var i$=6378e3;function a$(e,t){var r=e.dataArray,n=t.size,i=n===void 0?10:n,o=t.method,a=o===void 0?"sum":o,u=i/(2*Math.PI*i$)*(256<<20)/2,c=r.map(function(E){var T=Vu(E.coordinates),I=ei(T,2),k=I[0],D=I[1];return _t(_t({},E),{},{coordinates:[k,D]})}),h=n$().radius(u).x(function(E){return E.coordinates[0]}).y(function(E){return E.coordinates[1]}),y=h(c),x={dataArray:y.map(function(E,T){var I;if(t.field&&a){var k=VI(E,t.field);E[a]=UI[a](k)}return I={},Q(I,t.method,E[a]),Q(I,"count",E.length),Q(I,"rawData",E),Q(I,"coordinates",[E.x,E.y]),Q(I,"_id",T),I}),radius:u,xOffset:u,yOffset:u,type:"hexagon"};return x}function o$(e,t){var r=t.sourceField,n=t.targetField,i=t.data,o={};return i.forEach(function(a){o[a[r]]=a}),e.dataArray=e.dataArray.map(function(a){var u=a[n];return _t(_t({},a),o[u])}),e}function s$(e,t){var r=t.callback;return r&&(e.dataArray=e.dataArray.map(r)),e}Gp("rasterTile",Ij);Gp("mvt",KB);Gp("geojsonvt",J6);Gp("testTile",Dj);Gp("geojson",P6);Gp("image",_R);Gp("csv",T6);Gp("json",sI);Gp("raster",a9);Gp("rasterRgb",Lj);Ag("cluster",YR);Ag("filter",Wj);Ag("join",o$);Ag("map",s$);Ag("grid",Yj);Ag("hexagon",a$);window._iconfont_svg_string_3580659='<svg><symbol id="l7-icon-area1" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.064889 219.136l38.798223 466.261333a113.777778 113.777778 0 1 1-133.518223 145.237334H279.210667a113.777778 113.777778 0 1 1-60.302223-137.272889L697.856 227.555556A113.777778 113.777778 0 0 1 796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m577.592889-534.072889L269.198222 796.444444c4.152889 7.168 7.509333 14.791111 10.012445 22.812445h465.578666a114.119111 114.119111 0 0 1 65.479111-71.224889l-38.798222-466.261333a112.924444 112.924444 0 0 1-23.210666-7.964445zM796.444444 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-area" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.008 219.136l38.855112 466.261333a113.777778 113.777778 0 0 1-16.497778 224.540445L853.333333 967.111111a113.777778 113.777778 0 0 1-108.544-79.644444H279.210667a113.834667 113.834667 0 0 1-100.067556 79.36L170.666667 967.111111a113.777778 113.777778 0 0 1-17.066667-226.304l30.492444-351.175111a113.777778 113.777778 0 0 1 34.986667-218.680889L227.555556 170.666667a113.777778 113.777778 0 0 1 99.896888 59.221333l355.84-71.395556a113.777778 113.777778 0 0 1 104.675556-101.262222L796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m526.051555-582.314666L340.650667 296.903111a113.891556 113.891556 0 0 1-88.462223 98.645333l-30.947555 355.84c27.477333 13.653333 48.64 38.115556 58.026667 67.754667h465.521777a114.119111 114.119111 0 0 1 65.536-71.168l-38.855111-466.261333a113.948444 113.948444 0 0 1-74.752-56.206222zM227.555556 238.933333a45.511111 45.511111 0 1 0 0 91.022223 45.511111 45.511111 0 0 0 0-91.022223z m568.888888-113.777777a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-delete" viewBox="0 0 1024 1024"><path d="M705.422222 85.333333a34.133333 34.133333 0 0 1 34.133334 34.133334V227.555556h136.533333a34.133333 34.133333 0 0 1 0 68.266666h-25.543111l-24.348445 610.076445a34.133333 34.133333 0 0 1-34.133333 32.768H231.936a34.133333 34.133333 0 0 1-34.076444-32.768L173.340444 295.822222H147.911111a34.133333 34.133333 0 1 1 0-68.266666H284.444444V119.466667a34.133333 34.133333 0 0 1 34.133334-34.133334h386.844444zM241.720889 295.822222l22.983111 574.577778h494.535111l23.04-574.577778H241.720889zM671.288889 153.6H352.711111V227.555556h318.577778V153.6z"  ></path></symbol><symbol id="l7-icon-color" viewBox="0 0 1024 1024"><path d="M512 56.888889c9.841778 0 19.626667 0.341333 29.354667 0.910222 69.176889 4.437333 119.068444 62.577778 124.302222 131.072l0.455111 9.386667c0.739556 44.600889 15.303111 84.935111 44.999111 114.631111 27.022222 27.022222 62.805333 41.528889 102.570667 44.430222l12.060444 0.568889c72.476444 1.194667 135.793778 52.451556 140.458667 124.757333 1.137778 18.261333 1.251556 36.807111 0.170667 55.637334-13.198222 233.585778-211.399111 424.220444-445.326223 428.714666L512 967.111111a455.111111 455.111111 0 0 1-455.054222-464.156444c4.551111-233.927111 195.185778-432.128 428.771555-445.326223C494.535111 57.116444 503.296 56.888889 512 56.888889z m0 68.266667a385.706667 385.706667 0 0 0-22.414222 0.625777C291.726222 136.988444 129.080889 305.948444 125.155556 504.263111c-4.152889 212.366222 163.100444 387.185778 372.508444 394.353778l13.425778 0.227555 8.533333-0.113777c198.371556-3.811556 367.331556-166.456889 378.538667-364.373334a396.174222 396.174222 0 0 0-0.170667-47.331555c-1.991111-31.232-29.127111-56.604444-67.128889-60.472889l-8.248889-0.455111-14.051555-0.682667c-56.547556-4.209778-107.406222-25.884444-145.806222-64.284444-38.855111-38.798222-60.416-90.225778-64.284445-145.749334l-0.910222-21.333333c-2.901333-38.001778-28.785778-66.048-60.302222-68.096A433.891556 433.891556 0 0 0 512 125.155556zM438.044444 682.666667a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m-170.666666-227.555556a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m142.222222-227.555555a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z"  ></path></symbol><symbol id="l7-icon-base-map" viewBox="0 0 1024 1024"><path d="M923.761778 115.029333A34.133333 34.133333 0 0 1 967.111111 147.911111v624.128a34.133333 34.133333 0 0 1-22.186667 32.028445l-278.755555 103.992888a34.133333 34.133333 0 0 1-23.665778 0.056889L381.724444 812.714667a34.133333 34.133333 0 0 0-23.665777 0.113777L102.968889 908.060444a34.133333 34.133333 0 0 1-45.738667-26.965333L56.888889 876.088889V251.960889a34.133333 34.133333 0 0 1 22.186667-32.028445l278.755555-103.992888a34.133333 34.133333 0 0 1 20.992-0.967112l266.183111 72.988445a34.133333 34.133333 0 0 0 18.204445 0zM403.911111 192.625778v555.576889l216.177778 79.075555V251.960889l-216.177778-59.335111z m-68.266667 4.380444L125.155556 275.569778v551.310222l210.432-78.506667V197.006222zM898.844444 192.853333l-210.545777 58.936889v575.089778l210.545777-78.563556V192.853333z"  ></path></symbol><symbol id="l7-icon-dot" viewBox="0 0 1024 1024"><path d="M341.333333 739.555556a113.777778 113.777778 0 0 1 8.533334 227.271111L341.333333 967.111111a113.777778 113.777778 0 0 1-8.533333-227.271111L341.333333 739.555556z m0 68.266666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM910.222222 341.333333a113.777778 113.777778 0 0 1 8.533334 227.271111L910.222222 568.888889a113.777778 113.777778 0 0 1-8.533333-227.271111L910.222222 341.333333z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM227.555556 56.888889a113.777778 113.777778 0 0 1 8.533333 227.271111L227.555556 284.444444a113.777778 113.777778 0 0 1-8.533334-227.271111L227.555556 56.888889z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-display" viewBox="0 0 1024 1024"><path d="M512 170.666667c284.444444 0 455.111111 227.555556 455.111111 341.333333s-170.666667 341.333333-455.111111 341.333333-455.111111-227.555556-455.111111-341.333333 170.666667-341.333333 455.111111-341.333333z m0 68.266666C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 110.762667 178.574222 273.066667 386.844444 273.066667s386.844444-162.304 386.844444-273.066667c0-110.762667-178.574222-273.066667-386.844444-273.066667zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-enlarge" viewBox="0 0 1024 1024"><path d="M546.133333 147.911111l-0.056889 329.955556H876.088889a34.133333 34.133333 0 0 1 0 68.266666H546.076444v329.955556a34.133333 34.133333 0 0 1-68.266666 0V546.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h329.898667V147.911111a34.133333 34.133333 0 0 1 68.266666 0z"  ></path></symbol><symbol id="l7-icon-export-picture" viewBox="0 0 1024 1024"><path d="M883.873684 161.684211a32.336842 32.336842 0 0 1 32.336842 32.336842v582.063158a32.336842 32.336842 0 0 1-32.336842 32.336842H86.231579a32.336842 32.336842 0 0 1-32.336842-32.336842V194.021053a32.336842 32.336842 0 0 1 32.336842-32.336842h797.642105z m-32.336842 64.673684H118.568421v517.389473h170.792421a32.175158 32.175158 0 0 1 0.431158-0.646736l3.772632-4.473264 330.320842-330.374736a32.336842 32.336842 0 0 1 38.588631-5.389474l4.473263 3.018105 184.589474 147.725474V226.357895z m-202.428631 248.131368L379.850105 743.747368H851.536842v-107.304421l-202.428631-161.953684zM323.368421 323.368421a107.789474 107.789474 0 1 1 0 215.578947 107.789474 107.789474 0 0 1 0-215.578947z m0 64.673684a43.115789 43.115789 0 1 0 0 86.231579 43.115789 43.115789 0 0 0 0-86.231579z"  ></path></symbol><symbol id="l7-icon-exit-fullscreen" viewBox="0 0 1024 1024"><path d="M841.955556 591.644444a34.133333 34.133333 0 0 1 5.518222 67.811556l-5.518222 0.455111h-133.745778l192 192.056889a34.133333 34.133333 0 0 1-38.343111 55.182222l-5.176889-2.958222-4.721778-3.982222L659.911111 708.266667V841.955556a34.133333 34.133333 0 0 1-28.615111 33.678222L625.777778 876.088889a34.133333 34.133333 0 0 1-33.678222-28.615111L591.644444 841.955556V625.777778a34.133333 34.133333 0 0 1 28.615112-33.678222L625.777778 591.644444h216.177778z m-443.733334 0a34.133333 34.133333 0 0 1 33.678222 28.615112L432.355556 625.777778v216.177778a34.133333 34.133333 0 0 1-67.811556 5.518222L364.088889 841.955556v-133.745778l-192.056889 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L315.847111 659.911111H182.044444a34.133333 34.133333 0 0 1-33.678222-28.615111L147.911111 625.777778a34.133333 34.133333 0 0 1 28.615111-33.678222L182.044444 591.644444H398.222222zM167.310222 119.808l4.721778 3.982222L364.088889 315.847111V182.044444a34.133333 34.133333 0 0 1 28.615111-33.678222L398.222222 147.911111a34.133333 34.133333 0 0 1 33.678222 28.615111L432.355556 182.044444V398.222222a34.133333 34.133333 0 0 1-28.615112 33.678222L398.222222 432.355556H182.044444a34.133333 34.133333 0 0 1-5.518222-67.811556L182.044444 364.088889h133.802667L123.790222 172.032a34.133333 34.133333 0 0 1 43.52-52.224z m732.899556 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L708.266667 364.088889H841.955556a34.133333 34.133333 0 0 1 33.678222 28.615111L876.088889 398.222222a34.133333 34.133333 0 0 1-28.615111 33.678222L841.955556 432.355556H625.777778a34.133333 34.133333 0 0 1-33.678222-28.615112L591.644444 398.222222V182.044444a34.133333 34.133333 0 0 1 67.811556-5.518222l0.455111 5.518222v133.802667l192.056889-192.056889a34.133333 34.133333 0 0 1 48.241778 0z"  ></path></symbol><symbol id="l7-icon-line" viewBox="0 0 1024 1024"><path d="M853.333333 56.888889a113.777778 113.777778 0 0 1 8.533334 227.271111L853.333333 284.444444c-19.000889 0-36.864-4.664889-52.622222-12.856888l-529.123555 529.066666a113.777778 113.777778 0 0 1-92.387556 166.115556L170.666667 967.111111a113.777778 113.777778 0 0 1-8.533334-227.271111L170.666667 739.555556c19.000889 0 36.864 4.664889 52.622222 12.856888l529.123555-529.066666a113.777778 113.777778 0 0 1 92.387556-166.115556L853.333333 56.888889zM170.666667 807.822222a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m682.666666-682.666666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-layer" viewBox="0 0 1024 1024"><path d="M767.089778 625.777778l180.167111 82.773333a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730667-420.977778 193.422222a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422222a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730667L256.853333 625.777778l81.749334 37.546666L172.771556 739.555556 512 895.374222 851.171556 739.555556l-165.831112-76.231112 81.749334-37.546666z m0-227.555556l180.167111 82.773334a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730666-420.977778 193.422223a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422223a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730666L256.853333 398.222222l81.749334 37.546667-165.831111 76.174222L512 667.818667l339.171556-155.875556-165.831112-76.174222L767.089778 398.222222zM497.720889 60.017778a34.133333 34.133333 0 0 1 28.558222 0l420.977778 193.422222a34.133333 34.133333 0 0 1 0 62.008889l-420.977778 193.422222a34.133333 34.133333 0 0 1-28.558222 0l-420.977778-193.422222a34.133333 34.133333 0 0 1 0-62.008889zM512 128.568889L172.771556 284.387556 512 440.263111l339.171556-155.875555L512 128.568889z"  ></path></symbol><symbol id="l7-icon-narrow" viewBox="0 0 1024 1024"><path d="M910.222222 512a34.133333 34.133333 0 0 1-34.133333 34.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h728.177778a34.133333 34.133333 0 0 1 34.133333 34.133333z"  ></path></symbol><symbol id="l7-icon-fullscreen" viewBox="0 0 1024 1024"><path d="M645.176889 597.674667l4.721778 3.982222L841.955556 793.6l0.056888-133.688889a34.133333 34.133333 0 0 1 28.615112-33.678222L876.088889 625.777778a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 659.911111v216.177778a34.133333 34.133333 0 0 1-28.615111 33.678222L876.088889 910.222222h-216.177778a34.133333 34.133333 0 0 1-5.518222-67.811555l5.518222-0.455111h133.745778l-192-192.056889a34.133333 34.133333 0 0 1 43.52-52.224z m-222.833778 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L230.286222 841.955556H364.088889a34.133333 34.133333 0 0 1 33.678222 28.615111L398.222222 876.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L364.088889 910.222222H147.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 876.088889v-216.177778a34.133333 34.133333 0 0 1 67.811555-5.518222l0.455111 5.518222-0.056888 133.745778 192.113777-192a34.133333 34.133333 0 0 1 48.241778 0zM364.088889 113.777778a34.133333 34.133333 0 0 1 5.518222 67.811555L364.088889 182.044444H230.343111l192 192.056889a34.133333 34.133333 0 0 1-43.52 52.224l-4.721778-3.982222-192.113777-192.056889L182.044444 364.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L147.911111 398.222222a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 364.088889V147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L147.911111 113.777778h216.177778z m512 0a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 147.911111v216.177778a34.133333 34.133333 0 0 1-67.811555 5.518222L841.955556 364.088889l-0.056889-133.745778-192 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L793.6 182.044444H659.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L625.777778 147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L659.911111 113.777778h216.177778z"  ></path></symbol><symbol id="l7-icon-hide" viewBox="0 0 1024 1024"><path d="M875.52 87.836444a34.133333 34.133333 0 0 1 7.281778 43.121778l-3.527111 5.006222-682.666667 796.444445a34.133333 34.133333 0 0 1-55.409778-39.367111l3.527111-5.006222 97.166223-113.379556C123.164444 697.969778 56.888889 582.940444 56.888889 512c0-113.777778 170.666667-341.333333 455.111111-341.333333a496.64 496.64 0 0 1 208.952889 45.112889l106.439111-124.188445a34.133333 34.133333 0 0 1 48.128-3.754667z m-38.684444 202.524445C921.031111 362.951111 967.111111 452.835556 967.111111 512c0 113.777778-170.666667 341.333333-455.111111 341.333333-50.631111 0-97.678222-7.224889-140.8-19.740444l50.232889-58.595556A417.393778 417.393778 0 0 0 512 785.066667c208.270222 0 386.844444-162.304 386.844444-273.066667 0-52.849778-40.675556-117.418667-105.813333-170.496l43.804445-51.2zM512 238.933333C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 66.787556 64.853333 152.291556 162.133333 209.692444L377.173333 616.675556a170.666667 170.666667 0 0 1 217.713778-253.895112l78.620445-91.704888A432.924444 432.924444 0 0 0 512 238.933333z m166.684444 236.088889a170.666667 170.666667 0 0 1-177.664 207.303111l177.607112-207.303111zM512 409.6a102.4 102.4 0 0 0-88.746667 153.486222L548.864 416.426667A102.172444 102.172444 0 0 0 512 409.6z"  ></path></symbol><symbol id="l7-icon-rectangle" viewBox="0 0 1024 1024"><path d="M170.666667 56.888889a113.777778 113.777778 0 0 1 108.544 79.644444H853.333333a34.133333 34.133333 0 0 1 33.678223 28.615111L887.466667 170.666667v574.122666a113.777778 113.777778 0 1 1-142.677334 142.734223L170.666667 887.466667a34.133333 34.133333 0 0 1-33.678223-28.615111L136.533333 853.333333V279.210667A113.777778 113.777778 0 0 1 170.666667 56.888889z m682.666666 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-34.133333-603.022222H279.210667a114.062222 114.062222 0 0 1-74.353778 74.410667L204.8 819.2h539.989333a114.062222 114.062222 0 0 1 74.410667-74.410667V204.8zM170.666667 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-ranging" viewBox="0 0 1024 1024"><path d="M723.171556 50.403556l250.424888 250.424888a31.061333 31.061333 0 0 1 0 43.918223L344.746667 973.596444a31.061333 31.061333 0 0 1-43.918223 0L50.403556 723.171556a31.061333 31.061333 0 0 1 0-43.918223L679.253333 50.403556a31.061333 31.061333 0 0 1 43.918223 0z m-21.959112 74.524444l-39.765333 39.822222 98.986667 98.872889a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222 62.179556 62.122667a34.133333 34.133333 0 0 1-44.088889 51.882667L563.2 387.242667 501.077333 325.063111 437.191111 388.949333l98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222L387.242667 563.2a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.584-62.122667-62.179556-63.886222 63.886222 98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-39.765333 39.822222 197.802667 197.745778 576.284444-576.284444-197.802667-197.745778z"  ></path></symbol><symbol id="l7-icon-reposition" viewBox="0 0 1024 1024"><path d="M512 56.888889a34.133333 34.133333 0 0 1 34.133333 34.133333v24.177778A398.336 398.336 0 0 1 908.856889 477.866667h24.177778a34.133333 34.133333 0 0 1 0 68.266666h-24.177778A398.336 398.336 0 0 1 546.133333 908.856889L546.133333 932.977778a34.133333 34.133333 0 0 1-68.266666 0v-24.177778A398.336 398.336 0 0 1 115.2 546.133333L91.022222 546.133333a34.133333 34.133333 0 1 1 0-68.266666h24.177778A398.336 398.336 0 0 1 477.866667 115.2V91.022222A34.133333 34.133333 0 0 1 512 56.888889z m34.190222 126.862222L546.133333 193.422222a34.133333 34.133333 0 1 1-68.266666 0v-9.671111A330.069333 330.069333 0 0 0 183.751111 477.866667h9.671111a34.133333 34.133333 0 1 1 0 68.266666l-9.671111 0.056889A330.069333 330.069333 0 0 0 477.866667 840.248889V830.577778a34.133333 34.133333 0 0 1 68.266666 0l0.056889 9.671111A330.069333 330.069333 0 0 0 840.248889 546.133333L830.577778 546.133333a34.133333 34.133333 0 0 1 0-68.266666h9.671111A330.069333 330.069333 0 0 0 546.133333 183.751111zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-round" viewBox="0 0 1024 1024"><path d="M512 56.888889a455.111111 455.111111 0 0 1 391.395556 687.502222 113.777778 113.777778 0 0 1-159.061334 158.890667A455.111111 455.111111 0 0 1 120.604444 279.608889 113.777778 113.777778 0 0 1 279.608889 120.604444 452.835556 452.835556 0 0 1 512 56.888889z m0 68.266667a384.910222 384.910222 0 0 0-191.715556 50.744888A113.777778 113.777778 0 0 1 175.957333 320.284444a386.844444 386.844444 0 0 0 527.815111 527.758223 113.777778 113.777778 0 0 1 144.270223-144.440889A386.844444 386.844444 0 0 0 512 125.155556z m299.406222 640.739555a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM212.593778 167.082667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-guanbi" viewBox="0 0 1024 1024"><path d="M576 512l277.333333 277.333333-64 64-277.333333-277.333333L234.666667 853.333333 170.666667 789.333333l277.333333-277.333333L170.666667 234.666667 234.666667 170.666667l277.333333 277.333333L789.333333 170.666667 853.333333 234.666667 576 512z"  ></path></symbol></svg>',function(e){try{let h=function(){u||(u=!0,o())},y=function(){try{a.documentElement.doScroll("left")}catch{return void setTimeout(y,50)}h()};var r=(r=document.getElementsByTagName("script"))[r.length-1],t=r.getAttribute("data-injectcss"),r=r.getAttribute("data-disable-injectsvg");if(!r){var n,i,o,a,u,c=function(E,T){T.parentNode.insertBefore(E,T)};if(t&&!e.__iconfont__svg__cssinject__){e.__iconfont__svg__cssinject__=!0;try{document.write("<style>.svgfont {display: inline-block;width: 1em;height: 1em;fill: currentColor;vertical-align: -0.1em;font-size:16px;}</style>")}catch{}}n=function(){var E,T=document.createElement("div");T.innerHTML=e._iconfont_svg_string_3580659,(T=T.getElementsByTagName("svg")[0])&&(T.setAttribute("aria-hidden","true"),T.style.position="absolute",T.style.width=0,T.style.height=0,T.style.overflow="hidden",T=T,(E=document.body).firstChild?c(T,E.firstChild):E.appendChild(T))},document.addEventListener?~["complete","loaded","interactive"].indexOf(document.readyState)?setTimeout(n,0):(i=function(){document.removeEventListener("DOMContentLoaded",i,!1),n()},document.addEventListener("DOMContentLoaded",i,!1)):document.attachEvent&&(o=n,a=e.document,u=!1,y(),a.onreadystatechange=function(){a.readyState=="complete"&&(a.onreadystatechange=null,h())})}}catch{}}(window);function u$(e){var t=l$();return function(){var n=Ct(e),i;if(t){var o=Ct(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xn(this,i)}}function l$(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var ZR=function(e){yn(r,e);var t=u$(r);function r(n){var i;return $t(this,r),i=t.call(this),r.controlCount++,i.controlOption=_t(_t({},i.getDefault(n)),n||{}),i}return Gt(r,[{key:"getOptions",value:function(){return this.controlOption}},{key:"setOptions",value:function(i){var o=this.getDefault(i);Object.entries(i).forEach(function(a){var u=ei(a,2),c=u[0],h=u[1];h===void 0&&(i[c]=o[c])}),"position"in i&&this.setPosition(i.position),"className"in i&&this.setClassName(i.className),"style"in i&&this.setStyle(i.style),this.controlOption=_t(_t({},this.controlOption),i)}},{key:"addTo",value:function(i){this.mapsService=i.get(Mt.IMapService),this.renderService=i.get(Mt.IRendererService),this.layerService=i.get(Mt.ILayerService),this.controlService=i.get(Mt.IControlService),this.configService=i.get(Mt.IGlobalConfigService),this.scene=i.get(Mt.ISceneService),this.sceneContainer=i,this.isShow=!0,this.container=this.onAdd(),Im(this.container,"l7-control");var o=this.controlOption,a=o.className,u=o.style;return a&&this.setClassName(a),u&&this.setStyle(u),this.insertContainer(),this.emit("add",this),this}},{key:"remove",value:function(){if(!this.mapsService)return this;Td(this.container),this.onRemove(),this.emit("remove",this)}},{key:"onAdd",value:function(){return $u("div")}},{key:"onRemove",value:function(){}},{key:"show",value:function(){var i=this.container;W1(i,"l7-control--hide"),this.isShow=!0,this.emit("show",this)}},{key:"hide",value:function(){var i=this.container;Im(i,"l7-control--hide"),this.isShow=!1,this.emit("hide",this)}},{key:"getDefault",value:function(i){return{position:q0.TOPRIGHT,name:"".concat(r.controlCount)}}},{key:"getContainer",value:function(){return this.container}},{key:"getIsShow",value:function(){return this.isShow}},{key:"_refocusOnMap",value:function(i){if(this.mapsService&&i&&i.screenX>0&&i.screenY>0){var o=this.mapsService.getContainer();o!==null&&o.focus()}}},{key:"setPosition",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:q0.TOPLEFT,o=this.controlService;return o&&o.removeControl(this),this.controlOption.position=i,o&&o.addControl(this,this.sceneContainer),this}},{key:"setClassName",value:function(i){var o=this.container,a=this.controlOption.className;a&&W1(o,a),i&&Im(o,i)}},{key:"setStyle",value:function(i){var o=this.container;i?o.setAttribute("style",i):o.removeAttribute("style")}},{key:"insertContainer",value:function(){var i=this.controlOption.position,o=this.container;if(i instanceof Element)i.appendChild(o);else{var a=this.controlService.controlCorners[i];["bottomleft","bottomright","righttop","rightbottom"].includes(i)?a.insertBefore(o,a.firstChild):a.appendChild(o)}}},{key:"checkUpdateOption",value:function(i,o){return o.some(function(a){return a in i})}}]),r}(Cg);Q(ZR,"controlCount",0);function c$(e){var t=f$();return function(){var n=Ct(e),i;if(t){var o=Ct(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xn(this,i)}}function f$(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var h$=function(e){yn(r,e);var t=c$(r);function r(n,i){var o;return $t(this,r),o=t.call(this),Q(Ye(o),"isShow",!1),Q(Ye(o),"timeout",null),Q(Ye(o),"show",function(){return o.isShow||!o.contentDOM.innerHTML||(o.resetPopperPosition(),W1(o.popperDOM,"l7-popper-hide"),o.isShow=!0,o.option.unique&&r.conflictPopperList.forEach(function(a){a!==Ye(o)&&a.isShow&&a.hide()}),o.emit("show")),Ye(o)}),Q(Ye(o),"hide",function(){return o.isShow&&(Im(o.popperDOM,"l7-popper-hide"),o.isShow=!1,o.emit("hide")),Ye(o)}),Q(Ye(o),"setHideTimeout",function(){o.timeout||(o.timeout=window.setTimeout(function(){o.isShow&&(o.hide(),o.timeout=null)},300))}),Q(Ye(o),"clearHideTimeout",function(){o.timeout&&(window.clearTimeout(o.timeout),o.timeout=null)}),Q(Ye(o),"onBtnClick",function(){o.isShow?o.hide():o.show()}),Q(Ye(o),"onBtnMouseLeave",function(){o.setHideTimeout()}),Q(Ye(o),"onBtnMouseMove",function(){o.clearHideTimeout(),!o.isShow&&o.show()}),o.button=n,o.option=i,o.init(),i.unique&&r.conflictPopperList.push(Ye(o)),o}return Gt(r,[{key:"buttonRect",get:function(){return this.button.getBoundingClientRect()}},{key:"getPopperDOM",value:function(){return this.popperDOM}},{key:"getIsShow",value:function(){return this.isShow}},{key:"getContent",value:function(){return this.content}},{key:"setContent",value:function(i){typeof i=="string"?this.contentDOM.innerHTML=i:i instanceof HTMLElement&&(VE(this.contentDOM),this.contentDOM.appendChild(i)),this.content=i}},{key:"init",value:function(){var i=this.option.trigger;this.popperDOM=this.createPopper(),i==="click"?this.button.addEventListener("click",this.onBtnClick):(this.button.addEventListener("mousemove",this.onBtnMouseMove),this.button.addEventListener("mouseleave",this.onBtnMouseLeave),this.popperDOM.addEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.addEventListener("mouseleave",this.onBtnMouseLeave))}},{key:"destroy",value:function(){this.button.removeEventListener("click",this.onBtnClick),this.button.removeEventListener("mousemove",this.onBtnMouseMove),this.button.removeEventListener("mousemove",this.onBtnMouseLeave),this.popperDOM.removeEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.removeEventListener("mouseleave",this.onBtnMouseLeave),Td(this.popperDOM)}},{key:"resetPopperPosition",value:function(){var i={},o=this.option,a=o.container,u=o.offset,c=u===void 0?[0,0]:u,h=o.placement,y=ei(c,2),x=y[0],E=y[1],T=this.button.getBoundingClientRect(),I=a.getBoundingClientRect(),k=PF(T,I),D=k.left,V=k.right,O=k.top,F=k.bottom,N=!1,H=!1;/^(left|right)/.test(h)?(h.includes("left")?i.right="".concat(T.width+V,"px"):h.includes("right")&&(i.left="".concat(T.width+D,"px")),h.includes("start")?i.top="".concat(O,"px"):h.includes("end")?i.bottom="".concat(F,"px"):(i.top="".concat(O+T.height/2,"px"),H=!0,i.transform="translate(".concat(x,"px, calc(").concat(E,"px - 50%))"))):/^(top|bottom)/.test(h)&&(h.includes("top")?i.bottom="".concat(T.height+F,"px"):h.includes("bottom")&&(i.top="".concat(T.height+O,"px")),h.includes("start")?i.left="".concat(D,"px"):h.includes("end")?i.right="".concat(V,"px"):(i.left="".concat(D+T.width/2,"px"),N=!0,i.transform="translate(calc(".concat(x,"px - 50%), ").concat(E,"px)"))),i.transform="translate(calc(".concat(x,"px - ").concat(N?"50%":"0%","), calc(").concat(E,"px - ").concat(H?"50%":"0%",")");var q=h.split("-");q.length&&Im(this.popperDOM,q.map(function(Y){return"l7-popper-".concat(Y)}).join(" ")),CF(this.popperDOM,MF(i))}},{key:"createPopper",value:function(){var i=this.option,o=i.container,a=i.className,u=a===void 0?"":a,c=i.content,h=$u("div","l7-popper l7-popper-hide ".concat(u)),y=$u("div","l7-popper-content"),x=$u("div","l7-popper-arrow");return h.appendChild(y),h.appendChild(x),o.appendChild(h),this.popperDOM=h,this.contentDOM=y,c&&this.setContent(c),h}}]),r}(tc.EventEmitter);Q(h$,"conflictPopperList",[]);var p$=function(t){var r=document.createElementNS("http://www.w3.org/2000/svg","svg");r.classList.add("l7-iconfont"),r.setAttribute("aria-hidden","true");var n=document.createElementNS("http://www.w3.org/2000/svg","use");return n.setAttributeNS("http://www.w3.org/1999/xlink","href","#".concat(t)),r.appendChild(n),r};function d$(e,t){var r=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=v$(e))||t&&e&&typeof e.length=="number"){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(h){throw h},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,a=!1,u;return{s:function(){r=r.call(e)},n:function(){var h=r.next();return o=h.done,h},e:function(h){a=!0,u=h},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(a)throw u}}}}function v$(e,t){if(e){if(typeof e=="string")return XC(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return XC(e,t)}}function XC(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var YC=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],Rd=function(){if(typeof document>"u")return!1;for(var e=YC[0],t={},r=0,n=YC;r<n.length;r++){var i=n[r],o=i==null?void 0:i[1];if(o in document){var a=d$(i.entries()),u;try{for(a.s();!(u=a.n()).done;){var c=ei(u.value,2),h=c[0],y=c[1];t[e[h]]=y}}catch(x){a.e(x)}finally{a.f()}return t}}return!1}(),qC={change:Rd.fullscreenchange,error:Rd.fullscreenerror},Xf={request:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:document.documentElement,r=arguments.length>1?arguments[1]:void 0;return new Promise(function(n,i){var o=function u(){Xf.off("change",u),n()};Xf.on("change",o);var a=t[Rd.requestFullscreen](r);a instanceof Promise&&a.then(o).catch(i)})},exit:function(){return new Promise(function(t,r){if(!Xf.isFullscreen){t();return}var n=function o(){Xf.off("change",o),t()};Xf.on("change",n);var i=document[Rd.exitFullscreen]();i instanceof Promise&&i.then(n).catch(r)})},toggle:function(t,r){return Xf.isFullscreen?Xf.exit():Xf.request(t,r)},onchange:function(t){Xf.on("change",t)},onerror:function(t){Xf.on("error",t)},on:function(t,r){var n=qC[t];n&&document.addEventListener(n,r,!1)},off:function(t,r){var n=qC[t];n&&document.removeEventListener(n,r,!1)},raw:Rd};Object.defineProperties(Xf,{isFullscreen:{get:function(){return!!document[Rd.fullscreenElement]}},element:{enumerable:!0,get:function(){var t;return(t=document[Rd.fullscreenElement])!==null&&t!==void 0?t:void 0}},isEnabled:{enumerable:!0,get:function(){return!!document[Rd.fullscreenEnabled]}}});Rd||(Xf={isEnabled:!1});function m$(e){var t=g$();return function(){var n=Ct(e),i;if(t){var o=Ct(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xn(this,i)}}function g$(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var y$=function(e){yn(r,e);var t=m$(r);function r(){return $t(this,r),t.apply(this,arguments)}return Gt(r,[{key:"getDefault",value:function(){return{position:q0.BOTTOMLEFT,name:"logo",href:"https://l7.antv.antgroup.com/",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*GRb1TKp4HcMAAAAAAAAAAAAAARQnAQ"}}},{key:"onAdd",value:function(){var i=$u("div","l7-control-logo");return this.setLogoContent(i),i}},{key:"onRemove",value:function(){return null}},{key:"setOptions",value:function(i){Cv(Ct(r.prototype),"setOptions",this).call(this,i),this.checkUpdateOption(i,["img","href"])&&(VE(this.container),this.setLogoContent(this.container))}},{key:"setLogoContent",value:function(i){var o=this.controlOption,a=o.href,u=o.img,c=$u("img");if(c.setAttribute("src",u),c.setAttribute("aria-label","AntV logo"),IF(c),a){var h=$u("a","l7-control-logo-link");h.target="_blank",h.href=a,h.rel="noopener nofollow",h.setAttribute("rel","noopener nofollow"),h.appendChild(c),i.appendChild(h)}else i.appendChild(c)}}]),r}(ZR);function _$(e){var t=x$();return function(){var n=Ct(e),i;if(t){var o=Ct(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xn(this,i)}}function x$(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var b$=function(e){yn(r,e);var t=_$(r);function r(n){var i;$t(this,r),i=t.call(this),Q(Ye(i),"isShow",!0),Q(Ye(i),"onMouseMove",function(a){var u,c=i.mapsService.getMapContainer(),h=(u=c==null?void 0:c.getBoundingClientRect())!==null&&u!==void 0?u:{},y=h.left,x=y===void 0?0:y,E=h.top,T=E===void 0?0:E;i.setPopupPosition(a.clientX-x,a.clientY-T)}),Q(Ye(i),"updateLngLatPosition",function(){if(!(!i.mapsService||i.popupOption.followCursor)){var a=i.lngLat,u=a.lng,c=a.lat,h=i.mapsService.lngLatToContainer([u,c]),y=h.x,x=h.y;i.setPopupPosition(y,x)}}),Q(Ye(i),"onKeyDown",function(a){a.keyCode===27&&i.remove()}),Q(Ye(i),"onCloseButtonClick",function(a){a.stopPropagation&&a.stopPropagation(),i.hide()}),Q(Ye(i),"update",function(){var a=!!i.lngLat,u=i.popupOption,c=u.className,h=u.style,y=u.maxWidth,x=u.anchor,E=u.stopPropagation;if(!(!i.mapsService||!a||!i.content)){var T=i.mapsService.getMarkerContainer();if(!i.container&&T&&(i.container=$u("div","l7-popup ".concat(c??""," ").concat(i.isShow?"":"l7-popup-hide"),T),h&&i.container.setAttribute("style",h),i.tip=$u("div","l7-popup-tip",i.container),i.container.appendChild(i.content),E&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(function(D){i.container.addEventListener(D,function(V){V.stopPropagation()})}),i.container.style.whiteSpace="nowrap"),i.updateLngLatPosition(),SF(i.container,"".concat(J2[x])),rF(i.container,x,"popup"),y){var I=i.container.getBoundingClientRect(),k=I.width;k>parseFloat(y)&&(i.container.style.width=y)}else i.container.style.removeProperty("width")}}),i.popupOption=_t(_t({},i.getDefault(n??{})),n);var o=i.popupOption.lngLat;return o&&(i.lngLat=o),i}return Gt(r,[{key:"lngLat",get:function(){var i;return(i=this.popupOption.lngLat)!==null&&i!==void 0?i:{lng:0,lat:0}},set:function(i){this.popupOption.lngLat=i}},{key:"getIsShow",value:function(){return this.isShow}},{key:"addTo",value:function(i){this.mapsService=i.get(Mt.IMapService),this.sceneService=i.get(Mt.ISceneService),this.layerService=i.get(Mt.ILayerService),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.scene=i,this.update(),this.updateCloseOnClick(),this.updateCloseOnEsc(),this.updateFollowCursor();var o=this.popupOption,a=o.html,u=o.text,c=o.title;return a?this.setHTML(a):u&&this.setText(u),c&&this.setTitle(c),this.emit("open"),this}},{key:"remove",value:function(){if(this!==null&&this!==void 0&&this.isOpen())return this.content&&Td(this.content),this.container&&(Td(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.updateCloseOnClick(!0),this.updateCloseOnEsc(!0),this.updateFollowCursor(!0),delete this.mapsService),this.emit("close"),this}},{key:"getOptions",value:function(){return this.popupOption}},{key:"setOptions",value:function(i){return this.show(),this.popupOption=_t(_t({},this.popupOption),i),this.checkUpdateOption(i,["html","text","title","closeButton","closeButtonOffsets","maxWidth","anchor","stopPropagation","className","style","lngLat","offsets"])&&(this.container&&(Td(this.container),this.container=void 0),this.popupOption.html?this.setHTML(this.popupOption.html):this.popupOption.text&&this.setText(this.popupOption.text),this.popupOption.title&&this.setTitle(this.popupOption.title)),this.checkUpdateOption(i,["closeOnEsc"])&&this.updateCloseOnEsc(),this.checkUpdateOption(i,["closeOnClick"])&&this.updateCloseOnClick(),this.checkUpdateOption(i,["followCursor"])&&this.updateFollowCursor(),this.checkUpdateOption(i,["html"])&&i.html?this.setHTML(i.html):this.checkUpdateOption(i,["text"])&&i.text&&this.setText(i.text),this.checkUpdateOption(i,["lngLat"])&&i.lngLat&&this.setLnglat(i.lngLat),this}},{key:"open",value:function(){return this.addTo(this.scene),this}},{key:"close",value:function(){return this.remove(),this}},{key:"show",value:function(){if(!this.isShow)return this.container&&W1(this.container,"l7-popup-hide"),this.isShow=!0,this.emit("show"),this}},{key:"hide",value:function(){if(this.isShow)return this.container&&Im(this.container,"l7-popup-hide"),this.isShow=!1,this.emit("hide"),this}},{key:"setHTML",value:function(i){return this.popupOption.html=i,this.setDOMContent(i)}},{key:"setText",value:function(i){return this.popupOption.text=i,this.setDOMContent(window.document.createTextNode(i))}},{key:"setTitle",value:function(i){this.show(),this.popupOption.title=i,i?(this.contentTitle||(this.contentTitle=$u("div","l7-popup-content__title"),this.content.firstChild?this.content.insertBefore(this.contentTitle,this.content.firstChild):this.content.append(this.contentTitle)),VE(this.contentTitle),RA(this.contentTitle,i)):this.contentTitle&&(Td(this.contentTitle),this.contentTitle=void 0)}},{key:"panToPopup",value:function(){var i=this.lngLat,o=i.lng,a=i.lat;return this.popupOption.autoPan&&this.mapsService.panTo([o,a]),this}},{key:"setLngLat",value:function(i){return this.setLnglat(i)}},{key:"setLnglat",value:function(i){var o=this;return this.show(),this.lngLat=i,Array.isArray(i)&&(this.lngLat={lng:i[0],lat:i[1]}),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.update(),this.popupOption.autoPan&&setTimeout(function(){o.panToPopup()},0),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setMaxWidth",value:function(i){return this.popupOption.maxWidth=i,this.update(),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"getDefault",value:function(i){return{closeButton:!0,closeOnClick:!1,maxWidth:"240px",offsets:[0,0],anchor:tF.BOTTOM,stopPropagation:!0,autoPan:!1,autoClose:!0,closeOnEsc:!1,followCursor:!1}}},{key:"setDOMContent",value:function(i){return this.show(),this.createContent(),RA(this.contentPanel,i),this.update(),this}},{key:"updateCloseOnClick",value:function(i){var o=this,a=this.mapsService;a&&(a==null||a.off("click",this.onCloseButtonClick),this.popupOption.closeOnClick&&!i&&requestAnimationFrame(function(){a==null||a.on("click",o.onCloseButtonClick)}))}},{key:"updateCloseOnEsc",value:function(i){window.removeEventListener("keydown",this.onKeyDown),this.popupOption.closeOnEsc&&!i&&window.addEventListener("keydown",this.onKeyDown)}},{key:"updateFollowCursor",value:function(i){var o,a=(o=this.mapsService)===null||o===void 0?void 0:o.getContainer();a&&(a==null||a.removeEventListener("mousemove",this.onMouseMove),this.popupOption.followCursor&&!i&&(a==null||a.addEventListener("mousemove",this.onMouseMove)))}},{key:"createContent",value:function(){var i=this;if(this.content&&Td(this.content),this.contentTitle=void 0,this.content=$u("div","l7-popup-content",this.container),this.setTitle(this.popupOption.title),this.popupOption.closeButton){var o=p$("l7-icon-guanbi");Im(o,"l7-popup-close-button"),this.content.appendChild(o),this.popupOption.closeButtonOffsets&&(o.style.right=this.popupOption.closeButtonOffsets[0]+"px",o.style.top=this.popupOption.closeButtonOffsets[1]+"px"),o.setAttribute("aria-label","Close popup"),o.addEventListener("click",function(){i.hide()}),this.closeButton=o}else this.closeButton=void 0;this.contentPanel=$u("div","l7-popup-content__panel",this.content)}},{key:"setPopupPosition",value:function(i,o){if(this.container){var a=this.popupOption.offsets;this.container.style.left=i+a[0]+"px",this.container.style.top=o-a[1]+"px"}}},{key:"checkUpdateOption",value:function(i,o){return o.some(function(a){return a in i})}}]),r}(tc.EventEmitter);function w$(e,t){var r=typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx<"u"&&wx!==null&&(typeof wx.request<"u"||typeof wx.miniProgram<"u");if(!(r||n)&&(t||(t=document),!!t)){var i=t.head||t.getElementsByTagName("head")[0];if(!i){i=t.createElement("head");var o=t.body||t.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):t.documentElement.appendChild(i)}var a=t.createElement("style");return a.type="text/css",a.styleSheet?a.styleSheet.cssText=e:a.appendChild(t.createTextNode(e)),i.appendChild(a),a}}w$(`.l7-marker-container {
  position: absolute;
  width: 100%;
  height: 100%;
  overflow: hidden;
}
.l7-marker {
  position: absolute !important;
  top: 0;
  left: 0;
  z-index: 5;
  cursor: pointer;
}
.l7-marker-cluster {
  width: 40px;
  height: 40px;
  background-color: rgba(181, 226, 140, 0.6);
  background-clip: padding-box;
  border-radius: 20px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-top: 5px;
  margin-left: 5px;
  font: 12px 'Helvetica Neue', Arial, Helvetica, sans-serif;
  text-align: center;
  background-color: rgba(110, 204, 57, 0.6);
  border-radius: 15px;
}
.l7-marker-cluster span {
  line-height: 30px;
}
.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  -webkit-box-shadow: none;
          box-shadow: none;
}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  background-clip: padding-box;
  border: 2px solid rgba(0, 0, 0, 0.2);
}
.mapboxgl-ctrl-logo,
.amap-logo {
  display: none !important;
}
.l7-select-box {
  border: 3px dashed gray;
  border-radius: 2px;
  position: absolute;
  z-index: 1000;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
}
.l7-control-container {
  font: 12px/1.5 'Helvetica Neue', Arial, Helvetica, sans-serif;
}
.l7-control-container .l7-control {
  position: relative;
  z-index: 800;
  float: left;
  clear: both;
  color: #595959;
  font-size: 12px;
  pointer-events: visiblePainted;
  /* IE 9-10 doesn't have auto */
  pointer-events: auto;
}
.l7-control-container .l7-control.l7-control--hide {
  display: none;
}
.l7-control-container .l7-top {
  top: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 1000;
  pointer-events: none;
}
.l7-control-container .l7-top .l7-control:not(.l7-control--hide) {
  margin-top: 8px;
}
.l7-control-container .l7-right {
  right: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 1000;
  pointer-events: none;
}
.l7-control-container .l7-right .l7-control:not(.l7-control--hide) {
  margin-right: 8px;
}
.l7-control-container .l7-bottom {
  bottom: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 1000;
  pointer-events: none;
}
.l7-control-container .l7-bottom .l7-control:not(.l7-control--hide) {
  margin-bottom: 8px;
}
.l7-control-container .l7-left {
  left: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 1000;
  pointer-events: none;
}
.l7-control-container .l7-left .l7-control:not(.l7-control--hide) {
  margin-left: 8px;
}
.l7-control-container .l7-center {
  position: absolute;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
}
.l7-control-container .l7-center.l7-top,
.l7-control-container .l7-center.l7-bottom {
  width: 100%;
}
.l7-control-container .l7-center.l7-left,
.l7-control-container .l7-center.l7-right {
  height: 100%;
}
.l7-control-container .l7-center .l7-control {
  margin-right: 8px;
  margin-bottom: 8px;
}
.l7-control-container .l7-row {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}
.l7-control-container .l7-row.l7-top {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}
.l7-control-container .l7-row.l7-bottom {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-control-container .l7-column {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-control-container .l7-column.l7-left {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}
.l7-control-container .l7-column.l7-right {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-button-control {
  min-width: 28px;
  height: 28px;
  background-color: #fff;
  border-width: 0;
  border-radius: 2px;
  outline: 0;
  cursor: pointer;
  -webkit-transition: all 0.2s;
  transition: all 0.2s;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  padding: 0 6px;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
  line-height: 16px;
}
.l7-button-control .l7-iconfont {
  fill: #595959;
  color: #595959;
  width: 16px;
  height: 16px;
}
.l7-button-control.l7-button-control--row {
  padding: 0 16px 0 13px;
}
.l7-button-control.l7-button-control--row * + .l7-button-control__text {
  margin-left: 8px;
}
.l7-button-control.l7-button-control--column {
  height: 44px;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-button-control.l7-button-control--column .l7-iconfont {
  margin-top: 3px;
}
.l7-button-control.l7-button-control--column .l7-button-control__text {
  margin-top: 3px;
  font-size: 10px;
  -webkit-transform: scale(0.83333);
          transform: scale(0.83333);
}
.l7-button-control:not(:disabled):hover {
  background-color: #f3f3f3;
}
.l7-button-control:not(:disabled):active {
  background-color: #f3f3f3;
}
.l7-button-control:disabled {
  background-color: #fafafa;
  color: #bdbdbd;
  cursor: not-allowed;
}
.l7-button-control:disabled .l7-iconfont {
  fill: #bdbdbd;
  color: #bdbdbd;
}
.l7-button-control:disabled:hover {
  background-color: #fafafa;
}
.l7-button-control:disabled:active {
  background-color: #fafafa;
}
.l7-popper {
  position: absolute;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  z-index: 5;
  color: #595959;
}
.l7-popper.l7-popper-hide {
  display: none;
}
.l7-popper .l7-popper-content {
  min-height: 28px;
  background: #fff;
  border-radius: 2px;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
}
.l7-popper .l7-popper-arrow {
  width: 0;
  height: 0;
  border-width: 4px;
  border-style: solid;
  border-top-color: transparent;
  border-bottom-color: transparent;
  border-left-color: transparent;
  border-right-color: transparent;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
}
.l7-popper.l7-popper-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}
.l7-popper.l7-popper-left .l7-popper-arrow {
  border-left-color: #fff;
  margin: 10px 0;
}
.l7-popper.l7-popper-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popper.l7-popper-right .l7-popper-arrow {
  border-right-color: #fff;
  margin: 10px 0;
}
.l7-popper.l7-popper-top {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-popper.l7-popper-top .l7-popper-arrow {
  border-top-color: #fff;
  margin: 0 10px;
}
.l7-popper.l7-popper-bottom {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}
.l7-popper.l7-popper-bottom .l7-popper-arrow {
  border-bottom-color: #fff;
  margin: 0 10px;
}
.l7-popper.l7-popper-start {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}
.l7-popper.l7-popper-end {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-select-control--normal {
  padding: 4px 0;
}
.l7-select-control--normal .l7-select-control-item {
  height: 24px;
  line-height: 24px;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  padding: 0 16px;
  font-size: 12px;
}
.l7-select-control--normal .l7-select-control-item > * + * {
  margin-left: 6px;
}
.l7-select-control--normal .l7-select-control-item input[type='checkbox'] {
  height: 14px;
  width: 14px;
}
.l7-select-control--normal .l7-select-control-item:hover {
  background-color: #f3f3f3;
}
.l7-select-control--image {
  padding: 12px 12px 0 12px;
  width: 474px;
  height: 320px;
  overflow: auto;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -ms-flex-wrap: wrap;
      flex-wrap: wrap;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}
.l7-select-control--image .l7-select-control-item {
  margin-right: 12px;
  border-radius: 2px;
  overflow: hidden;
  border: 1px solid #fff;
  -webkit-box-sizing: content-box;
          box-sizing: content-box;
  width: calc((100% - 36px) / 3);
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  margin-bottom: 12px;
  position: relative;
  font-size: 12px;
}
.l7-select-control--image .l7-select-control-item img {
  width: 142px;
  height: 80px;
}
.l7-select-control--image .l7-select-control-item input[type='checkbox'] {
  position: absolute;
  right: 0;
  top: 0;
}
.l7-select-control--image .l7-select-control-item .l7-select-control-item-row {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  line-height: 26px;
}
.l7-select-control--image .l7-select-control-item .l7-select-control-item-row > * + * {
  margin-left: 8px;
}
.l7-select-control--image .l7-select-control-item.l7-select-control-item-active {
  border-color: #0370fe;
}
.l7-select-control--image .l7-select-control-item:nth-child(3n) {
  margin-right: 0;
}
.l7-select-control-item {
  cursor: pointer;
}
.l7-select-control-item input[type='checkbox'] {
  margin: 0;
  cursor: pointer;
}
.l7-select-control--multiple .l7-select-control-item:hover {
  background-color: transparent;
}
.l7-control-logo {
  width: 89px;
  height: 16px;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}
.l7-control-logo img {
  height: 100%;
  width: 100%;
}
.l7-control-logo .l7-control-logo-link {
  display: block;
  cursor: pointer;
}
.l7-control-logo .l7-control-logo-link img {
  cursor: pointer;
}
.l7-control-mouse-location {
  background-color: #fff;
  border-radius: 2px;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
  padding: 2px 4px;
  min-width: 130px;
}
.l7-control-zoom {
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
  border-radius: 2px;
  overflow: hidden;
}
.l7-control-zoom .l7-button-control {
  -webkit-box-shadow: 0 0 0;
          box-shadow: 0 0 0;
  border-radius: 0;
  font-size: 16px;
}
.l7-control-zoom .l7-button-control .l7-iconfont {
  width: 14px;
  height: 14px;
}
.l7-control-zoom .l7-button-control:first-child {
  border-bottom: 1px solid #f0f0f0;
}
.l7-control-scale {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-control-scale .l7-control-scale-line {
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
  padding: 2px 5px 1px;
  overflow: hidden;
  color: #595959;
  font-size: 10px;
  line-height: 1.1;
  white-space: nowrap;
  background: #fff;
  border: 2px solid #000;
  border-top: 0;
  -webkit-transition: width 0.1s;
  transition: width 0.1s;
}
.l7-control-scale .l7-control-scale-line + .l7-control-scale .l7-control-scale-line {
  margin-top: -2px;
  border-top: 2px solid #777;
  border-bottom: none;
}
.l7-right .l7-control-scale {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-right .l7-control-scale .l7-control-scale-line {
  text-align: right;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  z-index: 5;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  will-change: transform;
  pointer-events: none;
}
.l7-popup.l7-popup-hide {
  display: none;
}
.l7-popup .l7-popup-content {
  position: relative;
  padding: 16px;
  font-size: 14px;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
}
.l7-popup .l7-popup-content .l7-popup-content__title {
  margin-bottom: 8px;
  font-weight: bold;
}
.l7-popup .l7-popup-content .l7-popup-close-button,
.l7-popup .l7-popup-content .l7-popup-content__title,
.l7-popup .l7-popup-content .l7-popup-content__panel {
  white-space: normal;
  -webkit-user-select: text;
     -moz-user-select: text;
      -ms-user-select: text;
          user-select: text;
  pointer-events: initial;
}
.l7-popup .l7-popup-content .l7-popup-close-button {
  position: absolute;
  top: 0;
  right: 0;
  width: 18px;
  height: 18px;
  padding: 0;
  font-size: 14px;
  line-height: 18px;
  text-align: center;
  background-color: transparent;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
}
.l7-popup .l7-popup-tip {
  position: relative;
  z-index: 1;
  width: 0;
  height: 0;
  border: 10px solid transparent;
}
.l7-popup.l7-popup-anchor-bottom,
.l7-popup.l7-popup-anchor-bottom-left,
.l7-popup.l7-popup-anchor-bottom-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}
.l7-popup.l7-popup-anchor-bottom .l7-popup-tip,
.l7-popup.l7-popup-anchor-bottom-left .l7-popup-tip,
.l7-popup.l7-popup-anchor-bottom-right .l7-popup-tip {
  bottom: 1px;
}
.l7-popup.l7-popup-anchor-top,
.l7-popup.l7-popup-anchor-top-left,
.l7-popup.l7-popup-anchor-top-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-popup.l7-popup-anchor-top .l7-popup-tip,
.l7-popup.l7-popup-anchor-top-left .l7-popup-tip,
.l7-popup.l7-popup-anchor-top-right .l7-popup-tip {
  top: 1px;
}
.l7-popup.l7-popup-anchor-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}
.l7-popup.l7-popup-anchor-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popup-anchor-top .l7-popup-tip {
  position: relative;
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top: none;
  border-bottom-color: #fff;
}
.l7-popup-anchor-top-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top: none;
  border-bottom-color: #fff;
  border-left: none;
}
.l7-popup-anchor-top-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top: none;
  border-right: none;
  border-bottom-color: #fff;
}
.l7-popup-anchor-bottom .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top-color: #fff;
  border-bottom: none;
}
.l7-popup-anchor-bottom-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top-color: #fff;
  border-bottom: none;
  border-left: none;
}
.l7-popup-anchor-bottom-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top-color: #fff;
  border-right: none;
  border-bottom: none;
}
.l7-popup-anchor-left .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right-color: #fff;
  border-left: none;
}
.l7-popup-anchor-right .l7-popup-tip {
  right: 1px;
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right: none;
  border-left-color: #fff;
}
.l7-popup-anchor-top-left .l7-popup-content {
  border-top-left-radius: 0;
}
.l7-popup-anchor-top-right .l7-popup-content {
  border-top-right-radius: 0;
}
.l7-popup-anchor-bottom-left .l7-popup-content {
  border-bottom-left-radius: 0;
}
.l7-popup-anchor-bottom-right .l7-popup-content {
  border-bottom-right-radius: 0;
}
.l7-popup-track-pointer {
  display: none;
}
.l7-popup-track-pointer * {
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
  pointer-events: none;
}
.l7-map:hover .l7-popup-track-pointer {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
}
.l7-map:active .l7-popup-track-pointer {
  display: none;
}
.l7-layer-popup__row {
  font-size: 12px;
}
.l7-layer-popup__row + .l7-layer-popup__row {
  margin-top: 4px;
}
`);var fv,KR=(fv={},Q(fv,Lp.additive,{enable:!0,func:{srcRGB:ae.ONE,dstRGB:ae.ONE,srcAlpha:1,dstAlpha:1}}),Q(fv,Lp.none,{enable:!1}),Q(fv,Lp.normal,{enable:!0,func:{srcRGB:ae.SRC_ALPHA,dstRGB:ae.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),Q(fv,Lp.subtractive,{enable:!0,func:{srcRGB:ae.ONE,dstRGB:ae.ONE,srcAlpha:ae.ZERO,dstAlpha:ae.ONE_MINUS_SRC_COLOR},equation:{rgb:ae.FUNC_SUBTRACT,alpha:ae.FUNC_SUBTRACT}}),Q(fv,Lp.max,{enable:!0,func:{srcRGB:ae.ONE,dstRGB:ae.ONE},equation:{rgb:ae.MAX_EXT}}),Q(fv,Lp.min,{enable:!0,func:{srcRGB:ae.ONE,dstRGB:ae.ONE},equation:{rgb:ae.MIN_EXT}}),fv),ZC,n2,KC,E$=(ZC=cS(Mt.IGlobalConfigService),n2=function(){function e(t){$t(this,e),Gi(this,"configService",KC,this),this.config=t}return Gt(e,[{key:"setContainer",value:function(r,n,i,o){r.bind(Mt.MapConfig).toConstantValue(_t(_t({},this.config),{},{id:n,canvas:i,hasBaseMap:o})),r.bind(Mt.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),e}(),KC=Ui(n2.prototype,"configService",[ZC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n2),th=function(e){return e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.DEFUALT="DEFUALTMAP",e.SIMPLE="SIMPLE",e.GLOBEL="GLOBEL",e}({}),S$=function(){function e(t){$t(this,e),Q(this,"size",1e4),this.size=t||1e4}return Gt(e,[{key:"setSize",value:function(r){this.size=r}},{key:"getSize",value:function(){return[this.size,this.size]}},{key:"mercatorXfromLng",value:function(r){return(180+r)/360*this.size}},{key:"mercatorYfromLat",value:function(r){return(1-(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360)*this.size}},{key:"lngFromMercatorX",value:function(r){return r/this.size*360-180}},{key:"latFromMercatorY",value:function(r){var n=180-(1-r/this.size)*360;return 360/Math.PI*Math.atan(Math.exp(n*Math.PI/180))-90}},{key:"project",value:function(r){var n=this.mercatorXfromLng(r[0]),i=this.mercatorYfromLat(r[1]);return[n,i]}},{key:"unproject",value:function(r){var n=this.lngFromMercatorX(r[0]),i=this.latFromMercatorY(r[1]);return[n,i]}}]),e}();function Cy(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function R1(e,t){var r=JE([],t,e);return JN(r,r,1/r[3]),r}function Dm(e,t){if(!e)throw new Error(t||"viewport-mercator-project: assertion failed.")}var Wh=Math.PI,QR=Wh/4,Mv=Wh/180,QC=180/Wh,pS=512,JC=4003e4,A$=1.5;function JR(e){return Math.pow(2,e)}function i2(e,t){var r=ei(e,2),n=r[0],i=r[1];Dm(Number.isFinite(n)&&Number.isFinite(t)),Dm(Number.isFinite(i)&&i>=-90&&i<=90,"invalid latitude"),t*=pS;var o=n*Mv,a=i*Mv,u=t*(o+Wh)/(2*Wh),c=t*(Wh-Math.log(Math.tan(QR+a*.5)))/(2*Wh);return[u,c]}function eM(e,t){var r=ei(e,2),n=r[0],i=r[1];t*=pS;var o=n/t*(2*Wh)-Wh,a=2*(Math.atan(Math.exp(Wh-i/t*(2*Wh)))-QR);return[o*QC,a*QC]}function T$(e){var t=e.latitude,r=e.longitude,n=e.zoom,i=e.scale,o=e.highPrecision,a=o===void 0?!1:o;i=i!==void 0?i:JR(n),Dm(Number.isFinite(t)&&Number.isFinite(r)&&Number.isFinite(i));var u={},c=pS*i,h=Math.cos(t*Mv),y=c/360,x=y/h,E=c/JC/h;if(u.pixelsPerMeter=[E,-E,E],u.metersPerPixel=[1/E,-1/E,1/E],u.pixelsPerDegree=[y,-x,E],u.degreesPerPixel=[1/y,-1/x,1/E],a){var T=Mv*Math.tan(t*Mv)/h,I=y*T/2,k=c/JC*T,D=k/x*E;u.pixelsPerDegree2=[0,-I,k],u.pixelsPerMeter2=[D,0,D]}return u}function C$(e){var t=e.height,r=e.pitch,n=e.bearing,i=e.altitude,o=e.center,a=o===void 0?null:o,u=e.flipY,c=u===void 0?!1:u,h=Cy();return jy(h,h,[0,0,-i]),$y(h,h,[1,1,1/t]),Bx(h,h,-r*Mv),QE(h,h,n*Mv),c&&$y(h,h,[1,-1,1]),a&&jy(h,h,pR([],a)),h}function M$(e){var t=e.width,r=e.height,n=e.altitude,i=n===void 0?A$:n,o=e.pitch,a=o===void 0?0:o,u=e.nearZMultiplier,c=u===void 0?1:u,h=e.farZMultiplier,y=h===void 0?1:h,x=a*Mv,E=Math.atan(.5/i),T=Math.sin(E)*i/Math.sin(Math.PI/2-x-E),I=Math.cos(Math.PI/2-x)*T+i;return{fov:2*Math.atan(r/2/i),aspect:t/r,focalDistance:i,near:c,far:I*y}}function P$(e){var t=e.width,r=e.height,n=e.pitch,i=e.altitude,o=e.nearZMultiplier,a=e.farZMultiplier,u=M$({width:t,height:r,altitude:i,pitch:n,nearZMultiplier:o,farZMultiplier:a}),c=u.fov,h=u.aspect,y=u.near,x=u.far,E=nR([],c,h,y,x);return E}function I$(e,t){var r=ei(e,3),n=r[0],i=r[1],o=r[2],a=o===void 0?0:o;return Dm(Number.isFinite(n)&&Number.isFinite(i)&&Number.isFinite(a)),R1(t,[n,i,a,1])}function eL(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=ei(e,3),i=n[0],o=n[1],a=n[2];if(Dm(Number.isFinite(i)&&Number.isFinite(o),"invalid pixel coordinate"),Number.isFinite(a)){var u=R1(t,[i,o,a,1]);return u}var c=R1(t,[i,o,0,1]),h=R1(t,[i,o,1,1]),y=c[2],x=h[2],E=y===x?0:((r||0)-y)/(x-y);return tB([],c,h,E)}var tM=Cy(),R$=function(){function e(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=t.width,n=t.height,i=t.viewMatrix,o=i===void 0?tM:i,a=t.projectionMatrix,u=a===void 0?tM:a;$t(this,e),this.width=r||1,this.height=n||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=o,this.projectionMatrix=u;var c=Cy();zp(c,c,this.projectionMatrix),zp(c,c,this.viewMatrix),this.viewProjectionMatrix=c;var h=Cy();$y(h,h,[this.width/2,-this.height/2,1]),jy(h,h,[1,-1,0]),zp(h,h,this.viewProjectionMatrix);var y=ZE(Cy(),h);if(!y)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=h,this.pixelUnprojectionMatrix=y,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return Gt(e,[{key:"equals",value:function(r){return r instanceof e?r.width===this.width&&r.height===this.height&&ow(r.projectionMatrix,this.projectionMatrix)&&ow(r.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=n.topLeft,o=i===void 0?!0:i,a=this.projectPosition(r),u=I$(a,this.pixelProjectionMatrix),c=ei(u,2),h=c[0],y=c[1],x=o?y:this.height-y;return r.length===2?[h,x]:[h,x,u[2]]}},{key:"unproject",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=n.topLeft,o=i===void 0?!0:i,a=n.targetZ,u=ei(r,3),c=u[0],h=u[1],y=u[2],x=o?h:this.height-h,E=a&&a*this.pixelsPerMeter,T=eL([c,x,y],this.pixelUnprojectionMatrix,E),I=this.unprojectPosition(T),k=ei(I,3),D=k[0],V=k[1],O=k[2];return Number.isFinite(y)?[D,V,O]:Number.isFinite(a)?[D,V,a]:[D,V]}},{key:"projectPosition",value:function(r){var n=this.projectFlat(r),i=ei(n,2),o=i[0],a=i[1],u=(r[2]||0)*this.pixelsPerMeter;return[o,a,u]}},{key:"unprojectPosition",value:function(r){var n=this.unprojectFlat(r),i=ei(n,2),o=i[0],a=i[1],u=(r[2]||0)/this.pixelsPerMeter;return[o,a,u]}},{key:"projectFlat",value:function(r){return arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale,r}},{key:"unprojectFlat",value:function(r){return arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale,r}}]),e}();function L$(e){var t=e.width,r=e.height,n=e.bounds,i=e.minExtent,o=i===void 0?0:i,a=e.maxZoom,u=a===void 0?24:a,c=e.padding,h=c===void 0?0:c,y=e.offset,x=y===void 0?[0,0]:y,E=ei(n,2),T=ei(E[0],2),I=T[0],k=T[1],D=ei(E[1],2),V=D[0],O=D[1];if(Number.isFinite(h)){var F=h;h={top:F,bottom:F,left:F,right:F}}else Dm(Number.isFinite(h.top)&&Number.isFinite(h.bottom)&&Number.isFinite(h.left)&&Number.isFinite(h.right));var N=new tL({width:t,height:r,longitude:0,latitude:0,zoom:0}),H=N.project([I,O]),q=N.project([V,k]),Y=[Math.max(Math.abs(q[0]-H[0]),o),Math.max(Math.abs(q[1]-H[1]),o)],ee=[t-h.left-h.right-Math.abs(x[0])*2,r-h.top-h.bottom-Math.abs(x[1])*2];Dm(ee[0]>0&&ee[1]>0);var pe=ee[0]/Y[0],ue=ee[1]/Y[1],ie=(h.right-h.left)/2/pe,xe=(h.bottom-h.top)/2/ue,Se=[(q[0]+H[0])/2+ie,(q[1]+H[1])/2+xe],Ne=N.unproject(Se),ze=N.zoom+Math.log2(Math.abs(Math.min(pe,ue)));return{longitude:Ne[0],latitude:Ne[1],zoom:Math.min(ze,u)}}var tL=function(e){yn(t,e);function t(){var r,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=n.width,o=n.height,a=n.latitude,u=a===void 0?0:a,c=n.longitude,h=c===void 0?0:c,y=n.zoom,x=y===void 0?0:y,E=n.pitch,T=E===void 0?0:E,I=n.bearing,k=I===void 0?0:I,D=n.altitude,V=D===void 0?1.5:D,O=n.nearZMultiplier,F=n.farZMultiplier;$t(this,t),i=i||1,o=o||1;var N=JR(x);V=Math.max(.75,V);var H=i2([h,u],N);H[2]=0;var q=P$({width:i,height:o,pitch:T,bearing:k,altitude:V,nearZMultiplier:O||1/o,farZMultiplier:F||1.01}),Y=C$({height:o,center:H,pitch:T,bearing:k,altitude:V,flipY:!0});return r=xn(this,Ct(t).call(this,{width:i,height:o,viewMatrix:Y,projectionMatrix:q})),r.latitude=u,r.longitude=h,r.zoom=x,r.pitch=T,r.bearing=k,r.altitude=V,r.scale=N,r.center=H,r.pixelsPerMeter=T$(Ye(Ye(r))).pixelsPerMeter[2],Object.freeze(Ye(Ye(r))),r}return Gt(t,[{key:"projectFlat",value:function(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return i2(n,i)}},{key:"unprojectFlat",value:function(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return eM(n,i)}},{key:"getMapCenterByLngLatPosition",value:function(n){var i=n.lngLat,o=n.pos,a=eL(o,this.pixelUnprojectionMatrix),u=i2(i,this.scale),c=Ds([],u,eB([],a)),h=Ds([],this.center,c);return eM(h,this.scale)}},{key:"getLocationAtPoint",value:function(n){var i=n.lngLat,o=n.pos;return this.getMapCenterByLngLatPosition({lngLat:i,pos:o})}},{key:"fitBounds",value:function(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=this.width,a=this.height,u=L$(Object.assign({width:o,height:a,bounds:n},i)),c=u.longitude,h=u.latitude,y=u.zoom;return new t({width:o,height:a,longitude:c,latitude:h,zoom:y})}}]),t}(R$),k$={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},rM,nM,iM,aM,oM,sM,b0,uM,lM,cM,fM,hM={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},O$=12,D$=(rM=Ei(),nM=na(Mt.MapConfig),iM=na(Mt.IGlobalConfigService),aM=na(Mt.ICoordinateSystemService),oM=na(Mt.IEventEmitter),rM(sM=(b0=function(){function e(){var t=this;$t(this,e),Q(this,"version",th.DEFUALT),Q(this,"simpleMapCoord",new S$),Q(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),Gi(this,"config",uM,this),Gi(this,"configService",lM,this),Gi(this,"coordinateSystemService",cM,this),Gi(this,"eventEmitter",fM,this),Q(this,"handleCameraChanged",function(r){var n=t.map.getCenter(),i=n.lat,o=n.lng;t.emit("mapchange"),t.viewport.syncWithMapCamera({bearing:t.map.getBearing(),center:[o,i],viewportHeight:t.map.transform.height,pitch:t.map.getPitch(),viewportWidth:t.map.transform.width,zoom:t.map.getZoom(),cameraHeight:0}),t.updateCoordinateSystemService(),t.cameraChangedCallback(t.viewport)})}return Gt(e,[{key:"setBgColor",value:function(r){this.bgColor=r}},{key:"addMarkerContainer",value:function(){var r=this.map.getCanvasContainer();this.markerContainer=$u("div","l7-marker-container",r),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"getOverlayContainer",value:function(){}},{key:"on",value:function(r,n){xj.indexOf(r)!==-1?this.eventEmitter.on(r,n):this.map.on(hM[r]||r,n)}},{key:"off",value:function(r,n){this.map.off(hM[r]||r,n),this.eventEmitter.off(r,n)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){if(this.version===th.SIMPLE)return this.simpleMapCoord.getSize();var r=this.map.transform;return[r.width,r.height]}},{key:"getType",value:function(){return"default"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(r){return this.map.setZoom(r)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(r){this.map.setCenter(r)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(r){this.map.setBearing(r)}},{key:"zoomIn",value:function(r,n){this.map.zoomIn(r,n)}},{key:"zoomOut",value:function(r,n){this.map.zoomOut(r,n)}},{key:"setPitch",value:function(r){return this.map.setPitch(r)}},{key:"panTo",value:function(r){this.map.panTo(r)}},{key:"panBy",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;this.map.panBy([r,n])}},{key:"fitBounds",value:function(r,n){this.map.fitBounds(r,n)}},{key:"setMaxZoom",value:function(r){this.map.setMaxZoom(r)}},{key:"setMinZoom",value:function(r){this.map.setMinZoom(r)}},{key:"setMapStatus",value:function(r){r.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),r.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),r.dragEnable===!1&&this.map.dragPan.disable(),r.dragEnable===!0&&this.map.dragPan.enable(),r.rotateEnable===!1&&this.map.dragRotate.disable(),r.dragEnable===!0&&this.map.dragRotate.enable(),r.keyboardEnable===!1&&this.map.keyboard.disable(),r.keyboardEnable===!0&&this.map.keyboard.enable(),r.zoomEnable===!1&&this.map.scrollZoom.disable(),r.zoomEnable===!0&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(r,n){this.map.flyTo({zoom:r,center:n})}},{key:"setMapStyle",value:function(r){this.map.setStyle(this.getMapStyleValue(r))}},{key:"meterToCoord",value:function(r,n){return 1}},{key:"pixelToLngLat",value:function(r){return this.map.unproject(r)}},{key:"lngLatToPixel",value:function(r){return this.map.project(r)}},{key:"containerToLngLat",value:function(r){return this.map.unproject(r)}},{key:"lngLatToContainer",value:function(r){return this.map.project(r)}},{key:"getMapStyle",value:function(){try{var r,n=(r=this.map.getStyle().sprite)!==null&&r!==void 0?r:"";return/^mapbox:\/\/sprites\/zcxduo\/\w+\/\w+$/.test(n)?n==null?void 0:n.replace(/\/\w+$/,"").replace(/sprites/,"styles"):n}catch{return""}}},{key:"getMapStyleConfig",value:function(){return k$}},{key:"getMapStyleValue",value:function(r){var n;return(n=this.getMapStyleConfig()[r])!==null&&n!==void 0?n:r}},{key:"destroy",value:function(){this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(r){for(var n,i=arguments.length,o=new Array(i>1?i-1:0),a=1;a<i;a++)o[a-1]=arguments[a];(n=this.eventEmitter).emit.apply(n,[r].concat(o))}},{key:"once",value:function(r){for(var n,i=arguments.length,o=new Array(i>1?i-1:0),a=1;a<i;a++)o[a-1]=arguments[a];(n=this.eventEmitter).once.apply(n,[r].concat(o))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"exportMap",value:function(r){var n=this.map.getCanvas(),i=r==="jpg"?n==null?void 0:n.toDataURL("image/jpeg"):n==null?void 0:n.toDataURL("image/png");return i}},{key:"onCameraChanged",value:function(r){this.cameraChangedCallback=r}},{key:"creatMapContainer",value:function(r){var n=r;return typeof r=="string"&&(n=document.getElementById(r)),n}},{key:"updateView",value:function(r){this.emit("mapchange"),this.viewport.syncWithMapCamera({bearing:r.bearing,center:r.center,viewportHeight:r.viewportHeight,pitch:r.pitch,viewportWidth:r.viewportWidth,zoom:r.zoom,cameraHeight:0}),this.updateCoordinateSystemService(),this.cameraChangedCallback(this.viewport)}},{key:"updateCoordinateSystemService",value:function(){var r=this.config.offsetCoordinate,n=r===void 0?!0:r;this.viewport.getZoom()>O$&&n?this.coordinateSystemService.setCoordinateSystem(Sv.LNGLAT_OFFSET):this.coordinateSystemService.setCoordinateSystem(Sv.LNGLAT)}}]),e}(),uM=Ui(b0.prototype,"config",[nM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lM=Ui(b0.prototype,"configService",[iM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cM=Ui(b0.prototype,"coordinateSystemService",[aM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fM=Ui(b0.prototype,"eventEmitter",[oM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),b0))||sM),rL={exports:{}};(function(e,t){(function(r,n){e.exports=n()})(mf,function(){var r,n,i;function o(a,u){if(!r)r=u;else if(!n)n=u;else{var c="var sharedChunk = {}; ("+r+")(sharedChunk); ("+n+")(sharedChunk);",h={};r(h),i=u(h),typeof window<"u"&&(i.workerUrl=window.URL.createObjectURL(new Blob([c],{type:"text/javascript"})))}}return o(["exports"],function(a){function u(s,l){return s(l={exports:{}},l.exports),l.exports}var c=h;function h(s,l,f,g){this.cx=3*s,this.bx=3*(f-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*l,this.by=3*(g-l)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=g,this.p2x=f,this.p2y=g}h.prototype.sampleCurveX=function(s){return((this.ax*s+this.bx)*s+this.cx)*s},h.prototype.sampleCurveY=function(s){return((this.ay*s+this.by)*s+this.cy)*s},h.prototype.sampleCurveDerivativeX=function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},h.prototype.solveCurveX=function(s,l){var f,g,w,S,C;for(l===void 0&&(l=1e-6),w=s,C=0;C<8;C++){if(S=this.sampleCurveX(w)-s,Math.abs(S)<l)return w;var L=this.sampleCurveDerivativeX(w);if(Math.abs(L)<1e-6)break;w-=S/L}if((w=s)<(f=0))return f;if(w>(g=1))return g;for(;f<g;){if(S=this.sampleCurveX(w),Math.abs(S-s)<l)return w;s>S?f=w:g=w,w=.5*(g-f)+f}return w},h.prototype.solve=function(s,l){return this.sampleCurveY(this.solveCurveX(s,l))};var y=x;function x(s,l){this.x=s,this.y=l}x.prototype={clone:function(){return new x(this.x,this.y)},add:function(s){return this.clone()._add(s)},sub:function(s){return this.clone()._sub(s)},multByPoint:function(s){return this.clone()._multByPoint(s)},divByPoint:function(s){return this.clone()._divByPoint(s)},mult:function(s){return this.clone()._mult(s)},div:function(s){return this.clone()._div(s)},rotate:function(s){return this.clone()._rotate(s)},rotateAround:function(s,l){return this.clone()._rotateAround(s,l)},matMult:function(s){return this.clone()._matMult(s)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(s){return this.x===s.x&&this.y===s.y},dist:function(s){return Math.sqrt(this.distSqr(s))},distSqr:function(s){var l=s.x-this.x,f=s.y-this.y;return l*l+f*f},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(s){return Math.atan2(this.y-s.y,this.x-s.x)},angleWith:function(s){return this.angleWithSep(s.x,s.y)},angleWithSep:function(s,l){return Math.atan2(this.x*l-this.y*s,this.x*s+this.y*l)},_matMult:function(s){var l=s[2]*this.x+s[3]*this.y;return this.x=s[0]*this.x+s[1]*this.y,this.y=l,this},_add:function(s){return this.x+=s.x,this.y+=s.y,this},_sub:function(s){return this.x-=s.x,this.y-=s.y,this},_mult:function(s){return this.x*=s,this.y*=s,this},_div:function(s){return this.x/=s,this.y/=s,this},_multByPoint:function(s){return this.x*=s.x,this.y*=s.y,this},_divByPoint:function(s){return this.x/=s.x,this.y/=s.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var s=this.y;return this.y=this.x,this.x=-s,this},_rotate:function(s){var l=Math.cos(s),f=Math.sin(s),g=f*this.x+l*this.y;return this.x=l*this.x-f*this.y,this.y=g,this},_rotateAround:function(s,l){var f=Math.cos(s),g=Math.sin(s),w=l.y+g*(this.x-l.x)+f*(this.y-l.y);return this.x=l.x+f*(this.x-l.x)-g*(this.y-l.y),this.y=w,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},x.convert=function(s){return s instanceof x?s:Array.isArray(s)?new x(s[0],s[1]):s};var E=typeof self<"u"?self:{},T=Math.pow(2,53)-1;function I(s,l,f,g){var w=new c(s,l,f,g);return function(S){return w.solve(S)}}var k=I(.25,.1,.25,1);function D(s,l,f){return Math.min(f,Math.max(l,s))}function V(s,l,f){var g=f-l,w=((s-l)%g+g)%g+l;return w===l?f:w}function O(s){for(var l=[],f=arguments.length-1;f-- >0;)l[f]=arguments[f+1];for(var g=0,w=l;g<w.length;g+=1){var S=w[g];for(var C in S)s[C]=S[C]}return s}var F=1;function N(){return F++}function H(){return function s(l){return l?(l^16*Math.random()>>l/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,s)}()}function q(s){return!!s&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(s)}function Y(s,l){s.forEach(function(f){l[f]&&(l[f]=l[f].bind(l))})}function ee(s,l){return s.indexOf(l,s.length-l.length)!==-1}function pe(s,l,f){var g={};for(var w in s)g[w]=l.call(f||this,s[w],w,s);return g}function ue(s,l,f){var g={};for(var w in s)l.call(f||this,s[w],w,s)&&(g[w]=s[w]);return g}function ie(s){return Array.isArray(s)?s.map(ie):typeof s=="object"&&s?pe(s,ie):s}var xe={};function Se(s){xe[s]||(typeof console<"u",xe[s]=!0)}function Ne(s,l,f){return(f.y-s.y)*(l.x-s.x)>(l.y-s.y)*(f.x-s.x)}function ze(s){for(var l=0,f=0,g=s.length,w=g-1,S=void 0,C=void 0;f<g;w=f++)l+=((C=s[w]).x-(S=s[f]).x)*(S.y+C.y);return l}function Be(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function $e(s){var l={};if(s.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(g,w,S,C){var L=S||C;return l[w]=!L||L.toLowerCase(),""}),l["max-age"]){var f=parseInt(l["max-age"],10);isNaN(f)?delete l["max-age"]:l["max-age"]=f}return l}var it=null;function mt(s){if(it==null){var l=s.navigator?s.navigator.userAgent:null;it=!!s.safari||!(!l||!(/\b(iPad|iPhone|iPod)\b/.test(l)||l.match("Safari")&&!l.match("Chrome")))}return it}function Qe(s){try{var l=E[s];return l.setItem("_mapbox_test_",1),l.removeItem("_mapbox_test_"),!0}catch{return!1}}var rt,gt,er,zt,qt=E.performance&&E.performance.now?E.performance.now.bind(E.performance):Date.now.bind(Date),Zr=E.requestAnimationFrame||E.mozRequestAnimationFrame||E.webkitRequestAnimationFrame||E.msRequestAnimationFrame,Wr=E.cancelAnimationFrame||E.mozCancelAnimationFrame||E.webkitCancelAnimationFrame||E.msCancelAnimationFrame,On={now:qt,frame:function(s){var l=Zr(s);return{cancel:function(){return Wr(l)}}},getImageData:function(s,l){l===void 0&&(l=0);var f=E.document.createElement("canvas"),g=f.getContext("2d");if(!g)throw new Error("failed to create canvas 2d context");return f.width=s.width,f.height=s.height,g.drawImage(s,0,0,s.width,s.height),g.getImageData(-l,-l,s.width+2*l,s.height+2*l)},resolveURL:function(s){return rt||(rt=E.document.createElement("a")),rt.href=s,rt.href},hardwareConcurrency:E.navigator&&E.navigator.hardwareConcurrency||4,get devicePixelRatio(){return E.devicePixelRatio},get prefersReducedMotion(){return!!E.matchMedia&&(gt==null&&(gt=E.matchMedia("(prefers-reduced-motion: reduce)")),gt.matches)}},Ut={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Ar={supported:!1,testSupport:function(s){!an&&zt&&(Ft?Mr(s):er=s)}},an=!1,Ft=!1;function Mr(s){var l=s.createTexture();s.bindTexture(s.TEXTURE_2D,l);try{if(s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,zt),s.isContextLost())return;Ar.supported=!0}catch{}s.deleteTexture(l),an=!0}E.document&&((zt=E.document.createElement("img")).onload=function(){er&&Mr(er),er=null,Ft=!0},zt.onerror=function(){an=!0,er=null},zt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var mn="01",Nn=function(s,l){this._transformRequestFn=s,this._customAccessToken=l,this._createSkuToken()};function Xn(s){return s.indexOf("mapbox:")===0}Nn.prototype._createSkuToken=function(){var s=function(){for(var l="",f=0;f<10;f++)l+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",mn,l].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=s.token,this._skuTokenExpiresAt=s.tokenExpiresAt},Nn.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},Nn.prototype.transformRequest=function(s,l){return this._transformRequestFn&&this._transformRequestFn(s,l)||{url:s}},Nn.prototype.normalizeStyleURL=function(s,l){if(!Xn(s))return s;var f=Ai(s);return f.path="/styles/v1"+f.path,this._makeAPIURL(f,this._customAccessToken||l)},Nn.prototype.normalizeGlyphsURL=function(s,l){if(!Xn(s))return s;var f=Ai(s);return f.path="/fonts/v1"+f.path,this._makeAPIURL(f,this._customAccessToken||l)},Nn.prototype.normalizeSourceURL=function(s,l){if(!Xn(s))return s;var f=Ai(s);return f.path="/v4/"+f.authority+".json",f.params.push("secure"),this._makeAPIURL(f,this._customAccessToken||l)},Nn.prototype.normalizeSpriteURL=function(s,l,f,g){var w=Ai(s);return Xn(s)?(w.path="/styles/v1"+w.path+"/sprite"+l+f,this._makeAPIURL(w,this._customAccessToken||g)):(w.path+=""+l+f,Vi(w))},Nn.prototype.normalizeTileURL=function(s,l){if(this._isSkuTokenExpired()&&this._createSkuToken(),s&&!Xn(s))return s;var f=Ai(s);f.path=f.path.replace(/(\.(png|jpg)\d*)(?=$)/,(On.devicePixelRatio>=2||l===512?"@2x":"")+(Ar.supported?".webp":"$1")),f.path=f.path.replace(/^.+\/v4\//,"/"),f.path="/v4"+f.path;var g=this._customAccessToken||function(w){for(var S=0,C=w;S<C.length;S+=1){var L=C[S].match(/^access_token=(.*)$/);if(L)return L[1]}return null}(f.params)||Ut.ACCESS_TOKEN;return Ut.REQUIRE_ACCESS_TOKEN&&g&&this._skuToken&&f.params.push("sku="+this._skuToken),this._makeAPIURL(f,g)},Nn.prototype.canonicalizeTileURL=function(s,l){var f=Ai(s);if(!f.path.match(/(^\/v4\/)/)||!f.path.match(/\.[\w]+$/))return s;var g="mapbox://tiles/";g+=f.path.replace("/v4/","");var w=f.params;return l&&(w=w.filter(function(S){return!S.match(/^access_token=/)})),w.length&&(g+="?"+w.join("&")),g},Nn.prototype.canonicalizeTileset=function(s,l){for(var f=!!l&&Xn(l),g=[],w=0,S=s.tiles||[];w<S.length;w+=1){var C=S[w];Li(C)?g.push(this.canonicalizeTileURL(C,f)):g.push(C)}return g},Nn.prototype._makeAPIURL=function(s,l){var f="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",g=Ai(Ut.API_URL);if(s.protocol=g.protocol,s.authority=g.authority,s.protocol==="http"){var w=s.params.indexOf("secure");w>=0&&s.params.splice(w,1)}if(g.path!=="/"&&(s.path=""+g.path+s.path),!Ut.REQUIRE_ACCESS_TOKEN)return Vi(s);if(!(l=l||Ut.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+f);if(l[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+f);return s.params=s.params.filter(function(S){return S.indexOf("access_token")===-1}),s.params.push("access_token="+l),Vi(s)};var qn=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function Li(s){return qn.test(s)}var ci=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Ai(s){var l=s.match(ci);if(!l)throw new Error("Unable to parse URL object");return{protocol:l[1],authority:l[2],path:l[3]||"/",params:l[4]?l[4].split("&"):[]}}function Vi(s){var l=s.params.length?"?"+s.params.join("&"):"";return s.protocol+"://"+s.authority+s.path+l}function za(s){if(!s)return null;var l=s.split(".");if(!l||l.length!==3)return null;try{return JSON.parse(decodeURIComponent(E.atob(l[1]).split("").map(function(f){return"%"+("00"+f.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch{return null}}var ia=function(s){this.type=s,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};ia.prototype.getStorageKey=function(s){var l,f=za(Ut.ACCESS_TOKEN);return l=f&&f.u?E.btoa(encodeURIComponent(f.u).replace(/%([0-9A-F]{2})/g,function(g,w){return String.fromCharCode(+("0x"+w))})):Ut.ACCESS_TOKEN||"",s?"mapbox.eventData."+s+":"+l:"mapbox.eventData:"+l},ia.prototype.fetchEventData=function(){var s=Qe("localStorage"),l=this.getStorageKey(),f=this.getStorageKey("uuid");if(s)try{var g=E.localStorage.getItem(l);g&&(this.eventData=JSON.parse(g));var w=E.localStorage.getItem(f);w&&(this.anonId=w)}catch{Se("Unable to read from LocalStorage")}},ia.prototype.saveEventData=function(){var s=Qe("localStorage"),l=this.getStorageKey(),f=this.getStorageKey("uuid");if(s)try{E.localStorage.setItem(f,this.anonId),Object.keys(this.eventData).length>=1&&E.localStorage.setItem(l,JSON.stringify(this.eventData))}catch{Se("Unable to write to LocalStorage")}},ia.prototype.processRequests=function(s){},ia.prototype.postEvent=function(s,l,f,g){var w=this;if(Ut.EVENTS_URL){var S=Ai(Ut.EVENTS_URL);S.params.push("access_token="+(g||Ut.ACCESS_TOKEN||""));var C={event:this.type,created:new Date(s).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.3",skuId:mn,userId:this.anonId},L=l?O(C,l):C,z={url:Vi(S),headers:{"Content-Type":"text/plain"},body:JSON.stringify([L])};this.pendingRequest=ha(z,function($){w.pendingRequest=null,f($),w.saveEventData(),w.processRequests(g)})}},ia.prototype.queueRequest=function(s,l){this.queue.push(s),this.processRequests(l)};var X,Ht,or=function(s){function l(){s.call(this,"map.load"),this.success={},this.skuToken=""}return s&&(l.__proto__=s),(l.prototype=Object.create(s&&s.prototype)).constructor=l,l.prototype.postMapLoadEvent=function(f,g,w,S){this.skuToken=w;var C=!(!S&&!Ut.ACCESS_TOKEN),L=Array.isArray(f)&&f.some(function(z){return Xn(z)||Li(z)});Ut.EVENTS_URL&&C&&L&&this.queueRequest({id:g,timestamp:Date.now()},S)},l.prototype.processRequests=function(f){var g=this;if(!this.pendingRequest&&this.queue.length!==0){var w=this.queue.shift(),S=w.id,C=w.timestamp;S&&this.success[S]||(this.anonId||this.fetchEventData(),q(this.anonId)||(this.anonId=H()),this.postEvent(C,{skuToken:this.skuToken},function(L){L||S&&(g.success[S]=!0)},f))}},l}(ia),Yr=new(function(s){function l(f){s.call(this,"appUserTurnstile"),this._customAccessToken=f}return s&&(l.__proto__=s),(l.prototype=Object.create(s&&s.prototype)).constructor=l,l.prototype.postTurnstileEvent=function(f,g){Ut.EVENTS_URL&&Ut.ACCESS_TOKEN&&Array.isArray(f)&&f.some(function(w){return Xn(w)||Li(w)})&&this.queueRequest(Date.now(),g)},l.prototype.processRequests=function(f){var g=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var w=za(Ut.ACCESS_TOKEN),S=w?w.u:Ut.ACCESS_TOKEN,C=S!==this.eventData.tokenU;q(this.anonId)||(this.anonId=H(),C=!0);var L=this.queue.shift();if(this.eventData.lastSuccess){var z=new Date(this.eventData.lastSuccess),$=new Date(L),W=(L-this.eventData.lastSuccess)/864e5;C=C||W>=1||W<-1||z.getDate()!==$.getDate()}else C=!0;if(!C)return this.processRequests();this.postEvent(L,{"enabled.telemetry":!1},function(K){K||(g.eventData.lastSuccess=L,g.eventData.tokenU=S)},f)}},l}(ia)),wn=Yr.postTurnstileEvent.bind(Yr),Qi=new or,Zn=Qi.postMapLoadEvent.bind(Qi),Hn=500,Dn=50;function di(){E.caches&&!X&&(X=E.caches.open("mapbox-tiles"))}function wt(s){var l=s.indexOf("?");return l<0?s:s.slice(0,l)}var rn,En=1/0;function Ii(){return rn==null&&(rn=E.OffscreenCanvas&&new E.OffscreenCanvas(1,1).getContext("2d")&&typeof E.createImageBitmap=="function"),rn}var ki={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(ki);var uo=function(s){function l(f,g,w){g===401&&Li(w)&&(f+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),s.call(this,f),this.status=g,this.url=w,this.name=this.constructor.name,this.message=f}return s&&(l.__proto__=s),(l.prototype=Object.create(s&&s.prototype)).constructor=l,l.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},l}(Error),go=Be()?function(){return self.worker&&self.worker.referrer}:function(){return(E.location.protocol==="blob:"?E.parent:E).location.href},yo,Fs,Ss=function(s,l){if(!(/^file:/.test(f=s.url)||/^file:/.test(go())&&!/^\w+:/.test(f))){if(E.fetch&&E.Request&&E.AbortController&&E.Request.prototype.hasOwnProperty("signal"))return function(g,w){var S,C=new E.AbortController,L=new E.Request(g.url,{method:g.method||"GET",body:g.body,credentials:g.credentials,headers:g.headers,referrer:go(),signal:C.signal}),z=!1,$=!1,W=(S=L.url).indexOf("sku=")>0&&Li(S);g.type==="json"&&L.headers.set("Accept","application/json");var K=function(le,Ie,ke){if(!$){if(le&&le.message!=="SecurityError"&&Se(le),Ie&&ke)return ne(Ie);var Ze=Date.now();E.fetch(L).then(function(Ve){if(Ve.ok){var st=W?Ve.clone():null;return ne(Ve,st,Ze)}return w(new uo(Ve.statusText,Ve.status,g.url))}).catch(function(Ve){Ve.code!==20&&w(new Error(Ve.message))})}},ne=function(le,Ie,ke){(g.type==="arrayBuffer"?le.arrayBuffer():g.type==="json"?le.json():le.text()).then(function(Ze){$||(Ie&&ke&&function(Ve,st,vt){if(di(),X){var Tt={status:st.status,statusText:st.statusText,headers:new E.Headers};st.headers.forEach(function(Yt,gr){return Tt.headers.set(gr,Yt)});var It=$e(st.headers.get("Cache-Control")||"");It["no-store"]||(It["max-age"]&&Tt.headers.set("Expires",new Date(vt+1e3*It["max-age"]).toUTCString()),new Date(Tt.headers.get("Expires")).getTime()-vt<42e4||function(Yt,gr){if(Ht===void 0)try{new Response(new ReadableStream),Ht=!0}catch{Ht=!1}Ht?gr(Yt.body):Yt.blob().then(gr)}(st,function(Yt){var gr=new E.Response(Yt,Tt);di(),X&&X.then(function(Or){return Or.put(wt(Ve.url),gr)}).catch(function(Or){return Se(Or.message)})}))}}(L,Ie,ke),z=!0,w(null,Ze,le.headers.get("Cache-Control"),le.headers.get("Expires")))}).catch(function(Ze){$||w(new Error(Ze.message))})};return W?function(le,Ie){if(di(),!X)return Ie(null);var ke=wt(le.url);X.then(function(Ze){Ze.match(ke).then(function(Ve){var st=function(vt){if(!vt)return!1;var Tt=new Date(vt.headers.get("Expires")||0),It=$e(vt.headers.get("Cache-Control")||"");return Tt>Date.now()&&!It["no-cache"]}(Ve);Ze.delete(ke),st&&Ze.put(ke,Ve.clone()),Ie(null,Ve,st)}).catch(Ie)}).catch(Ie)}(L,K):K(null,null),{cancel:function(){$=!0,z||C.abort()}}}(s,l);if(Be()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",s,l,void 0,!0)}var f;return function(g,w){var S=new E.XMLHttpRequest;for(var C in S.open(g.method||"GET",g.url,!0),g.type==="arrayBuffer"&&(S.responseType="arraybuffer"),g.headers)S.setRequestHeader(C,g.headers[C]);return g.type==="json"&&(S.responseType="text",S.setRequestHeader("Accept","application/json")),S.withCredentials=g.credentials==="include",S.onerror=function(){w(new Error(S.statusText))},S.onload=function(){if((S.status>=200&&S.status<300||S.status===0)&&S.response!==null){var L=S.response;if(g.type==="json")try{L=JSON.parse(S.response)}catch(z){return w(z)}w(null,L,S.getResponseHeader("Cache-Control"),S.getResponseHeader("Expires"))}else w(new uo(S.statusText,S.status,g.url))},S.send(g.body),{cancel:function(){return S.abort()}}}(s,l)},Su=function(s,l){return Ss(O(s,{type:"arrayBuffer"}),l)},ha=function(s,l){return Ss(O(s,{method:"POST"}),l)},Z="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";yo=[],Fs=0;var re=function(s,l){if(Ar.supported&&(s.headers||(s.headers={}),s.headers.accept="image/webp,*/*"),Fs>=Ut.MAX_PARALLEL_IMAGE_REQUESTS){var f={requestParameters:s,callback:l,cancelled:!1,cancel:function(){this.cancelled=!0}};return yo.push(f),f}Fs++;var g=!1,w=function(){if(!g)for(g=!0,Fs--;yo.length&&Fs<Ut.MAX_PARALLEL_IMAGE_REQUESTS;){var C=yo.shift();C.cancelled||(C.cancel=re(C.requestParameters,C.callback).cancel)}},S=Su(s,function(C,L,z,$){w(),C?l(C):L&&(Ii()?function(W,K){var ne=new E.Blob([new Uint8Array(W)],{type:"image/png"});E.createImageBitmap(ne).then(function(le){K(null,le)}).catch(function(le){K(new Error("Could not load image because of "+le.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(L,l):function(W,K,ne,le){var Ie=new E.Image,ke=E.URL;Ie.onload=function(){K(null,Ie),ke.revokeObjectURL(Ie.src),Ie.onload=null,E.requestAnimationFrame(function(){Ie.src=Z})},Ie.onerror=function(){return K(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var Ze=new E.Blob([new Uint8Array(W)],{type:"image/png"});Ie.cacheControl=ne,Ie.expires=le,Ie.src=W.byteLength?ke.createObjectURL(Ze):Z}(L,l,z,$))});return{cancel:function(){S.cancel(),w()}}};function oe(s,l,f){f[s]&&f[s].indexOf(l)!==-1||(f[s]=f[s]||[],f[s].push(l))}function ge(s,l,f){if(f&&f[s]){var g=f[s].indexOf(l);g!==-1&&f[s].splice(g,1)}}var Le=function(s,l){l===void 0&&(l={}),O(this,l),this.type=s},Ke=function(s){function l(f,g){g===void 0&&(g={}),s.call(this,"error",O({error:f},g))}return s&&(l.__proto__=s),(l.prototype=Object.create(s&&s.prototype)).constructor=l,l}(Le),nt=function(){};nt.prototype.on=function(s,l){return this._listeners=this._listeners||{},oe(s,l,this._listeners),this},nt.prototype.off=function(s,l){return ge(s,l,this._listeners),ge(s,l,this._oneTimeListeners),this},nt.prototype.once=function(s,l){return this._oneTimeListeners=this._oneTimeListeners||{},oe(s,l,this._oneTimeListeners),this},nt.prototype.fire=function(s,l){typeof s=="string"&&(s=new Le(s,l||{}));var f=s.type;if(this.listens(f)){s.target=this;for(var g=0,w=this._listeners&&this._listeners[f]?this._listeners[f].slice():[];g<w.length;g+=1)w[g].call(this,s);for(var S=0,C=this._oneTimeListeners&&this._oneTimeListeners[f]?this._oneTimeListeners[f].slice():[];S<C.length;S+=1){var L=C[S];ge(f,L,this._oneTimeListeners),L.call(this,s)}var z=this._eventedParent;z&&(O(s,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),z.fire(s))}else s instanceof Ke;return this},nt.prototype.listens=function(s){return this._listeners&&this._listeners[s]&&this._listeners[s].length>0||this._oneTimeListeners&&this._oneTimeListeners[s]&&this._oneTimeListeners[s].length>0||this._eventedParent&&this._eventedParent.listens(s)},nt.prototype.setEventedParent=function(s,l){return this._eventedParent=s,this._eventedParentData=l,this};var de={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},Fe=function(s,l,f,g){this.message=(s?s+": ":"")+f,g&&(this.identifier=g),l!=null&&l.__line__&&(this.line=l.__line__)};function ht(s){var l=s.value;return l?[new Fe(s.key,l,"constants have been deprecated as of v8")]:[]}function nr(s){for(var l=[],f=arguments.length-1;f-- >0;)l[f]=arguments[f+1];for(var g=0,w=l;g<w.length;g+=1){var S=w[g];for(var C in S)s[C]=S[C]}return s}function cr(s){return s instanceof Number||s instanceof String||s instanceof Boolean?s.valueOf():s}function kt(s){if(Array.isArray(s))return s.map(kt);if(s instanceof Object&&!(s instanceof Number||s instanceof String||s instanceof Boolean)){var l={};for(var f in s)l[f]=kt(s[f]);return l}return cr(s)}var ir=function(s){function l(f,g){s.call(this,g),this.message=g,this.key=f}return s&&(l.__proto__=s),(l.prototype=Object.create(s&&s.prototype)).constructor=l,l}(Error),Sr=function(s,l){l===void 0&&(l=[]),this.parent=s,this.bindings={};for(var f=0,g=l;f<g.length;f+=1){var w=g[f];this.bindings[w[0]]=w[1]}};Sr.prototype.concat=function(s){return new Sr(this,s)},Sr.prototype.get=function(s){if(this.bindings[s])return this.bindings[s];if(this.parent)return this.parent.get(s);throw new Error(s+" not found in scope.")},Sr.prototype.has=function(s){return!!this.bindings[s]||!!this.parent&&this.parent.has(s)};var nn={kind:"null"},Dt={kind:"number"},Kr={kind:"string"},Ir={kind:"boolean"},Dr={kind:"color"},ii={kind:"object"},Fr={kind:"value"},fi={kind:"collator"},Oi={kind:"formatted"},oi={kind:"resolvedImage"};function Si(s,l){return{kind:"array",itemType:s,N:l}}function Ti(s){if(s.kind==="array"){var l=Ti(s.itemType);return typeof s.N=="number"?"array<"+l+", "+s.N+">":s.itemType.kind==="value"?"array":"array<"+l+">"}return s.kind}var Jo=[nn,Dt,Kr,Ir,Dr,Oi,ii,Si(Fr),oi];function Ni(s,l){if(l.kind==="error")return null;if(s.kind==="array"){if(l.kind==="array"&&(l.N===0&&l.itemType.kind==="value"||!Ni(s.itemType,l.itemType))&&(typeof s.N!="number"||s.N===l.N))return null}else{if(s.kind===l.kind)return null;if(s.kind==="value"){for(var f=0,g=Jo;f<g.length;f+=1)if(!Ni(g[f],l))return null}}return"Expected "+Ti(s)+" but found "+Ti(l)+" instead."}function Hi(s,l){return l.some(function(f){return f.kind===s.kind})}function Di(s,l){return l.some(function(f){return f==="null"?s===null:f==="array"?Array.isArray(s):f==="object"?s&&!Array.isArray(s)&&typeof s=="object":f===typeof s})}var ti=u(function(s,l){var f={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function g(L){return(L=Math.round(L))<0?0:L>255?255:L}function w(L){return g(L[L.length-1]==="%"?parseFloat(L)/100*255:parseInt(L))}function S(L){return(z=L[L.length-1]==="%"?parseFloat(L)/100:parseFloat(L))<0?0:z>1?1:z;var z}function C(L,z,$){return $<0?$+=1:$>1&&($-=1),6*$<1?L+(z-L)*$*6:2*$<1?z:3*$<2?L+(z-L)*(2/3-$)*6:L}try{l.parseCSSColor=function(L){var z,$=L.replace(/ /g,"").toLowerCase();if($ in f)return f[$].slice();if($[0]==="#")return $.length===4?(z=parseInt($.substr(1),16))>=0&&z<=4095?[(3840&z)>>4|(3840&z)>>8,240&z|(240&z)>>4,15&z|(15&z)<<4,1]:null:$.length===7&&(z=parseInt($.substr(1),16))>=0&&z<=16777215?[(16711680&z)>>16,(65280&z)>>8,255&z,1]:null;var W=$.indexOf("("),K=$.indexOf(")");if(W!==-1&&K+1===$.length){var ne=$.substr(0,W),le=$.substr(W+1,K-(W+1)).split(","),Ie=1;switch(ne){case"rgba":if(le.length!==4)return null;Ie=S(le.pop());case"rgb":return le.length!==3?null:[w(le[0]),w(le[1]),w(le[2]),Ie];case"hsla":if(le.length!==4)return null;Ie=S(le.pop());case"hsl":if(le.length!==3)return null;var ke=(parseFloat(le[0])%360+360)%360/360,Ze=S(le[1]),Ve=S(le[2]),st=Ve<=.5?Ve*(Ze+1):Ve+Ze-Ve*Ze,vt=2*Ve-st;return[g(255*C(vt,st,ke+1/3)),g(255*C(vt,st,ke)),g(255*C(vt,st,ke-1/3)),Ie];default:return null}}return null}}catch{}}).parseCSSColor,vi=function(s,l,f,g){g===void 0&&(g=1),this.r=s,this.g=l,this.b=f,this.a=g};vi.parse=function(s){if(s){if(s instanceof vi)return s;if(typeof s=="string"){var l=ti(s);if(l)return new vi(l[0]/255*l[3],l[1]/255*l[3],l[2]/255*l[3],l[3])}}},vi.prototype.toString=function(){var s=this.toArray(),l=s[1],f=s[2],g=s[3];return"rgba("+Math.round(s[0])+","+Math.round(l)+","+Math.round(f)+","+g+")"},vi.prototype.toArray=function(){var s=this.a;return s===0?[0,0,0,0]:[255*this.r/s,255*this.g/s,255*this.b/s,s]},vi.black=new vi(0,0,0,1),vi.white=new vi(1,1,1,1),vi.transparent=new vi(0,0,0,0),vi.red=new vi(1,0,0,1);var Mo=function(s,l,f){this.sensitivity=s?l?"variant":"case":l?"accent":"base",this.locale=f,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};Mo.prototype.compare=function(s,l){return this.collator.compare(s,l)},Mo.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var As=function(s,l,f,g,w){this.text=s,this.image=l,this.scale=f,this.fontStack=g,this.textColor=w},Ma=function(s){this.sections=s};Ma.fromString=function(s){return new Ma([new As(s,null,null,null,null)])},Ma.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(s){return s.text.length!==0||s.image&&s.image.name.length!==0})},Ma.factory=function(s){return s instanceof Ma?s:Ma.fromString(s)},Ma.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(s){return s.text}).join("")},Ma.prototype.serialize=function(){for(var s=["format"],l=0,f=this.sections;l<f.length;l+=1){var g=f[l];if(g.image)s.push(["image",g.image.name]);else{s.push(g.text);var w={};g.fontStack&&(w["text-font"]=["literal",g.fontStack.split(",")]),g.scale&&(w["font-scale"]=g.scale),g.textColor&&(w["text-color"]=["rgba"].concat(g.textColor.toArray())),s.push(w)}}return s};var Go=function(s){this.name=s.name,this.available=s.available};function $c(s,l,f,g){return typeof s=="number"&&s>=0&&s<=255&&typeof l=="number"&&l>=0&&l<=255&&typeof f=="number"&&f>=0&&f<=255?g===void 0||typeof g=="number"&&g>=0&&g<=1?null:"Invalid rgba value ["+[s,l,f,g].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof g=="number"?[s,l,f,g]:[s,l,f]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function Wu(s){if(s===null||typeof s=="string"||typeof s=="boolean"||typeof s=="number"||s instanceof vi||s instanceof Mo||s instanceof Ma||s instanceof Go)return!0;if(Array.isArray(s)){for(var l=0,f=s;l<f.length;l+=1)if(!Wu(f[l]))return!1;return!0}if(typeof s=="object"){for(var g in s)if(!Wu(s[g]))return!1;return!0}return!1}function Wi(s){if(s===null)return nn;if(typeof s=="string")return Kr;if(typeof s=="boolean")return Ir;if(typeof s=="number")return Dt;if(s instanceof vi)return Dr;if(s instanceof Mo)return fi;if(s instanceof Ma)return Oi;if(s instanceof Go)return oi;if(Array.isArray(s)){for(var l,f=s.length,g=0,w=s;g<w.length;g+=1){var S=Wi(w[g]);if(l){if(l===S)continue;l=Fr;break}l=S}return Si(l||Fr,f)}return ii}function _l(s){var l=typeof s;return s===null?"":l==="string"||l==="number"||l==="boolean"?String(s):s instanceof vi||s instanceof Ma||s instanceof Go?s.toString():JSON.stringify(s)}Go.prototype.toString=function(){return this.name},Go.fromString=function(s){return s?new Go({name:s,available:!1}):null},Go.prototype.serialize=function(){return["image",this.name]};var Po=function(s,l){this.type=s,this.value=l};Po.parse=function(s,l){if(s.length!==2)return l.error("'literal' expression requires exactly one argument, but found "+(s.length-1)+" instead.");if(!Wu(s[1]))return l.error("invalid value");var f=s[1],g=Wi(f),w=l.expectedType;return g.kind!=="array"||g.N!==0||!w||w.kind!=="array"||typeof w.N=="number"&&w.N!==0||(g=w),new Po(g,f)},Po.prototype.evaluate=function(){return this.value},Po.prototype.eachChild=function(){},Po.prototype.outputDefined=function(){return!0},Po.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof vi?["rgba"].concat(this.value.toArray()):this.value instanceof Ma?this.value.serialize():this.value};var Pa=function(s){this.name="ExpressionEvaluationError",this.message=s};Pa.prototype.toJSON=function(){return this.message};var es={string:Kr,number:Dt,boolean:Ir,object:ii},ga=function(s,l){this.type=s,this.args=l};ga.parse=function(s,l){if(s.length<2)return l.error("Expected at least one argument.");var f,g=1,w=s[0];if(w==="array"){var S,C;if(s.length>2){var L=s[1];if(typeof L!="string"||!(L in es)||L==="object")return l.error('The item type argument of "array" must be one of string, number, boolean',1);S=es[L],g++}else S=Fr;if(s.length>3){if(s[2]!==null&&(typeof s[2]!="number"||s[2]<0||s[2]!==Math.floor(s[2])))return l.error('The length argument to "array" must be a positive integer literal',2);C=s[2],g++}f=Si(S,C)}else f=es[w];for(var z=[];g<s.length;g++){var $=l.parse(s[g],g,Fr);if(!$)return null;z.push($)}return new ga(f,z)},ga.prototype.evaluate=function(s){for(var l=0;l<this.args.length;l++){var f=this.args[l].evaluate(s);if(!Ni(this.type,Wi(f)))return f;if(l===this.args.length-1)throw new Pa("Expected value to be of type "+Ti(this.type)+", but found "+Ti(Wi(f))+" instead.")}return null},ga.prototype.eachChild=function(s){this.args.forEach(s)},ga.prototype.outputDefined=function(){return this.args.every(function(s){return s.outputDefined()})},ga.prototype.serialize=function(){var s=this.type,l=[s.kind];if(s.kind==="array"){var f=s.itemType;if(f.kind==="string"||f.kind==="number"||f.kind==="boolean"){l.push(f.kind);var g=s.N;(typeof g=="number"||this.args.length>1)&&l.push(g)}}return l.concat(this.args.map(function(w){return w.serialize()}))};var hs=function(s){this.type=Oi,this.sections=s};hs.parse=function(s,l){if(s.length<2)return l.error("Expected at least one argument.");var f=s[1];if(!Array.isArray(f)&&typeof f=="object")return l.error("First argument must be an image or text section.");for(var g=[],w=!1,S=1;S<=s.length-1;++S){var C=s[S];if(w&&typeof C=="object"&&!Array.isArray(C)){w=!1;var L=null;if(C["font-scale"]&&!(L=l.parse(C["font-scale"],1,Dt)))return null;var z=null;if(C["text-font"]&&!(z=l.parse(C["text-font"],1,Si(Kr))))return null;var $=null;if(C["text-color"]&&!($=l.parse(C["text-color"],1,Dr)))return null;var W=g[g.length-1];W.scale=L,W.font=z,W.textColor=$}else{var K=l.parse(s[S],1,Fr);if(!K)return null;var ne=K.type.kind;if(ne!=="string"&&ne!=="value"&&ne!=="null"&&ne!=="resolvedImage")return l.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");w=!0,g.push({content:K,scale:null,font:null,textColor:null})}}return new hs(g)},hs.prototype.evaluate=function(s){return new Ma(this.sections.map(function(l){var f=l.content.evaluate(s);return Wi(f)===oi?new As("",f,null,null,null):new As(_l(f),null,l.scale?l.scale.evaluate(s):null,l.font?l.font.evaluate(s).join(","):null,l.textColor?l.textColor.evaluate(s):null)}))},hs.prototype.eachChild=function(s){for(var l=0,f=this.sections;l<f.length;l+=1){var g=f[l];s(g.content),g.scale&&s(g.scale),g.font&&s(g.font),g.textColor&&s(g.textColor)}},hs.prototype.outputDefined=function(){return!1},hs.prototype.serialize=function(){for(var s=["format"],l=0,f=this.sections;l<f.length;l+=1){var g=f[l];s.push(g.content.serialize());var w={};g.scale&&(w["font-scale"]=g.scale.serialize()),g.font&&(w["text-font"]=g.font.serialize()),g.textColor&&(w["text-color"]=g.textColor.serialize()),s.push(w)}return s};var Fa=function(s){this.type=oi,this.input=s};Fa.parse=function(s,l){if(s.length!==2)return l.error("Expected two arguments.");var f=l.parse(s[1],1,Kr);return f?new Fa(f):l.error("No image name provided.")},Fa.prototype.evaluate=function(s){var l=this.input.evaluate(s),f=Go.fromString(l);return f&&s.availableImages&&(f.available=s.availableImages.indexOf(l)>-1),f},Fa.prototype.eachChild=function(s){s(this.input)},Fa.prototype.outputDefined=function(){return!1},Fa.prototype.serialize=function(){return["image",this.input.serialize()]};var ic={"to-boolean":Ir,"to-color":Dr,"to-number":Dt,"to-string":Kr},Ts=function(s,l){this.type=s,this.args=l};Ts.parse=function(s,l){if(s.length<2)return l.error("Expected at least one argument.");var f=s[0];if((f==="to-boolean"||f==="to-string")&&s.length!==2)return l.error("Expected one argument.");for(var g=ic[f],w=[],S=1;S<s.length;S++){var C=l.parse(s[S],S,Fr);if(!C)return null;w.push(C)}return new Ts(g,w)},Ts.prototype.evaluate=function(s){if(this.type.kind==="boolean")return!!this.args[0].evaluate(s);if(this.type.kind==="color"){for(var l,f,g=0,w=this.args;g<w.length;g+=1){if(f=null,(l=w[g].evaluate(s))instanceof vi)return l;if(typeof l=="string"){var S=s.parseColor(l);if(S)return S}else if(Array.isArray(l)&&!(f=l.length<3||l.length>4?"Invalid rbga value "+JSON.stringify(l)+": expected an array containing either three or four numeric values.":$c(l[0],l[1],l[2],l[3])))return new vi(l[0]/255,l[1]/255,l[2]/255,l[3])}throw new Pa(f||"Could not parse color from value '"+(typeof l=="string"?l:String(JSON.stringify(l)))+"'")}if(this.type.kind==="number"){for(var C=null,L=0,z=this.args;L<z.length;L+=1){if((C=z[L].evaluate(s))===null)return 0;var $=Number(C);if(!isNaN($))return $}throw new Pa("Could not convert "+JSON.stringify(C)+" to number.")}return this.type.kind==="formatted"?Ma.fromString(_l(this.args[0].evaluate(s))):this.type.kind==="resolvedImage"?Go.fromString(_l(this.args[0].evaluate(s))):_l(this.args[0].evaluate(s))},Ts.prototype.eachChild=function(s){this.args.forEach(s)},Ts.prototype.outputDefined=function(){return this.args.every(function(s){return s.outputDefined()})},Ts.prototype.serialize=function(){if(this.type.kind==="formatted")return new hs([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Fa(this.args[0]).serialize();var s=["to-"+this.type.kind];return this.eachChild(function(l){s.push(l.serialize())}),s};var ac=["Unknown","Point","LineString","Polygon"],Ws=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};Ws.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},Ws.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?ac[this.feature.type]:this.feature.type:null},Ws.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},Ws.prototype.canonicalID=function(){return this.canonical},Ws.prototype.properties=function(){return this.feature&&this.feature.properties||{}},Ws.prototype.parseColor=function(s){var l=this._parseColorCache[s];return l||(l=this._parseColorCache[s]=vi.parse(s)),l};var _o=function(s,l,f,g){this.name=s,this.type=l,this._evaluate=f,this.args=g};_o.prototype.evaluate=function(s){return this._evaluate(s,this.args)},_o.prototype.eachChild=function(s){this.args.forEach(s)},_o.prototype.outputDefined=function(){return!1},_o.prototype.serialize=function(){return[this.name].concat(this.args.map(function(s){return s.serialize()}))},_o.parse=function(s,l){var f,g=s[0],w=_o.definitions[g];if(!w)return l.error('Unknown expression "'+g+'". If you wanted a literal array, use ["literal", [...]].',0);for(var S=Array.isArray(w)?w[0]:w.type,C=Array.isArray(w)?[[w[1],w[2]]]:w.overloads,L=C.filter(function(In){var tn=In[0];return!Array.isArray(tn)||tn.length===s.length-1}),z=null,$=0,W=L;$<W.length;$+=1){var K=W[$],ne=K[0],le=K[1];z=new uc(l.registry,l.path,null,l.scope);for(var Ie=[],ke=!1,Ze=1;Ze<s.length;Ze++){var Ve=s[Ze],st=Array.isArray(ne)?ne[Ze-1]:ne.type,vt=z.parse(Ve,1+Ie.length,st);if(!vt){ke=!0;break}Ie.push(vt)}if(!ke)if(Array.isArray(ne)&&ne.length!==Ie.length)z.error("Expected "+ne.length+" arguments, but found "+Ie.length+" instead.");else{for(var Tt=0;Tt<Ie.length;Tt++){var It=Array.isArray(ne)?ne[Tt]:ne.type,Yt=Ie[Tt];z.concat(Tt+1).checkSubtype(It,Yt.type)}if(z.errors.length===0)return new _o(g,S,le,Ie)}}if(L.length===1)(f=l.errors).push.apply(f,z.errors);else{for(var gr=(L.length?L:C).map(function(In){var tn;return tn=In[0],Array.isArray(tn)?"("+tn.map(Ti).join(", ")+")":"("+Ti(tn.type)+"...)"}).join(" | "),Or=[],Cn=1;Cn<s.length;Cn++){var qr=l.parse(s[Cn],1+Or.length);if(!qr)return null;Or.push(Ti(qr.type))}l.error("Expected arguments of type "+gr+", but found ("+Or.join(", ")+") instead.")}return null},_o.register=function(s,l){for(var f in _o.definitions=l,l)s[f]=_o};var ps=function(s,l,f){this.type=fi,this.locale=f,this.caseSensitive=s,this.diacriticSensitive=l};function se(s,l){s[0]=Math.min(s[0],l[0]),s[1]=Math.min(s[1],l[1]),s[2]=Math.max(s[2],l[0]),s[3]=Math.max(s[3],l[1])}function be(s,l){return!(s[0]<=l[0]||s[2]>=l[2]||s[1]<=l[1]||s[3]>=l[3])}function Xe(s,l){var f=(180+s[0])/360,g=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s[1]*Math.PI/360)))/360,w=Math.pow(2,l.z);return[Math.round(f*w*8192),Math.round(g*w*8192)]}function Lt(s,l,f){return l[1]>s[1]!=f[1]>s[1]&&s[0]<(f[0]-l[0])*(s[1]-l[1])/(f[1]-l[1])+l[0]}function xr(s,l){for(var f,g,w,S,C,L,z,$=!1,W=0,K=l.length;W<K;W++)for(var ne=l[W],le=0,Ie=ne.length;le<Ie-1;le++){if((S=(f=s)[0]-(g=ne[le])[0])*(z=f[1]-(w=ne[le+1])[1])-(L=f[0]-w[0])*(C=f[1]-g[1])==0&&S*L<=0&&C*z<=0)return!1;Lt(s,ne[le],ne[le+1])&&($=!$)}return $}function Sn(s,l){for(var f=0;f<l.length;f++)if(xr(s,l[f]))return!0;return!1}function Ci(s,l,f,g){var w=g[0]-f[0],S=g[1]-f[1],C=(s[0]-f[0])*S-w*(s[1]-f[1]),L=(l[0]-f[0])*S-w*(l[1]-f[1]);return C>0&&L<0||C<0&&L>0}function Io(s,l,f){for(var g=0,w=f;g<w.length;g+=1)for(var S=w[g],C=0;C<S.length-1;++C)if((K=[(W=S[C+1])[0]-($=S[C])[0],W[1]-$[1]])[0]*(ne=[(z=l)[0]-(L=s)[0],z[1]-L[1]])[1]-K[1]*ne[0]!=0&&Ci(L,z,$,W)&&Ci($,W,L,z))return!0;var L,z,$,W,K,ne;return!1}function Oo(s,l){for(var f=0;f<s.length;++f)if(!xr(s[f],l))return!1;for(var g=0;g<s.length-1;++g)if(Io(s[g],s[g+1],l))return!1;return!0}function ts(s,l){for(var f=0;f<l.length;f++)if(Oo(s,l[f]))return!0;return!1}function Do(s,l,f){for(var g=[],w=0;w<s.length;w++){for(var S=[],C=0;C<s[w].length;C++){var L=Xe(s[w][C],f);se(l,L),S.push(L)}g.push(S)}return g}function Wp(s,l,f){for(var g=[],w=0;w<s.length;w++){var S=Do(s[w],l,f);g.push(S)}return g}function sh(s,l,f,g){if(s[0]<f[0]||s[0]>f[2]){var w=.5*g,S=s[0]-f[0]>w?-g:f[0]-s[0]>w?g:0;S===0&&(S=s[0]-f[2]>w?-g:f[2]-s[0]>w?g:0),s[0]+=S}se(l,s)}function Vd(s,l,f,g){for(var w=8192*Math.pow(2,g.z),S=[8192*g.x,8192*g.y],C=[],L=0,z=s;L<z.length;L+=1)for(var $=0,W=z[L];$<W.length;$+=1){var K=W[$],ne=[K.x+S[0],K.y+S[1]];sh(ne,l,f,w),C.push(ne)}return C}function Qh(s,l,f,g){for(var w,S=8192*Math.pow(2,g.z),C=[8192*g.x,8192*g.y],L=[],z=0,$=s;z<$.length;z+=1){for(var W=[],K=0,ne=$[z];K<ne.length;K+=1){var le=ne[K],Ie=[le.x+C[0],le.y+C[1]];se(l,Ie),W.push(Ie)}L.push(W)}if(l[2]-l[0]<=S/2){(w=l)[0]=w[1]=1/0,w[2]=w[3]=-1/0;for(var ke=0,Ze=L;ke<Ze.length;ke+=1)for(var Ve=0,st=Ze[ke];Ve<st.length;Ve+=1)sh(st[Ve],l,f,S)}return L}ps.parse=function(s,l){if(s.length!==2)return l.error("Expected one argument.");var f=s[1];if(typeof f!="object"||Array.isArray(f))return l.error("Collator options argument must be an object.");var g=l.parse(f["case-sensitive"]!==void 0&&f["case-sensitive"],1,Ir);if(!g)return null;var w=l.parse(f["diacritic-sensitive"]!==void 0&&f["diacritic-sensitive"],1,Ir);if(!w)return null;var S=null;return f.locale&&!(S=l.parse(f.locale,1,Kr))?null:new ps(g,w,S)},ps.prototype.evaluate=function(s){return new Mo(this.caseSensitive.evaluate(s),this.diacriticSensitive.evaluate(s),this.locale?this.locale.evaluate(s):null)},ps.prototype.eachChild=function(s){s(this.caseSensitive),s(this.diacriticSensitive),this.locale&&s(this.locale)},ps.prototype.outputDefined=function(){return!1},ps.prototype.serialize=function(){var s={};return s["case-sensitive"]=this.caseSensitive.serialize(),s["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(s.locale=this.locale.serialize()),["collator",s]};var Xs=function(s,l){this.type=Ir,this.geojson=s,this.geometries=l};function oc(s){if(s instanceof _o&&(s.name==="get"&&s.args.length===1||s.name==="feature-state"||s.name==="has"&&s.args.length===1||s.name==="properties"||s.name==="geometry-type"||s.name==="id"||/^filter-/.test(s.name))||s instanceof Xs)return!1;var l=!0;return s.eachChild(function(f){l&&!oc(f)&&(l=!1)}),l}function sc(s){if(s instanceof _o&&s.name==="feature-state")return!1;var l=!0;return s.eachChild(function(f){l&&!sc(f)&&(l=!1)}),l}function Gc(s,l){if(s instanceof _o&&l.indexOf(s.name)>=0)return!1;var f=!0;return s.eachChild(function(g){f&&!Gc(g,l)&&(f=!1)}),f}Xs.parse=function(s,l){if(s.length!==2)return l.error("'within' expression requires exactly one argument, but found "+(s.length-1)+" instead.");if(Wu(s[1])){var f=s[1];if(f.type==="FeatureCollection")for(var g=0;g<f.features.length;++g){var w=f.features[g].geometry.type;if(w==="Polygon"||w==="MultiPolygon")return new Xs(f,f.features[g].geometry)}else if(f.type==="Feature"){var S=f.geometry.type;if(S==="Polygon"||S==="MultiPolygon")return new Xs(f,f.geometry)}else if(f.type==="Polygon"||f.type==="MultiPolygon")return new Xs(f,f)}return l.error("'within' expression requires valid geojson object that contains polygon geometry type.")},Xs.prototype.evaluate=function(s){if(s.geometry()!=null&&s.canonicalID()!=null){if(s.geometryType()==="Point")return function(l,f){var g=[1/0,1/0,-1/0,-1/0],w=[1/0,1/0,-1/0,-1/0],S=l.canonicalID();if(f.type==="Polygon"){var C=Do(f.coordinates,w,S),L=Vd(l.geometry(),g,w,S);if(!be(g,w))return!1;for(var z=0,$=L;z<$.length;z+=1)if(!xr($[z],C))return!1}if(f.type==="MultiPolygon"){var W=Wp(f.coordinates,w,S),K=Vd(l.geometry(),g,w,S);if(!be(g,w))return!1;for(var ne=0,le=K;ne<le.length;ne+=1)if(!Sn(le[ne],W))return!1}return!0}(s,this.geometries);if(s.geometryType()==="LineString")return function(l,f){var g=[1/0,1/0,-1/0,-1/0],w=[1/0,1/0,-1/0,-1/0],S=l.canonicalID();if(f.type==="Polygon"){var C=Do(f.coordinates,w,S),L=Qh(l.geometry(),g,w,S);if(!be(g,w))return!1;for(var z=0,$=L;z<$.length;z+=1)if(!Oo($[z],C))return!1}if(f.type==="MultiPolygon"){var W=Wp(f.coordinates,w,S),K=Qh(l.geometry(),g,w,S);if(!be(g,w))return!1;for(var ne=0,le=K;ne<le.length;ne+=1)if(!ts(le[ne],W))return!1}return!0}(s,this.geometries)}return!1},Xs.prototype.eachChild=function(){},Xs.prototype.outputDefined=function(){return!0},Xs.prototype.serialize=function(){return["within",this.geojson]};var Ys=function(s,l){this.type=l.type,this.name=s,this.boundExpression=l};Ys.parse=function(s,l){if(s.length!==2||typeof s[1]!="string")return l.error("'var' expression requires exactly one string literal argument.");var f=s[1];return l.scope.has(f)?new Ys(f,l.scope.get(f)):l.error('Unknown variable "'+f+'". Make sure "'+f+'" has been bound in an enclosing "let" expression before using it.',1)},Ys.prototype.evaluate=function(s){return this.boundExpression.evaluate(s)},Ys.prototype.eachChild=function(){},Ys.prototype.outputDefined=function(){return!1},Ys.prototype.serialize=function(){return["var",this.name]};var uc=function(s,l,f,g,w){l===void 0&&(l=[]),g===void 0&&(g=new Sr),w===void 0&&(w=[]),this.registry=s,this.path=l,this.key=l.map(function(S){return"["+S+"]"}).join(""),this.scope=g,this.errors=w,this.expectedType=f};function Na(s,l){for(var f,g=s.length-1,w=0,S=g,C=0;w<=S;)if((f=s[C=Math.floor((w+S)/2)])<=l){if(C===g||l<s[C+1])return C;w=C+1}else{if(!(f>l))throw new Pa("Input is not a number.");S=C-1}return 0}uc.prototype.parse=function(s,l,f,g,w){return w===void 0&&(w={}),l?this.concat(l,f,g)._parse(s,w):this._parse(s,w)},uc.prototype._parse=function(s,l){function f($,W,K){return K==="assert"?new ga(W,[$]):K==="coerce"?new Ts(W,[$]):$}if(s!==null&&typeof s!="string"&&typeof s!="boolean"&&typeof s!="number"||(s=["literal",s]),Array.isArray(s)){if(s.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var g=s[0];if(typeof g!="string")return this.error("Expression name must be a string, but found "+typeof g+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var w=this.registry[g];if(w){var S=w.parse(s,this);if(!S)return null;if(this.expectedType){var C=this.expectedType,L=S.type;if(C.kind!=="string"&&C.kind!=="number"&&C.kind!=="boolean"&&C.kind!=="object"&&C.kind!=="array"||L.kind!=="value")if(C.kind!=="color"&&C.kind!=="formatted"&&C.kind!=="resolvedImage"||L.kind!=="value"&&L.kind!=="string"){if(this.checkSubtype(C,L))return null}else S=f(S,C,l.typeAnnotation||"coerce");else S=f(S,C,l.typeAnnotation||"assert")}if(!(S instanceof Po)&&S.type.kind!=="resolvedImage"&&function $(W){if(W instanceof Ys)return $(W.boundExpression);if(W instanceof _o&&W.name==="error"||W instanceof ps||W instanceof Xs)return!1;var K=W instanceof Ts||W instanceof ga,ne=!0;return W.eachChild(function(le){ne=K?ne&&$(le):ne&&le instanceof Po}),!!ne&&oc(W)&&Gc(W,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(S)){var z=new Ws;try{S=new Po(S.type,S.evaluate(z))}catch($){return this.error($.message),null}}return S}return this.error('Unknown expression "'+g+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(s===void 0?"'undefined' value invalid. Use null instead.":typeof s=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof s+" instead.")},uc.prototype.concat=function(s,l,f){var g=typeof s=="number"?this.path.concat(s):this.path,w=f?this.scope.concat(f):this.scope;return new uc(this.registry,g,l||null,w,this.errors)},uc.prototype.error=function(s){for(var l=[],f=arguments.length-1;f-- >0;)l[f]=arguments[f+1];var g=""+this.key+l.map(function(w){return"["+w+"]"}).join("");this.errors.push(new ir(g,s))},uc.prototype.checkSubtype=function(s,l){var f=Ni(s,l);return f&&this.error(f),f};var Mi=function(s,l,f){this.type=s,this.input=l,this.labels=[],this.outputs=[];for(var g=0,w=f;g<w.length;g+=1){var S=w[g],C=S[1];this.labels.push(S[0]),this.outputs.push(C)}};function ao(s,l,f){return s*(1-f)+l*f}Mi.parse=function(s,l){if(s.length-1<4)return l.error("Expected at least 4 arguments, but found only "+(s.length-1)+".");if((s.length-1)%2!=0)return l.error("Expected an even number of arguments.");var f=l.parse(s[1],1,Dt);if(!f)return null;var g=[],w=null;l.expectedType&&l.expectedType.kind!=="value"&&(w=l.expectedType);for(var S=1;S<s.length;S+=2){var C=S===1?-1/0:s[S],L=s[S+1],z=S,$=S+1;if(typeof C!="number")return l.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',z);if(g.length&&g[g.length-1][0]>=C)return l.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',z);var W=l.parse(L,$,w);if(!W)return null;w=w||W.type,g.push([C,W])}return new Mi(w,f,g)},Mi.prototype.evaluate=function(s){var l=this.labels,f=this.outputs;if(l.length===1)return f[0].evaluate(s);var g=this.input.evaluate(s);if(g<=l[0])return f[0].evaluate(s);var w=l.length;return g>=l[w-1]?f[w-1].evaluate(s):f[Na(l,g)].evaluate(s)},Mi.prototype.eachChild=function(s){s(this.input);for(var l=0,f=this.outputs;l<f.length;l+=1)s(f[l])},Mi.prototype.outputDefined=function(){return this.outputs.every(function(s){return s.outputDefined()})},Mi.prototype.serialize=function(){for(var s=["step",this.input.serialize()],l=0;l<this.labels.length;l++)l>0&&s.push(this.labels[l]),s.push(this.outputs[l].serialize());return s};var Hc=Object.freeze({__proto__:null,number:ao,color:function(s,l,f){return new vi(ao(s.r,l.r,f),ao(s.g,l.g,f),ao(s.b,l.b,f),ao(s.a,l.a,f))},array:function(s,l,f){return s.map(function(g,w){return ao(g,l[w],f)})}}),Xp=6/29*3*(6/29),Uv=Math.PI/180,Yp=180/Math.PI;function uh(s){return s>.008856451679035631?Math.pow(s,1/3):s/Xp+4/29}function Xu(s){return s>6/29?s*s*s:Xp*(s-4/29)}function xf(s){return 255*(s<=.0031308?12.92*s:1.055*Math.pow(s,1/2.4)-.055)}function Fo(s){return(s/=255)<=.04045?s/12.92:Math.pow((s+.055)/1.055,2.4)}function lh(s){var l=Fo(s.r),f=Fo(s.g),g=Fo(s.b),w=uh((.4124564*l+.3575761*f+.1804375*g)/.95047),S=uh((.2126729*l+.7151522*f+.072175*g)/1);return{l:116*S-16,a:500*(w-S),b:200*(S-uh((.0193339*l+.119192*f+.9503041*g)/1.08883)),alpha:s.a}}function lc(s){var l=(s.l+16)/116,f=isNaN(s.a)?l:l+s.a/500,g=isNaN(s.b)?l:l-s.b/200;return l=1*Xu(l),f=.95047*Xu(f),g=1.08883*Xu(g),new vi(xf(3.2404542*f-1.5371385*l-.4985314*g),xf(-.969266*f+1.8760108*l+.041556*g),xf(.0556434*f-.2040259*l+1.0572252*g),s.alpha)}function jd(s,l,f){var g=l-s;return s+f*(g>180||g<-180?g-360*Math.round(g/360):g)}var Wc={forward:lh,reverse:lc,interpolate:function(s,l,f){return{l:ao(s.l,l.l,f),a:ao(s.a,l.a,f),b:ao(s.b,l.b,f),alpha:ao(s.alpha,l.alpha,f)}}},Cs={forward:function(s){var l=lh(s),f=l.l,g=l.a,w=l.b,S=Math.atan2(w,g)*Yp;return{h:S<0?S+360:S,c:Math.sqrt(g*g+w*w),l:f,alpha:s.a}},reverse:function(s){var l=s.h*Uv,f=s.c;return lc({l:s.l,a:Math.cos(l)*f,b:Math.sin(l)*f,alpha:s.alpha})},interpolate:function(s,l,f){return{h:jd(s.h,l.h,f),c:ao(s.c,l.c,f),l:ao(s.l,l.l,f),alpha:ao(s.alpha,l.alpha,f)}}},qp=Object.freeze({__proto__:null,lab:Wc,hcl:Cs}),Ho=function(s,l,f,g,w){this.type=s,this.operator=l,this.interpolation=f,this.input=g,this.labels=[],this.outputs=[];for(var S=0,C=w;S<C.length;S+=1){var L=C[S],z=L[1];this.labels.push(L[0]),this.outputs.push(z)}};function Jh(s,l,f,g){var w=g-f,S=s-f;return w===0?0:l===1?S/w:(Math.pow(l,S)-1)/(Math.pow(l,w)-1)}Ho.interpolationFactor=function(s,l,f,g){var w=0;if(s.name==="exponential")w=Jh(l,s.base,f,g);else if(s.name==="linear")w=Jh(l,1,f,g);else if(s.name==="cubic-bezier"){var S=s.controlPoints;w=new c(S[0],S[1],S[2],S[3]).solve(Jh(l,1,f,g))}return w},Ho.parse=function(s,l){var f=s[0],g=s[1],w=s[2],S=s.slice(3);if(!Array.isArray(g)||g.length===0)return l.error("Expected an interpolation type expression.",1);if(g[0]==="linear")g={name:"linear"};else if(g[0]==="exponential"){var C=g[1];if(typeof C!="number")return l.error("Exponential interpolation requires a numeric base.",1,1);g={name:"exponential",base:C}}else{if(g[0]!=="cubic-bezier")return l.error("Unknown interpolation type "+String(g[0]),1,0);var L=g.slice(1);if(L.length!==4||L.some(function(Ze){return typeof Ze!="number"||Ze<0||Ze>1}))return l.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);g={name:"cubic-bezier",controlPoints:L}}if(s.length-1<4)return l.error("Expected at least 4 arguments, but found only "+(s.length-1)+".");if((s.length-1)%2!=0)return l.error("Expected an even number of arguments.");if(!(w=l.parse(w,2,Dt)))return null;var z=[],$=null;f==="interpolate-hcl"||f==="interpolate-lab"?$=Dr:l.expectedType&&l.expectedType.kind!=="value"&&($=l.expectedType);for(var W=0;W<S.length;W+=2){var K=S[W],ne=S[W+1],le=W+3,Ie=W+4;if(typeof K!="number")return l.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',le);if(z.length&&z[z.length-1][0]>=K)return l.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',le);var ke=l.parse(ne,Ie,$);if(!ke)return null;$=$||ke.type,z.push([K,ke])}return $.kind==="number"||$.kind==="color"||$.kind==="array"&&$.itemType.kind==="number"&&typeof $.N=="number"?new Ho($,f,g,w,z):l.error("Type "+Ti($)+" is not interpolatable.")},Ho.prototype.evaluate=function(s){var l=this.labels,f=this.outputs;if(l.length===1)return f[0].evaluate(s);var g=this.input.evaluate(s);if(g<=l[0])return f[0].evaluate(s);var w=l.length;if(g>=l[w-1])return f[w-1].evaluate(s);var S=Na(l,g),C=Ho.interpolationFactor(this.interpolation,g,l[S],l[S+1]),L=f[S].evaluate(s),z=f[S+1].evaluate(s);return this.operator==="interpolate"?Hc[this.type.kind.toLowerCase()](L,z,C):this.operator==="interpolate-hcl"?Cs.reverse(Cs.interpolate(Cs.forward(L),Cs.forward(z),C)):Wc.reverse(Wc.interpolate(Wc.forward(L),Wc.forward(z),C))},Ho.prototype.eachChild=function(s){s(this.input);for(var l=0,f=this.outputs;l<f.length;l+=1)s(f[l])},Ho.prototype.outputDefined=function(){return this.outputs.every(function(s){return s.outputDefined()})},Ho.prototype.serialize=function(){var s;s=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var l=[this.operator,s,this.input.serialize()],f=0;f<this.labels.length;f++)l.push(this.labels[f],this.outputs[f].serialize());return l};var Ms=function(s,l){this.type=s,this.args=l};Ms.parse=function(s,l){if(s.length<2)return l.error("Expectected at least one argument.");var f=null,g=l.expectedType;g&&g.kind!=="value"&&(f=g);for(var w=[],S=0,C=s.slice(1);S<C.length;S+=1){var L=l.parse(C[S],1+w.length,f,void 0,{typeAnnotation:"omit"});if(!L)return null;f=f||L.type,w.push(L)}var z=g&&w.some(function($){return Ni(g,$.type)});return new Ms(z?Fr:f,w)},Ms.prototype.evaluate=function(s){for(var l,f=null,g=0,w=0,S=this.args;w<S.length&&(g++,(f=S[w].evaluate(s))&&f instanceof Go&&!f.available&&(l||(l=f.name),f=null,g===this.args.length&&(f=l)),f===null);w+=1);return f},Ms.prototype.eachChild=function(s){this.args.forEach(s)},Ms.prototype.outputDefined=function(){return this.args.every(function(s){return s.outputDefined()})},Ms.prototype.serialize=function(){var s=["coalesce"];return this.eachChild(function(l){s.push(l.serialize())}),s};var zl=function(s,l){this.type=l.type,this.bindings=[].concat(s),this.result=l};zl.prototype.evaluate=function(s){return this.result.evaluate(s)},zl.prototype.eachChild=function(s){for(var l=0,f=this.bindings;l<f.length;l+=1)s(f[l][1]);s(this.result)},zl.parse=function(s,l){if(s.length<4)return l.error("Expected at least 3 arguments, but found "+(s.length-1)+" instead.");for(var f=[],g=1;g<s.length-1;g+=2){var w=s[g];if(typeof w!="string")return l.error("Expected string, but found "+typeof w+" instead.",g);if(/[^a-zA-Z0-9_]/.test(w))return l.error("Variable names must contain only alphanumeric characters or '_'.",g);var S=l.parse(s[g+1],g+1);if(!S)return null;f.push([w,S])}var C=l.parse(s[s.length-1],s.length-1,l.expectedType,f);return C?new zl(f,C):null},zl.prototype.outputDefined=function(){return this.result.outputDefined()},zl.prototype.serialize=function(){for(var s=["let"],l=0,f=this.bindings;l<f.length;l+=1){var g=f[l];s.push(g[0],g[1].serialize())}return s.push(this.result.serialize()),s};var cc=function(s,l,f){this.type=s,this.index=l,this.input=f};cc.parse=function(s,l){if(s.length!==3)return l.error("Expected 2 arguments, but found "+(s.length-1)+" instead.");var f=l.parse(s[1],1,Dt),g=l.parse(s[2],2,Si(l.expectedType||Fr));return f&&g?new cc(g.type.itemType,f,g):null},cc.prototype.evaluate=function(s){var l=this.index.evaluate(s),f=this.input.evaluate(s);if(l<0)throw new Pa("Array index out of bounds: "+l+" < 0.");if(l>=f.length)throw new Pa("Array index out of bounds: "+l+" > "+(f.length-1)+".");if(l!==Math.floor(l))throw new Pa("Array index must be an integer, but found "+l+" instead.");return f[l]},cc.prototype.eachChild=function(s){s(this.index),s(this.input)},cc.prototype.outputDefined=function(){return!1},cc.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var lo=function(s,l){this.type=Ir,this.needle=s,this.haystack=l};lo.parse=function(s,l){if(s.length!==3)return l.error("Expected 2 arguments, but found "+(s.length-1)+" instead.");var f=l.parse(s[1],1,Fr),g=l.parse(s[2],2,Fr);return f&&g?Hi(f.type,[Ir,Kr,Dt,nn,Fr])?new lo(f,g):l.error("Expected first argument to be of type boolean, string, number or null, but found "+Ti(f.type)+" instead"):null},lo.prototype.evaluate=function(s){var l=this.needle.evaluate(s),f=this.haystack.evaluate(s);if(!f)return!1;if(!Di(l,["boolean","string","number","null"]))throw new Pa("Expected first argument to be of type boolean, string, number or null, but found "+Ti(Wi(l))+" instead.");if(!Di(f,["string","array"]))throw new Pa("Expected second argument to be of type array or string, but found "+Ti(Wi(f))+" instead.");return f.indexOf(l)>=0},lo.prototype.eachChild=function(s){s(this.needle),s(this.haystack)},lo.prototype.outputDefined=function(){return!0},lo.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var fc=function(s,l,f){this.type=Dt,this.needle=s,this.haystack=l,this.fromIndex=f};fc.parse=function(s,l){if(s.length<=2||s.length>=5)return l.error("Expected 3 or 4 arguments, but found "+(s.length-1)+" instead.");var f=l.parse(s[1],1,Fr),g=l.parse(s[2],2,Fr);if(!f||!g)return null;if(!Hi(f.type,[Ir,Kr,Dt,nn,Fr]))return l.error("Expected first argument to be of type boolean, string, number or null, but found "+Ti(f.type)+" instead");if(s.length===4){var w=l.parse(s[3],3,Dt);return w?new fc(f,g,w):null}return new fc(f,g)},fc.prototype.evaluate=function(s){var l=this.needle.evaluate(s),f=this.haystack.evaluate(s);if(!Di(l,["boolean","string","number","null"]))throw new Pa("Expected first argument to be of type boolean, string, number or null, but found "+Ti(Wi(l))+" instead.");if(!Di(f,["string","array"]))throw new Pa("Expected second argument to be of type array or string, but found "+Ti(Wi(f))+" instead.");if(this.fromIndex){var g=this.fromIndex.evaluate(s);return f.indexOf(l,g)}return f.indexOf(l)},fc.prototype.eachChild=function(s){s(this.needle),s(this.haystack),this.fromIndex&&s(this.fromIndex)},fc.prototype.outputDefined=function(){return!1},fc.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var s=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),s]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var co=function(s,l,f,g,w,S){this.inputType=s,this.type=l,this.input=f,this.cases=g,this.outputs=w,this.otherwise=S};co.parse=function(s,l){if(s.length<5)return l.error("Expected at least 4 arguments, but found only "+(s.length-1)+".");if(s.length%2!=1)return l.error("Expected an even number of arguments.");var f,g;l.expectedType&&l.expectedType.kind!=="value"&&(g=l.expectedType);for(var w={},S=[],C=2;C<s.length-1;C+=2){var L=s[C],z=s[C+1];Array.isArray(L)||(L=[L]);var $=l.concat(C);if(L.length===0)return $.error("Expected at least one branch label.");for(var W=0,K=L;W<K.length;W+=1){var ne=K[W];if(typeof ne!="number"&&typeof ne!="string")return $.error("Branch labels must be numbers or strings.");if(typeof ne=="number"&&Math.abs(ne)>Number.MAX_SAFE_INTEGER)return $.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof ne=="number"&&Math.floor(ne)!==ne)return $.error("Numeric branch labels must be integer values.");if(f){if($.checkSubtype(f,Wi(ne)))return null}else f=Wi(ne);if(w[String(ne)]!==void 0)return $.error("Branch labels must be unique.");w[String(ne)]=S.length}var le=l.parse(z,C,g);if(!le)return null;g=g||le.type,S.push(le)}var Ie=l.parse(s[1],1,Fr);if(!Ie)return null;var ke=l.parse(s[s.length-1],s.length-1,g);return ke?Ie.type.kind!=="value"&&l.concat(1).checkSubtype(f,Ie.type)?null:new co(f,g,Ie,w,S,ke):null},co.prototype.evaluate=function(s){var l=this.input.evaluate(s);return(Wi(l)===this.inputType&&this.outputs[this.cases[l]]||this.otherwise).evaluate(s)},co.prototype.eachChild=function(s){s(this.input),this.outputs.forEach(s),s(this.otherwise)},co.prototype.outputDefined=function(){return this.outputs.every(function(s){return s.outputDefined()})&&this.otherwise.outputDefined()},co.prototype.serialize=function(){for(var s=this,l=["match",this.input.serialize()],f=[],g={},w=0,S=Object.keys(this.cases).sort();w<S.length;w+=1){var C=S[w];(K=g[this.cases[C]])===void 0?(g[this.cases[C]]=f.length,f.push([this.cases[C],[C]])):f[K][1].push(C)}for(var L=function(le){return s.inputType.kind==="number"?Number(le):le},z=0,$=f;z<$.length;z+=1){var W=$[z],K=W[0],ne=W[1];l.push(ne.length===1?L(ne[0]):ne.map(L)),l.push(this.outputs[outputIndex$1].serialize())}return l.push(this.otherwise.serialize()),l};var hc=function(s,l,f){this.type=s,this.branches=l,this.otherwise=f};hc.parse=function(s,l){if(s.length<4)return l.error("Expected at least 3 arguments, but found only "+(s.length-1)+".");if(s.length%2!=0)return l.error("Expected an odd number of arguments.");var f;l.expectedType&&l.expectedType.kind!=="value"&&(f=l.expectedType);for(var g=[],w=1;w<s.length-1;w+=2){var S=l.parse(s[w],w,Ir);if(!S)return null;var C=l.parse(s[w+1],w+1,f);if(!C)return null;g.push([S,C]),f=f||C.type}var L=l.parse(s[s.length-1],s.length-1,f);return L?new hc(f,g,L):null},hc.prototype.evaluate=function(s){for(var l=0,f=this.branches;l<f.length;l+=1){var g=f[l],w=g[1];if(g[0].evaluate(s))return w.evaluate(s)}return this.otherwise.evaluate(s)},hc.prototype.eachChild=function(s){for(var l=0,f=this.branches;l<f.length;l+=1){var g=f[l],w=g[1];s(g[0]),s(w)}s(this.otherwise)},hc.prototype.outputDefined=function(){return this.branches.every(function(s){return s[1].outputDefined()})&&this.otherwise.outputDefined()},hc.prototype.serialize=function(){var s=["case"];return this.eachChild(function(l){s.push(l.serialize())}),s};var qs=function(s,l,f,g){this.type=s,this.input=l,this.beginIndex=f,this.endIndex=g};function xl(s,l){return s==="=="||s==="!="?l.kind==="boolean"||l.kind==="string"||l.kind==="number"||l.kind==="null"||l.kind==="value":l.kind==="string"||l.kind==="number"||l.kind==="value"}function Yu(s,l,f,g){return g.compare(l,f)===0}function Ji(s,l,f){var g=s!=="=="&&s!=="!=";return function(){function w(S,C,L){this.type=Ir,this.lhs=S,this.rhs=C,this.collator=L,this.hasUntypedArgument=S.type.kind==="value"||C.type.kind==="value"}return w.parse=function(S,C){if(S.length!==3&&S.length!==4)return C.error("Expected two or three arguments.");var L=S[0],z=C.parse(S[1],1,Fr);if(!z)return null;if(!xl(L,z.type))return C.concat(1).error('"'+L+`" comparisons are not supported for type '`+Ti(z.type)+"'.");var $=C.parse(S[2],2,Fr);if(!$)return null;if(!xl(L,$.type))return C.concat(2).error('"'+L+`" comparisons are not supported for type '`+Ti($.type)+"'.");if(z.type.kind!==$.type.kind&&z.type.kind!=="value"&&$.type.kind!=="value")return C.error("Cannot compare types '"+Ti(z.type)+"' and '"+Ti($.type)+"'.");g&&(z.type.kind==="value"&&$.type.kind!=="value"?z=new ga($.type,[z]):z.type.kind!=="value"&&$.type.kind==="value"&&($=new ga(z.type,[$])));var W=null;if(S.length===4){if(z.type.kind!=="string"&&$.type.kind!=="string"&&z.type.kind!=="value"&&$.type.kind!=="value")return C.error("Cannot use collator to compare non-string types.");if(!(W=C.parse(S[3],3,fi)))return null}return new w(z,$,W)},w.prototype.evaluate=function(S){var C=this.lhs.evaluate(S),L=this.rhs.evaluate(S);if(g&&this.hasUntypedArgument){var z=Wi(C),$=Wi(L);if(z.kind!==$.kind||z.kind!=="string"&&z.kind!=="number")throw new Pa('Expected arguments for "'+s+'" to be (string, string) or (number, number), but found ('+z.kind+", "+$.kind+") instead.")}if(this.collator&&!g&&this.hasUntypedArgument){var W=Wi(C),K=Wi(L);if(W.kind!=="string"||K.kind!=="string")return l(S,C,L)}return this.collator?f(S,C,L,this.collator.evaluate(S)):l(S,C,L)},w.prototype.eachChild=function(S){S(this.lhs),S(this.rhs),this.collator&&S(this.collator)},w.prototype.outputDefined=function(){return!0},w.prototype.serialize=function(){var S=[s];return this.eachChild(function(C){S.push(C.serialize())}),S},w}()}qs.parse=function(s,l){if(s.length<=2||s.length>=5)return l.error("Expected 3 or 4 arguments, but found "+(s.length-1)+" instead.");var f=l.parse(s[1],1,Fr),g=l.parse(s[2],2,Dt);if(!f||!g)return null;if(!Hi(f.type,[Si(Fr),Kr,Fr]))return l.error("Expected first argument to be of type array or string, but found "+Ti(f.type)+" instead");if(s.length===4){var w=l.parse(s[3],3,Dt);return w?new qs(f.type,f,g,w):null}return new qs(f.type,f,g)},qs.prototype.evaluate=function(s){var l=this.input.evaluate(s),f=this.beginIndex.evaluate(s);if(!Di(l,["string","array"]))throw new Pa("Expected first argument to be of type array or string, but found "+Ti(Wi(l))+" instead.");if(this.endIndex){var g=this.endIndex.evaluate(s);return l.slice(f,g)}return l.slice(f)},qs.prototype.eachChild=function(s){s(this.input),s(this.beginIndex),this.endIndex&&s(this.endIndex)},qs.prototype.outputDefined=function(){return!1},qs.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var s=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),s]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var oo=Ji("==",function(s,l,f){return l===f},Yu),qu=Ji("!=",function(s,l,f){return l!==f},function(s,l,f,g){return!Yu(0,l,f,g)}),ep=Ji("<",function(s,l,f){return l<f},function(s,l,f,g){return g.compare(l,f)<0}),Zp=Ji(">",function(s,l,f){return l>f},function(s,l,f,g){return g.compare(l,f)>0}),tp=Ji("<=",function(s,l,f){return l<=f},function(s,l,f,g){return g.compare(l,f)<=0}),$d=Ji(">=",function(s,l,f){return l>=f},function(s,l,f,g){return g.compare(l,f)>=0}),pc=function(s,l,f,g,w){this.type=Kr,this.number=s,this.locale=l,this.currency=f,this.minFractionDigits=g,this.maxFractionDigits=w};pc.parse=function(s,l){if(s.length!==3)return l.error("Expected two arguments.");var f=l.parse(s[1],1,Dt);if(!f)return null;var g=s[2];if(typeof g!="object"||Array.isArray(g))return l.error("NumberFormat options argument must be an object.");var w=null;if(g.locale&&!(w=l.parse(g.locale,1,Kr)))return null;var S=null;if(g.currency&&!(S=l.parse(g.currency,1,Kr)))return null;var C=null;if(g["min-fraction-digits"]&&!(C=l.parse(g["min-fraction-digits"],1,Dt)))return null;var L=null;return g["max-fraction-digits"]&&!(L=l.parse(g["max-fraction-digits"],1,Dt))?null:new pc(f,w,S,C,L)},pc.prototype.evaluate=function(s){return new Intl.NumberFormat(this.locale?this.locale.evaluate(s):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(s):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(s):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(s):void 0}).format(this.number.evaluate(s))},pc.prototype.eachChild=function(s){s(this.number),this.locale&&s(this.locale),this.currency&&s(this.currency),this.minFractionDigits&&s(this.minFractionDigits),this.maxFractionDigits&&s(this.maxFractionDigits)},pc.prototype.outputDefined=function(){return!1},pc.prototype.serialize=function(){var s={};return this.locale&&(s.locale=this.locale.serialize()),this.currency&&(s.currency=this.currency.serialize()),this.minFractionDigits&&(s["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(s["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),s]};var wa=function(s){this.type=Dt,this.input=s};wa.parse=function(s,l){if(s.length!==2)return l.error("Expected 1 argument, but found "+(s.length-1)+" instead.");var f=l.parse(s[1],1);return f?f.type.kind!=="array"&&f.type.kind!=="string"&&f.type.kind!=="value"?l.error("Expected argument of type string or array, but found "+Ti(f.type)+" instead."):new wa(f):null},wa.prototype.evaluate=function(s){var l=this.input.evaluate(s);if(typeof l=="string"||Array.isArray(l))return l.length;throw new Pa("Expected value to be of type string or array, but found "+Ti(Wi(l))+" instead.")},wa.prototype.eachChild=function(s){s(this.input)},wa.prototype.outputDefined=function(){return!1},wa.prototype.serialize=function(){var s=["length"];return this.eachChild(function(l){s.push(l.serialize())}),s};var Ul={"==":oo,"!=":qu,">":Zp,"<":ep,">=":$d,"<=":tp,array:ga,at:cc,boolean:ga,case:hc,coalesce:Ms,collator:ps,format:hs,image:Fa,in:lo,"index-of":fc,interpolate:Ho,"interpolate-hcl":Ho,"interpolate-lab":Ho,length:wa,let:zl,literal:Po,match:co,number:ga,"number-format":pc,object:ga,slice:qs,step:Mi,string:ga,"to-boolean":Ts,"to-color":Ts,"to-number":Ts,"to-string":Ts,var:Ys,within:Xs};function ch(s,l){var f=l[0],g=l[1],w=l[2],S=l[3];f=f.evaluate(s),g=g.evaluate(s),w=w.evaluate(s);var C=S?S.evaluate(s):1,L=$c(f,g,w,C);if(L)throw new Pa(L);return new vi(f/255*C,g/255*C,w/255*C,C)}function Ps(s,l){return s in l}function fh(s,l){var f=l[s];return f===void 0?null:f}function Zu(s){return{type:s}}function Vl(s){return{result:"success",value:s}}function Ku(s){return{result:"error",value:s}}function Au(s){return s["property-type"]==="data-driven"||s["property-type"]==="cross-faded-data-driven"}function Xc(s){return!!s.expression&&s.expression.parameters.indexOf("zoom")>-1}function dc(s){return!!s.expression&&s.expression.interpolated}function pa(s){return s instanceof Number?"number":s instanceof String?"string":s instanceof Boolean?"boolean":Array.isArray(s)?"array":s===null?"null":typeof s}function vc(s){return typeof s=="object"&&s!==null&&!Array.isArray(s)}function Gd(s){return s}function Yc(s,l,f){return s!==void 0?s:l!==void 0?l:f!==void 0?f:void 0}function Zs(s,l,f,g,w){return Yc(typeof f===w?g[f]:void 0,s.default,l.default)}function Kp(s,l,f){if(pa(f)!=="number")return Yc(s.default,l.default);var g=s.stops.length;if(g===1||f<=s.stops[0][0])return s.stops[0][1];if(f>=s.stops[g-1][0])return s.stops[g-1][1];var w=Na(s.stops.map(function(S){return S[0]}),f);return s.stops[w][1]}function bf(s,l,f){var g=s.base!==void 0?s.base:1;if(pa(f)!=="number")return Yc(s.default,l.default);var w=s.stops.length;if(w===1||f<=s.stops[0][0])return s.stops[0][1];if(f>=s.stops[w-1][0])return s.stops[w-1][1];var S=Na(s.stops.map(function(K){return K[0]}),f),C=function(K,ne,le,Ie){var ke=Ie-le,Ze=K-le;return ke===0?0:ne===1?Ze/ke:(Math.pow(ne,Ze)-1)/(Math.pow(ne,ke)-1)}(f,g,s.stops[S][0],s.stops[S+1][0]),L=s.stops[S][1],z=s.stops[S+1][1],$=Hc[l.type]||Gd;if(s.colorSpace&&s.colorSpace!=="rgb"){var W=qp[s.colorSpace];$=function(K,ne){return W.reverse(W.interpolate(W.forward(K),W.forward(ne),C))}}return typeof L.evaluate=="function"?{evaluate:function(){for(var K=[],ne=arguments.length;ne--;)K[ne]=arguments[ne];var le=L.evaluate.apply(void 0,K),Ie=z.evaluate.apply(void 0,K);if(le!==void 0&&Ie!==void 0)return $(le,Ie,C)}}:$(L,z,C)}function qc(s,l,f){return l.type==="color"?f=vi.parse(f):l.type==="formatted"?f=Ma.fromString(f.toString()):l.type==="resolvedImage"?f=Go.fromString(f.toString()):pa(f)===l.type||l.type==="enum"&&l.values[f]||(f=void 0),Yc(f,s.default,l.default)}_o.register(Ul,{error:[{kind:"error"},[Kr],function(s,l){throw new Pa(l[0].evaluate(s))}],typeof:[Kr,[Fr],function(s,l){return Ti(Wi(l[0].evaluate(s)))}],"to-rgba":[Si(Dt,4),[Dr],function(s,l){return l[0].evaluate(s).toArray()}],rgb:[Dr,[Dt,Dt,Dt],ch],rgba:[Dr,[Dt,Dt,Dt,Dt],ch],has:{type:Ir,overloads:[[[Kr],function(s,l){return Ps(l[0].evaluate(s),s.properties())}],[[Kr,ii],function(s,l){var f=l[1];return Ps(l[0].evaluate(s),f.evaluate(s))}]]},get:{type:Fr,overloads:[[[Kr],function(s,l){return fh(l[0].evaluate(s),s.properties())}],[[Kr,ii],function(s,l){var f=l[1];return fh(l[0].evaluate(s),f.evaluate(s))}]]},"feature-state":[Fr,[Kr],function(s,l){return fh(l[0].evaluate(s),s.featureState||{})}],properties:[ii,[],function(s){return s.properties()}],"geometry-type":[Kr,[],function(s){return s.geometryType()}],id:[Fr,[],function(s){return s.id()}],zoom:[Dt,[],function(s){return s.globals.zoom}],"heatmap-density":[Dt,[],function(s){return s.globals.heatmapDensity||0}],"line-progress":[Dt,[],function(s){return s.globals.lineProgress||0}],accumulated:[Fr,[],function(s){return s.globals.accumulated===void 0?null:s.globals.accumulated}],"+":[Dt,Zu(Dt),function(s,l){for(var f=0,g=0,w=l;g<w.length;g+=1)f+=w[g].evaluate(s);return f}],"*":[Dt,Zu(Dt),function(s,l){for(var f=1,g=0,w=l;g<w.length;g+=1)f*=w[g].evaluate(s);return f}],"-":{type:Dt,overloads:[[[Dt,Dt],function(s,l){var f=l[1];return l[0].evaluate(s)-f.evaluate(s)}],[[Dt],function(s,l){return-l[0].evaluate(s)}]]},"/":[Dt,[Dt,Dt],function(s,l){var f=l[1];return l[0].evaluate(s)/f.evaluate(s)}],"%":[Dt,[Dt,Dt],function(s,l){var f=l[1];return l[0].evaluate(s)%f.evaluate(s)}],ln2:[Dt,[],function(){return Math.LN2}],pi:[Dt,[],function(){return Math.PI}],e:[Dt,[],function(){return Math.E}],"^":[Dt,[Dt,Dt],function(s,l){var f=l[1];return Math.pow(l[0].evaluate(s),f.evaluate(s))}],sqrt:[Dt,[Dt],function(s,l){return Math.sqrt(l[0].evaluate(s))}],log10:[Dt,[Dt],function(s,l){return Math.log(l[0].evaluate(s))/Math.LN10}],ln:[Dt,[Dt],function(s,l){return Math.log(l[0].evaluate(s))}],log2:[Dt,[Dt],function(s,l){return Math.log(l[0].evaluate(s))/Math.LN2}],sin:[Dt,[Dt],function(s,l){return Math.sin(l[0].evaluate(s))}],cos:[Dt,[Dt],function(s,l){return Math.cos(l[0].evaluate(s))}],tan:[Dt,[Dt],function(s,l){return Math.tan(l[0].evaluate(s))}],asin:[Dt,[Dt],function(s,l){return Math.asin(l[0].evaluate(s))}],acos:[Dt,[Dt],function(s,l){return Math.acos(l[0].evaluate(s))}],atan:[Dt,[Dt],function(s,l){return Math.atan(l[0].evaluate(s))}],min:[Dt,Zu(Dt),function(s,l){return Math.min.apply(Math,l.map(function(f){return f.evaluate(s)}))}],max:[Dt,Zu(Dt),function(s,l){return Math.max.apply(Math,l.map(function(f){return f.evaluate(s)}))}],abs:[Dt,[Dt],function(s,l){return Math.abs(l[0].evaluate(s))}],round:[Dt,[Dt],function(s,l){var f=l[0].evaluate(s);return f<0?-Math.round(-f):Math.round(f)}],floor:[Dt,[Dt],function(s,l){return Math.floor(l[0].evaluate(s))}],ceil:[Dt,[Dt],function(s,l){return Math.ceil(l[0].evaluate(s))}],"filter-==":[Ir,[Kr,Fr],function(s,l){var f=l[0],g=l[1];return s.properties()[f.value]===g.value}],"filter-id-==":[Ir,[Fr],function(s,l){var f=l[0];return s.id()===f.value}],"filter-type-==":[Ir,[Kr],function(s,l){var f=l[0];return s.geometryType()===f.value}],"filter-<":[Ir,[Kr,Fr],function(s,l){var f=l[0],g=l[1],w=s.properties()[f.value],S=g.value;return typeof w==typeof S&&w<S}],"filter-id-<":[Ir,[Fr],function(s,l){var f=l[0],g=s.id(),w=f.value;return typeof g==typeof w&&g<w}],"filter->":[Ir,[Kr,Fr],function(s,l){var f=l[0],g=l[1],w=s.properties()[f.value],S=g.value;return typeof w==typeof S&&w>S}],"filter-id->":[Ir,[Fr],function(s,l){var f=l[0],g=s.id(),w=f.value;return typeof g==typeof w&&g>w}],"filter-<=":[Ir,[Kr,Fr],function(s,l){var f=l[0],g=l[1],w=s.properties()[f.value],S=g.value;return typeof w==typeof S&&w<=S}],"filter-id-<=":[Ir,[Fr],function(s,l){var f=l[0],g=s.id(),w=f.value;return typeof g==typeof w&&g<=w}],"filter->=":[Ir,[Kr,Fr],function(s,l){var f=l[0],g=l[1],w=s.properties()[f.value],S=g.value;return typeof w==typeof S&&w>=S}],"filter-id->=":[Ir,[Fr],function(s,l){var f=l[0],g=s.id(),w=f.value;return typeof g==typeof w&&g>=w}],"filter-has":[Ir,[Fr],function(s,l){return l[0].value in s.properties()}],"filter-has-id":[Ir,[],function(s){return s.id()!==null&&s.id()!==void 0}],"filter-type-in":[Ir,[Si(Kr)],function(s,l){return l[0].value.indexOf(s.geometryType())>=0}],"filter-id-in":[Ir,[Si(Fr)],function(s,l){return l[0].value.indexOf(s.id())>=0}],"filter-in-small":[Ir,[Kr,Si(Fr)],function(s,l){var f=l[0];return l[1].value.indexOf(s.properties()[f.value])>=0}],"filter-in-large":[Ir,[Kr,Si(Fr)],function(s,l){var f=l[0],g=l[1];return function(w,S,C,L){for(;C<=L;){var z=C+L>>1;if(S[z]===w)return!0;S[z]>w?L=z-1:C=z+1}return!1}(s.properties()[f.value],g.value,0,g.value.length-1)}],all:{type:Ir,overloads:[[[Ir,Ir],function(s,l){var f=l[1];return l[0].evaluate(s)&&f.evaluate(s)}],[Zu(Ir),function(s,l){for(var f=0,g=l;f<g.length;f+=1)if(!g[f].evaluate(s))return!1;return!0}]]},any:{type:Ir,overloads:[[[Ir,Ir],function(s,l){var f=l[1];return l[0].evaluate(s)||f.evaluate(s)}],[Zu(Ir),function(s,l){for(var f=0,g=l;f<g.length;f+=1)if(g[f].evaluate(s))return!0;return!1}]]},"!":[Ir,[Ir],function(s,l){return!l[0].evaluate(s)}],"is-supported-script":[Ir,[Kr],function(s,l){var f=s.globals&&s.globals.isSupportedScript;return!f||f(l[0].evaluate(s))}],upcase:[Kr,[Kr],function(s,l){return l[0].evaluate(s).toUpperCase()}],downcase:[Kr,[Kr],function(s,l){return l[0].evaluate(s).toLowerCase()}],concat:[Kr,Zu(Fr),function(s,l){return l.map(function(f){return _l(f.evaluate(s))}).join("")}],"resolved-locale":[Kr,[fi],function(s,l){return l[0].evaluate(s).resolvedLocale()}]});var bl=function(s,l){this.expression=s,this._warningHistory={},this._evaluator=new Ws,this._defaultValue=l?function(f){return f.type==="color"&&vc(f.default)?new vi(0,0,0,0):f.type==="color"?vi.parse(f.default)||null:f.default===void 0?null:f.default}(l):null,this._enumValues=l&&l.type==="enum"?l.values:null};function Zc(s){return Array.isArray(s)&&s.length>0&&typeof s[0]=="string"&&s[0]in Ul}function wf(s,l){var f=new uc(Ul,[],l?function(w){var S={color:Dr,string:Kr,number:Dt,enum:Kr,boolean:Ir,formatted:Oi,resolvedImage:oi};return w.type==="array"?Si(S[w.value]||Fr,w.length):S[w.type]}(l):void 0),g=f.parse(s,void 0,void 0,void 0,l&&l.type==="string"?{typeAnnotation:"coerce"}:void 0);return g?Vl(new bl(g,l)):Ku(f.errors)}bl.prototype.evaluateWithoutErrorHandling=function(s,l,f,g,w,S){return this._evaluator.globals=s,this._evaluator.feature=l,this._evaluator.featureState=f,this._evaluator.canonical=g,this._evaluator.availableImages=w||null,this._evaluator.formattedSection=S,this.expression.evaluate(this._evaluator)},bl.prototype.evaluate=function(s,l,f,g,w,S){this._evaluator.globals=s,this._evaluator.feature=l||null,this._evaluator.featureState=f||null,this._evaluator.canonical=g,this._evaluator.availableImages=w||null,this._evaluator.formattedSection=S||null;try{var C=this.expression.evaluate(this._evaluator);if(C==null||typeof C=="number"&&C!=C)return this._defaultValue;if(this._enumValues&&!(C in this._enumValues))throw new Pa("Expected value to be one of "+Object.keys(this._enumValues).map(function(L){return JSON.stringify(L)}).join(", ")+", but found "+JSON.stringify(C)+" instead.");return C}catch(L){return this._warningHistory[L.message]||(this._warningHistory[L.message]=!0,typeof console<"u"),this._defaultValue}};var wl=function(s,l){this.kind=s,this._styleExpression=l,this.isStateDependent=s!=="constant"&&!sc(l.expression)};wl.prototype.evaluateWithoutErrorHandling=function(s,l,f,g,w,S){return this._styleExpression.evaluateWithoutErrorHandling(s,l,f,g,w,S)},wl.prototype.evaluate=function(s,l,f,g,w,S){return this._styleExpression.evaluate(s,l,f,g,w,S)};var mc=function(s,l,f,g){this.kind=s,this.zoomStops=f,this._styleExpression=l,this.isStateDependent=s!=="camera"&&!sc(l.expression),this.interpolationType=g};function rp(s,l){if((s=wf(s,l)).result==="error")return s;var f=s.value.expression,g=oc(f);if(!g&&!Au(l))return Ku([new ir("","data expressions not supported")]);var w=Gc(f,["zoom"]);if(!w&&!Xc(l))return Ku([new ir("","zoom expressions not supported")]);var S=function C(L){var z=null;if(L instanceof zl)z=C(L.result);else if(L instanceof Ms)for(var $=0,W=L.args;$<W.length&&!(z=C(W[$]));$+=1);else(L instanceof Mi||L instanceof Ho)&&L.input instanceof _o&&L.input.name==="zoom"&&(z=L);return z instanceof ir||L.eachChild(function(K){var ne=C(K);ne instanceof ir?z=ne:!z&&ne?z=new ir("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):z&&ne&&z!==ne&&(z=new ir("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),z}(f);return S||w?S instanceof ir?Ku([S]):S instanceof Ho&&!dc(l)?Ku([new ir("",'"interpolate" expressions cannot be used with this property')]):Vl(S?new mc(g?"camera":"composite",s.value,S.labels,S instanceof Ho?S.interpolation:void 0):new wl(g?"constant":"source",s.value)):Ku([new ir("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}mc.prototype.evaluateWithoutErrorHandling=function(s,l,f,g,w,S){return this._styleExpression.evaluateWithoutErrorHandling(s,l,f,g,w,S)},mc.prototype.evaluate=function(s,l,f,g,w,S){return this._styleExpression.evaluate(s,l,f,g,w,S)},mc.prototype.interpolationFactor=function(s,l,f){return this.interpolationType?Ho.interpolationFactor(this.interpolationType,s,l,f):0};var cu=function(s,l){this._parameters=s,this._specification=l,nr(this,function f(g,w){var S,C,L,z=w.type==="color",$=g.stops&&typeof g.stops[0][0]=="object",W=$||!($||g.property!==void 0),K=g.type||(dc(w)?"exponential":"interval");if(z&&((g=nr({},g)).stops&&(g.stops=g.stops.map(function(qr){return[qr[0],vi.parse(qr[1])]})),g.default=vi.parse(g.default?g.default:w.default)),g.colorSpace&&g.colorSpace!=="rgb"&&!qp[g.colorSpace])throw new Error("Unknown color space: "+g.colorSpace);if(K==="exponential")S=bf;else if(K==="interval")S=Kp;else if(K==="categorical"){S=Zs,C=Object.create(null);for(var ne=0,le=g.stops;ne<le.length;ne+=1){var Ie=le[ne];C[Ie[0]]=Ie[1]}L=typeof g.stops[0][0]}else{if(K!=="identity")throw new Error('Unknown function type "'+K+'"');S=qc}if($){for(var ke={},Ze=[],Ve=0;Ve<g.stops.length;Ve++){var st=g.stops[Ve],vt=st[0].zoom;ke[vt]===void 0&&(ke[vt]={zoom:vt,type:g.type,property:g.property,default:g.default,stops:[]},Ze.push(vt)),ke[vt].stops.push([st[0].value,st[1]])}for(var Tt=[],It=0,Yt=Ze;It<Yt.length;It+=1){var gr=Yt[It];Tt.push([ke[gr].zoom,f(ke[gr],w)])}var Or={name:"linear"};return{kind:"composite",interpolationType:Or,interpolationFactor:Ho.interpolationFactor.bind(void 0,Or),zoomStops:Tt.map(function(qr){return qr[0]}),evaluate:function(qr,In){var tn=qr.zoom;return bf({stops:Tt,base:g.base},w,tn).evaluate(tn,In)}}}if(W){var Cn=K==="exponential"?{name:"exponential",base:g.base!==void 0?g.base:1}:null;return{kind:"camera",interpolationType:Cn,interpolationFactor:Ho.interpolationFactor.bind(void 0,Cn),zoomStops:g.stops.map(function(qr){return qr[0]}),evaluate:function(qr){return S(g,w,qr.zoom,C,L)}}}return{kind:"source",evaluate:function(qr,In){var tn=In&&In.properties?In.properties[g.property]:void 0;return tn===void 0?Yc(g.default,w.default):S(g,w,tn,C,L)}}}(this._parameters,this._specification))};function fu(s){var l=s.key,f=s.value,g=s.valueSpec||{},w=s.objectElementValidators||{},S=s.style,C=s.styleSpec,L=[],z=pa(f);if(z!=="object")return[new Fe(l,f,"object expected, "+z+" found")];for(var $ in f){var W=$.split(".")[0],K=g[W]||g["*"],ne=void 0;if(w[W])ne=w[W];else if(g[W])ne=Tn;else if(w["*"])ne=w["*"];else{if(!g["*"]){L.push(new Fe(l,f[$],'unknown property "'+$+'"'));continue}ne=Tn}L=L.concat(ne({key:(l&&l+".")+$,value:f[$],valueSpec:K,style:S,styleSpec:C,object:f,objectKey:$},f))}for(var le in g)w[le]||g[le].required&&g[le].default===void 0&&f[le]===void 0&&L.push(new Fe(l,f,'missing required property "'+le+'"'));return L}function Qp(s){var l=s.value,f=s.valueSpec,g=s.style,w=s.styleSpec,S=s.key,C=s.arrayElementValidator||Tn;if(pa(l)!=="array")return[new Fe(S,l,"array expected, "+pa(l)+" found")];if(f.length&&l.length!==f.length)return[new Fe(S,l,"array length "+f.length+" expected, length "+l.length+" found")];if(f["min-length"]&&l.length<f["min-length"])return[new Fe(S,l,"array length at least "+f["min-length"]+" expected, length "+l.length+" found")];var L={type:f.value,values:f.values};w.$version<7&&(L.function=f.function),pa(f.value)==="object"&&(L=f.value);for(var z=[],$=0;$<l.length;$++)z=z.concat(C({array:l,arrayIndex:$,value:l[$],valueSpec:L,style:g,styleSpec:w,key:S+"["+$+"]"}));return z}function hh(s){var l=s.key,f=s.value,g=s.valueSpec,w=pa(f);return w==="number"&&f!=f&&(w="NaN"),w!=="number"?[new Fe(l,f,"number expected, "+w+" found")]:"minimum"in g&&f<g.minimum?[new Fe(l,f,f+" is less than the minimum value "+g.minimum)]:"maximum"in g&&f>g.maximum?[new Fe(l,f,f+" is greater than the maximum value "+g.maximum)]:[]}function np(s){var l,f,g,w=s.valueSpec,S=cr(s.value.type),C={},L=S!=="categorical"&&s.value.property===void 0,z=!L,$=pa(s.value.stops)==="array"&&pa(s.value.stops[0])==="array"&&pa(s.value.stops[0][0])==="object",W=fu({key:s.key,value:s.value,valueSpec:s.styleSpec.function,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{stops:function(le){if(S==="identity")return[new Fe(le.key,le.value,'identity function may not have a "stops" property')];var Ie=[],ke=le.value;return Ie=Ie.concat(Qp({key:le.key,value:ke,valueSpec:le.valueSpec,style:le.style,styleSpec:le.styleSpec,arrayElementValidator:K})),pa(ke)==="array"&&ke.length===0&&Ie.push(new Fe(le.key,ke,"array must have at least one stop")),Ie},default:function(le){return Tn({key:le.key,value:le.value,valueSpec:w,style:le.style,styleSpec:le.styleSpec})}}});return S==="identity"&&L&&W.push(new Fe(s.key,s.value,'missing required property "property"')),S==="identity"||s.value.stops||W.push(new Fe(s.key,s.value,'missing required property "stops"')),S==="exponential"&&s.valueSpec.expression&&!dc(s.valueSpec)&&W.push(new Fe(s.key,s.value,"exponential functions not supported")),s.styleSpec.$version>=8&&(z&&!Au(s.valueSpec)?W.push(new Fe(s.key,s.value,"property functions not supported")):L&&!Xc(s.valueSpec)&&W.push(new Fe(s.key,s.value,"zoom functions not supported"))),S!=="categorical"&&!$||s.value.property!==void 0||W.push(new Fe(s.key,s.value,'"property" property is required')),W;function K(le){var Ie=[],ke=le.value,Ze=le.key;if(pa(ke)!=="array")return[new Fe(Ze,ke,"array expected, "+pa(ke)+" found")];if(ke.length!==2)return[new Fe(Ze,ke,"array length 2 expected, length "+ke.length+" found")];if($){if(pa(ke[0])!=="object")return[new Fe(Ze,ke,"object expected, "+pa(ke[0])+" found")];if(ke[0].zoom===void 0)return[new Fe(Ze,ke,"object stop key must have zoom")];if(ke[0].value===void 0)return[new Fe(Ze,ke,"object stop key must have value")];if(g&&g>cr(ke[0].zoom))return[new Fe(Ze,ke[0].zoom,"stop zoom values must appear in ascending order")];cr(ke[0].zoom)!==g&&(g=cr(ke[0].zoom),f=void 0,C={}),Ie=Ie.concat(fu({key:Ze+"[0]",value:ke[0],valueSpec:{zoom:{}},style:le.style,styleSpec:le.styleSpec,objectElementValidators:{zoom:hh,value:ne}}))}else Ie=Ie.concat(ne({key:Ze+"[0]",value:ke[0],valueSpec:{},style:le.style,styleSpec:le.styleSpec},ke));return Zc(kt(ke[1]))?Ie.concat([new Fe(Ze+"[1]",ke[1],"expressions are not allowed in function stops.")]):Ie.concat(Tn({key:Ze+"[1]",value:ke[1],valueSpec:w,style:le.style,styleSpec:le.styleSpec}))}function ne(le,Ie){var ke=pa(le.value),Ze=cr(le.value),Ve=le.value!==null?le.value:Ie;if(l){if(ke!==l)return[new Fe(le.key,Ve,ke+" stop domain type must match previous stop domain type "+l)]}else l=ke;if(ke!=="number"&&ke!=="string"&&ke!=="boolean")return[new Fe(le.key,Ve,"stop domain value must be a number, string, or boolean")];if(ke!=="number"&&S!=="categorical"){var st="number expected, "+ke+" found";return Au(w)&&S===void 0&&(st+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Fe(le.key,Ve,st)]}return S!=="categorical"||ke!=="number"||isFinite(Ze)&&Math.floor(Ze)===Ze?S!=="categorical"&&ke==="number"&&f!==void 0&&Ze<f?[new Fe(le.key,Ve,"stop domain values must appear in ascending order")]:(f=Ze,S==="categorical"&&Ze in C?[new Fe(le.key,Ve,"stop domain values must be unique")]:(C[Ze]=!0,[])):[new Fe(le.key,Ve,"integer expected, found "+Ze)]}}function Ns(s){var l=(s.expressionContext==="property"?rp:wf)(kt(s.value),s.valueSpec);if(l.result==="error")return l.value.map(function(g){return new Fe(""+s.key+g.key,s.value,g.message)});var f=l.value.expression||l.value._styleExpression.expression;if(s.expressionContext==="property"&&s.propertyKey==="text-font"&&!f.outputDefined())return[new Fe(s.key,s.value,'Invalid data expression for "'+s.propertyKey+'". Output values must be contained as literals within the expression.')];if(s.expressionContext==="property"&&s.propertyType==="layout"&&!sc(f))return[new Fe(s.key,s.value,'"feature-state" data expressions are not supported with layout properties.')];if(s.expressionContext==="filter"&&!sc(f))return[new Fe(s.key,s.value,'"feature-state" data expressions are not supported with filters.')];if(s.expressionContext&&s.expressionContext.indexOf("cluster")===0){if(!Gc(f,["zoom","feature-state"]))return[new Fe(s.key,s.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(s.expressionContext==="cluster-initial"&&!oc(f))return[new Fe(s.key,s.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function jl(s){var l=s.key,f=s.value,g=s.valueSpec,w=[];return Array.isArray(g.values)?g.values.indexOf(cr(f))===-1&&w.push(new Fe(l,f,"expected one of ["+g.values.join(", ")+"], "+JSON.stringify(f)+" found")):Object.keys(g.values).indexOf(cr(f))===-1&&w.push(new Fe(l,f,"expected one of ["+Object.keys(g.values).join(", ")+"], "+JSON.stringify(f)+" found")),w}function ph(s){if(s===!0||s===!1)return!0;if(!Array.isArray(s)||s.length===0)return!1;switch(s[0]){case"has":return s.length>=2&&s[1]!=="$id"&&s[1]!=="$type";case"in":return s.length>=3&&(typeof s[1]!="string"||Array.isArray(s[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return s.length!==3||Array.isArray(s[1])||Array.isArray(s[2]);case"any":case"all":for(var l=0,f=s.slice(1);l<f.length;l+=1){var g=f[l];if(!ph(g)&&typeof g!="boolean")return!1}return!0;default:return!0}}cu.deserialize=function(s){return new cu(s._parameters,s._specification)},cu.serialize=function(s){return{_parameters:s._parameters,_specification:s._specification}};var ip={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function dh(s){if(s==null)return{filter:function(){return!0},needGeometry:!1};ph(s)||(s=Is(s));var l=wf(s,ip);if(l.result==="error")throw new Error(l.value.map(function(f){return f.key+": "+f.message}).join(", "));return{filter:function(f,g,w){return l.value.evaluate(f,g,{},w)},needGeometry:function f(g){if(!Array.isArray(g))return!1;if(g[0]==="within")return!0;for(var w=1;w<g.length;w++)if(f(g[w]))return!0;return!1}(s)}}function Qu(s,l){return s<l?-1:s>l?1:0}function Is(s){if(!s)return!0;var l,f=s[0];return s.length<=1?f!=="any":f==="=="?Ef(s[1],s[2],"=="):f==="!="?ap(Ef(s[1],s[2],"==")):f==="<"||f===">"||f==="<="||f===">="?Ef(s[1],s[2],f):f==="any"?(l=s.slice(1),["any"].concat(l.map(Is))):f==="all"?["all"].concat(s.slice(1).map(Is)):f==="none"?["all"].concat(s.slice(1).map(Is).map(ap)):f==="in"?Sf(s[1],s.slice(2)):f==="!in"?ap(Sf(s[1],s.slice(2))):f==="has"?Hd(s[1]):f==="!has"?ap(Hd(s[1])):f!=="within"||s}function Ef(s,l,f){switch(s){case"$type":return["filter-type-"+f,l];case"$id":return["filter-id-"+f,l];default:return["filter-"+f,s,l]}}function Sf(s,l){if(l.length===0)return!1;switch(s){case"$type":return["filter-type-in",["literal",l]];case"$id":return["filter-id-in",["literal",l]];default:return l.length>200&&!l.some(function(f){return typeof f!=typeof l[0]})?["filter-in-large",s,["literal",l.sort(Qu)]]:["filter-in-small",s,["literal",l]]}}function Hd(s){switch(s){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",s]}}function ap(s){return["!",s]}function Jp(s){return ph(kt(s.value))?Ns(nr({},s,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function l(f){var g=f.value,w=f.key;if(pa(g)!=="array")return[new Fe(w,g,"array expected, "+pa(g)+" found")];var S,C=f.styleSpec,L=[];if(g.length<1)return[new Fe(w,g,"filter array must have at least 1 element")];switch(L=L.concat(jl({key:w+"[0]",value:g[0],valueSpec:C.filter_operator,style:f.style,styleSpec:f.styleSpec})),cr(g[0])){case"<":case"<=":case">":case">=":g.length>=2&&cr(g[1])==="$type"&&L.push(new Fe(w,g,'"$type" cannot be use with operator "'+g[0]+'"'));case"==":case"!=":g.length!==3&&L.push(new Fe(w,g,'filter array for operator "'+g[0]+'" must have 3 elements'));case"in":case"!in":g.length>=2&&(S=pa(g[1]))!=="string"&&L.push(new Fe(w+"[1]",g[1],"string expected, "+S+" found"));for(var z=2;z<g.length;z++)S=pa(g[z]),cr(g[1])==="$type"?L=L.concat(jl({key:w+"["+z+"]",value:g[z],valueSpec:C.geometry_type,style:f.style,styleSpec:f.styleSpec})):S!=="string"&&S!=="number"&&S!=="boolean"&&L.push(new Fe(w+"["+z+"]",g[z],"string, number, or boolean expected, "+S+" found"));break;case"any":case"all":case"none":for(var $=1;$<g.length;$++)L=L.concat(l({key:w+"["+$+"]",value:g[$],style:f.style,styleSpec:f.styleSpec}));break;case"has":case"!has":S=pa(g[1]),g.length!==2?L.push(new Fe(w,g,'filter array for "'+g[0]+'" operator must have 2 elements')):S!=="string"&&L.push(new Fe(w+"[1]",g[1],"string expected, "+S+" found"));break;case"within":S=pa(g[1]),g.length!==2?L.push(new Fe(w,g,'filter array for "'+g[0]+'" operator must have 2 elements')):S!=="object"&&L.push(new Fe(w+"[1]",g[1],"object expected, "+S+" found"))}return L}(s)}function vh(s,l){var f=s.key,g=s.style,w=s.styleSpec,S=s.value,C=s.objectKey,L=w[l+"_"+s.layerType];if(!L)return[];var z=C.match(/^(.*)-transition$/);if(l==="paint"&&z&&L[z[1]]&&L[z[1]].transition)return Tn({key:f,value:S,valueSpec:w.transition,style:g,styleSpec:w});var $,W=s.valueSpec||L[C];if(!W)return[new Fe(f,S,'unknown property "'+C+'"')];if(pa(S)==="string"&&Au(W)&&!W.tokens&&($=/^{([^}]+)}$/.exec(S)))return[new Fe(f,S,'"'+C+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify($[1])+" }`.")];var K=[];return s.layerType==="symbol"&&(C==="text-field"&&g&&!g.glyphs&&K.push(new Fe(f,S,'use of "text-field" requires a style "glyphs" property')),C==="text-font"&&vc(kt(S))&&cr(S.type)==="identity"&&K.push(new Fe(f,S,'"text-font" does not support identity functions'))),K.concat(Tn({key:s.key,value:S,valueSpec:W,style:g,styleSpec:w,expressionContext:"property",propertyType:l,propertyKey:C}))}function gc(s){return vh(s,"paint")}function ft(s){return vh(s,"layout")}function Jt(s){var l=[],f=s.value,g=s.key,w=s.style,S=s.styleSpec;f.type||f.ref||l.push(new Fe(g,f,'either "type" or "ref" is required'));var C,L=cr(f.type),z=cr(f.ref);if(f.id)for(var $=cr(f.id),W=0;W<s.arrayIndex;W++){var K=w.layers[W];cr(K.id)===$&&l.push(new Fe(g,f.id,'duplicate layer id "'+f.id+'", previously used at line '+K.id.__line__))}if("ref"in f)["type","source","source-layer","filter","layout"].forEach(function(Ie){Ie in f&&l.push(new Fe(g,f[Ie],'"'+Ie+'" is prohibited for ref layers'))}),w.layers.forEach(function(Ie){cr(Ie.id)===z&&(C=Ie)}),C?C.ref?l.push(new Fe(g,f.ref,"ref cannot reference another ref layer")):L=cr(C.type):l.push(new Fe(g,f.ref,'ref layer "'+z+'" not found'));else if(L!=="background")if(f.source){var ne=w.sources&&w.sources[f.source],le=ne&&cr(ne.type);ne?le==="vector"&&L==="raster"?l.push(new Fe(g,f.source,'layer "'+f.id+'" requires a raster source')):le==="raster"&&L!=="raster"?l.push(new Fe(g,f.source,'layer "'+f.id+'" requires a vector source')):le!=="vector"||f["source-layer"]?le==="raster-dem"&&L!=="hillshade"?l.push(new Fe(g,f.source,"raster-dem source can only be used with layer type 'hillshade'.")):L!=="line"||!f.paint||!f.paint["line-gradient"]||le==="geojson"&&ne.lineMetrics||l.push(new Fe(g,f,'layer "'+f.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):l.push(new Fe(g,f,'layer "'+f.id+'" must specify a "source-layer"')):l.push(new Fe(g,f.source,'source "'+f.source+'" not found'))}else l.push(new Fe(g,f,'missing required property "source"'));return l=l.concat(fu({key:g,value:f,valueSpec:S.layer,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return Tn({key:g+".type",value:f.type,valueSpec:S.layer.type,style:s.style,styleSpec:s.styleSpec,object:f,objectKey:"type"})},filter:Jp,layout:function(Ie){return fu({layer:f,key:Ie.key,value:Ie.value,style:Ie.style,styleSpec:Ie.styleSpec,objectElementValidators:{"*":function(ke){return ft(nr({layerType:L},ke))}}})},paint:function(Ie){return fu({layer:f,key:Ie.key,value:Ie.value,style:Ie.style,styleSpec:Ie.styleSpec,objectElementValidators:{"*":function(ke){return gc(nr({layerType:L},ke))}}})}}}))}function Nt(s){var l=s.value,f=s.key,g=pa(l);return g!=="string"?[new Fe(f,l,"string expected, "+g+" found")]:[]}var jr={promoteId:function(s){var l=s.key,f=s.value;if(pa(f)==="string")return Nt({key:l,value:f});var g=[];for(var w in f)g.push.apply(g,Nt({key:l+"."+w,value:f[w]}));return g}};function si(s){var l=s.value,f=s.key,g=s.styleSpec,w=s.style;if(!l.type)return[new Fe(f,l,'"type" is required')];var S,C=cr(l.type);switch(C){case"vector":case"raster":case"raster-dem":return fu({key:f,value:l,valueSpec:g["source_"+C.replace("-","_")],style:s.style,styleSpec:g,objectElementValidators:jr});case"geojson":if(S=fu({key:f,value:l,valueSpec:g.source_geojson,style:w,styleSpec:g,objectElementValidators:jr}),l.cluster)for(var L in l.clusterProperties){var z=l.clusterProperties[L],$=z[0],W=typeof $=="string"?[$,["accumulated"],["get",L]]:$;S.push.apply(S,Ns({key:f+"."+L+".map",value:z[1],expressionContext:"cluster-map"})),S.push.apply(S,Ns({key:f+"."+L+".reduce",value:W,expressionContext:"cluster-reduce"}))}return S;case"video":return fu({key:f,value:l,valueSpec:g.source_video,style:w,styleSpec:g});case"image":return fu({key:f,value:l,valueSpec:g.source_image,style:w,styleSpec:g});case"canvas":return[new Fe(f,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return jl({key:f+".type",value:l.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:w,styleSpec:g})}}function ji(s){var l=s.value,f=s.styleSpec,g=f.light,w=s.style,S=[],C=pa(l);if(l===void 0)return S;if(C!=="object")return S.concat([new Fe("light",l,"object expected, "+C+" found")]);for(var L in l){var z=L.match(/^(.*)-transition$/);S=S.concat(z&&g[z[1]]&&g[z[1]].transition?Tn({key:L,value:l[L],valueSpec:f.transition,style:w,styleSpec:f}):g[L]?Tn({key:L,value:l[L],valueSpec:g[L],style:w,styleSpec:f}):[new Fe(L,l[L],'unknown property "'+L+'"')])}return S}var Ua={"*":function(){return[]},array:Qp,boolean:function(s){var l=s.value,f=s.key,g=pa(l);return g!=="boolean"?[new Fe(f,l,"boolean expected, "+g+" found")]:[]},number:hh,color:function(s){var l=s.key,f=s.value,g=pa(f);return g!=="string"?[new Fe(l,f,"color expected, "+g+" found")]:ti(f)===null?[new Fe(l,f,'color expected, "'+f+'" found')]:[]},constants:ht,enum:jl,filter:Jp,function:np,layer:Jt,object:fu,source:si,light:ji,string:Nt,formatted:function(s){return Nt(s).length===0?[]:Ns(s)},resolvedImage:function(s){return Nt(s).length===0?[]:Ns(s)}};function Tn(s){var l=s.value,f=s.valueSpec,g=s.styleSpec;return f.expression&&vc(cr(l))?np(s):f.expression&&Zc(kt(l))?Ns(s):f.type&&Ua[f.type]?Ua[f.type](s):fu(nr({},s,{valueSpec:f.type?g[f.type]:f}))}function ya(s){var l=s.value,f=s.key,g=Nt(s);return g.length||(l.indexOf("{fontstack}")===-1&&g.push(new Fe(f,l,'"glyphs" url must include a "{fontstack}" token')),l.indexOf("{range}")===-1&&g.push(new Fe(f,l,'"glyphs" url must include a "{range}" token'))),g}function Rs(s,l){l===void 0&&(l=de);var f=[];return f=f.concat(Tn({key:"",value:s,valueSpec:l.$root,styleSpec:l,style:s,objectElementValidators:{glyphs:ya,"*":function(){return[]}}})),s.constants&&(f=f.concat(ht({key:"constants",value:s.constants,style:s,styleSpec:l}))),Ls(f)}function Ls(s){return[].concat(s).sort(function(l,f){return l.line-f.line})}function $l(s){return function(){for(var l=[],f=arguments.length;f--;)l[f]=arguments[f];return Ls(s.apply(this,l))}}Rs.source=$l(si),Rs.light=$l(ji),Rs.layer=$l(Jt),Rs.filter=$l(Jp),Rs.paintProperty=$l(gc),Rs.layoutProperty=$l(ft);var mh=Rs,Af=mh.light,op=mh.paintProperty,yc=mh.layoutProperty;function ua(s,l){var f=!1;if(l&&l.length)for(var g=0,w=l;g<w.length;g+=1)s.fire(new Ke(new Error(w[g].message))),f=!0;return f}var El=$a;function $a(s,l,f){var g=this.cells=[];if(s instanceof ArrayBuffer){this.arrayBuffer=s;var w=new Int32Array(this.arrayBuffer);s=w[0],this.d=(l=w[1])+2*(f=w[2]);for(var S=0;S<this.d*this.d;S++){var C=w[3+S],L=w[3+S+1];g.push(C===L?null:w.subarray(C,L))}var z=w[3+g.length+1];this.keys=w.subarray(w[3+g.length],z),this.bboxes=w.subarray(z),this.insert=this._insertReadonly}else{this.d=l+2*f;for(var $=0;$<this.d*this.d;$++)g.push([]);this.keys=[],this.bboxes=[]}this.n=l,this.extent=s,this.padding=f,this.scale=l/s,this.uid=0;var W=f/l*s;this.min=-W,this.max=s+W}$a.prototype.insert=function(s,l,f,g,w){this._forEachCell(l,f,g,w,this._insertCell,this.uid++),this.keys.push(s),this.bboxes.push(l),this.bboxes.push(f),this.bboxes.push(g),this.bboxes.push(w)},$a.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},$a.prototype._insertCell=function(s,l,f,g,w,S){this.cells[w].push(S)},$a.prototype.query=function(s,l,f,g,w){var S=this.min,C=this.max;if(s<=S&&l<=S&&C<=f&&C<=g&&!w)return Array.prototype.slice.call(this.keys);var L=[];return this._forEachCell(s,l,f,g,this._queryCell,L,{},w),L},$a.prototype._queryCell=function(s,l,f,g,w,S,C,L){var z=this.cells[w];if(z!==null)for(var $=this.keys,W=this.bboxes,K=0;K<z.length;K++){var ne=z[K];if(C[ne]===void 0){var le=4*ne;(L?L(W[le+0],W[le+1],W[le+2],W[le+3]):s<=W[le+2]&&l<=W[le+3]&&f>=W[le+0]&&g>=W[le+1])?(C[ne]=!0,S.push($[ne])):C[ne]=!1}}},$a.prototype._forEachCell=function(s,l,f,g,w,S,C,L){for(var z=this._convertToCellCoord(s),$=this._convertToCellCoord(l),W=this._convertToCellCoord(f),K=this._convertToCellCoord(g),ne=z;ne<=W;ne++)for(var le=$;le<=K;le++){var Ie=this.d*le+ne;if((!L||L(this._convertFromCellCoord(ne),this._convertFromCellCoord(le),this._convertFromCellCoord(ne+1),this._convertFromCellCoord(le+1)))&&w.call(this,s,l,f,g,Ie,S,C,L))return}},$a.prototype._convertFromCellCoord=function(s){return(s-this.padding)/this.scale},$a.prototype._convertToCellCoord=function(s){return Math.max(0,Math.min(this.d-1,Math.floor(s*this.scale)+this.padding))},$a.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var s=this.cells,l=3+this.cells.length+1+1,f=0,g=0;g<this.cells.length;g++)f+=this.cells[g].length;var w=new Int32Array(l+f+this.keys.length+this.bboxes.length);w[0]=this.extent,w[1]=this.n,w[2]=this.padding;for(var S=l,C=0;C<s.length;C++){var L=s[C];w[3+C]=S,w.set(L,S),S+=L.length}return w[3+s.length]=S,w.set(this.keys,S),w[3+s.length+1]=S+=this.keys.length,w.set(this.bboxes,S),S+=this.bboxes.length,w.buffer};var _c=E.ImageData,gh=E.ImageBitmap,la={};function Jr(s,l,f){f===void 0&&(f={}),Object.defineProperty(l,"_classRegistryKey",{value:s,writeable:!1}),la[s]={klass:l,omit:f.omit||[],shallow:f.shallow||[]}}for(var rs in Jr("Object",Object),El.serialize=function(s,l){var f=s.toArrayBuffer();return l&&l.push(f),{buffer:f}},El.deserialize=function(s){return new El(s.buffer)},Jr("Grid",El),Jr("Color",vi),Jr("Error",Error),Jr("ResolvedImage",Go),Jr("StylePropertyFunction",cu),Jr("StyleExpression",bl,{omit:["_evaluator"]}),Jr("ZoomDependentExpression",mc),Jr("ZoomConstantExpression",wl),Jr("CompoundExpression",_o,{omit:["_evaluate"]}),Ul)Ul[rs]._classRegistryKey||Jr("Expression_"+rs,Ul[rs]);function Tu(s){return s&&typeof ArrayBuffer<"u"&&(s instanceof ArrayBuffer||s.constructor&&s.constructor.name==="ArrayBuffer")}function Sl(s){return gh&&s instanceof gh}function hu(s,l){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp)return s;if(Tu(s)||Sl(s))return l&&l.push(s),s;if(ArrayBuffer.isView(s)){var f=s;return l&&l.push(f.buffer),f}if(s instanceof _c)return l&&l.push(s.data.buffer),s;if(Array.isArray(s)){for(var g=[],w=0,S=s;w<S.length;w+=1)g.push(hu(S[w],l));return g}if(typeof s=="object"){var C=s.constructor,L=C._classRegistryKey;if(!L)throw new Error("can't serialize object of unregistered class");var z=C.serialize?C.serialize(s,l):{};if(!C.serialize){for(var $ in s)if(s.hasOwnProperty($)&&!(la[L].omit.indexOf($)>=0)){var W=s[$];z[$]=la[L].shallow.indexOf($)>=0?W:hu(W,l)}s instanceof Error&&(z.message=s.message)}if(z.$name)throw new Error("$name property is reserved for worker serialization logic.");return L!=="Object"&&(z.$name=L),z}throw new Error("can't serialize object of type "+typeof s)}function ns(s){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||Tu(s)||Sl(s)||ArrayBuffer.isView(s)||s instanceof _c)return s;if(Array.isArray(s))return s.map(ns);if(typeof s=="object"){var l=s.$name||"Object",f=la[l].klass;if(!f)throw new Error("can't deserialize unregistered class "+l);if(f.deserialize)return f.deserialize(s);for(var g=Object.create(f.prototype),w=0,S=Object.keys(s);w<S.length;w+=1){var C=S[w];if(C!=="$name"){var L=s[C];g[C]=la[l].shallow.indexOf(C)>=0?L:ns(L)}}return g}throw new Error("can't deserialize object of type "+typeof s)}var yh=function(){this.first=!0};yh.prototype.update=function(s,l){var f=Math.floor(s);return this.first?(this.first=!1,this.lastIntegerZoom=f,this.lastIntegerZoomTime=0,this.lastZoom=s,this.lastFloorZoom=f,!0):(this.lastFloorZoom>f?(this.lastIntegerZoom=f+1,this.lastIntegerZoomTime=l):this.lastFloorZoom<f&&(this.lastIntegerZoom=f,this.lastIntegerZoomTime=l),s!==this.lastZoom&&(this.lastZoom=s,this.lastFloorZoom=f,!0))};var Nr={"Latin-1 Supplement":function(s){return s>=128&&s<=255},Arabic:function(s){return s>=1536&&s<=1791},"Arabic Supplement":function(s){return s>=1872&&s<=1919},"Arabic Extended-A":function(s){return s>=2208&&s<=2303},"Hangul Jamo":function(s){return s>=4352&&s<=4607},"Unified Canadian Aboriginal Syllabics":function(s){return s>=5120&&s<=5759},Khmer:function(s){return s>=6016&&s<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(s){return s>=6320&&s<=6399},"General Punctuation":function(s){return s>=8192&&s<=8303},"Letterlike Symbols":function(s){return s>=8448&&s<=8527},"Number Forms":function(s){return s>=8528&&s<=8591},"Miscellaneous Technical":function(s){return s>=8960&&s<=9215},"Control Pictures":function(s){return s>=9216&&s<=9279},"Optical Character Recognition":function(s){return s>=9280&&s<=9311},"Enclosed Alphanumerics":function(s){return s>=9312&&s<=9471},"Geometric Shapes":function(s){return s>=9632&&s<=9727},"Miscellaneous Symbols":function(s){return s>=9728&&s<=9983},"Miscellaneous Symbols and Arrows":function(s){return s>=11008&&s<=11263},"CJK Radicals Supplement":function(s){return s>=11904&&s<=12031},"Kangxi Radicals":function(s){return s>=12032&&s<=12255},"Ideographic Description Characters":function(s){return s>=12272&&s<=12287},"CJK Symbols and Punctuation":function(s){return s>=12288&&s<=12351},Hiragana:function(s){return s>=12352&&s<=12447},Katakana:function(s){return s>=12448&&s<=12543},Bopomofo:function(s){return s>=12544&&s<=12591},"Hangul Compatibility Jamo":function(s){return s>=12592&&s<=12687},Kanbun:function(s){return s>=12688&&s<=12703},"Bopomofo Extended":function(s){return s>=12704&&s<=12735},"CJK Strokes":function(s){return s>=12736&&s<=12783},"Katakana Phonetic Extensions":function(s){return s>=12784&&s<=12799},"Enclosed CJK Letters and Months":function(s){return s>=12800&&s<=13055},"CJK Compatibility":function(s){return s>=13056&&s<=13311},"CJK Unified Ideographs Extension A":function(s){return s>=13312&&s<=19903},"Yijing Hexagram Symbols":function(s){return s>=19904&&s<=19967},"CJK Unified Ideographs":function(s){return s>=19968&&s<=40959},"Yi Syllables":function(s){return s>=40960&&s<=42127},"Yi Radicals":function(s){return s>=42128&&s<=42191},"Hangul Jamo Extended-A":function(s){return s>=43360&&s<=43391},"Hangul Syllables":function(s){return s>=44032&&s<=55215},"Hangul Jamo Extended-B":function(s){return s>=55216&&s<=55295},"Private Use Area":function(s){return s>=57344&&s<=63743},"CJK Compatibility Ideographs":function(s){return s>=63744&&s<=64255},"Arabic Presentation Forms-A":function(s){return s>=64336&&s<=65023},"Vertical Forms":function(s){return s>=65040&&s<=65055},"CJK Compatibility Forms":function(s){return s>=65072&&s<=65103},"Small Form Variants":function(s){return s>=65104&&s<=65135},"Arabic Presentation Forms-B":function(s){return s>=65136&&s<=65279},"Halfwidth and Fullwidth Forms":function(s){return s>=65280&&s<=65519}};function Ju(s){for(var l=0,f=s;l<f.length;l+=1)if(xo(f[l].charCodeAt(0)))return!0;return!1}function xo(s){return!(s!==746&&s!==747&&(s<4352||!(Nr["Bopomofo Extended"](s)||Nr.Bopomofo(s)||Nr["CJK Compatibility Forms"](s)&&!(s>=65097&&s<=65103)||Nr["CJK Compatibility Ideographs"](s)||Nr["CJK Compatibility"](s)||Nr["CJK Radicals Supplement"](s)||Nr["CJK Strokes"](s)||!(!Nr["CJK Symbols and Punctuation"](s)||s>=12296&&s<=12305||s>=12308&&s<=12319||s===12336)||Nr["CJK Unified Ideographs Extension A"](s)||Nr["CJK Unified Ideographs"](s)||Nr["Enclosed CJK Letters and Months"](s)||Nr["Hangul Compatibility Jamo"](s)||Nr["Hangul Jamo Extended-A"](s)||Nr["Hangul Jamo Extended-B"](s)||Nr["Hangul Jamo"](s)||Nr["Hangul Syllables"](s)||Nr.Hiragana(s)||Nr["Ideographic Description Characters"](s)||Nr.Kanbun(s)||Nr["Kangxi Radicals"](s)||Nr["Katakana Phonetic Extensions"](s)||Nr.Katakana(s)&&s!==12540||!(!Nr["Halfwidth and Fullwidth Forms"](s)||s===65288||s===65289||s===65293||s>=65306&&s<=65310||s===65339||s===65341||s===65343||s>=65371&&s<=65503||s===65507||s>=65512&&s<=65519)||!(!Nr["Small Form Variants"](s)||s>=65112&&s<=65118||s>=65123&&s<=65126)||Nr["Unified Canadian Aboriginal Syllabics"](s)||Nr["Unified Canadian Aboriginal Syllabics Extended"](s)||Nr["Vertical Forms"](s)||Nr["Yijing Hexagram Symbols"](s)||Nr["Yi Syllables"](s)||Nr["Yi Radicals"](s))))}function xc(s){return!(xo(s)||function(l){return!!(Nr["Latin-1 Supplement"](l)&&(l===167||l===169||l===174||l===177||l===188||l===189||l===190||l===215||l===247)||Nr["General Punctuation"](l)&&(l===8214||l===8224||l===8225||l===8240||l===8241||l===8251||l===8252||l===8258||l===8263||l===8264||l===8265||l===8273)||Nr["Letterlike Symbols"](l)||Nr["Number Forms"](l)||Nr["Miscellaneous Technical"](l)&&(l>=8960&&l<=8967||l>=8972&&l<=8991||l>=8996&&l<=9e3||l===9003||l>=9085&&l<=9114||l>=9150&&l<=9165||l===9167||l>=9169&&l<=9179||l>=9186&&l<=9215)||Nr["Control Pictures"](l)&&l!==9251||Nr["Optical Character Recognition"](l)||Nr["Enclosed Alphanumerics"](l)||Nr["Geometric Shapes"](l)||Nr["Miscellaneous Symbols"](l)&&!(l>=9754&&l<=9759)||Nr["Miscellaneous Symbols and Arrows"](l)&&(l>=11026&&l<=11055||l>=11088&&l<=11097||l>=11192&&l<=11243)||Nr["CJK Symbols and Punctuation"](l)||Nr.Katakana(l)||Nr["Private Use Area"](l)||Nr["CJK Compatibility Forms"](l)||Nr["Small Form Variants"](l)||Nr["Halfwidth and Fullwidth Forms"](l)||l===8734||l===8756||l===8757||l>=9984&&l<=10087||l>=10102&&l<=10131||l===65532||l===65533)}(s))}function Wo(s){return s>=1424&&s<=2303||Nr["Arabic Presentation Forms-A"](s)||Nr["Arabic Presentation Forms-B"](s)}function fo(s,l){return!(!l&&Wo(s)||s>=2304&&s<=3583||s>=3840&&s<=4255||Nr.Khmer(s))}function _h(s){for(var l=0,f=s;l<f.length;l+=1)if(Wo(f[l].charCodeAt(0)))return!0;return!1}var xh=null,Ks="unavailable",Cu=null,bh=function(s){s&&typeof s=="string"&&s.indexOf("NetworkError")>-1&&(Ks="error"),xh&&xh(s)};function Kc(){wh.fire(new Le("pluginStateChange",{pluginStatus:Ks,pluginURL:Cu}))}var wh=new nt,Eh=function(){return Ks},pu=function(){if(Ks!=="deferred"||!Cu)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Ks="loading",Kc(),Cu&&Su({url:Cu},function(s){s?bh(s):(Ks="loaded",Kc())})},Qs={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return Ks==="loaded"||Qs.applyArabicShaping!=null},isLoading:function(){return Ks==="loading"},setState:function(s){Ks=s.pluginStatus,Cu=s.pluginURL},isParsed:function(){return Qs.applyArabicShaping!=null&&Qs.processBidirectionalText!=null&&Qs.processStyledBidirectionalText!=null},getPluginURL:function(){return Cu}},Bn=function(s,l){this.zoom=s,l?(this.now=l.now,this.fadeDuration=l.fadeDuration,this.zoomHistory=l.zoomHistory,this.transition=l.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new yh,this.transition={})};Bn.prototype.isSupportedScript=function(s){return function(l,f){for(var g=0,w=l;g<w.length;g+=1)if(!fo(w[g].charCodeAt(0),f))return!1;return!0}(s,Qs.isLoaded())},Bn.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},Bn.prototype.getCrossfadeParameters=function(){var s=this.zoom,l=s-Math.floor(s),f=this.crossFadingFactor();return s>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:l+(1-l)*f}:{fromScale:.5,toScale:1,t:1-(1-f)*l}};var Ga=function(s,l){this.property=s,this.value=l,this.expression=function(f,g){if(vc(f))return new cu(f,g);if(Zc(f)){var w=rp(f,g);if(w.result==="error")throw new Error(w.value.map(function(C){return C.key+": "+C.message}).join(", "));return w.value}var S=f;return typeof f=="string"&&g.type==="color"&&(S=vi.parse(f)),{kind:"constant",evaluate:function(){return S}}}(l===void 0?s.specification.default:l,s.specification)};Ga.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},Ga.prototype.possiblyEvaluate=function(s,l,f){return this.property.possiblyEvaluate(this,s,l,f)};var du=function(s){this.property=s,this.value=new Ga(s,void 0)};du.prototype.transitioned=function(s,l){return new el(this.property,this.value,l,O({},s.transition,this.transition),s.now)},du.prototype.untransitioned=function(){return new el(this.property,this.value,null,{},0)};var is=function(s){this._properties=s,this._values=Object.create(s.defaultTransitionablePropertyValues)};is.prototype.getValue=function(s){return ie(this._values[s].value.value)},is.prototype.setValue=function(s,l){this._values.hasOwnProperty(s)||(this._values[s]=new du(this._values[s].property)),this._values[s].value=new Ga(this._values[s].property,l===null?void 0:ie(l))},is.prototype.getTransition=function(s){return ie(this._values[s].transition)},is.prototype.setTransition=function(s,l){this._values.hasOwnProperty(s)||(this._values[s]=new du(this._values[s].property)),this._values[s].transition=ie(l)||void 0},is.prototype.serialize=function(){for(var s={},l=0,f=Object.keys(this._values);l<f.length;l+=1){var g=f[l],w=this.getValue(g);w!==void 0&&(s[g]=w);var S=this.getTransition(g);S!==void 0&&(s[g+"-transition"]=S)}return s},is.prototype.transitioned=function(s,l){for(var f=new bc(this._properties),g=0,w=Object.keys(this._values);g<w.length;g+=1){var S=w[g];f._values[S]=this._values[S].transitioned(s,l._values[S])}return f},is.prototype.untransitioned=function(){for(var s=new bc(this._properties),l=0,f=Object.keys(this._values);l<f.length;l+=1){var g=f[l];s._values[g]=this._values[g].untransitioned()}return s};var el=function(s,l,f,g,w){this.property=s,this.value=l,this.begin=w+g.delay||0,this.end=this.begin+g.duration||0,s.specification.transition&&(g.delay||g.duration)&&(this.prior=f)};el.prototype.possiblyEvaluate=function(s,l,f){var g=s.now||0,w=this.value.possiblyEvaluate(s,l,f),S=this.prior;if(S){if(g>this.end)return this.prior=null,w;if(this.value.isDataDriven())return this.prior=null,w;if(g<this.begin)return S.possiblyEvaluate(s,l,f);var C=(g-this.begin)/(this.end-this.begin);return this.property.interpolate(S.possiblyEvaluate(s,l,f),w,function(L){if(L<=0)return 0;if(L>=1)return 1;var z=L*L,$=z*L;return 4*(L<.5?$:3*(L-z)+$-.75)}(C))}return w};var bc=function(s){this._properties=s,this._values=Object.create(s.defaultTransitioningPropertyValues)};bc.prototype.possiblyEvaluate=function(s,l,f){for(var g=new wc(this._properties),w=0,S=Object.keys(this._values);w<S.length;w+=1){var C=S[w];g._values[C]=this._values[C].possiblyEvaluate(s,l,f)}return g},bc.prototype.hasTransition=function(){for(var s=0,l=Object.keys(this._values);s<l.length;s+=1)if(this._values[l[s]].prior)return!0;return!1};var No=function(s){this._properties=s,this._values=Object.create(s.defaultPropertyValues)};No.prototype.getValue=function(s){return ie(this._values[s].value)},No.prototype.setValue=function(s,l){this._values[s]=new Ga(this._values[s].property,l===null?void 0:ie(l))},No.prototype.serialize=function(){for(var s={},l=0,f=Object.keys(this._values);l<f.length;l+=1){var g=f[l],w=this.getValue(g);w!==void 0&&(s[g]=w)}return s},No.prototype.possiblyEvaluate=function(s,l,f){for(var g=new wc(this._properties),w=0,S=Object.keys(this._values);w<S.length;w+=1){var C=S[w];g._values[C]=this._values[C].possiblyEvaluate(s,l,f)}return g};var ho=function(s,l,f){this.property=s,this.value=l,this.parameters=f};ho.prototype.isConstant=function(){return this.value.kind==="constant"},ho.prototype.constantOr=function(s){return this.value.kind==="constant"?this.value.value:s},ho.prototype.evaluate=function(s,l,f,g){return this.property.evaluate(this.value,this.parameters,s,l,f,g)};var wc=function(s){this._properties=s,this._values=Object.create(s.defaultPossiblyEvaluatedValues)};wc.prototype.get=function(s){return this._values[s]};var _n=function(s){this.specification=s};_n.prototype.possiblyEvaluate=function(s,l){return s.expression.evaluate(l)},_n.prototype.interpolate=function(s,l,f){var g=Hc[this.specification.type];return g?g(s,l,f):s};var on=function(s,l){this.specification=s,this.overrides=l};on.prototype.possiblyEvaluate=function(s,l,f,g){return new ho(this,s.expression.kind==="constant"||s.expression.kind==="camera"?{kind:"constant",value:s.expression.evaluate(l,null,{},f,g)}:s.expression,l)},on.prototype.interpolate=function(s,l,f){if(s.value.kind!=="constant"||l.value.kind!=="constant")return s;if(s.value.value===void 0||l.value.value===void 0)return new ho(this,{kind:"constant",value:void 0},s.parameters);var g=Hc[this.specification.type];return g?new ho(this,{kind:"constant",value:g(s.value.value,l.value.value,f)},s.parameters):s},on.prototype.evaluate=function(s,l,f,g,w,S){return s.kind==="constant"?s.value:s.evaluate(l,f,g,w,S)};var Gl=function(s){function l(){s.apply(this,arguments)}return s&&(l.__proto__=s),(l.prototype=Object.create(s&&s.prototype)).constructor=l,l.prototype.possiblyEvaluate=function(f,g,w,S){if(f.value===void 0)return new ho(this,{kind:"constant",value:void 0},g);if(f.expression.kind==="constant"){var C=f.expression.evaluate(g,null,{},w,S),L=f.property.specification.type==="resolvedImage"&&typeof C!="string"?C.name:C,z=this._calculate(L,L,L,g);return new ho(this,{kind:"constant",value:z},g)}if(f.expression.kind==="camera"){var $=this._calculate(f.expression.evaluate({zoom:g.zoom-1}),f.expression.evaluate({zoom:g.zoom}),f.expression.evaluate({zoom:g.zoom+1}),g);return new ho(this,{kind:"constant",value:$},g)}return new ho(this,f.expression,g)},l.prototype.evaluate=function(f,g,w,S,C,L){if(f.kind==="source"){var z=f.evaluate(g,w,S,C,L);return this._calculate(z,z,z,g)}return f.kind==="composite"?this._calculate(f.evaluate({zoom:Math.floor(g.zoom)-1},w,S),f.evaluate({zoom:Math.floor(g.zoom)},w,S),f.evaluate({zoom:Math.floor(g.zoom)+1},w,S),g):f.value},l.prototype._calculate=function(f,g,w,S){return S.zoom>S.zoomHistory.lastIntegerZoom?{from:f,to:g}:{from:w,to:g}},l.prototype.interpolate=function(f){return f},l}(on),Bo=function(s){this.specification=s};Bo.prototype.possiblyEvaluate=function(s,l,f,g){if(s.value!==void 0){if(s.expression.kind==="constant"){var w=s.expression.evaluate(l,null,{},f,g);return this._calculate(w,w,w,l)}return this._calculate(s.expression.evaluate(new Bn(Math.floor(l.zoom-1),l)),s.expression.evaluate(new Bn(Math.floor(l.zoom),l)),s.expression.evaluate(new Bn(Math.floor(l.zoom+1),l)),l)}},Bo.prototype._calculate=function(s,l,f,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:s,to:l}:{from:f,to:l}},Bo.prototype.interpolate=function(s){return s};var ds=function(s){this.specification=s};ds.prototype.possiblyEvaluate=function(s,l,f,g){return!!s.expression.evaluate(l,null,{},f,g)},ds.prototype.interpolate=function(){return!1};var Xo=function(s){for(var l in this.properties=s,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],s){var f=s[l];f.specification.overridable&&this.overridableProperties.push(l);var g=this.defaultPropertyValues[l]=new Ga(f,void 0),w=this.defaultTransitionablePropertyValues[l]=new du(f);this.defaultTransitioningPropertyValues[l]=w.untransitioned(),this.defaultPossiblyEvaluatedValues[l]=g.possiblyEvaluate({})}};Jr("DataDrivenProperty",on),Jr("DataConstantProperty",_n),Jr("CrossFadedDataDrivenProperty",Gl),Jr("CrossFadedProperty",Bo),Jr("ColorRampProperty",ds);var tl=function(s){function l(f,g){if(s.call(this),this.id=f.id,this.type=f.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},f.type!=="custom"&&(this.metadata=(f=f).metadata,this.minzoom=f.minzoom,this.maxzoom=f.maxzoom,f.type!=="background"&&(this.source=f.source,this.sourceLayer=f["source-layer"],this.filter=f.filter),g.layout&&(this._unevaluatedLayout=new No(g.layout)),g.paint)){for(var w in this._transitionablePaint=new is(g.paint),f.paint)this.setPaintProperty(w,f.paint[w],{validate:!1});for(var S in f.layout)this.setLayoutProperty(S,f.layout[S],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new wc(g.paint)}}return s&&(l.__proto__=s),(l.prototype=Object.create(s&&s.prototype)).constructor=l,l.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},l.prototype.getLayoutProperty=function(f){return f==="visibility"?this.visibility:this._unevaluatedLayout.getValue(f)},l.prototype.setLayoutProperty=function(f,g,w){w===void 0&&(w={}),g!=null&&this._validate(yc,"layers."+this.id+".layout."+f,f,g,w)||(f!=="visibility"?this._unevaluatedLayout.setValue(f,g):this.visibility=g)},l.prototype.getPaintProperty=function(f){return ee(f,"-transition")?this._transitionablePaint.getTransition(f.slice(0,-11)):this._transitionablePaint.getValue(f)},l.prototype.setPaintProperty=function(f,g,w){if(w===void 0&&(w={}),g!=null&&this._validate(op,"layers."+this.id+".paint."+f,f,g,w))return!1;if(ee(f,"-transition"))return this._transitionablePaint.setTransition(f.slice(0,-11),g||void 0),!1;var S=this._transitionablePaint._values[f],C=S.property.specification["property-type"]==="cross-faded-data-driven",L=S.value.isDataDriven(),z=S.value;this._transitionablePaint.setValue(f,g),this._handleSpecialPaintPropertyUpdate(f);var $=this._transitionablePaint._values[f].value;return $.isDataDriven()||L||C||this._handleOverridablePaintPropertyUpdate(f,z,$)},l.prototype._handleSpecialPaintPropertyUpdate=function(f){},l.prototype._handleOverridablePaintPropertyUpdate=function(f,g,w){return!1},l.prototype.isHidden=function(f){return!!(this.minzoom&&f<this.minzoom)||!!(this.maxzoom&&f>=this.maxzoom)||this.visibility==="none"},l.prototype.updateTransitions=function(f){this._transitioningPaint=this._transitionablePaint.transitioned(f,this._transitioningPaint)},l.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},l.prototype.recalculate=function(f,g){f.getCrossfadeParameters&&(this._crossfadeParameters=f.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(f,void 0,g)),this.paint=this._transitioningPaint.possiblyEvaluate(f,void 0,g)},l.prototype.serialize=function(){var f={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(f.layout=f.layout||{},f.layout.visibility=this.visibility),ue(f,function(g,w){return!(g===void 0||w==="layout"&&!Object.keys(g).length||w==="paint"&&!Object.keys(g).length)})},l.prototype._validate=function(f,g,w,S,C){return C===void 0&&(C={}),(!C||C.validate!==!1)&&ua(this,f.call(mh,{key:g,layerType:this.type,objectKey:w,value:S,styleSpec:de,style:{glyphs:!0,sprite:!0}}))},l.prototype.is3D=function(){return!1},l.prototype.isTileClipped=function(){return!1},l.prototype.hasOffscreenPass=function(){return!1},l.prototype.resize=function(){},l.prototype.isStateDependent=function(){for(var f in this.paint._values){var g=this.paint.get(f);if(g instanceof ho&&Au(g.property.specification)&&(g.value.kind==="source"||g.value.kind==="composite")&&g.value.isStateDependent)return!0}return!1},l}(nt),sp={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},Js=function(s,l){this._structArray=s,this._pos1=l*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},ea=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function bo(s,l){l===void 0&&(l=1);var f=0,g=0;return{members:s.map(function(w){var S=sp[w.type].BYTES_PER_ELEMENT,C=f=eu(f,Math.max(l,S)),L=w.components||1;return g=Math.max(g,S),f+=S*L,{name:w.name,type:w.type,components:L,offset:C}}),size:eu(f,Math.max(g,l)),alignment:l}}function eu(s,l){return Math.ceil(s/l)*l}ea.serialize=function(s,l){return s._trim(),l&&(s.isTransferred=!0,l.push(s.arrayBuffer)),{length:s.length,arrayBuffer:s.arrayBuffer}},ea.deserialize=function(s){var l=Object.create(this.prototype);return l.arrayBuffer=s.arrayBuffer,l.length=s.length,l.capacity=s.arrayBuffer.byteLength/l.bytesPerElement,l._refreshViews(),l},ea.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},ea.prototype.clear=function(){this.length=0},ea.prototype.resize=function(s){this.reserve(s),this.length=s},ea.prototype.reserve=function(s){if(s>this.capacity){this.capacity=Math.max(s,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var l=this.uint8;this._refreshViews(),l&&this.uint8.set(l)}},ea.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var Al=function(s){function l(){s.apply(this,arguments)}return s&&(l.__proto__=s),(l.prototype=Object.create(s&&s.prototype)).constructor=l,l.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},l.prototype.emplaceBack=function(f,g){var w=this.length;return this.resize(w+1),this.emplace(w,f,g)},l.prototype.emplace=function(f,g,w){var S=2*f;return this.int16[S+0]=g,this.int16[S+1]=w,f},l}(ea);Al.prototype.bytesPerElement=4,Jr("StructArrayLayout2i4",Al);var me=function(s){function l(){s.apply(this,arguments)}return s&&(l.__proto__=s),(l.prototype=Object.create(s&&s.prototype)).constructor=l,l.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},l.prototype.emplaceBack=function(f,g,w,S){var C=this.length;return this.resize(C+1),this.emplace(C,f,g,w,S)},l.prototype.emplace=function(f,g,w,S,C){var L=4*f;return this.int16[L+0]=g,this.int16[L+1]=w,this.int16[L+2]=S,this.int16[L+3]=C,f},l}(ea);me.prototype.bytesPerElement=8,Jr("StructArrayLayout4i8",me);var vs=function(s){function l(){s.apply(this,arguments)}return s&&(l.__proto__=s),(l.prototype=Object.create(s&&s.prototype)).constructor=l,l.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},l.prototype.emplaceBack=function(f,g,w,S,C,L){var z=this.length;return this.resize(z+1),this.emplace(z,f,g,w,S,C,L)},l.prototype.emplace=function(f,g,w,S,C,L,z){var $=6*f;return this.int16[$+0]=g,this.int16[$+1]=w,this.int16[$+2]=S,this.int16[$+3]=C,this.int16[$+4]=L,this.int16[$+5]=z,f},l}(ea);vs.prototype.bytesPerElement=12,Jr("StructArrayLayout2i4i12",vs);var as=function(s){function l(){s.apply(this,arguments)}return s&&(l.__proto__=s),(l.prototype=Object.create(s&&s.prototype)).constructor=l,l.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},l.prototype.emplaceBack=function(f,g,w,S,C,L){var z=this.length;return this.resize(z+1),this.emplace(z,f,g,w,S,C,L)},l.prototype.emplace=function(f,g,w,S,C,L,z){var $=4*f,W=8*f;return this.int16[$+0]=g,this.int16[$+1]=w,this.uint8[W+4]=S,this.uint8[W+5]=C,this.uint8[W+6]=L,this.uint8[W+7]=z,f},l}(ea);as.prototype.bytesPerElement=8,Jr("StructArrayLayout2i4ub8",as);var os=function(s){function l(){s.apply(this,arguments)}return s&&(l.__proto__=s),(l.prototype=Object.create(s&&s.prototype)).constructor=l,l.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},l.prototype.emplaceBack=function(f,g){var w=this.length;return this.resize(w+1),this.emplace(w,f,g)},l.prototype.emplace=function(f,g,w){var S=2*f;return this.float32[S+0]=g,this.float32[S+1]=w,f},l}(ea);os.prototype.bytesPerElement=8,Jr("StructArrayLayout2f8",os);var mi=function(s){function l(){s.apply(this,arguments)}return s&&(l.__proto__=s),(l.prototype=Object.create(s&&s.prototype)).constructor=l,l.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},l.prototype.emplaceBack=function(f,g,w,S,C,L,z,$,W,K){var ne=this.length;return this.resize(ne+1),this.emplace(ne,f,g,w,S,C,L,z,$,W,K)},l.prototype.emplace=function(f,g,w,S,C,L,z,$,W,K,ne){var le=10*f;return this.uint16[le+0]=g,this.uint16[le+1]=w,this.uint16[le+2]=S,this.uint16[le+3]=C,this.uint16[le+4]=L,this.uint16[le+5]=z,this.uint16[le+6]=$,this.uint16[le+7]=W,this.uint16[le+8]=K,this.uint16[le+9]=ne,f},l}(ea);mi.prototype.bytesPerElement=20,Jr("StructArrayLayout10ui20",mi);var Sh=function(s){function l(){s.apply(this,arguments)}return s&&(l.__proto__=s),(l.prototype=Object.create(s&&s.prototype)).constructor=l,l.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},l.prototype.emplaceBack=function(f,g,w,S,C,L,z,$,W,K,ne,le){var Ie=this.length;return this.resize(Ie+1),this.emplace(Ie,f,g,w,S,C,L,z,$,W,K,ne,le)},l.prototype.emplace=function(f,g,w,S,C,L,z,$,W,K,ne,le,Ie){var ke=12*f;return this.int16[ke+0]=g,this.int16[ke+1]=w,this.int16[ke+2]=S,this.int16[ke+3]=C,this.uint16[ke+4]=L,this.uint16[ke+5]=z,this.uint16[ke+6]=$,this.uint16[ke+7]=W,this.int16[ke+8]=K,this.int16[ke+9]=ne,this.int16[ke+10]=le,this.int16[ke+11]=Ie,f},l}(ea);Sh.prototype.bytesPerElement=24,Jr("StructArrayLayout4i4ui4i24",Sh);var Qc=function(s){function l(){s.apply(this,arguments)}return s&&(l.__proto__=s),(l.prototype=Object.create(s&&s.prototype)).constructor=l,l.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},l.prototype.emplaceBack=function(f,g,w){var S=this.length;return this.resize(S+1),this.emplace(S,f,g,w)},l.prototype.emplace=function(f,g,w,S){var C=3*f;return this.float32[C+0]=g,this.float32[C+1]=w,this.float32[C+2]=S,f},l}(ea);Qc.prototype.bytesPerElement=12,Jr("StructArrayLayout3f12",Qc);var Ah=function(s){function l(){s.apply(this,arguments)}return s&&(l.__proto__=s),(l.prototype=Object.create(s&&s.prototype)).constructor=l,l.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},l.prototype.emplaceBack=function(f){var g=this.length;return this.resize(g+1),this.emplace(g,f)},l.prototype.emplace=function(f,g){return this.uint32[1*f+0]=g,f},l}(ea);Ah.prototype.bytesPerElement=4,Jr("StructArrayLayout1ul4",Ah);var Hl=function(s){function l(){s.apply(this,arguments)}return s&&(l.__proto__=s),(l.prototype=Object.create(s&&s.prototype)).constructor=l,l.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},l.prototype.emplaceBack=function(f,g,w,S,C,L,z,$,W){var K=this.length;return this.resize(K+1),this.emplace(K,f,g,w,S,C,L,z,$,W)},l.prototype.emplace=function(f,g,w,S,C,L,z,$,W,K){var ne=10*f,le=5*f;return this.int16[ne+0]=g,this.int16[ne+1]=w,this.int16[ne+2]=S,this.int16[ne+3]=C,this.int16[ne+4]=L,this.int16[ne+5]=z,this.uint32[le+3]=$,this.uint16[ne+8]=W,this.uint16[ne+9]=K,f},l}(ea);Hl.prototype.bytesPerElement=20,Jr("StructArrayLayout6i1ul2ui20",Hl);var Tf=function(s){function l(){s.apply(this,arguments)}return s&&(l.__proto__=s),(l.prototype=Object.create(s&&s.prototype)).constructor=l,l.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},l.prototype.emplaceBack=function(f,g,w,S,C,L){var z=this.length;return this.resize(z+1),this.emplace(z,f,g,w,S,C,L)},l.prototype.emplace=function(f,g,w,S,C,L,z){var $=6*f;return this.int16[$+0]=g,this.int16[$+1]=w,this.int16[$+2]=S,this.int16[$+3]=C,this.int16[$+4]=L,this.int16[$+5]=z,f},l}(ea);Tf.prototype.bytesPerElement=12,Jr("StructArrayLayout2i2i2i12",Tf);var Jc=function(s){function l(){s.apply(this,arguments)}return s&&(l.__proto__=s),(l.prototype=Object.create(s&&s.prototype)).constructor=l,l.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},l.prototype.emplaceBack=function(f,g,w,S,C){var L=this.length;return this.resize(L+1),this.emplace(L,f,g,w,S,C)},l.prototype.emplace=function(f,g,w,S,C,L){var z=4*f,$=8*f;return this.float32[z+0]=g,this.float32[z+1]=w,this.float32[z+2]=S,this.int16[$+6]=C,this.int16[$+7]=L,f},l}(ea);Jc.prototype.bytesPerElement=16,Jr("StructArrayLayout2f1f2i16",Jc);var ed=function(s){function l(){s.apply(this,arguments)}return s&&(l.__proto__=s),(l.prototype=Object.create(s&&s.prototype)).constructor=l,l.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},l.prototype.emplaceBack=function(f,g,w,S){var C=this.length;return this.resize(C+1),this.emplace(C,f,g,w,S)},l.prototype.emplace=function(f,g,w,S,C){var L=12*f,z=3*f;return this.uint8[L+0]=g,this.uint8[L+1]=w,this.float32[z+1]=S,this.float32[z+2]=C,f},l}(ea);ed.prototype.bytesPerElement=12,Jr("StructArrayLayout2ub2f12",ed);var Ec=function(s){function l(){s.apply(this,arguments)}return s&&(l.__proto__=s),(l.prototype=Object.create(s&&s.prototype)).constructor=l,l.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},l.prototype.emplaceBack=function(f,g,w){var S=this.length;return this.resize(S+1),this.emplace(S,f,g,w)},l.prototype.emplace=function(f,g,w,S){var C=3*f;return this.uint16[C+0]=g,this.uint16[C+1]=w,this.uint16[C+2]=S,f},l}(ea);Ec.prototype.bytesPerElement=6,Jr("StructArrayLayout3ui6",Ec);var Sc=function(s){function l(){s.apply(this,arguments)}return s&&(l.__proto__=s),(l.prototype=Object.create(s&&s.prototype)).constructor=l,l.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},l.prototype.emplaceBack=function(f,g,w,S,C,L,z,$,W,K,ne,le,Ie,ke,Ze,Ve,st){var vt=this.length;return this.resize(vt+1),this.emplace(vt,f,g,w,S,C,L,z,$,W,K,ne,le,Ie,ke,Ze,Ve,st)},l.prototype.emplace=function(f,g,w,S,C,L,z,$,W,K,ne,le,Ie,ke,Ze,Ve,st,vt){var Tt=24*f,It=12*f,Yt=48*f;return this.int16[Tt+0]=g,this.int16[Tt+1]=w,this.uint16[Tt+2]=S,this.uint16[Tt+3]=C,this.uint32[It+2]=L,this.uint32[It+3]=z,this.uint32[It+4]=$,this.uint16[Tt+10]=W,this.uint16[Tt+11]=K,this.uint16[Tt+12]=ne,this.float32[It+7]=le,this.float32[It+8]=Ie,this.uint8[Yt+36]=ke,this.uint8[Yt+37]=Ze,this.uint8[Yt+38]=Ve,this.uint32[It+10]=st,this.int16[Tt+22]=vt,f},l}(ea);Sc.prototype.bytesPerElement=48,Jr("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Sc);var vu=function(s){function l(){s.apply(this,arguments)}return s&&(l.__proto__=s),(l.prototype=Object.create(s&&s.prototype)).constructor=l,l.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},l.prototype.emplaceBack=function(f,g,w,S,C,L,z,$,W,K,ne,le,Ie,ke,Ze,Ve,st,vt,Tt,It,Yt,gr,Or,Cn,qr,In,tn,hi){var jn=this.length;return this.resize(jn+1),this.emplace(jn,f,g,w,S,C,L,z,$,W,K,ne,le,Ie,ke,Ze,Ve,st,vt,Tt,It,Yt,gr,Or,Cn,qr,In,tn,hi)},l.prototype.emplace=function(f,g,w,S,C,L,z,$,W,K,ne,le,Ie,ke,Ze,Ve,st,vt,Tt,It,Yt,gr,Or,Cn,qr,In,tn,hi,jn){var vn=34*f,xi=17*f;return this.int16[vn+0]=g,this.int16[vn+1]=w,this.int16[vn+2]=S,this.int16[vn+3]=C,this.int16[vn+4]=L,this.int16[vn+5]=z,this.int16[vn+6]=$,this.int16[vn+7]=W,this.uint16[vn+8]=K,this.uint16[vn+9]=ne,this.uint16[vn+10]=le,this.uint16[vn+11]=Ie,this.uint16[vn+12]=ke,this.uint16[vn+13]=Ze,this.uint16[vn+14]=Ve,this.uint16[vn+15]=st,this.uint16[vn+16]=vt,this.uint16[vn+17]=Tt,this.uint16[vn+18]=It,this.uint16[vn+19]=Yt,this.uint16[vn+20]=gr,this.uint16[vn+21]=Or,this.uint16[vn+22]=Cn,this.uint32[xi+12]=qr,this.float32[xi+13]=In,this.float32[xi+14]=tn,this.float32[xi+15]=hi,this.float32[xi+16]=jn,f},l}(ea);vu.prototype.bytesPerElement=68,Jr("StructArrayLayout8i15ui1ul4f68",vu);var Wl=function(s){function l(){s.apply(this,arguments)}return s&&(l.__proto__=s),(l.prototype=Object.create(s&&s.prototype)).constructor=l,l.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},l.prototype.emplaceBack=function(f){var g=this.length;return this.resize(g+1),this.emplace(g,f)},l.prototype.emplace=function(f,g){return this.float32[1*f+0]=g,f},l}(ea);Wl.prototype.bytesPerElement=4,Jr("StructArrayLayout1f4",Wl);var Mu=function(s){function l(){s.apply(this,arguments)}return s&&(l.__proto__=s),(l.prototype=Object.create(s&&s.prototype)).constructor=l,l.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},l.prototype.emplaceBack=function(f,g,w){var S=this.length;return this.resize(S+1),this.emplace(S,f,g,w)},l.prototype.emplace=function(f,g,w,S){var C=3*f;return this.int16[C+0]=g,this.int16[C+1]=w,this.int16[C+2]=S,f},l}(ea);Mu.prototype.bytesPerElement=6,Jr("StructArrayLayout3i6",Mu);var td=function(s){function l(){s.apply(this,arguments)}return s&&(l.__proto__=s),(l.prototype=Object.create(s&&s.prototype)).constructor=l,l.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},l.prototype.emplaceBack=function(f,g,w){var S=this.length;return this.resize(S+1),this.emplace(S,f,g,w)},l.prototype.emplace=function(f,g,w,S){var C=4*f;return this.uint32[2*f+0]=g,this.uint16[C+2]=w,this.uint16[C+3]=S,f},l}(ea);td.prototype.bytesPerElement=8,Jr("StructArrayLayout1ul2ui8",td);var ef=function(s){function l(){s.apply(this,arguments)}return s&&(l.__proto__=s),(l.prototype=Object.create(s&&s.prototype)).constructor=l,l.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},l.prototype.emplaceBack=function(f,g){var w=this.length;return this.resize(w+1),this.emplace(w,f,g)},l.prototype.emplace=function(f,g,w){var S=2*f;return this.uint16[S+0]=g,this.uint16[S+1]=w,f},l}(ea);ef.prototype.bytesPerElement=4,Jr("StructArrayLayout2ui4",ef);var Cf=function(s){function l(){s.apply(this,arguments)}return s&&(l.__proto__=s),(l.prototype=Object.create(s&&s.prototype)).constructor=l,l.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},l.prototype.emplaceBack=function(f){var g=this.length;return this.resize(g+1),this.emplace(g,f)},l.prototype.emplace=function(f,g){return this.uint16[1*f+0]=g,f},l}(ea);Cf.prototype.bytesPerElement=2,Jr("StructArrayLayout1ui2",Cf);var Pu=function(s){function l(){s.apply(this,arguments)}return s&&(l.__proto__=s),(l.prototype=Object.create(s&&s.prototype)).constructor=l,l.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},l.prototype.emplaceBack=function(f,g,w,S){var C=this.length;return this.resize(C+1),this.emplace(C,f,g,w,S)},l.prototype.emplace=function(f,g,w,S,C){var L=4*f;return this.float32[L+0]=g,this.float32[L+1]=w,this.float32[L+2]=S,this.float32[L+3]=C,f},l}(ea);Pu.prototype.bytesPerElement=16,Jr("StructArrayLayout4f16",Pu);var p=function(s){function l(){s.apply(this,arguments)}s&&(l.__proto__=s),(l.prototype=Object.create(s&&s.prototype)).constructor=l;var f={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return f.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},f.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},f.x1.get=function(){return this._structArray.int16[this._pos2+2]},f.y1.get=function(){return this._structArray.int16[this._pos2+3]},f.x2.get=function(){return this._structArray.int16[this._pos2+4]},f.y2.get=function(){return this._structArray.int16[this._pos2+5]},f.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},f.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},f.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},f.anchorPoint.get=function(){return new y(this.anchorPointX,this.anchorPointY)},Object.defineProperties(l.prototype,f),l}(Js);p.prototype.size=20;var v=function(s){function l(){s.apply(this,arguments)}return s&&(l.__proto__=s),(l.prototype=Object.create(s&&s.prototype)).constructor=l,l.prototype.get=function(f){return new p(this,f)},l}(Hl);Jr("CollisionBoxArray",v);var d=function(s){function l(){s.apply(this,arguments)}s&&(l.__proto__=s),(l.prototype=Object.create(s&&s.prototype)).constructor=l;var f={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return f.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},f.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},f.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},f.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},f.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},f.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},f.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},f.segment.get=function(){return this._structArray.uint16[this._pos2+10]},f.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},f.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},f.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},f.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},f.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},f.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},f.placedOrientation.set=function(g){this._structArray.uint8[this._pos1+37]=g},f.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},f.hidden.set=function(g){this._structArray.uint8[this._pos1+38]=g},f.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},f.crossTileID.set=function(g){this._structArray.uint32[this._pos4+10]=g},f.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(l.prototype,f),l}(Js);d.prototype.size=48;var _=function(s){function l(){s.apply(this,arguments)}return s&&(l.__proto__=s),(l.prototype=Object.create(s&&s.prototype)).constructor=l,l.prototype.get=function(f){return new d(this,f)},l}(Sc);Jr("PlacedSymbolArray",_);var A=function(s){function l(){s.apply(this,arguments)}s&&(l.__proto__=s),(l.prototype=Object.create(s&&s.prototype)).constructor=l;var f={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return f.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},f.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},f.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},f.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},f.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},f.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},f.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},f.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},f.key.get=function(){return this._structArray.uint16[this._pos2+8]},f.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},f.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},f.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},f.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},f.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},f.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},f.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},f.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},f.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},f.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},f.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},f.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},f.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},f.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},f.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},f.crossTileID.set=function(g){this._structArray.uint32[this._pos4+12]=g},f.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},f.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},f.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},f.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(l.prototype,f),l}(Js);A.prototype.size=68;var M=function(s){function l(){s.apply(this,arguments)}return s&&(l.__proto__=s),(l.prototype=Object.create(s&&s.prototype)).constructor=l,l.prototype.get=function(f){return new A(this,f)},l}(vu);Jr("SymbolInstanceArray",M);var R=function(s){function l(){s.apply(this,arguments)}return s&&(l.__proto__=s),(l.prototype=Object.create(s&&s.prototype)).constructor=l,l.prototype.getoffsetX=function(f){return this.float32[1*f+0]},l}(Wl);Jr("GlyphOffsetArray",R);var B=function(s){function l(){s.apply(this,arguments)}return s&&(l.__proto__=s),(l.prototype=Object.create(s&&s.prototype)).constructor=l,l.prototype.getx=function(f){return this.int16[3*f+0]},l.prototype.gety=function(f){return this.int16[3*f+1]},l.prototype.gettileUnitDistanceFromAnchor=function(f){return this.int16[3*f+2]},l}(Mu);Jr("SymbolLineVertexArray",B);var G=function(s){function l(){s.apply(this,arguments)}s&&(l.__proto__=s),(l.prototype=Object.create(s&&s.prototype)).constructor=l;var f={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return f.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},f.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},f.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(l.prototype,f),l}(Js);G.prototype.size=8;var J=function(s){function l(){s.apply(this,arguments)}return s&&(l.__proto__=s),(l.prototype=Object.create(s&&s.prototype)).constructor=l,l.prototype.get=function(f){return new G(this,f)},l}(td);Jr("FeatureIndexArray",J);var ce=bo([{name:"a_pos",components:2,type:"Int16"}],4).members,ve=function(s){s===void 0&&(s=[]),this.segments=s};function ye(s,l){return 256*(s=D(Math.floor(s),0,255))+D(Math.floor(l),0,255)}ve.prototype.prepareSegment=function(s,l,f,g){var w=this.segments[this.segments.length-1];return s>ve.MAX_VERTEX_ARRAY_LENGTH&&Se("Max vertices per segment is "+ve.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+s),(!w||w.vertexLength+s>ve.MAX_VERTEX_ARRAY_LENGTH||w.sortKey!==g)&&(w={vertexOffset:l.length,primitiveOffset:f.length,vertexLength:0,primitiveLength:0},g!==void 0&&(w.sortKey=g),this.segments.push(w)),w},ve.prototype.get=function(){return this.segments},ve.prototype.destroy=function(){for(var s=0,l=this.segments;s<l.length;s+=1){var f=l[s];for(var g in f.vaos)f.vaos[g].destroy()}},ve.simpleSegment=function(s,l,f,g){return new ve([{vertexOffset:s,primitiveOffset:l,vertexLength:f,primitiveLength:g,vaos:{},sortKey:0}])},ve.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Jr("SegmentVector",ve);var Oe=bo([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Re=u(function(s){s.exports=function(l,f){var g,w,S,C,L,z,$,W;for(w=l.length-(g=3&l.length),S=f,L=3432918353,z=461845907,W=0;W<w;)$=255&l.charCodeAt(W)|(255&l.charCodeAt(++W))<<8|(255&l.charCodeAt(++W))<<16|(255&l.charCodeAt(++W))<<24,++W,S=27492+(65535&(C=5*(65535&(S=(S^=$=(65535&($=($=(65535&$)*L+((($>>>16)*L&65535)<<16)&4294967295)<<15|$>>>17))*z+((($>>>16)*z&65535)<<16)&4294967295)<<13|S>>>19))+((5*(S>>>16)&65535)<<16)&4294967295))+((58964+(C>>>16)&65535)<<16);switch($=0,g){case 3:$^=(255&l.charCodeAt(W+2))<<16;case 2:$^=(255&l.charCodeAt(W+1))<<8;case 1:S^=$=(65535&($=($=(65535&($^=255&l.charCodeAt(W)))*L+((($>>>16)*L&65535)<<16)&4294967295)<<15|$>>>17))*z+((($>>>16)*z&65535)<<16)&4294967295}return S^=l.length,S=2246822507*(65535&(S^=S>>>16))+((2246822507*(S>>>16)&65535)<<16)&4294967295,S=3266489909*(65535&(S^=S>>>13))+((3266489909*(S>>>16)&65535)<<16)&4294967295,(S^=S>>>16)>>>0}}),Ge=u(function(s){s.exports=function(l,f){for(var g,w=l.length,S=f^w,C=0;w>=4;)g=1540483477*(65535&(g=255&l.charCodeAt(C)|(255&l.charCodeAt(++C))<<8|(255&l.charCodeAt(++C))<<16|(255&l.charCodeAt(++C))<<24))+((1540483477*(g>>>16)&65535)<<16),S=1540483477*(65535&S)+((1540483477*(S>>>16)&65535)<<16)^(g=1540483477*(65535&(g^=g>>>24))+((1540483477*(g>>>16)&65535)<<16)),w-=4,++C;switch(w){case 3:S^=(255&l.charCodeAt(C+2))<<16;case 2:S^=(255&l.charCodeAt(C+1))<<8;case 1:S=1540483477*(65535&(S^=255&l.charCodeAt(C)))+((1540483477*(S>>>16)&65535)<<16)}return S=1540483477*(65535&(S^=S>>>13))+((1540483477*(S>>>16)&65535)<<16),(S^=S>>>15)>>>0}}),Me=Re,He=Ge;Me.murmur3=Re,Me.murmur2=He;var et=function(){this.ids=[],this.positions=[],this.indexed=!1};et.prototype.add=function(s,l,f,g){this.ids.push(Pt(s)),this.positions.push(l,f,g)},et.prototype.getPositions=function(s){for(var l=Pt(s),f=0,g=this.ids.length-1;f<g;){var w=f+g>>1;this.ids[w]>=l?g=w:f=w+1}for(var S=[];this.ids[f]===l;)S.push({index:this.positions[3*f],start:this.positions[3*f+1],end:this.positions[3*f+2]}),f++;return S},et.serialize=function(s,l){var f=new Float64Array(s.ids),g=new Uint32Array(s.positions);return function w(S,C,L,z){for(;L<z;){for(var $=S[L+z>>1],W=L-1,K=z+1;;){do W++;while(S[W]<$);do K--;while(S[K]>$);if(W>=K)break;At(S,W,K),At(C,3*W,3*K),At(C,3*W+1,3*K+1),At(C,3*W+2,3*K+2)}K-L<z-K?(w(S,C,L,K),L=K+1):(w(S,C,K+1,z),z=K)}}(f,g,0,f.length-1),l&&l.push(f.buffer,g.buffer),{ids:f,positions:g}},et.deserialize=function(s){var l=new et;return l.ids=s.ids,l.positions=s.positions,l.indexed=!0,l};var ct=Math.pow(2,53)-1;function Pt(s){var l=+s;return!isNaN(l)&&l<=ct?l:Me(String(s))}function At(s,l,f){var g=s[l];s[l]=s[f],s[f]=g}Jr("FeaturePositionMap",et);var Ot=function(s,l){this.gl=s.gl,this.location=l},tr=function(s){function l(f,g){s.call(this,f,g),this.current=0}return s&&(l.__proto__=s),(l.prototype=Object.create(s&&s.prototype)).constructor=l,l.prototype.set=function(f){this.current!==f&&(this.current=f,this.gl.uniform1i(this.location,f))},l}(Ot),sr=function(s){function l(f,g){s.call(this,f,g),this.current=0}return s&&(l.__proto__=s),(l.prototype=Object.create(s&&s.prototype)).constructor=l,l.prototype.set=function(f){this.current!==f&&(this.current=f,this.gl.uniform1f(this.location,f))},l}(Ot),_r=function(s){function l(f,g){s.call(this,f,g),this.current=[0,0]}return s&&(l.__proto__=s),(l.prototype=Object.create(s&&s.prototype)).constructor=l,l.prototype.set=function(f){f[0]===this.current[0]&&f[1]===this.current[1]||(this.current=f,this.gl.uniform2f(this.location,f[0],f[1]))},l}(Ot),Ur=function(s){function l(f,g){s.call(this,f,g),this.current=[0,0,0]}return s&&(l.__proto__=s),(l.prototype=Object.create(s&&s.prototype)).constructor=l,l.prototype.set=function(f){f[0]===this.current[0]&&f[1]===this.current[1]&&f[2]===this.current[2]||(this.current=f,this.gl.uniform3f(this.location,f[0],f[1],f[2]))},l}(Ot),hn=function(s){function l(f,g){s.call(this,f,g),this.current=[0,0,0,0]}return s&&(l.__proto__=s),(l.prototype=Object.create(s&&s.prototype)).constructor=l,l.prototype.set=function(f){f[0]===this.current[0]&&f[1]===this.current[1]&&f[2]===this.current[2]&&f[3]===this.current[3]||(this.current=f,this.gl.uniform4f(this.location,f[0],f[1],f[2],f[3]))},l}(Ot),An=function(s){function l(f,g){s.call(this,f,g),this.current=vi.transparent}return s&&(l.__proto__=s),(l.prototype=Object.create(s&&s.prototype)).constructor=l,l.prototype.set=function(f){f.r===this.current.r&&f.g===this.current.g&&f.b===this.current.b&&f.a===this.current.a||(this.current=f,this.gl.uniform4f(this.location,f.r,f.g,f.b,f.a))},l}(Ot),bn=new Float32Array(16),Fi=function(s){function l(f,g){s.call(this,f,g),this.current=bn}return s&&(l.__proto__=s),(l.prototype=Object.create(s&&s.prototype)).constructor=l,l.prototype.set=function(f){if(f[12]!==this.current[12]||f[0]!==this.current[0])return this.current=f,void this.gl.uniformMatrix4fv(this.location,!1,f);for(var g=1;g<16;g++)if(f[g]!==this.current[g]){this.current=f,this.gl.uniformMatrix4fv(this.location,!1,f);break}},l}(Ot);function $r(s){return[ye(255*s.r,255*s.g),ye(255*s.b,255*s.a)]}var Ln=function(s,l,f){this.value=s,this.uniformNames=l.map(function(g){return"u_"+g}),this.type=f};Ln.prototype.setUniform=function(s,l,f){s.set(f.constantOr(this.value))},Ln.prototype.getBinding=function(s,l,f){return this.type==="color"?new An(s,l):new sr(s,l)};var Yn=function(s,l){this.uniformNames=l.map(function(f){return"u_"+f}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};Yn.prototype.setConstantPatternPositions=function(s,l){this.pixelRatioFrom=l.pixelRatio,this.pixelRatioTo=s.pixelRatio,this.patternFrom=l.tlbr,this.patternTo=s.tlbr},Yn.prototype.setUniform=function(s,l,f,g){var w=g==="u_pattern_to"?this.patternTo:g==="u_pattern_from"?this.patternFrom:g==="u_pixel_ratio_to"?this.pixelRatioTo:g==="u_pixel_ratio_from"?this.pixelRatioFrom:null;w&&s.set(w)},Yn.prototype.getBinding=function(s,l,f){return f.substr(0,9)==="u_pattern"?new hn(s,l):new sr(s,l)};var $n=function(s,l,f,g){this.expression=s,this.type=f,this.maxValue=0,this.paintVertexAttributes=l.map(function(w){return{name:"a_"+w,type:"Float32",components:f==="color"?2:1,offset:0}}),this.paintVertexArray=new g};$n.prototype.populatePaintArray=function(s,l,f,g,w){var S=this.paintVertexArray.length,C=this.expression.evaluate(new Bn(0),l,{},g,[],w);this.paintVertexArray.resize(s),this._setPaintValue(S,s,C)},$n.prototype.updatePaintArray=function(s,l,f,g){var w=this.expression.evaluate({zoom:0},f,g);this._setPaintValue(s,l,w)},$n.prototype._setPaintValue=function(s,l,f){if(this.type==="color")for(var g=$r(f),w=s;w<l;w++)this.paintVertexArray.emplace(w,g[0],g[1]);else{for(var S=s;S<l;S++)this.paintVertexArray.emplace(S,f);this.maxValue=Math.max(this.maxValue,Math.abs(f))}},$n.prototype.upload=function(s){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=s.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},$n.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var Fn=function(s,l,f,g,w,S){this.expression=s,this.uniformNames=l.map(function(C){return"u_"+C+"_t"}),this.type=f,this.useIntegerZoom=g,this.zoom=w,this.maxValue=0,this.paintVertexAttributes=l.map(function(C){return{name:"a_"+C,type:"Float32",components:f==="color"?4:2,offset:0}}),this.paintVertexArray=new S};Fn.prototype.populatePaintArray=function(s,l,f,g,w){var S=this.expression.evaluate(new Bn(this.zoom),l,{},g,[],w),C=this.expression.evaluate(new Bn(this.zoom+1),l,{},g,[],w),L=this.paintVertexArray.length;this.paintVertexArray.resize(s),this._setPaintValue(L,s,S,C)},Fn.prototype.updatePaintArray=function(s,l,f,g){var w=this.expression.evaluate({zoom:this.zoom},f,g),S=this.expression.evaluate({zoom:this.zoom+1},f,g);this._setPaintValue(s,l,w,S)},Fn.prototype._setPaintValue=function(s,l,f,g){if(this.type==="color")for(var w=$r(f),S=$r(g),C=s;C<l;C++)this.paintVertexArray.emplace(C,w[0],w[1],S[0],S[1]);else{for(var L=s;L<l;L++)this.paintVertexArray.emplace(L,f,g);this.maxValue=Math.max(this.maxValue,Math.abs(f),Math.abs(g))}},Fn.prototype.upload=function(s){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=s.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Fn.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},Fn.prototype.setUniform=function(s,l){var f=this.useIntegerZoom?Math.floor(l.zoom):l.zoom,g=D(this.expression.interpolationFactor(f,this.zoom,this.zoom+1),0,1);s.set(g)},Fn.prototype.getBinding=function(s,l,f){return new sr(s,l)};var ri=function(s,l,f,g,w,S){this.expression=s,this.type=l,this.useIntegerZoom=f,this.zoom=g,this.layerId=S,this.zoomInPaintVertexArray=new w,this.zoomOutPaintVertexArray=new w};ri.prototype.populatePaintArray=function(s,l,f){var g=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(s),this.zoomOutPaintVertexArray.resize(s),this._setPaintValues(g,s,l.patterns&&l.patterns[this.layerId],f)},ri.prototype.updatePaintArray=function(s,l,f,g,w){this._setPaintValues(s,l,f.patterns&&f.patterns[this.layerId],w)},ri.prototype._setPaintValues=function(s,l,f,g){if(g&&f){var w=g[f.min],S=g[f.mid],C=g[f.max];if(w&&S&&C)for(var L=s;L<l;L++)this.zoomInPaintVertexArray.emplace(L,S.tl[0],S.tl[1],S.br[0],S.br[1],w.tl[0],w.tl[1],w.br[0],w.br[1],S.pixelRatio,w.pixelRatio),this.zoomOutPaintVertexArray.emplace(L,S.tl[0],S.tl[1],S.br[0],S.br[1],C.tl[0],C.tl[1],C.br[0],C.br[1],S.pixelRatio,C.pixelRatio)}},ri.prototype.upload=function(s){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=s.createVertexBuffer(this.zoomInPaintVertexArray,Oe.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=s.createVertexBuffer(this.zoomOutPaintVertexArray,Oe.members,this.expression.isStateDependent))},ri.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var zn=function(s,l,f){this.binders={},this._buffers=[];var g=[];for(var w in s.paint._values)if(f(w)){var S=s.paint.get(w);if(S instanceof ho&&Au(S.property.specification)){var C=Ja(w,s.type),L=S.value,z=S.property.specification.type,$=S.property.useIntegerZoom,W=S.property.specification["property-type"],K=W==="cross-faded"||W==="cross-faded-data-driven";if(L.kind==="constant")this.binders[w]=K?new Yn(L.value,C):new Ln(L.value,C,z),g.push("/u_"+w);else if(L.kind==="source"||K){var ne=Ha(w,z,"source");this.binders[w]=K?new ri(L,z,$,l,ne,s.id):new $n(L,C,z,ne),g.push("/a_"+w)}else{var le=Ha(w,z,"composite");this.binders[w]=new Fn(L,C,z,$,l,le),g.push("/z_"+w)}}}this.cacheKey=g.sort().join("")};zn.prototype.getMaxValue=function(s){var l=this.binders[s];return l instanceof $n||l instanceof Fn?l.maxValue:0},zn.prototype.populatePaintArrays=function(s,l,f,g,w){for(var S in this.binders){var C=this.binders[S];(C instanceof $n||C instanceof Fn||C instanceof ri)&&C.populatePaintArray(s,l,f,g,w)}},zn.prototype.setConstantPatternPositions=function(s,l){for(var f in this.binders){var g=this.binders[f];g instanceof Yn&&g.setConstantPatternPositions(s,l)}},zn.prototype.updatePaintArrays=function(s,l,f,g,w){var S=!1;for(var C in s)for(var L=0,z=l.getPositions(C);L<z.length;L+=1){var $=z[L],W=f.feature($.index);for(var K in this.binders){var ne=this.binders[K];if((ne instanceof $n||ne instanceof Fn||ne instanceof ri)&&ne.expression.isStateDependent===!0){var le=g.paint.get(K);ne.expression=le.value,ne.updatePaintArray($.start,$.end,W,s[C],w),S=!0}}}return S},zn.prototype.defines=function(){var s=[];for(var l in this.binders){var f=this.binders[l];(f instanceof Ln||f instanceof Yn)&&s.push.apply(s,f.uniformNames.map(function(g){return"#define HAS_UNIFORM_"+g}))}return s},zn.prototype.getBinderAttributes=function(){var s=[];for(var l in this.binders){var f=this.binders[l];if(f instanceof $n||f instanceof Fn)for(var g=0;g<f.paintVertexAttributes.length;g++)s.push(f.paintVertexAttributes[g].name);else if(f instanceof ri)for(var w=0;w<Oe.members.length;w++)s.push(Oe.members[w].name)}return s},zn.prototype.getBinderUniforms=function(){var s=[];for(var l in this.binders){var f=this.binders[l];if(f instanceof Ln||f instanceof Yn||f instanceof Fn)for(var g=0,w=f.uniformNames;g<w.length;g+=1)s.push(w[g])}return s},zn.prototype.getPaintVertexBuffers=function(){return this._buffers},zn.prototype.getUniforms=function(s,l){var f=[];for(var g in this.binders){var w=this.binders[g];if(w instanceof Ln||w instanceof Yn||w instanceof Fn)for(var S=0,C=w.uniformNames;S<C.length;S+=1){var L=C[S];if(l[L]){var z=w.getBinding(s,l[L],L);f.push({name:L,property:g,binding:z})}}}return f},zn.prototype.setUniforms=function(s,l,f,g){for(var w=0,S=l;w<S.length;w+=1){var C=S[w],L=C.name,z=C.property;this.binders[z].setUniform(C.binding,g,f.get(z),L)}},zn.prototype.updatePaintBuffers=function(s){for(var l in this._buffers=[],this.binders){var f=this.binders[l];if(s&&f instanceof ri){var g=s.fromScale===2?f.zoomInPaintVertexBuffer:f.zoomOutPaintVertexBuffer;g&&this._buffers.push(g)}else(f instanceof $n||f instanceof Fn)&&f.paintVertexBuffer&&this._buffers.push(f.paintVertexBuffer)}},zn.prototype.upload=function(s){for(var l in this.binders){var f=this.binders[l];(f instanceof $n||f instanceof Fn||f instanceof ri)&&f.upload(s)}this.updatePaintBuffers()},zn.prototype.destroy=function(){for(var s in this.binders){var l=this.binders[s];(l instanceof $n||l instanceof Fn||l instanceof ri)&&l.destroy()}};var pn=function(s,l,f){f===void 0&&(f=function(){return!0}),this.programConfigurations={};for(var g=0,w=s;g<w.length;g+=1){var S=w[g];this.programConfigurations[S.id]=new zn(S,l,f)}this.needsUpload=!1,this._featureMap=new et,this._bufferOffset=0};function Ja(s,l){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[s]||[s.replace(l+"-","").replace(/-/g,"_")]}function Ha(s,l,f){var g={color:{source:os,composite:Pu},number:{source:Wl,composite:os}},w=function(S){return{"line-pattern":{source:mi,composite:mi},"fill-pattern":{source:mi,composite:mi},"fill-extrusion-pattern":{source:mi,composite:mi}}[S]}(s);return w&&w[f]||g[l][f]}pn.prototype.populatePaintArrays=function(s,l,f,g,w,S){for(var C in this.programConfigurations)this.programConfigurations[C].populatePaintArrays(s,l,g,w,S);l.id!==void 0&&this._featureMap.add(l.id,f,this._bufferOffset,s),this._bufferOffset=s,this.needsUpload=!0},pn.prototype.updatePaintArrays=function(s,l,f,g){for(var w=0,S=f;w<S.length;w+=1){var C=S[w];this.needsUpload=this.programConfigurations[C.id].updatePaintArrays(s,this._featureMap,l,C,g)||this.needsUpload}},pn.prototype.get=function(s){return this.programConfigurations[s]},pn.prototype.upload=function(s){if(this.needsUpload){for(var l in this.programConfigurations)this.programConfigurations[l].upload(s);this.needsUpload=!1}},pn.prototype.destroy=function(){for(var s in this.programConfigurations)this.programConfigurations[s].destroy()},Jr("ConstantBinder",Ln),Jr("CrossFadedConstantBinder",Yn),Jr("SourceExpressionBinder",$n),Jr("CrossFadedCompositeBinder",ri),Jr("CompositeExpressionBinder",Fn),Jr("ProgramConfiguration",zn,{omit:["_buffers"]}),Jr("ProgramConfigurationSet",pn);var Va=Math.pow(2,14)-1,wo=-Va-1;function Ia(s){for(var l=8192/s.extent,f=s.loadGeometry(),g=0;g<f.length;g++)for(var w=f[g],S=0;S<w.length;S++){var C=w[S],L=Math.round(C.x*l),z=Math.round(C.y*l);C.x=D(L,wo,Va),C.y=D(z,wo,Va),(L<C.x||L>C.x+1||z<C.y||z>C.y+1)&&Se("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return f}function Ea(s,l){return{type:s.type,id:s.id,properties:s.properties,geometry:l?Ia(s):[]}}function ms(s,l,f,g,w){s.emplaceBack(2*l+(g+1)/2,2*f+(w+1)/2)}var da=function(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(function(l){return l.id}),this.index=s.index,this.hasPattern=!1,this.layoutVertexArray=new Al,this.indexArray=new Ec,this.segments=new ve,this.programConfigurations=new pn(s.layers,s.zoom),this.stateDependentLayerIds=this.layers.filter(function(l){return l.isStateDependent()}).map(function(l){return l.id})};function rl(s,l){for(var f=0;f<s.length;f++)if(nl(l,s[f]))return!0;for(var g=0;g<l.length;g++)if(nl(s,l[g]))return!0;return!!Xl(s,l)}function ks(s,l,f){return!!nl(s,l)||!!gu(l,s,f)}function Iu(s,l){if(s.length===1)return rf(l,s[0]);for(var f=0;f<l.length;f++)for(var g=l[f],w=0;w<g.length;w++)if(nl(s,g[w]))return!0;for(var S=0;S<s.length;S++)if(rf(l,s[S]))return!0;for(var C=0;C<l.length;C++)if(Xl(s,l[C]))return!0;return!1}function mu(s,l,f){if(s.length>1){if(Xl(s,l))return!0;for(var g=0;g<l.length;g++)if(gu(l[g],s,f))return!0}for(var w=0;w<s.length;w++)if(gu(s[w],l,f))return!0;return!1}function Xl(s,l){if(s.length===0||l.length===0)return!1;for(var f=0;f<s.length-1;f++)for(var g=s[f],w=s[f+1],S=0;S<l.length-1;S++)if(tf(g,w,l[S],l[S+1]))return!0;return!1}function tf(s,l,f,g){return Ne(s,f,g)!==Ne(l,f,g)&&Ne(s,l,f)!==Ne(s,l,g)}function gu(s,l,f){var g=f*f;if(l.length===1)return s.distSqr(l[0])<g;for(var w=1;w<l.length;w++)if(Yl(s,l[w-1],l[w])<g)return!0;return!1}function Yl(s,l,f){var g=l.distSqr(f);if(g===0)return s.distSqr(l);var w=((s.x-l.x)*(f.x-l.x)+(s.y-l.y)*(f.y-l.y))/g;return s.distSqr(w<0?l:w>1?f:f.sub(l)._mult(w)._add(l))}function rf(s,l){for(var f,g,w,S=!1,C=0;C<s.length;C++)for(var L=0,z=(f=s[C]).length-1;L<f.length;z=L++)(g=f[L]).y>l.y!=(w=f[z]).y>l.y&&l.x<(w.x-g.x)*(l.y-g.y)/(w.y-g.y)+g.x&&(S=!S);return S}function nl(s,l){for(var f=!1,g=0,w=s.length-1;g<s.length;w=g++){var S=s[g],C=s[w];S.y>l.y!=C.y>l.y&&l.x<(C.x-S.x)*(l.y-S.y)/(C.y-S.y)+S.x&&(f=!f)}return f}function il(s,l,f){var g=f[0],w=f[2];if(s.x<g.x&&l.x<g.x||s.x>w.x&&l.x>w.x||s.y<g.y&&l.y<g.y||s.y>w.y&&l.y>w.y)return!1;var S=Ne(s,l,f[0]);return S!==Ne(s,l,f[1])||S!==Ne(s,l,f[2])||S!==Ne(s,l,f[3])}function al(s,l,f){var g=l.paint.get(s).value;return g.kind==="constant"?g.value:f.programConfigurations.get(l.id).getMaxValue(s)}function Ro(s){return Math.sqrt(s[0]*s[0]+s[1]*s[1])}function yu(s,l,f,g,w){if(!l[0]&&!l[1])return s;var S=y.convert(l)._mult(w);f==="viewport"&&S._rotate(-g);for(var C=[],L=0;L<s.length;L++)C.push(s[L].sub(S));return C}da.prototype.populate=function(s,l,f){var g=this.layers[0],w=[],S=null;g.type==="circle"&&(S=g.layout.get("circle-sort-key"));for(var C=0,L=s;C<L.length;C+=1){var z=L[C],$=z.feature,W=z.id,K=z.index,ne=z.sourceLayerIndex,le=this.layers[0]._featureFilter.needGeometry,Ie=Ea($,le);if(this.layers[0]._featureFilter.filter(new Bn(this.zoom),Ie,f)){var ke=S?S.evaluate(Ie,{},f):void 0,Ze={id:W,properties:$.properties,type:$.type,sourceLayerIndex:ne,index:K,geometry:le?Ie.geometry:Ia($),patterns:{},sortKey:ke};w.push(Ze)}}S&&w.sort(function(Or,Cn){return Or.sortKey-Cn.sortKey});for(var Ve=0,st=w;Ve<st.length;Ve+=1){var vt=st[Ve],Tt=vt.geometry,It=vt.index,Yt=vt.sourceLayerIndex,gr=s[It].feature;this.addFeature(vt,Tt,It,f),l.featureIndex.insert(gr,Tt,It,Yt,this.index)}},da.prototype.update=function(s,l,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,l,this.stateDependentLayers,f)},da.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},da.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},da.prototype.upload=function(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,ce),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0},da.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},da.prototype.addFeature=function(s,l,f,g){for(var w=0,S=l;w<S.length;w+=1)for(var C=0,L=S[w];C<L.length;C+=1){var z=L[C],$=z.x,W=z.y;if(!($<0||$>=8192||W<0||W>=8192)){var K=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,s.sortKey),ne=K.vertexLength;ms(this.layoutVertexArray,$,W,-1,-1),ms(this.layoutVertexArray,$,W,1,-1),ms(this.layoutVertexArray,$,W,1,1),ms(this.layoutVertexArray,$,W,-1,1),this.indexArray.emplaceBack(ne,ne+1,ne+2),this.indexArray.emplaceBack(ne,ne+3,ne+2),K.vertexLength+=4,K.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,f,{},g)},Jr("CircleBucket",da,{omit:["layers"]});var Tl=new Xo({"circle-sort-key":new on(de.layout_circle["circle-sort-key"])}),Ac={paint:new Xo({"circle-radius":new on(de.paint_circle["circle-radius"]),"circle-color":new on(de.paint_circle["circle-color"]),"circle-blur":new on(de.paint_circle["circle-blur"]),"circle-opacity":new on(de.paint_circle["circle-opacity"]),"circle-translate":new _n(de.paint_circle["circle-translate"]),"circle-translate-anchor":new _n(de.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new _n(de.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new _n(de.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new on(de.paint_circle["circle-stroke-width"]),"circle-stroke-color":new on(de.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new on(de.paint_circle["circle-stroke-opacity"])}),layout:Tl},$i=typeof Float32Array<"u"?Float32Array:Array;function Bs(s){return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function zo(s,l,f){var g=l[0],w=l[1],S=l[2],C=l[3],L=l[4],z=l[5],$=l[6],W=l[7],K=l[8],ne=l[9],le=l[10],Ie=l[11],ke=l[12],Ze=l[13],Ve=l[14],st=l[15],vt=f[0],Tt=f[1],It=f[2],Yt=f[3];return s[0]=vt*g+Tt*L+It*K+Yt*ke,s[1]=vt*w+Tt*z+It*ne+Yt*Ze,s[2]=vt*S+Tt*$+It*le+Yt*Ve,s[3]=vt*C+Tt*W+It*Ie+Yt*st,s[4]=(vt=f[4])*g+(Tt=f[5])*L+(It=f[6])*K+(Yt=f[7])*ke,s[5]=vt*w+Tt*z+It*ne+Yt*Ze,s[6]=vt*S+Tt*$+It*le+Yt*Ve,s[7]=vt*C+Tt*W+It*Ie+Yt*st,s[8]=(vt=f[8])*g+(Tt=f[9])*L+(It=f[10])*K+(Yt=f[11])*ke,s[9]=vt*w+Tt*z+It*ne+Yt*Ze,s[10]=vt*S+Tt*$+It*le+Yt*Ve,s[11]=vt*C+Tt*W+It*Ie+Yt*st,s[12]=(vt=f[12])*g+(Tt=f[13])*L+(It=f[14])*K+(Yt=f[15])*ke,s[13]=vt*w+Tt*z+It*ne+Yt*Ze,s[14]=vt*S+Tt*$+It*le+Yt*Ve,s[15]=vt*C+Tt*W+It*Ie+Yt*st,s}Math.hypot||(Math.hypot=function(){for(var s=arguments,l=0,f=arguments.length;f--;)l+=s[f]*s[f];return Math.sqrt(l)});var Cl,up=zo;function tu(s,l,f){var g=l[0],w=l[1],S=l[2],C=l[3];return s[0]=f[0]*g+f[4]*w+f[8]*S+f[12]*C,s[1]=f[1]*g+f[5]*w+f[9]*S+f[13]*C,s[2]=f[2]*g+f[6]*w+f[10]*S+f[14]*C,s[3]=f[3]*g+f[7]*w+f[11]*S+f[15]*C,s}Cl=new $i(3),$i!=Float32Array&&(Cl[0]=0,Cl[1]=0,Cl[2]=0),function(){var s=new $i(4);$i!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0,s[3]=0)}();var Mf=(function(){var s=new $i(2);$i!=Float32Array&&(s[0]=0,s[1]=0)}(),function(s){function l(f){s.call(this,f,Ac)}return s&&(l.__proto__=s),(l.prototype=Object.create(s&&s.prototype)).constructor=l,l.prototype.createBucket=function(f){return new da(f)},l.prototype.queryRadius=function(f){var g=f;return al("circle-radius",this,g)+al("circle-stroke-width",this,g)+Ro(this.paint.get("circle-translate"))},l.prototype.queryIntersectsFeature=function(f,g,w,S,C,L,z,$){for(var W=yu(f,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),L.angle,z),K=this.paint.get("circle-radius").evaluate(g,w)+this.paint.get("circle-stroke-width").evaluate(g,w),ne=this.paint.get("circle-pitch-alignment")==="map",le=ne?W:function(gr,Or){return gr.map(function(Cn){return Ru(Cn,Or)})}(W,$),Ie=ne?K*z:K,ke=0,Ze=S;ke<Ze.length;ke+=1)for(var Ve=0,st=Ze[ke];Ve<st.length;Ve+=1){var vt=st[Ve],Tt=ne?vt:Ru(vt,$),It=Ie,Yt=tu([],[vt.x,vt.y,0,1],$);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?It*=Yt[3]/L.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(It*=L.cameraToCenterDistance/Yt[3]),ks(le,Tt,It))return!0}return!1},l}(tl));function Ru(s,l){var f=tu([],[s.x,s.y,0,1],l);return new y(f[0]/f[3],f[1]/f[3])}var nf=function(s){function l(){s.apply(this,arguments)}return s&&(l.__proto__=s),(l.prototype=Object.create(s&&s.prototype)).constructor=l,l}(da);function _u(s,l,f,g){var w=l.width,S=l.height;if(g){if(g instanceof Uint8ClampedArray)g=new Uint8Array(g.buffer);else if(g.length!==w*S*f)throw new RangeError("mismatched image size")}else g=new Uint8Array(w*S*f);return s.width=w,s.height=S,s.data=g,s}function Ml(s,l,f){var g=l.width,w=l.height;if(g!==s.width||w!==s.height){var S=_u({},{width:g,height:w},f);Tc(s,S,{x:0,y:0},{x:0,y:0},{width:Math.min(s.width,g),height:Math.min(s.height,w)},f),s.width=g,s.height=w,s.data=S.data}}function Tc(s,l,f,g,w,S){if(w.width===0||w.height===0)return l;if(w.width>s.width||w.height>s.height||f.x>s.width-w.width||f.y>s.height-w.height)throw new RangeError("out of range source coordinates for image copy");if(w.width>l.width||w.height>l.height||g.x>l.width-w.width||g.y>l.height-w.height)throw new RangeError("out of range destination coordinates for image copy");for(var C=s.data,L=l.data,z=0;z<w.height;z++)for(var $=((f.y+z)*s.width+f.x)*S,W=((g.y+z)*l.width+g.x)*S,K=0;K<w.width*S;K++)L[W+K]=C[$+K];return l}Jr("HeatmapBucket",nf,{omit:["layers"]});var Lu=function(s,l){_u(this,s,1,l)};Lu.prototype.resize=function(s){Ml(this,s,1)},Lu.prototype.clone=function(){return new Lu({width:this.width,height:this.height},new Uint8Array(this.data))},Lu.copy=function(s,l,f,g,w){Tc(s,l,f,g,w,1)};var gs=function(s,l){_u(this,s,4,l)};gs.prototype.resize=function(s){Ml(this,s,4)},gs.prototype.replace=function(s,l){l?this.data.set(s):this.data=s instanceof Uint8ClampedArray?new Uint8Array(s.buffer):s},gs.prototype.clone=function(){return new gs({width:this.width,height:this.height},new Uint8Array(this.data))},gs.copy=function(s,l,f,g,w){Tc(s,l,f,g,w,4)},Jr("AlphaImage",Lu),Jr("RGBAImage",gs);var rd={paint:new Xo({"heatmap-radius":new on(de.paint_heatmap["heatmap-radius"]),"heatmap-weight":new on(de.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new _n(de.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ds(de.paint_heatmap["heatmap-color"]),"heatmap-opacity":new _n(de.paint_heatmap["heatmap-opacity"])})};function lp(s){var l={},f=s.resolution||256,g=s.clips?s.clips.length:1,w=s.image||new gs({width:f,height:g}),S=function(Ie,ke,Ze){l[s.evaluationKey]=Ze;var Ve=s.expression.evaluate(l);w.data[Ie+ke+0]=Math.floor(255*Ve.r/Ve.a),w.data[Ie+ke+1]=Math.floor(255*Ve.g/Ve.a),w.data[Ie+ke+2]=Math.floor(255*Ve.b/Ve.a),w.data[Ie+ke+3]=Math.floor(255*Ve.a)};if(s.clips)for(var C=0,L=0;C<g;++C,L+=4*f)for(var z=0,$=0;z<f;z++,$+=4){var W=z/(f-1),K=s.clips[C];S(L,$,K.start*(1-W)+K.end*W)}else for(var ne=0,le=0;ne<f;ne++,le+=4)S(0,le,ne/(f-1));return w}var nd=function(s){function l(f){s.call(this,f,rd),this._updateColorRamp()}return s&&(l.__proto__=s),(l.prototype=Object.create(s&&s.prototype)).constructor=l,l.prototype.createBucket=function(f){return new nf(f)},l.prototype._handleSpecialPaintPropertyUpdate=function(f){f==="heatmap-color"&&this._updateColorRamp()},l.prototype._updateColorRamp=function(){this.colorRamp=lp({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},l.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},l.prototype.queryRadius=function(){return 0},l.prototype.queryIntersectsFeature=function(){return!1},l.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},l}(tl),Wd={paint:new Xo({"hillshade-illumination-direction":new _n(de.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new _n(de.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new _n(de.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new _n(de.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new _n(de.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new _n(de.paint_hillshade["hillshade-accent-color"])})},Pf=function(s){function l(f){s.call(this,f,Wd)}return s&&(l.__proto__=s),(l.prototype=Object.create(s&&s.prototype)).constructor=l,l.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},l}(tl),cp=bo([{name:"a_pos",components:2,type:"Int16"}],4).members,id=ad,Xi=ad;function ad(s,l,f){f=f||2;var g,w,S,C,L,z,$,W=l&&l.length,K=W?l[0]*f:s.length,ne=Vv(s,0,K,f,!0),le=[];if(!ne||ne.next===ne.prev)return le;if(W&&(ne=function(ke,Ze,Ve,st){var vt,Tt,It,Yt=[];for(vt=0,Tt=Ze.length;vt<Tt;vt++)(It=Vv(ke,Ze[vt]*st,vt<Tt-1?Ze[vt+1]*st:ke.length,st,!1))===It.next&&(It.steiner=!0),Yt.push(sl(It));for(Yt.sort(od),vt=0;vt<Yt.length;vt++)$v(Yt[vt],Ve),Ve=ol(Ve,Ve.next);return Ve}(s,l,ne,f)),s.length>80*f){g=S=s[0],w=C=s[1];for(var Ie=f;Ie<K;Ie+=f)(L=s[Ie])<g&&(g=L),(z=s[Ie+1])<w&&(w=z),L>S&&(S=L),z>C&&(C=z);$=($=Math.max(S-g,C-w))!==0?1/$:0}return fp(ne,le,f,g,w,$),le}function Vv(s,l,f,g,w){var S,C;if(w===Ih(s,l,f,g)>0)for(S=l;S<f;S+=g)C=Il(S,s[S],s[S+1],C);else for(S=f-g;S>=l;S-=g)C=Il(S,s[S],s[S+1],C);return C&&Th(C,C.next)&&(Ph(C),C=C.next),C}function ol(s,l){if(!s)return s;l||(l=s);var f,g=s;do if(f=!1,g.steiner||!Th(g,g.next)&&Eo(g.prev,g,g.next)!==0)g=g.next;else{if(Ph(g),(g=l=g.prev)===g.next)break;f=!0}while(f||g!==l);return l}function fp(s,l,f,g,w,S,C){if(s){!C&&S&&function(W,K,ne,le){var Ie=W;do Ie.z===null&&(Ie.z=Xd(Ie.x,Ie.y,K,ne,le)),Ie.prevZ=Ie.prev,Ie.nextZ=Ie.next,Ie=Ie.next;while(Ie!==W);Ie.prevZ.nextZ=null,Ie.prevZ=null,function(ke){var Ze,Ve,st,vt,Tt,It,Yt,gr,Or=1;do{for(Ve=ke,ke=null,Tt=null,It=0;Ve;){for(It++,st=Ve,Yt=0,Ze=0;Ze<Or&&(Yt++,st=st.nextZ);Ze++);for(gr=Or;Yt>0||gr>0&&st;)Yt!==0&&(gr===0||!st||Ve.z<=st.z)?(vt=Ve,Ve=Ve.nextZ,Yt--):(vt=st,st=st.nextZ,gr--),Tt?Tt.nextZ=vt:ke=vt,vt.prevZ=Tt,Tt=vt;Ve=st}Tt.nextZ=null,Or*=2}while(It>1)}(Ie)}(s,g,w,S);for(var L,z,$=s;s.prev!==s.next;)if(L=s.prev,z=s.next,S?jv(s,g,w,S):hp(s))l.push(L.i/f),l.push(s.i/f),l.push(z.i/f),Ph(s),s=z.next,$=z.next;else if((s=z)===$){C?C===1?fp(s=Pl(ol(s),l,f),l,f,g,w,S,2):C===2&&Ig(s,l,f,g,w,S):fp(ol(s),l,f,g,w,S,1);break}}}function hp(s){var l=s.prev,f=s,g=s.next;if(Eo(l,f,g)>=0)return!1;for(var w=s.next.next;w!==s.prev;){if(ul(l.x,l.y,f.x,f.y,g.x,g.y,w.x,w.y)&&Eo(w.prev,w,w.next)>=0)return!1;w=w.next}return!0}function jv(s,l,f,g){var w=s.prev,S=s,C=s.next;if(Eo(w,S,C)>=0)return!1;for(var L=w.x>S.x?w.x>C.x?w.x:C.x:S.x>C.x?S.x:C.x,z=w.y>S.y?w.y>C.y?w.y:C.y:S.y>C.y?S.y:C.y,$=Xd(w.x<S.x?w.x<C.x?w.x:C.x:S.x<C.x?S.x:C.x,w.y<S.y?w.y<C.y?w.y:C.y:S.y<C.y?S.y:C.y,l,f,g),W=Xd(L,z,l,f,g),K=s.prevZ,ne=s.nextZ;K&&K.z>=$&&ne&&ne.z<=W;){if(K!==s.prev&&K!==s.next&&ul(w.x,w.y,S.x,S.y,C.x,C.y,K.x,K.y)&&Eo(K.prev,K,K.next)>=0||(K=K.prevZ,ne!==s.prev&&ne!==s.next&&ul(w.x,w.y,S.x,S.y,C.x,C.y,ne.x,ne.y)&&Eo(ne.prev,ne,ne.next)>=0))return!1;ne=ne.nextZ}for(;K&&K.z>=$;){if(K!==s.prev&&K!==s.next&&ul(w.x,w.y,S.x,S.y,C.x,C.y,K.x,K.y)&&Eo(K.prev,K,K.next)>=0)return!1;K=K.prevZ}for(;ne&&ne.z<=W;){if(ne!==s.prev&&ne!==s.next&&ul(w.x,w.y,S.x,S.y,C.x,C.y,ne.x,ne.y)&&Eo(ne.prev,ne,ne.next)>=0)return!1;ne=ne.nextZ}return!0}function Pl(s,l,f){var g=s;do{var w=g.prev,S=g.next.next;!Th(w,S)&&Hv(w,g,g.next,S)&&Cc(w,S)&&Cc(S,w)&&(l.push(w.i/f),l.push(g.i/f),l.push(S.i/f),Ph(g),Ph(g.next),g=s=S),g=g.next}while(g!==s);return ol(g)}function Ig(s,l,f,g,w,S){var C=s;do{for(var L=C.next.next;L!==C.prev;){if(C.i!==L.i&&Gv(C,L)){var z=Mh(C,L);return C=ol(C,C.next),z=ol(z,z.next),fp(C,l,f,g,w,S),void fp(z,l,f,g,w,S)}L=L.next}C=C.next}while(C!==s)}function od(s,l){return s.x-l.x}function $v(s,l){if(l=function(g,w){var S,C=w,L=g.x,z=g.y,$=-1/0;do{if(z<=C.y&&z>=C.next.y&&C.next.y!==C.y){var W=C.x+(z-C.y)*(C.next.x-C.x)/(C.next.y-C.y);if(W<=L&&W>$){if($=W,W===L){if(z===C.y)return C;if(z===C.next.y)return C.next}S=C.x<C.next.x?C:C.next}}C=C.next}while(C!==w);if(!S)return null;if(L===$)return S;var K,ne=S,le=S.x,Ie=S.y,ke=1/0;C=S;do L>=C.x&&C.x>=le&&L!==C.x&&ul(z<Ie?L:$,z,le,Ie,z<Ie?$:L,z,C.x,C.y)&&(K=Math.abs(z-C.y)/(L-C.x),Cc(C,g)&&(K<ke||K===ke&&(C.x>S.x||C.x===S.x&&Xm(S,C)))&&(S=C,ke=K)),C=C.next;while(C!==ne);return S}(s,l)){var f=Mh(l,s);ol(l,l.next),ol(f,f.next)}}function Xm(s,l){return Eo(s.prev,s,l.prev)<0&&Eo(l.next,s,s.next)<0}function Xd(s,l,f,g,w){return(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=32767*(s-f)*w)|s<<8))|s<<4))|s<<2))|s<<1))|(l=1431655765&((l=858993459&((l=252645135&((l=16711935&((l=32767*(l-g)*w)|l<<8))|l<<4))|l<<2))|l<<1))<<1}function sl(s){var l=s,f=s;do(l.x<f.x||l.x===f.x&&l.y<f.y)&&(f=l),l=l.next;while(l!==s);return f}function ul(s,l,f,g,w,S,C,L){return(w-C)*(l-L)-(s-C)*(S-L)>=0&&(s-C)*(g-L)-(f-C)*(l-L)>=0&&(f-C)*(S-L)-(w-C)*(g-L)>=0}function Gv(s,l){return s.next.i!==l.i&&s.prev.i!==l.i&&!function(f,g){var w=f;do{if(w.i!==f.i&&w.next.i!==f.i&&w.i!==g.i&&w.next.i!==g.i&&Hv(w,w.next,f,g))return!0;w=w.next}while(w!==f);return!1}(s,l)&&(Cc(s,l)&&Cc(l,s)&&function(f,g){var w=f,S=!1,C=(f.x+g.x)/2,L=(f.y+g.y)/2;do w.y>L!=w.next.y>L&&w.next.y!==w.y&&C<(w.next.x-w.x)*(L-w.y)/(w.next.y-w.y)+w.x&&(S=!S),w=w.next;while(w!==f);return S}(s,l)&&(Eo(s.prev,s,l.prev)||Eo(s,l.prev,l))||Th(s,l)&&Eo(s.prev,s,s.next)>0&&Eo(l.prev,l,l.next)>0)}function Eo(s,l,f){return(l.y-s.y)*(f.x-l.x)-(l.x-s.x)*(f.y-l.y)}function Th(s,l){return s.x===l.x&&s.y===l.y}function Hv(s,l,f,g){var w=Ch(Eo(s,l,f)),S=Ch(Eo(s,l,g)),C=Ch(Eo(f,g,s)),L=Ch(Eo(f,g,l));return w!==S&&C!==L||!(w!==0||!pp(s,f,l))||!(S!==0||!pp(s,g,l))||!(C!==0||!pp(f,s,g))||!(L!==0||!pp(f,l,g))}function pp(s,l,f){return l.x<=Math.max(s.x,f.x)&&l.x>=Math.min(s.x,f.x)&&l.y<=Math.max(s.y,f.y)&&l.y>=Math.min(s.y,f.y)}function Ch(s){return s>0?1:s<0?-1:0}function Cc(s,l){return Eo(s.prev,s,s.next)<0?Eo(s,l,s.next)>=0&&Eo(s,s.prev,l)>=0:Eo(s,l,s.prev)<0||Eo(s,s.next,l)<0}function Mh(s,l){var f=new ll(s.i,s.x,s.y),g=new ll(l.i,l.x,l.y),w=s.next,S=l.prev;return s.next=l,l.prev=s,f.next=w,w.prev=f,g.next=f,f.prev=g,S.next=g,g.prev=S,g}function Il(s,l,f,g){var w=new ll(s,l,f);return g?(w.next=g.next,w.prev=g,g.next.prev=w,g.next=w):(w.prev=w,w.next=w),w}function Ph(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function ll(s,l,f){this.i=s,this.x=l,this.y=f,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Ih(s,l,f,g){for(var w=0,S=l,C=f-g;S<f;S+=g)w+=(s[C]-s[S])*(s[S+1]+s[C+1]),C=S;return w}function sd(s,l,f,g,w){(function S(C,L,z,$,W){for(;$>z;){if($-z>600){var K=$-z+1,ne=L-z+1,le=Math.log(K),Ie=.5*Math.exp(2*le/3),ke=.5*Math.sqrt(le*Ie*(K-Ie)/K)*(ne-K/2<0?-1:1);S(C,L,Math.max(z,Math.floor(L-ne*Ie/K+ke)),Math.min($,Math.floor(L+(K-ne)*Ie/K+ke)),W)}var Ze=C[L],Ve=z,st=$;for(af(C,z,L),W(C[$],Ze)>0&&af(C,z,$);Ve<st;){for(af(C,Ve,st),Ve++,st--;W(C[Ve],Ze)<0;)Ve++;for(;W(C[st],Ze)>0;)st--}W(C[z],Ze)===0?af(C,z,st):af(C,++st,$),st<=L&&(z=st+1),L<=st&&($=st-1)}})(s,l,f||0,g||s.length-1,w||Yd)}function af(s,l,f){var g=s[l];s[l]=s[f],s[f]=g}function Yd(s,l){return s<l?-1:s>l?1:0}function dp(s,l){var f=s.length;if(f<=1)return[s];for(var g,w,S=[],C=0;C<f;C++){var L=ze(s[C]);L!==0&&(s[C].area=Math.abs(L),w===void 0&&(w=L<0),w===L<0?(g&&S.push(g),g=[s[C]]):g.push(s[C]))}if(g&&S.push(g),l>1)for(var z=0;z<S.length;z++)S[z].length<=l||(sd(S[z],l,1,S[z].length-1,qd),S[z]=S[z].slice(0,l));return S}function qd(s,l){return l.area-s.area}function If(s,l,f){for(var g=f.patternDependencies,w=!1,S=0,C=l;S<C.length;S+=1){var L=C[S].paint.get(s+"-pattern");L.isConstant()||(w=!0);var z=L.constantOr(null);z&&(w=!0,g[z.to]=!0,g[z.from]=!0)}return w}function Rf(s,l,f,g,w){for(var S=w.patternDependencies,C=0,L=l;C<L.length;C+=1){var z=L[C],$=z.paint.get(s+"-pattern").value;if($.kind!=="constant"){var W=$.evaluate({zoom:g-1},f,{},w.availableImages),K=$.evaluate({zoom:g},f,{},w.availableImages),ne=$.evaluate({zoom:g+1},f,{},w.availableImages);K=K&&K.name?K.name:K,ne=ne&&ne.name?ne.name:ne,S[W=W&&W.name?W.name:W]=!0,S[K]=!0,S[ne]=!0,f.patterns[z.id]={min:W,mid:K,max:ne}}}return f}ad.deviation=function(s,l,f,g){var w=l&&l.length,S=Math.abs(Ih(s,0,w?l[0]*f:s.length,f));if(w)for(var C=0,L=l.length;C<L;C++)S-=Math.abs(Ih(s,l[C]*f,C<L-1?l[C+1]*f:s.length,f));var z=0;for(C=0;C<g.length;C+=3){var $=g[C]*f,W=g[C+1]*f,K=g[C+2]*f;z+=Math.abs((s[$]-s[K])*(s[W+1]-s[$+1])-(s[$]-s[W])*(s[K+1]-s[$+1]))}return S===0&&z===0?0:Math.abs((z-S)/S)},ad.flatten=function(s){for(var l=s[0][0].length,f={vertices:[],holes:[],dimensions:l},g=0,w=0;w<s.length;w++){for(var S=0;S<s[w].length;S++)for(var C=0;C<l;C++)f.vertices.push(s[w][S][C]);w>0&&f.holes.push(g+=s[w-1].length)}return f},id.default=Xi;var xu=function(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(function(l){return l.id}),this.index=s.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Al,this.indexArray=new Ec,this.indexArray2=new ef,this.programConfigurations=new pn(s.layers,s.zoom),this.segments=new ve,this.segments2=new ve,this.stateDependentLayerIds=this.layers.filter(function(l){return l.isStateDependent()}).map(function(l){return l.id})};xu.prototype.populate=function(s,l,f){this.hasPattern=If("fill",this.layers,l);for(var g=this.layers[0].layout.get("fill-sort-key"),w=[],S=0,C=s;S<C.length;S+=1){var L=C[S],z=L.feature,$=L.id,W=L.index,K=L.sourceLayerIndex,ne=this.layers[0]._featureFilter.needGeometry,le=Ea(z,ne);if(this.layers[0]._featureFilter.filter(new Bn(this.zoom),le,f)){var Ie=g?g.evaluate(le,{},f,l.availableImages):void 0,ke={id:$,properties:z.properties,type:z.type,sourceLayerIndex:K,index:W,geometry:ne?le.geometry:Ia(z),patterns:{},sortKey:Ie};w.push(ke)}}g&&w.sort(function(gr,Or){return gr.sortKey-Or.sortKey});for(var Ze=0,Ve=w;Ze<Ve.length;Ze+=1){var st=Ve[Ze],vt=st.geometry,Tt=st.index,It=st.sourceLayerIndex;if(this.hasPattern){var Yt=Rf("fill",this.layers,st,this.zoom,l);this.patternFeatures.push(Yt)}else this.addFeature(st,vt,Tt,f,{});l.featureIndex.insert(s[Tt].feature,vt,Tt,It,this.index)}},xu.prototype.update=function(s,l,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,l,this.stateDependentLayers,f)},xu.prototype.addFeatures=function(s,l,f){for(var g=0,w=this.patternFeatures;g<w.length;g+=1){var S=w[g];this.addFeature(S,S.geometry,S.index,l,f)}},xu.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},xu.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},xu.prototype.upload=function(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,cp),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.indexBuffer2=s.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(s),this.uploaded=!0},xu.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},xu.prototype.addFeature=function(s,l,f,g,w){for(var S=0,C=dp(l,500);S<C.length;S+=1){for(var L=C[S],z=0,$=0,W=L;$<W.length;$+=1)z+=W[$].length;for(var K=this.segments.prepareSegment(z,this.layoutVertexArray,this.indexArray),ne=K.vertexLength,le=[],Ie=[],ke=0,Ze=L;ke<Ze.length;ke+=1){var Ve=Ze[ke];if(Ve.length!==0){Ve!==L[0]&&Ie.push(le.length/2);var st=this.segments2.prepareSegment(Ve.length,this.layoutVertexArray,this.indexArray2),vt=st.vertexLength;this.layoutVertexArray.emplaceBack(Ve[0].x,Ve[0].y),this.indexArray2.emplaceBack(vt+Ve.length-1,vt),le.push(Ve[0].x),le.push(Ve[0].y);for(var Tt=1;Tt<Ve.length;Tt++)this.layoutVertexArray.emplaceBack(Ve[Tt].x,Ve[Tt].y),this.indexArray2.emplaceBack(vt+Tt-1,vt+Tt),le.push(Ve[Tt].x),le.push(Ve[Tt].y);st.vertexLength+=Ve.length,st.primitiveLength+=Ve.length}}for(var It=id(le,Ie),Yt=0;Yt<It.length;Yt+=3)this.indexArray.emplaceBack(ne+It[Yt],ne+It[Yt+1],ne+It[Yt+2]);K.vertexLength+=z,K.primitiveLength+=It.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,f,w,g)},Jr("FillBucket",xu,{omit:["layers","patternFeatures"]});var vp=new Xo({"fill-sort-key":new on(de.layout_fill["fill-sort-key"])}),mp={paint:new Xo({"fill-antialias":new _n(de.paint_fill["fill-antialias"]),"fill-opacity":new on(de.paint_fill["fill-opacity"]),"fill-color":new on(de.paint_fill["fill-color"]),"fill-outline-color":new on(de.paint_fill["fill-outline-color"]),"fill-translate":new _n(de.paint_fill["fill-translate"]),"fill-translate-anchor":new _n(de.paint_fill["fill-translate-anchor"]),"fill-pattern":new Gl(de.paint_fill["fill-pattern"])}),layout:vp},ru=function(s){function l(f){s.call(this,f,mp)}return s&&(l.__proto__=s),(l.prototype=Object.create(s&&s.prototype)).constructor=l,l.prototype.recalculate=function(f,g){s.prototype.recalculate.call(this,f,g);var w=this.paint._values["fill-outline-color"];w.value.kind==="constant"&&w.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},l.prototype.createBucket=function(f){return new xu(f)},l.prototype.queryRadius=function(){return Ro(this.paint.get("fill-translate"))},l.prototype.queryIntersectsFeature=function(f,g,w,S,C,L,z){return Iu(yu(f,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),L.angle,z),S)},l.prototype.isTileClipped=function(){return!0},l}(tl),ku=bo([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,Lf=Rh;function Rh(s,l,f,g,w){this.properties={},this.extent=f,this.type=0,this._pbf=s,this._geometry=-1,this._keys=g,this._values=w,s.readFields(gp,this,l)}function gp(s,l,f){s==1?l.id=f.readVarint():s==2?function(g,w){for(var S=g.readVarint()+g.pos;g.pos<S;){var C=w._keys[g.readVarint()],L=w._values[g.readVarint()];w.properties[C]=L}}(f,l):s==3?l.type=f.readVarint():s==4&&(l._geometry=f.pos)}function yp(s){for(var l,f,g=0,w=0,S=s.length,C=S-1;w<S;C=w++)g+=((f=s[C]).x-(l=s[w]).x)*(l.y+f.y);return g}Rh.types=["Unknown","Point","LineString","Polygon"],Rh.prototype.loadGeometry=function(){var s=this._pbf;s.pos=this._geometry;for(var l,f=s.readVarint()+s.pos,g=1,w=0,S=0,C=0,L=[];s.pos<f;){if(w<=0){var z=s.readVarint();g=7&z,w=z>>3}if(w--,g===1||g===2)S+=s.readSVarint(),C+=s.readSVarint(),g===1&&(l&&L.push(l),l=[]),l.push(new y(S,C));else{if(g!==7)throw new Error("unknown command "+g);l&&l.push(l[0].clone())}}return l&&L.push(l),L},Rh.prototype.bbox=function(){var s=this._pbf;s.pos=this._geometry;for(var l=s.readVarint()+s.pos,f=1,g=0,w=0,S=0,C=1/0,L=-1/0,z=1/0,$=-1/0;s.pos<l;){if(g<=0){var W=s.readVarint();f=7&W,g=W>>3}if(g--,f===1||f===2)(w+=s.readSVarint())<C&&(C=w),w>L&&(L=w),(S+=s.readSVarint())<z&&(z=S),S>$&&($=S);else if(f!==7)throw new Error("unknown command "+f)}return[C,z,L,$]},Rh.prototype.toGeoJSON=function(s,l,f){var g,w,S=this.extent*Math.pow(2,f),C=this.extent*s,L=this.extent*l,z=this.loadGeometry(),$=Rh.types[this.type];function W(le){for(var Ie=0;Ie<le.length;Ie++){var ke=le[Ie];le[Ie]=[360*(ke.x+C)/S-180,360/Math.PI*Math.atan(Math.exp((180-360*(ke.y+L)/S)*Math.PI/180))-90]}}switch(this.type){case 1:var K=[];for(g=0;g<z.length;g++)K[g]=z[g][0];W(z=K);break;case 2:for(g=0;g<z.length;g++)W(z[g]);break;case 3:for(z=function(le){var Ie=le.length;if(Ie<=1)return[le];for(var ke,Ze,Ve=[],st=0;st<Ie;st++){var vt=yp(le[st]);vt!==0&&(Ze===void 0&&(Ze=vt<0),Ze===vt<0?(ke&&Ve.push(ke),ke=[le[st]]):ke.push(le[st]))}return ke&&Ve.push(ke),Ve}(z),g=0;g<z.length;g++)for(w=0;w<z[g].length;w++)W(z[g][w])}z.length===1?z=z[0]:$="Multi"+$;var ne={type:"Feature",geometry:{type:$,coordinates:z},properties:this.properties};return"id"in this&&(ne.id=this.id),ne};var Wv=Xv;function Xv(s,l){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=s,this._keys=[],this._values=[],this._features=[],s.readFields(kf,this,l),this.length=this._features.length}function kf(s,l,f){s===15?l.version=f.readVarint():s===1?l.name=f.readString():s===5?l.extent=f.readVarint():s===2?l._features.push(f.pos):s===3?l._keys.push(f.readString()):s===4&&l._values.push(function(g){for(var w=null,S=g.readVarint()+g.pos;g.pos<S;){var C=g.readVarint()>>3;w=C===1?g.readString():C===2?g.readFloat():C===3?g.readDouble():C===4?g.readVarint64():C===5?g.readVarint():C===6?g.readSVarint():C===7?g.readBoolean():null}return w}(f))}function Yv(s,l,f){if(s===3){var g=new Wv(f,f.readVarint()+f.pos);g.length&&(l[g.name]=g)}}Xv.prototype.feature=function(s){if(s<0||s>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[s];var l=this._pbf.readVarint()+this._pbf.pos;return new Lf(this._pbf,l,this.extent,this._keys,this._values)};var Rl={VectorTile:function(s,l){this.layers=s.readFields(Yv,{},l)},VectorTileFeature:Lf,VectorTileLayer:Wv},_p=Rl.VectorTileFeature.types,qv=Math.pow(2,13);function Lh(s,l,f,g,w,S,C,L){s.emplaceBack(l,f,2*Math.floor(g*qv)+C,w*qv*2,S*qv*2,Math.round(L))}var Ll=function(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(function(l){return l.id}),this.index=s.index,this.hasPattern=!1,this.layoutVertexArray=new vs,this.indexArray=new Ec,this.programConfigurations=new pn(s.layers,s.zoom),this.segments=new ve,this.stateDependentLayerIds=this.layers.filter(function(l){return l.isStateDependent()}).map(function(l){return l.id})};function cl(s,l){return s.x===l.x&&(s.x<0||s.x>8192)||s.y===l.y&&(s.y<0||s.y>8192)}Ll.prototype.populate=function(s,l,f){this.features=[],this.hasPattern=If("fill-extrusion",this.layers,l);for(var g=0,w=s;g<w.length;g+=1){var S=w[g],C=S.feature,L=S.id,z=S.index,$=S.sourceLayerIndex,W=this.layers[0]._featureFilter.needGeometry,K=Ea(C,W);if(this.layers[0]._featureFilter.filter(new Bn(this.zoom),K,f)){var ne={id:L,sourceLayerIndex:$,index:z,geometry:W?K.geometry:Ia(C),properties:C.properties,type:C.type,patterns:{}};this.hasPattern?this.features.push(Rf("fill-extrusion",this.layers,ne,this.zoom,l)):this.addFeature(ne,ne.geometry,z,f,{}),l.featureIndex.insert(C,ne.geometry,z,$,this.index,!0)}}},Ll.prototype.addFeatures=function(s,l,f){for(var g=0,w=this.features;g<w.length;g+=1){var S=w[g];this.addFeature(S,S.geometry,S.index,l,f)}},Ll.prototype.update=function(s,l,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,l,this.stateDependentLayers,f)},Ll.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Ll.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Ll.prototype.upload=function(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,ku),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0},Ll.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Ll.prototype.addFeature=function(s,l,f,g,w){for(var S=0,C=dp(l,500);S<C.length;S+=1){for(var L=C[S],z=0,$=0,W=L;$<W.length;$+=1)z+=W[$].length;for(var K=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),ne=0,le=L;ne<le.length;ne+=1){var Ie=le[ne];if(Ie.length!==0&&!((xi=Ie).every(function(ai){return ai.x<0})||xi.every(function(ai){return ai.x>8192})||xi.every(function(ai){return ai.y<0})||xi.every(function(ai){return ai.y>8192})))for(var ke=0,Ze=0;Ze<Ie.length;Ze++){var Ve=Ie[Ze];if(Ze>=1){var st=Ie[Ze-1];if(!cl(Ve,st)){K.vertexLength+4>ve.MAX_VERTEX_ARRAY_LENGTH&&(K=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var vt=Ve.sub(st)._perp()._unit(),Tt=st.dist(Ve);ke+Tt>32768&&(ke=0),Lh(this.layoutVertexArray,Ve.x,Ve.y,vt.x,vt.y,0,0,ke),Lh(this.layoutVertexArray,Ve.x,Ve.y,vt.x,vt.y,0,1,ke),Lh(this.layoutVertexArray,st.x,st.y,vt.x,vt.y,0,0,ke+=Tt),Lh(this.layoutVertexArray,st.x,st.y,vt.x,vt.y,0,1,ke);var It=K.vertexLength;this.indexArray.emplaceBack(It,It+2,It+1),this.indexArray.emplaceBack(It+1,It+2,It+3),K.vertexLength+=4,K.primitiveLength+=2}}}}if(K.vertexLength+z>ve.MAX_VERTEX_ARRAY_LENGTH&&(K=this.segments.prepareSegment(z,this.layoutVertexArray,this.indexArray)),_p[s.type]==="Polygon"){for(var Yt=[],gr=[],Or=K.vertexLength,Cn=0,qr=L;Cn<qr.length;Cn+=1){var In=qr[Cn];if(In.length!==0){In!==L[0]&&gr.push(Yt.length/2);for(var tn=0;tn<In.length;tn++){var hi=In[tn];Lh(this.layoutVertexArray,hi.x,hi.y,0,0,1,1,0),Yt.push(hi.x),Yt.push(hi.y)}}}for(var jn=id(Yt,gr),vn=0;vn<jn.length;vn+=3)this.indexArray.emplaceBack(Or+jn[vn],Or+jn[vn+2],Or+jn[vn+1]);K.primitiveLength+=jn.length/3,K.vertexLength+=z}}var xi;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,f,w,g)},Jr("FillExtrusionBucket",Ll,{omit:["layers","features"]});var Zv={paint:new Xo({"fill-extrusion-opacity":new _n(de["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new on(de["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new _n(de["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new _n(de["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Gl(de["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new on(de["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new on(de["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new _n(de["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},of=function(s){function l(f){s.call(this,f,Zv)}return s&&(l.__proto__=s),(l.prototype=Object.create(s&&s.prototype)).constructor=l,l.prototype.createBucket=function(f){return new Ll(f)},l.prototype.queryRadius=function(){return Ro(this.paint.get("fill-extrusion-translate"))},l.prototype.is3D=function(){return!0},l.prototype.queryIntersectsFeature=function(f,g,w,S,C,L,z,$){var W=yu(f,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),L.angle,z),K=this.paint.get("fill-extrusion-height").evaluate(g,w),ne=this.paint.get("fill-extrusion-base").evaluate(g,w),le=function(ke,Ze,Ve,st){for(var vt=[],Tt=0,It=ke;Tt<It.length;Tt+=1){var Yt=It[Tt],gr=[Yt.x,Yt.y,0,1];tu(gr,gr,Ze),vt.push(new y(gr[0]/gr[3],gr[1]/gr[3]))}return vt}(W,$),Ie=function(ke,Ze,Ve,st){for(var vt=[],Tt=[],It=st[8]*Ze,Yt=st[9]*Ze,gr=st[10]*Ze,Or=st[11]*Ze,Cn=st[8]*Ve,qr=st[9]*Ve,In=st[10]*Ve,tn=st[11]*Ve,hi=0,jn=ke;hi<jn.length;hi+=1){for(var vn=[],xi=[],ai=0,Bi=jn[hi];ai<Bi.length;ai+=1){var Rn=Bi[ai],ta=Rn.x,eo=Rn.y,to=st[0]*ta+st[4]*eo+st[12],Wa=st[1]*ta+st[5]*eo+st[13],ro=st[2]*ta+st[6]*eo+st[14],Ao=st[3]*ta+st[7]*eo+st[15],$o=ro+gr,Ko=Ao+Or,iu=to+Cn,xs=Wa+qr,au=ro+In,ko=Ao+tn,bs=new y((to+It)/Ko,(Wa+Yt)/Ko);bs.z=$o/Ko,vn.push(bs);var Ri=new y(iu/ko,xs/ko);Ri.z=au/ko,xi.push(Ri)}vt.push(vn),Tt.push(xi)}return[vt,Tt]}(S,ne,K,$);return function(ke,Ze,Ve){var st=1/0;Iu(Ve,Ze)&&(st=xp(Ve,Ze[0]));for(var vt=0;vt<Ze.length;vt++)for(var Tt=Ze[vt],It=ke[vt],Yt=0;Yt<Tt.length-1;Yt++){var gr=Tt[Yt],Or=[gr,Tt[Yt+1],It[Yt+1],It[Yt],gr];rl(Ve,Or)&&(st=Math.min(st,xp(Ve,Or)))}return st!==1/0&&st}(Ie[0],Ie[1],le)},l}(tl);function Ou(s,l){return s.x*l.x+s.y*l.y}function xp(s,l){if(s.length===1){for(var f,g=0,w=l[g++];!f||w.equals(f);)if(!(f=l[g++]))return 1/0;for(;g<l.length;g++){var S=l[g],C=s[0],L=f.sub(w),z=S.sub(w),$=C.sub(w),W=Ou(L,L),K=Ou(L,z),ne=Ou(z,z),le=Ou($,L),Ie=Ou($,z),ke=W*ne-K*K,Ze=(ne*le-K*Ie)/ke,Ve=(W*Ie-K*le)/ke,st=w.z*(1-Ze-Ve)+f.z*Ze+S.z*Ve;if(isFinite(st))return st}return 1/0}for(var vt=1/0,Tt=0,It=l;Tt<It.length;Tt+=1)vt=Math.min(vt,It[Tt].z);return vt}var Kv=bo([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,ud=bo([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,ld=Rl.VectorTileFeature.types,Yo=Math.cos(Math.PI/180*37.5),ql=Math.pow(2,14)/.5,qi=function(s){var l=this;this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(function(f){return f.id}),this.index=s.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(f){l.gradients[f.id]={}}),this.layoutVertexArray=new as,this.layoutVertexArray2=new os,this.indexArray=new Ec,this.programConfigurations=new pn(s.layers,s.zoom),this.segments=new ve,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(f){return f.isStateDependent()}).map(function(f){return f.id})};qi.prototype.populate=function(s,l,f){this.hasPattern=If("line",this.layers,l);for(var g=this.layers[0].layout.get("line-sort-key"),w=[],S=0,C=s;S<C.length;S+=1){var L=C[S],z=L.feature,$=L.id,W=L.index,K=L.sourceLayerIndex,ne=this.layers[0]._featureFilter.needGeometry,le=Ea(z,ne);if(this.layers[0]._featureFilter.filter(new Bn(this.zoom),le,f)){var Ie=g?g.evaluate(le,{},f):void 0,ke={id:$,properties:z.properties,type:z.type,sourceLayerIndex:K,index:W,geometry:ne?le.geometry:Ia(z),patterns:{},sortKey:Ie};w.push(ke)}}g&&w.sort(function(gr,Or){return gr.sortKey-Or.sortKey});for(var Ze=0,Ve=w;Ze<Ve.length;Ze+=1){var st=Ve[Ze],vt=st.geometry,Tt=st.index,It=st.sourceLayerIndex;if(this.hasPattern){var Yt=Rf("line",this.layers,st,this.zoom,l);this.patternFeatures.push(Yt)}else this.addFeature(st,vt,Tt,f,{});l.featureIndex.insert(s[Tt].feature,vt,Tt,It,this.index)}},qi.prototype.update=function(s,l,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,l,this.stateDependentLayers,f)},qi.prototype.addFeatures=function(s,l,f){for(var g=0,w=this.patternFeatures;g<w.length;g+=1){var S=w[g];this.addFeature(S,S.geometry,S.index,l,f)}},qi.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},qi.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},qi.prototype.upload=function(s){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=s.createVertexBuffer(this.layoutVertexArray2,ud)),this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,Kv),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0},qi.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},qi.prototype.lineFeatureClips=function(s){if(s.properties&&s.properties.hasOwnProperty("mapbox_clip_start")&&s.properties.hasOwnProperty("mapbox_clip_end"))return{start:+s.properties.mapbox_clip_start,end:+s.properties.mapbox_clip_end}},qi.prototype.addFeature=function(s,l,f,g,w){var S=this.layers[0].layout,C=S.get("line-join").evaluate(s,{}),L=S.get("line-cap"),z=S.get("line-miter-limit"),$=S.get("line-round-limit");this.lineClips=this.lineFeatureClips(s);for(var W=0,K=l;W<K.length;W+=1)this.addLine(K[W],s,C,L,z,$);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,f,w,g)},qi.prototype.addLine=function(s,l,f,g,w,S){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var C=0;C<s.length-1;C++)this.totalDistance+=s[C].dist(s[C+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var L=ld[l.type]==="Polygon",z=s.length;z>=2&&s[z-1].equals(s[z-2]);)z--;for(var $=0;$<z-1&&s[$].equals(s[$+1]);)$++;if(!(z<(L?3:2))){f==="bevel"&&(w=1.05);var W,K=this.overscaling<=16?122880/(512*this.overscaling):0,ne=this.segments.prepareSegment(10*z,this.layoutVertexArray,this.indexArray),le=void 0,Ie=void 0,ke=void 0,Ze=void 0;this.e1=this.e2=-1,L&&(Ze=s[$].sub(W=s[z-2])._unit()._perp());for(var Ve=$;Ve<z;Ve++)if(!(Ie=Ve===z-1?L?s[$+1]:void 0:s[Ve+1])||!s[Ve].equals(Ie)){Ze&&(ke=Ze),W&&(le=W),W=s[Ve],Ze=Ie?Ie.sub(W)._unit()._perp():ke;var st=(ke=ke||Ze).add(Ze);st.x===0&&st.y===0||st._unit();var vt=ke.x*Ze.x+ke.y*Ze.y,Tt=st.x*Ze.x+st.y*Ze.y,It=Tt!==0?1/Tt:1/0,Yt=2*Math.sqrt(2-2*Tt),gr=Tt<Yo&&le&&Ie,Or=ke.x*Ze.y-ke.y*Ze.x>0;if(gr&&Ve>$){var Cn=W.dist(le);if(Cn>2*K){var qr=W.sub(W.sub(le)._mult(K/Cn)._round());this.updateDistance(le,qr),this.addCurrentVertex(qr,ke,0,0,ne),le=qr}}var In=le&&Ie,tn=In?f:L?"butt":g;if(In&&tn==="round"&&(It<S?tn="miter":It<=2&&(tn="fakeround")),tn==="miter"&&It>w&&(tn="bevel"),tn==="bevel"&&(It>2&&(tn="flipbevel"),It<w&&(tn="miter")),le&&this.updateDistance(le,W),tn==="miter")st._mult(It),this.addCurrentVertex(W,st,0,0,ne);else if(tn==="flipbevel"){if(It>100)st=Ze.mult(-1);else{var hi=It*ke.add(Ze).mag()/ke.sub(Ze).mag();st._perp()._mult(hi*(Or?-1:1))}this.addCurrentVertex(W,st,0,0,ne),this.addCurrentVertex(W,st.mult(-1),0,0,ne)}else if(tn==="bevel"||tn==="fakeround"){var jn=-Math.sqrt(It*It-1),vn=Or?jn:0,xi=Or?0:jn;if(le&&this.addCurrentVertex(W,ke,vn,xi,ne),tn==="fakeround")for(var ai=Math.round(180*Yt/Math.PI/20),Bi=1;Bi<ai;Bi++){var Rn=Bi/ai;if(Rn!==.5){var ta=Rn-.5;Rn+=Rn*ta*(Rn-1)*((1.0904+vt*(vt*(3.55645-1.43519*vt)-3.2452))*ta*ta+(.848013+vt*(.215638*vt-1.06021)))}var eo=Ze.sub(ke)._mult(Rn)._add(ke)._unit()._mult(Or?-1:1);this.addHalfVertex(W,eo.x,eo.y,!1,Or,0,ne)}Ie&&this.addCurrentVertex(W,Ze,-vn,-xi,ne)}else if(tn==="butt")this.addCurrentVertex(W,st,0,0,ne);else if(tn==="square"){var to=le?1:-1;this.addCurrentVertex(W,st,to,to,ne)}else tn==="round"&&(le&&(this.addCurrentVertex(W,ke,0,0,ne),this.addCurrentVertex(W,ke,1,1,ne,!0)),Ie&&(this.addCurrentVertex(W,Ze,-1,-1,ne,!0),this.addCurrentVertex(W,Ze,0,0,ne)));if(gr&&Ve<z-1){var Wa=W.dist(Ie);if(Wa>2*K){var ro=W.add(Ie.sub(W)._mult(K/Wa)._round());this.updateDistance(W,ro),this.addCurrentVertex(ro,Ze,0,0,ne),W=ro}}}}},qi.prototype.addCurrentVertex=function(s,l,f,g,w,S){S===void 0&&(S=!1);var C=l.y*g-l.x,L=-l.y-l.x*g;this.addHalfVertex(s,l.x+l.y*f,l.y-l.x*f,S,!1,f,w),this.addHalfVertex(s,C,L,S,!0,-g,w),this.distance>ql/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(s,l,f,g,w,S))},qi.prototype.addHalfVertex=function(s,l,f,g,w,S,C){var L=.5*(this.lineClips?this.scaledDistance*(ql-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((s.x<<1)+(g?1:0),(s.y<<1)+(w?1:0),Math.round(63*l)+128,Math.round(63*f)+128,1+(S===0?0:S<0?-1:1)|(63&L)<<2,L>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var z=C.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,z),C.primitiveLength++),w?this.e2=z:this.e1=z},qi.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},qi.prototype.updateDistance=function(s,l){this.distance+=s.dist(l),this.updateScaledDistance()},Jr("LineBucket",qi,{omit:["layers","patternFeatures"]});var bu=new Xo({"line-cap":new _n(de.layout_line["line-cap"]),"line-join":new on(de.layout_line["line-join"]),"line-miter-limit":new _n(de.layout_line["line-miter-limit"]),"line-round-limit":new _n(de.layout_line["line-round-limit"]),"line-sort-key":new on(de.layout_line["line-sort-key"])}),Zl={paint:new Xo({"line-opacity":new on(de.paint_line["line-opacity"]),"line-color":new on(de.paint_line["line-color"]),"line-translate":new _n(de.paint_line["line-translate"]),"line-translate-anchor":new _n(de.paint_line["line-translate-anchor"]),"line-width":new on(de.paint_line["line-width"]),"line-gap-width":new on(de.paint_line["line-gap-width"]),"line-offset":new on(de.paint_line["line-offset"]),"line-blur":new on(de.paint_line["line-blur"]),"line-dasharray":new Bo(de.paint_line["line-dasharray"]),"line-pattern":new Gl(de.paint_line["line-pattern"]),"line-gradient":new ds(de.paint_line["line-gradient"])}),layout:bu},Qv=new(function(s){function l(){s.apply(this,arguments)}return s&&(l.__proto__=s),(l.prototype=Object.create(s&&s.prototype)).constructor=l,l.prototype.possiblyEvaluate=function(f,g){return g=new Bn(Math.floor(g.zoom),{now:g.now,fadeDuration:g.fadeDuration,zoomHistory:g.zoomHistory,transition:g.transition}),s.prototype.possiblyEvaluate.call(this,f,g)},l.prototype.evaluate=function(f,g,w,S){return g=O({},g,{zoom:Math.floor(g.zoom)}),s.prototype.evaluate.call(this,f,g,w,S)},l}(on))(Zl.paint.properties["line-width"].specification);Qv.useIntegerZoom=!0;var Ym=function(s){function l(f){s.call(this,f,Zl),this.gradientVersion=0}return s&&(l.__proto__=s),(l.prototype=Object.create(s&&s.prototype)).constructor=l,l.prototype._handleSpecialPaintPropertyUpdate=function(f){f==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Mi,this.gradientVersion=(this.gradientVersion+1)%T)},l.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},l.prototype.recalculate=function(f,g){s.prototype.recalculate.call(this,f,g),this.paint._values["line-floorwidth"]=Qv.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,f)},l.prototype.createBucket=function(f){return new qi(f)},l.prototype.queryRadius=function(f){var g=f,w=qm(al("line-width",this,g),al("line-gap-width",this,g)),S=al("line-offset",this,g);return w/2+Math.abs(S)+Ro(this.paint.get("line-translate"))},l.prototype.queryIntersectsFeature=function(f,g,w,S,C,L,z){var $=yu(f,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),L.angle,z),W=z/2*qm(this.paint.get("line-width").evaluate(g,w),this.paint.get("line-gap-width").evaluate(g,w)),K=this.paint.get("line-offset").evaluate(g,w);return K&&(S=function(ne,le){for(var Ie=[],ke=new y(0,0),Ze=0;Ze<ne.length;Ze++){for(var Ve=ne[Ze],st=[],vt=0;vt<Ve.length;vt++){var Tt=Ve[vt],It=Ve[vt+1],Yt=vt===0?ke:Tt.sub(Ve[vt-1])._unit()._perp(),gr=vt===Ve.length-1?ke:It.sub(Tt)._unit()._perp(),Or=Yt._add(gr)._unit();Or._mult(1/(Or.x*gr.x+Or.y*gr.y)),st.push(Or._mult(le)._add(Tt))}Ie.push(st)}return Ie}(S,K*z)),function(ne,le,Ie){for(var ke=0;ke<le.length;ke++){var Ze=le[ke];if(ne.length>=3){for(var Ve=0;Ve<Ze.length;Ve++)if(nl(ne,Ze[Ve]))return!0}if(mu(ne,Ze,Ie))return!0}return!1}($,S,W)},l.prototype.isTileClipped=function(){return!0},l}(tl);function qm(s,l){return l>0?l+2*s:s}var Zm=bo([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Km=bo([{name:"a_projected_pos",components:3,type:"Float32"}],4),Rg=(bo([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),bo([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),Mc=(bo([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),bo([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),Jv=bo([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function em(s,l,f){return s.sections.forEach(function(g){g.text=function(w,S,C){var L=S.layout.get("text-transform").evaluate(C,{});return L==="uppercase"?w=w.toLocaleUpperCase():L==="lowercase"&&(w=w.toLocaleLowerCase()),Qs.applyArabicShaping&&(w=Qs.applyArabicShaping(w)),w}(g.text,l,f)}),s}bo([{name:"triangle",components:3,type:"Uint16"}]),bo([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),bo([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),bo([{type:"Float32",name:"offsetX"}]),bo([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var kh={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"},bp=function(s,l,f,g,w){var S,C,L=8*w-g-1,z=(1<<L)-1,$=z>>1,W=-7,K=f?w-1:0,ne=f?-1:1,le=s[l+K];for(K+=ne,S=le&(1<<-W)-1,le>>=-W,W+=L;W>0;S=256*S+s[l+K],K+=ne,W-=8);for(C=S&(1<<-W)-1,S>>=-W,W+=g;W>0;C=256*C+s[l+K],K+=ne,W-=8);if(S===0)S=1-$;else{if(S===z)return C?NaN:1/0*(le?-1:1);C+=Math.pow(2,g),S-=$}return(le?-1:1)*C*Math.pow(2,S-g)},Of=function(s,l,f,g,w,S){var C,L,z,$=8*S-w-1,W=(1<<$)-1,K=W>>1,ne=w===23?Math.pow(2,-24)-Math.pow(2,-77):0,le=g?0:S-1,Ie=g?1:-1,ke=l<0||l===0&&1/l<0?1:0;for(l=Math.abs(l),isNaN(l)||l===1/0?(L=isNaN(l)?1:0,C=W):(C=Math.floor(Math.log(l)/Math.LN2),l*(z=Math.pow(2,-C))<1&&(C--,z*=2),(l+=C+K>=1?ne/z:ne*Math.pow(2,1-K))*z>=2&&(C++,z/=2),C+K>=W?(L=0,C=W):C+K>=1?(L=(l*z-1)*Math.pow(2,w),C+=K):(L=l*Math.pow(2,K-1)*Math.pow(2,w),C=0));w>=8;s[f+le]=255&L,le+=Ie,L/=256,w-=8);for(C=C<<w|L,$+=w;$>0;s[f+le]=255&C,le+=Ie,C/=256,$-=8);s[f+le-Ie]|=128*ke},Qn=va;function va(s){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(s)?s:new Uint8Array(s||0),this.pos=0,this.type=0,this.length=this.buf.length}va.Varint=0,va.Fixed64=1,va.Bytes=2,va.Fixed32=5;var Zd=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function nu(s){return s.type===va.Bytes?s.readVarint()+s.pos:s.pos+1}function wp(s,l,f){return f?4294967296*l+(s>>>0):4294967296*(l>>>0)+(s>>>0)}function j(s,l,f){var g=l<=16383?1:l<=2097151?2:l<=268435455?3:Math.floor(Math.log(l)/(7*Math.LN2));f.realloc(g);for(var w=f.pos-1;w>=s;w--)f.buf[w+g]=f.buf[w]}function _e(s,l){for(var f=0;f<s.length;f++)l.writeVarint(s[f])}function De(s,l){for(var f=0;f<s.length;f++)l.writeSVarint(s[f])}function bt(s,l){for(var f=0;f<s.length;f++)l.writeFloat(s[f])}function Xt(s,l){for(var f=0;f<s.length;f++)l.writeDouble(s[f])}function xt(s,l){for(var f=0;f<s.length;f++)l.writeBoolean(s[f])}function Bt(s,l){for(var f=0;f<s.length;f++)l.writeFixed32(s[f])}function Kt(s,l){for(var f=0;f<s.length;f++)l.writeSFixed32(s[f])}function ur(s,l){for(var f=0;f<s.length;f++)l.writeFixed64(s[f])}function dr(s,l){for(var f=0;f<s.length;f++)l.writeSFixed64(s[f])}function pr(s,l){return(s[l]|s[l+1]<<8|s[l+2]<<16)+16777216*s[l+3]}function rr(s,l,f){s[f]=l,s[f+1]=l>>>8,s[f+2]=l>>>16,s[f+3]=l>>>24}function hr(s,l){return(s[l]|s[l+1]<<8|s[l+2]<<16)+(s[l+3]<<24)}function ar(s,l,f){s===1&&f.readMessage(vr,l)}function vr(s,l,f){if(s===3){var g=f.readMessage(lt,{}),w=g.width,S=g.height,C=g.left,L=g.top,z=g.advance;l.push({id:g.id,bitmap:new Lu({width:w+6,height:S+6},g.bitmap),metrics:{width:w,height:S,left:C,top:L,advance:z}})}}function lt(s,l,f){s===1?l.id=f.readVarint():s===2?l.bitmap=f.readBytes():s===3?l.width=f.readVarint():s===4?l.height=f.readVarint():s===5?l.left=f.readSVarint():s===6?l.top=f.readSVarint():s===7&&(l.advance=f.readVarint())}function Rt(s){for(var l=0,f=0,g=0,w=s;g<w.length;g+=1){var S=w[g];l+=S.w*S.h,f=Math.max(f,S.w)}s.sort(function(ke,Ze){return Ze.h-ke.h});for(var C=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(l/.95)),f),h:1/0}],L=0,z=0,$=0,W=s;$<W.length;$+=1)for(var K=W[$],ne=C.length-1;ne>=0;ne--){var le=C[ne];if(!(K.w>le.w||K.h>le.h)){if(K.x=le.x,K.y=le.y,z=Math.max(z,K.y+K.h),L=Math.max(L,K.x+K.w),K.w===le.w&&K.h===le.h){var Ie=C.pop();ne<C.length&&(C[ne]=Ie)}else K.h===le.h?(le.x+=K.w,le.w-=K.w):K.w===le.w?(le.y+=K.h,le.h-=K.h):(C.push({x:le.x+K.w,y:le.y,w:le.w-K.w,h:K.h}),le.y+=K.h,le.h-=K.h);break}}return{w:L,h:z,fill:l/(L*z)||0}}va.prototype={destroy:function(){this.buf=null},readFields:function(s,l,f){for(f=f||this.length;this.pos<f;){var g=this.readVarint(),w=g>>3,S=this.pos;this.type=7&g,s(w,l,this),this.pos===S&&this.skip(g)}return l},readMessage:function(s,l){return this.readFields(s,l,this.readVarint()+this.pos)},readFixed32:function(){var s=pr(this.buf,this.pos);return this.pos+=4,s},readSFixed32:function(){var s=hr(this.buf,this.pos);return this.pos+=4,s},readFixed64:function(){var s=pr(this.buf,this.pos)+4294967296*pr(this.buf,this.pos+4);return this.pos+=8,s},readSFixed64:function(){var s=pr(this.buf,this.pos)+4294967296*hr(this.buf,this.pos+4);return this.pos+=8,s},readFloat:function(){var s=bp(this.buf,this.pos,!0,23,4);return this.pos+=4,s},readDouble:function(){var s=bp(this.buf,this.pos,!0,52,8);return this.pos+=8,s},readVarint:function(s){var l,f,g=this.buf;return l=127&(f=g[this.pos++]),f<128?l:(l|=(127&(f=g[this.pos++]))<<7,f<128?l:(l|=(127&(f=g[this.pos++]))<<14,f<128?l:(l|=(127&(f=g[this.pos++]))<<21,f<128?l:function(w,S,C){var L,z,$=C.buf;if(L=(112&(z=$[C.pos++]))>>4,z<128||(L|=(127&(z=$[C.pos++]))<<3,z<128)||(L|=(127&(z=$[C.pos++]))<<10,z<128)||(L|=(127&(z=$[C.pos++]))<<17,z<128)||(L|=(127&(z=$[C.pos++]))<<24,z<128)||(L|=(1&(z=$[C.pos++]))<<31,z<128))return wp(w,L,S);throw new Error("Expected varint not more than 10 bytes")}(l|=(15&(f=g[this.pos]))<<28,s,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var s=this.readVarint();return s%2==1?(s+1)/-2:s/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var s=this.readVarint()+this.pos,l=this.pos;return this.pos=s,s-l>=12&&Zd?function(f,g,w){return Zd.decode(f.subarray(g,w))}(this.buf,l,s):function(f,g,w){for(var S="",C=g;C<w;){var L,z,$,W=f[C],K=null,ne=W>239?4:W>223?3:W>191?2:1;if(C+ne>w)break;ne===1?W<128&&(K=W):ne===2?(192&(L=f[C+1]))==128&&(K=(31&W)<<6|63&L)<=127&&(K=null):ne===3?(z=f[C+2],(192&(L=f[C+1]))==128&&(192&z)==128&&((K=(15&W)<<12|(63&L)<<6|63&z)<=2047||K>=55296&&K<=57343)&&(K=null)):ne===4&&(z=f[C+2],$=f[C+3],(192&(L=f[C+1]))==128&&(192&z)==128&&(192&$)==128&&((K=(15&W)<<18|(63&L)<<12|(63&z)<<6|63&$)<=65535||K>=1114112)&&(K=null)),K===null?(K=65533,ne=1):K>65535&&(K-=65536,S+=String.fromCharCode(K>>>10&1023|55296),K=56320|1023&K),S+=String.fromCharCode(K),C+=ne}return S}(this.buf,l,s)},readBytes:function(){var s=this.readVarint()+this.pos,l=this.buf.subarray(this.pos,s);return this.pos=s,l},readPackedVarint:function(s,l){if(this.type!==va.Bytes)return s.push(this.readVarint(l));var f=nu(this);for(s=s||[];this.pos<f;)s.push(this.readVarint(l));return s},readPackedSVarint:function(s){if(this.type!==va.Bytes)return s.push(this.readSVarint());var l=nu(this);for(s=s||[];this.pos<l;)s.push(this.readSVarint());return s},readPackedBoolean:function(s){if(this.type!==va.Bytes)return s.push(this.readBoolean());var l=nu(this);for(s=s||[];this.pos<l;)s.push(this.readBoolean());return s},readPackedFloat:function(s){if(this.type!==va.Bytes)return s.push(this.readFloat());var l=nu(this);for(s=s||[];this.pos<l;)s.push(this.readFloat());return s},readPackedDouble:function(s){if(this.type!==va.Bytes)return s.push(this.readDouble());var l=nu(this);for(s=s||[];this.pos<l;)s.push(this.readDouble());return s},readPackedFixed32:function(s){if(this.type!==va.Bytes)return s.push(this.readFixed32());var l=nu(this);for(s=s||[];this.pos<l;)s.push(this.readFixed32());return s},readPackedSFixed32:function(s){if(this.type!==va.Bytes)return s.push(this.readSFixed32());var l=nu(this);for(s=s||[];this.pos<l;)s.push(this.readSFixed32());return s},readPackedFixed64:function(s){if(this.type!==va.Bytes)return s.push(this.readFixed64());var l=nu(this);for(s=s||[];this.pos<l;)s.push(this.readFixed64());return s},readPackedSFixed64:function(s){if(this.type!==va.Bytes)return s.push(this.readSFixed64());var l=nu(this);for(s=s||[];this.pos<l;)s.push(this.readSFixed64());return s},skip:function(s){var l=7&s;if(l===va.Varint)for(;this.buf[this.pos++]>127;);else if(l===va.Bytes)this.pos=this.readVarint()+this.pos;else if(l===va.Fixed32)this.pos+=4;else{if(l!==va.Fixed64)throw new Error("Unimplemented type: "+l);this.pos+=8}},writeTag:function(s,l){this.writeVarint(s<<3|l)},realloc:function(s){for(var l=this.length||16;l<this.pos+s;)l*=2;if(l!==this.length){var f=new Uint8Array(l);f.set(this.buf),this.buf=f,this.length=l}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(s){this.realloc(4),rr(this.buf,s,this.pos),this.pos+=4},writeSFixed32:function(s){this.realloc(4),rr(this.buf,s,this.pos),this.pos+=4},writeFixed64:function(s){this.realloc(8),rr(this.buf,-1&s,this.pos),rr(this.buf,Math.floor(s*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(s){this.realloc(8),rr(this.buf,-1&s,this.pos),rr(this.buf,Math.floor(s*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(s){(s=+s||0)>268435455||s<0?function(l,f){var g,w;if(l>=0?(g=l%4294967296|0,w=l/4294967296|0):(w=~(-l/4294967296),4294967295^(g=~(-l%4294967296))?g=g+1|0:(g=0,w=w+1|0)),l>=18446744073709552e3||l<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");f.realloc(10),function(S,C,L){L.buf[L.pos++]=127&S|128,S>>>=7,L.buf[L.pos++]=127&S|128,S>>>=7,L.buf[L.pos++]=127&S|128,S>>>=7,L.buf[L.pos++]=127&S|128,L.buf[L.pos]=127&(S>>>=7)}(g,0,f),function(S,C){var L=(7&S)<<4;C.buf[C.pos++]|=L|((S>>>=3)?128:0),S&&(C.buf[C.pos++]=127&S|((S>>>=7)?128:0),S&&(C.buf[C.pos++]=127&S|((S>>>=7)?128:0),S&&(C.buf[C.pos++]=127&S|((S>>>=7)?128:0),S&&(C.buf[C.pos++]=127&S|((S>>>=7)?128:0),S&&(C.buf[C.pos++]=127&S)))))}(w,f)}(s,this):(this.realloc(4),this.buf[this.pos++]=127&s|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=s>>>7&127))))},writeSVarint:function(s){this.writeVarint(s<0?2*-s-1:2*s)},writeBoolean:function(s){this.writeVarint(!!s)},writeString:function(s){s=String(s),this.realloc(4*s.length),this.pos++;var l=this.pos;this.pos=function(g,w,S){for(var C,L,z=0;z<w.length;z++){if((C=w.charCodeAt(z))>55295&&C<57344){if(!L){C>56319||z+1===w.length?(g[S++]=239,g[S++]=191,g[S++]=189):L=C;continue}if(C<56320){g[S++]=239,g[S++]=191,g[S++]=189,L=C;continue}C=L-55296<<10|C-56320|65536,L=null}else L&&(g[S++]=239,g[S++]=191,g[S++]=189,L=null);C<128?g[S++]=C:(C<2048?g[S++]=C>>6|192:(C<65536?g[S++]=C>>12|224:(g[S++]=C>>18|240,g[S++]=C>>12&63|128),g[S++]=C>>6&63|128),g[S++]=63&C|128)}return S}(this.buf,s,this.pos);var f=this.pos-l;f>=128&&j(l,f,this),this.pos=l-1,this.writeVarint(f),this.pos+=f},writeFloat:function(s){this.realloc(4),Of(this.buf,s,this.pos,!0,23,4),this.pos+=4},writeDouble:function(s){this.realloc(8),Of(this.buf,s,this.pos,!0,52,8),this.pos+=8},writeBytes:function(s){var l=s.length;this.writeVarint(l),this.realloc(l);for(var f=0;f<l;f++)this.buf[this.pos++]=s[f]},writeRawMessage:function(s,l){this.pos++;var f=this.pos;s(l,this);var g=this.pos-f;g>=128&&j(f,g,this),this.pos=f-1,this.writeVarint(g),this.pos+=g},writeMessage:function(s,l,f){this.writeTag(s,va.Bytes),this.writeRawMessage(l,f)},writePackedVarint:function(s,l){l.length&&this.writeMessage(s,_e,l)},writePackedSVarint:function(s,l){l.length&&this.writeMessage(s,De,l)},writePackedBoolean:function(s,l){l.length&&this.writeMessage(s,xt,l)},writePackedFloat:function(s,l){l.length&&this.writeMessage(s,bt,l)},writePackedDouble:function(s,l){l.length&&this.writeMessage(s,Xt,l)},writePackedFixed32:function(s,l){l.length&&this.writeMessage(s,Bt,l)},writePackedSFixed32:function(s,l){l.length&&this.writeMessage(s,Kt,l)},writePackedFixed64:function(s,l){l.length&&this.writeMessage(s,ur,l)},writePackedSFixed64:function(s,l){l.length&&this.writeMessage(s,dr,l)},writeBytesField:function(s,l){this.writeTag(s,va.Bytes),this.writeBytes(l)},writeFixed32Field:function(s,l){this.writeTag(s,va.Fixed32),this.writeFixed32(l)},writeSFixed32Field:function(s,l){this.writeTag(s,va.Fixed32),this.writeSFixed32(l)},writeFixed64Field:function(s,l){this.writeTag(s,va.Fixed64),this.writeFixed64(l)},writeSFixed64Field:function(s,l){this.writeTag(s,va.Fixed64),this.writeSFixed64(l)},writeVarintField:function(s,l){this.writeTag(s,va.Varint),this.writeVarint(l)},writeSVarintField:function(s,l){this.writeTag(s,va.Varint),this.writeSVarint(l)},writeStringField:function(s,l){this.writeTag(s,va.Bytes),this.writeString(l)},writeFloatField:function(s,l){this.writeTag(s,va.Fixed32),this.writeFloat(l)},writeDoubleField:function(s,l){this.writeTag(s,va.Fixed64),this.writeDouble(l)},writeBooleanField:function(s,l){this.writeVarintField(s,!!l)}};var lr=function(s,l){var f=l.pixelRatio,g=l.version,w=l.stretchX,S=l.stretchY,C=l.content;this.paddedRect=s,this.pixelRatio=f,this.stretchX=w,this.stretchY=S,this.content=C,this.version=g},Br={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};Br.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},Br.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},Br.tlbr.get=function(){return this.tl.concat(this.br)},Br.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(lr.prototype,Br);var Zt=function(s,l){var f={},g={};this.haveRenderCallbacks=[];var w=[];this.addImages(s,f,w),this.addImages(l,g,w);var S=Rt(w),C=new gs({width:S.w||1,height:S.h||1});for(var L in s){var z=s[L],$=f[L].paddedRect;gs.copy(z.data,C,{x:0,y:0},{x:$.x+1,y:$.y+1},z.data)}for(var W in l){var K=l[W],ne=g[W].paddedRect,le=ne.x+1,Ie=ne.y+1,ke=K.data.width,Ze=K.data.height;gs.copy(K.data,C,{x:0,y:0},{x:le,y:Ie},K.data),gs.copy(K.data,C,{x:0,y:Ze-1},{x:le,y:Ie-1},{width:ke,height:1}),gs.copy(K.data,C,{x:0,y:0},{x:le,y:Ie+Ze},{width:ke,height:1}),gs.copy(K.data,C,{x:ke-1,y:0},{x:le-1,y:Ie},{width:1,height:Ze}),gs.copy(K.data,C,{x:0,y:0},{x:le+ke,y:Ie},{width:1,height:Ze})}this.image=C,this.iconPositions=f,this.patternPositions=g};Zt.prototype.addImages=function(s,l,f){for(var g in s){var w=s[g],S={x:0,y:0,w:w.data.width+2,h:w.data.height+2};f.push(S),l[g]=new lr(S,w),w.hasRenderCallback&&this.haveRenderCallbacks.push(g)}},Zt.prototype.patchUpdatedImages=function(s,l){for(var f in s.dispatchRenderCallbacks(this.haveRenderCallbacks),s.updatedImages)this.patchUpdatedImage(this.iconPositions[f],s.getImage(f),l),this.patchUpdatedImage(this.patternPositions[f],s.getImage(f),l)},Zt.prototype.patchUpdatedImage=function(s,l,f){if(s&&l&&s.version!==l.version){s.version=l.version;var g=s.tl;f.update(l.data,void 0,{x:g[0],y:g[1]})}},Jr("ImagePosition",lr),Jr("ImageAtlas",Zt);var br={horizontal:1,vertical:2,horizontalOnly:3},Lr=function(){this.scale=1,this.fontStack="",this.imageName=null};Lr.forText=function(s,l){var f=new Lr;return f.scale=s||1,f.fontStack=l,f},Lr.forImage=function(s){var l=new Lr;return l.imageName=s,l};var sn=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function Wt(s,l,f,g,w,S,C,L,z,$,W,K,ne,le,Ie,ke){var Ze,Ve=sn.fromFeature(s,w);K===br.vertical&&Ve.verticalizePunctuation();var st=Qs.processBidirectionalText,vt=Qs.processStyledBidirectionalText;if(st&&Ve.sections.length===1){Ze=[];for(var Tt=0,It=st(Ve.toString(),Gn(Ve,$,S,l,g,le,Ie));Tt<It.length;Tt+=1){var Yt=It[Tt],gr=new sn;gr.text=Yt,gr.sections=Ve.sections;for(var Or=0;Or<Yt.length;Or++)gr.sectionIndex.push(0);Ze.push(gr)}}else if(vt){Ze=[];for(var Cn=0,qr=vt(Ve.text,Ve.sectionIndex,Gn(Ve,$,S,l,g,le,Ie));Cn<qr.length;Cn+=1){var In=qr[Cn],tn=new sn;tn.text=In[0],tn.sectionIndex=In[1],tn.sections=Ve.sections,Ze.push(tn)}}else Ze=function(vn,xi){for(var ai=[],Bi=vn.text,Rn=0,ta=0,eo=xi;ta<eo.length;ta+=1){var to=eo[ta];ai.push(vn.substring(Rn,to)),Rn=to}return Rn<Bi.length&&ai.push(vn.substring(Rn,Bi.length)),ai}(Ve,Gn(Ve,$,S,l,g,le,Ie));var hi=[],jn={positionedLines:hi,text:Ve.toString(),top:W[1],bottom:W[1],left:W[0],right:W[0],writingMode:K,iconsInText:!1,verticalizable:!1};return function(vn,xi,ai,Bi,Rn,ta,eo,to,Wa,ro,Ao,$o){for(var Ko=0,iu=-17,xs=0,au=0,ko=to==="right"?1:to==="left"?0:.5,bs=0,Ri=0,La=Rn;Ri<La.length;Ri+=1){var xa=La[Ri];xa.trim();var Yi=xa.getMaxScale(),wu=24*(Yi-1),zs={positionedGlyphs:[],lineOffset:0};vn.positionedLines[bs]=zs;var Xa=zs.positionedGlyphs,Aa=0;if(xa.length()){for(var Us=0;Us<xa.length();Us++){var ra=xa.getSection(Us),Nu=xa.getSectionIndex(Us),ni=xa.getCharCode(Us),Df=0,oa=null,Ya=null,Ic=null,Ql=24,pd=!(Wa===br.horizontal||!Ao&&!xo(ni)||Ao&&(jt[ni]||(Lc=ni,Nr.Arabic(Lc)||Nr["Arabic Supplement"](Lc)||Nr["Arabic Extended-A"](Lc)||Nr["Arabic Presentation Forms-A"](Lc)||Nr["Arabic Presentation Forms-B"](Lc))));if(ra.imageName){var Jd=Bi[ra.imageName];if(!Jd)continue;Ic=ra.imageName,vn.iconsInText=vn.iconsInText||!0,Ya=Jd.paddedRect;var Fh=Jd.displaySize;ra.scale=24*ra.scale/$o,Df=wu+(24-Fh[1]*ra.scale),Ql=(oa={width:Fh[0],height:Fh[1],left:1,top:-3,advance:pd?Fh[1]:Fh[0]}).advance;var ev=pd?Fh[0]*ra.scale-24*Yi:Fh[1]*ra.scale-24*Yi;ev>0&&ev>Aa&&(Aa=ev)}else{var Jm=ai[ra.fontStack],Sp=Jm&&Jm[ni];if(Sp&&Sp.rect)Ya=Sp.rect,oa=Sp.metrics;else{var im=xi[ra.fontStack],Rc=im&&im[ni];if(!Rc)continue;oa=Rc.metrics}Df=24*(Yi-ra.scale)}pd?(vn.verticalizable=!0,Xa.push({glyph:ni,imageName:Ic,x:Ko,y:iu+Df,vertical:pd,scale:ra.scale,fontStack:ra.fontStack,sectionIndex:Nu,metrics:oa,rect:Ya}),Ko+=Ql*ra.scale+ro):(Xa.push({glyph:ni,imageName:Ic,x:Ko,y:iu+Df,vertical:pd,scale:ra.scale,fontStack:ra.fontStack,sectionIndex:Nu,metrics:oa,rect:Ya}),Ko+=oa.advance*ra.scale+ro)}Xa.length!==0&&(xs=Math.max(Ko-ro,xs),Gr(Xa,0,Xa.length-1,ko,Aa)),Ko=0;var am=ta*Yi+Aa;zs.lineOffset=Math.max(Aa,wu),iu+=am,au=Math.max(am,au),++bs}else iu+=ta,++bs}var Lc,vo=iu- -17,mo=Vn(eo),Nh=mo.horizontalAlign,tv=mo.verticalAlign;(function(e0,t0,om,sm,r0,rv,Bh,dd,n0){var vd,md=(t0-om)*r0;vd=rv!==Bh?-dd*sm- -17:(-sm*n0+.5)*Bh;for(var ou=0,Ff=e0;ou<Ff.length;ou+=1)for(var gd=0,um=Ff[ou].positionedGlyphs;gd<um.length;gd+=1){var nv=um[gd];nv.x+=md,nv.y+=vd}})(vn.positionedLines,ko,Nh,tv,xs,au,ta,vo,Rn.length),vn.top+=-tv*vo,vn.bottom=vn.top+vo,vn.left+=-Nh*xs,vn.right=vn.left+xs}(jn,l,f,g,Ze,C,L,z,K,$,ne,ke),!function(vn){for(var xi=0,ai=vn;xi<ai.length;xi+=1)if(ai[xi].positionedGlyphs.length!==0)return!1;return!0}(hi)&&jn}sn.fromFeature=function(s,l){for(var f=new sn,g=0;g<s.sections.length;g++){var w=s.sections[g];w.image?f.addImageSection(w):f.addTextSection(w,l)}return f},sn.prototype.length=function(){return this.text.length},sn.prototype.getSection=function(s){return this.sections[this.sectionIndex[s]]},sn.prototype.getSectionIndex=function(s){return this.sectionIndex[s]},sn.prototype.getCharCode=function(s){return this.text.charCodeAt(s)},sn.prototype.verticalizePunctuation=function(){this.text=function(s){for(var l="",f=0;f<s.length;f++){var g=s.charCodeAt(f+1)||null,w=s.charCodeAt(f-1)||null;l+=g&&xc(g)&&!kh[s[f+1]]||w&&xc(w)&&!kh[s[f-1]]||!kh[s[f]]?s[f]:kh[s[f]]}return l}(this.text)},sn.prototype.trim=function(){for(var s=0,l=0;l<this.text.length&&jt[this.text.charCodeAt(l)];l++)s++;for(var f=this.text.length,g=this.text.length-1;g>=0&&g>=s&&jt[this.text.charCodeAt(g)];g--)f--;this.text=this.text.substring(s,f),this.sectionIndex=this.sectionIndex.slice(s,f)},sn.prototype.substring=function(s,l){var f=new sn;return f.text=this.text.substring(s,l),f.sectionIndex=this.sectionIndex.slice(s,l),f.sections=this.sections,f},sn.prototype.toString=function(){return this.text},sn.prototype.getMaxScale=function(){var s=this;return this.sectionIndex.reduce(function(l,f){return Math.max(l,s.sections[f].scale)},0)},sn.prototype.addTextSection=function(s,l){this.text+=s.text,this.sections.push(Lr.forText(s.scale,s.fontStack||l));for(var f=this.sections.length-1,g=0;g<s.text.length;++g)this.sectionIndex.push(f)},sn.prototype.addImageSection=function(s){var l=s.image?s.image.name:"";if(l.length!==0){var f=this.getNextImageSectionCharCode();f?(this.text+=String.fromCharCode(f),this.sections.push(Lr.forImage(l)),this.sectionIndex.push(this.sections.length-1)):Se("Reached maximum number of images 6401")}else Se("Can't add FormattedSection with an empty image.")},sn.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var jt={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},kr={};function Pr(s,l,f,g,w,S){if(l.imageName){var C=g[l.imageName];return C?C.displaySize[0]*l.scale*24/S+w:0}var L=f[l.fontStack],z=L&&L[s];return z?z.metrics.advance*l.scale+w:0}function fr(s,l,f,g){var w=Math.pow(s-l,2);return g?s<l?w/2:2*w:w+Math.abs(f)*f}function zr(s,l,f){var g=0;return s===10&&(g-=1e4),f&&(g+=150),s!==40&&s!==65288||(g+=50),l!==41&&l!==65289||(g+=50),g}function Vr(s,l,f,g,w,S){for(var C=null,L=fr(l,f,w,S),z=0,$=g;z<$.length;z+=1){var W=$[z],K=fr(l-W.x,f,w,S)+W.badness;K<=L&&(C=W,L=K)}return{index:s,x:l,priorBreak:C,badness:L}}function Gn(s,l,f,g,w,S,C){if(S!=="point")return[];if(!s)return[];for(var L,z=[],$=function(Ze,Ve,st,vt,Tt,It){for(var Yt=0,gr=0;gr<Ze.length();gr++){var Or=Ze.getSection(gr);Yt+=Pr(Ze.getCharCode(gr),Or,vt,Tt,Ve,It)}return Yt/Math.max(1,Math.ceil(Yt/st))}(s,l,f,g,w,C),W=s.text.indexOf("​")>=0,K=0,ne=0;ne<s.length();ne++){var le=s.getSection(ne),Ie=s.getCharCode(ne);if(jt[Ie]||(K+=Pr(Ie,le,g,w,l,C)),ne<s.length()-1){var ke=!((L=Ie)<11904||!(Nr["Bopomofo Extended"](L)||Nr.Bopomofo(L)||Nr["CJK Compatibility Forms"](L)||Nr["CJK Compatibility Ideographs"](L)||Nr["CJK Compatibility"](L)||Nr["CJK Radicals Supplement"](L)||Nr["CJK Strokes"](L)||Nr["CJK Symbols and Punctuation"](L)||Nr["CJK Unified Ideographs Extension A"](L)||Nr["CJK Unified Ideographs"](L)||Nr["Enclosed CJK Letters and Months"](L)||Nr["Halfwidth and Fullwidth Forms"](L)||Nr.Hiragana(L)||Nr["Ideographic Description Characters"](L)||Nr["Kangxi Radicals"](L)||Nr["Katakana Phonetic Extensions"](L)||Nr.Katakana(L)||Nr["Vertical Forms"](L)||Nr["Yi Radicals"](L)||Nr["Yi Syllables"](L)));(kr[Ie]||ke||le.imageName)&&z.push(Vr(ne+1,K,$,z,zr(Ie,s.getCharCode(ne+1),ke&&W),!1))}}return function Ze(Ve){return Ve?Ze(Ve.priorBreak).concat(Ve.index):[]}(Vr(s.length(),K,$,z,0,!0))}function Vn(s){var l=.5,f=.5;switch(s){case"right":case"top-right":case"bottom-right":l=1;break;case"left":case"top-left":case"bottom-left":l=0}switch(s){case"bottom":case"bottom-right":case"bottom-left":f=1;break;case"top":case"top-right":case"top-left":f=0}return{horizontalAlign:l,verticalAlign:f}}function Gr(s,l,f,g,w){if(g||w)for(var S=s[f],C=(s[f].x+S.metrics.advance*S.scale)*g,L=l;L<=f;L++)s[L].x-=C,s[L].y+=w}function Xr(s,l,f,g,w,S){var C,L=s.image;if(L.content){var z=L.content,$=L.pixelRatio||1;C=[z[0]/$,z[1]/$,L.displaySize[0]-z[2]/$,L.displaySize[1]-z[3]/$]}var W,K,ne,le,Ie=l.left*S,ke=l.right*S;f==="width"||f==="both"?(le=w[0]+Ie-g[3],K=w[0]+ke+g[1]):K=(le=w[0]+(Ie+ke-L.displaySize[0])/2)+L.displaySize[0];var Ze=l.top*S,Ve=l.bottom*S;return f==="height"||f==="both"?(W=w[1]+Ze-g[0],ne=w[1]+Ve+g[2]):ne=(W=w[1]+(Ze+Ve-L.displaySize[1])/2)+L.displaySize[1],{image:L,top:W,right:K,bottom:ne,left:le,collisionPadding:C}}kr[10]=!0,kr[32]=!0,kr[38]=!0,kr[40]=!0,kr[41]=!0,kr[43]=!0,kr[45]=!0,kr[47]=!0,kr[173]=!0,kr[183]=!0,kr[8203]=!0,kr[8208]=!0,kr[8211]=!0,kr[8231]=!0;var Pn=function(s){function l(f,g,w,S){s.call(this,f,g),this.angle=w,S!==void 0&&(this.segment=S)}return s&&(l.__proto__=s),(l.prototype=Object.create(s&&s.prototype)).constructor=l,l.prototype.clone=function(){return new l(this.x,this.y,this.angle,this.segment)},l}(y);function Wn(s,l){var f=l.expression;if(f.kind==="constant")return{kind:"constant",layoutSize:f.evaluate(new Bn(s+1))};if(f.kind==="source")return{kind:"source"};for(var g=f.zoomStops,w=f.interpolationType,S=0;S<g.length&&g[S]<=s;)S++;for(var C=S=Math.max(0,S-1);C<g.length&&g[C]<s+1;)C++;C=Math.min(g.length-1,C);var L=g[S],z=g[C];return f.kind==="composite"?{kind:"composite",minZoom:L,maxZoom:z,interpolationType:w}:{kind:"camera",minZoom:L,maxZoom:z,minSize:f.evaluate(new Bn(L)),maxSize:f.evaluate(new Bn(z)),interpolationType:w}}function Jn(s,l,f){var g=l.uSize,w=f.lowerSize;return s.kind==="source"?w/128:s.kind==="composite"?ao(w/128,f.upperSize/128,l.uSizeT):g}function _a(s,l){var f=0,g=0;if(s.kind==="constant")g=s.layoutSize;else if(s.kind!=="source"){var w=s.interpolationType,S=w?D(Ho.interpolationFactor(w,l,s.minZoom,s.maxZoom),0,1):0;s.kind==="camera"?g=ao(s.minSize,s.maxSize,S):f=S}return{uSizeT:f,uSize:g}}Jr("Anchor",Pn);var po=Object.freeze({__proto__:null,getSizeData:Wn,evaluateSizeForFeature:Jn,evaluateSizeForZoom:_a,SIZE_PACK_FACTOR:128});function gi(s,l,f,g,w){if(l.segment===void 0)return!0;for(var S=l,C=l.segment+1,L=0;L>-f/2;){if(--C<0)return!1;L-=s[C].dist(S),S=s[C]}L+=s[C].dist(s[C+1]),C++;for(var z=[],$=0;L<f/2;){var W=s[C],K=s[C+1];if(!K)return!1;var ne=s[C-1].angleTo(W)-W.angleTo(K);for(ne=Math.abs((ne+3*Math.PI)%(2*Math.PI)-Math.PI),z.push({distance:L,angleDelta:ne}),$+=ne;L-z[0].distance>g;)$-=z.shift().angleDelta;if($>w)return!1;C++,L+=W.dist(K)}return!0}function ss(s){for(var l=0,f=0;f<s.length-1;f++)l+=s[f].dist(s[f+1]);return l}function Ba(s,l,f){return s?.6*l*f:0}function Uo(s,l){return Math.max(s?s.right-s.left:0,l?l.right-l.left:0)}function Lo(s,l,f,g,w,S){for(var C=Ba(f,w,S),L=Uo(f,g)*S,z=0,$=ss(s)/2,W=0;W<s.length-1;W++){var K=s[W],ne=s[W+1],le=K.dist(ne);if(z+le>$){var Ie=($-z)/le,ke=ao(K.x,ne.x,Ie),Ze=ao(K.y,ne.y,Ie),Ve=new Pn(ke,Ze,ne.angleTo(K),W);return Ve._round(),!C||gi(s,Ve,L,C,l)?Ve:void 0}z+=le}}function us(s,l,f,g,w,S,C,L,z){var $=Ba(g,S,C),W=Uo(g,w),K=W*C,ne=s[0].x===0||s[0].x===z||s[0].y===0||s[0].y===z;return l-K<l/4&&(l=K+l/4),function le(Ie,ke,Ze,Ve,st,vt,Tt,It,Yt){for(var gr=vt/2,Or=ss(Ie),Cn=0,qr=ke-Ze,In=[],tn=0;tn<Ie.length-1;tn++){for(var hi=Ie[tn],jn=Ie[tn+1],vn=hi.dist(jn),xi=jn.angleTo(hi);qr+Ze<Cn+vn;){var ai=((qr+=Ze)-Cn)/vn,Bi=ao(hi.x,jn.x,ai),Rn=ao(hi.y,jn.y,ai);if(Bi>=0&&Bi<Yt&&Rn>=0&&Rn<Yt&&qr-gr>=0&&qr+gr<=Or){var ta=new Pn(Bi,Rn,xi,tn);ta._round(),Ve&&!gi(Ie,ta,vt,Ve,st)||In.push(ta)}}Cn+=vn}return It||In.length||Tt||(In=le(Ie,Cn/2,Ze,Ve,st,vt,Tt,!0,Yt)),In}(s,ne?l/2*L%l:(W/2+2*S)*C*L%l,l,$,f,K,ne,!1,z)}function ls(s,l,f,g,w){for(var S=[],C=0;C<s.length;C++)for(var L=s[C],z=void 0,$=0;$<L.length-1;$++){var W=L[$],K=L[$+1];W.x<l&&K.x<l||(W.x<l?W=new y(l,W.y+(l-W.x)/(K.x-W.x)*(K.y-W.y))._round():K.x<l&&(K=new y(l,W.y+(l-W.x)/(K.x-W.x)*(K.y-W.y))._round()),W.y<f&&K.y<f||(W.y<f?W=new y(W.x+(f-W.y)/(K.y-W.y)*(K.x-W.x),f)._round():K.y<f&&(K=new y(W.x+(f-W.y)/(K.y-W.y)*(K.x-W.x),f)._round()),W.x>=g&&K.x>=g||(W.x>=g?W=new y(g,W.y+(g-W.x)/(K.x-W.x)*(K.y-W.y))._round():K.x>=g&&(K=new y(g,W.y+(g-W.x)/(K.x-W.x)*(K.y-W.y))._round()),W.y>=w&&K.y>=w||(W.y>=w?W=new y(W.x+(w-W.y)/(K.y-W.y)*(K.x-W.x),w)._round():K.y>=w&&(K=new y(W.x+(w-W.y)/(K.y-W.y)*(K.x-W.x),w)._round()),z&&W.equals(z[z.length-1])||S.push(z=[W]),z.push(K)))))}return S}function ys(s,l,f,g){var w=[],S=s.image,C=S.pixelRatio,L=S.paddedRect.w-2,z=S.paddedRect.h-2,$=s.right-s.left,W=s.bottom-s.top,K=S.stretchX||[[0,L]],ne=S.stretchY||[[0,z]],le=function(Bi,Rn){return Bi+Rn[1]-Rn[0]},Ie=K.reduce(le,0),ke=ne.reduce(le,0),Ze=L-Ie,Ve=z-ke,st=0,vt=Ie,Tt=0,It=ke,Yt=0,gr=Ze,Or=0,Cn=Ve;if(S.content&&g){var qr=S.content;st=so(K,0,qr[0]),Tt=so(ne,0,qr[1]),vt=so(K,qr[0],qr[2]),It=so(ne,qr[1],qr[3]),Yt=qr[0]-st,Or=qr[1]-Tt,gr=qr[2]-qr[0]-vt,Cn=qr[3]-qr[1]-It}var In=function(Bi,Rn,ta,eo){var to=Vo(Bi.stretch-st,vt,$,s.left),Wa=Zi(Bi.fixed-Yt,gr,Bi.stretch,Ie),ro=Vo(Rn.stretch-Tt,It,W,s.top),Ao=Zi(Rn.fixed-Or,Cn,Rn.stretch,ke),$o=Vo(ta.stretch-st,vt,$,s.left),Ko=Zi(ta.fixed-Yt,gr,ta.stretch,Ie),iu=Vo(eo.stretch-Tt,It,W,s.top),xs=Zi(eo.fixed-Or,Cn,eo.stretch,ke),au=new y(to,ro),ko=new y($o,ro),bs=new y($o,iu),Ri=new y(to,iu),La=new y(Wa/C,Ao/C),xa=new y(Ko/C,xs/C),Yi=l*Math.PI/180;if(Yi){var wu=Math.sin(Yi),zs=Math.cos(Yi),Xa=[zs,-wu,wu,zs];au._matMult(Xa),ko._matMult(Xa),Ri._matMult(Xa),bs._matMult(Xa)}var Aa=Bi.stretch+Bi.fixed,Us=Rn.stretch+Rn.fixed;return{tl:au,tr:ko,bl:Ri,br:bs,tex:{x:S.paddedRect.x+1+Aa,y:S.paddedRect.y+1+Us,w:ta.stretch+ta.fixed-Aa,h:eo.stretch+eo.fixed-Us},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:La,pixelOffsetBR:xa,minFontScaleX:gr/C/$,minFontScaleY:Cn/C/W,isSDF:f}};if(g&&(S.stretchX||S.stretchY))for(var tn=ui(K,Ze,Ie),hi=ui(ne,Ve,ke),jn=0;jn<tn.length-1;jn++)for(var vn=tn[jn],xi=tn[jn+1],ai=0;ai<hi.length-1;ai++)w.push(In(vn,hi[ai],xi,hi[ai+1]));else w.push(In({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:L+1},{fixed:0,stretch:z+1}));return w}function so(s,l,f){for(var g=0,w=0,S=s;w<S.length;w+=1){var C=S[w];g+=Math.max(l,Math.min(f,C[1]))-Math.max(l,Math.min(f,C[0]))}return g}function ui(s,l,f){for(var g=[{fixed:-1,stretch:0}],w=0,S=s;w<S.length;w+=1){var C=S[w],L=C[0],z=C[1],$=g[g.length-1];g.push({fixed:L-$.stretch,stretch:$.stretch}),g.push({fixed:L-$.stretch,stretch:$.stretch+(z-L)})}return g.push({fixed:l+1,stretch:f}),g}function Vo(s,l,f,g){return s/l*f+g}function Zi(s,l,f,g){return s-l*f/g}var So=function(s,l,f,g,w,S,C,L,z,$){if(this.boxStartIndex=s.length,z){var W=S.top,K=S.bottom,ne=S.collisionPadding;ne&&(W-=ne[1],K+=ne[3]);var le=K-W;le>0&&(le=Math.max(10,le),this.circleDiameter=le)}else{var Ie=S.top*C-L,ke=S.bottom*C+L,Ze=S.left*C-L,Ve=S.right*C+L,st=S.collisionPadding;if(st&&(Ze-=st[0]*C,Ie-=st[1]*C,Ve+=st[2]*C,ke+=st[3]*C),$){var vt=new y(Ze,Ie),Tt=new y(Ve,Ie),It=new y(Ze,ke),Yt=new y(Ve,ke),gr=$*Math.PI/180;vt._rotate(gr),Tt._rotate(gr),It._rotate(gr),Yt._rotate(gr),Ze=Math.min(vt.x,Tt.x,It.x,Yt.x),Ve=Math.max(vt.x,Tt.x,It.x,Yt.x),Ie=Math.min(vt.y,Tt.y,It.y,Yt.y),ke=Math.max(vt.y,Tt.y,It.y,Yt.y)}s.emplaceBack(l.x,l.y,Ze,Ie,Ve,ke,f,g,w)}this.boxEndIndex=s.length},kn=function(s,l){if(s===void 0&&(s=[]),l===void 0&&(l=yi),this.data=s,this.length=this.data.length,this.compare=l,this.length>0)for(var f=(this.length>>1)-1;f>=0;f--)this._down(f)};function yi(s,l){return s<l?-1:s>l?1:0}function Sa(s,l,f){l===void 0&&(l=1),f===void 0&&(f=!1);for(var g=1/0,w=1/0,S=-1/0,C=-1/0,L=s[0],z=0;z<L.length;z++){var $=L[z];(!z||$.x<g)&&(g=$.x),(!z||$.y<w)&&(w=$.y),(!z||$.x>S)&&(S=$.x),(!z||$.y>C)&&(C=$.y)}var W=Math.min(S-g,C-w),K=W/2,ne=new kn([],jo);if(W===0)return new y(g,w);for(var le=g;le<S;le+=W)for(var Ie=w;Ie<C;Ie+=W)ne.push(new Du(le+K,Ie+K,K,s));for(var ke=function(st){for(var vt=0,Tt=0,It=0,Yt=st[0],gr=0,Or=Yt.length,Cn=Or-1;gr<Or;Cn=gr++){var qr=Yt[gr],In=Yt[Cn],tn=qr.x*In.y-In.x*qr.y;Tt+=(qr.x+In.x)*tn,It+=(qr.y+In.y)*tn,vt+=3*tn}return new Du(Tt/vt,It/vt,0,st)}(s),Ze=ne.length;ne.length;){var Ve=ne.pop();(Ve.d>ke.d||!ke.d)&&(ke=Ve),Ve.max-ke.d<=l||(ne.push(new Du(Ve.p.x-(K=Ve.h/2),Ve.p.y-K,K,s)),ne.push(new Du(Ve.p.x+K,Ve.p.y-K,K,s)),ne.push(new Du(Ve.p.x-K,Ve.p.y+K,K,s)),ne.push(new Du(Ve.p.x+K,Ve.p.y+K,K,s)),Ze+=4)}return ke.p}function jo(s,l){return l.max-s.max}function Du(s,l,f,g){this.p=new y(s,l),this.h=f,this.d=function(w,S){for(var C=!1,L=1/0,z=0;z<S.length;z++)for(var $=S[z],W=0,K=$.length,ne=K-1;W<K;ne=W++){var le=$[W],Ie=$[ne];le.y>w.y!=Ie.y>w.y&&w.x<(Ie.x-le.x)*(w.y-le.y)/(Ie.y-le.y)+le.x&&(C=!C),L=Math.min(L,Yl(w,le,Ie))}return(C?1:-1)*Math.sqrt(L)}(this.p,g),this.max=this.d+this.h*Math.SQRT2}kn.prototype.push=function(s){this.data.push(s),this.length++,this._up(this.length-1)},kn.prototype.pop=function(){if(this.length!==0){var s=this.data[0],l=this.data.pop();return this.length--,this.length>0&&(this.data[0]=l,this._down(0)),s}},kn.prototype.peek=function(){return this.data[0]},kn.prototype._up=function(s){for(var l=this.data,f=this.compare,g=l[s];s>0;){var w=s-1>>1,S=l[w];if(f(g,S)>=0)break;l[s]=S,s=w}l[s]=g},kn.prototype._down=function(s){for(var l=this.data,f=this.compare,g=this.length>>1,w=l[s];s<g;){var S=1+(s<<1),C=l[S],L=S+1;if(L<this.length&&f(l[L],C)<0&&(S=L,C=l[L]),f(C,w)>=0)break;l[s]=C,s=S}l[s]=w};var Pe=Number.POSITIVE_INFINITY;function St(s,l){return l[1]!==Pe?function(f,g,w){var S=0,C=0;switch(g=Math.abs(g),w=Math.abs(w),f){case"top-right":case"top-left":case"top":C=w-7;break;case"bottom-right":case"bottom-left":case"bottom":C=7-w}switch(f){case"top-right":case"bottom-right":case"right":S=-g;break;case"top-left":case"bottom-left":case"left":S=g}return[S,C]}(s,l[0],l[1]):function(f,g){var w=0,S=0;g<0&&(g=0);var C=g/Math.sqrt(2);switch(f){case"top-right":case"top-left":S=C-7;break;case"bottom-right":case"bottom-left":S=7-C;break;case"bottom":S=7-g;break;case"top":S=g-7}switch(f){case"top-right":case"bottom-right":w=-C;break;case"top-left":case"bottom-left":w=C;break;case"left":w=g;break;case"right":w=-g}return[w,S]}(s,l[0])}function pt(s){switch(s){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function en(s,l,f,g,w,S,C,L,z,$,W,K,ne,le,Ie){var ke=function(Tt,It,Yt,gr,Or,Cn,qr,In){for(var tn=gr.layout.get("text-rotate").evaluate(Cn,{})*Math.PI/180,hi=[],jn=0,vn=It.positionedLines;jn<vn.length;jn+=1)for(var xi=vn[jn],ai=0,Bi=xi.positionedGlyphs;ai<Bi.length;ai+=1){var Rn=Bi[ai];if(Rn.rect){var ta=Rn.rect||{},eo=4,to=!0,Wa=1,ro=0,Ao=(Or||In)&&Rn.vertical,$o=Rn.metrics.advance*Rn.scale/2;if(In&&It.verticalizable&&(ro=xi.lineOffset/2-(Rn.imageName?-(24-Rn.metrics.width*Rn.scale)/2:24*(Rn.scale-1))),Rn.imageName){var Ko=qr[Rn.imageName];to=Ko.sdf,eo=1/(Wa=Ko.pixelRatio)}var iu=Or?[Rn.x+$o,Rn.y]:[0,0],xs=Or?[0,0]:[Rn.x+$o+Yt[0],Rn.y+Yt[1]-ro],au=[0,0];Ao&&(au=xs,xs=[0,0]);var ko=(Rn.metrics.left-eo)*Rn.scale-$o+xs[0],bs=(-Rn.metrics.top-eo)*Rn.scale+xs[1],Ri=ko+ta.w*Rn.scale/Wa,La=bs+ta.h*Rn.scale/Wa,xa=new y(ko,bs),Yi=new y(Ri,bs),wu=new y(ko,La),zs=new y(Ri,La);if(Ao){var Xa=new y(-$o,$o- -17),Aa=-Math.PI/2,Us=12-$o,ra=new y(22-Us,-(Rn.imageName?Us:0)),Nu=new(Function.prototype.bind.apply(y,[null].concat(au)));xa._rotateAround(Aa,Xa)._add(ra)._add(Nu),Yi._rotateAround(Aa,Xa)._add(ra)._add(Nu),wu._rotateAround(Aa,Xa)._add(ra)._add(Nu),zs._rotateAround(Aa,Xa)._add(ra)._add(Nu)}if(tn){var ni=Math.sin(tn),Df=Math.cos(tn),oa=[Df,-ni,ni,Df];xa._matMult(oa),Yi._matMult(oa),wu._matMult(oa),zs._matMult(oa)}var Ya=new y(0,0),Ic=new y(0,0);hi.push({tl:xa,tr:Yi,bl:wu,br:zs,tex:ta,writingMode:It.writingMode,glyphOffset:iu,sectionIndex:Rn.sectionIndex,isSDF:to,pixelOffsetTL:Ya,pixelOffsetBR:Ic,minFontScaleX:0,minFontScaleY:0})}}return hi}(0,f,L,w,S,C,g,s.allowVerticalPlacement),Ze=s.textSizeData,Ve=null;Ze.kind==="source"?(Ve=[128*w.layout.get("text-size").evaluate(C,{})])[0]>32640&&Se(s.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):Ze.kind==="composite"&&((Ve=[128*le.compositeTextSizes[0].evaluate(C,{},Ie),128*le.compositeTextSizes[1].evaluate(C,{},Ie)])[0]>32640||Ve[1]>32640)&&Se(s.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),s.addSymbols(s.text,ke,Ve,L,S,C,$,l,z.lineStartIndex,z.lineLength,ne,Ie);for(var st=0,vt=W;st<vt.length;st+=1)K[vt[st]]=s.text.placedSymbolArray.length-1;return 4*ke.length}function _i(s){for(var l in s)return s[l];return null}function Ae(s,l,f,g){var w=s.compareText;if(l in w){for(var S=w[l],C=S.length-1;C>=0;C--)if(g.dist(S[C])<f)return!0}else w[l]=[];return w[l].push(g),!1}var fe=Rl.VectorTileFeature.types,Ue=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ut(s,l,f,g,w,S,C,L,z,$,W,K,ne){var le=L?Math.min(32640,Math.round(L[0])):0,Ie=L?Math.min(32640,Math.round(L[1])):0;s.emplaceBack(l,f,Math.round(32*g),Math.round(32*w),S,C,(le<<1)+(z?1:0),Ie,16*$,16*W,256*K,256*ne)}function Et(s,l,f){s.emplaceBack(l.x,l.y,f),s.emplaceBack(l.x,l.y,f),s.emplaceBack(l.x,l.y,f),s.emplaceBack(l.x,l.y,f)}function Je(s){for(var l=0,f=s.sections;l<f.length;l+=1)if(_h(f[l].text))return!0;return!1}var We=function(s){this.layoutVertexArray=new Sh,this.indexArray=new Ec,this.programConfigurations=s,this.segments=new ve,this.dynamicLayoutVertexArray=new Qc,this.opacityVertexArray=new Ah,this.placedSymbolArray=new _};We.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},We.prototype.upload=function(s,l,f,g){this.isEmpty()||(f&&(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,Zm.members),this.indexBuffer=s.createIndexBuffer(this.indexArray,l),this.dynamicLayoutVertexBuffer=s.createVertexBuffer(this.dynamicLayoutVertexArray,Km.members,!0),this.opacityVertexBuffer=s.createVertexBuffer(this.opacityVertexArray,Ue,!0),this.opacityVertexBuffer.itemSize=1),(f||g)&&this.programConfigurations.upload(s))},We.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},Jr("SymbolBuffers",We);var tt=function(s,l,f){this.layoutVertexArray=new s,this.layoutAttributes=l,this.indexArray=new f,this.segments=new ve,this.collisionVertexArray=new ed};tt.prototype.upload=function(s){this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=s.createVertexBuffer(this.collisionVertexArray,Rg.members,!0)},tt.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},Jr("CollisionBuffers",tt);var he=function(s){this.collisionBoxArray=s.collisionBoxArray,this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(function(S){return S.id}),this.index=s.index,this.pixelRatio=s.pixelRatio,this.sourceLayerIndex=s.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Bs([]),this.placementViewportMatrix=Bs([]);var l=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Wn(this.zoom,l["text-size"]),this.iconSizeData=Wn(this.zoom,l["icon-size"]);var f=this.layers[0].layout,g=f.get("symbol-sort-key"),w=f.get("symbol-z-order");this.canOverlap=f.get("text-allow-overlap")||f.get("icon-allow-overlap")||f.get("text-ignore-placement")||f.get("icon-ignore-placement"),this.sortFeaturesByKey=w!=="viewport-y"&&g.constantOr(1)!==void 0,this.sortFeaturesByY=(w==="viewport-y"||w==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,f.get("symbol-placement")==="point"&&(this.writingModes=f.get("text-writing-mode").map(function(S){return br[S]})),this.stateDependentLayerIds=this.layers.filter(function(S){return S.isStateDependent()}).map(function(S){return S.id}),this.sourceID=s.sourceID};he.prototype.createArrays=function(){this.text=new We(new pn(this.layers,this.zoom,function(s){return/^text/.test(s)})),this.icon=new We(new pn(this.layers,this.zoom,function(s){return/^icon/.test(s)})),this.glyphOffsetArray=new R,this.lineVertexArray=new B,this.symbolInstances=new M},he.prototype.calculateGlyphDependencies=function(s,l,f,g,w){for(var S=0;S<s.length;S++)if(l[s.charCodeAt(S)]=!0,(f||g)&&w){var C=kh[s.charAt(S)];C&&(l[C.charCodeAt(0)]=!0)}},he.prototype.populate=function(s,l,f){var g=this.layers[0],w=g.layout,S=w.get("text-font"),C=w.get("text-field"),L=w.get("icon-image"),z=(C.value.kind!=="constant"||C.value.value instanceof Ma&&!C.value.value.isEmpty()||C.value.value.toString().length>0)&&(S.value.kind!=="constant"||S.value.value.length>0),$=L.value.kind!=="constant"||!!L.value.value||Object.keys(L.parameters).length>0,W=w.get("symbol-sort-key");if(this.features=[],z||$){for(var K=l.iconDependencies,ne=l.glyphDependencies,le=l.availableImages,Ie=new Bn(this.zoom),ke=0,Ze=s;ke<Ze.length;ke+=1){var Ve=Ze[ke],st=Ve.feature,vt=Ve.id,Tt=Ve.index,It=Ve.sourceLayerIndex,Yt=g._featureFilter.needGeometry,gr=Ea(st,Yt);if(g._featureFilter.filter(Ie,gr,f)){Yt||(gr.geometry=Ia(st));var Or=void 0;if(z){var Cn=g.getValueAndResolveTokens("text-field",gr,f,le),qr=Ma.factory(Cn);Je(qr)&&(this.hasRTLText=!0),(!this.hasRTLText||Eh()==="unavailable"||this.hasRTLText&&Qs.isParsed())&&(Or=em(qr,g,gr))}var In=void 0;if($){var tn=g.getValueAndResolveTokens("icon-image",gr,f,le);In=tn instanceof Go?tn:Go.fromString(tn)}if(Or||In){var hi=this.sortFeaturesByKey?W.evaluate(gr,{},f):void 0;if(this.features.push({id:vt,text:Or,icon:In,index:Tt,sourceLayerIndex:It,geometry:gr.geometry,properties:st.properties,type:fe[st.type],sortKey:hi}),In&&(K[In.name]=!0),Or){var jn=S.evaluate(gr,{},f).join(","),vn=w.get("text-rotation-alignment")==="map"&&w.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(br.vertical)>=0;for(var xi=0,ai=Or.sections;xi<ai.length;xi+=1){var Bi=ai[xi];if(Bi.image)K[Bi.image.name]=!0;else{var Rn=Ju(Or.toString()),ta=Bi.fontStack||jn,eo=ne[ta]=ne[ta]||{};this.calculateGlyphDependencies(Bi.text,eo,vn,this.allowVerticalPlacement,Rn)}}}}}}w.get("symbol-placement")==="line"&&(this.features=function(to){var Wa={},ro={},Ao=[],$o=0;function Ko(Xa){Ao.push(to[Xa]),$o++}function iu(Xa,Aa,Us){var ra=ro[Xa];return delete ro[Xa],ro[Aa]=ra,Ao[ra].geometry[0].pop(),Ao[ra].geometry[0]=Ao[ra].geometry[0].concat(Us[0]),ra}function xs(Xa,Aa,Us){var ra=Wa[Aa];return delete Wa[Aa],Wa[Xa]=ra,Ao[ra].geometry[0].shift(),Ao[ra].geometry[0]=Us[0].concat(Ao[ra].geometry[0]),ra}function au(Xa,Aa,Us){var ra=Us?Aa[0][Aa[0].length-1]:Aa[0][0];return Xa+":"+ra.x+":"+ra.y}for(var ko=0;ko<to.length;ko++){var bs=to[ko],Ri=bs.geometry,La=bs.text?bs.text.toString():null;if(La){var xa=au(La,Ri),Yi=au(La,Ri,!0);if(xa in ro&&Yi in Wa&&ro[xa]!==Wa[Yi]){var wu=xs(xa,Yi,Ri),zs=iu(xa,Yi,Ao[wu].geometry);delete Wa[xa],delete ro[Yi],ro[au(La,Ao[zs].geometry,!0)]=zs,Ao[wu].geometry=null}else xa in ro?iu(xa,Yi,Ri):Yi in Wa?xs(xa,Yi,Ri):(Ko(ko),Wa[xa]=$o-1,ro[Yi]=$o-1)}else Ko(ko)}return Ao.filter(function(Xa){return Xa.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(to,Wa){return to.sortKey-Wa.sortKey})}},he.prototype.update=function(s,l,f){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(s,l,this.layers,f),this.icon.programConfigurations.updatePaintArrays(s,l,this.layers,f))},he.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},he.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},he.prototype.upload=function(s){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(s),this.iconCollisionBox.upload(s)),this.text.upload(s,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(s,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},he.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},he.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},he.prototype.addToLineVertexArray=function(s,l){var f=this.lineVertexArray.length;if(s.segment!==void 0){for(var g=s.dist(l[s.segment+1]),w=s.dist(l[s.segment]),S={},C=s.segment+1;C<l.length;C++)S[C]={x:l[C].x,y:l[C].y,tileUnitDistanceFromAnchor:g},C<l.length-1&&(g+=l[C+1].dist(l[C]));for(var L=s.segment||0;L>=0;L--)S[L]={x:l[L].x,y:l[L].y,tileUnitDistanceFromAnchor:w},L>0&&(w+=l[L-1].dist(l[L]));for(var z=0;z<l.length;z++){var $=S[z];this.lineVertexArray.emplaceBack($.x,$.y,$.tileUnitDistanceFromAnchor)}}return{lineStartIndex:f,lineLength:this.lineVertexArray.length-f}},he.prototype.addSymbols=function(s,l,f,g,w,S,C,L,z,$,W,K){for(var ne=s.indexArray,le=s.layoutVertexArray,Ie=s.segments.prepareSegment(4*l.length,le,ne,this.canOverlap?S.sortKey:void 0),ke=this.glyphOffsetArray.length,Ze=Ie.vertexLength,Ve=this.allowVerticalPlacement&&C===br.vertical?Math.PI/2:0,st=S.text&&S.text.sections,vt=0;vt<l.length;vt++){var Tt=l[vt],It=Tt.tl,Yt=Tt.tr,gr=Tt.bl,Or=Tt.br,Cn=Tt.tex,qr=Tt.pixelOffsetTL,In=Tt.pixelOffsetBR,tn=Tt.minFontScaleX,hi=Tt.minFontScaleY,jn=Tt.glyphOffset,vn=Tt.isSDF,xi=Tt.sectionIndex,ai=Ie.vertexLength,Bi=jn[1];ut(le,L.x,L.y,It.x,Bi+It.y,Cn.x,Cn.y,f,vn,qr.x,qr.y,tn,hi),ut(le,L.x,L.y,Yt.x,Bi+Yt.y,Cn.x+Cn.w,Cn.y,f,vn,In.x,qr.y,tn,hi),ut(le,L.x,L.y,gr.x,Bi+gr.y,Cn.x,Cn.y+Cn.h,f,vn,qr.x,In.y,tn,hi),ut(le,L.x,L.y,Or.x,Bi+Or.y,Cn.x+Cn.w,Cn.y+Cn.h,f,vn,In.x,In.y,tn,hi),Et(s.dynamicLayoutVertexArray,L,Ve),ne.emplaceBack(ai,ai+1,ai+2),ne.emplaceBack(ai+1,ai+2,ai+3),Ie.vertexLength+=4,Ie.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(jn[0]),vt!==l.length-1&&xi===l[vt+1].sectionIndex||s.programConfigurations.populatePaintArrays(le.length,S,S.index,{},K,st&&st[xi])}s.placedSymbolArray.emplaceBack(L.x,L.y,ke,this.glyphOffsetArray.length-ke,Ze,z,$,L.segment,f?f[0]:0,f?f[1]:0,g[0],g[1],C,0,!1,0,W)},he.prototype._addCollisionDebugVertex=function(s,l,f,g,w,S){return l.emplaceBack(0,0),s.emplaceBack(f.x,f.y,g,w,Math.round(S.x),Math.round(S.y))},he.prototype.addCollisionDebugVertices=function(s,l,f,g,w,S,C){var L=w.segments.prepareSegment(4,w.layoutVertexArray,w.indexArray),z=L.vertexLength,$=w.layoutVertexArray,W=w.collisionVertexArray,K=C.anchorX,ne=C.anchorY;this._addCollisionDebugVertex($,W,S,K,ne,new y(s,l)),this._addCollisionDebugVertex($,W,S,K,ne,new y(f,l)),this._addCollisionDebugVertex($,W,S,K,ne,new y(f,g)),this._addCollisionDebugVertex($,W,S,K,ne,new y(s,g)),L.vertexLength+=4;var le=w.indexArray;le.emplaceBack(z,z+1),le.emplaceBack(z+1,z+2),le.emplaceBack(z+2,z+3),le.emplaceBack(z+3,z),L.primitiveLength+=4},he.prototype.addDebugCollisionBoxes=function(s,l,f,g){for(var w=s;w<l;w++){var S=this.collisionBoxArray.get(w);this.addCollisionDebugVertices(S.x1,S.y1,S.x2,S.y2,g?this.textCollisionBox:this.iconCollisionBox,S.anchorPoint,f)}},he.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new tt(Tf,Mc.members,ef),this.iconCollisionBox=new tt(Tf,Mc.members,ef);for(var s=0;s<this.symbolInstances.length;s++){var l=this.symbolInstances.get(s);this.addDebugCollisionBoxes(l.textBoxStartIndex,l.textBoxEndIndex,l,!0),this.addDebugCollisionBoxes(l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l,!0),this.addDebugCollisionBoxes(l.iconBoxStartIndex,l.iconBoxEndIndex,l,!1),this.addDebugCollisionBoxes(l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex,l,!1)}},he.prototype._deserializeCollisionBoxesForSymbol=function(s,l,f,g,w,S,C,L,z){for(var $={},W=l;W<f;W++){var K=s.get(W);$.textBox={x1:K.x1,y1:K.y1,x2:K.x2,y2:K.y2,anchorPointX:K.anchorPointX,anchorPointY:K.anchorPointY},$.textFeatureIndex=K.featureIndex;break}for(var ne=g;ne<w;ne++){var le=s.get(ne);$.verticalTextBox={x1:le.x1,y1:le.y1,x2:le.x2,y2:le.y2,anchorPointX:le.anchorPointX,anchorPointY:le.anchorPointY},$.verticalTextFeatureIndex=le.featureIndex;break}for(var Ie=S;Ie<C;Ie++){var ke=s.get(Ie);$.iconBox={x1:ke.x1,y1:ke.y1,x2:ke.x2,y2:ke.y2,anchorPointX:ke.anchorPointX,anchorPointY:ke.anchorPointY},$.iconFeatureIndex=ke.featureIndex;break}for(var Ze=L;Ze<z;Ze++){var Ve=s.get(Ze);$.verticalIconBox={x1:Ve.x1,y1:Ve.y1,x2:Ve.x2,y2:Ve.y2,anchorPointX:Ve.anchorPointX,anchorPointY:Ve.anchorPointY},$.verticalIconFeatureIndex=Ve.featureIndex;break}return $},he.prototype.deserializeCollisionBoxes=function(s){this.collisionArrays=[];for(var l=0;l<this.symbolInstances.length;l++){var f=this.symbolInstances.get(l);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(s,f.textBoxStartIndex,f.textBoxEndIndex,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f.iconBoxStartIndex,f.iconBoxEndIndex,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex))}},he.prototype.hasTextData=function(){return this.text.segments.get().length>0},he.prototype.hasIconData=function(){return this.icon.segments.get().length>0},he.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},he.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},he.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},he.prototype.addIndicesForPlacedSymbol=function(s,l){for(var f=s.placedSymbolArray.get(l),g=f.vertexStartIndex+4*f.numGlyphs,w=f.vertexStartIndex;w<g;w+=4)s.indexArray.emplaceBack(w,w+1,w+2),s.indexArray.emplaceBack(w+1,w+2,w+3)},he.prototype.getSortedSymbolIndexes=function(s){if(this.sortedAngle===s&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var l=Math.sin(s),f=Math.cos(s),g=[],w=[],S=[],C=0;C<this.symbolInstances.length;++C){S.push(C);var L=this.symbolInstances.get(C);g.push(0|Math.round(l*L.anchorX+f*L.anchorY)),w.push(L.featureIndex)}return S.sort(function(z,$){return g[z]-g[$]||w[$]-w[z]}),S},he.prototype.addToSortKeyRanges=function(s,l){var f=this.sortKeyRanges[this.sortKeyRanges.length-1];f&&f.sortKey===l?f.symbolInstanceEnd=s+1:this.sortKeyRanges.push({sortKey:l,symbolInstanceStart:s,symbolInstanceEnd:s+1})},he.prototype.sortFeatures=function(s){var l=this;if(this.sortFeaturesByY&&this.sortedAngle!==s&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(s),this.sortedAngle=s,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var f=0,g=this.symbolInstanceIndexes;f<g.length;f+=1){var w=this.symbolInstances.get(g[f]);this.featureSortOrder.push(w.featureIndex),[w.rightJustifiedTextSymbolIndex,w.centerJustifiedTextSymbolIndex,w.leftJustifiedTextSymbolIndex].forEach(function(S,C,L){S>=0&&L.indexOf(S)===C&&l.addIndicesForPlacedSymbol(l.text,S)}),w.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,w.verticalPlacedTextSymbolIndex),w.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,w.placedIconSymbolIndex),w.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,w.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},Jr("SymbolBucket",he,{omit:["layers","collisionBoxArray","features","compareText"]}),he.MAX_GLYPHS=65535,he.addDynamicAttributes=Et;var je=new Xo({"symbol-placement":new _n(de.layout_symbol["symbol-placement"]),"symbol-spacing":new _n(de.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new _n(de.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new on(de.layout_symbol["symbol-sort-key"]),"symbol-z-order":new _n(de.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new _n(de.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new _n(de.layout_symbol["icon-ignore-placement"]),"icon-optional":new _n(de.layout_symbol["icon-optional"]),"icon-rotation-alignment":new _n(de.layout_symbol["icon-rotation-alignment"]),"icon-size":new on(de.layout_symbol["icon-size"]),"icon-text-fit":new _n(de.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new _n(de.layout_symbol["icon-text-fit-padding"]),"icon-image":new on(de.layout_symbol["icon-image"]),"icon-rotate":new on(de.layout_symbol["icon-rotate"]),"icon-padding":new _n(de.layout_symbol["icon-padding"]),"icon-keep-upright":new _n(de.layout_symbol["icon-keep-upright"]),"icon-offset":new on(de.layout_symbol["icon-offset"]),"icon-anchor":new on(de.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new _n(de.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new _n(de.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new _n(de.layout_symbol["text-rotation-alignment"]),"text-field":new on(de.layout_symbol["text-field"]),"text-font":new on(de.layout_symbol["text-font"]),"text-size":new on(de.layout_symbol["text-size"]),"text-max-width":new on(de.layout_symbol["text-max-width"]),"text-line-height":new _n(de.layout_symbol["text-line-height"]),"text-letter-spacing":new on(de.layout_symbol["text-letter-spacing"]),"text-justify":new on(de.layout_symbol["text-justify"]),"text-radial-offset":new on(de.layout_symbol["text-radial-offset"]),"text-variable-anchor":new _n(de.layout_symbol["text-variable-anchor"]),"text-anchor":new on(de.layout_symbol["text-anchor"]),"text-max-angle":new _n(de.layout_symbol["text-max-angle"]),"text-writing-mode":new _n(de.layout_symbol["text-writing-mode"]),"text-rotate":new on(de.layout_symbol["text-rotate"]),"text-padding":new _n(de.layout_symbol["text-padding"]),"text-keep-upright":new _n(de.layout_symbol["text-keep-upright"]),"text-transform":new on(de.layout_symbol["text-transform"]),"text-offset":new on(de.layout_symbol["text-offset"]),"text-allow-overlap":new _n(de.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new _n(de.layout_symbol["text-ignore-placement"]),"text-optional":new _n(de.layout_symbol["text-optional"])}),Te={paint:new Xo({"icon-opacity":new on(de.paint_symbol["icon-opacity"]),"icon-color":new on(de.paint_symbol["icon-color"]),"icon-halo-color":new on(de.paint_symbol["icon-halo-color"]),"icon-halo-width":new on(de.paint_symbol["icon-halo-width"]),"icon-halo-blur":new on(de.paint_symbol["icon-halo-blur"]),"icon-translate":new _n(de.paint_symbol["icon-translate"]),"icon-translate-anchor":new _n(de.paint_symbol["icon-translate-anchor"]),"text-opacity":new on(de.paint_symbol["text-opacity"]),"text-color":new on(de.paint_symbol["text-color"],{runtimeType:Dr,getOverride:function(s){return s.textColor},hasOverride:function(s){return!!s.textColor}}),"text-halo-color":new on(de.paint_symbol["text-halo-color"]),"text-halo-width":new on(de.paint_symbol["text-halo-width"]),"text-halo-blur":new on(de.paint_symbol["text-halo-blur"]),"text-translate":new _n(de.paint_symbol["text-translate"]),"text-translate-anchor":new _n(de.paint_symbol["text-translate-anchor"])}),layout:je},at=function(s){this.type=s.property.overrides?s.property.overrides.runtimeType:nn,this.defaultValue=s};at.prototype.evaluate=function(s){if(s.formattedSection){var l=this.defaultValue.property.overrides;if(l&&l.hasOverride(s.formattedSection))return l.getOverride(s.formattedSection)}return s.feature&&s.featureState?this.defaultValue.evaluate(s.feature,s.featureState):this.defaultValue.property.specification.default},at.prototype.eachChild=function(s){this.defaultValue.isConstant()||s(this.defaultValue.value._styleExpression.expression)},at.prototype.outputDefined=function(){return!1},at.prototype.serialize=function(){return null},Jr("FormatSectionOverride",at,{omit:["defaultValue"]});var dt=function(s){function l(f){s.call(this,f,Te)}return s&&(l.__proto__=s),(l.prototype=Object.create(s&&s.prototype)).constructor=l,l.prototype.recalculate=function(f,g){if(s.prototype.recalculate.call(this,f,g),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var w=this.layout.get("text-writing-mode");if(w){for(var S=[],C=0,L=w;C<L.length;C+=1){var z=L[C];S.indexOf(z)<0&&S.push(z)}this.layout._values["text-writing-mode"]=S}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},l.prototype.getValueAndResolveTokens=function(f,g,w,S){var C=this.layout.get(f).evaluate(g,{},w,S),L=this._unevaluatedLayout._values[f];return L.isDataDriven()||Zc(L.value)||!C?C:function(z,$){return $.replace(/{([^{}]+)}/g,function(W,K){return K in z?String(z[K]):""})}(g.properties,C)},l.prototype.createBucket=function(f){return new he(f)},l.prototype.queryRadius=function(){return 0},l.prototype.queryIntersectsFeature=function(){return!1},l.prototype._setPaintOverrides=function(){for(var f=0,g=Te.paint.overridableProperties;f<g.length;f+=1){var w=g[f];if(l.hasPaintOverride(this.layout,w)){var S,C=this.paint.get(w),L=new at(C),z=new bl(L,C.property.specification);S=C.value.kind==="constant"||C.value.kind==="source"?new wl("source",z):new mc("composite",z,C.value.zoomStops,C.value._interpolationType),this.paint._values[w]=new ho(C.property,S,C.parameters)}}},l.prototype._handleOverridablePaintPropertyUpdate=function(f,g,w){return!(!this.layout||g.isDataDriven()||w.isDataDriven())&&l.hasPaintOverride(this.layout,f)},l.hasPaintOverride=function(f,g){var w=f.get("text-field"),S=Te.paint.properties[g],C=!1,L=function(W){for(var K=0,ne=W;K<ne.length;K+=1)if(S.overrides&&S.overrides.hasOverride(ne[K]))return void(C=!0)};if(w.value.kind==="constant"&&w.value.value instanceof Ma)L(w.value.value.sections);else if(w.value.kind==="source"){var z=function(W){C||(W instanceof Po&&Wi(W.value)===Oi?L(W.value.sections):W instanceof hs?L(W.sections):W.eachChild(z))},$=w.value;$._styleExpression&&z($._styleExpression.expression)}return C},l}(tl),Qt={paint:new Xo({"background-color":new _n(de.paint_background["background-color"]),"background-pattern":new Bo(de.paint_background["background-pattern"]),"background-opacity":new _n(de.paint_background["background-opacity"])})},Tr=function(s){function l(f){s.call(this,f,Qt)}return s&&(l.__proto__=s),(l.prototype=Object.create(s&&s.prototype)).constructor=l,l}(tl),Cr={paint:new Xo({"raster-opacity":new _n(de.paint_raster["raster-opacity"]),"raster-hue-rotate":new _n(de.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new _n(de.paint_raster["raster-brightness-min"]),"raster-brightness-max":new _n(de.paint_raster["raster-brightness-max"]),"raster-saturation":new _n(de.paint_raster["raster-saturation"]),"raster-contrast":new _n(de.paint_raster["raster-contrast"]),"raster-resampling":new _n(de.paint_raster["raster-resampling"]),"raster-fade-duration":new _n(de.paint_raster["raster-fade-duration"])})},Hr=function(s){function l(f){s.call(this,f,Cr)}return s&&(l.__proto__=s),(l.prototype=Object.create(s&&s.prototype)).constructor=l,l}(tl),wr=function(s){function l(f){s.call(this,f,{}),this.implementation=f}return s&&(l.__proto__=s),(l.prototype=Object.create(s&&s.prototype)).constructor=l,l.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},l.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},l.prototype.recalculate=function(){},l.prototype.updateTransitions=function(){},l.prototype.hasTransition=function(){},l.prototype.serialize=function(){},l.prototype.onAdd=function(f){this.implementation.onAdd&&this.implementation.onAdd(f,f.painter.context.gl)},l.prototype.onRemove=function(f){this.implementation.onRemove&&this.implementation.onRemove(f,f.painter.context.gl)},l}(tl),dn={circle:Mf,heatmap:nd,hillshade:Pf,fill:ru,"fill-extrusion":of,line:Ym,symbol:dt,background:Tr,raster:Hr},Qr=E.HTMLImageElement,un=E.HTMLCanvasElement,ln=E.HTMLVideoElement,fn=E.ImageData,Un=E.ImageBitmap,aa=function(s,l,f,g){this.context=s,this.format=f,this.texture=s.gl.createTexture(),this.update(l,g)};aa.prototype.update=function(s,l,f){var g=s.width,w=s.height,S=!(this.size&&this.size[0]===g&&this.size[1]===w||f),C=this.context,L=C.gl;if(this.useMipmap=!!(l&&l.useMipmap),L.bindTexture(L.TEXTURE_2D,this.texture),C.pixelStoreUnpackFlipY.set(!1),C.pixelStoreUnpack.set(1),C.pixelStoreUnpackPremultiplyAlpha.set(this.format===L.RGBA&&(!l||l.premultiply!==!1)),S)this.size=[g,w],s instanceof Qr||s instanceof un||s instanceof ln||s instanceof fn||Un&&s instanceof Un?L.texImage2D(L.TEXTURE_2D,0,this.format,this.format,L.UNSIGNED_BYTE,s):L.texImage2D(L.TEXTURE_2D,0,this.format,g,w,0,this.format,L.UNSIGNED_BYTE,s.data);else{var z=f||{x:0,y:0},$=z.x,W=z.y;s instanceof Qr||s instanceof un||s instanceof ln||s instanceof fn||Un&&s instanceof Un?L.texSubImage2D(L.TEXTURE_2D,0,$,W,L.RGBA,L.UNSIGNED_BYTE,s):L.texSubImage2D(L.TEXTURE_2D,0,$,W,g,w,L.RGBA,L.UNSIGNED_BYTE,s.data)}this.useMipmap&&this.isSizePowerOfTwo()&&L.generateMipmap(L.TEXTURE_2D)},aa.prototype.bind=function(s,l,f){var g=this.context.gl;g.bindTexture(g.TEXTURE_2D,this.texture),f!==g.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(f=g.LINEAR),s!==this.filter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,s),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,f||s),this.filter=s),l!==this.wrap&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,l),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,l),this.wrap=l)},aa.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},aa.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var qo=function(s){var l=this;this._callback=s,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){l._triggered=!1,l._callback()})};qo.prototype.trigger=function(){var s=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){s._triggered=!1,s._callback()},0))},qo.prototype.remove=function(){delete this._channel,this._callback=function(){}};var Fu=function(s,l,f){this.target=s,this.parent=l,this.mapId=f,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},Y(["receive","process"],this),this.invoker=new qo(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Be()?s:E};function Pc(s,l,f){var g=2*Math.PI*6378137/256/Math.pow(2,f);return[s*g-2*Math.PI*6378137/2,l*g-2*Math.PI*6378137/2]}Fu.prototype.send=function(s,l,f,g,w){var S=this;w===void 0&&(w=!1);var C=Math.round(1e18*Math.random()).toString(36).substring(0,10);f&&(this.callbacks[C]=f);var L=mt(this.globalScope)?void 0:[];return this.target.postMessage({id:C,type:s,hasCallback:!!f,targetMapId:g,mustQueue:w,sourceMapId:this.mapId,data:hu(l,L)},L),{cancel:function(){f&&delete S.callbacks[C],S.target.postMessage({id:C,type:"<cancel>",targetMapId:g,sourceMapId:S.mapId})}}},Fu.prototype.receive=function(s){var l=s.data,f=l.id;if(f&&(!l.targetMapId||this.mapId===l.targetMapId))if(l.type==="<cancel>"){delete this.tasks[f];var g=this.cancelCallbacks[f];delete this.cancelCallbacks[f],g&&g()}else Be()||l.mustQueue?(this.tasks[f]=l,this.taskQueue.push(f),this.invoker.trigger()):this.processTask(f,l)},Fu.prototype.process=function(){if(this.taskQueue.length){var s=this.taskQueue.shift(),l=this.tasks[s];delete this.tasks[s],this.taskQueue.length&&this.invoker.trigger(),l&&this.processTask(s,l)}},Fu.prototype.processTask=function(s,l){var f=this;if(l.type==="<response>"){var g=this.callbacks[s];delete this.callbacks[s],g&&(l.error?g(ns(l.error)):g(null,ns(l.data)))}else{var w=!1,S=mt(this.globalScope)?void 0:[],C=l.hasCallback?function(W,K){w=!0,delete f.cancelCallbacks[s],f.target.postMessage({id:s,type:"<response>",sourceMapId:f.mapId,error:W?hu(W):null,data:hu(K,S)},S)}:function(W){w=!0},L=null,z=ns(l.data);if(this.parent[l.type])L=this.parent[l.type](l.sourceMapId,z,C);else if(this.parent.getWorkerSource){var $=l.type.split(".");L=this.parent.getWorkerSource(l.sourceMapId,$[0],z.source)[$[1]](z,C)}else C(new Error("Could not find function "+l.type));!w&&L&&L.cancel&&(this.cancelCallbacks[s]=L.cancel)}},Fu.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var Ra=function(s,l){s&&(l?this.setSouthWest(s).setNorthEast(l):s.length===4?this.setSouthWest([s[0],s[1]]).setNorthEast([s[2],s[3]]):this.setSouthWest(s[0]).setNorthEast(s[1]))};Ra.prototype.setNorthEast=function(s){return this._ne=s instanceof Pi?new Pi(s.lng,s.lat):Pi.convert(s),this},Ra.prototype.setSouthWest=function(s){return this._sw=s instanceof Pi?new Pi(s.lng,s.lat):Pi.convert(s),this},Ra.prototype.extend=function(s){var l,f,g=this._sw,w=this._ne;if(s instanceof Pi)l=s,f=s;else{if(!(s instanceof Ra))return Array.isArray(s)?s.length===4||s.every(Array.isArray)?this.extend(Ra.convert(s)):this.extend(Pi.convert(s)):this;if(f=s._ne,!(l=s._sw)||!f)return this}return g||w?(g.lng=Math.min(l.lng,g.lng),g.lat=Math.min(l.lat,g.lat),w.lng=Math.max(f.lng,w.lng),w.lat=Math.max(f.lat,w.lat)):(this._sw=new Pi(l.lng,l.lat),this._ne=new Pi(f.lng,f.lat)),this},Ra.prototype.getCenter=function(){return new Pi((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},Ra.prototype.getSouthWest=function(){return this._sw},Ra.prototype.getNorthEast=function(){return this._ne},Ra.prototype.getNorthWest=function(){return new Pi(this.getWest(),this.getNorth())},Ra.prototype.getSouthEast=function(){return new Pi(this.getEast(),this.getSouth())},Ra.prototype.getWest=function(){return this._sw.lng},Ra.prototype.getSouth=function(){return this._sw.lat},Ra.prototype.getEast=function(){return this._ne.lng},Ra.prototype.getNorth=function(){return this._ne.lat},Ra.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},Ra.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},Ra.prototype.isEmpty=function(){return!(this._sw&&this._ne)},Ra.prototype.contains=function(s){var l=Pi.convert(s),f=l.lng,g=l.lat,w=this._sw.lng<=f&&f<=this._ne.lng;return this._sw.lng>this._ne.lng&&(w=this._sw.lng>=f&&f>=this._ne.lng),this._sw.lat<=g&&g<=this._ne.lat&&w},Ra.convert=function(s){return!s||s instanceof Ra?s:new Ra(s)};var Pi=function(s,l){if(isNaN(s)||isNaN(l))throw new Error("Invalid LngLat object: ("+s+", "+l+")");if(this.lng=+s,this.lat=+l,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};Pi.prototype.wrap=function(){return new Pi(V(this.lng,-180,180),this.lat)},Pi.prototype.toArray=function(){return[this.lng,this.lat]},Pi.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},Pi.prototype.distanceTo=function(s){var l=Math.PI/180,f=this.lat*l,g=s.lat*l,w=Math.sin(f)*Math.sin(g)+Math.cos(f)*Math.cos(g)*Math.cos((s.lng-this.lng)*l);return 63710088e-1*Math.acos(Math.min(w,1))},Pi.prototype.toBounds=function(s){s===void 0&&(s=0);var l=360*s/40075017,f=l/Math.cos(Math.PI/180*this.lat);return new Ra(new Pi(this.lng-f,this.lat-l),new Pi(this.lng+f,this.lat+l))},Pi.convert=function(s){if(s instanceof Pi)return s;if(Array.isArray(s)&&(s.length===2||s.length===3))return new Pi(Number(s[0]),Number(s[1]));if(!Array.isArray(s)&&typeof s=="object"&&s!==null)return new Pi(Number("lng"in s?s.lng:s.lon),Number(s.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var Kl=2*Math.PI*63710088e-1;function fl(s){return Kl*Math.cos(s*Math.PI/180)}function cd(s){return(180+s)/360}function hl(s){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s*Math.PI/360)))/360}function tm(s,l){return s/fl(l)}function Lg(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}var fd=function(s,l,f){f===void 0&&(f=0),this.x=+s,this.y=+l,this.z=+f};fd.fromLngLat=function(s,l){l===void 0&&(l=0);var f=Pi.convert(s);return new fd(cd(f.lng),hl(f.lat),tm(l,f.lat))},fd.prototype.toLngLat=function(){return new Pi(360*this.x-180,Lg(this.y))},fd.prototype.toAltitude=function(){return this.z*fl(Lg(this.y))},fd.prototype.meterInMercatorCoordinateUnits=function(){return 1/Kl*(s=Lg(this.y),1/Math.cos(s*Math.PI/180));var s};var hd=function(s,l,f){this.z=s,this.x=l,this.y=f,this.key=rm(0,s,s,l,f)};hd.prototype.equals=function(s){return this.z===s.z&&this.x===s.x&&this.y===s.y},hd.prototype.url=function(s,l){var f,g,w,S,C,L=(g=this.y,w=this.z,S=Pc(256*(f=this.x),256*(g=Math.pow(2,w)-g-1),w),C=Pc(256*(f+1),256*(g+1),w),S[0]+","+S[1]+","+C[0]+","+C[1]),z=function($,W,K){for(var ne,le="",Ie=$;Ie>0;Ie--)le+=(W&(ne=1<<Ie-1)?1:0)+(K&ne?2:0);return le}(this.z,this.x,this.y);return s[(this.x+this.y)%s.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(l==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",z).replace("{bbox-epsg-3857}",L)},hd.prototype.getTilePoint=function(s){var l=Math.pow(2,this.z);return new y(8192*(s.x*l-this.x),8192*(s.y*l-this.y))},hd.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var M_=function(s,l){this.wrap=s,this.canonical=l,this.key=rm(s,l.z,l.z,l.x,l.y)},Zo=function(s,l,f,g,w){this.overscaledZ=s,this.wrap=l,this.canonical=new hd(f,+g,+w),this.key=rm(l,s,f,g,w)};function rm(s,l,f,g,w){(s*=2)<0&&(s=-1*s-1);var S=1<<f;return(S*S*s+S*w+g).toString(36)+f.toString(36)+l.toString(36)}Zo.prototype.equals=function(s){return this.overscaledZ===s.overscaledZ&&this.wrap===s.wrap&&this.canonical.equals(s.canonical)},Zo.prototype.scaledTo=function(s){var l=this.canonical.z-s;return s>this.canonical.z?new Zo(s,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Zo(s,this.wrap,s,this.canonical.x>>l,this.canonical.y>>l)},Zo.prototype.calculateScaledKey=function(s,l){var f=this.canonical.z-s;return s>this.canonical.z?rm(this.wrap*+l,s,this.canonical.z,this.canonical.x,this.canonical.y):rm(this.wrap*+l,s,s,this.canonical.x>>f,this.canonical.y>>f)},Zo.prototype.isChildOf=function(s){if(s.wrap!==this.wrap)return!1;var l=this.canonical.z-s.canonical.z;return s.overscaledZ===0||s.overscaledZ<this.overscaledZ&&s.canonical.x===this.canonical.x>>l&&s.canonical.y===this.canonical.y>>l},Zo.prototype.children=function(s){if(this.overscaledZ>=s)return[new Zo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var l=this.canonical.z+1,f=2*this.canonical.x,g=2*this.canonical.y;return[new Zo(l,this.wrap,l,f,g),new Zo(l,this.wrap,l,f+1,g),new Zo(l,this.wrap,l,f,g+1),new Zo(l,this.wrap,l,f+1,g+1)]},Zo.prototype.isLessThan=function(s){return this.wrap<s.wrap||!(this.wrap>s.wrap)&&(this.overscaledZ<s.overscaledZ||!(this.overscaledZ>s.overscaledZ)&&(this.canonical.x<s.canonical.x||!(this.canonical.x>s.canonical.x)&&this.canonical.y<s.canonical.y))},Zo.prototype.wrapped=function(){return new Zo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},Zo.prototype.unwrapTo=function(s){return new Zo(this.overscaledZ,s,this.canonical.z,this.canonical.x,this.canonical.y)},Zo.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},Zo.prototype.toUnwrapped=function(){return new M_(this.wrap,this.canonical)},Zo.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},Zo.prototype.getTilePoint=function(s){return this.canonical.getTilePoint(new fd(s.x-this.wrap,s.y))},Jr("CanonicalTileID",hd),Jr("OverscaledTileID",Zo,{omit:["posMatrix"]});var Oh=function(s,l,f){if(this.uid=s,l.height!==l.width)throw new RangeError("DEM tiles must be square");if(f&&f!=="mapbox"&&f!=="terrarium")return Se('"'+f+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=l.height;var g=this.dim=l.height-2;this.data=new Uint32Array(l.data.buffer),this.encoding=f||"mapbox";for(var w=0;w<g;w++)this.data[this._idx(-1,w)]=this.data[this._idx(0,w)],this.data[this._idx(g,w)]=this.data[this._idx(g-1,w)],this.data[this._idx(w,-1)]=this.data[this._idx(w,0)],this.data[this._idx(w,g)]=this.data[this._idx(w,g-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(g,-1)]=this.data[this._idx(g-1,0)],this.data[this._idx(-1,g)]=this.data[this._idx(0,g-1)],this.data[this._idx(g,g)]=this.data[this._idx(g-1,g-1)]};Oh.prototype.get=function(s,l){var f=new Uint8Array(this.data.buffer),g=4*this._idx(s,l);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(f[g],f[g+1],f[g+2])},Oh.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},Oh.prototype._idx=function(s,l){if(s<-1||s>=this.dim+1||l<-1||l>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(l+1)*this.stride+(s+1)},Oh.prototype._unpackMapbox=function(s,l,f){return(256*s*256+256*l+f)/10-1e4},Oh.prototype._unpackTerrarium=function(s,l,f){return 256*s+l+f/256-32768},Oh.prototype.getPixels=function(){return new gs({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},Oh.prototype.backfillBorder=function(s,l,f){if(this.dim!==s.dim)throw new Error("dem dimension mismatch");var g=l*this.dim,w=l*this.dim+this.dim,S=f*this.dim,C=f*this.dim+this.dim;switch(l){case-1:g=w-1;break;case 1:w=g+1}switch(f){case-1:S=C-1;break;case 1:C=S+1}for(var L=-l*this.dim,z=-f*this.dim,$=S;$<C;$++)for(var W=g;W<w;W++)this.data[this._idx(W,$)]=s.data[this._idx(W+L,$+z)]},Jr("DEMData",Oh);var nm=function(s){this._stringToNumber={},this._numberToString=[];for(var l=0;l<s.length;l++){var f=s[l];this._stringToNumber[f]=l,this._numberToString[l]=f}};nm.prototype.encode=function(s){return this._stringToNumber[s]},nm.prototype.decode=function(s){return this._numberToString[s]};var Qm=function(s,l,f,g,w){this.type="Feature",this._vectorTileFeature=s,s._z=l,s._x=f,s._y=g,this.properties=s.properties,this.id=w},Kd={geometry:{configurable:!0}};Kd.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},Kd.geometry.set=function(s){this._geometry=s},Qm.prototype.toJSON=function(){var s={geometry:this.geometry};for(var l in this)l!=="_geometry"&&l!=="_vectorTileFeature"&&(s[l]=this[l]);return s},Object.defineProperties(Qm.prototype,Kd);var Qd=function(){this.state={},this.stateChanges={},this.deletedStates={}};Qd.prototype.updateState=function(s,l,f){var g=String(l);if(this.stateChanges[s]=this.stateChanges[s]||{},this.stateChanges[s][g]=this.stateChanges[s][g]||{},O(this.stateChanges[s][g],f),this.deletedStates[s]===null)for(var w in this.deletedStates[s]={},this.state[s])w!==g&&(this.deletedStates[s][w]=null);else if(this.deletedStates[s]&&this.deletedStates[s][g]===null)for(var S in this.deletedStates[s][g]={},this.state[s][g])f[S]||(this.deletedStates[s][g][S]=null);else for(var C in f)this.deletedStates[s]&&this.deletedStates[s][g]&&this.deletedStates[s][g][C]===null&&delete this.deletedStates[s][g][C]},Qd.prototype.removeFeatureState=function(s,l,f){if(this.deletedStates[s]!==null){var g=String(l);if(this.deletedStates[s]=this.deletedStates[s]||{},f&&l!==void 0)this.deletedStates[s][g]!==null&&(this.deletedStates[s][g]=this.deletedStates[s][g]||{},this.deletedStates[s][g][f]=null);else if(l!==void 0)if(this.stateChanges[s]&&this.stateChanges[s][g])for(f in this.deletedStates[s][g]={},this.stateChanges[s][g])this.deletedStates[s][g][f]=null;else this.deletedStates[s][g]=null;else this.deletedStates[s]=null}},Qd.prototype.getState=function(s,l){var f=String(l),g=O({},(this.state[s]||{})[f],(this.stateChanges[s]||{})[f]);if(this.deletedStates[s]===null)return{};if(this.deletedStates[s]){var w=this.deletedStates[s][l];if(w===null)return{};for(var S in w)delete g[S]}return g},Qd.prototype.initializeTileState=function(s,l){s.setFeatureState(this.state,l)},Qd.prototype.coalesceChanges=function(s,l){var f={};for(var g in this.stateChanges){this.state[g]=this.state[g]||{};var w={};for(var S in this.stateChanges[g])this.state[g][S]||(this.state[g][S]={}),O(this.state[g][S],this.stateChanges[g][S]),w[S]=this.state[g][S];f[g]=w}for(var C in this.deletedStates){this.state[C]=this.state[C]||{};var L={};if(this.deletedStates[C]===null)for(var z in this.state[C])L[z]={},this.state[C][z]={};else for(var $ in this.deletedStates[C]){if(this.deletedStates[C][$]===null)this.state[C][$]={};else for(var W=0,K=Object.keys(this.deletedStates[C][$]);W<K.length;W+=1)delete this.state[C][$][K[W]];L[$]=this.state[C][$]}f[C]=f[C]||{},O(f[C],L)}if(this.stateChanges={},this.deletedStates={},Object.keys(f).length!==0)for(var ne in s)s[ne].setFeatureState(f,l)};var Dh=function(s,l){this.tileID=s,this.x=s.canonical.x,this.y=s.canonical.y,this.z=s.canonical.z,this.grid=new El(8192,16,0),this.grid3D=new El(8192,16,0),this.featureIndexArray=new J,this.promoteId=l};function P_(s,l,f,g,w){return pe(s,function(S,C){var L=l instanceof wc?l.get(C):null;return L&&L.evaluate?L.evaluate(f,g,w):L})}function I_(s){for(var l=1/0,f=1/0,g=-1/0,w=-1/0,S=0,C=s;S<C.length;S+=1){var L=C[S];l=Math.min(l,L.x),f=Math.min(f,L.y),g=Math.max(g,L.x),w=Math.max(w,L.y)}return{minX:l,minY:f,maxX:g,maxY:w}}function ob(s,l){return l-s}Dh.prototype.insert=function(s,l,f,g,w,S){var C=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(f,g,w);for(var L=S?this.grid3D:this.grid,z=0;z<l.length;z++){for(var $=l[z],W=[1/0,1/0,-1/0,-1/0],K=0;K<$.length;K++){var ne=$[K];W[0]=Math.min(W[0],ne.x),W[1]=Math.min(W[1],ne.y),W[2]=Math.max(W[2],ne.x),W[3]=Math.max(W[3],ne.y)}W[0]<8192&&W[1]<8192&&W[2]>=0&&W[3]>=0&&L.insert(C,W[0],W[1],W[2],W[3])}},Dh.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new Rl.VectorTile(new Qn(this.rawTileData)).layers,this.sourceLayerCoder=new nm(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},Dh.prototype.query=function(s,l,f,g){var w=this;this.loadVTLayers();for(var S=s.params||{},C=8192/s.tileSize/s.scale,L=dh(S.filter),z=s.queryGeometry,$=s.queryPadding*C,W=I_(z),K=this.grid.query(W.minX-$,W.minY-$,W.maxX+$,W.maxY+$),ne=I_(s.cameraQueryGeometry),le=this.grid3D.query(ne.minX-$,ne.minY-$,ne.maxX+$,ne.maxY+$,function(Tt,It,Yt,gr){return function(Or,Cn,qr,In,tn){for(var hi=0,jn=Or;hi<jn.length;hi+=1){var vn=jn[hi];if(Cn<=vn.x&&qr<=vn.y&&In>=vn.x&&tn>=vn.y)return!0}var xi=[new y(Cn,qr),new y(Cn,tn),new y(In,tn),new y(In,qr)];if(Or.length>2){for(var ai=0,Bi=xi;ai<Bi.length;ai+=1)if(nl(Or,Bi[ai]))return!0}for(var Rn=0;Rn<Or.length-1;Rn++)if(il(Or[Rn],Or[Rn+1],xi))return!0;return!1}(s.cameraQueryGeometry,Tt-$,It-$,Yt+$,gr+$)}),Ie=0,ke=le;Ie<ke.length;Ie+=1)K.push(ke[Ie]);K.sort(ob);for(var Ze,Ve={},st=function(Tt){var It=K[Tt];if(It!==Ze){Ze=It;var Yt=w.featureIndexArray.get(It),gr=null;w.loadMatchingFeature(Ve,Yt.bucketIndex,Yt.sourceLayerIndex,Yt.featureIndex,L,S.layers,S.availableImages,l,f,g,function(Or,Cn,qr){return gr||(gr=Ia(Or)),Cn.queryIntersectsFeature(z,Or,qr,gr,w.z,s.transform,C,s.pixelPosMatrix)})}},vt=0;vt<K.length;vt++)st(vt);return Ve},Dh.prototype.loadMatchingFeature=function(s,l,f,g,w,S,C,L,z,$,W){var K=this.bucketLayerIDs[l];if(!S||function(Or,Cn){for(var qr=0;qr<Or.length;qr++)if(Cn.indexOf(Or[qr])>=0)return!0;return!1}(S,K)){var ne=this.sourceLayerCoder.decode(f),le=this.vtLayers[ne].feature(g);if(w.needGeometry){var Ie=Ea(le,!0);if(!w.filter(new Bn(this.tileID.overscaledZ),Ie,this.tileID.canonical))return}else if(!w.filter(new Bn(this.tileID.overscaledZ),le))return;for(var ke=this.getId(le,ne),Ze=0;Ze<K.length;Ze++){var Ve=K[Ze];if(!(S&&S.indexOf(Ve)<0)){var st=L[Ve];if(st){var vt={};ke!==void 0&&$&&(vt=$.getState(st.sourceLayer||"_geojsonTileLayer",ke));var Tt=O({},z[Ve]);Tt.paint=P_(Tt.paint,st.paint,le,vt,C),Tt.layout=P_(Tt.layout,st.layout,le,vt,C);var It=!W||W(le,st,vt);if(It){var Yt=new Qm(le,this.z,this.x,this.y,ke);Yt.layer=Tt;var gr=s[Ve];gr===void 0&&(gr=s[Ve]=[]),gr.push({featureIndex:g,feature:Yt,intersectionZ:It})}}}}}},Dh.prototype.lookupSymbolFeatures=function(s,l,f,g,w,S,C,L){var z={};this.loadVTLayers();for(var $=dh(w),W=0,K=s;W<K.length;W+=1)this.loadMatchingFeature(z,f,g,K[W],$,S,C,L,l);return z},Dh.prototype.hasLayer=function(s){for(var l=0,f=this.bucketLayerIDs;l<f.length;l+=1)for(var g=0,w=f[l];g<w.length;g+=1)if(s===w[g])return!0;return!1},Dh.prototype.getId=function(s,l){var f=s.id;return this.promoteId&&typeof(f=s.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[l]])=="boolean"&&(f=Number(f)),f},Jr("FeatureIndex",Dh,{omit:["rawTileData","sourceLayerCoder"]});var _s=function(s,l){this.tileID=s,this.uid=N(),this.uses=0,this.tileSize=l,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};_s.prototype.registerFadeDuration=function(s){var l=s+this.timeAdded;l<On.now()||this.fadeEndTime&&l<this.fadeEndTime||(this.fadeEndTime=l)},_s.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},_s.prototype.loadVectorData=function(s,l,f){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",s){for(var g in s.featureIndex&&(this.latestFeatureIndex=s.featureIndex,s.rawTileData?(this.latestRawTileData=s.rawTileData,this.latestFeatureIndex.rawTileData=s.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=s.collisionBoxArray,this.buckets=function($,W){var K={};if(!W)return K;for(var ne=function(){var ke=Ie[le],Ze=ke.layerIds.map(function(vt){return W.getLayer(vt)}).filter(Boolean);if(Ze.length!==0){ke.layers=Ze,ke.stateDependentLayerIds&&(ke.stateDependentLayers=ke.stateDependentLayerIds.map(function(vt){return Ze.filter(function(Tt){return Tt.id===vt})[0]}));for(var Ve=0,st=Ze;Ve<st.length;Ve+=1)K[st[Ve].id]=ke}},le=0,Ie=$;le<Ie.length;le+=1)ne();return K}(s.buckets,l.style),this.hasSymbolBuckets=!1,this.buckets){var w=this.buckets[g];if(w instanceof he){if(this.hasSymbolBuckets=!0,!f)break;w.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var S in this.buckets){var C=this.buckets[S];if(C instanceof he&&C.hasRTLText){this.hasRTLText=!0,Qs.isLoading()||Qs.isLoaded()||Eh()!=="deferred"||pu();break}}for(var L in this.queryPadding=0,this.buckets){var z=this.buckets[L];this.queryPadding=Math.max(this.queryPadding,l.style.getLayer(L).queryRadius(z))}s.imageAtlas&&(this.imageAtlas=s.imageAtlas),s.glyphAtlasImage&&(this.glyphAtlasImage=s.glyphAtlasImage)}else this.collisionBoxArray=new v},_s.prototype.unloadVectorData=function(){for(var s in this.buckets)this.buckets[s].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},_s.prototype.getBucket=function(s){return this.buckets[s.id]},_s.prototype.upload=function(s){for(var l in this.buckets){var f=this.buckets[l];f.uploadPending()&&f.upload(s)}var g=s.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new aa(s,this.imageAtlas.image,g.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new aa(s,this.glyphAtlasImage,g.ALPHA),this.glyphAtlasImage=null)},_s.prototype.prepare=function(s){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(s,this.imageAtlasTexture)},_s.prototype.queryRenderedFeatures=function(s,l,f,g,w,S,C,L,z,$){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:g,cameraQueryGeometry:w,scale:S,tileSize:this.tileSize,pixelPosMatrix:$,transform:L,params:C,queryPadding:this.queryPadding*z},s,l,f):{}},_s.prototype.querySourceFeatures=function(s,l){var f=this.latestFeatureIndex;if(f&&f.rawTileData){var g=f.loadVTLayers(),w=l?l.sourceLayer:"",S=g._geojsonTileLayer||g[w];if(S)for(var C=dh(l&&l.filter),L=this.tileID.canonical,z=L.z,$=L.x,W=L.y,K={z,x:$,y:W},ne=0;ne<S.length;ne++){var le=S.feature(ne);if(C.needGeometry){var Ie=Ea(le,!0);if(!C.filter(new Bn(this.tileID.overscaledZ),Ie,this.tileID.canonical))continue}else if(!C.filter(new Bn(this.tileID.overscaledZ),le))continue;var ke=f.getId(le,w),Ze=new Qm(le,z,$,W,ke);Ze.tile=K,s.push(Ze)}}},_s.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},_s.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},_s.prototype.setExpiryData=function(s){var l=this.expirationTime;if(s.cacheControl){var f=$e(s.cacheControl);f["max-age"]&&(this.expirationTime=Date.now()+1e3*f["max-age"])}else s.expires&&(this.expirationTime=new Date(s.expires).getTime());if(this.expirationTime){var g=Date.now(),w=!1;if(this.expirationTime>g)w=!1;else if(l)if(this.expirationTime<l)w=!0;else{var S=this.expirationTime-l;S?this.expirationTime=g+Math.max(S,3e4):w=!0}else w=!0;w?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},_s.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},_s.prototype.setFeatureState=function(s,l){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(s).length!==0){var f=this.latestFeatureIndex.loadVTLayers();for(var g in this.buckets)if(l.style.hasLayer(g)){var w=this.buckets[g],S=w.layers[0].sourceLayer||"_geojsonTileLayer",C=f[S],L=s[S];if(C&&L&&Object.keys(L).length!==0){w.update(L,C,this.imageAtlas&&this.imageAtlas.patternPositions||{});var z=l&&l.style&&l.style.getLayer(g);z&&(this.queryPadding=Math.max(this.queryPadding,z.queryRadius(w)))}}}},_s.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},_s.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<On.now()},_s.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},_s.prototype.setHoldDuration=function(s){this.symbolFadeHoldUntil=On.now()+s},_s.prototype.setDependencies=function(s,l){for(var f={},g=0,w=l;g<w.length;g+=1)f[w[g]]=!0;this.dependencies[s]=f},_s.prototype.hasDependency=function(s,l){for(var f=0,g=s;f<g.length;f+=1){var w=this.dependencies[g[f]];if(w){for(var S=0,C=l;S<C.length;S+=1)if(w[C[S]])return!0}}return!1};var Ep=E.performance,R_=function(s){this._marks={start:[s.url,"start"].join("#"),end:[s.url,"end"].join("#"),measure:s.url.toString()},Ep.mark(this._marks.start)};R_.prototype.finish=function(){Ep.mark(this._marks.end);var s=Ep.getEntriesByName(this._marks.measure);return s.length===0&&(Ep.measure(this._marks.measure,this._marks.start,this._marks.end),s=Ep.getEntriesByName(this._marks.measure),Ep.clearMarks(this._marks.start),Ep.clearMarks(this._marks.end),Ep.clearMeasures(this._marks.measure)),s},a.Actor=Fu,a.AlphaImage=Lu,a.CanonicalTileID=hd,a.CollisionBoxArray=v,a.Color=vi,a.DEMData=Oh,a.DataConstantProperty=_n,a.DictionaryCoder=nm,a.EXTENT=8192,a.ErrorEvent=Ke,a.EvaluationParameters=Bn,a.Event=Le,a.Evented=nt,a.FeatureIndex=Dh,a.FillBucket=xu,a.FillExtrusionBucket=Ll,a.ImageAtlas=Zt,a.ImagePosition=lr,a.LineBucket=qi,a.LngLat=Pi,a.LngLatBounds=Ra,a.MercatorCoordinate=fd,a.ONE_EM=24,a.OverscaledTileID=Zo,a.Point=y,a.Point$1=y,a.Properties=Xo,a.Protobuf=Qn,a.RGBAImage=gs,a.RequestManager=Nn,a.RequestPerformance=R_,a.ResourceType=ki,a.SegmentVector=ve,a.SourceFeatureState=Qd,a.StructArrayLayout1ui2=Cf,a.StructArrayLayout2f1f2i16=Jc,a.StructArrayLayout2i4=Al,a.StructArrayLayout3ui6=Ec,a.StructArrayLayout4i8=me,a.SymbolBucket=he,a.Texture=aa,a.Tile=_s,a.Transitionable=is,a.Uniform1f=sr,a.Uniform1i=tr,a.Uniform2f=_r,a.Uniform3f=Ur,a.Uniform4f=hn,a.UniformColor=An,a.UniformMatrix4f=Fi,a.UnwrappedTileID=M_,a.ValidationError=Fe,a.WritingMode=br,a.ZoomHistory=yh,a.add=function(s,l,f){return s[0]=l[0]+f[0],s[1]=l[1]+f[1],s[2]=l[2]+f[2],s},a.addDynamicAttributes=Et,a.asyncAll=function(s,l,f){if(!s.length)return f(null,[]);var g=s.length,w=new Array(s.length),S=null;s.forEach(function(C,L){l(C,function(z,$){z&&(S=z),w[L]=$,--g==0&&f(S,w)})})},a.bezier=I,a.bindAll=Y,a.browser=On,a.cacheEntryPossiblyAdded=function(s){++En>Dn&&(s.getActor().send("enforceCacheSizeLimit",Hn),En=0)},a.clamp=D,a.clearTileCache=function(s){var l=E.caches.delete("mapbox-tiles");s&&l.catch(s).then(function(){return s()})},a.clipLine=ls,a.clone=function(s){var l=new $i(16);return l[0]=s[0],l[1]=s[1],l[2]=s[2],l[3]=s[3],l[4]=s[4],l[5]=s[5],l[6]=s[6],l[7]=s[7],l[8]=s[8],l[9]=s[9],l[10]=s[10],l[11]=s[11],l[12]=s[12],l[13]=s[13],l[14]=s[14],l[15]=s[15],l},a.clone$1=ie,a.clone$2=function(s){var l=new $i(3);return l[0]=s[0],l[1]=s[1],l[2]=s[2],l},a.collisionCircleLayout=Jv,a.config=Ut,a.create=function(){var s=new $i(16);return $i!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=0,s[12]=0,s[13]=0,s[14]=0),s[0]=1,s[5]=1,s[10]=1,s[15]=1,s},a.create$1=function(){var s=new $i(9);return $i!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[5]=0,s[6]=0,s[7]=0),s[0]=1,s[4]=1,s[8]=1,s},a.create$2=function(){var s=new $i(4);return $i!=Float32Array&&(s[1]=0,s[2]=0),s[0]=1,s[3]=1,s},a.createCommonjsModule=u,a.createExpression=wf,a.createLayout=bo,a.createStyleLayer=function(s){return s.type==="custom"?new wr(s):new dn[s.type](s)},a.cross=function(s,l,f){var g=l[0],w=l[1],S=l[2],C=f[0],L=f[1],z=f[2];return s[0]=w*z-S*L,s[1]=S*C-g*z,s[2]=g*L-w*C,s},a.deepEqual=function s(l,f){if(Array.isArray(l)){if(!Array.isArray(f)||l.length!==f.length)return!1;for(var g=0;g<l.length;g++)if(!s(l[g],f[g]))return!1;return!0}if(typeof l=="object"&&l!==null&&f!==null){if(typeof f!="object"||Object.keys(l).length!==Object.keys(f).length)return!1;for(var w in l)if(!s(l[w],f[w]))return!1;return!0}return l===f},a.dot=function(s,l){return s[0]*l[0]+s[1]*l[1]+s[2]*l[2]},a.dot$1=function(s,l){return s[0]*l[0]+s[1]*l[1]+s[2]*l[2]+s[3]*l[3]},a.ease=k,a.emitValidationErrors=ua,a.endsWith=ee,a.enforceCacheSizeLimit=function(s){di(),X&&X.then(function(l){l.keys().then(function(f){for(var g=0;g<f.length-s;g++)l.delete(f[g])})})},a.evaluateSizeForFeature=Jn,a.evaluateSizeForZoom=_a,a.evaluateVariableOffset=St,a.evented=wh,a.extend=O,a.featureFilter=dh,a.filterObject=ue,a.fromRotation=function(s,l){var f=Math.sin(l),g=Math.cos(l);return s[0]=g,s[1]=f,s[2]=0,s[3]=-f,s[4]=g,s[5]=0,s[6]=0,s[7]=0,s[8]=1,s},a.getAnchorAlignment=Vn,a.getAnchorJustification=pt,a.getArrayBuffer=Su,a.getImage=re,a.getJSON=function(s,l){return Ss(O(s,{type:"json"}),l)},a.getRTLTextPluginStatus=Eh,a.getReferrer=go,a.getVideo=function(s,l){var f,g,w=E.document.createElement("video");w.muted=!0,w.onloadstart=function(){l(null,w)};for(var S=0;S<s.length;S++){var C=E.document.createElement("source");f=s[S],g=void 0,(g=E.document.createElement("a")).href=f,(g.protocol!==E.document.location.protocol||g.host!==E.document.location.host)&&(w.crossOrigin="Anonymous"),C.src=s[S],w.appendChild(C)}return{cancel:function(){}}},a.identity=Bs,a.invert=function(s,l){var f=l[0],g=l[1],w=l[2],S=l[3],C=l[4],L=l[5],z=l[6],$=l[7],W=l[8],K=l[9],ne=l[10],le=l[11],Ie=l[12],ke=l[13],Ze=l[14],Ve=l[15],st=f*L-g*C,vt=f*z-w*C,Tt=f*$-S*C,It=g*z-w*L,Yt=g*$-S*L,gr=w*$-S*z,Or=W*ke-K*Ie,Cn=W*Ze-ne*Ie,qr=W*Ve-le*Ie,In=K*Ze-ne*ke,tn=K*Ve-le*ke,hi=ne*Ve-le*Ze,jn=st*hi-vt*tn+Tt*In+It*qr-Yt*Cn+gr*Or;return jn?(s[0]=(L*hi-z*tn+$*In)*(jn=1/jn),s[1]=(w*tn-g*hi-S*In)*jn,s[2]=(ke*gr-Ze*Yt+Ve*It)*jn,s[3]=(ne*Yt-K*gr-le*It)*jn,s[4]=(z*qr-C*hi-$*Cn)*jn,s[5]=(f*hi-w*qr+S*Cn)*jn,s[6]=(Ze*Tt-Ie*gr-Ve*vt)*jn,s[7]=(W*gr-ne*Tt+le*vt)*jn,s[8]=(C*tn-L*qr+$*Or)*jn,s[9]=(g*qr-f*tn-S*Or)*jn,s[10]=(Ie*Yt-ke*Tt+Ve*st)*jn,s[11]=(K*Tt-W*Yt-le*st)*jn,s[12]=(L*Cn-C*In-z*Or)*jn,s[13]=(f*In-g*Cn+w*Or)*jn,s[14]=(ke*vt-Ie*It-Ze*st)*jn,s[15]=(W*It-K*vt+ne*st)*jn,s):null},a.isChar=Nr,a.isMapboxURL=Xn,a.keysDifference=function(s,l){var f=[];for(var g in s)g in l||f.push(g);return f},a.makeRequest=Ss,a.mapObject=pe,a.mercatorXfromLng=cd,a.mercatorYfromLat=hl,a.mercatorZfromAltitude=tm,a.mul=up,a.multiply=zo,a.mvt=Rl,a.nextPowerOfTwo=function(s){return s<=1?1:Math.pow(2,Math.ceil(Math.log(s)/Math.LN2))},a.normalize=function(s,l){var f=l[0],g=l[1],w=l[2],S=f*f+g*g+w*w;return S>0&&(S=1/Math.sqrt(S)),s[0]=l[0]*S,s[1]=l[1]*S,s[2]=l[2]*S,s},a.number=ao,a.offscreenCanvasSupported=Ii,a.ortho=function(s,l,f,g,w,S,C){var L=1/(l-f),z=1/(g-w),$=1/(S-C);return s[0]=-2*L,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=-2*z,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=2*$,s[11]=0,s[12]=(l+f)*L,s[13]=(w+g)*z,s[14]=(C+S)*$,s[15]=1,s},a.parseGlyphPBF=function(s){return new Qn(s).readFields(ar,[])},a.pbf=Qn,a.performSymbolLayout=function(s,l,f,g,w,S,C){s.createArrays(),s.tilePixelRatio=8192/(512*s.overscaling),s.compareText={},s.iconsNeedLinear=!1;var L=s.layers[0].layout,z=s.layers[0]._unevaluatedLayout._values,$={};if(s.textSizeData.kind==="composite"){var W=s.textSizeData,K=W.maxZoom;$.compositeTextSizes=[z["text-size"].possiblyEvaluate(new Bn(W.minZoom),C),z["text-size"].possiblyEvaluate(new Bn(K),C)]}if(s.iconSizeData.kind==="composite"){var ne=s.iconSizeData,le=ne.maxZoom;$.compositeIconSizes=[z["icon-size"].possiblyEvaluate(new Bn(ne.minZoom),C),z["icon-size"].possiblyEvaluate(new Bn(le),C)]}$.layoutTextSize=z["text-size"].possiblyEvaluate(new Bn(s.zoom+1),C),$.layoutIconSize=z["icon-size"].possiblyEvaluate(new Bn(s.zoom+1),C),$.textMaxSize=z["text-size"].possiblyEvaluate(new Bn(18));for(var Ie=24*L.get("text-line-height"),ke=L.get("text-rotation-alignment")==="map"&&L.get("symbol-placement")!=="point",Ze=L.get("text-keep-upright"),Ve=L.get("text-size"),st=function(){var It=Tt[vt],Yt=L.get("text-font").evaluate(It,{},C).join(","),gr=Ve.evaluate(It,{},C),Or=$.layoutTextSize.evaluate(It,{},C),Cn=$.layoutIconSize.evaluate(It,{},C),qr={horizontal:{},vertical:void 0},In=It.text,tn=[0,0];if(In){var hi=In.toString(),jn=24*L.get("text-letter-spacing").evaluate(It,{},C),vn=function(Ri){for(var La=0,xa=Ri;La<xa.length;La+=1)if(Yi=xa[La].charCodeAt(0),Nr.Arabic(Yi)||Nr["Arabic Supplement"](Yi)||Nr["Arabic Extended-A"](Yi)||Nr["Arabic Presentation Forms-A"](Yi)||Nr["Arabic Presentation Forms-B"](Yi))return!1;var Yi;return!0}(hi)?jn:0,xi=L.get("text-anchor").evaluate(It,{},C),ai=L.get("text-variable-anchor");if(!ai){var Bi=L.get("text-radial-offset").evaluate(It,{},C);tn=Bi?St(xi,[24*Bi,Pe]):L.get("text-offset").evaluate(It,{},C).map(function(Ri){return 24*Ri})}var Rn=ke?"center":L.get("text-justify").evaluate(It,{},C),ta=L.get("symbol-placement"),eo=ta==="point"?24*L.get("text-max-width").evaluate(It,{},C):0,to=function(){s.allowVerticalPlacement&&Ju(hi)&&(qr.vertical=Wt(In,l,f,w,Yt,eo,Ie,xi,"left",vn,tn,br.vertical,!0,ta,Or,gr))};if(!ke&&ai){for(var Wa=Rn==="auto"?ai.map(function(Ri){return pt(Ri)}):[Rn],ro=!1,Ao=0;Ao<Wa.length;Ao++){var $o=Wa[Ao];if(!qr.horizontal[$o])if(ro)qr.horizontal[$o]=qr.horizontal[0];else{var Ko=Wt(In,l,f,w,Yt,eo,Ie,"center",$o,vn,tn,br.horizontal,!1,ta,Or,gr);Ko&&(qr.horizontal[$o]=Ko,ro=Ko.positionedLines.length===1)}}to()}else{Rn==="auto"&&(Rn=pt(xi));var iu=Wt(In,l,f,w,Yt,eo,Ie,xi,Rn,vn,tn,br.horizontal,!1,ta,Or,gr);iu&&(qr.horizontal[Rn]=iu),to(),Ju(hi)&&ke&&Ze&&(qr.vertical=Wt(In,l,f,w,Yt,eo,Ie,xi,Rn,vn,tn,br.vertical,!1,ta,Or,gr))}}var xs=void 0,au=!1;if(It.icon&&It.icon.name){var ko=g[It.icon.name];ko&&(xs=function(Ri,La,xa){var Yi=Vn(xa),wu=La[0]-Ri.displaySize[0]*Yi.horizontalAlign,zs=La[1]-Ri.displaySize[1]*Yi.verticalAlign;return{image:Ri,top:zs,bottom:zs+Ri.displaySize[1],left:wu,right:wu+Ri.displaySize[0]}}(w[It.icon.name],L.get("icon-offset").evaluate(It,{},C),L.get("icon-anchor").evaluate(It,{},C)),au=ko.sdf,s.sdfIcons===void 0?s.sdfIcons=ko.sdf:s.sdfIcons!==ko.sdf&&Se("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ko.pixelRatio!==s.pixelRatio||L.get("icon-rotate").constantOr(1)!==0)&&(s.iconsNeedLinear=!0))}var bs=_i(qr.horizontal)||qr.vertical;s.iconsInText=!!bs&&bs.iconsInText,(bs||xs)&&function(Ri,La,xa,Yi,wu,zs,Xa,Aa,Us,ra,Nu){var ni=zs.textMaxSize.evaluate(La,{});ni===void 0&&(ni=Xa);var Df,oa=Ri.layers[0].layout,Ya=oa.get("icon-offset").evaluate(La,{},Nu),Ic=_i(xa.horizontal),Ql=Xa/24,pd=Ri.tilePixelRatio*Ql,Jd=Ri.tilePixelRatio*ni/24,Fh=Ri.tilePixelRatio*Aa,ev=Ri.tilePixelRatio*oa.get("symbol-spacing"),Jm=oa.get("text-padding")*Ri.tilePixelRatio,Sp=oa.get("icon-padding")*Ri.tilePixelRatio,im=oa.get("text-max-angle")/180*Math.PI,Rc=oa.get("text-rotation-alignment")==="map"&&oa.get("symbol-placement")!=="point",am=oa.get("icon-rotation-alignment")==="map"&&oa.get("symbol-placement")!=="point",Lc=oa.get("symbol-placement"),vo=ev/2,mo=oa.get("icon-text-fit");Yi&&mo!=="none"&&(Ri.allowVerticalPlacement&&xa.vertical&&(Df=Xr(Yi,xa.vertical,mo,oa.get("icon-text-fit-padding"),Ya,Ql)),Ic&&(Yi=Xr(Yi,Ic,mo,oa.get("icon-text-fit-padding"),Ya,Ql)));var Nh=function(k_,Bu){Bu.x<0||Bu.x>=8192||Bu.y<0||Bu.y>=8192||function(To,sf,qa,Ap,a0,lm,o0,Bf,s0,cm,u0,l0,Og,O_,fm,D_,F_,N_,B_,c0,kl,iv,z_,zf,sb){var Vs,Os,av,ov,sv,yd=To.addToLineVertexArray(sf,qa),U_=0,V_=0,j_=0,Dg=0,Fg=-1,Ng=-1,zh={},Bg=Me(""),f0=0,zg=0;if(Bf._unevaluatedLayout.getValue("text-radial-offset")===void 0?(f0=(Vs=Bf.layout.get("text-offset").evaluate(kl,{},zf).map(function(pm){return 24*pm}))[0],zg=Vs[1]):(f0=24*Bf.layout.get("text-radial-offset").evaluate(kl,{},zf),zg=Pe),To.allowVerticalPlacement&&Ap.vertical){var $_=Bf.layout.get("text-rotate").evaluate(kl,{},zf)+90;ov=new So(s0,sf,cm,u0,l0,Ap.vertical,Og,O_,fm,$_),o0&&(sv=new So(s0,sf,cm,u0,l0,o0,F_,N_,fm,$_))}if(a0){var Ug=Bf.layout.get("icon-rotate").evaluate(kl,{}),G_=Bf.layout.get("icon-text-fit")!=="none",_d=ys(a0,Ug,z_,G_),Vg=o0?ys(o0,Ug,z_,G_):void 0;av=new So(s0,sf,cm,u0,l0,a0,F_,N_,!1,Ug),U_=4*_d.length;var H_=To.iconSizeData,hm=null;H_.kind==="source"?(hm=[128*Bf.layout.get("icon-size").evaluate(kl,{})])[0]>32640&&Se(To.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):H_.kind==="composite"&&((hm=[128*iv.compositeIconSizes[0].evaluate(kl,{},zf),128*iv.compositeIconSizes[1].evaluate(kl,{},zf)])[0]>32640||hm[1]>32640)&&Se(To.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),To.addSymbols(To.icon,_d,hm,c0,B_,kl,!1,sf,yd.lineStartIndex,yd.lineLength,-1,zf),Fg=To.icon.placedSymbolArray.length-1,Vg&&(V_=4*Vg.length,To.addSymbols(To.icon,Vg,hm,c0,B_,kl,br.vertical,sf,yd.lineStartIndex,yd.lineLength,-1,zf),Ng=To.icon.placedSymbolArray.length-1)}for(var W_ in Ap.horizontal){var h0=Ap.horizontal[W_];if(!Os){Bg=Me(h0.text);var X_=Bf.layout.get("text-rotate").evaluate(kl,{},zf);Os=new So(s0,sf,cm,u0,l0,h0,Og,O_,fm,X_)}var jg=h0.positionedLines.length===1;if(j_+=en(To,sf,h0,lm,Bf,fm,kl,D_,yd,Ap.vertical?br.horizontal:br.horizontalOnly,jg?Object.keys(Ap.horizontal):[W_],zh,Fg,iv,zf),jg)break}Ap.vertical&&(Dg+=en(To,sf,Ap.vertical,lm,Bf,fm,kl,D_,yd,br.vertical,["vertical"],zh,Ng,iv,zf));var ub=Os?Os.boxStartIndex:To.collisionBoxArray.length,lb=Os?Os.boxEndIndex:To.collisionBoxArray.length,cb=ov?ov.boxStartIndex:To.collisionBoxArray.length,fb=ov?ov.boxEndIndex:To.collisionBoxArray.length,hb=av?av.boxStartIndex:To.collisionBoxArray.length,pb=av?av.boxEndIndex:To.collisionBoxArray.length,db=sv?sv.boxStartIndex:To.collisionBoxArray.length,vb=sv?sv.boxEndIndex:To.collisionBoxArray.length,Uf=-1,p0=function(pm,q_){return pm&&pm.circleDiameter?Math.max(pm.circleDiameter,q_):q_};Uf=p0(Os,Uf),Uf=p0(ov,Uf),Uf=p0(av,Uf);var Y_=(Uf=p0(sv,Uf))>-1?1:0;Y_&&(Uf*=sb/24),To.glyphOffsetArray.length>=he.MAX_GLYPHS&&Se("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),kl.sortKey!==void 0&&To.addToSortKeyRanges(To.symbolInstances.length,kl.sortKey),To.symbolInstances.emplaceBack(sf.x,sf.y,zh.right>=0?zh.right:-1,zh.center>=0?zh.center:-1,zh.left>=0?zh.left:-1,zh.vertical||-1,Fg,Ng,Bg,ub,lb,cb,fb,hb,pb,db,vb,cm,j_,Dg,U_,V_,Y_,0,Og,f0,zg,Uf)}(Ri,Bu,k_,xa,Yi,wu,Df,Ri.layers[0],Ri.collisionBoxArray,La.index,La.sourceLayerIndex,Ri.index,pd,Jm,Rc,Us,Fh,Sp,am,Ya,La,zs,ra,Nu,Xa)};if(Lc==="line")for(var tv=0,e0=ls(La.geometry,0,0,8192,8192);tv<e0.length;tv+=1)for(var t0=e0[tv],om=0,sm=us(t0,ev,im,xa.vertical||Ic,Yi,24,Jd,Ri.overscaling,8192);om<sm.length;om+=1){var r0=sm[om];Ic&&Ae(Ri,Ic.text,vo,r0)||Nh(t0,r0)}else if(Lc==="line-center")for(var rv=0,Bh=La.geometry;rv<Bh.length;rv+=1){var dd=Bh[rv];if(dd.length>1){var n0=Lo(dd,im,xa.vertical||Ic,Yi,24,Jd);n0&&Nh(dd,n0)}}else if(La.type==="Polygon")for(var vd=0,md=dp(La.geometry,0);vd<md.length;vd+=1){var ou=md[vd],Ff=Sa(ou,16);Nh(ou[0],new Pn(Ff.x,Ff.y,0))}else if(La.type==="LineString")for(var gd=0,um=La.geometry;gd<um.length;gd+=1){var nv=um[gd];Nh(nv,new Pn(nv[0].x,nv[0].y,0))}else if(La.type==="Point")for(var kg=0,L_=La.geometry;kg<L_.length;kg+=1)for(var i0=0,Nf=L_[kg];i0<Nf.length;i0+=1){var zi=Nf[i0];Nh([zi],new Pn(zi.x,zi.y,0))}}(s,It,qr,xs,g,$,Or,Cn,tn,au,C)},vt=0,Tt=s.features;vt<Tt.length;vt+=1)st();S&&s.generateCollisionDebugBuffers()},a.perspective=function(s,l,f,g,w){var S,C=1/Math.tan(l/2);return s[0]=C/f,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=C,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=-1,s[12]=0,s[13]=0,s[15]=0,w!=null&&w!==1/0?(s[10]=(w+g)*(S=1/(g-w)),s[14]=2*w*g*S):(s[10]=-1,s[14]=-2*g),s},a.pick=function(s,l){for(var f={},g=0;g<l.length;g++){var w=l[g];w in s&&(f[w]=s[w])}return f},a.plugin=Qs,a.polygonIntersectsPolygon=rl,a.postMapLoadEvent=Zn,a.postTurnstileEvent=wn,a.potpack=Rt,a.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],a.register=Jr,a.registerForPluginStateChange=function(s){return s({pluginStatus:Ks,pluginURL:Cu}),wh.on("pluginStateChange",s),s},a.renderColorRamp=lp,a.rotate=function(s,l,f){var g=l[0],w=l[1],S=l[2],C=l[3],L=Math.sin(f),z=Math.cos(f);return s[0]=g*z+S*L,s[1]=w*z+C*L,s[2]=g*-L+S*z,s[3]=w*-L+C*z,s},a.rotateX=function(s,l,f){var g=Math.sin(f),w=Math.cos(f),S=l[4],C=l[5],L=l[6],z=l[7],$=l[8],W=l[9],K=l[10],ne=l[11];return l!==s&&(s[0]=l[0],s[1]=l[1],s[2]=l[2],s[3]=l[3],s[12]=l[12],s[13]=l[13],s[14]=l[14],s[15]=l[15]),s[4]=S*w+$*g,s[5]=C*w+W*g,s[6]=L*w+K*g,s[7]=z*w+ne*g,s[8]=$*w-S*g,s[9]=W*w-C*g,s[10]=K*w-L*g,s[11]=ne*w-z*g,s},a.rotateZ=function(s,l,f){var g=Math.sin(f),w=Math.cos(f),S=l[0],C=l[1],L=l[2],z=l[3],$=l[4],W=l[5],K=l[6],ne=l[7];return l!==s&&(s[8]=l[8],s[9]=l[9],s[10]=l[10],s[11]=l[11],s[12]=l[12],s[13]=l[13],s[14]=l[14],s[15]=l[15]),s[0]=S*w+$*g,s[1]=C*w+W*g,s[2]=L*w+K*g,s[3]=z*w+ne*g,s[4]=$*w-S*g,s[5]=W*w-C*g,s[6]=K*w-L*g,s[7]=ne*w-z*g,s},a.scale=function(s,l,f){var g=f[0],w=f[1],S=f[2];return s[0]=l[0]*g,s[1]=l[1]*g,s[2]=l[2]*g,s[3]=l[3]*g,s[4]=l[4]*w,s[5]=l[5]*w,s[6]=l[6]*w,s[7]=l[7]*w,s[8]=l[8]*S,s[9]=l[9]*S,s[10]=l[10]*S,s[11]=l[11]*S,s[12]=l[12],s[13]=l[13],s[14]=l[14],s[15]=l[15],s},a.scale$1=function(s,l,f){return s[0]=l[0]*f,s[1]=l[1]*f,s[2]=l[2]*f,s[3]=l[3]*f,s},a.scale$2=function(s,l,f){return s[0]=l[0]*f,s[1]=l[1]*f,s[2]=l[2]*f,s},a.setCacheLimits=function(s,l){Hn=s,Dn=l},a.setRTLTextPlugin=function(s,l,f){if(f===void 0&&(f=!1),Ks==="deferred"||Ks==="loading"||Ks==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");Cu=On.resolveURL(s),Ks="deferred",xh=l,Kc(),f||pu()},a.sphericalToCartesian=function(s){var l=s[0],f=s[1],g=s[2];return f+=90,f*=Math.PI/180,g*=Math.PI/180,{x:l*Math.cos(f)*Math.sin(g),y:l*Math.sin(f)*Math.sin(g),z:l*Math.cos(g)}},a.sqrLen=function(s){var l=s[0],f=s[1];return l*l+f*f},a.styleSpec=de,a.sub=function(s,l,f){return s[0]=l[0]-f[0],s[1]=l[1]-f[1],s[2]=l[2]-f[2],s},a.symbolSize=po,a.transformMat3=function(s,l,f){var g=l[0],w=l[1],S=l[2];return s[0]=g*f[0]+w*f[3]+S*f[6],s[1]=g*f[1]+w*f[4]+S*f[7],s[2]=g*f[2]+w*f[5]+S*f[8],s},a.transformMat4=tu,a.translate=function(s,l,f){var g,w,S,C,L,z,$,W,K,ne,le,Ie,ke=f[0],Ze=f[1],Ve=f[2];return l===s?(s[12]=l[0]*ke+l[4]*Ze+l[8]*Ve+l[12],s[13]=l[1]*ke+l[5]*Ze+l[9]*Ve+l[13],s[14]=l[2]*ke+l[6]*Ze+l[10]*Ve+l[14],s[15]=l[3]*ke+l[7]*Ze+l[11]*Ve+l[15]):(w=l[1],S=l[2],C=l[3],L=l[4],z=l[5],$=l[6],W=l[7],K=l[8],ne=l[9],le=l[10],Ie=l[11],s[0]=g=l[0],s[1]=w,s[2]=S,s[3]=C,s[4]=L,s[5]=z,s[6]=$,s[7]=W,s[8]=K,s[9]=ne,s[10]=le,s[11]=Ie,s[12]=g*ke+L*Ze+K*Ve+l[12],s[13]=w*ke+z*Ze+ne*Ve+l[13],s[14]=S*ke+$*Ze+le*Ve+l[14],s[15]=C*ke+W*Ze+Ie*Ve+l[15]),s},a.triggerPluginCompletionEvent=bh,a.uniqueId=N,a.validateCustomStyleLayer=function(s){var l=[],f=s.id;return f===void 0&&l.push({message:"layers."+f+': missing required property "id"'}),s.render===void 0&&l.push({message:"layers."+f+': missing required method "render"'}),s.renderingMode&&s.renderingMode!=="2d"&&s.renderingMode!=="3d"&&l.push({message:"layers."+f+': property "renderingMode" must be either "2d" or "3d"'}),l},a.validateLight=Af,a.validateStyle=mh,a.values=function(s){var l=[];for(var f in s)l.push(s[f]);return l},a.vectorTile=Rl,a.version="1.13.3",a.warnOnce=Se,a.webpSupported=Ar,a.window=E,a.wrap=V}),o(["./shared"],function(a){function u(Z){var re=typeof Z;if(re==="number"||re==="boolean"||re==="string"||Z==null)return JSON.stringify(Z);if(Array.isArray(Z)){for(var oe="[",ge=0,Le=Z;ge<Le.length;ge+=1)oe+=u(Le[ge])+",";return oe+"]"}for(var Ke=Object.keys(Z).sort(),nt="{",de=0;de<Ke.length;de++)nt+=JSON.stringify(Ke[de])+":"+u(Z[Ke[de]])+",";return nt+"}"}function c(Z){for(var re="",oe=0,ge=a.refProperties;oe<ge.length;oe+=1)re+="/"+u(Z[ge[oe]]);return re}var h=function(Z){this.keyCache={},Z&&this.replace(Z)};h.prototype.replace=function(Z){this._layerConfigs={},this._layers={},this.update(Z,[])},h.prototype.update=function(Z,re){for(var oe=this,ge=0,Le=Z;ge<Le.length;ge+=1){var Ke=Le[ge];this._layerConfigs[Ke.id]=Ke;var nt=this._layers[Ke.id]=a.createStyleLayer(Ke);nt._featureFilter=a.featureFilter(nt.filter),this.keyCache[Ke.id]&&delete this.keyCache[Ke.id]}for(var de=0,Fe=re;de<Fe.length;de+=1){var ht=Fe[de];delete this.keyCache[ht],delete this._layerConfigs[ht],delete this._layers[ht]}this.familiesBySource={};for(var nr=0,cr=function(Ir,Dr){for(var ii={},Fr=0;Fr<Ir.length;Fr++){var fi=Dr&&Dr[Ir[Fr].id]||c(Ir[Fr]);Dr&&(Dr[Ir[Fr].id]=fi);var Oi=ii[fi];Oi||(Oi=ii[fi]=[]),Oi.push(Ir[Fr])}var oi=[];for(var Si in ii)oi.push(ii[Si]);return oi}(a.values(this._layerConfigs),this.keyCache);nr<cr.length;nr+=1){var kt=cr[nr].map(function(Ir){return oe._layers[Ir.id]}),ir=kt[0];if(ir.visibility!=="none"){var Sr=ir.source||"",nn=this.familiesBySource[Sr];nn||(nn=this.familiesBySource[Sr]={});var Dt=ir.sourceLayer||"_geojsonTileLayer",Kr=nn[Dt];Kr||(Kr=nn[Dt]=[]),Kr.push(kt)}}};var y=function(Z){var re={},oe=[];for(var ge in Z){var Le=Z[ge],Ke=re[ge]={};for(var nt in Le){var de=Le[+nt];if(de&&de.bitmap.width!==0&&de.bitmap.height!==0){var Fe={x:0,y:0,w:de.bitmap.width+2,h:de.bitmap.height+2};oe.push(Fe),Ke[nt]={rect:Fe,metrics:de.metrics}}}}var ht=a.potpack(oe),nr=new a.AlphaImage({width:ht.w||1,height:ht.h||1});for(var cr in Z){var kt=Z[cr];for(var ir in kt){var Sr=kt[+ir];if(Sr&&Sr.bitmap.width!==0&&Sr.bitmap.height!==0){var nn=re[cr][ir].rect;a.AlphaImage.copy(Sr.bitmap,nr,{x:0,y:0},{x:nn.x+1,y:nn.y+1},Sr.bitmap)}}}this.image=nr,this.positions=re};a.register("GlyphAtlas",y);var x=function(Z){this.tileID=new a.OverscaledTileID(Z.tileID.overscaledZ,Z.tileID.wrap,Z.tileID.canonical.z,Z.tileID.canonical.x,Z.tileID.canonical.y),this.uid=Z.uid,this.zoom=Z.zoom,this.pixelRatio=Z.pixelRatio,this.tileSize=Z.tileSize,this.source=Z.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Z.showCollisionBoxes,this.collectResourceTiming=!!Z.collectResourceTiming,this.returnDependencies=!!Z.returnDependencies,this.promoteId=Z.promoteId};function E(Z,re,oe){for(var ge=new a.EvaluationParameters(re),Le=0,Ke=Z;Le<Ke.length;Le+=1)Ke[Le].recalculate(ge,oe)}function T(Z,re){var oe=a.getArrayBuffer(Z.request,function(ge,Le,Ke,nt){ge?re(ge):Le&&re(null,{vectorTile:new a.vectorTile.VectorTile(new a.pbf(Le)),rawData:Le,cacheControl:Ke,expires:nt})});return function(){oe.cancel(),re()}}x.prototype.parse=function(Z,re,oe,ge,Le){var Ke=this;this.status="parsing",this.data=Z,this.collisionBoxArray=new a.CollisionBoxArray;var nt=new a.DictionaryCoder(Object.keys(Z.layers).sort()),de=new a.FeatureIndex(this.tileID,this.promoteId);de.bucketLayerIDs=[];var Fe,ht,nr,cr,kt={},ir={featureIndex:de,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:oe},Sr=re.familiesBySource[this.source];for(var nn in Sr){var Dt=Z.layers[nn];if(Dt){Dt.version===1&&a.warnOnce('Vector tile source "'+this.source+'" layer "'+nn+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var Kr=nt.encode(nn),Ir=[],Dr=0;Dr<Dt.length;Dr++){var ii=Dt.feature(Dr),Fr=de.getId(ii,nn);Ir.push({feature:ii,id:Fr,index:Dr,sourceLayerIndex:Kr})}for(var fi=0,Oi=Sr[nn];fi<Oi.length;fi+=1){var oi=Oi[fi],Si=oi[0];Si.minzoom&&this.zoom<Math.floor(Si.minzoom)||Si.maxzoom&&this.zoom>=Si.maxzoom||Si.visibility!=="none"&&(E(oi,this.zoom,oe),(kt[Si.id]=Si.createBucket({index:de.bucketLayerIDs.length,layers:oi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Kr,sourceID:this.source})).populate(Ir,ir,this.tileID.canonical),de.bucketLayerIDs.push(oi.map(function(Di){return Di.id})))}}}var Ti=a.mapObject(ir.glyphDependencies,function(Di){return Object.keys(Di).map(Number)});Object.keys(Ti).length?ge.send("getGlyphs",{uid:this.uid,stacks:Ti},function(Di,ti){Fe||(Fe=Di,ht=ti,Hi.call(Ke))}):ht={};var Jo=Object.keys(ir.iconDependencies);Jo.length?ge.send("getImages",{icons:Jo,source:this.source,tileID:this.tileID,type:"icons"},function(Di,ti){Fe||(Fe=Di,nr=ti,Hi.call(Ke))}):nr={};var Ni=Object.keys(ir.patternDependencies);function Hi(){if(Fe)return Le(Fe);if(ht&&nr&&cr){var Di=new y(ht),ti=new a.ImageAtlas(nr,cr);for(var vi in kt){var Mo=kt[vi];Mo instanceof a.SymbolBucket?(E(Mo.layers,this.zoom,oe),a.performSymbolLayout(Mo,ht,Di.positions,nr,ti.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):Mo.hasPattern&&(Mo instanceof a.LineBucket||Mo instanceof a.FillBucket||Mo instanceof a.FillExtrusionBucket)&&(E(Mo.layers,this.zoom,oe),Mo.addFeatures(ir,this.tileID.canonical,ti.patternPositions))}this.status="done",Le(null,{buckets:a.values(kt).filter(function(As){return!As.isEmpty()}),featureIndex:de,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Di.image,imageAtlas:ti,glyphMap:this.returnDependencies?ht:null,iconMap:this.returnDependencies?nr:null,glyphPositions:this.returnDependencies?Di.positions:null})}}Ni.length?ge.send("getImages",{icons:Ni,source:this.source,tileID:this.tileID,type:"patterns"},function(Di,ti){Fe||(Fe=Di,cr=ti,Hi.call(Ke))}):cr={},Hi.call(this)};var I=function(Z,re,oe,ge){this.actor=Z,this.layerIndex=re,this.availableImages=oe,this.loadVectorData=ge||T,this.loading={},this.loaded={}};I.prototype.loadTile=function(Z,re){var oe=this,ge=Z.uid;this.loading||(this.loading={});var Le=!!(Z&&Z.request&&Z.request.collectResourceTiming)&&new a.RequestPerformance(Z.request),Ke=this.loading[ge]=new x(Z);Ke.abort=this.loadVectorData(Z,function(nt,de){if(delete oe.loading[ge],nt||!de)return Ke.status="done",oe.loaded[ge]=Ke,re(nt);var Fe=de.rawData,ht={};de.expires&&(ht.expires=de.expires),de.cacheControl&&(ht.cacheControl=de.cacheControl);var nr={};if(Le){var cr=Le.finish();cr&&(nr.resourceTiming=JSON.parse(JSON.stringify(cr)))}Ke.vectorTile=de.vectorTile,Ke.parse(de.vectorTile,oe.layerIndex,oe.availableImages,oe.actor,function(kt,ir){if(kt||!ir)return re(kt);re(null,a.extend({rawTileData:Fe.slice(0)},ir,ht,nr))}),oe.loaded=oe.loaded||{},oe.loaded[ge]=Ke})},I.prototype.reloadTile=function(Z,re){var oe=this,ge=this.loaded,Le=Z.uid,Ke=this;if(ge&&ge[Le]){var nt=ge[Le];nt.showCollisionBoxes=Z.showCollisionBoxes;var de=function(Fe,ht){var nr=nt.reloadCallback;nr&&(delete nt.reloadCallback,nt.parse(nt.vectorTile,Ke.layerIndex,oe.availableImages,Ke.actor,nr)),re(Fe,ht)};nt.status==="parsing"?nt.reloadCallback=de:nt.status==="done"&&(nt.vectorTile?nt.parse(nt.vectorTile,this.layerIndex,this.availableImages,this.actor,de):de())}},I.prototype.abortTile=function(Z,re){var oe=this.loading,ge=Z.uid;oe&&oe[ge]&&oe[ge].abort&&(oe[ge].abort(),delete oe[ge]),re()},I.prototype.removeTile=function(Z,re){var oe=this.loaded,ge=Z.uid;oe&&oe[ge]&&delete oe[ge],re()};var k=a.window.ImageBitmap,D=function(){this.loaded={}};function V(Z,re){if(Z.length!==0){O(Z[0],re);for(var oe=1;oe<Z.length;oe++)O(Z[oe],!re)}}function O(Z,re){for(var oe=0,ge=0,Le=0,Ke=Z.length,nt=Ke-1;Le<Ke;nt=Le++){var de=(Z[Le][0]-Z[nt][0])*(Z[nt][1]+Z[Le][1]),Fe=oe+de;ge+=Math.abs(oe)>=Math.abs(de)?oe-Fe+de:de-Fe+oe,oe=Fe}oe+ge>=0!=!!re&&Z.reverse()}D.prototype.loadTile=function(Z,re){var oe=Z.uid,ge=Z.encoding,Le=Z.rawImageData,Ke=k&&Le instanceof k?this.getImageData(Le):Le,nt=new a.DEMData(oe,Ke,ge);this.loaded=this.loaded||{},this.loaded[oe]=nt,re(null,nt)},D.prototype.getImageData=function(Z){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(Z.width,Z.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=Z.width,this.offscreenCanvas.height=Z.height,this.offscreenCanvasContext.drawImage(Z,0,0,Z.width,Z.height);var re=this.offscreenCanvasContext.getImageData(-1,-1,Z.width+2,Z.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new a.RGBAImage({width:re.width,height:re.height},re.data)},D.prototype.removeTile=function(Z){var re=this.loaded,oe=Z.uid;re&&re[oe]&&delete re[oe]};var F=a.vectorTile.VectorTileFeature.prototype.toGeoJSON,N=function(Z){this._feature=Z,this.extent=a.EXTENT,this.type=Z.type,this.properties=Z.tags,"id"in Z&&!isNaN(Z.id)&&(this.id=parseInt(Z.id,10))};N.prototype.loadGeometry=function(){if(this._feature.type===1){for(var Z=[],re=0,oe=this._feature.geometry;re<oe.length;re+=1){var ge=oe[re];Z.push([new a.Point$1(ge[0],ge[1])])}return Z}for(var Le=[],Ke=0,nt=this._feature.geometry;Ke<nt.length;Ke+=1){for(var de=[],Fe=0,ht=nt[Ke];Fe<ht.length;Fe+=1){var nr=ht[Fe];de.push(new a.Point$1(nr[0],nr[1]))}Le.push(de)}return Le},N.prototype.toGeoJSON=function(Z,re,oe){return F.call(this,Z,re,oe)};var H=function(Z){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=a.EXTENT,this.length=Z.length,this._features=Z};H.prototype.feature=function(Z){return new N(this._features[Z])};var q=a.vectorTile.VectorTileFeature,Y=ee;function ee(Z,re){this.options=re||{},this.features=Z,this.length=Z.length}function pe(Z,re){this.id=typeof Z.id=="number"?Z.id:void 0,this.type=Z.type,this.rawGeometry=Z.type===1?[Z.geometry]:Z.geometry,this.properties=Z.tags,this.extent=re||4096}ee.prototype.feature=function(Z){return new pe(this.features[Z],this.options.extent)},pe.prototype.loadGeometry=function(){var Z=this.rawGeometry;this.geometry=[];for(var re=0;re<Z.length;re++){for(var oe=Z[re],ge=[],Le=0;Le<oe.length;Le++)ge.push(new a.Point$1(oe[Le][0],oe[Le][1]));this.geometry.push(ge)}return this.geometry},pe.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Z=this.geometry,re=1/0,oe=-1/0,ge=1/0,Le=-1/0,Ke=0;Ke<Z.length;Ke++)for(var nt=Z[Ke],de=0;de<nt.length;de++){var Fe=nt[de];re=Math.min(re,Fe.x),oe=Math.max(oe,Fe.x),ge=Math.min(ge,Fe.y),Le=Math.max(Le,Fe.y)}return[re,ge,oe,Le]},pe.prototype.toGeoJSON=q.prototype.toGeoJSON;var ue=xe,ie=Y;function xe(Z){var re=new a.pbf;return function(oe,ge){for(var Le in oe.layers)ge.writeMessage(3,Se,oe.layers[Le])}(Z,re),re.finish()}function Se(Z,re){var oe;re.writeVarintField(15,Z.version||1),re.writeStringField(1,Z.name||""),re.writeVarintField(5,Z.extent||4096);var ge={keys:[],values:[],keycache:{},valuecache:{}};for(oe=0;oe<Z.length;oe++)ge.feature=Z.feature(oe),re.writeMessage(2,Ne,ge);var Le=ge.keys;for(oe=0;oe<Le.length;oe++)re.writeStringField(3,Le[oe]);var Ke=ge.values;for(oe=0;oe<Ke.length;oe++)re.writeMessage(4,mt,Ke[oe])}function Ne(Z,re){var oe=Z.feature;oe.id!==void 0&&re.writeVarintField(1,oe.id),re.writeMessage(2,ze,Z),re.writeVarintField(3,oe.type),re.writeMessage(4,it,oe)}function ze(Z,re){var oe=Z.feature,ge=Z.keys,Le=Z.values,Ke=Z.keycache,nt=Z.valuecache;for(var de in oe.properties){var Fe=Ke[de];Fe===void 0&&(ge.push(de),Ke[de]=Fe=ge.length-1),re.writeVarint(Fe);var ht=oe.properties[de],nr=typeof ht;nr!=="string"&&nr!=="boolean"&&nr!=="number"&&(ht=JSON.stringify(ht));var cr=nr+":"+ht,kt=nt[cr];kt===void 0&&(Le.push(ht),nt[cr]=kt=Le.length-1),re.writeVarint(kt)}}function Be(Z,re){return(re<<3)+(7&Z)}function $e(Z){return Z<<1^Z>>31}function it(Z,re){for(var oe=Z.loadGeometry(),ge=Z.type,Le=0,Ke=0,nt=oe.length,de=0;de<nt;de++){var Fe=oe[de],ht=1;ge===1&&(ht=Fe.length),re.writeVarint(Be(1,ht));for(var nr=ge===3?Fe.length-1:Fe.length,cr=0;cr<nr;cr++){cr===1&&ge!==1&&re.writeVarint(Be(2,nr-1));var kt=Fe[cr].x-Le,ir=Fe[cr].y-Ke;re.writeVarint($e(kt)),re.writeVarint($e(ir)),Le+=kt,Ke+=ir}ge===3&&re.writeVarint(Be(7,1))}}function mt(Z,re){var oe=typeof Z;oe==="string"?re.writeStringField(1,Z):oe==="boolean"?re.writeBooleanField(7,Z):oe==="number"&&(Z%1!=0?re.writeDoubleField(3,Z):Z<0?re.writeSVarintField(6,Z):re.writeVarintField(5,Z))}function Qe(Z,re,oe,ge){rt(Z,oe,ge),rt(re,2*oe,2*ge),rt(re,2*oe+1,2*ge+1)}function rt(Z,re,oe){var ge=Z[re];Z[re]=Z[oe],Z[oe]=ge}function gt(Z,re,oe,ge){var Le=Z-oe,Ke=re-ge;return Le*Le+Ke*Ke}ue.fromVectorTileJs=xe,ue.fromGeojsonVt=function(Z,re){re=re||{};var oe={};for(var ge in Z)oe[ge]=new Y(Z[ge].features,re),oe[ge].name=ge,oe[ge].version=re.version,oe[ge].extent=re.extent;return xe({layers:oe})},ue.GeoJSONWrapper=ie;var er=function(Z){return Z[0]},zt=function(Z){return Z[1]},qt=function(Z,re,oe,ge,Le){re===void 0&&(re=er),oe===void 0&&(oe=zt),ge===void 0&&(ge=64),Le===void 0&&(Le=Float64Array),this.nodeSize=ge,this.points=Z;for(var Ke=Z.length<65536?Uint16Array:Uint32Array,nt=this.ids=new Ke(Z.length),de=this.coords=new Le(2*Z.length),Fe=0;Fe<Z.length;Fe++)nt[Fe]=Fe,de[2*Fe]=re(Z[Fe]),de[2*Fe+1]=oe(Z[Fe]);(function ht(nr,cr,kt,ir,Sr,nn){if(!(Sr-ir<=kt)){var Dt=ir+Sr>>1;(function Kr(Ir,Dr,ii,Fr,fi,Oi){for(;fi>Fr;){if(fi-Fr>600){var oi=fi-Fr+1,Si=ii-Fr+1,Ti=Math.log(oi),Jo=.5*Math.exp(2*Ti/3),Ni=.5*Math.sqrt(Ti*Jo*(oi-Jo)/oi)*(Si-oi/2<0?-1:1);Kr(Ir,Dr,ii,Math.max(Fr,Math.floor(ii-Si*Jo/oi+Ni)),Math.min(fi,Math.floor(ii+(oi-Si)*Jo/oi+Ni)),Oi)}var Hi=Dr[2*ii+Oi],Di=Fr,ti=fi;for(Qe(Ir,Dr,Fr,ii),Dr[2*fi+Oi]>Hi&&Qe(Ir,Dr,Fr,fi);Di<ti;){for(Qe(Ir,Dr,Di,ti),Di++,ti--;Dr[2*Di+Oi]<Hi;)Di++;for(;Dr[2*ti+Oi]>Hi;)ti--}Dr[2*Fr+Oi]===Hi?Qe(Ir,Dr,Fr,ti):Qe(Ir,Dr,++ti,fi),ti<=ii&&(Fr=ti+1),ii<=ti&&(fi=ti-1)}})(nr,cr,Dt,ir,Sr,nn%2),ht(nr,cr,kt,ir,Dt-1,nn+1),ht(nr,cr,kt,Dt+1,Sr,nn+1)}})(nt,de,ge,0,nt.length-1,0)};qt.prototype.range=function(Z,re,oe,ge){return function(Le,Ke,nt,de,Fe,ht,nr){for(var cr,kt,ir=[0,Le.length-1,0],Sr=[];ir.length;){var nn=ir.pop(),Dt=ir.pop(),Kr=ir.pop();if(Dt-Kr<=nr)for(var Ir=Kr;Ir<=Dt;Ir++)kt=Ke[2*Ir+1],(cr=Ke[2*Ir])>=nt&&cr<=Fe&&kt>=de&&kt<=ht&&Sr.push(Le[Ir]);else{var Dr=Math.floor((Kr+Dt)/2);kt=Ke[2*Dr+1],(cr=Ke[2*Dr])>=nt&&cr<=Fe&&kt>=de&&kt<=ht&&Sr.push(Le[Dr]);var ii=(nn+1)%2;(nn===0?nt<=cr:de<=kt)&&(ir.push(Kr),ir.push(Dr-1),ir.push(ii)),(nn===0?Fe>=cr:ht>=kt)&&(ir.push(Dr+1),ir.push(Dt),ir.push(ii))}}return Sr}(this.ids,this.coords,Z,re,oe,ge,this.nodeSize)},qt.prototype.within=function(Z,re,oe){return function(ge,Le,Ke,nt,de,Fe){for(var ht=[0,ge.length-1,0],nr=[],cr=de*de;ht.length;){var kt=ht.pop(),ir=ht.pop(),Sr=ht.pop();if(ir-Sr<=Fe)for(var nn=Sr;nn<=ir;nn++)gt(Le[2*nn],Le[2*nn+1],Ke,nt)<=cr&&nr.push(ge[nn]);else{var Dt=Math.floor((Sr+ir)/2),Kr=Le[2*Dt],Ir=Le[2*Dt+1];gt(Kr,Ir,Ke,nt)<=cr&&nr.push(ge[Dt]);var Dr=(kt+1)%2;(kt===0?Ke-de<=Kr:nt-de<=Ir)&&(ht.push(Sr),ht.push(Dt-1),ht.push(Dr)),(kt===0?Ke+de>=Kr:nt+de>=Ir)&&(ht.push(Dt+1),ht.push(ir),ht.push(Dr))}}return nr}(this.ids,this.coords,Z,re,oe,this.nodeSize)};var Zr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(Z){return Z}},Wr=function(Z){this.options=mn(Object.create(Zr),Z),this.trees=new Array(this.options.maxZoom+1)};function On(Z,re,oe,ge,Le){return{x:Z,y:re,zoom:1/0,id:oe,parentId:-1,numPoints:ge,properties:Le}}function Ut(Z,re){var oe=Z.geometry.coordinates,ge=oe[1];return{x:Ft(oe[0]),y:Mr(ge),zoom:1/0,index:re,parentId:-1}}function Ar(Z){return{type:"Feature",id:Z.id,properties:an(Z),geometry:{type:"Point",coordinates:[(ge=Z.x,360*(ge-.5)),(re=Z.y,oe=(180-360*re)*Math.PI/180,360*Math.atan(Math.exp(oe))/Math.PI-90)]}};var re,oe,ge}function an(Z){var re=Z.numPoints,oe=re>=1e4?Math.round(re/1e3)+"k":re>=1e3?Math.round(re/100)/10+"k":re;return mn(mn({},Z.properties),{cluster:!0,cluster_id:Z.id,point_count:re,point_count_abbreviated:oe})}function Ft(Z){return Z/360+.5}function Mr(Z){var re=Math.sin(Z*Math.PI/180),oe=.5-.25*Math.log((1+re)/(1-re))/Math.PI;return oe<0?0:oe>1?1:oe}function mn(Z,re){for(var oe in re)Z[oe]=re[oe];return Z}function Nn(Z){return Z.x}function Xn(Z){return Z.y}function qn(Z,re,oe,ge,Le,Ke){var nt=Le-oe,de=Ke-ge;if(nt!==0||de!==0){var Fe=((Z-oe)*nt+(re-ge)*de)/(nt*nt+de*de);Fe>1?(oe=Le,ge=Ke):Fe>0&&(oe+=nt*Fe,ge+=de*Fe)}return(nt=Z-oe)*nt+(de=re-ge)*de}function Li(Z,re,oe,ge){var Le={id:Z===void 0?null:Z,type:re,geometry:oe,tags:ge,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Ke){var nt=Ke.geometry,de=Ke.type;if(de==="Point"||de==="MultiPoint"||de==="LineString")ci(Ke,nt);else if(de==="Polygon"||de==="MultiLineString")for(var Fe=0;Fe<nt.length;Fe++)ci(Ke,nt[Fe]);else if(de==="MultiPolygon")for(Fe=0;Fe<nt.length;Fe++)for(var ht=0;ht<nt[Fe].length;ht++)ci(Ke,nt[Fe][ht])}(Le),Le}function ci(Z,re){for(var oe=0;oe<re.length;oe+=3)Z.minX=Math.min(Z.minX,re[oe]),Z.minY=Math.min(Z.minY,re[oe+1]),Z.maxX=Math.max(Z.maxX,re[oe]),Z.maxY=Math.max(Z.maxY,re[oe+1])}function Ai(Z,re,oe,ge){if(re.geometry){var Le=re.geometry.coordinates,Ke=re.geometry.type,nt=Math.pow(oe.tolerance/((1<<oe.maxZoom)*oe.extent),2),de=[],Fe=re.id;if(oe.promoteId?Fe=re.properties[oe.promoteId]:oe.generateId&&(Fe=ge||0),Ke==="Point")Vi(Le,de);else if(Ke==="MultiPoint")for(var ht=0;ht<Le.length;ht++)Vi(Le[ht],de);else if(Ke==="LineString")za(Le,de,nt,!1);else if(Ke==="MultiLineString"){if(oe.lineMetrics){for(ht=0;ht<Le.length;ht++)za(Le[ht],de=[],nt,!1),Z.push(Li(Fe,"LineString",de,re.properties));return}ia(Le,de,nt,!1)}else if(Ke==="Polygon")ia(Le,de,nt,!0);else{if(Ke!=="MultiPolygon"){if(Ke==="GeometryCollection"){for(ht=0;ht<re.geometry.geometries.length;ht++)Ai(Z,{id:Fe,geometry:re.geometry.geometries[ht],properties:re.properties},oe,ge);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ht=0;ht<Le.length;ht++){var nr=[];ia(Le[ht],nr,nt,!0),de.push(nr)}}Z.push(Li(Fe,Ke,de,re.properties))}}function Vi(Z,re){re.push(X(Z[0])),re.push(Ht(Z[1])),re.push(0)}function za(Z,re,oe,ge){for(var Le,Ke,nt=0,de=0;de<Z.length;de++){var Fe=X(Z[de][0]),ht=Ht(Z[de][1]);re.push(Fe),re.push(ht),re.push(0),de>0&&(nt+=ge?(Le*ht-Fe*Ke)/2:Math.sqrt(Math.pow(Fe-Le,2)+Math.pow(ht-Ke,2))),Le=Fe,Ke=ht}var nr=re.length-3;re[2]=1,function cr(kt,ir,Sr,nn){for(var Dt,Kr=nn,Ir=Sr-ir>>1,Dr=Sr-ir,ii=kt[ir],Fr=kt[ir+1],fi=kt[Sr],Oi=kt[Sr+1],oi=ir+3;oi<Sr;oi+=3){var Si=qn(kt[oi],kt[oi+1],ii,Fr,fi,Oi);if(Si>Kr)Dt=oi,Kr=Si;else if(Si===Kr){var Ti=Math.abs(oi-Ir);Ti<Dr&&(Dt=oi,Dr=Ti)}}Kr>nn&&(Dt-ir>3&&cr(kt,ir,Dt,nn),kt[Dt+2]=Kr,Sr-Dt>3&&cr(kt,Dt,Sr,nn))}(re,0,nr,oe),re[nr+2]=1,re.size=Math.abs(nt),re.start=0,re.end=re.size}function ia(Z,re,oe,ge){for(var Le=0;Le<Z.length;Le++){var Ke=[];za(Z[Le],Ke,oe,ge),re.push(Ke)}}function X(Z){return Z/360+.5}function Ht(Z){var re=Math.sin(Z*Math.PI/180),oe=.5-.25*Math.log((1+re)/(1-re))/Math.PI;return oe<0?0:oe>1?1:oe}function or(Z,re,oe,ge,Le,Ke,nt,de){if(ge/=re,Ke>=(oe/=re)&&nt<ge)return Z;if(nt<oe||Ke>=ge)return null;for(var Fe=[],ht=0;ht<Z.length;ht++){var nr=Z[ht],cr=nr.geometry,kt=nr.type,ir=Le===0?nr.minX:nr.minY,Sr=Le===0?nr.maxX:nr.maxY;if(ir>=oe&&Sr<ge)Fe.push(nr);else if(!(Sr<oe||ir>=ge)){var nn=[];if(kt==="Point"||kt==="MultiPoint")Yr(cr,nn,oe,ge,Le);else if(kt==="LineString")wn(cr,nn,oe,ge,Le,!1,de.lineMetrics);else if(kt==="MultiLineString")Zn(cr,nn,oe,ge,Le,!1);else if(kt==="Polygon")Zn(cr,nn,oe,ge,Le,!0);else if(kt==="MultiPolygon")for(var Dt=0;Dt<cr.length;Dt++){var Kr=[];Zn(cr[Dt],Kr,oe,ge,Le,!0),Kr.length&&nn.push(Kr)}if(nn.length){if(de.lineMetrics&&kt==="LineString"){for(Dt=0;Dt<nn.length;Dt++)Fe.push(Li(nr.id,kt,nn[Dt],nr.tags));continue}kt!=="LineString"&&kt!=="MultiLineString"||(nn.length===1?(kt="LineString",nn=nn[0]):kt="MultiLineString"),kt!=="Point"&&kt!=="MultiPoint"||(kt=nn.length===3?"Point":"MultiPoint"),Fe.push(Li(nr.id,kt,nn,nr.tags))}}}return Fe.length?Fe:null}function Yr(Z,re,oe,ge,Le){for(var Ke=0;Ke<Z.length;Ke+=3){var nt=Z[Ke+Le];nt>=oe&&nt<=ge&&(re.push(Z[Ke]),re.push(Z[Ke+1]),re.push(Z[Ke+2]))}}function wn(Z,re,oe,ge,Le,Ke,nt){for(var de,Fe,ht=Qi(Z),nr=Le===0?Dn:di,cr=Z.start,kt=0;kt<Z.length-3;kt+=3){var ir=Z[kt],Sr=Z[kt+1],nn=Z[kt+2],Dt=Z[kt+3],Kr=Z[kt+4],Ir=Le===0?ir:Sr,Dr=Le===0?Dt:Kr,ii=!1;nt&&(de=Math.sqrt(Math.pow(ir-Dt,2)+Math.pow(Sr-Kr,2))),Ir<oe?Dr>oe&&(Fe=nr(ht,ir,Sr,Dt,Kr,oe),nt&&(ht.start=cr+de*Fe)):Ir>ge?Dr<ge&&(Fe=nr(ht,ir,Sr,Dt,Kr,ge),nt&&(ht.start=cr+de*Fe)):Hn(ht,ir,Sr,nn),Dr<oe&&Ir>=oe&&(Fe=nr(ht,ir,Sr,Dt,Kr,oe),ii=!0),Dr>ge&&Ir<=ge&&(Fe=nr(ht,ir,Sr,Dt,Kr,ge),ii=!0),!Ke&&ii&&(nt&&(ht.end=cr+de*Fe),re.push(ht),ht=Qi(Z)),nt&&(cr+=de)}var Fr=Z.length-3;ir=Z[Fr],Sr=Z[Fr+1],nn=Z[Fr+2],(Ir=Le===0?ir:Sr)>=oe&&Ir<=ge&&Hn(ht,ir,Sr,nn),Fr=ht.length-3,Ke&&Fr>=3&&(ht[Fr]!==ht[0]||ht[Fr+1]!==ht[1])&&Hn(ht,ht[0],ht[1],ht[2]),ht.length&&re.push(ht)}function Qi(Z){var re=[];return re.size=Z.size,re.start=Z.start,re.end=Z.end,re}function Zn(Z,re,oe,ge,Le,Ke){for(var nt=0;nt<Z.length;nt++)wn(Z[nt],re,oe,ge,Le,Ke,!1)}function Hn(Z,re,oe,ge){Z.push(re),Z.push(oe),Z.push(ge)}function Dn(Z,re,oe,ge,Le,Ke){var nt=(Ke-re)/(ge-re);return Z.push(Ke),Z.push(oe+(Le-oe)*nt),Z.push(1),nt}function di(Z,re,oe,ge,Le,Ke){var nt=(Ke-oe)/(Le-oe);return Z.push(re+(ge-re)*nt),Z.push(Ke),Z.push(1),nt}function wt(Z,re){for(var oe=[],ge=0;ge<Z.length;ge++){var Le,Ke=Z[ge],nt=Ke.type;if(nt==="Point"||nt==="MultiPoint"||nt==="LineString")Le=rn(Ke.geometry,re);else if(nt==="MultiLineString"||nt==="Polygon"){Le=[];for(var de=0;de<Ke.geometry.length;de++)Le.push(rn(Ke.geometry[de],re))}else if(nt==="MultiPolygon")for(Le=[],de=0;de<Ke.geometry.length;de++){for(var Fe=[],ht=0;ht<Ke.geometry[de].length;ht++)Fe.push(rn(Ke.geometry[de][ht],re));Le.push(Fe)}oe.push(Li(Ke.id,nt,Le,Ke.tags))}return oe}function rn(Z,re){var oe=[];oe.size=Z.size,Z.start!==void 0&&(oe.start=Z.start,oe.end=Z.end);for(var ge=0;ge<Z.length;ge+=3)oe.push(Z[ge]+re,Z[ge+1],Z[ge+2]);return oe}function En(Z,re){if(Z.transformed)return Z;var oe,ge,Le,Ke=1<<Z.z,nt=Z.x,de=Z.y;for(oe=0;oe<Z.features.length;oe++){var Fe=Z.features[oe],ht=Fe.geometry,nr=Fe.type;if(Fe.geometry=[],nr===1)for(ge=0;ge<ht.length;ge+=2)Fe.geometry.push(Ii(ht[ge],ht[ge+1],re,Ke,nt,de));else for(ge=0;ge<ht.length;ge++){var cr=[];for(Le=0;Le<ht[ge].length;Le+=2)cr.push(Ii(ht[ge][Le],ht[ge][Le+1],re,Ke,nt,de));Fe.geometry.push(cr)}}return Z.transformed=!0,Z}function Ii(Z,re,oe,ge,Le,Ke){return[Math.round(oe*(Z*ge-Le)),Math.round(oe*(re*ge-Ke))]}function ki(Z,re,oe,ge,Le){for(var Ke=re===Le.maxZoom?0:Le.tolerance/((1<<re)*Le.extent),nt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:oe,y:ge,z:re,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},de=0;de<Z.length;de++){nt.numFeatures++,uo(nt,Z[de],Ke,Le);var Fe=Z[de].minX,ht=Z[de].minY,nr=Z[de].maxX,cr=Z[de].maxY;Fe<nt.minX&&(nt.minX=Fe),ht<nt.minY&&(nt.minY=ht),nr>nt.maxX&&(nt.maxX=nr),cr>nt.maxY&&(nt.maxY=cr)}return nt}function uo(Z,re,oe,ge){var Le=re.geometry,Ke=re.type,nt=[];if(Ke==="Point"||Ke==="MultiPoint")for(var de=0;de<Le.length;de+=3)nt.push(Le[de]),nt.push(Le[de+1]),Z.numPoints++,Z.numSimplified++;else if(Ke==="LineString")go(nt,Le,Z,oe,!1,!1);else if(Ke==="MultiLineString"||Ke==="Polygon")for(de=0;de<Le.length;de++)go(nt,Le[de],Z,oe,Ke==="Polygon",de===0);else if(Ke==="MultiPolygon")for(var Fe=0;Fe<Le.length;Fe++){var ht=Le[Fe];for(de=0;de<ht.length;de++)go(nt,ht[de],Z,oe,!0,de===0)}if(nt.length){var nr=re.tags||null;if(Ke==="LineString"&&ge.lineMetrics){for(var cr in nr={},re.tags)nr[cr]=re.tags[cr];nr.mapbox_clip_start=Le.start/Le.size,nr.mapbox_clip_end=Le.end/Le.size}var kt={geometry:nt,type:Ke==="Polygon"||Ke==="MultiPolygon"?3:Ke==="LineString"||Ke==="MultiLineString"?2:1,tags:nr};re.id!==null&&(kt.id=re.id),Z.features.push(kt)}}function go(Z,re,oe,ge,Le,Ke){var nt=ge*ge;if(ge>0&&re.size<(Le?nt:ge))oe.numPoints+=re.length/3;else{for(var de=[],Fe=0;Fe<re.length;Fe+=3)(ge===0||re[Fe+2]>nt)&&(oe.numSimplified++,de.push(re[Fe]),de.push(re[Fe+1])),oe.numPoints++;Le&&function(ht,nr){for(var cr=0,kt=0,ir=ht.length,Sr=ir-2;kt<ir;Sr=kt,kt+=2)cr+=(ht[kt]-ht[Sr])*(ht[kt+1]+ht[Sr+1]);if(cr>0===nr)for(kt=0,ir=ht.length;kt<ir/2;kt+=2){var nn=ht[kt],Dt=ht[kt+1];ht[kt]=ht[ir-2-kt],ht[kt+1]=ht[ir-1-kt],ht[ir-2-kt]=nn,ht[ir-1-kt]=Dt}}(de,Ke),Z.push(de)}}function yo(Z,re){var oe=(re=this.options=function(Le,Ke){for(var nt in Ke)Le[nt]=Ke[nt];return Le}(Object.create(this.options),re)).debug;if(re.maxZoom<0||re.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(re.promoteId&&re.generateId)throw new Error("promoteId and generateId cannot be used together.");var ge=function(Le,Ke){var nt=[];if(Le.type==="FeatureCollection")for(var de=0;de<Le.features.length;de++)Ai(nt,Le.features[de],Ke,de);else Ai(nt,Le.type==="Feature"?Le:{geometry:Le},Ke);return nt}(Z,re);this.tiles={},this.tileCoords=[],oe&&(this.stats={},this.total=0),(ge=function(Le,Ke){var nt=Ke.buffer/Ke.extent,de=Le,Fe=or(Le,1,-1-nt,nt,0,-1,2,Ke),ht=or(Le,1,1-nt,2+nt,0,-1,2,Ke);return(Fe||ht)&&(de=or(Le,1,-nt,1+nt,0,-1,2,Ke)||[],Fe&&(de=wt(Fe,1).concat(de)),ht&&(de=de.concat(wt(ht,-1)))),de}(ge,re)).length&&this.splitTile(ge,0,0,0),oe&&ge.length}function Fs(Z,re,oe){return 32*((1<<Z)*oe+re)+Z}function Ss(Z,re){var oe=Z.tileID.canonical;if(!this._geoJSONIndex)return re(null,null);var ge=this._geoJSONIndex.getTile(oe.z,oe.x,oe.y);if(!ge)return re(null,null);var Le=new H(ge.features),Ke=ue(Le);Ke.byteOffset===0&&Ke.byteLength===Ke.buffer.byteLength||(Ke=new Uint8Array(Ke)),re(null,{vectorTile:Le,rawData:Ke.buffer})}Wr.prototype.load=function(Z){var re=this.options,oe=re.log,ge=re.minZoom,Le=re.maxZoom,Ke=re.nodeSize,nt="prepare "+Z.length+" points";this.points=Z;for(var de=[],Fe=0;Fe<Z.length;Fe++)Z[Fe].geometry&&de.push(Ut(Z[Fe],Fe));this.trees[Le+1]=new qt(de,Nn,Xn,Ke,Float32Array);for(var ht=Le;ht>=ge;ht--){var nr=+Date.now();de=this._cluster(de,ht),this.trees[ht]=new qt(de,Nn,Xn,Ke,Float32Array)}return this},Wr.prototype.getClusters=function(Z,re){var oe=((Z[0]+180)%360+360)%360-180,ge=Math.max(-90,Math.min(90,Z[1])),Le=Z[2]===180?180:((Z[2]+180)%360+360)%360-180,Ke=Math.max(-90,Math.min(90,Z[3]));if(Z[2]-Z[0]>=360)oe=-180,Le=180;else if(oe>Le){var nt=this.getClusters([oe,ge,180,Ke],re),de=this.getClusters([-180,ge,Le,Ke],re);return nt.concat(de)}for(var Fe=this.trees[this._limitZoom(re)],ht=[],nr=0,cr=Fe.range(Ft(oe),Mr(Ke),Ft(Le),Mr(ge));nr<cr.length;nr+=1){var kt=Fe.points[cr[nr]];ht.push(kt.numPoints?Ar(kt):this.points[kt.index])}return ht},Wr.prototype.getChildren=function(Z){var re=this._getOriginId(Z),oe=this._getOriginZoom(Z),ge="No cluster with the specified id.",Le=this.trees[oe];if(!Le)throw new Error(ge);var Ke=Le.points[re];if(!Ke)throw new Error(ge);for(var nt=this.options.radius/(this.options.extent*Math.pow(2,oe-1)),de=[],Fe=0,ht=Le.within(Ke.x,Ke.y,nt);Fe<ht.length;Fe+=1){var nr=Le.points[ht[Fe]];nr.parentId===Z&&de.push(nr.numPoints?Ar(nr):this.points[nr.index])}if(de.length===0)throw new Error(ge);return de},Wr.prototype.getLeaves=function(Z,re,oe){var ge=[];return this._appendLeaves(ge,Z,re=re||10,oe=oe||0,0),ge},Wr.prototype.getTile=function(Z,re,oe){var ge=this.trees[this._limitZoom(Z)],Le=Math.pow(2,Z),Ke=this.options,nt=Ke.radius/Ke.extent,de=(oe-nt)/Le,Fe=(oe+1+nt)/Le,ht={features:[]};return this._addTileFeatures(ge.range((re-nt)/Le,de,(re+1+nt)/Le,Fe),ge.points,re,oe,Le,ht),re===0&&this._addTileFeatures(ge.range(1-nt/Le,de,1,Fe),ge.points,Le,oe,Le,ht),re===Le-1&&this._addTileFeatures(ge.range(0,de,nt/Le,Fe),ge.points,-1,oe,Le,ht),ht.features.length?ht:null},Wr.prototype.getClusterExpansionZoom=function(Z){for(var re=this._getOriginZoom(Z)-1;re<=this.options.maxZoom;){var oe=this.getChildren(Z);if(re++,oe.length!==1)break;Z=oe[0].properties.cluster_id}return re},Wr.prototype._appendLeaves=function(Z,re,oe,ge,Le){for(var Ke=0,nt=this.getChildren(re);Ke<nt.length;Ke+=1){var de=nt[Ke],Fe=de.properties;if(Fe&&Fe.cluster?Le+Fe.point_count<=ge?Le+=Fe.point_count:Le=this._appendLeaves(Z,Fe.cluster_id,oe,ge,Le):Le<ge?Le++:Z.push(de),Z.length===oe)break}return Le},Wr.prototype._addTileFeatures=function(Z,re,oe,ge,Le,Ke){for(var nt=0,de=Z;nt<de.length;nt+=1){var Fe=re[de[nt]],ht=Fe.numPoints,nr={type:1,geometry:[[Math.round(this.options.extent*(Fe.x*Le-oe)),Math.round(this.options.extent*(Fe.y*Le-ge))]],tags:ht?an(Fe):this.points[Fe.index].properties},cr=void 0;ht?cr=Fe.id:this.options.generateId?cr=Fe.index:this.points[Fe.index].id&&(cr=this.points[Fe.index].id),cr!==void 0&&(nr.id=cr),Ke.features.push(nr)}},Wr.prototype._limitZoom=function(Z){return Math.max(this.options.minZoom,Math.min(+Z,this.options.maxZoom+1))},Wr.prototype._cluster=function(Z,re){for(var oe=[],ge=this.options,Le=ge.reduce,Ke=ge.minPoints,nt=ge.radius/(ge.extent*Math.pow(2,re)),de=0;de<Z.length;de++){var Fe=Z[de];if(!(Fe.zoom<=re)){Fe.zoom=re;for(var ht=this.trees[re+1],nr=ht.within(Fe.x,Fe.y,nt),cr=Fe.numPoints||1,kt=cr,ir=0,Sr=nr;ir<Sr.length;ir+=1){var nn=ht.points[Sr[ir]];nn.zoom>re&&(kt+=nn.numPoints||1)}if(kt>=Ke){for(var Dt=Fe.x*cr,Kr=Fe.y*cr,Ir=Le&&cr>1?this._map(Fe,!0):null,Dr=(de<<5)+(re+1)+this.points.length,ii=0,Fr=nr;ii<Fr.length;ii+=1){var fi=ht.points[Fr[ii]];if(!(fi.zoom<=re)){fi.zoom=re;var Oi=fi.numPoints||1;Dt+=fi.x*Oi,Kr+=fi.y*Oi,fi.parentId=Dr,Le&&(Ir||(Ir=this._map(Fe,!0)),Le(Ir,this._map(fi)))}}Fe.parentId=Dr,oe.push(On(Dt/kt,Kr/kt,Dr,kt,Ir))}else if(oe.push(Fe),kt>1)for(var oi=0,Si=nr;oi<Si.length;oi+=1){var Ti=ht.points[Si[oi]];Ti.zoom<=re||(Ti.zoom=re,oe.push(Ti))}}}return oe},Wr.prototype._getOriginId=function(Z){return Z-this.points.length>>5},Wr.prototype._getOriginZoom=function(Z){return(Z-this.points.length)%32},Wr.prototype._map=function(Z,re){if(Z.numPoints)return re?mn({},Z.properties):Z.properties;var oe=this.points[Z.index].properties,ge=this.options.map(oe);return re&&ge===oe?mn({},ge):ge},yo.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},yo.prototype.splitTile=function(Z,re,oe,ge,Le,Ke,nt){for(var de=[Z,re,oe,ge],Fe=this.options,ht=Fe.debug;de.length;){ge=de.pop(),oe=de.pop(),re=de.pop(),Z=de.pop();var nr=1<<re,cr=Fs(re,oe,ge),kt=this.tiles[cr];if(!kt&&(ht>1,kt=this.tiles[cr]=ki(Z,re,oe,ge,Fe),this.tileCoords.push({z:re,x:oe,y:ge}),ht)){ht>1;var ir="z"+re;this.stats[ir]=(this.stats[ir]||0)+1,this.total++}if(kt.source=Z,Le){if(re===Fe.maxZoom||re===Le)continue;var Sr=1<<Le-re;if(oe!==Math.floor(Ke/Sr)||ge!==Math.floor(nt/Sr))continue}else if(re===Fe.indexMaxZoom||kt.numPoints<=Fe.indexMaxPoints)continue;if(kt.source=null,Z.length!==0){ht>1;var nn,Dt,Kr,Ir,Dr,ii,Fr=.5*Fe.buffer/Fe.extent,fi=.5-Fr,Oi=.5+Fr,oi=1+Fr;nn=Dt=Kr=Ir=null,Dr=or(Z,nr,oe-Fr,oe+Oi,0,kt.minX,kt.maxX,Fe),ii=or(Z,nr,oe+fi,oe+oi,0,kt.minX,kt.maxX,Fe),Z=null,Dr&&(nn=or(Dr,nr,ge-Fr,ge+Oi,1,kt.minY,kt.maxY,Fe),Dt=or(Dr,nr,ge+fi,ge+oi,1,kt.minY,kt.maxY,Fe),Dr=null),ii&&(Kr=or(ii,nr,ge-Fr,ge+Oi,1,kt.minY,kt.maxY,Fe),Ir=or(ii,nr,ge+fi,ge+oi,1,kt.minY,kt.maxY,Fe),ii=null),ht>1,de.push(nn||[],re+1,2*oe,2*ge),de.push(Dt||[],re+1,2*oe,2*ge+1),de.push(Kr||[],re+1,2*oe+1,2*ge),de.push(Ir||[],re+1,2*oe+1,2*ge+1)}}},yo.prototype.getTile=function(Z,re,oe){var ge=this.options,Le=ge.extent,Ke=ge.debug;if(Z<0||Z>24)return null;var nt=1<<Z,de=Fs(Z,re=(re%nt+nt)%nt,oe);if(this.tiles[de])return En(this.tiles[de],Le);Ke>1;for(var Fe,ht=Z,nr=re,cr=oe;!Fe&&ht>0;)ht--,nr=Math.floor(nr/2),cr=Math.floor(cr/2),Fe=this.tiles[Fs(ht,nr,cr)];return Fe&&Fe.source?(Ke>1,Ke>1,this.splitTile(Fe.source,ht,nr,cr,Z,re,oe),Ke>1,this.tiles[de]?En(this.tiles[de],Le):null):null};var Su=function(Z){function re(oe,ge,Le,Ke){Z.call(this,oe,ge,Le,Ss),Ke&&(this.loadGeoJSON=Ke)}return Z&&(re.__proto__=Z),(re.prototype=Object.create(Z&&Z.prototype)).constructor=re,re.prototype.loadData=function(oe,ge){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=ge,this._pendingLoadDataParams=oe,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},re.prototype._loadData=function(){var oe=this;if(this._pendingCallback&&this._pendingLoadDataParams){var ge=this._pendingCallback,Le=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var Ke=!!(Le&&Le.request&&Le.request.collectResourceTiming)&&new a.RequestPerformance(Le.request);this.loadGeoJSON(Le,function(nt,de){if(nt||!de)return ge(nt);if(typeof de!="object")return ge(new Error("Input data given to '"+Le.source+"' is not a valid GeoJSON object."));(function kt(ir,Sr){var nn,Dt=ir&&ir.type;if(Dt==="FeatureCollection")for(nn=0;nn<ir.features.length;nn++)kt(ir.features[nn],Sr);else if(Dt==="GeometryCollection")for(nn=0;nn<ir.geometries.length;nn++)kt(ir.geometries[nn],Sr);else if(Dt==="Feature")kt(ir.geometry,Sr);else if(Dt==="Polygon")V(ir.coordinates,Sr);else if(Dt==="MultiPolygon")for(nn=0;nn<ir.coordinates.length;nn++)V(ir.coordinates[nn],Sr);return ir})(de,!0);try{if(Le.filter){var Fe=a.createExpression(Le.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Fe.result==="error")throw new Error(Fe.value.map(function(kt){return kt.key+": "+kt.message}).join(", "));var ht=de.features.filter(function(kt){return Fe.value.evaluate({zoom:0},kt)});de={type:"FeatureCollection",features:ht}}oe._geoJSONIndex=Le.cluster?new Wr(function(kt){var ir=kt.superclusterOptions,Sr=kt.clusterProperties;if(!Sr||!ir)return ir;for(var nn={},Dt={},Kr={accumulated:null,zoom:0},Ir={properties:null},Dr=Object.keys(Sr),ii=0,Fr=Dr;ii<Fr.length;ii+=1){var fi=Fr[ii],Oi=Sr[fi],oi=Oi[0],Si=a.createExpression(Oi[1]),Ti=a.createExpression(typeof oi=="string"?[oi,["accumulated"],["get",fi]]:oi);nn[fi]=Si.value,Dt[fi]=Ti.value}return ir.map=function(Jo){Ir.properties=Jo;for(var Ni={},Hi=0,Di=Dr;Hi<Di.length;Hi+=1){var ti=Di[Hi];Ni[ti]=nn[ti].evaluate(Kr,Ir)}return Ni},ir.reduce=function(Jo,Ni){Ir.properties=Ni;for(var Hi=0,Di=Dr;Hi<Di.length;Hi+=1){var ti=Di[Hi];Kr.accumulated=Jo[ti],Jo[ti]=Dt[ti].evaluate(Kr,Ir)}},ir}(Le)).load(de.features):function(kt,ir){return new yo(kt,ir)}(de,Le.geojsonVtOptions)}catch(kt){return ge(kt)}oe.loaded={};var nr={};if(Ke){var cr=Ke.finish();cr&&(nr.resourceTiming={},nr.resourceTiming[Le.source]=JSON.parse(JSON.stringify(cr)))}ge(null,nr)})}},re.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},re.prototype.reloadTile=function(oe,ge){var Le=this.loaded;return Le&&Le[oe.uid]?Z.prototype.reloadTile.call(this,oe,ge):this.loadTile(oe,ge)},re.prototype.loadGeoJSON=function(oe,ge){if(oe.request)a.getJSON(oe.request,ge);else{if(typeof oe.data!="string")return ge(new Error("Input data given to '"+oe.source+"' is not a valid GeoJSON object."));try{return ge(null,JSON.parse(oe.data))}catch{return ge(new Error("Input data given to '"+oe.source+"' is not a valid GeoJSON object."))}}},re.prototype.removeSource=function(oe,ge){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),ge()},re.prototype.getClusterExpansionZoom=function(oe,ge){try{ge(null,this._geoJSONIndex.getClusterExpansionZoom(oe.clusterId))}catch(Le){ge(Le)}},re.prototype.getClusterChildren=function(oe,ge){try{ge(null,this._geoJSONIndex.getChildren(oe.clusterId))}catch(Le){ge(Le)}},re.prototype.getClusterLeaves=function(oe,ge){try{ge(null,this._geoJSONIndex.getLeaves(oe.clusterId,oe.limit,oe.offset))}catch(Le){ge(Le)}},re}(I),ha=function(Z){var re=this;this.self=Z,this.actor=new a.Actor(Z,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:I,geojson:Su},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(oe,ge){if(re.workerSourceTypes[oe])throw new Error('Worker source with name "'+oe+'" already registered.');re.workerSourceTypes[oe]=ge},this.self.registerRTLTextPlugin=function(oe){if(a.plugin.isParsed())throw new Error("RTL text plugin already registered.");a.plugin.applyArabicShaping=oe.applyArabicShaping,a.plugin.processBidirectionalText=oe.processBidirectionalText,a.plugin.processStyledBidirectionalText=oe.processStyledBidirectionalText}};return ha.prototype.setReferrer=function(Z,re){this.referrer=re},ha.prototype.setImages=function(Z,re,oe){for(var ge in this.availableImages[Z]=re,this.workerSources[Z]){var Le=this.workerSources[Z][ge];for(var Ke in Le)Le[Ke].availableImages=re}oe()},ha.prototype.setLayers=function(Z,re,oe){this.getLayerIndex(Z).replace(re),oe()},ha.prototype.updateLayers=function(Z,re,oe){this.getLayerIndex(Z).update(re.layers,re.removedIds),oe()},ha.prototype.loadTile=function(Z,re,oe){this.getWorkerSource(Z,re.type,re.source).loadTile(re,oe)},ha.prototype.loadDEMTile=function(Z,re,oe){this.getDEMWorkerSource(Z,re.source).loadTile(re,oe)},ha.prototype.reloadTile=function(Z,re,oe){this.getWorkerSource(Z,re.type,re.source).reloadTile(re,oe)},ha.prototype.abortTile=function(Z,re,oe){this.getWorkerSource(Z,re.type,re.source).abortTile(re,oe)},ha.prototype.removeTile=function(Z,re,oe){this.getWorkerSource(Z,re.type,re.source).removeTile(re,oe)},ha.prototype.removeDEMTile=function(Z,re){this.getDEMWorkerSource(Z,re.source).removeTile(re)},ha.prototype.removeSource=function(Z,re,oe){if(this.workerSources[Z]&&this.workerSources[Z][re.type]&&this.workerSources[Z][re.type][re.source]){var ge=this.workerSources[Z][re.type][re.source];delete this.workerSources[Z][re.type][re.source],ge.removeSource!==void 0?ge.removeSource(re,oe):oe()}},ha.prototype.loadWorkerSource=function(Z,re,oe){try{this.self.importScripts(re.url),oe()}catch(ge){oe(ge.toString())}},ha.prototype.syncRTLPluginState=function(Z,re,oe){try{a.plugin.setState(re);var ge=a.plugin.getPluginURL();if(a.plugin.isLoaded()&&!a.plugin.isParsed()&&ge!=null){this.self.importScripts(ge);var Le=a.plugin.isParsed();oe(Le?void 0:new Error("RTL Text Plugin failed to import scripts from "+ge),Le)}}catch(Ke){oe(Ke.toString())}},ha.prototype.getAvailableImages=function(Z){var re=this.availableImages[Z];return re||(re=[]),re},ha.prototype.getLayerIndex=function(Z){var re=this.layerIndexes[Z];return re||(re=this.layerIndexes[Z]=new h),re},ha.prototype.getWorkerSource=function(Z,re,oe){var ge=this;return this.workerSources[Z]||(this.workerSources[Z]={}),this.workerSources[Z][re]||(this.workerSources[Z][re]={}),this.workerSources[Z][re][oe]||(this.workerSources[Z][re][oe]=new this.workerSourceTypes[re]({send:function(Le,Ke,nt){ge.actor.send(Le,Ke,nt,Z)}},this.getLayerIndex(Z),this.getAvailableImages(Z))),this.workerSources[Z][re][oe]},ha.prototype.getDEMWorkerSource=function(Z,re){return this.demWorkerSources[Z]||(this.demWorkerSources[Z]={}),this.demWorkerSources[Z][re]||(this.demWorkerSources[Z][re]=new D),this.demWorkerSources[Z][re]},ha.prototype.enforceCacheSizeLimit=function(Z,re){a.enforceCacheSizeLimit(re)},typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new ha(self)),ha}),o(["./shared"],function(a){var u=a.createCommonjsModule(function(p){function v(A){return!d(A)}function d(A){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var R,B,G=new Blob([""],{type:"text/javascript"}),J=URL.createObjectURL(G);try{B=new Worker(J),R=!0}catch{R=!1}return B&&B.terminate(),URL.revokeObjectURL(J),R}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var R=document.createElement("canvas");R.width=R.height=1;var B=R.getContext("2d");if(!B)return!1;var G=B.getImageData(0,0,1,1);return G&&G.width===R.width}()?(_[M=A&&A.failIfMajorPerformanceCaveat]===void 0&&(_[M]=function(R){var B=function(J){var ce=document.createElement("canvas"),ve=Object.create(v.webGLContextAttributes);return ve.failIfMajorPerformanceCaveat=J,ce.probablySupportsContext?ce.probablySupportsContext("webgl",ve)||ce.probablySupportsContext("experimental-webgl",ve):ce.supportsContext?ce.supportsContext("webgl",ve)||ce.supportsContext("experimental-webgl",ve):ce.getContext("webgl",ve)||ce.getContext("experimental-webgl",ve)}(R);if(!B)return!1;var G=B.createShader(B.VERTEX_SHADER);return!(!G||B.isContextLost())&&(B.shaderSource(G,"void main() {}"),B.compileShader(G),B.getShaderParameter(G,B.COMPILE_STATUS)===!0)}(M)),_[M]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var M}p.exports?p.exports=v:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=v,window.mapboxgl.notSupportedReason=d);var _={};v.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),c={create:function(p,v,d){var _=a.window.document.createElement(p);return v!==void 0&&(_.className=v),d&&d.appendChild(_),_},createNS:function(p,v){return a.window.document.createElementNS(p,v)}},h=a.window.document&&a.window.document.documentElement.style;function y(p){if(!h)return p[0];for(var v=0;v<p.length;v++)if(p[v]in h)return p[v];return p[0]}var x,E=y(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);c.disableDrag=function(){h&&E&&(x=h[E],h[E]="none")},c.enableDrag=function(){h&&E&&(h[E]=x)};var T=y(["transform","WebkitTransform"]);c.setTransform=function(p,v){p.style[T]=v};var I=!1;try{var k=Object.defineProperty({},"passive",{get:function(){I=!0}});a.window.addEventListener("test",k,k),a.window.removeEventListener("test",k,k)}catch{I=!1}c.addEventListener=function(p,v,d,_){_===void 0&&(_={}),p.addEventListener(v,d,"passive"in _&&I?_:_.capture)},c.removeEventListener=function(p,v,d,_){_===void 0&&(_={}),p.removeEventListener(v,d,"passive"in _&&I?_:_.capture)};var D=function(p){p.preventDefault(),p.stopPropagation(),a.window.removeEventListener("click",D,!0)};function V(p){var v=p.userImage;return!!(v&&v.render&&v.render())&&(p.data.replace(new Uint8Array(v.data.buffer)),!0)}c.suppressClick=function(){a.window.addEventListener("click",D,!0),a.window.setTimeout(function(){a.window.removeEventListener("click",D,!0)},0)},c.mousePos=function(p,v){var d=p.getBoundingClientRect();return new a.Point(v.clientX-d.left-p.clientLeft,v.clientY-d.top-p.clientTop)},c.touchPos=function(p,v){for(var d=p.getBoundingClientRect(),_=[],A=0;A<v.length;A++)_.push(new a.Point(v[A].clientX-d.left-p.clientLeft,v[A].clientY-d.top-p.clientTop));return _},c.mouseButton=function(p){return a.window.InstallTrigger!==void 0&&p.button===2&&p.ctrlKey&&a.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:p.button},c.remove=function(p){p.parentNode&&p.parentNode.removeChild(p)};var O=function(p){function v(){p.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new a.RGBAImage({width:1,height:1}),this.dirty=!0}return p&&(v.__proto__=p),(v.prototype=Object.create(p&&p.prototype)).constructor=v,v.prototype.isLoaded=function(){return this.loaded},v.prototype.setLoaded=function(d){if(this.loaded!==d&&(this.loaded=d,d)){for(var _=0,A=this.requestors;_<A.length;_+=1){var M=A[_];this._notify(M.ids,M.callback)}this.requestors=[]}},v.prototype.getImage=function(d){return this.images[d]},v.prototype.addImage=function(d,_){this._validate(d,_)&&(this.images[d]=_)},v.prototype._validate=function(d,_){var A=!0;return this._validateStretch(_.stretchX,_.data&&_.data.width)||(this.fire(new a.ErrorEvent(new Error('Image "'+d+'" has invalid "stretchX" value'))),A=!1),this._validateStretch(_.stretchY,_.data&&_.data.height)||(this.fire(new a.ErrorEvent(new Error('Image "'+d+'" has invalid "stretchY" value'))),A=!1),this._validateContent(_.content,_)||(this.fire(new a.ErrorEvent(new Error('Image "'+d+'" has invalid "content" value'))),A=!1),A},v.prototype._validateStretch=function(d,_){if(!d)return!0;for(var A=0,M=0,R=d;M<R.length;M+=1){var B=R[M];if(B[0]<A||B[1]<B[0]||_<B[1])return!1;A=B[1]}return!0},v.prototype._validateContent=function(d,_){return!(d&&(d.length!==4||d[0]<0||_.data.width<d[0]||d[1]<0||_.data.height<d[1]||d[2]<0||_.data.width<d[2]||d[3]<0||_.data.height<d[3]||d[2]<d[0]||d[3]<d[1]))},v.prototype.updateImage=function(d,_){_.version=this.images[d].version+1,this.images[d]=_,this.updatedImages[d]=!0},v.prototype.removeImage=function(d){var _=this.images[d];delete this.images[d],delete this.patterns[d],_.userImage&&_.userImage.onRemove&&_.userImage.onRemove()},v.prototype.listImages=function(){return Object.keys(this.images)},v.prototype.getImages=function(d,_){var A=!0;if(!this.isLoaded())for(var M=0,R=d;M<R.length;M+=1)this.images[R[M]]||(A=!1);this.isLoaded()||A?this._notify(d,_):this.requestors.push({ids:d,callback:_})},v.prototype._notify=function(d,_){for(var A={},M=0,R=d;M<R.length;M+=1){var B=R[M];this.images[B]||this.fire(new a.Event("styleimagemissing",{id:B}));var G=this.images[B];G?A[B]={data:G.data.clone(),pixelRatio:G.pixelRatio,sdf:G.sdf,version:G.version,stretchX:G.stretchX,stretchY:G.stretchY,content:G.content,hasRenderCallback:!!(G.userImage&&G.userImage.render)}:a.warnOnce('Image "'+B+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}_(null,A)},v.prototype.getPixelSize=function(){var d=this.atlasImage;return{width:d.width,height:d.height}},v.prototype.getPattern=function(d){var _=this.patterns[d],A=this.getImage(d);if(!A)return null;if(_&&_.position.version===A.version)return _.position;if(_)_.position.version=A.version;else{var M={w:A.data.width+2,h:A.data.height+2,x:0,y:0},R=new a.ImagePosition(M,A);this.patterns[d]={bin:M,position:R}}return this._updatePatternAtlas(),this.patterns[d].position},v.prototype.bind=function(d){var _=d.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new a.Texture(d,this.atlasImage,_.RGBA),this.atlasTexture.bind(_.LINEAR,_.CLAMP_TO_EDGE)},v.prototype._updatePatternAtlas=function(){var d=[];for(var _ in this.patterns)d.push(this.patterns[_].bin);var A=a.potpack(d),M=A.w,R=A.h,B=this.atlasImage;for(var G in B.resize({width:M||1,height:R||1}),this.patterns){var J=this.patterns[G].bin,ce=J.x+1,ve=J.y+1,ye=this.images[G].data,Oe=ye.width,Re=ye.height;a.RGBAImage.copy(ye,B,{x:0,y:0},{x:ce,y:ve},{width:Oe,height:Re}),a.RGBAImage.copy(ye,B,{x:0,y:Re-1},{x:ce,y:ve-1},{width:Oe,height:1}),a.RGBAImage.copy(ye,B,{x:0,y:0},{x:ce,y:ve+Re},{width:Oe,height:1}),a.RGBAImage.copy(ye,B,{x:Oe-1,y:0},{x:ce-1,y:ve},{width:1,height:Re}),a.RGBAImage.copy(ye,B,{x:0,y:0},{x:ce+Oe,y:ve},{width:1,height:Re})}this.dirty=!0},v.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},v.prototype.dispatchRenderCallbacks=function(d){for(var _=0,A=d;_<A.length;_+=1){var M=A[_];if(!this.callbackDispatchedThisFrame[M]){this.callbackDispatchedThisFrame[M]=!0;var R=this.images[M];V(R)&&this.updateImage(M,R)}}},v}(a.Evented),F=q,N=q,H=1e20;function q(p,v,d,_,A,M){this.fontSize=p||24,this.buffer=v===void 0?3:v,this.cutoff=_||.25,this.fontFamily=A||"sans-serif",this.fontWeight=M||"normal",this.radius=d||8;var R=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=R,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(R*R),this.gridInner=new Float64Array(R*R),this.f=new Float64Array(R),this.d=new Float64Array(R),this.z=new Float64Array(R+1),this.v=new Int16Array(R),this.middle=Math.round(R/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Y(p,v,d,_,A,M,R){for(var B=0;B<v;B++){for(var G=0;G<d;G++)_[G]=p[G*v+B];for(ee(_,A,M,R,d),G=0;G<d;G++)p[G*v+B]=A[G]}for(G=0;G<d;G++){for(B=0;B<v;B++)_[B]=p[G*v+B];for(ee(_,A,M,R,v),B=0;B<v;B++)p[G*v+B]=Math.sqrt(A[B])}}function ee(p,v,d,_,A){d[0]=0,_[0]=-H,_[1]=+H;for(var M=1,R=0;M<A;M++){for(var B=(p[M]+M*M-(p[d[R]]+d[R]*d[R]))/(2*M-2*d[R]);B<=_[R];)R--,B=(p[M]+M*M-(p[d[R]]+d[R]*d[R]))/(2*M-2*d[R]);d[++R]=M,_[R]=B,_[R+1]=+H}for(M=0,R=0;M<A;M++){for(;_[R+1]<M;)R++;v[M]=(M-d[R])*(M-d[R])+p[d[R]]}}q.prototype.draw=function(p){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(p,this.buffer,this.middle);for(var v=this.ctx.getImageData(0,0,this.size,this.size),d=new Uint8ClampedArray(this.size*this.size),_=0;_<this.size*this.size;_++){var A=v.data[4*_+3]/255;this.gridOuter[_]=A===1?0:A===0?H:Math.pow(Math.max(0,.5-A),2),this.gridInner[_]=A===1?H:A===0?0:Math.pow(Math.max(0,A-.5),2)}for(Y(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),Y(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),_=0;_<this.size*this.size;_++)d[_]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[_]-this.gridInner[_])/this.radius+this.cutoff))));return d},F.default=N;var pe=function(p,v){this.requestManager=p,this.localIdeographFontFamily=v,this.entries={}};pe.prototype.setURL=function(p){this.url=p},pe.prototype.getGlyphs=function(p,v){var d=this,_=[];for(var A in p)for(var M=0,R=p[A];M<R.length;M+=1)_.push({stack:A,id:R[M]});a.asyncAll(_,function(B,G){var J=B.stack,ce=B.id,ve=d.entries[J];ve||(ve=d.entries[J]={glyphs:{},requests:{},ranges:{}});var ye=ve.glyphs[ce];if(ye===void 0){if(ye=d._tinySDF(ve,J,ce))return ve.glyphs[ce]=ye,void G(null,{stack:J,id:ce,glyph:ye});var Oe=Math.floor(ce/256);if(256*Oe>65535)G(new Error("glyphs > 65535 not supported"));else if(ve.ranges[Oe])G(null,{stack:J,id:ce,glyph:ye});else{var Re=ve.requests[Oe];Re||(Re=ve.requests[Oe]=[],pe.loadGlyphRange(J,Oe,d.url,d.requestManager,function(Ge,Me){if(Me){for(var He in Me)d._doesCharSupportLocalGlyph(+He)||(ve.glyphs[+He]=Me[+He]);ve.ranges[Oe]=!0}for(var et=0,ct=Re;et<ct.length;et+=1)(0,ct[et])(Ge,Me);delete ve.requests[Oe]})),Re.push(function(Ge,Me){Ge?G(Ge):Me&&G(null,{stack:J,id:ce,glyph:Me[ce]||null})})}}else G(null,{stack:J,id:ce,glyph:ye})},function(B,G){if(B)v(B);else if(G){for(var J={},ce=0,ve=G;ce<ve.length;ce+=1){var ye=ve[ce],Oe=ye.stack,Re=ye.id,Ge=ye.glyph;(J[Oe]||(J[Oe]={}))[Re]=Ge&&{id:Ge.id,bitmap:Ge.bitmap.clone(),metrics:Ge.metrics}}v(null,J)}})},pe.prototype._doesCharSupportLocalGlyph=function(p){return!!this.localIdeographFontFamily&&(a.isChar["CJK Unified Ideographs"](p)||a.isChar["Hangul Syllables"](p)||a.isChar.Hiragana(p)||a.isChar.Katakana(p))},pe.prototype._tinySDF=function(p,v,d){var _=this.localIdeographFontFamily;if(_&&this._doesCharSupportLocalGlyph(d)){var A=p.tinySDF;if(!A){var M="400";/bold/i.test(v)?M="900":/medium/i.test(v)?M="500":/light/i.test(v)&&(M="200"),A=p.tinySDF=new pe.TinySDF(24,3,8,.25,_,M)}return{id:d,bitmap:new a.AlphaImage({width:30,height:30},A.draw(String.fromCharCode(d))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},pe.loadGlyphRange=function(p,v,d,_,A){var M=256*v,R=M+255,B=_.transformRequest(_.normalizeGlyphsURL(d).replace("{fontstack}",p).replace("{range}",M+"-"+R),a.ResourceType.Glyphs);a.getArrayBuffer(B,function(G,J){if(G)A(G);else if(J){for(var ce={},ve=0,ye=a.parseGlyphPBF(J);ve<ye.length;ve+=1){var Oe=ye[ve];ce[Oe.id]=Oe}A(null,ce)}})},pe.TinySDF=F;var ue=function(){this.specification=a.styleSpec.light.position};ue.prototype.possiblyEvaluate=function(p,v){return a.sphericalToCartesian(p.expression.evaluate(v))},ue.prototype.interpolate=function(p,v,d){return{x:a.number(p.x,v.x,d),y:a.number(p.y,v.y,d),z:a.number(p.z,v.z,d)}};var ie=new a.Properties({anchor:new a.DataConstantProperty(a.styleSpec.light.anchor),position:new ue,color:new a.DataConstantProperty(a.styleSpec.light.color),intensity:new a.DataConstantProperty(a.styleSpec.light.intensity)}),xe=function(p){function v(d){p.call(this),this._transitionable=new a.Transitionable(ie),this.setLight(d),this._transitioning=this._transitionable.untransitioned()}return p&&(v.__proto__=p),(v.prototype=Object.create(p&&p.prototype)).constructor=v,v.prototype.getLight=function(){return this._transitionable.serialize()},v.prototype.setLight=function(d,_){if(_===void 0&&(_={}),!this._validate(a.validateLight,d,_))for(var A in d){var M=d[A];a.endsWith(A,"-transition")?this._transitionable.setTransition(A.slice(0,-11),M):this._transitionable.setValue(A,M)}},v.prototype.updateTransitions=function(d){this._transitioning=this._transitionable.transitioned(d,this._transitioning)},v.prototype.hasTransition=function(){return this._transitioning.hasTransition()},v.prototype.recalculate=function(d){this.properties=this._transitioning.possiblyEvaluate(d)},v.prototype._validate=function(d,_,A){return(!A||A.validate!==!1)&&a.emitValidationErrors(this,d.call(a.validateStyle,a.extend({value:_,style:{glyphs:!0,sprite:!0},styleSpec:a.styleSpec})))},v}(a.Evented),Se=function(p,v){this.width=p,this.height=v,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};Se.prototype.getDash=function(p,v){var d=p.join(",")+String(v);return this.dashEntry[d]||(this.dashEntry[d]=this.addDash(p,v)),this.dashEntry[d]},Se.prototype.getDashRanges=function(p,v,d){var _=[],A=p.length%2==1?-p[p.length-1]*d:0,M=p[0]*d,R=!0;_.push({left:A,right:M,isDash:R,zeroLength:p[0]===0});for(var B=p[0],G=1;G<p.length;G++){var J=p[G];_.push({left:A=B*d,right:M=(B+=J)*d,isDash:R=!R,zeroLength:J===0})}return _},Se.prototype.addRoundDash=function(p,v,d){for(var _=v/2,A=-d;A<=d;A++)for(var M=this.width*(this.nextRow+d+A),R=0,B=p[R],G=0;G<this.width;G++){G/B.right>1&&(B=p[++R]);var J=Math.abs(G-B.left),ce=Math.abs(G-B.right),ve=Math.min(J,ce),ye=void 0,Oe=A/d*(_+1);if(B.isDash){var Re=_-Math.abs(Oe);ye=Math.sqrt(ve*ve+Re*Re)}else ye=_-Math.sqrt(ve*ve+Oe*Oe);this.data[M+G]=Math.max(0,Math.min(255,ye+128))}},Se.prototype.addRegularDash=function(p){for(var v=p.length-1;v>=0;--v){var d=p[v],_=p[v+1];d.zeroLength?p.splice(v,1):_&&_.isDash===d.isDash&&(_.left=d.left,p.splice(v,1))}var A=p[0],M=p[p.length-1];A.isDash===M.isDash&&(A.left=M.left-this.width,M.right=A.right+this.width);for(var R=this.width*this.nextRow,B=0,G=p[B],J=0;J<this.width;J++){J/G.right>1&&(G=p[++B]);var ce=Math.abs(J-G.left),ve=Math.abs(J-G.right),ye=Math.min(ce,ve);this.data[R+J]=Math.max(0,Math.min(255,(G.isDash?ye:-ye)+128))}},Se.prototype.addDash=function(p,v){var d=v?7:0,_=2*d+1;if(this.nextRow+_>this.height)return a.warnOnce("LineAtlas out of space"),null;for(var A=0,M=0;M<p.length;M++)A+=p[M];if(A!==0){var R=this.width/A,B=this.getDashRanges(p,this.width,R);v?this.addRoundDash(B,R,d):this.addRegularDash(B)}var G={y:(this.nextRow+d+.5)/this.height,height:2*d/this.height,width:A};return this.nextRow+=_,this.dirty=!0,G},Se.prototype.bind=function(p){var v=p.gl;this.texture?(v.bindTexture(v.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,v.texSubImage2D(v.TEXTURE_2D,0,0,0,this.width,this.height,v.ALPHA,v.UNSIGNED_BYTE,this.data))):(this.texture=v.createTexture(),v.bindTexture(v.TEXTURE_2D,this.texture),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,v.REPEAT),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,v.REPEAT),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,v.LINEAR),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,v.LINEAR),v.texImage2D(v.TEXTURE_2D,0,v.ALPHA,this.width,this.height,0,v.ALPHA,v.UNSIGNED_BYTE,this.data))};var Ne=function p(v,d){this.workerPool=v,this.actors=[],this.currentActor=0,this.id=a.uniqueId();for(var _=this.workerPool.acquire(this.id),A=0;A<_.length;A++){var M=new p.Actor(_[A],d,this.id);M.name="Worker "+A,this.actors.push(M)}};function ze(p,v,d){var _=function(A,M){if(A)return d(A);if(M){var R=a.pick(a.extend(M,p),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);M.vector_layers&&(R.vectorLayers=M.vector_layers,R.vectorLayerIds=R.vectorLayers.map(function(B){return B.id})),R.tiles=v.canonicalizeTileset(R,p.url),d(null,R)}};return p.url?a.getJSON(v.transformRequest(v.normalizeSourceURL(p.url),a.ResourceType.Source),_):a.browser.frame(function(){return _(null,p)})}Ne.prototype.broadcast=function(p,v,d){a.asyncAll(this.actors,function(_,A){_.send(p,v,A)},d=d||function(){})},Ne.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},Ne.prototype.remove=function(){this.actors.forEach(function(p){p.remove()}),this.actors=[],this.workerPool.release(this.id)},Ne.Actor=a.Actor;var Be=function(p,v,d){this.bounds=a.LngLatBounds.convert(this.validateBounds(p)),this.minzoom=v||0,this.maxzoom=d||24};Be.prototype.validateBounds=function(p){return Array.isArray(p)&&p.length===4?[Math.max(-180,p[0]),Math.max(-90,p[1]),Math.min(180,p[2]),Math.min(90,p[3])]:[-180,-90,180,90]},Be.prototype.contains=function(p){var v=Math.pow(2,p.z),d=Math.floor(a.mercatorXfromLng(this.bounds.getWest())*v),_=Math.floor(a.mercatorYfromLat(this.bounds.getNorth())*v),A=Math.ceil(a.mercatorXfromLng(this.bounds.getEast())*v),M=Math.ceil(a.mercatorYfromLat(this.bounds.getSouth())*v);return p.x>=d&&p.x<A&&p.y>=_&&p.y<M};var $e=function(p){function v(d,_,A,M){if(p.call(this),this.id=d,this.dispatcher=A,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.extend(this,a.pick(_,["url","scheme","tileSize","promoteId"])),this._options=a.extend({type:"vector"},_),this._collectResourceTiming=_.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(M)}return p&&(v.__proto__=p),(v.prototype=Object.create(p&&p.prototype)).constructor=v,v.prototype.load=function(){var d=this;this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=ze(this._options,this.map._requestManager,function(_,A){d._tileJSONRequest=null,d._loaded=!0,_?d.fire(new a.ErrorEvent(_)):A&&(a.extend(d,A),A.bounds&&(d.tileBounds=new Be(A.bounds,d.minzoom,d.maxzoom)),a.postTurnstileEvent(A.tiles,d.map._requestManager._customAccessToken),a.postMapLoadEvent(A.tiles,d.map._getMapId(),d.map._requestManager._skuToken,d.map._requestManager._customAccessToken),d.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})),d.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"})))})},v.prototype.loaded=function(){return this._loaded},v.prototype.hasTile=function(d){return!this.tileBounds||this.tileBounds.contains(d.canonical)},v.prototype.onAdd=function(d){this.map=d,this.load()},v.prototype.setSourceProperty=function(d){this._tileJSONRequest&&this._tileJSONRequest.cancel(),d(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},v.prototype.setTiles=function(d){var _=this;return this.setSourceProperty(function(){_._options.tiles=d}),this},v.prototype.setUrl=function(d){var _=this;return this.setSourceProperty(function(){_.url=d,_._options.url=d}),this},v.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},v.prototype.serialize=function(){return a.extend({},this._options)},v.prototype.loadTile=function(d,_){var A=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme)),M={request:this.map._requestManager.transformRequest(A,a.ResourceType.Tile),uid:d.uid,tileID:d.tileID,zoom:d.tileID.overscaledZ,tileSize:this.tileSize*d.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:a.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function R(B,G){return delete d.request,d.aborted?_(null):B&&B.status!==404?_(B):(G&&G.resourceTiming&&(d.resourceTiming=G.resourceTiming),this.map._refreshExpiredTiles&&G&&d.setExpiryData(G),d.loadVectorData(G,this.map.painter),a.cacheEntryPossiblyAdded(this.dispatcher),_(null),void(d.reloadCallback&&(this.loadTile(d,d.reloadCallback),d.reloadCallback=null)))}M.request.collectResourceTiming=this._collectResourceTiming,d.actor&&d.state!=="expired"?d.state==="loading"?d.reloadCallback=_:d.request=d.actor.send("reloadTile",M,R.bind(this)):(d.actor=this.dispatcher.getActor(),d.request=d.actor.send("loadTile",M,R.bind(this)))},v.prototype.abortTile=function(d){d.request&&(d.request.cancel(),delete d.request),d.actor&&d.actor.send("abortTile",{uid:d.uid,type:this.type,source:this.id},void 0)},v.prototype.unloadTile=function(d){d.unloadVectorData(),d.actor&&d.actor.send("removeTile",{uid:d.uid,type:this.type,source:this.id},void 0)},v.prototype.hasTransition=function(){return!1},v}(a.Evented),it=function(p){function v(d,_,A,M){p.call(this),this.id=d,this.dispatcher=A,this.setEventedParent(M),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.extend({type:"raster"},_),a.extend(this,a.pick(_,["url","scheme","tileSize"]))}return p&&(v.__proto__=p),(v.prototype=Object.create(p&&p.prototype)).constructor=v,v.prototype.load=function(){var d=this;this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=ze(this._options,this.map._requestManager,function(_,A){d._tileJSONRequest=null,d._loaded=!0,_?d.fire(new a.ErrorEvent(_)):A&&(a.extend(d,A),A.bounds&&(d.tileBounds=new Be(A.bounds,d.minzoom,d.maxzoom)),a.postTurnstileEvent(A.tiles),a.postMapLoadEvent(A.tiles,d.map._getMapId(),d.map._requestManager._skuToken),d.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})),d.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"})))})},v.prototype.loaded=function(){return this._loaded},v.prototype.onAdd=function(d){this.map=d,this.load()},v.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},v.prototype.serialize=function(){return a.extend({},this._options)},v.prototype.hasTile=function(d){return!this.tileBounds||this.tileBounds.contains(d.canonical)},v.prototype.loadTile=function(d,_){var A=this,M=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);d.request=a.getImage(this.map._requestManager.transformRequest(M,a.ResourceType.Tile),function(R,B){if(delete d.request,d.aborted)d.state="unloaded",_(null);else if(R)d.state="errored",_(R);else if(B){A.map._refreshExpiredTiles&&d.setExpiryData(B),delete B.cacheControl,delete B.expires;var G=A.map.painter.context,J=G.gl;d.texture=A.map.painter.getTileTexture(B.width),d.texture?d.texture.update(B,{useMipmap:!0}):(d.texture=new a.Texture(G,B,J.RGBA,{useMipmap:!0}),d.texture.bind(J.LINEAR,J.CLAMP_TO_EDGE,J.LINEAR_MIPMAP_NEAREST),G.extTextureFilterAnisotropic&&J.texParameterf(J.TEXTURE_2D,G.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,G.extTextureFilterAnisotropicMax)),d.state="loaded",a.cacheEntryPossiblyAdded(A.dispatcher),_(null)}})},v.prototype.abortTile=function(d,_){d.request&&(d.request.cancel(),delete d.request),_()},v.prototype.unloadTile=function(d,_){d.texture&&this.map.painter.saveTileTexture(d.texture),_()},v.prototype.hasTransition=function(){return!1},v}(a.Evented),mt=function(p){function v(d,_,A,M){p.call(this,d,_,A,M),this.type="raster-dem",this.maxzoom=22,this._options=a.extend({type:"raster-dem"},_),this.encoding=_.encoding||"mapbox"}return p&&(v.__proto__=p),(v.prototype=Object.create(p&&p.prototype)).constructor=v,v.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},v.prototype.loadTile=function(d,_){var A=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function M(R,B){R&&(d.state="errored",_(R)),B&&(d.dem=B,d.needsHillshadePrepare=!0,d.state="loaded",_(null))}d.request=a.getImage(this.map._requestManager.transformRequest(A,a.ResourceType.Tile),function(R,B){if(delete d.request,d.aborted)d.state="unloaded",_(null);else if(R)d.state="errored",_(R);else if(B){this.map._refreshExpiredTiles&&d.setExpiryData(B),delete B.cacheControl,delete B.expires;var G=a.window.ImageBitmap&&B instanceof a.window.ImageBitmap&&a.offscreenCanvasSupported()?B:a.browser.getImageData(B,1),J={uid:d.uid,coord:d.tileID,source:this.id,rawImageData:G,encoding:this.encoding};d.actor&&d.state!=="expired"||(d.actor=this.dispatcher.getActor(),d.actor.send("loadDEMTile",J,M.bind(this)))}}.bind(this)),d.neighboringTiles=this._getNeighboringTiles(d.tileID)},v.prototype._getNeighboringTiles=function(d){var _=d.canonical,A=Math.pow(2,_.z),M=(_.x-1+A)%A,R=_.x===0?d.wrap-1:d.wrap,B=(_.x+1+A)%A,G=_.x+1===A?d.wrap+1:d.wrap,J={};return J[new a.OverscaledTileID(d.overscaledZ,R,_.z,M,_.y).key]={backfilled:!1},J[new a.OverscaledTileID(d.overscaledZ,G,_.z,B,_.y).key]={backfilled:!1},_.y>0&&(J[new a.OverscaledTileID(d.overscaledZ,R,_.z,M,_.y-1).key]={backfilled:!1},J[new a.OverscaledTileID(d.overscaledZ,d.wrap,_.z,_.x,_.y-1).key]={backfilled:!1},J[new a.OverscaledTileID(d.overscaledZ,G,_.z,B,_.y-1).key]={backfilled:!1}),_.y+1<A&&(J[new a.OverscaledTileID(d.overscaledZ,R,_.z,M,_.y+1).key]={backfilled:!1},J[new a.OverscaledTileID(d.overscaledZ,d.wrap,_.z,_.x,_.y+1).key]={backfilled:!1},J[new a.OverscaledTileID(d.overscaledZ,G,_.z,B,_.y+1).key]={backfilled:!1}),J},v.prototype.unloadTile=function(d){d.demTexture&&this.map.painter.saveTileTexture(d.demTexture),d.fbo&&(d.fbo.destroy(),delete d.fbo),d.dem&&delete d.dem,delete d.neighboringTiles,d.state="unloaded",d.actor&&d.actor.send("removeDEMTile",{uid:d.uid,source:this.id})},v}(it),Qe=function(p){function v(d,_,A,M){p.call(this),this.id=d,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=A.getActor(),this.setEventedParent(M),this._data=_.data,this._options=a.extend({},_),this._collectResourceTiming=_.collectResourceTiming,this._resourceTiming=[],_.maxzoom!==void 0&&(this.maxzoom=_.maxzoom),_.type&&(this.type=_.type),_.attribution&&(this.attribution=_.attribution),this.promoteId=_.promoteId;var R=a.EXTENT/this.tileSize;this.workerOptions=a.extend({source:this.id,cluster:_.cluster||!1,geojsonVtOptions:{buffer:(_.buffer!==void 0?_.buffer:128)*R,tolerance:(_.tolerance!==void 0?_.tolerance:.375)*R,extent:a.EXTENT,maxZoom:this.maxzoom,lineMetrics:_.lineMetrics||!1,generateId:_.generateId||!1},superclusterOptions:{maxZoom:_.clusterMaxZoom!==void 0?Math.min(_.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,_.clusterMinPoints||2),extent:a.EXTENT,radius:(_.clusterRadius||50)*R,log:!1,generateId:_.generateId||!1},clusterProperties:_.clusterProperties,filter:_.filter},_.workerOptions)}return p&&(v.__proto__=p),(v.prototype=Object.create(p&&p.prototype)).constructor=v,v.prototype.load=function(){var d=this;this.fire(new a.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(_){if(_)d.fire(new a.ErrorEvent(_));else{var A={dataType:"source",sourceDataType:"metadata"};d._collectResourceTiming&&d._resourceTiming&&d._resourceTiming.length>0&&(A.resourceTiming=d._resourceTiming,d._resourceTiming=[]),d.fire(new a.Event("data",A))}})},v.prototype.onAdd=function(d){this.map=d,this.load()},v.prototype.setData=function(d){var _=this;return this._data=d,this.fire(new a.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(A){if(A)_.fire(new a.ErrorEvent(A));else{var M={dataType:"source",sourceDataType:"content"};_._collectResourceTiming&&_._resourceTiming&&_._resourceTiming.length>0&&(M.resourceTiming=_._resourceTiming,_._resourceTiming=[]),_.fire(new a.Event("data",M))}}),this},v.prototype.getClusterExpansionZoom=function(d,_){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:d,source:this.id},_),this},v.prototype.getClusterChildren=function(d,_){return this.actor.send("geojson.getClusterChildren",{clusterId:d,source:this.id},_),this},v.prototype.getClusterLeaves=function(d,_,A,M){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:d,limit:_,offset:A},M),this},v.prototype._updateWorkerData=function(d){var _=this;this._loaded=!1;var A=a.extend({},this.workerOptions),M=this._data;typeof M=="string"?(A.request=this.map._requestManager.transformRequest(a.browser.resolveURL(M),a.ResourceType.Source),A.request.collectResourceTiming=this._collectResourceTiming):A.data=JSON.stringify(M),this.actor.send(this.type+".loadData",A,function(R,B){_._removed||B&&B.abandoned||(_._loaded=!0,B&&B.resourceTiming&&B.resourceTiming[_.id]&&(_._resourceTiming=B.resourceTiming[_.id].slice(0)),_.actor.send(_.type+".coalesce",{source:A.source},null),d(R))})},v.prototype.loaded=function(){return this._loaded},v.prototype.loadTile=function(d,_){var A=this,M=d.actor?"reloadTile":"loadTile";d.actor=this.actor,d.request=this.actor.send(M,{type:this.type,uid:d.uid,tileID:d.tileID,zoom:d.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:a.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(R,B){return delete d.request,d.unloadVectorData(),d.aborted?_(null):R?_(R):(d.loadVectorData(B,A.map.painter,M==="reloadTile"),_(null))})},v.prototype.abortTile=function(d){d.request&&(d.request.cancel(),delete d.request),d.aborted=!0},v.prototype.unloadTile=function(d){d.unloadVectorData(),this.actor.send("removeTile",{uid:d.uid,type:this.type,source:this.id})},v.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},v.prototype.serialize=function(){return a.extend({},this._options,{type:this.type,data:this._data})},v.prototype.hasTransition=function(){return!1},v}(a.Evented),rt=a.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),gt=function(p){function v(d,_,A,M){p.call(this),this.id=d,this.dispatcher=A,this.coordinates=_.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(M),this.options=_}return p&&(v.__proto__=p),(v.prototype=Object.create(p&&p.prototype)).constructor=v,v.prototype.load=function(d,_){var A=this;this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this.url=this.options.url,a.getImage(this.map._requestManager.transformRequest(this.url,a.ResourceType.Image),function(M,R){A._loaded=!0,M?A.fire(new a.ErrorEvent(M)):R&&(A.image=R,d&&(A.coordinates=d),_&&_(),A._finishLoading())})},v.prototype.loaded=function(){return this._loaded},v.prototype.updateImage=function(d){var _=this;return this.image&&d.url?(this.options.url=d.url,this.load(d.coordinates,function(){_.texture=null}),this):this},v.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})))},v.prototype.onAdd=function(d){this.map=d,this.load()},v.prototype.setCoordinates=function(d){var _=this;this.coordinates=d;var A=d.map(a.MercatorCoordinate.fromLngLat);this.tileID=function(R){for(var B=1/0,G=1/0,J=-1/0,ce=-1/0,ve=0,ye=R;ve<ye.length;ve+=1){var Oe=ye[ve];B=Math.min(B,Oe.x),G=Math.min(G,Oe.y),J=Math.max(J,Oe.x),ce=Math.max(ce,Oe.y)}var Re=Math.max(J-B,ce-G),Ge=Math.max(0,Math.floor(-Math.log(Re)/Math.LN2)),Me=Math.pow(2,Ge);return new a.CanonicalTileID(Ge,Math.floor((B+J)/2*Me),Math.floor((G+ce)/2*Me))}(A),this.minzoom=this.maxzoom=this.tileID.z;var M=A.map(function(R){return _.tileID.getTilePoint(R)._round()});return this._boundsArray=new a.StructArrayLayout4i8,this._boundsArray.emplaceBack(M[0].x,M[0].y,0,0),this._boundsArray.emplaceBack(M[1].x,M[1].y,a.EXTENT,0),this._boundsArray.emplaceBack(M[3].x,M[3].y,0,a.EXTENT),this._boundsArray.emplaceBack(M[2].x,M[2].y,a.EXTENT,a.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"})),this},v.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var d=this.map.painter.context,_=d.gl;for(var A in this.boundsBuffer||(this.boundsBuffer=d.createVertexBuffer(this._boundsArray,rt.members)),this.boundsSegments||(this.boundsSegments=a.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new a.Texture(d,this.image,_.RGBA),this.texture.bind(_.LINEAR,_.CLAMP_TO_EDGE)),this.tiles){var M=this.tiles[A];M.state!=="loaded"&&(M.state="loaded",M.texture=this.texture)}}},v.prototype.loadTile=function(d,_){this.tileID&&this.tileID.equals(d.tileID.canonical)?(this.tiles[String(d.tileID.wrap)]=d,d.buckets={},_(null)):(d.state="errored",_(null))},v.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},v.prototype.hasTransition=function(){return!1},v}(a.Evented),er=function(p){function v(d,_,A,M){p.call(this,d,_,A,M),this.roundZoom=!0,this.type="video",this.options=_}return p&&(v.__proto__=p),(v.prototype=Object.create(p&&p.prototype)).constructor=v,v.prototype.load=function(){var d=this;this._loaded=!1;var _=this.options;this.urls=[];for(var A=0,M=_.urls;A<M.length;A+=1)this.urls.push(this.map._requestManager.transformRequest(M[A],a.ResourceType.Source).url);a.getVideo(this.urls,function(R,B){d._loaded=!0,R?d.fire(new a.ErrorEvent(R)):B&&(d.video=B,d.video.loop=!0,d.video.setAttribute("playsinline",""),d.video.addEventListener("playing",function(){d.map.triggerRepaint()}),d.map&&d.video.play(),d._finishLoading())})},v.prototype.pause=function(){this.video&&this.video.pause()},v.prototype.play=function(){this.video&&this.video.play()},v.prototype.seek=function(d){if(this.video){var _=this.video.seekable;d<_.start(0)||d>_.end(0)?this.fire(new a.ErrorEvent(new a.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+_.start(0)+" and "+_.end(0)+"-second mark."))):this.video.currentTime=d}},v.prototype.getVideo=function(){return this.video},v.prototype.onAdd=function(d){this.map||(this.map=d,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},v.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var d=this.map.painter.context,_=d.gl;for(var A in this.boundsBuffer||(this.boundsBuffer=d.createVertexBuffer(this._boundsArray,rt.members)),this.boundsSegments||(this.boundsSegments=a.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(_.LINEAR,_.CLAMP_TO_EDGE),_.texSubImage2D(_.TEXTURE_2D,0,0,0,_.RGBA,_.UNSIGNED_BYTE,this.video)):(this.texture=new a.Texture(d,this.video,_.RGBA),this.texture.bind(_.LINEAR,_.CLAMP_TO_EDGE)),this.tiles){var M=this.tiles[A];M.state!=="loaded"&&(M.state="loaded",M.texture=this.texture)}}},v.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},v.prototype.hasTransition=function(){return this.video&&!this.video.paused},v}(gt),zt=function(p){function v(d,_,A,M){p.call(this,d,_,A,M),_.coordinates?Array.isArray(_.coordinates)&&_.coordinates.length===4&&!_.coordinates.some(function(R){return!Array.isArray(R)||R.length!==2||R.some(function(B){return typeof B!="number"})})||this.fire(new a.ErrorEvent(new a.ValidationError("sources."+d,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.ErrorEvent(new a.ValidationError("sources."+d,null,'missing required property "coordinates"'))),_.animate&&typeof _.animate!="boolean"&&this.fire(new a.ErrorEvent(new a.ValidationError("sources."+d,null,'optional "animate" property must be a boolean value'))),_.canvas?typeof _.canvas=="string"||_.canvas instanceof a.window.HTMLCanvasElement||this.fire(new a.ErrorEvent(new a.ValidationError("sources."+d,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.ErrorEvent(new a.ValidationError("sources."+d,null,'missing required property "canvas"'))),this.options=_,this.animate=_.animate===void 0||_.animate}return p&&(v.__proto__=p),(v.prototype=Object.create(p&&p.prototype)).constructor=v,v.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof a.window.HTMLCanvasElement?this.options.canvas:a.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},v.prototype.getCanvas=function(){return this.canvas},v.prototype.onAdd=function(d){this.map=d,this.load(),this.canvas&&this.animate&&this.play()},v.prototype.onRemove=function(){this.pause()},v.prototype.prepare=function(){var d=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,d=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,d=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var _=this.map.painter.context,A=_.gl;for(var M in this.boundsBuffer||(this.boundsBuffer=_.createVertexBuffer(this._boundsArray,rt.members)),this.boundsSegments||(this.boundsSegments=a.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(d||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new a.Texture(_,this.canvas,A.RGBA,{premultiply:!0}),this.tiles){var R=this.tiles[M];R.state!=="loaded"&&(R.state="loaded",R.texture=this.texture)}}},v.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},v.prototype.hasTransition=function(){return this._playing},v.prototype._hasInvalidDimensions=function(){for(var d=0,_=[this.canvas.width,this.canvas.height];d<_.length;d+=1){var A=_[d];if(isNaN(A)||A<=0)return!0}return!1},v}(gt),qt={vector:$e,raster:it,"raster-dem":mt,geojson:Qe,video:er,image:gt,canvas:zt};function Zr(p,v){var d=a.identity([]);return a.translate(d,d,[1,1,0]),a.scale(d,d,[.5*p.width,.5*p.height,1]),a.multiply(d,d,p.calculatePosMatrix(v.toUnwrapped()))}function Wr(p,v,d,_,A,M){var R=function(Ge,Me,He){if(Ge)for(var et=0,ct=Ge;et<ct.length;et+=1){var Pt=Me[ct[et]];if(Pt&&Pt.source===He&&Pt.type==="fill-extrusion")return!0}else for(var At in Me){var Ot=Me[At];if(Ot.source===He&&Ot.type==="fill-extrusion")return!0}return!1}(A&&A.layers,v,p.id),B=M.maxPitchScaleFactor(),G=p.tilesIn(_,B,R);G.sort(On);for(var J=[],ce=0,ve=G;ce<ve.length;ce+=1){var ye=ve[ce];J.push({wrappedTileID:ye.tileID.wrapped().key,queryResults:ye.tile.queryRenderedFeatures(v,d,p._state,ye.queryGeometry,ye.cameraQueryGeometry,ye.scale,A,M,B,Zr(p.transform,ye.tileID))})}var Oe=function(Ge){for(var Me={},He={},et=0,ct=Ge;et<ct.length;et+=1){var Pt=ct[et],At=Pt.queryResults,Ot=Pt.wrappedTileID,tr=He[Ot]=He[Ot]||{};for(var sr in At)for(var _r=At[sr],Ur=tr[sr]=tr[sr]||{},hn=Me[sr]=Me[sr]||[],An=0,bn=_r;An<bn.length;An+=1){var Fi=bn[An];Ur[Fi.featureIndex]||(Ur[Fi.featureIndex]=!0,hn.push(Fi))}}return Me}(J);for(var Re in Oe)Oe[Re].forEach(function(Ge){var Me=Ge.feature,He=p.getFeatureState(Me.layer["source-layer"],Me.id);Me.source=Me.layer.source,Me.layer["source-layer"]&&(Me.sourceLayer=Me.layer["source-layer"]),Me.state=He});return Oe}function On(p,v){var d=p.tileID,_=v.tileID;return d.overscaledZ-_.overscaledZ||d.canonical.y-_.canonical.y||d.wrap-_.wrap||d.canonical.x-_.canonical.x}var Ut=function(p,v){this.max=p,this.onRemove=v,this.reset()};Ut.prototype.reset=function(){for(var p in this.data)for(var v=0,d=this.data[p];v<d.length;v+=1){var _=d[v];_.timeout&&clearTimeout(_.timeout),this.onRemove(_.value)}return this.data={},this.order=[],this},Ut.prototype.add=function(p,v,d){var _=this,A=p.wrapped().key;this.data[A]===void 0&&(this.data[A]=[]);var M={value:v,timeout:void 0};if(d!==void 0&&(M.timeout=setTimeout(function(){_.remove(p,M)},d)),this.data[A].push(M),this.order.push(A),this.order.length>this.max){var R=this._getAndRemoveByKey(this.order[0]);R&&this.onRemove(R)}return this},Ut.prototype.has=function(p){return p.wrapped().key in this.data},Ut.prototype.getAndRemove=function(p){return this.has(p)?this._getAndRemoveByKey(p.wrapped().key):null},Ut.prototype._getAndRemoveByKey=function(p){var v=this.data[p].shift();return v.timeout&&clearTimeout(v.timeout),this.data[p].length===0&&delete this.data[p],this.order.splice(this.order.indexOf(p),1),v.value},Ut.prototype.getByKey=function(p){var v=this.data[p];return v?v[0].value:null},Ut.prototype.get=function(p){return this.has(p)?this.data[p.wrapped().key][0].value:null},Ut.prototype.remove=function(p,v){if(!this.has(p))return this;var d=p.wrapped().key,_=v===void 0?0:this.data[d].indexOf(v),A=this.data[d][_];return this.data[d].splice(_,1),A.timeout&&clearTimeout(A.timeout),this.data[d].length===0&&delete this.data[d],this.onRemove(A.value),this.order.splice(this.order.indexOf(d),1),this},Ut.prototype.setMaxSize=function(p){for(this.max=p;this.order.length>this.max;){var v=this._getAndRemoveByKey(this.order[0]);v&&this.onRemove(v)}return this},Ut.prototype.filter=function(p){var v=[];for(var d in this.data)for(var _=0,A=this.data[d];_<A.length;_+=1){var M=A[_];p(M.value)||v.push(M)}for(var R=0,B=v;R<B.length;R+=1){var G=B[R];this.remove(G.value.tileID,G)}};var Ar=function(p,v,d){this.context=p;var _=p.gl;this.buffer=_.createBuffer(),this.dynamicDraw=!!d,this.context.unbindVAO(),p.bindElementBuffer.set(this.buffer),_.bufferData(_.ELEMENT_ARRAY_BUFFER,v.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||delete v.arrayBuffer};Ar.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},Ar.prototype.updateData=function(p){var v=this.context.gl;this.context.unbindVAO(),this.bind(),v.bufferSubData(v.ELEMENT_ARRAY_BUFFER,0,p.arrayBuffer)},Ar.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var an={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},Ft=function(p,v,d,_){this.length=v.length,this.attributes=d,this.itemSize=v.bytesPerElement,this.dynamicDraw=_,this.context=p;var A=p.gl;this.buffer=A.createBuffer(),p.bindVertexBuffer.set(this.buffer),A.bufferData(A.ARRAY_BUFFER,v.arrayBuffer,this.dynamicDraw?A.DYNAMIC_DRAW:A.STATIC_DRAW),this.dynamicDraw||delete v.arrayBuffer};Ft.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},Ft.prototype.updateData=function(p){var v=this.context.gl;this.bind(),v.bufferSubData(v.ARRAY_BUFFER,0,p.arrayBuffer)},Ft.prototype.enableAttributes=function(p,v){for(var d=0;d<this.attributes.length;d++){var _=v.attributes[this.attributes[d].name];_!==void 0&&p.enableVertexAttribArray(_)}},Ft.prototype.setVertexAttribPointers=function(p,v,d){for(var _=0;_<this.attributes.length;_++){var A=this.attributes[_],M=v.attributes[A.name];M!==void 0&&p.vertexAttribPointer(M,A.components,p[an[A.type]],!1,this.itemSize,A.offset+this.itemSize*(d||0))}},Ft.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var Mr=function(p){this.gl=p.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};Mr.prototype.get=function(){return this.current},Mr.prototype.set=function(p){},Mr.prototype.getDefault=function(){return this.default},Mr.prototype.setDefault=function(){this.set(this.default)};var mn=function(p){function v(){p.apply(this,arguments)}return p&&(v.__proto__=p),(v.prototype=Object.create(p&&p.prototype)).constructor=v,v.prototype.getDefault=function(){return a.Color.transparent},v.prototype.set=function(d){var _=this.current;(d.r!==_.r||d.g!==_.g||d.b!==_.b||d.a!==_.a||this.dirty)&&(this.gl.clearColor(d.r,d.g,d.b,d.a),this.current=d,this.dirty=!1)},v}(Mr),Nn=function(p){function v(){p.apply(this,arguments)}return p&&(v.__proto__=p),(v.prototype=Object.create(p&&p.prototype)).constructor=v,v.prototype.getDefault=function(){return 1},v.prototype.set=function(d){(d!==this.current||this.dirty)&&(this.gl.clearDepth(d),this.current=d,this.dirty=!1)},v}(Mr),Xn=function(p){function v(){p.apply(this,arguments)}return p&&(v.__proto__=p),(v.prototype=Object.create(p&&p.prototype)).constructor=v,v.prototype.getDefault=function(){return 0},v.prototype.set=function(d){(d!==this.current||this.dirty)&&(this.gl.clearStencil(d),this.current=d,this.dirty=!1)},v}(Mr),qn=function(p){function v(){p.apply(this,arguments)}return p&&(v.__proto__=p),(v.prototype=Object.create(p&&p.prototype)).constructor=v,v.prototype.getDefault=function(){return[!0,!0,!0,!0]},v.prototype.set=function(d){var _=this.current;(d[0]!==_[0]||d[1]!==_[1]||d[2]!==_[2]||d[3]!==_[3]||this.dirty)&&(this.gl.colorMask(d[0],d[1],d[2],d[3]),this.current=d,this.dirty=!1)},v}(Mr),Li=function(p){function v(){p.apply(this,arguments)}return p&&(v.__proto__=p),(v.prototype=Object.create(p&&p.prototype)).constructor=v,v.prototype.getDefault=function(){return!0},v.prototype.set=function(d){(d!==this.current||this.dirty)&&(this.gl.depthMask(d),this.current=d,this.dirty=!1)},v}(Mr),ci=function(p){function v(){p.apply(this,arguments)}return p&&(v.__proto__=p),(v.prototype=Object.create(p&&p.prototype)).constructor=v,v.prototype.getDefault=function(){return 255},v.prototype.set=function(d){(d!==this.current||this.dirty)&&(this.gl.stencilMask(d),this.current=d,this.dirty=!1)},v}(Mr),Ai=function(p){function v(){p.apply(this,arguments)}return p&&(v.__proto__=p),(v.prototype=Object.create(p&&p.prototype)).constructor=v,v.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},v.prototype.set=function(d){var _=this.current;(d.func!==_.func||d.ref!==_.ref||d.mask!==_.mask||this.dirty)&&(this.gl.stencilFunc(d.func,d.ref,d.mask),this.current=d,this.dirty=!1)},v}(Mr),Vi=function(p){function v(){p.apply(this,arguments)}return p&&(v.__proto__=p),(v.prototype=Object.create(p&&p.prototype)).constructor=v,v.prototype.getDefault=function(){var d=this.gl;return[d.KEEP,d.KEEP,d.KEEP]},v.prototype.set=function(d){var _=this.current;(d[0]!==_[0]||d[1]!==_[1]||d[2]!==_[2]||this.dirty)&&(this.gl.stencilOp(d[0],d[1],d[2]),this.current=d,this.dirty=!1)},v}(Mr),za=function(p){function v(){p.apply(this,arguments)}return p&&(v.__proto__=p),(v.prototype=Object.create(p&&p.prototype)).constructor=v,v.prototype.getDefault=function(){return!1},v.prototype.set=function(d){if(d!==this.current||this.dirty){var _=this.gl;d?_.enable(_.STENCIL_TEST):_.disable(_.STENCIL_TEST),this.current=d,this.dirty=!1}},v}(Mr),ia=function(p){function v(){p.apply(this,arguments)}return p&&(v.__proto__=p),(v.prototype=Object.create(p&&p.prototype)).constructor=v,v.prototype.getDefault=function(){return[0,1]},v.prototype.set=function(d){var _=this.current;(d[0]!==_[0]||d[1]!==_[1]||this.dirty)&&(this.gl.depthRange(d[0],d[1]),this.current=d,this.dirty=!1)},v}(Mr),X=function(p){function v(){p.apply(this,arguments)}return p&&(v.__proto__=p),(v.prototype=Object.create(p&&p.prototype)).constructor=v,v.prototype.getDefault=function(){return!1},v.prototype.set=function(d){if(d!==this.current||this.dirty){var _=this.gl;d?_.enable(_.DEPTH_TEST):_.disable(_.DEPTH_TEST),this.current=d,this.dirty=!1}},v}(Mr),Ht=function(p){function v(){p.apply(this,arguments)}return p&&(v.__proto__=p),(v.prototype=Object.create(p&&p.prototype)).constructor=v,v.prototype.getDefault=function(){return this.gl.LESS},v.prototype.set=function(d){(d!==this.current||this.dirty)&&(this.gl.depthFunc(d),this.current=d,this.dirty=!1)},v}(Mr),or=function(p){function v(){p.apply(this,arguments)}return p&&(v.__proto__=p),(v.prototype=Object.create(p&&p.prototype)).constructor=v,v.prototype.getDefault=function(){return!1},v.prototype.set=function(d){if(d!==this.current||this.dirty){var _=this.gl;d?_.enable(_.BLEND):_.disable(_.BLEND),this.current=d,this.dirty=!1}},v}(Mr),Yr=function(p){function v(){p.apply(this,arguments)}return p&&(v.__proto__=p),(v.prototype=Object.create(p&&p.prototype)).constructor=v,v.prototype.getDefault=function(){var d=this.gl;return[d.ONE,d.ZERO]},v.prototype.set=function(d){var _=this.current;(d[0]!==_[0]||d[1]!==_[1]||this.dirty)&&(this.gl.blendFunc(d[0],d[1]),this.current=d,this.dirty=!1)},v}(Mr),wn=function(p){function v(){p.apply(this,arguments)}return p&&(v.__proto__=p),(v.prototype=Object.create(p&&p.prototype)).constructor=v,v.prototype.getDefault=function(){return a.Color.transparent},v.prototype.set=function(d){var _=this.current;(d.r!==_.r||d.g!==_.g||d.b!==_.b||d.a!==_.a||this.dirty)&&(this.gl.blendColor(d.r,d.g,d.b,d.a),this.current=d,this.dirty=!1)},v}(Mr),Qi=function(p){function v(){p.apply(this,arguments)}return p&&(v.__proto__=p),(v.prototype=Object.create(p&&p.prototype)).constructor=v,v.prototype.getDefault=function(){return this.gl.FUNC_ADD},v.prototype.set=function(d){(d!==this.current||this.dirty)&&(this.gl.blendEquation(d),this.current=d,this.dirty=!1)},v}(Mr),Zn=function(p){function v(){p.apply(this,arguments)}return p&&(v.__proto__=p),(v.prototype=Object.create(p&&p.prototype)).constructor=v,v.prototype.getDefault=function(){return!1},v.prototype.set=function(d){if(d!==this.current||this.dirty){var _=this.gl;d?_.enable(_.CULL_FACE):_.disable(_.CULL_FACE),this.current=d,this.dirty=!1}},v}(Mr),Hn=function(p){function v(){p.apply(this,arguments)}return p&&(v.__proto__=p),(v.prototype=Object.create(p&&p.prototype)).constructor=v,v.prototype.getDefault=function(){return this.gl.BACK},v.prototype.set=function(d){(d!==this.current||this.dirty)&&(this.gl.cullFace(d),this.current=d,this.dirty=!1)},v}(Mr),Dn=function(p){function v(){p.apply(this,arguments)}return p&&(v.__proto__=p),(v.prototype=Object.create(p&&p.prototype)).constructor=v,v.prototype.getDefault=function(){return this.gl.CCW},v.prototype.set=function(d){(d!==this.current||this.dirty)&&(this.gl.frontFace(d),this.current=d,this.dirty=!1)},v}(Mr),di=function(p){function v(){p.apply(this,arguments)}return p&&(v.__proto__=p),(v.prototype=Object.create(p&&p.prototype)).constructor=v,v.prototype.getDefault=function(){return null},v.prototype.set=function(d){(d!==this.current||this.dirty)&&(this.gl.useProgram(d),this.current=d,this.dirty=!1)},v}(Mr),wt=function(p){function v(){p.apply(this,arguments)}return p&&(v.__proto__=p),(v.prototype=Object.create(p&&p.prototype)).constructor=v,v.prototype.getDefault=function(){return this.gl.TEXTURE0},v.prototype.set=function(d){(d!==this.current||this.dirty)&&(this.gl.activeTexture(d),this.current=d,this.dirty=!1)},v}(Mr),rn=function(p){function v(){p.apply(this,arguments)}return p&&(v.__proto__=p),(v.prototype=Object.create(p&&p.prototype)).constructor=v,v.prototype.getDefault=function(){var d=this.gl;return[0,0,d.drawingBufferWidth,d.drawingBufferHeight]},v.prototype.set=function(d){var _=this.current;(d[0]!==_[0]||d[1]!==_[1]||d[2]!==_[2]||d[3]!==_[3]||this.dirty)&&(this.gl.viewport(d[0],d[1],d[2],d[3]),this.current=d,this.dirty=!1)},v}(Mr),En=function(p){function v(){p.apply(this,arguments)}return p&&(v.__proto__=p),(v.prototype=Object.create(p&&p.prototype)).constructor=v,v.prototype.getDefault=function(){return null},v.prototype.set=function(d){if(d!==this.current||this.dirty){var _=this.gl;_.bindFramebuffer(_.FRAMEBUFFER,d),this.current=d,this.dirty=!1}},v}(Mr),Ii=function(p){function v(){p.apply(this,arguments)}return p&&(v.__proto__=p),(v.prototype=Object.create(p&&p.prototype)).constructor=v,v.prototype.getDefault=function(){return null},v.prototype.set=function(d){if(d!==this.current||this.dirty){var _=this.gl;_.bindRenderbuffer(_.RENDERBUFFER,d),this.current=d,this.dirty=!1}},v}(Mr),ki=function(p){function v(){p.apply(this,arguments)}return p&&(v.__proto__=p),(v.prototype=Object.create(p&&p.prototype)).constructor=v,v.prototype.getDefault=function(){return null},v.prototype.set=function(d){if(d!==this.current||this.dirty){var _=this.gl;_.bindTexture(_.TEXTURE_2D,d),this.current=d,this.dirty=!1}},v}(Mr),uo=function(p){function v(){p.apply(this,arguments)}return p&&(v.__proto__=p),(v.prototype=Object.create(p&&p.prototype)).constructor=v,v.prototype.getDefault=function(){return null},v.prototype.set=function(d){if(d!==this.current||this.dirty){var _=this.gl;_.bindBuffer(_.ARRAY_BUFFER,d),this.current=d,this.dirty=!1}},v}(Mr),go=function(p){function v(){p.apply(this,arguments)}return p&&(v.__proto__=p),(v.prototype=Object.create(p&&p.prototype)).constructor=v,v.prototype.getDefault=function(){return null},v.prototype.set=function(d){var _=this.gl;_.bindBuffer(_.ELEMENT_ARRAY_BUFFER,d),this.current=d,this.dirty=!1},v}(Mr),yo=function(p){function v(d){p.call(this,d),this.vao=d.extVertexArrayObject}return p&&(v.__proto__=p),(v.prototype=Object.create(p&&p.prototype)).constructor=v,v.prototype.getDefault=function(){return null},v.prototype.set=function(d){this.vao&&(d!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(d),this.current=d,this.dirty=!1)},v}(Mr),Fs=function(p){function v(){p.apply(this,arguments)}return p&&(v.__proto__=p),(v.prototype=Object.create(p&&p.prototype)).constructor=v,v.prototype.getDefault=function(){return 4},v.prototype.set=function(d){if(d!==this.current||this.dirty){var _=this.gl;_.pixelStorei(_.UNPACK_ALIGNMENT,d),this.current=d,this.dirty=!1}},v}(Mr),Ss=function(p){function v(){p.apply(this,arguments)}return p&&(v.__proto__=p),(v.prototype=Object.create(p&&p.prototype)).constructor=v,v.prototype.getDefault=function(){return!1},v.prototype.set=function(d){if(d!==this.current||this.dirty){var _=this.gl;_.pixelStorei(_.UNPACK_PREMULTIPLY_ALPHA_WEBGL,d),this.current=d,this.dirty=!1}},v}(Mr),Su=function(p){function v(){p.apply(this,arguments)}return p&&(v.__proto__=p),(v.prototype=Object.create(p&&p.prototype)).constructor=v,v.prototype.getDefault=function(){return!1},v.prototype.set=function(d){if(d!==this.current||this.dirty){var _=this.gl;_.pixelStorei(_.UNPACK_FLIP_Y_WEBGL,d),this.current=d,this.dirty=!1}},v}(Mr),ha=function(p){function v(d,_){p.call(this,d),this.context=d,this.parent=_}return p&&(v.__proto__=p),(v.prototype=Object.create(p&&p.prototype)).constructor=v,v.prototype.getDefault=function(){return null},v}(Mr),Z=function(p){function v(){p.apply(this,arguments)}return p&&(v.__proto__=p),(v.prototype=Object.create(p&&p.prototype)).constructor=v,v.prototype.setDirty=function(){this.dirty=!0},v.prototype.set=function(d){if(d!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var _=this.gl;_.framebufferTexture2D(_.FRAMEBUFFER,_.COLOR_ATTACHMENT0,_.TEXTURE_2D,d,0),this.current=d,this.dirty=!1}},v}(ha),re=function(p){function v(){p.apply(this,arguments)}return p&&(v.__proto__=p),(v.prototype=Object.create(p&&p.prototype)).constructor=v,v.prototype.set=function(d){if(d!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var _=this.gl;_.framebufferRenderbuffer(_.FRAMEBUFFER,_.DEPTH_ATTACHMENT,_.RENDERBUFFER,d),this.current=d,this.dirty=!1}},v}(ha),oe=function(p,v,d,_){this.context=p,this.width=v,this.height=d;var A=this.framebuffer=p.gl.createFramebuffer();this.colorAttachment=new Z(p,A),_&&(this.depthAttachment=new re(p,A))};oe.prototype.destroy=function(){var p=this.context.gl,v=this.colorAttachment.get();if(v&&p.deleteTexture(v),this.depthAttachment){var d=this.depthAttachment.get();d&&p.deleteRenderbuffer(d)}p.deleteFramebuffer(this.framebuffer)};var ge=function(p,v,d){this.func=p,this.mask=v,this.range=d};ge.ReadOnly=!1,ge.ReadWrite=!0,ge.disabled=new ge(519,ge.ReadOnly,[0,1]);var Le=function(p,v,d,_,A,M){this.test=p,this.ref=v,this.mask=d,this.fail=_,this.depthFail=A,this.pass=M};Le.disabled=new Le({func:519,mask:0},0,0,7680,7680,7680);var Ke=function(p,v,d){this.blendFunction=p,this.blendColor=v,this.mask=d};Ke.disabled=new Ke(Ke.Replace=[1,0],a.Color.transparent,[!1,!1,!1,!1]),Ke.unblended=new Ke(Ke.Replace,a.Color.transparent,[!0,!0,!0,!0]),Ke.alphaBlended=new Ke([1,771],a.Color.transparent,[!0,!0,!0,!0]);var nt=function(p,v,d){this.enable=p,this.mode=v,this.frontFace=d};nt.disabled=new nt(!1,1029,2305),nt.backCCW=new nt(!0,1029,2305);var de=function(p){this.gl=p,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new mn(this),this.clearDepth=new Nn(this),this.clearStencil=new Xn(this),this.colorMask=new qn(this),this.depthMask=new Li(this),this.stencilMask=new ci(this),this.stencilFunc=new Ai(this),this.stencilOp=new Vi(this),this.stencilTest=new za(this),this.depthRange=new ia(this),this.depthTest=new X(this),this.depthFunc=new Ht(this),this.blend=new or(this),this.blendFunc=new Yr(this),this.blendColor=new wn(this),this.blendEquation=new Qi(this),this.cullFace=new Zn(this),this.cullFaceSide=new Hn(this),this.frontFace=new Dn(this),this.program=new di(this),this.activeTexture=new wt(this),this.viewport=new rn(this),this.bindFramebuffer=new En(this),this.bindRenderbuffer=new Ii(this),this.bindTexture=new ki(this),this.bindVertexBuffer=new uo(this),this.bindElementBuffer=new go(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new yo(this),this.pixelStoreUnpack=new Fs(this),this.pixelStoreUnpackPremultiplyAlpha=new Ss(this),this.pixelStoreUnpackFlipY=new Su(this),this.extTextureFilterAnisotropic=p.getExtension("EXT_texture_filter_anisotropic")||p.getExtension("MOZ_EXT_texture_filter_anisotropic")||p.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=p.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=p.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(p.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=p.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=p.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=p.getParameter(p.MAX_TEXTURE_SIZE)};de.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},de.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},de.prototype.createIndexBuffer=function(p,v){return new Ar(this,p,v)},de.prototype.createVertexBuffer=function(p,v,d){return new Ft(this,p,v,d)},de.prototype.createRenderbuffer=function(p,v,d){var _=this.gl,A=_.createRenderbuffer();return this.bindRenderbuffer.set(A),_.renderbufferStorage(_.RENDERBUFFER,p,v,d),this.bindRenderbuffer.set(null),A},de.prototype.createFramebuffer=function(p,v,d){return new oe(this,p,v,d)},de.prototype.clear=function(p){var v=p.color,d=p.depth,_=this.gl,A=0;v&&(A|=_.COLOR_BUFFER_BIT,this.clearColor.set(v),this.colorMask.set([!0,!0,!0,!0])),d!==void 0&&(A|=_.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(d),this.depthMask.set(!0)),_.clear(A)},de.prototype.setCullFace=function(p){p.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(p.mode),this.frontFace.set(p.frontFace))},de.prototype.setDepthMode=function(p){p.func!==this.gl.ALWAYS||p.mask?(this.depthTest.set(!0),this.depthFunc.set(p.func),this.depthMask.set(p.mask),this.depthRange.set(p.range)):this.depthTest.set(!1)},de.prototype.setStencilMode=function(p){p.test.func!==this.gl.ALWAYS||p.mask?(this.stencilTest.set(!0),this.stencilMask.set(p.mask),this.stencilOp.set([p.fail,p.depthFail,p.pass]),this.stencilFunc.set({func:p.test.func,ref:p.ref,mask:p.test.mask})):this.stencilTest.set(!1)},de.prototype.setColorMode=function(p){a.deepEqual(p.blendFunction,Ke.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(p.blendFunction),this.blendColor.set(p.blendColor)),this.colorMask.set(p.mask)},de.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var Fe=function(p){function v(d,_,A){var M=this;p.call(this),this.id=d,this.dispatcher=A,this.on("data",function(R){R.dataType==="source"&&R.sourceDataType==="metadata"&&(M._sourceLoaded=!0),M._sourceLoaded&&!M._paused&&R.dataType==="source"&&R.sourceDataType==="content"&&(M.reload(),M.transform&&M.update(M.transform))}),this.on("error",function(){M._sourceErrored=!0}),this._source=function(R,B,G,J){var ce=new qt[B.type](R,B,G,J);if(ce.id!==R)throw new Error("Expected Source id to be "+R+" instead of "+ce.id);return a.bindAll(["load","abort","unload","serialize","prepare"],ce),ce}(d,_,A,this),this._tiles={},this._cache=new Ut(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new a.SourceFeatureState}return p&&(v.__proto__=p),(v.prototype=Object.create(p&&p.prototype)).constructor=v,v.prototype.onAdd=function(d){this.map=d,this._maxTileCacheSize=d?d._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(d)},v.prototype.onRemove=function(d){this._source&&this._source.onRemove&&this._source.onRemove(d)},v.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var d in this._tiles){var _=this._tiles[d];if(_.state!=="loaded"&&_.state!=="errored")return!1}return!0},v.prototype.getSource=function(){return this._source},v.prototype.pause=function(){this._paused=!0},v.prototype.resume=function(){if(this._paused){var d=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,d&&this.reload(),this.transform&&this.update(this.transform)}},v.prototype._loadTile=function(d,_){return this._source.loadTile(d,_)},v.prototype._unloadTile=function(d){if(this._source.unloadTile)return this._source.unloadTile(d,function(){})},v.prototype._abortTile=function(d){if(this._source.abortTile)return this._source.abortTile(d,function(){})},v.prototype.serialize=function(){return this._source.serialize()},v.prototype.prepare=function(d){for(var _ in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var A=this._tiles[_];A.upload(d),A.prepare(this.map.style.imageManager)}},v.prototype.getIds=function(){return a.values(this._tiles).map(function(d){return d.tileID}).sort(ht).map(function(d){return d.key})},v.prototype.getRenderableIds=function(d){var _=this,A=[];for(var M in this._tiles)this._isIdRenderable(M,d)&&A.push(this._tiles[M]);return d?A.sort(function(R,B){var G=R.tileID,J=B.tileID,ce=new a.Point(G.canonical.x,G.canonical.y)._rotate(_.transform.angle),ve=new a.Point(J.canonical.x,J.canonical.y)._rotate(_.transform.angle);return G.overscaledZ-J.overscaledZ||ve.y-ce.y||ve.x-ce.x}).map(function(R){return R.tileID.key}):A.map(function(R){return R.tileID}).sort(ht).map(function(R){return R.key})},v.prototype.hasRenderableParent=function(d){var _=this.findLoadedParent(d,0);return!!_&&this._isIdRenderable(_.tileID.key)},v.prototype._isIdRenderable=function(d,_){return this._tiles[d]&&this._tiles[d].hasData()&&!this._coveredTiles[d]&&(_||!this._tiles[d].holdingForFade())},v.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var d in this._cache.reset(),this._tiles)this._tiles[d].state!=="errored"&&this._reloadTile(d,"reloading")},v.prototype._reloadTile=function(d,_){var A=this._tiles[d];A&&(A.state!=="loading"&&(A.state=_),this._loadTile(A,this._tileLoaded.bind(this,A,d,_)))},v.prototype._tileLoaded=function(d,_,A,M){if(M)return d.state="errored",void(M.status!==404?this._source.fire(new a.ErrorEvent(M,{tile:d})):this.update(this.transform));d.timeAdded=a.browser.now(),A==="expired"&&(d.refreshedUponExpiration=!0),this._setTileReloadTimer(_,d),this.getSource().type==="raster-dem"&&d.dem&&this._backfillDEM(d),this._state.initializeTileState(d,this.map?this.map.painter:null),this._source.fire(new a.Event("data",{dataType:"source",tile:d,coord:d.tileID}))},v.prototype._backfillDEM=function(d){for(var _=this.getRenderableIds(),A=0;A<_.length;A++){var M=_[A];if(d.neighboringTiles&&d.neighboringTiles[M]){var R=this.getTileByID(M);B(d,R),B(R,d)}}function B(G,J){G.needsHillshadePrepare=!0;var ce=J.tileID.canonical.x-G.tileID.canonical.x,ve=J.tileID.canonical.y-G.tileID.canonical.y,ye=Math.pow(2,G.tileID.canonical.z),Oe=J.tileID.key;ce===0&&ve===0||Math.abs(ve)>1||(Math.abs(ce)>1&&(Math.abs(ce+ye)===1?ce+=ye:Math.abs(ce-ye)===1&&(ce-=ye)),J.dem&&G.dem&&(G.dem.backfillBorder(J.dem,ce,ve),G.neighboringTiles&&G.neighboringTiles[Oe]&&(G.neighboringTiles[Oe].backfilled=!0)))}},v.prototype.getTile=function(d){return this.getTileByID(d.key)},v.prototype.getTileByID=function(d){return this._tiles[d]},v.prototype._retainLoadedChildren=function(d,_,A,M){for(var R in this._tiles){var B=this._tiles[R];if(!(M[R]||!B.hasData()||B.tileID.overscaledZ<=_||B.tileID.overscaledZ>A)){for(var G=B.tileID;B&&B.tileID.overscaledZ>_+1;){var J=B.tileID.scaledTo(B.tileID.overscaledZ-1);(B=this._tiles[J.key])&&B.hasData()&&(G=J)}for(var ce=G;ce.overscaledZ>_;)if(d[(ce=ce.scaledTo(ce.overscaledZ-1)).key]){M[G.key]=G;break}}}},v.prototype.findLoadedParent=function(d,_){if(d.key in this._loadedParentTiles){var A=this._loadedParentTiles[d.key];return A&&A.tileID.overscaledZ>=_?A:null}for(var M=d.overscaledZ-1;M>=_;M--){var R=d.scaledTo(M),B=this._getLoadedTile(R);if(B)return B}},v.prototype._getLoadedTile=function(d){var _=this._tiles[d.key];return _&&_.hasData()?_:this._cache.getByKey(d.wrapped().key)},v.prototype.updateCacheSize=function(d){var _=Math.ceil(d.width/this._source.tileSize)+1,A=Math.ceil(d.height/this._source.tileSize)+1,M=Math.floor(_*A*5),R=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,M):M;this._cache.setMaxSize(R)},v.prototype.handleWrapJump=function(d){var _=Math.round((d-(this._prevLng===void 0?d:this._prevLng))/360);if(this._prevLng=d,_){var A={};for(var M in this._tiles){var R=this._tiles[M];R.tileID=R.tileID.unwrapTo(R.tileID.wrap+_),A[R.tileID.key]=R}for(var B in this._tiles=A,this._timers)clearTimeout(this._timers[B]),delete this._timers[B];for(var G in this._tiles)this._setTileReloadTimer(G,this._tiles[G])}},v.prototype.update=function(d){var _=this;if(this.transform=d,this._sourceLoaded&&!this._paused){var A;this.updateCacheSize(d),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?A=d.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(tr){return new a.OverscaledTileID(tr.canonical.z,tr.wrap,tr.canonical.z,tr.canonical.x,tr.canonical.y)}):(A=d.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(A=A.filter(function(tr){return _._source.hasTile(tr)}))):A=[];var M=d.coveringZoomLevel(this._source),R=Math.max(M-v.maxOverzooming,this._source.minzoom),B=Math.max(M+v.maxUnderzooming,this._source.minzoom),G=this._updateRetainedTiles(A,M);if(nr(this._source.type)){for(var J={},ce={},ve=0,ye=Object.keys(G);ve<ye.length;ve+=1){var Oe=ye[ve],Re=G[Oe],Ge=this._tiles[Oe];if(Ge&&!(Ge.fadeEndTime&&Ge.fadeEndTime<=a.browser.now())){var Me=this.findLoadedParent(Re,R);Me&&(this._addTile(Me.tileID),J[Me.tileID.key]=Me.tileID),ce[Oe]=Re}}for(var He in this._retainLoadedChildren(ce,M,B,G),J)G[He]||(this._coveredTiles[He]=!0,G[He]=J[He])}for(var et in G)this._tiles[et].clearFadeHold();for(var ct=0,Pt=a.keysDifference(this._tiles,G);ct<Pt.length;ct+=1){var At=Pt[ct],Ot=this._tiles[At];Ot.hasSymbolBuckets&&!Ot.holdingForFade()?Ot.setHoldDuration(this.map._fadeDuration):Ot.hasSymbolBuckets&&!Ot.symbolFadeFinished()||this._removeTile(At)}this._updateLoadedParentTileCache()}},v.prototype.releaseSymbolFadeTiles=function(){for(var d in this._tiles)this._tiles[d].holdingForFade()&&this._removeTile(d)},v.prototype._updateRetainedTiles=function(d,_){for(var A={},M={},R=Math.max(_-v.maxOverzooming,this._source.minzoom),B=Math.max(_+v.maxUnderzooming,this._source.minzoom),G={},J=0,ce=d;J<ce.length;J+=1){var ve=ce[J],ye=this._addTile(ve);A[ve.key]=ve,ye.hasData()||_<this._source.maxzoom&&(G[ve.key]=ve)}this._retainLoadedChildren(G,_,B,A);for(var Oe=0,Re=d;Oe<Re.length;Oe+=1){var Ge=Re[Oe],Me=this._tiles[Ge.key];if(!Me.hasData()){if(_+1>this._source.maxzoom){var He=Ge.children(this._source.maxzoom)[0],et=this.getTile(He);if(et&&et.hasData()){A[He.key]=He;continue}}else{var ct=Ge.children(this._source.maxzoom);if(A[ct[0].key]&&A[ct[1].key]&&A[ct[2].key]&&A[ct[3].key])continue}for(var Pt=Me.wasRequested(),At=Ge.overscaledZ-1;At>=R;--At){var Ot=Ge.scaledTo(At);if(M[Ot.key]||(M[Ot.key]=!0,!(Me=this.getTile(Ot))&&Pt&&(Me=this._addTile(Ot)),Me&&(A[Ot.key]=Ot,Pt=Me.wasRequested(),Me.hasData())))break}}}return A},v.prototype._updateLoadedParentTileCache=function(){for(var d in this._loadedParentTiles={},this._tiles){for(var _=[],A=void 0,M=this._tiles[d].tileID;M.overscaledZ>0;){if(M.key in this._loadedParentTiles){A=this._loadedParentTiles[M.key];break}_.push(M.key);var R=M.scaledTo(M.overscaledZ-1);if(A=this._getLoadedTile(R))break;M=R}for(var B=0,G=_;B<G.length;B+=1)this._loadedParentTiles[G[B]]=A}},v.prototype._addTile=function(d){var _=this._tiles[d.key];if(_)return _;(_=this._cache.getAndRemove(d))&&(this._setTileReloadTimer(d.key,_),_.tileID=d,this._state.initializeTileState(_,this.map?this.map.painter:null),this._cacheTimers[d.key]&&(clearTimeout(this._cacheTimers[d.key]),delete this._cacheTimers[d.key],this._setTileReloadTimer(d.key,_)));var A=!!_;return A||(_=new a.Tile(d,this._source.tileSize*d.overscaleFactor()),this._loadTile(_,this._tileLoaded.bind(this,_,d.key,_.state))),_?(_.uses++,this._tiles[d.key]=_,A||this._source.fire(new a.Event("dataloading",{tile:_,coord:_.tileID,dataType:"source"})),_):null},v.prototype._setTileReloadTimer=function(d,_){var A=this;d in this._timers&&(clearTimeout(this._timers[d]),delete this._timers[d]);var M=_.getExpiryTimeout();M&&(this._timers[d]=setTimeout(function(){A._reloadTile(d,"expired"),delete A._timers[d]},M))},v.prototype._removeTile=function(d){var _=this._tiles[d];_&&(_.uses--,delete this._tiles[d],this._timers[d]&&(clearTimeout(this._timers[d]),delete this._timers[d]),_.uses>0||(_.hasData()&&_.state!=="reloading"?this._cache.add(_.tileID,_,_.getExpiryTimeout()):(_.aborted=!0,this._abortTile(_),this._unloadTile(_))))},v.prototype.clearTiles=function(){for(var d in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(d);this._cache.reset()},v.prototype.tilesIn=function(d,_,A){var M=this,R=[],B=this.transform;if(!B)return R;for(var G=A?B.getCameraQueryGeometry(d):d,J=d.map(function(At){return B.pointCoordinate(At)}),ce=G.map(function(At){return B.pointCoordinate(At)}),ve=this.getIds(),ye=1/0,Oe=1/0,Re=-1/0,Ge=-1/0,Me=0,He=ce;Me<He.length;Me+=1){var et=He[Me];ye=Math.min(ye,et.x),Oe=Math.min(Oe,et.y),Re=Math.max(Re,et.x),Ge=Math.max(Ge,et.y)}for(var ct=function(At){var Ot=M._tiles[ve[At]];if(!Ot.holdingForFade()){var tr=Ot.tileID,sr=Math.pow(2,B.zoom-Ot.tileID.overscaledZ),_r=_*Ot.queryPadding*a.EXTENT/Ot.tileSize/sr,Ur=[tr.getTilePoint(new a.MercatorCoordinate(ye,Oe)),tr.getTilePoint(new a.MercatorCoordinate(Re,Ge))];if(Ur[0].x-_r<a.EXTENT&&Ur[0].y-_r<a.EXTENT&&Ur[1].x+_r>=0&&Ur[1].y+_r>=0){var hn=J.map(function(bn){return tr.getTilePoint(bn)}),An=ce.map(function(bn){return tr.getTilePoint(bn)});R.push({tile:Ot,tileID:tr,queryGeometry:hn,cameraQueryGeometry:An,scale:sr})}}},Pt=0;Pt<ve.length;Pt++)ct(Pt);return R},v.prototype.getVisibleCoordinates=function(d){for(var _=this,A=this.getRenderableIds(d).map(function(G){return _._tiles[G].tileID}),M=0,R=A;M<R.length;M+=1){var B=R[M];B.posMatrix=this.transform.calculatePosMatrix(B.toUnwrapped())}return A},v.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(nr(this._source.type))for(var d in this._tiles){var _=this._tiles[d];if(_.fadeEndTime!==void 0&&_.fadeEndTime>=a.browser.now())return!0}return!1},v.prototype.setFeatureState=function(d,_,A){this._state.updateState(d=d||"_geojsonTileLayer",_,A)},v.prototype.removeFeatureState=function(d,_,A){this._state.removeFeatureState(d=d||"_geojsonTileLayer",_,A)},v.prototype.getFeatureState=function(d,_){return this._state.getState(d=d||"_geojsonTileLayer",_)},v.prototype.setDependencies=function(d,_,A){var M=this._tiles[d];M&&M.setDependencies(_,A)},v.prototype.reloadTilesForDependencies=function(d,_){for(var A in this._tiles)this._tiles[A].hasDependency(d,_)&&this._reloadTile(A,"reloading");this._cache.filter(function(M){return!M.hasDependency(d,_)})},v}(a.Evented);function ht(p,v){var d=Math.abs(2*p.wrap)-+(p.wrap<0),_=Math.abs(2*v.wrap)-+(v.wrap<0);return p.overscaledZ-v.overscaledZ||_-d||v.canonical.y-p.canonical.y||v.canonical.x-p.canonical.x}function nr(p){return p==="raster"||p==="image"||p==="video"}function cr(){return new a.window.Worker(Pu.workerUrl)}Fe.maxOverzooming=10,Fe.maxUnderzooming=3;var kt="mapboxgl_preloaded_worker_pool",ir=function(){this.active={}};ir.prototype.acquire=function(p){if(!this.workers)for(this.workers=[];this.workers.length<ir.workerCount;)this.workers.push(new cr);return this.active[p]=!0,this.workers.slice()},ir.prototype.release=function(p){delete this.active[p],this.numActive()===0&&(this.workers.forEach(function(v){v.terminate()}),this.workers=null)},ir.prototype.isPreloaded=function(){return!!this.active[kt]},ir.prototype.numActive=function(){return Object.keys(this.active).length};var Sr,nn=Math.floor(a.browser.hardwareConcurrency/2);function Dt(){return Sr||(Sr=new ir),Sr}function Kr(p,v){var d={};for(var _ in p)_!=="ref"&&(d[_]=p[_]);return a.refProperties.forEach(function(A){A in v&&(d[A]=v[A])}),d}function Ir(p){p=p.slice();for(var v=Object.create(null),d=0;d<p.length;d++)v[p[d].id]=p[d];for(var _=0;_<p.length;_++)"ref"in p[_]&&(p[_]=Kr(p[_],v[p[_].ref]));return p}ir.workerCount=Math.max(Math.min(nn,6),1);var Dr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function ii(p,v,d){d.push({command:Dr.addSource,args:[p,v[p]]})}function Fr(p,v,d){v.push({command:Dr.removeSource,args:[p]}),d[p]=!0}function fi(p,v,d,_){Fr(p,d,_),ii(p,v,d)}function Oi(p,v,d){var _;for(_ in p[d])if(p[d].hasOwnProperty(_)&&_!=="data"&&!a.deepEqual(p[d][_],v[d][_]))return!1;for(_ in v[d])if(v[d].hasOwnProperty(_)&&_!=="data"&&!a.deepEqual(p[d][_],v[d][_]))return!1;return!0}function oi(p,v,d,_,A,M){var R;for(R in v=v||{},p=p||{})p.hasOwnProperty(R)&&(a.deepEqual(p[R],v[R])||d.push({command:M,args:[_,R,v[R],A]}));for(R in v)v.hasOwnProperty(R)&&!p.hasOwnProperty(R)&&(a.deepEqual(p[R],v[R])||d.push({command:M,args:[_,R,v[R],A]}))}function Si(p){return p.id}function Ti(p,v){return p[v.id]=v,p}var Jo=function(p,v){this.reset(p,v)};Jo.prototype.reset=function(p,v){this.points=p||[],this._distances=[0];for(var d=1;d<this.points.length;d++)this._distances[d]=this._distances[d-1]+this.points[d].dist(this.points[d-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(v||0,.5*this.length),this.paddedLength=this.length-2*this.padding},Jo.prototype.lerp=function(p){if(this.points.length===1)return this.points[0];p=a.clamp(p,0,1);for(var v=1,d=this._distances[v],_=p*this.paddedLength+this.padding;d<_&&v<this._distances.length;)d=this._distances[++v];var A=v-1,M=this._distances[A],R=d-M,B=R>0?(_-M)/R:0;return this.points[A].mult(1-B).add(this.points[v].mult(B))};var Ni=function(p,v,d){var _=this.boxCells=[],A=this.circleCells=[];this.xCellCount=Math.ceil(p/d),this.yCellCount=Math.ceil(v/d);for(var M=0;M<this.xCellCount*this.yCellCount;M++)_.push([]),A.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=p,this.height=v,this.xScale=this.xCellCount/p,this.yScale=this.yCellCount/v,this.boxUid=0,this.circleUid=0};function Hi(p,v,d,_,A){var M=a.create();return v?(a.scale(M,M,[1/A,1/A,1]),d||a.rotateZ(M,M,_.angle)):a.multiply(M,_.labelPlaneMatrix,p),M}function Di(p,v,d,_,A){if(v){var M=a.clone(p);return a.scale(M,M,[A,A,1]),d||a.rotateZ(M,M,-_.angle),M}return _.glCoordMatrix}function ti(p,v){var d=[p.x,p.y,0,1];Pa(d,d,v);var _=d[3];return{point:new a.Point(d[0]/_,d[1]/_),signedDistanceFromCamera:_}}function vi(p,v){return .5+p/v*.5}function Mo(p,v){var d=p[0]/p[3],_=p[1]/p[3];return d>=-v[0]&&d<=v[0]&&_>=-v[1]&&_<=v[1]}function As(p,v,d,_,A,M,R,B){var G=_?p.textSizeData:p.iconSizeData,J=a.evaluateSizeForZoom(G,d.transform.zoom),ce=[256/d.width*2+1,256/d.height*2+1],ve=_?p.text.dynamicLayoutVertexArray:p.icon.dynamicLayoutVertexArray;ve.clear();for(var ye=p.lineVertexArray,Oe=_?p.text.placedSymbolArray:p.icon.placedSymbolArray,Re=d.transform.width/d.transform.height,Ge=!1,Me=0;Me<Oe.length;Me++){var He=Oe.get(Me);if(He.hidden||He.writingMode===a.WritingMode.vertical&&!Ge)Po(He.numGlyphs,ve);else{Ge=!1;var et=[He.anchorX,He.anchorY,0,1];if(a.transformMat4(et,et,v),Mo(et,ce)){var ct=vi(d.transform.cameraToCenterDistance,et[3]),Pt=a.evaluateSizeForFeature(G,J,He),At=R?Pt/ct:Pt*ct,Ot=new a.Point(He.anchorX,He.anchorY),tr=ti(Ot,A).point,sr={},_r=$c(He,At,!1,B,v,A,M,p.glyphOffsetArray,ye,ve,tr,Ot,sr,Re);Ge=_r.useVertical,(_r.notEnoughRoom||Ge||_r.needsFlipping&&$c(He,At,!0,B,v,A,M,p.glyphOffsetArray,ye,ve,tr,Ot,sr,Re).notEnoughRoom)&&Po(He.numGlyphs,ve)}else Po(He.numGlyphs,ve)}}_?p.text.dynamicLayoutVertexBuffer.updateData(ve):p.icon.dynamicLayoutVertexBuffer.updateData(ve)}function Ma(p,v,d,_,A,M,R,B,G,J,ce){var ve=B.glyphStartIndex+B.numGlyphs,ye=B.lineStartIndex,Oe=B.lineStartIndex+B.lineLength,Re=v.getoffsetX(B.glyphStartIndex),Ge=v.getoffsetX(ve-1),Me=Wi(p*Re,d,_,A,M,R,B.segment,ye,Oe,G,J,ce);if(!Me)return null;var He=Wi(p*Ge,d,_,A,M,R,B.segment,ye,Oe,G,J,ce);return He?{first:Me,last:He}:null}function Go(p,v,d,_){return p===a.WritingMode.horizontal&&Math.abs(d.y-v.y)>Math.abs(d.x-v.x)*_?{useVertical:!0}:(p===a.WritingMode.vertical?v.y<d.y:v.x>d.x)?{needsFlipping:!0}:null}function $c(p,v,d,_,A,M,R,B,G,J,ce,ve,ye,Oe){var Re,Ge=v/24,Me=p.lineOffsetX*Ge,He=p.lineOffsetY*Ge;if(p.numGlyphs>1){var et=p.glyphStartIndex+p.numGlyphs,ct=p.lineStartIndex,Pt=p.lineStartIndex+p.lineLength,At=Ma(Ge,B,Me,He,d,ce,ve,p,G,M,ye);if(!At)return{notEnoughRoom:!0};var Ot=ti(At.first.point,R).point,tr=ti(At.last.point,R).point;if(_&&!d){var sr=Go(p.writingMode,Ot,tr,Oe);if(sr)return sr}Re=[At.first];for(var _r=p.glyphStartIndex+1;_r<et-1;_r++)Re.push(Wi(Ge*B.getoffsetX(_r),Me,He,d,ce,ve,p.segment,ct,Pt,G,M,ye));Re.push(At.last)}else{if(_&&!d){var Ur=ti(ve,A).point,hn=p.lineStartIndex+p.segment+1,An=new a.Point(G.getx(hn),G.gety(hn)),bn=ti(An,A),Fi=bn.signedDistanceFromCamera>0?bn.point:Wu(ve,An,Ur,1,A),$r=Go(p.writingMode,Ur,Fi,Oe);if($r)return $r}var Ln=Wi(Ge*B.getoffsetX(p.glyphStartIndex),Me,He,d,ce,ve,p.segment,p.lineStartIndex,p.lineStartIndex+p.lineLength,G,M,ye);if(!Ln)return{notEnoughRoom:!0};Re=[Ln]}for(var Yn=0,$n=Re;Yn<$n.length;Yn+=1){var Fn=$n[Yn];a.addDynamicAttributes(J,Fn.point,Fn.angle)}return{}}function Wu(p,v,d,_,A){var M=ti(p.add(p.sub(v)._unit()),A).point,R=d.sub(M);return d.add(R._mult(_/R.mag()))}function Wi(p,v,d,_,A,M,R,B,G,J,ce,ve){var ye=_?p-v:p+v,Oe=ye>0?1:-1,Re=0;_&&(Oe*=-1,Re=Math.PI),Oe<0&&(Re+=Math.PI);for(var Ge=Oe>0?B+R:B+R+1,Me=A,He=A,et=0,ct=0,Pt=Math.abs(ye),At=[];et+ct<=Pt;){if((Ge+=Oe)<B||Ge>=G)return null;if(He=Me,At.push(Me),(Me=ve[Ge])===void 0){var Ot=new a.Point(J.getx(Ge),J.gety(Ge)),tr=ti(Ot,ce);if(tr.signedDistanceFromCamera>0)Me=ve[Ge]=tr.point;else{var sr=Ge-Oe;Me=Wu(et===0?M:new a.Point(J.getx(sr),J.gety(sr)),Ot,He,Pt-et+1,ce)}}et+=ct,ct=He.dist(Me)}var _r=(Pt-et)/ct,Ur=Me.sub(He),hn=Ur.mult(_r)._add(He);hn._add(Ur._unit()._perp()._mult(d*Oe));var An=Re+Math.atan2(Me.y-He.y,Me.x-He.x);return At.push(hn),{point:hn,angle:An,path:At}}Ni.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},Ni.prototype.insert=function(p,v,d,_,A){this._forEachCell(v,d,_,A,this._insertBoxCell,this.boxUid++),this.boxKeys.push(p),this.bboxes.push(v),this.bboxes.push(d),this.bboxes.push(_),this.bboxes.push(A)},Ni.prototype.insertCircle=function(p,v,d,_){this._forEachCell(v-_,d-_,v+_,d+_,this._insertCircleCell,this.circleUid++),this.circleKeys.push(p),this.circles.push(v),this.circles.push(d),this.circles.push(_)},Ni.prototype._insertBoxCell=function(p,v,d,_,A,M){this.boxCells[A].push(M)},Ni.prototype._insertCircleCell=function(p,v,d,_,A,M){this.circleCells[A].push(M)},Ni.prototype._query=function(p,v,d,_,A,M){if(d<0||p>this.width||_<0||v>this.height)return!A&&[];var R=[];if(p<=0&&v<=0&&this.width<=d&&this.height<=_){if(A)return!0;for(var B=0;B<this.boxKeys.length;B++)R.push({key:this.boxKeys[B],x1:this.bboxes[4*B],y1:this.bboxes[4*B+1],x2:this.bboxes[4*B+2],y2:this.bboxes[4*B+3]});for(var G=0;G<this.circleKeys.length;G++){var J=this.circles[3*G],ce=this.circles[3*G+1],ve=this.circles[3*G+2];R.push({key:this.circleKeys[G],x1:J-ve,y1:ce-ve,x2:J+ve,y2:ce+ve})}return M?R.filter(M):R}return this._forEachCell(p,v,d,_,this._queryCell,R,{hitTest:A,seenUids:{box:{},circle:{}}},M),A?R.length>0:R},Ni.prototype._queryCircle=function(p,v,d,_,A){var M=p-d,R=p+d,B=v-d,G=v+d;if(R<0||M>this.width||G<0||B>this.height)return!_&&[];var J=[];return this._forEachCell(M,B,R,G,this._queryCellCircle,J,{hitTest:_,circle:{x:p,y:v,radius:d},seenUids:{box:{},circle:{}}},A),_?J.length>0:J},Ni.prototype.query=function(p,v,d,_,A){return this._query(p,v,d,_,!1,A)},Ni.prototype.hitTest=function(p,v,d,_,A){return this._query(p,v,d,_,!0,A)},Ni.prototype.hitTestCircle=function(p,v,d,_){return this._queryCircle(p,v,d,!0,_)},Ni.prototype._queryCell=function(p,v,d,_,A,M,R,B){var G=R.seenUids,J=this.boxCells[A];if(J!==null)for(var ce=this.bboxes,ve=0,ye=J;ve<ye.length;ve+=1){var Oe=ye[ve];if(!G.box[Oe]){G.box[Oe]=!0;var Re=4*Oe;if(p<=ce[Re+2]&&v<=ce[Re+3]&&d>=ce[Re+0]&&_>=ce[Re+1]&&(!B||B(this.boxKeys[Oe]))){if(R.hitTest)return M.push(!0),!0;M.push({key:this.boxKeys[Oe],x1:ce[Re],y1:ce[Re+1],x2:ce[Re+2],y2:ce[Re+3]})}}}var Ge=this.circleCells[A];if(Ge!==null)for(var Me=this.circles,He=0,et=Ge;He<et.length;He+=1){var ct=et[He];if(!G.circle[ct]){G.circle[ct]=!0;var Pt=3*ct;if(this._circleAndRectCollide(Me[Pt],Me[Pt+1],Me[Pt+2],p,v,d,_)&&(!B||B(this.circleKeys[ct]))){if(R.hitTest)return M.push(!0),!0;var At=Me[Pt],Ot=Me[Pt+1],tr=Me[Pt+2];M.push({key:this.circleKeys[ct],x1:At-tr,y1:Ot-tr,x2:At+tr,y2:Ot+tr})}}}},Ni.prototype._queryCellCircle=function(p,v,d,_,A,M,R,B){var G=R.circle,J=R.seenUids,ce=this.boxCells[A];if(ce!==null)for(var ve=this.bboxes,ye=0,Oe=ce;ye<Oe.length;ye+=1){var Re=Oe[ye];if(!J.box[Re]){J.box[Re]=!0;var Ge=4*Re;if(this._circleAndRectCollide(G.x,G.y,G.radius,ve[Ge+0],ve[Ge+1],ve[Ge+2],ve[Ge+3])&&(!B||B(this.boxKeys[Re])))return M.push(!0),!0}}var Me=this.circleCells[A];if(Me!==null)for(var He=this.circles,et=0,ct=Me;et<ct.length;et+=1){var Pt=ct[et];if(!J.circle[Pt]){J.circle[Pt]=!0;var At=3*Pt;if(this._circlesCollide(He[At],He[At+1],He[At+2],G.x,G.y,G.radius)&&(!B||B(this.circleKeys[Pt])))return M.push(!0),!0}}},Ni.prototype._forEachCell=function(p,v,d,_,A,M,R,B){for(var G=this._convertToXCellCoord(p),J=this._convertToYCellCoord(v),ce=this._convertToXCellCoord(d),ve=this._convertToYCellCoord(_),ye=G;ye<=ce;ye++)for(var Oe=J;Oe<=ve;Oe++)if(A.call(this,p,v,d,_,this.xCellCount*Oe+ye,M,R,B))return},Ni.prototype._convertToXCellCoord=function(p){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(p*this.xScale)))},Ni.prototype._convertToYCellCoord=function(p){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(p*this.yScale)))},Ni.prototype._circlesCollide=function(p,v,d,_,A,M){var R=_-p,B=A-v,G=d+M;return G*G>R*R+B*B},Ni.prototype._circleAndRectCollide=function(p,v,d,_,A,M,R){var B=(M-_)/2,G=Math.abs(p-(_+B));if(G>B+d)return!1;var J=(R-A)/2,ce=Math.abs(v-(A+J));if(ce>J+d)return!1;if(G<=B||ce<=J)return!0;var ve=G-B,ye=ce-J;return ve*ve+ye*ye<=d*d};var _l=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Po(p,v){for(var d=0;d<p;d++){var _=v.length;v.resize(_+4),v.float32.set(_l,3*_)}}function Pa(p,v,d){var _=v[0],A=v[1];return p[0]=d[0]*_+d[4]*A+d[12],p[1]=d[1]*_+d[5]*A+d[13],p[3]=d[3]*_+d[7]*A+d[15],p}var es=function(p,v,d){v===void 0&&(v=new Ni(p.width+200,p.height+200,25)),d===void 0&&(d=new Ni(p.width+200,p.height+200,25)),this.transform=p,this.grid=v,this.ignoredGrid=d,this.pitchfactor=Math.cos(p._pitch)*p.cameraToCenterDistance,this.screenRightBoundary=p.width+100,this.screenBottomBoundary=p.height+100,this.gridRightBoundary=p.width+200,this.gridBottomBoundary=p.height+200};function ga(p,v,d){return v*(a.EXTENT/(p.tileSize*Math.pow(2,d-p.tileID.overscaledZ)))}es.prototype.placeCollisionBox=function(p,v,d,_,A){var M=this.projectAndGetPerspectiveRatio(_,p.anchorPointX,p.anchorPointY),R=d*M.perspectiveRatio,B=p.x1*R+M.point.x,G=p.y1*R+M.point.y,J=p.x2*R+M.point.x,ce=p.y2*R+M.point.y;return!this.isInsideGrid(B,G,J,ce)||!v&&this.grid.hitTest(B,G,J,ce,A)?{box:[],offscreen:!1}:{box:[B,G,J,ce],offscreen:this.isOffscreen(B,G,J,ce)}},es.prototype.placeCollisionCircles=function(p,v,d,_,A,M,R,B,G,J,ce,ve,ye){var Oe=[],Re=new a.Point(v.anchorX,v.anchorY),Ge=ti(Re,M),Me=vi(this.transform.cameraToCenterDistance,Ge.signedDistanceFromCamera),He=(J?A/Me:A*Me)/a.ONE_EM,et=ti(Re,R).point,ct=Ma(He,_,v.lineOffsetX*He,v.lineOffsetY*He,!1,et,Re,v,d,R,{}),Pt=!1,At=!1,Ot=!0;if(ct){for(var tr=.5*ve*Me+ye,sr=new a.Point(-100,-100),_r=new a.Point(this.screenRightBoundary,this.screenBottomBoundary),Ur=new Jo,hn=ct.first,An=ct.last,bn=[],Fi=hn.path.length-1;Fi>=1;Fi--)bn.push(hn.path[Fi]);for(var $r=1;$r<An.path.length;$r++)bn.push(An.path[$r]);var Ln=2.5*tr;if(B){var Yn=bn.map(function(mu){return ti(mu,B)});bn=Yn.some(function(mu){return mu.signedDistanceFromCamera<=0})?[]:Yn.map(function(mu){return mu.point})}var $n=[];if(bn.length>0){for(var Fn=bn[0].clone(),ri=bn[0].clone(),zn=1;zn<bn.length;zn++)Fn.x=Math.min(Fn.x,bn[zn].x),Fn.y=Math.min(Fn.y,bn[zn].y),ri.x=Math.max(ri.x,bn[zn].x),ri.y=Math.max(ri.y,bn[zn].y);$n=Fn.x>=sr.x&&ri.x<=_r.x&&Fn.y>=sr.y&&ri.y<=_r.y?[bn]:ri.x<sr.x||Fn.x>_r.x||ri.y<sr.y||Fn.y>_r.y?[]:a.clipLine([bn],sr.x,sr.y,_r.x,_r.y)}for(var pn=0,Ja=$n;pn<Ja.length;pn+=1){var Ha;Ur.reset(Ja[pn],.25*tr),Ha=Ur.length<=.5*tr?1:Math.ceil(Ur.paddedLength/Ln)+1;for(var Va=0;Va<Ha;Va++){var wo=Va/Math.max(Ha-1,1),Ia=Ur.lerp(wo),Ea=Ia.x+100,ms=Ia.y+100;Oe.push(Ea,ms,tr,0);var da=Ea-tr,rl=ms-tr,ks=Ea+tr,Iu=ms+tr;if(Ot=Ot&&this.isOffscreen(da,rl,ks,Iu),At=At||this.isInsideGrid(da,rl,ks,Iu),!p&&this.grid.hitTestCircle(Ea,ms,tr,ce)&&(Pt=!0,!G))return{circles:[],offscreen:!1,collisionDetected:Pt}}}}return{circles:!G&&Pt||!At?[]:Oe,offscreen:Ot,collisionDetected:Pt}},es.prototype.queryRenderedSymbols=function(p){if(p.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var v=[],d=1/0,_=1/0,A=-1/0,M=-1/0,R=0,B=p;R<B.length;R+=1){var G=B[R],J=new a.Point(G.x+100,G.y+100);d=Math.min(d,J.x),_=Math.min(_,J.y),A=Math.max(A,J.x),M=Math.max(M,J.y),v.push(J)}for(var ce={},ve={},ye=0,Oe=this.grid.query(d,_,A,M).concat(this.ignoredGrid.query(d,_,A,M));ye<Oe.length;ye+=1){var Re=Oe[ye],Ge=Re.key;if(ce[Ge.bucketInstanceId]===void 0&&(ce[Ge.bucketInstanceId]={}),!ce[Ge.bucketInstanceId][Ge.featureIndex]){var Me=[new a.Point(Re.x1,Re.y1),new a.Point(Re.x2,Re.y1),new a.Point(Re.x2,Re.y2),new a.Point(Re.x1,Re.y2)];a.polygonIntersectsPolygon(v,Me)&&(ce[Ge.bucketInstanceId][Ge.featureIndex]=!0,ve[Ge.bucketInstanceId]===void 0&&(ve[Ge.bucketInstanceId]=[]),ve[Ge.bucketInstanceId].push(Ge.featureIndex))}}return ve},es.prototype.insertCollisionBox=function(p,v,d,_,A){(v?this.ignoredGrid:this.grid).insert({bucketInstanceId:d,featureIndex:_,collisionGroupID:A},p[0],p[1],p[2],p[3])},es.prototype.insertCollisionCircles=function(p,v,d,_,A){for(var M=v?this.ignoredGrid:this.grid,R={bucketInstanceId:d,featureIndex:_,collisionGroupID:A},B=0;B<p.length;B+=4)M.insertCircle(R,p[B],p[B+1],p[B+2])},es.prototype.projectAndGetPerspectiveRatio=function(p,v,d){var _=[v,d,0,1];return Pa(_,_,p),{point:new a.Point((_[0]/_[3]+1)/2*this.transform.width+100,(-_[1]/_[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/_[3]*.5}},es.prototype.isOffscreen=function(p,v,d,_){return d<100||p>=this.screenRightBoundary||_<100||v>this.screenBottomBoundary},es.prototype.isInsideGrid=function(p,v,d,_){return d>=0&&p<this.gridRightBoundary&&_>=0&&v<this.gridBottomBoundary},es.prototype.getViewportMatrix=function(){var p=a.identity([]);return a.translate(p,p,[-100,-100,0]),p};var hs=function(p,v,d,_){this.opacity=p?Math.max(0,Math.min(1,p.opacity+(p.placed?v:-v))):_&&d?1:0,this.placed=d};hs.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var Fa=function(p,v,d,_,A){this.text=new hs(p?p.text:null,v,d,A),this.icon=new hs(p?p.icon:null,v,_,A)};Fa.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var ic=function(p,v,d){this.text=p,this.icon=v,this.skipFade=d},Ts=function(){this.invProjMatrix=a.create(),this.viewportMatrix=a.create(),this.circles=[]},ac=function(p,v,d,_,A){this.bucketInstanceId=p,this.featureIndex=v,this.sourceLayerIndex=d,this.bucketIndex=_,this.tileID=A},Ws=function(p){this.crossSourceCollisions=p,this.maxGroupID=0,this.collisionGroups={}};function _o(p,v,d,_,A){var M=a.getAnchorAlignment(p),R=-(M.horizontalAlign-.5)*v,B=-(M.verticalAlign-.5)*d,G=a.evaluateVariableOffset(p,_);return new a.Point(R+G[0]*A,B+G[1]*A)}function ps(p,v,d,_,A,M){var R=p.x1,B=p.x2,G=p.y1,J=p.y2,ce=p.anchorPointX,ve=p.anchorPointY,ye=new a.Point(v,d);return _&&ye._rotate(A?M:-M),{x1:R+ye.x,y1:G+ye.y,x2:B+ye.x,y2:J+ye.y,anchorPointX:ce,anchorPointY:ve}}Ws.prototype.get=function(p){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[p]){var v=++this.maxGroupID;this.collisionGroups[p]={ID:v,predicate:function(d){return d.collisionGroupID===v}}}return this.collisionGroups[p]};var se=function(p,v,d,_){this.transform=p.clone(),this.collisionIndex=new es(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=v,this.retainedQueryData={},this.collisionGroups=new Ws(d),this.collisionCircleArrays={},this.prevPlacement=_,_&&(_.prevPlacement=void 0),this.placedOrientations={}};function be(p,v,d,_,A){p.emplaceBack(v?1:0,d?1:0,_||0,A||0),p.emplaceBack(v?1:0,d?1:0,_||0,A||0),p.emplaceBack(v?1:0,d?1:0,_||0,A||0),p.emplaceBack(v?1:0,d?1:0,_||0,A||0)}se.prototype.getBucketParts=function(p,v,d,_){var A=d.getBucket(v),M=d.latestFeatureIndex;if(A&&M&&v.id===A.layerIds[0]){var R=d.collisionBoxArray,B=A.layers[0].layout,G=Math.pow(2,this.transform.zoom-d.tileID.overscaledZ),J=d.tileSize/a.EXTENT,ce=this.transform.calculatePosMatrix(d.tileID.toUnwrapped()),ve=B.get("text-pitch-alignment")==="map",ye=B.get("text-rotation-alignment")==="map",Oe=ga(d,1,this.transform.zoom),Re=Hi(ce,ve,ye,this.transform,Oe),Ge=null;if(ve){var Me=Di(ce,ve,ye,this.transform,Oe);Ge=a.multiply([],this.transform.labelPlaneMatrix,Me)}this.retainedQueryData[A.bucketInstanceId]=new ac(A.bucketInstanceId,M,A.sourceLayerIndex,A.index,d.tileID);var He={bucket:A,layout:B,posMatrix:ce,textLabelPlaneMatrix:Re,labelToScreenMatrix:Ge,scale:G,textPixelRatio:J,holdingForFade:d.holdingForFade(),collisionBoxArray:R,partiallyEvaluatedTextSize:a.evaluateSizeForZoom(A.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(A.sourceID)};if(_)for(var et=0,ct=A.sortKeyRanges;et<ct.length;et+=1){var Pt=ct[et];p.push({sortKey:Pt.sortKey,symbolInstanceStart:Pt.symbolInstanceStart,symbolInstanceEnd:Pt.symbolInstanceEnd,parameters:He})}else p.push({symbolInstanceStart:0,symbolInstanceEnd:A.symbolInstances.length,parameters:He})}},se.prototype.attemptAnchorPlacement=function(p,v,d,_,A,M,R,B,G,J,ce,ve,ye,Oe,Re){var Ge,Me=[ve.textOffset0,ve.textOffset1],He=_o(p,d,_,Me,A),et=this.collisionIndex.placeCollisionBox(ps(v,He.x,He.y,M,R,this.transform.angle),ce,B,G,J.predicate);if(!Re||this.collisionIndex.placeCollisionBox(ps(Re,He.x,He.y,M,R,this.transform.angle),ce,B,G,J.predicate).box.length!==0)return et.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[ve.crossTileID]&&this.prevPlacement.placements[ve.crossTileID]&&this.prevPlacement.placements[ve.crossTileID].text&&(Ge=this.prevPlacement.variableOffsets[ve.crossTileID].anchor),this.variableOffsets[ve.crossTileID]={textOffset:Me,width:d,height:_,anchor:p,textBoxScale:A,prevAnchor:Ge},this.markUsedJustification(ye,p,ve,Oe),ye.allowVerticalPlacement&&(this.markUsedOrientation(ye,Oe,ve),this.placedOrientations[ve.crossTileID]=Oe),{shift:He,placedGlyphBoxes:et}):void 0},se.prototype.placeLayerBucketPart=function(p,v,d){var _=this,A=p.parameters,M=A.bucket,R=A.layout,B=A.posMatrix,G=A.textLabelPlaneMatrix,J=A.labelToScreenMatrix,ce=A.textPixelRatio,ve=A.holdingForFade,ye=A.collisionBoxArray,Oe=A.partiallyEvaluatedTextSize,Re=A.collisionGroup,Ge=R.get("text-optional"),Me=R.get("icon-optional"),He=R.get("text-allow-overlap"),et=R.get("icon-allow-overlap"),ct=R.get("text-rotation-alignment")==="map",Pt=R.get("text-pitch-alignment")==="map",At=R.get("icon-text-fit")!=="none",Ot=R.get("symbol-z-order")==="viewport-y",tr=He&&(et||!M.hasIconData()||Me),sr=et&&(He||!M.hasTextData()||Ge);!M.collisionArrays&&ye&&M.deserializeCollisionBoxes(ye);var _r=function($r,Ln){if(!v[$r.crossTileID])if(ve)_.placements[$r.crossTileID]=new ic(!1,!1,!1);else{var Yn,$n=!1,Fn=!1,ri=!0,zn=null,pn={box:null,offscreen:null},Ja={box:null,offscreen:null},Ha=null,Va=null,wo=0,Ia=0,Ea=0;Ln.textFeatureIndex?wo=Ln.textFeatureIndex:$r.useRuntimeCollisionCircles&&(wo=$r.featureIndex),Ln.verticalTextFeatureIndex&&(Ia=Ln.verticalTextFeatureIndex);var ms=Ln.textBox;if(ms){var da=function($i){var Bs=a.WritingMode.horizontal;if(M.allowVerticalPlacement&&!$i&&_.prevPlacement){var zo=_.prevPlacement.placedOrientations[$r.crossTileID];zo&&(_.placedOrientations[$r.crossTileID]=zo,_.markUsedOrientation(M,Bs=zo,$r))}return Bs},rl=function($i,Bs){if(M.allowVerticalPlacement&&$r.numVerticalGlyphVertices>0&&Ln.verticalTextBox)for(var zo=0,Cl=M.writingModes;zo<Cl.length&&(Cl[zo]===a.WritingMode.vertical?(pn=Bs(),Ja=pn):pn=$i(),!(pn&&pn.box&&pn.box.length));zo+=1);else pn=$i()};if(R.get("text-variable-anchor")){var ks=R.get("text-variable-anchor");if(_.prevPlacement&&_.prevPlacement.variableOffsets[$r.crossTileID]){var Iu=_.prevPlacement.variableOffsets[$r.crossTileID];ks.indexOf(Iu.anchor)>0&&(ks=ks.filter(function($i){return $i!==Iu.anchor})).unshift(Iu.anchor)}var mu=function($i,Bs,zo){for(var Cl=$i.x2-$i.x1,up=$i.y2-$i.y1,tu=$r.textBoxScale,Mf=At&&!et?Bs:null,Ru={box:[],offscreen:!1},nf=He?2*ks.length:ks.length,_u=0;_u<nf;++_u){var Ml=_.attemptAnchorPlacement(ks[_u%ks.length],$i,Cl,up,tu,ct,Pt,ce,B,Re,_u>=ks.length,$r,M,zo,Mf);if(Ml&&(Ru=Ml.placedGlyphBoxes)&&Ru.box&&Ru.box.length){$n=!0,zn=Ml.shift;break}}return Ru};rl(function(){return mu(ms,Ln.iconBox,a.WritingMode.horizontal)},function(){var $i=Ln.verticalTextBox;return M.allowVerticalPlacement&&!(pn&&pn.box&&pn.box.length)&&$r.numVerticalGlyphVertices>0&&$i?mu($i,Ln.verticalIconBox,a.WritingMode.vertical):{box:null,offscreen:null}}),pn&&($n=pn.box,ri=pn.offscreen);var Xl=da(pn&&pn.box);if(!$n&&_.prevPlacement){var tf=_.prevPlacement.variableOffsets[$r.crossTileID];tf&&(_.variableOffsets[$r.crossTileID]=tf,_.markUsedJustification(M,tf.anchor,$r,Xl))}}else{var gu=function($i,Bs){var zo=_.collisionIndex.placeCollisionBox($i,He,ce,B,Re.predicate);return zo&&zo.box&&zo.box.length&&(_.markUsedOrientation(M,Bs,$r),_.placedOrientations[$r.crossTileID]=Bs),zo};rl(function(){return gu(ms,a.WritingMode.horizontal)},function(){var $i=Ln.verticalTextBox;return M.allowVerticalPlacement&&$r.numVerticalGlyphVertices>0&&$i?gu($i,a.WritingMode.vertical):{box:null,offscreen:null}}),da(pn&&pn.box&&pn.box.length)}}if($n=(Yn=pn)&&Yn.box&&Yn.box.length>0,ri=Yn&&Yn.offscreen,$r.useRuntimeCollisionCircles){var Yl=M.text.placedSymbolArray.get($r.centerJustifiedTextSymbolIndex),rf=a.evaluateSizeForFeature(M.textSizeData,Oe,Yl),nl=R.get("text-padding");Ha=_.collisionIndex.placeCollisionCircles(He,Yl,M.lineVertexArray,M.glyphOffsetArray,rf,B,G,J,d,Pt,Re.predicate,$r.collisionCircleDiameter,nl),$n=He||Ha.circles.length>0&&!Ha.collisionDetected,ri=ri&&Ha.offscreen}if(Ln.iconFeatureIndex&&(Ea=Ln.iconFeatureIndex),Ln.iconBox){var il=function($i){var Bs=At&&zn?ps($i,zn.x,zn.y,ct,Pt,_.transform.angle):$i;return _.collisionIndex.placeCollisionBox(Bs,et,ce,B,Re.predicate)};Fn=Ja&&Ja.box&&Ja.box.length&&Ln.verticalIconBox?(Va=il(Ln.verticalIconBox)).box.length>0:(Va=il(Ln.iconBox)).box.length>0,ri=ri&&Va.offscreen}var al=Ge||$r.numHorizontalGlyphVertices===0&&$r.numVerticalGlyphVertices===0,Ro=Me||$r.numIconVertices===0;if(al||Ro?Ro?al||(Fn=Fn&&$n):$n=Fn&&$n:Fn=$n=Fn&&$n,$n&&Yn&&Yn.box&&_.collisionIndex.insertCollisionBox(Yn.box,R.get("text-ignore-placement"),M.bucketInstanceId,Ja&&Ja.box&&Ia?Ia:wo,Re.ID),Fn&&Va&&_.collisionIndex.insertCollisionBox(Va.box,R.get("icon-ignore-placement"),M.bucketInstanceId,Ea,Re.ID),Ha&&($n&&_.collisionIndex.insertCollisionCircles(Ha.circles,R.get("text-ignore-placement"),M.bucketInstanceId,wo,Re.ID),d)){var yu=M.bucketInstanceId,Tl=_.collisionCircleArrays[yu];Tl===void 0&&(Tl=_.collisionCircleArrays[yu]=new Ts);for(var Ac=0;Ac<Ha.circles.length;Ac+=4)Tl.circles.push(Ha.circles[Ac+0]),Tl.circles.push(Ha.circles[Ac+1]),Tl.circles.push(Ha.circles[Ac+2]),Tl.circles.push(Ha.collisionDetected?1:0)}_.placements[$r.crossTileID]=new ic($n||tr,Fn||sr,ri||M.justReloaded),v[$r.crossTileID]=!0}};if(Ot)for(var Ur=M.getSortedSymbolIndexes(this.transform.angle),hn=Ur.length-1;hn>=0;--hn){var An=Ur[hn];_r(M.symbolInstances.get(An),M.collisionArrays[An])}else for(var bn=p.symbolInstanceStart;bn<p.symbolInstanceEnd;bn++)_r(M.symbolInstances.get(bn),M.collisionArrays[bn]);if(d&&M.bucketInstanceId in this.collisionCircleArrays){var Fi=this.collisionCircleArrays[M.bucketInstanceId];a.invert(Fi.invProjMatrix,B),Fi.viewportMatrix=this.collisionIndex.getViewportMatrix()}M.justReloaded=!1},se.prototype.markUsedJustification=function(p,v,d,_){var A;A=_===a.WritingMode.vertical?d.verticalPlacedTextSymbolIndex:{left:d.leftJustifiedTextSymbolIndex,center:d.centerJustifiedTextSymbolIndex,right:d.rightJustifiedTextSymbolIndex}[a.getAnchorJustification(v)];for(var M=0,R=[d.leftJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.rightJustifiedTextSymbolIndex,d.verticalPlacedTextSymbolIndex];M<R.length;M+=1){var B=R[M];B>=0&&(p.text.placedSymbolArray.get(B).crossTileID=A>=0&&B!==A?0:d.crossTileID)}},se.prototype.markUsedOrientation=function(p,v,d){for(var _=v===a.WritingMode.horizontal||v===a.WritingMode.horizontalOnly?v:0,A=v===a.WritingMode.vertical?v:0,M=0,R=[d.leftJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.rightJustifiedTextSymbolIndex];M<R.length;M+=1)p.text.placedSymbolArray.get(R[M]).placedOrientation=_;d.verticalPlacedTextSymbolIndex&&(p.text.placedSymbolArray.get(d.verticalPlacedTextSymbolIndex).placedOrientation=A)},se.prototype.commit=function(p){this.commitTime=p,this.zoomAtLastRecencyCheck=this.transform.zoom;var v=this.prevPlacement,d=!1;this.prevZoomAdjustment=v?v.zoomAdjustment(this.transform.zoom):0;var _=v?v.symbolFadeChange(p):1,A=v?v.opacities:{},M=v?v.variableOffsets:{},R=v?v.placedOrientations:{};for(var B in this.placements){var G=this.placements[B],J=A[B];J?(this.opacities[B]=new Fa(J,_,G.text,G.icon),d=d||G.text!==J.text.placed||G.icon!==J.icon.placed):(this.opacities[B]=new Fa(null,_,G.text,G.icon,G.skipFade),d=d||G.text||G.icon)}for(var ce in A){var ve=A[ce];if(!this.opacities[ce]){var ye=new Fa(ve,_,!1,!1);ye.isHidden()||(this.opacities[ce]=ye,d=d||ve.text.placed||ve.icon.placed)}}for(var Oe in M)this.variableOffsets[Oe]||!this.opacities[Oe]||this.opacities[Oe].isHidden()||(this.variableOffsets[Oe]=M[Oe]);for(var Re in R)this.placedOrientations[Re]||!this.opacities[Re]||this.opacities[Re].isHidden()||(this.placedOrientations[Re]=R[Re]);d?this.lastPlacementChangeTime=p:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=v?v.lastPlacementChangeTime:p)},se.prototype.updateLayerOpacities=function(p,v){for(var d={},_=0,A=v;_<A.length;_+=1){var M=A[_],R=M.getBucket(p);R&&M.latestFeatureIndex&&p.id===R.layerIds[0]&&this.updateBucketOpacities(R,d,M.collisionBoxArray)}},se.prototype.updateBucketOpacities=function(p,v,d){var _=this;p.hasTextData()&&p.text.opacityVertexArray.clear(),p.hasIconData()&&p.icon.opacityVertexArray.clear(),p.hasIconCollisionBoxData()&&p.iconCollisionBox.collisionVertexArray.clear(),p.hasTextCollisionBoxData()&&p.textCollisionBox.collisionVertexArray.clear();var A=p.layers[0].layout,M=new Fa(null,0,!1,!1,!0),R=A.get("text-allow-overlap"),B=A.get("icon-allow-overlap"),G=A.get("text-variable-anchor"),J=A.get("text-rotation-alignment")==="map",ce=A.get("text-pitch-alignment")==="map",ve=A.get("icon-text-fit")!=="none",ye=new Fa(null,0,R&&(B||!p.hasIconData()||A.get("icon-optional")),B&&(R||!p.hasTextData()||A.get("text-optional")),!0);!p.collisionArrays&&d&&(p.hasIconCollisionBoxData()||p.hasTextCollisionBoxData())&&p.deserializeCollisionBoxes(d);for(var Oe=function(He,et,ct){for(var Pt=0;Pt<et/4;Pt++)He.opacityVertexArray.emplaceBack(ct)},Re=function(He){var et=p.symbolInstances.get(He),ct=et.numHorizontalGlyphVertices,Pt=et.numVerticalGlyphVertices,At=et.crossTileID,Ot=_.opacities[At];v[At]?Ot=M:Ot||(_.opacities[At]=Ot=ye),v[At]=!0;var tr=et.numIconVertices>0,sr=_.placedOrientations[et.crossTileID],_r=sr===a.WritingMode.vertical,Ur=sr===a.WritingMode.horizontal||sr===a.WritingMode.horizontalOnly;if(ct>0||Pt>0){var hn=ts(Ot.text);Oe(p.text,ct,_r?Do:hn),Oe(p.text,Pt,Ur?Do:hn);var An=Ot.text.isHidden();[et.rightJustifiedTextSymbolIndex,et.centerJustifiedTextSymbolIndex,et.leftJustifiedTextSymbolIndex].forEach(function(pn){pn>=0&&(p.text.placedSymbolArray.get(pn).hidden=An||_r?1:0)}),et.verticalPlacedTextSymbolIndex>=0&&(p.text.placedSymbolArray.get(et.verticalPlacedTextSymbolIndex).hidden=An||Ur?1:0);var bn=_.variableOffsets[et.crossTileID];bn&&_.markUsedJustification(p,bn.anchor,et,sr);var Fi=_.placedOrientations[et.crossTileID];Fi&&(_.markUsedJustification(p,"left",et,Fi),_.markUsedOrientation(p,Fi,et))}if(tr){var $r=ts(Ot.icon),Ln=!(ve&&et.verticalPlacedIconSymbolIndex&&_r);et.placedIconSymbolIndex>=0&&(Oe(p.icon,et.numIconVertices,Ln?$r:Do),p.icon.placedSymbolArray.get(et.placedIconSymbolIndex).hidden=Ot.icon.isHidden()),et.verticalPlacedIconSymbolIndex>=0&&(Oe(p.icon,et.numVerticalIconVertices,Ln?Do:$r),p.icon.placedSymbolArray.get(et.verticalPlacedIconSymbolIndex).hidden=Ot.icon.isHidden())}if(p.hasIconCollisionBoxData()||p.hasTextCollisionBoxData()){var Yn=p.collisionArrays[He];if(Yn){var $n=new a.Point(0,0);if(Yn.textBox||Yn.verticalTextBox){var Fn=!0;if(G){var ri=_.variableOffsets[At];ri?($n=_o(ri.anchor,ri.width,ri.height,ri.textOffset,ri.textBoxScale),J&&$n._rotate(ce?_.transform.angle:-_.transform.angle)):Fn=!1}Yn.textBox&&be(p.textCollisionBox.collisionVertexArray,Ot.text.placed,!Fn||_r,$n.x,$n.y),Yn.verticalTextBox&&be(p.textCollisionBox.collisionVertexArray,Ot.text.placed,!Fn||Ur,$n.x,$n.y)}var zn=!!(!Ur&&Yn.verticalIconBox);Yn.iconBox&&be(p.iconCollisionBox.collisionVertexArray,Ot.icon.placed,zn,ve?$n.x:0,ve?$n.y:0),Yn.verticalIconBox&&be(p.iconCollisionBox.collisionVertexArray,Ot.icon.placed,!zn,ve?$n.x:0,ve?$n.y:0)}}},Ge=0;Ge<p.symbolInstances.length;Ge++)Re(Ge);if(p.sortFeatures(this.transform.angle),this.retainedQueryData[p.bucketInstanceId]&&(this.retainedQueryData[p.bucketInstanceId].featureSortOrder=p.featureSortOrder),p.hasTextData()&&p.text.opacityVertexBuffer&&p.text.opacityVertexBuffer.updateData(p.text.opacityVertexArray),p.hasIconData()&&p.icon.opacityVertexBuffer&&p.icon.opacityVertexBuffer.updateData(p.icon.opacityVertexArray),p.hasIconCollisionBoxData()&&p.iconCollisionBox.collisionVertexBuffer&&p.iconCollisionBox.collisionVertexBuffer.updateData(p.iconCollisionBox.collisionVertexArray),p.hasTextCollisionBoxData()&&p.textCollisionBox.collisionVertexBuffer&&p.textCollisionBox.collisionVertexBuffer.updateData(p.textCollisionBox.collisionVertexArray),p.bucketInstanceId in this.collisionCircleArrays){var Me=this.collisionCircleArrays[p.bucketInstanceId];p.placementInvProjMatrix=Me.invProjMatrix,p.placementViewportMatrix=Me.viewportMatrix,p.collisionCircleArray=Me.circles,delete this.collisionCircleArrays[p.bucketInstanceId]}},se.prototype.symbolFadeChange=function(p){return this.fadeDuration===0?1:(p-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},se.prototype.zoomAdjustment=function(p){return Math.max(0,(this.transform.zoom-p)/1.5)},se.prototype.hasTransitions=function(p){return this.stale||p-this.lastPlacementChangeTime<this.fadeDuration},se.prototype.stillRecent=function(p,v){var d=this.zoomAtLastRecencyCheck===v?1-this.zoomAdjustment(v):1;return this.zoomAtLastRecencyCheck=v,this.commitTime+this.fadeDuration*d>p},se.prototype.setStale=function(){this.stale=!0};var Xe=Math.pow(2,25),Lt=Math.pow(2,24),xr=Math.pow(2,17),Sn=Math.pow(2,16),Ci=Math.pow(2,9),Io=Math.pow(2,8),Oo=Math.pow(2,1);function ts(p){if(p.opacity===0&&!p.placed)return 0;if(p.opacity===1&&p.placed)return 4294967295;var v=p.placed?1:0,d=Math.floor(127*p.opacity);return d*Xe+v*Lt+d*xr+v*Sn+d*Ci+v*Io+d*Oo+v}var Do=0,Wp=function(p){this._sortAcrossTiles=p.layout.get("symbol-z-order")!=="viewport-y"&&p.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};Wp.prototype.continuePlacement=function(p,v,d,_,A){for(var M=this._bucketParts;this._currentTileIndex<p.length;)if(v.getBucketParts(M,_,p[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,A())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,M.sort(function(R,B){return R.sortKey-B.sortKey}));this._currentPartIndex<M.length;)if(v.placeLayerBucketPart(M[this._currentPartIndex],this._seenCrossTileIDs,d),this._currentPartIndex++,A())return!0;return!1};var sh=function(p,v,d,_,A,M,R){this.placement=new se(p,A,M,R),this._currentPlacementIndex=v.length-1,this._forceFullPlacement=d,this._showCollisionBoxes=_,this._done=!1};sh.prototype.isDone=function(){return this._done},sh.prototype.continuePlacement=function(p,v,d){for(var _=this,A=a.browser.now(),M=function(){var G=a.browser.now()-A;return!_._forceFullPlacement&&G>2};this._currentPlacementIndex>=0;){var R=v[p[this._currentPlacementIndex]],B=this.placement.collisionIndex.transform.zoom;if(R.type==="symbol"&&(!R.minzoom||R.minzoom<=B)&&(!R.maxzoom||R.maxzoom>B)){if(this._inProgressLayer||(this._inProgressLayer=new Wp(R)),this._inProgressLayer.continuePlacement(d[R.source],this.placement,this._showCollisionBoxes,R,M))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},sh.prototype.commit=function(p){return this.placement.commit(p),this.placement};var Vd=512/a.EXTENT/2,Qh=function(p,v,d){this.tileID=p,this.indexedSymbolInstances={},this.bucketInstanceId=d;for(var _=0;_<v.length;_++){var A=v.get(_),M=A.key;this.indexedSymbolInstances[M]||(this.indexedSymbolInstances[M]=[]),this.indexedSymbolInstances[M].push({crossTileID:A.crossTileID,coord:this.getScaledCoordinates(A,p)})}};Qh.prototype.getScaledCoordinates=function(p,v){var d=Vd/Math.pow(2,v.canonical.z-this.tileID.canonical.z);return{x:Math.floor((v.canonical.x*a.EXTENT+p.anchorX)*d),y:Math.floor((v.canonical.y*a.EXTENT+p.anchorY)*d)}},Qh.prototype.findMatches=function(p,v,d){for(var _=this.tileID.canonical.z<v.canonical.z?1:Math.pow(2,this.tileID.canonical.z-v.canonical.z),A=0;A<p.length;A++){var M=p.get(A);if(!M.crossTileID){var R=this.indexedSymbolInstances[M.key];if(R)for(var B=this.getScaledCoordinates(M,v),G=0,J=R;G<J.length;G+=1){var ce=J[G];if(Math.abs(ce.coord.x-B.x)<=_&&Math.abs(ce.coord.y-B.y)<=_&&!d[ce.crossTileID]){d[ce.crossTileID]=!0,M.crossTileID=ce.crossTileID;break}}}}};var Xs=function(){this.maxCrossTileID=0};Xs.prototype.generate=function(){return++this.maxCrossTileID};var oc=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};oc.prototype.handleWrapJump=function(p){var v=Math.round((p-this.lng)/360);if(v!==0)for(var d in this.indexes){var _=this.indexes[d],A={};for(var M in _){var R=_[M];R.tileID=R.tileID.unwrapTo(R.tileID.wrap+v),A[R.tileID.key]=R}this.indexes[d]=A}this.lng=p},oc.prototype.addBucket=function(p,v,d){if(this.indexes[p.overscaledZ]&&this.indexes[p.overscaledZ][p.key]){if(this.indexes[p.overscaledZ][p.key].bucketInstanceId===v.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(p.overscaledZ,this.indexes[p.overscaledZ][p.key])}for(var _=0;_<v.symbolInstances.length;_++)v.symbolInstances.get(_).crossTileID=0;this.usedCrossTileIDs[p.overscaledZ]||(this.usedCrossTileIDs[p.overscaledZ]={});var A=this.usedCrossTileIDs[p.overscaledZ];for(var M in this.indexes){var R=this.indexes[M];if(Number(M)>p.overscaledZ)for(var B in R){var G=R[B];G.tileID.isChildOf(p)&&G.findMatches(v.symbolInstances,p,A)}else{var J=R[p.scaledTo(Number(M)).key];J&&J.findMatches(v.symbolInstances,p,A)}}for(var ce=0;ce<v.symbolInstances.length;ce++){var ve=v.symbolInstances.get(ce);ve.crossTileID||(ve.crossTileID=d.generate(),A[ve.crossTileID]=!0)}return this.indexes[p.overscaledZ]===void 0&&(this.indexes[p.overscaledZ]={}),this.indexes[p.overscaledZ][p.key]=new Qh(p,v.symbolInstances,v.bucketInstanceId),!0},oc.prototype.removeBucketCrossTileIDs=function(p,v){for(var d in v.indexedSymbolInstances)for(var _=0,A=v.indexedSymbolInstances[d];_<A.length;_+=1)delete this.usedCrossTileIDs[p][A[_].crossTileID]},oc.prototype.removeStaleBuckets=function(p){var v=!1;for(var d in this.indexes){var _=this.indexes[d];for(var A in _)p[_[A].bucketInstanceId]||(this.removeBucketCrossTileIDs(d,_[A]),delete _[A],v=!0)}return v};var sc=function(){this.layerIndexes={},this.crossTileIDs=new Xs,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};sc.prototype.addLayer=function(p,v,d){var _=this.layerIndexes[p.id];_===void 0&&(_=this.layerIndexes[p.id]=new oc);var A=!1,M={};_.handleWrapJump(d);for(var R=0,B=v;R<B.length;R+=1){var G=B[R],J=G.getBucket(p);J&&p.id===J.layerIds[0]&&(J.bucketInstanceId||(J.bucketInstanceId=++this.maxBucketInstanceId),_.addBucket(G.tileID,J,this.crossTileIDs)&&(A=!0),M[J.bucketInstanceId]=!0)}return _.removeStaleBuckets(M)&&(A=!0),A},sc.prototype.pruneUnusedLayers=function(p){var v={};for(var d in p.forEach(function(_){v[_]=!0}),this.layerIndexes)v[d]||delete this.layerIndexes[d]};var Gc=function(p,v){return a.emitValidationErrors(p,v&&v.filter(function(d){return d.identifier!=="source.canvas"}))},Ys=a.pick(Dr,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),uc=a.pick(Dr,["setCenter","setZoom","setBearing","setPitch"]),Na=function(){var p={},v=a.styleSpec.$version;for(var d in a.styleSpec.$root){var _,A=a.styleSpec.$root[d];A.required&&(_=d==="version"?v:A.type==="array"?[]:{})!=null&&(p[d]=_)}return p}(),Mi=function(p){function v(d,_){var A=this;_===void 0&&(_={}),p.call(this),this.map=d,this.dispatcher=new Ne(Dt(),this),this.imageManager=new O,this.imageManager.setEventedParent(this),this.glyphManager=new pe(d._requestManager,_.localIdeographFontFamily),this.lineAtlas=new Se(256,512),this.crossTileSymbolIndex=new sc,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new a.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",a.getReferrer());var M=this;this._rtlTextPluginCallback=v.registerForPluginStateChange(function(R){M.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:R.pluginStatus,pluginURL:R.pluginURL},function(B,G){if(a.triggerPluginCompletionEvent(B),G&&G.every(function(ce){return ce}))for(var J in M.sourceCaches)M.sourceCaches[J].reload()})}),this.on("data",function(R){if(R.dataType==="source"&&R.sourceDataType==="metadata"){var B=A.sourceCaches[R.sourceId];if(B){var G=B.getSource();if(G&&G.vectorLayerIds)for(var J in A._layers){var ce=A._layers[J];ce.source===G.id&&A._validateLayer(ce)}}}})}return p&&(v.__proto__=p),(v.prototype=Object.create(p&&p.prototype)).constructor=v,v.prototype.loadURL=function(d,_){var A=this;_===void 0&&(_={}),this.fire(new a.Event("dataloading",{dataType:"style"}));var M=typeof _.validate=="boolean"?_.validate:!a.isMapboxURL(d);d=this.map._requestManager.normalizeStyleURL(d,_.accessToken);var R=this.map._requestManager.transformRequest(d,a.ResourceType.Style);this._request=a.getJSON(R,function(B,G){A._request=null,B?A.fire(new a.ErrorEvent(B)):G&&A._load(G,M)})},v.prototype.loadJSON=function(d,_){var A=this;_===void 0&&(_={}),this.fire(new a.Event("dataloading",{dataType:"style"})),this._request=a.browser.frame(function(){A._request=null,A._load(d,_.validate!==!1)})},v.prototype.loadEmpty=function(){this.fire(new a.Event("dataloading",{dataType:"style"})),this._load(Na,!1)},v.prototype._load=function(d,_){if(!_||!Gc(this,a.validateStyle(d))){for(var A in this._loaded=!0,this.stylesheet=d,d.sources)this.addSource(A,d.sources[A],{validate:!1});d.sprite?this._loadSprite(d.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(d.glyphs);var M=Ir(this.stylesheet.layers);this._order=M.map(function(J){return J.id}),this._layers={},this._serializedLayers={};for(var R=0,B=M;R<B.length;R+=1){var G=B[R];(G=a.createStyleLayer(G)).setEventedParent(this,{layer:{id:G.id}}),this._layers[G.id]=G,this._serializedLayers[G.id]=G.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new xe(this.stylesheet.light),this.fire(new a.Event("data",{dataType:"style"})),this.fire(new a.Event("style.load"))}},v.prototype._loadSprite=function(d){var _=this;this._spriteRequest=function(A,M,R){var B,G,J,ce=a.browser.devicePixelRatio>1?"@2x":"",ve=a.getJSON(M.transformRequest(M.normalizeSpriteURL(A,ce,".json"),a.ResourceType.SpriteJSON),function(Re,Ge){ve=null,J||(J=Re,B=Ge,Oe())}),ye=a.getImage(M.transformRequest(M.normalizeSpriteURL(A,ce,".png"),a.ResourceType.SpriteImage),function(Re,Ge){ye=null,J||(J=Re,G=Ge,Oe())});function Oe(){if(J)R(J);else if(B&&G){var Re=a.browser.getImageData(G),Ge={};for(var Me in B){var He=B[Me],et=He.width,ct=He.height,Pt=He.x,At=He.y,Ot=He.sdf,tr=He.pixelRatio,sr=He.stretchX,_r=He.stretchY,Ur=He.content,hn=new a.RGBAImage({width:et,height:ct});a.RGBAImage.copy(Re,hn,{x:Pt,y:At},{x:0,y:0},{width:et,height:ct}),Ge[Me]={data:hn,pixelRatio:tr,sdf:Ot,stretchX:sr,stretchY:_r,content:Ur}}R(null,Ge)}}return{cancel:function(){ve&&(ve.cancel(),ve=null),ye&&(ye.cancel(),ye=null)}}}(d,this.map._requestManager,function(A,M){if(_._spriteRequest=null,A)_.fire(new a.ErrorEvent(A));else if(M)for(var R in M)_.imageManager.addImage(R,M[R]);_.imageManager.setLoaded(!0),_._availableImages=_.imageManager.listImages(),_.dispatcher.broadcast("setImages",_._availableImages),_.fire(new a.Event("data",{dataType:"style"}))})},v.prototype._validateLayer=function(d){var _=this.sourceCaches[d.source];if(_){var A=d.sourceLayer;if(A){var M=_.getSource();(M.type==="geojson"||M.vectorLayerIds&&M.vectorLayerIds.indexOf(A)===-1)&&this.fire(new a.ErrorEvent(new Error('Source layer "'+A+'" does not exist on source "'+M.id+'" as specified by style layer "'+d.id+'"')))}}},v.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var d in this.sourceCaches)if(!this.sourceCaches[d].loaded())return!1;return!!this.imageManager.isLoaded()},v.prototype._serializeLayers=function(d){for(var _=[],A=0,M=d;A<M.length;A+=1){var R=this._layers[M[A]];R.type!=="custom"&&_.push(R.serialize())}return _},v.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var d in this.sourceCaches)if(this.sourceCaches[d].hasTransition())return!0;for(var _ in this._layers)if(this._layers[_].hasTransition())return!0;return!1},v.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},v.prototype.update=function(d){if(this._loaded){var _=this._changed;if(this._changed){var A=Object.keys(this._updatedLayers),M=Object.keys(this._removedLayers);for(var R in(A.length||M.length)&&this._updateWorkerLayers(A,M),this._updatedSources){var B=this._updatedSources[R];B==="reload"?this._reloadSource(R):B==="clear"&&this._clearSource(R)}for(var G in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[G].updateTransitions(d);this.light.updateTransitions(d),this._resetUpdates()}var J={};for(var ce in this.sourceCaches){var ve=this.sourceCaches[ce];J[ce]=ve.used,ve.used=!1}for(var ye=0,Oe=this._order;ye<Oe.length;ye+=1){var Re=this._layers[Oe[ye]];Re.recalculate(d,this._availableImages),!Re.isHidden(d.zoom)&&Re.source&&(this.sourceCaches[Re.source].used=!0)}for(var Ge in J){var Me=this.sourceCaches[Ge];J[Ge]!==Me.used&&Me.fire(new a.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:Ge}))}this.light.recalculate(d),this.z=d.zoom,_&&this.fire(new a.Event("data",{dataType:"style"}))}},v.prototype._updateTilesForChangedImages=function(){var d=Object.keys(this._changedImages);if(d.length){for(var _ in this.sourceCaches)this.sourceCaches[_].reloadTilesForDependencies(["icons","patterns"],d);this._changedImages={}}},v.prototype._updateWorkerLayers=function(d,_){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(d),removedIds:_})},v.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},v.prototype.setState=function(d){var _=this;if(this._checkLoaded(),Gc(this,a.validateStyle(d)))return!1;(d=a.clone$1(d)).layers=Ir(d.layers);var A=function(R,B){if(!R)return[{command:Dr.setStyle,args:[B]}];var G=[];try{if(!a.deepEqual(R.version,B.version))return[{command:Dr.setStyle,args:[B]}];a.deepEqual(R.center,B.center)||G.push({command:Dr.setCenter,args:[B.center]}),a.deepEqual(R.zoom,B.zoom)||G.push({command:Dr.setZoom,args:[B.zoom]}),a.deepEqual(R.bearing,B.bearing)||G.push({command:Dr.setBearing,args:[B.bearing]}),a.deepEqual(R.pitch,B.pitch)||G.push({command:Dr.setPitch,args:[B.pitch]}),a.deepEqual(R.sprite,B.sprite)||G.push({command:Dr.setSprite,args:[B.sprite]}),a.deepEqual(R.glyphs,B.glyphs)||G.push({command:Dr.setGlyphs,args:[B.glyphs]}),a.deepEqual(R.transition,B.transition)||G.push({command:Dr.setTransition,args:[B.transition]}),a.deepEqual(R.light,B.light)||G.push({command:Dr.setLight,args:[B.light]});var J={},ce=[];(function(ye,Oe,Re,Ge){var Me;for(Me in Oe=Oe||{},ye=ye||{})ye.hasOwnProperty(Me)&&(Oe.hasOwnProperty(Me)||Fr(Me,Re,Ge));for(Me in Oe)Oe.hasOwnProperty(Me)&&(ye.hasOwnProperty(Me)?a.deepEqual(ye[Me],Oe[Me])||(ye[Me].type==="geojson"&&Oe[Me].type==="geojson"&&Oi(ye,Oe,Me)?Re.push({command:Dr.setGeoJSONSourceData,args:[Me,Oe[Me].data]}):fi(Me,Oe,Re,Ge)):ii(Me,Oe,Re))})(R.sources,B.sources,ce,J);var ve=[];R.layers&&R.layers.forEach(function(ye){J[ye.source]?G.push({command:Dr.removeLayer,args:[ye.id]}):ve.push(ye)}),G=G.concat(ce),function(ye,Oe,Re){Oe=Oe||[];var Ge,Me,He,et,ct,Pt,At,Ot=(ye=ye||[]).map(Si),tr=Oe.map(Si),sr=ye.reduce(Ti,{}),_r=Oe.reduce(Ti,{}),Ur=Ot.slice(),hn=Object.create(null);for(Ge=0,Me=0;Ge<Ot.length;Ge++)_r.hasOwnProperty(He=Ot[Ge])?Me++:(Re.push({command:Dr.removeLayer,args:[He]}),Ur.splice(Ur.indexOf(He,Me),1));for(Ge=0,Me=0;Ge<tr.length;Ge++)Ur[Ur.length-1-Ge]!==(He=tr[tr.length-1-Ge])&&(sr.hasOwnProperty(He)?(Re.push({command:Dr.removeLayer,args:[He]}),Ur.splice(Ur.lastIndexOf(He,Ur.length-Me),1)):Me++,Re.push({command:Dr.addLayer,args:[_r[He],Pt=Ur[Ur.length-Ge]]}),Ur.splice(Ur.length-Ge,0,He),hn[He]=!0);for(Ge=0;Ge<tr.length;Ge++)if(et=sr[He=tr[Ge]],ct=_r[He],!hn[He]&&!a.deepEqual(et,ct))if(a.deepEqual(et.source,ct.source)&&a.deepEqual(et["source-layer"],ct["source-layer"])&&a.deepEqual(et.type,ct.type)){for(At in oi(et.layout,ct.layout,Re,He,null,Dr.setLayoutProperty),oi(et.paint,ct.paint,Re,He,null,Dr.setPaintProperty),a.deepEqual(et.filter,ct.filter)||Re.push({command:Dr.setFilter,args:[He,ct.filter]}),a.deepEqual(et.minzoom,ct.minzoom)&&a.deepEqual(et.maxzoom,ct.maxzoom)||Re.push({command:Dr.setLayerZoomRange,args:[He,ct.minzoom,ct.maxzoom]}),et)et.hasOwnProperty(At)&&At!=="layout"&&At!=="paint"&&At!=="filter"&&At!=="metadata"&&At!=="minzoom"&&At!=="maxzoom"&&(At.indexOf("paint.")===0?oi(et[At],ct[At],Re,He,At.slice(6),Dr.setPaintProperty):a.deepEqual(et[At],ct[At])||Re.push({command:Dr.setLayerProperty,args:[He,At,ct[At]]}));for(At in ct)ct.hasOwnProperty(At)&&!et.hasOwnProperty(At)&&At!=="layout"&&At!=="paint"&&At!=="filter"&&At!=="metadata"&&At!=="minzoom"&&At!=="maxzoom"&&(At.indexOf("paint.")===0?oi(et[At],ct[At],Re,He,At.slice(6),Dr.setPaintProperty):a.deepEqual(et[At],ct[At])||Re.push({command:Dr.setLayerProperty,args:[He,At,ct[At]]}))}else Re.push({command:Dr.removeLayer,args:[He]}),Pt=Ur[Ur.lastIndexOf(He)+1],Re.push({command:Dr.addLayer,args:[ct,Pt]})}(ve,B.layers,G)}catch{G=[{command:Dr.setStyle,args:[B]}]}return G}(this.serialize(),d).filter(function(R){return!(R.command in uc)});if(A.length===0)return!1;var M=A.filter(function(R){return!(R.command in Ys)});if(M.length>0)throw new Error("Unimplemented: "+M.map(function(R){return R.command}).join(", ")+".");return A.forEach(function(R){R.command!=="setTransition"&&_[R.command].apply(_,R.args)}),this.stylesheet=d,!0},v.prototype.addImage=function(d,_){if(this.getImage(d))return this.fire(new a.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(d,_),this._afterImageUpdated(d)},v.prototype.updateImage=function(d,_){this.imageManager.updateImage(d,_)},v.prototype.getImage=function(d){return this.imageManager.getImage(d)},v.prototype.removeImage=function(d){if(!this.getImage(d))return this.fire(new a.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(d),this._afterImageUpdated(d)},v.prototype._afterImageUpdated=function(d){this._availableImages=this.imageManager.listImages(),this._changedImages[d]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new a.Event("data",{dataType:"style"}))},v.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},v.prototype.addSource=function(d,_,A){var M=this;if(A===void 0&&(A={}),this._checkLoaded(),this.sourceCaches[d]!==void 0)throw new Error("There is already a source with this ID");if(!_.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(_).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(_.type)>=0&&this._validate(a.validateStyle.source,"sources."+d,_,null,A))){this.map&&this.map._collectResourceTiming&&(_.collectResourceTiming=!0);var R=this.sourceCaches[d]=new Fe(d,_,this.dispatcher);R.style=this,R.setEventedParent(this,function(){return{isSourceLoaded:M.loaded(),source:R.serialize(),sourceId:d}}),R.onAdd(this.map),this._changed=!0}},v.prototype.removeSource=function(d){if(this._checkLoaded(),this.sourceCaches[d]===void 0)throw new Error("There is no source with this ID");for(var _ in this._layers)if(this._layers[_].source===d)return this.fire(new a.ErrorEvent(new Error('Source "'+d+'" cannot be removed while layer "'+_+'" is using it.')));var A=this.sourceCaches[d];delete this.sourceCaches[d],delete this._updatedSources[d],A.fire(new a.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:d})),A.setEventedParent(null),A.clearTiles(),A.onRemove&&A.onRemove(this.map),this._changed=!0},v.prototype.setGeoJSONSourceData=function(d,_){this._checkLoaded(),this.sourceCaches[d].getSource().setData(_),this._changed=!0},v.prototype.getSource=function(d){return this.sourceCaches[d]&&this.sourceCaches[d].getSource()},v.prototype.addLayer=function(d,_,A){A===void 0&&(A={}),this._checkLoaded();var M=d.id;if(this.getLayer(M))this.fire(new a.ErrorEvent(new Error('Layer with id "'+M+'" already exists on this map')));else{var R;if(d.type==="custom"){if(Gc(this,a.validateCustomStyleLayer(d)))return;R=a.createStyleLayer(d)}else{if(typeof d.source=="object"&&(this.addSource(M,d.source),d=a.clone$1(d),d=a.extend(d,{source:M})),this._validate(a.validateStyle.layer,"layers."+M,d,{arrayIndex:-1},A))return;R=a.createStyleLayer(d),this._validateLayer(R),R.setEventedParent(this,{layer:{id:M}}),this._serializedLayers[R.id]=R.serialize()}var B=_?this._order.indexOf(_):this._order.length;if(_&&B===-1)this.fire(new a.ErrorEvent(new Error('Layer with id "'+_+'" does not exist on this map.')));else{if(this._order.splice(B,0,M),this._layerOrderChanged=!0,this._layers[M]=R,this._removedLayers[M]&&R.source&&R.type!=="custom"){var G=this._removedLayers[M];delete this._removedLayers[M],G.type!==R.type?this._updatedSources[R.source]="clear":(this._updatedSources[R.source]="reload",this.sourceCaches[R.source].pause())}this._updateLayer(R),R.onAdd&&R.onAdd(this.map)}}},v.prototype.moveLayer=function(d,_){if(this._checkLoaded(),this._changed=!0,this._layers[d]){if(d!==_){var A=this._order.indexOf(d);this._order.splice(A,1);var M=_?this._order.indexOf(_):this._order.length;_&&M===-1?this.fire(new a.ErrorEvent(new Error('Layer with id "'+_+'" does not exist on this map.'))):(this._order.splice(M,0,d),this._layerOrderChanged=!0)}}else this.fire(new a.ErrorEvent(new Error("The layer '"+d+"' does not exist in the map's style and cannot be moved.")))},v.prototype.removeLayer=function(d){this._checkLoaded();var _=this._layers[d];if(_){_.setEventedParent(null);var A=this._order.indexOf(d);this._order.splice(A,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[d]=_,delete this._layers[d],delete this._serializedLayers[d],delete this._updatedLayers[d],delete this._updatedPaintProps[d],_.onRemove&&_.onRemove(this.map)}else this.fire(new a.ErrorEvent(new Error("The layer '"+d+"' does not exist in the map's style and cannot be removed.")))},v.prototype.getLayer=function(d){return this._layers[d]},v.prototype.hasLayer=function(d){return d in this._layers},v.prototype.setLayerZoomRange=function(d,_,A){this._checkLoaded();var M=this.getLayer(d);M?M.minzoom===_&&M.maxzoom===A||(_!=null&&(M.minzoom=_),A!=null&&(M.maxzoom=A),this._updateLayer(M)):this.fire(new a.ErrorEvent(new Error("The layer '"+d+"' does not exist in the map's style and cannot have zoom extent.")))},v.prototype.setFilter=function(d,_,A){A===void 0&&(A={}),this._checkLoaded();var M=this.getLayer(d);if(M){if(!a.deepEqual(M.filter,_))return _==null?(M.filter=void 0,void this._updateLayer(M)):void(this._validate(a.validateStyle.filter,"layers."+M.id+".filter",_,null,A)||(M.filter=a.clone$1(_),this._updateLayer(M)))}else this.fire(new a.ErrorEvent(new Error("The layer '"+d+"' does not exist in the map's style and cannot be filtered.")))},v.prototype.getFilter=function(d){return a.clone$1(this.getLayer(d).filter)},v.prototype.setLayoutProperty=function(d,_,A,M){M===void 0&&(M={}),this._checkLoaded();var R=this.getLayer(d);R?a.deepEqual(R.getLayoutProperty(_),A)||(R.setLayoutProperty(_,A,M),this._updateLayer(R)):this.fire(new a.ErrorEvent(new Error("The layer '"+d+"' does not exist in the map's style and cannot be styled.")))},v.prototype.getLayoutProperty=function(d,_){var A=this.getLayer(d);if(A)return A.getLayoutProperty(_);this.fire(new a.ErrorEvent(new Error("The layer '"+d+"' does not exist in the map's style.")))},v.prototype.setPaintProperty=function(d,_,A,M){M===void 0&&(M={}),this._checkLoaded();var R=this.getLayer(d);R?a.deepEqual(R.getPaintProperty(_),A)||(R.setPaintProperty(_,A,M)&&this._updateLayer(R),this._changed=!0,this._updatedPaintProps[d]=!0):this.fire(new a.ErrorEvent(new Error("The layer '"+d+"' does not exist in the map's style and cannot be styled.")))},v.prototype.getPaintProperty=function(d,_){return this.getLayer(d).getPaintProperty(_)},v.prototype.setFeatureState=function(d,_){this._checkLoaded();var A=d.source,M=d.sourceLayer,R=this.sourceCaches[A];if(R!==void 0){var B=R.getSource().type;B==="geojson"&&M?this.fire(new a.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):B!=="vector"||M?(d.id===void 0&&this.fire(new a.ErrorEvent(new Error("The feature id parameter must be provided."))),R.setFeatureState(M,d.id,_)):this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new a.ErrorEvent(new Error("The source '"+A+"' does not exist in the map's style.")))},v.prototype.removeFeatureState=function(d,_){this._checkLoaded();var A=d.source,M=this.sourceCaches[A];if(M!==void 0){var R=M.getSource().type,B=R==="vector"?d.sourceLayer:void 0;R!=="vector"||B?_&&typeof d.id!="string"&&typeof d.id!="number"?this.fire(new a.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):M.removeFeatureState(B,d.id,_):this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new a.ErrorEvent(new Error("The source '"+A+"' does not exist in the map's style.")))},v.prototype.getFeatureState=function(d){this._checkLoaded();var _=d.source,A=d.sourceLayer,M=this.sourceCaches[_];if(M!==void 0){if(M.getSource().type!=="vector"||A)return d.id===void 0&&this.fire(new a.ErrorEvent(new Error("The feature id parameter must be provided."))),M.getFeatureState(A,d.id);this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new a.ErrorEvent(new Error("The source '"+_+"' does not exist in the map's style.")))},v.prototype.getTransition=function(){return a.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},v.prototype.serialize=function(){return a.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:a.mapObject(this.sourceCaches,function(d){return d.serialize()}),layers:this._serializeLayers(this._order)},function(d){return d!==void 0})},v.prototype._updateLayer=function(d){this._updatedLayers[d.id]=!0,d.source&&!this._updatedSources[d.source]&&this.sourceCaches[d.source].getSource().type!=="raster"&&(this._updatedSources[d.source]="reload",this.sourceCaches[d.source].pause()),this._changed=!0},v.prototype._flattenAndSortRenderedFeatures=function(d){for(var _=this,A=function(sr){return _._layers[sr].type==="fill-extrusion"},M={},R=[],B=this._order.length-1;B>=0;B--){var G=this._order[B];if(A(G)){M[G]=B;for(var J=0,ce=d;J<ce.length;J+=1){var ve=ce[J][G];if(ve)for(var ye=0,Oe=ve;ye<Oe.length;ye+=1)R.push(Oe[ye])}}}R.sort(function(sr,_r){return _r.intersectionZ-sr.intersectionZ});for(var Re=[],Ge=this._order.length-1;Ge>=0;Ge--){var Me=this._order[Ge];if(A(Me))for(var He=R.length-1;He>=0;He--){var et=R[He].feature;if(M[et.layer.id]<Ge)break;Re.push(et),R.pop()}else for(var ct=0,Pt=d;ct<Pt.length;ct+=1){var At=Pt[ct][Me];if(At)for(var Ot=0,tr=At;Ot<tr.length;Ot+=1)Re.push(tr[Ot].feature)}}return Re},v.prototype.queryRenderedFeatures=function(d,_,A){_&&_.filter&&this._validate(a.validateStyle.filter,"queryRenderedFeatures.filter",_.filter,null,_);var M={};if(_&&_.layers){if(!Array.isArray(_.layers))return this.fire(new a.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var R=0,B=_.layers;R<B.length;R+=1){var G=B[R],J=this._layers[G];if(!J)return this.fire(new a.ErrorEvent(new Error("The layer '"+G+"' does not exist in the map's style and cannot be queried for features."))),[];M[J.source]=!0}}var ce=[];for(var ve in _.availableImages=this._availableImages,this.sourceCaches)_.layers&&!M[ve]||ce.push(Wr(this.sourceCaches[ve],this._layers,this._serializedLayers,d,_,A));return this.placement&&ce.push(function(ye,Oe,Re,Ge,Me,He,et){for(var ct={},Pt=He.queryRenderedSymbols(Ge),At=[],Ot=0,tr=Object.keys(Pt).map(Number);Ot<tr.length;Ot+=1)At.push(et[tr[Ot]]);At.sort(On);for(var sr=function(){var bn=Ur[_r],Fi=bn.featureIndex.lookupSymbolFeatures(Pt[bn.bucketInstanceId],Oe,bn.bucketIndex,bn.sourceLayerIndex,Me.filter,Me.layers,Me.availableImages,ye);for(var $r in Fi){var Ln=ct[$r]=ct[$r]||[],Yn=Fi[$r];Yn.sort(function(ri,zn){var pn=bn.featureSortOrder;if(pn){var Ja=pn.indexOf(ri.featureIndex);return pn.indexOf(zn.featureIndex)-Ja}return zn.featureIndex-ri.featureIndex});for(var $n=0,Fn=Yn;$n<Fn.length;$n+=1)Ln.push(Fn[$n])}},_r=0,Ur=At;_r<Ur.length;_r+=1)sr();var hn=function(bn){ct[bn].forEach(function(Fi){var $r=Fi.feature,Ln=Re[ye[bn].source].getFeatureState($r.layer["source-layer"],$r.id);$r.source=$r.layer.source,$r.layer["source-layer"]&&($r.sourceLayer=$r.layer["source-layer"]),$r.state=Ln})};for(var An in ct)hn(An);return ct}(this._layers,this._serializedLayers,this.sourceCaches,d,_,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(ce)},v.prototype.querySourceFeatures=function(d,_){_&&_.filter&&this._validate(a.validateStyle.filter,"querySourceFeatures.filter",_.filter,null,_);var A=this.sourceCaches[d];return A?function(M,R){for(var B=M.getRenderableIds().map(function(Oe){return M.getTileByID(Oe)}),G=[],J={},ce=0;ce<B.length;ce++){var ve=B[ce],ye=ve.tileID.canonical.key;J[ye]||(J[ye]=!0,ve.querySourceFeatures(G,R))}return G}(A,_):[]},v.prototype.addSourceType=function(d,_,A){return v.getSourceType(d)?A(new Error('A source type called "'+d+'" already exists.')):(v.setSourceType(d,_),_.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:d,url:_.workerSourceURL},A):A(null,null))},v.prototype.getLight=function(){return this.light.getLight()},v.prototype.setLight=function(d,_){_===void 0&&(_={}),this._checkLoaded();var A=this.light.getLight(),M=!1;for(var R in d)if(!a.deepEqual(d[R],A[R])){M=!0;break}if(M){var B={now:a.browser.now(),transition:a.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(d,_),this.light.updateTransitions(B)}},v.prototype._validate=function(d,_,A,M,R){return R===void 0&&(R={}),(!R||R.validate!==!1)&&Gc(this,d.call(a.validateStyle,a.extend({key:_,style:this.serialize(),value:A,styleSpec:a.styleSpec},M)))},v.prototype._remove=function(){for(var d in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),a.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[d].setEventedParent(null);for(var _ in this.sourceCaches)this.sourceCaches[_].clearTiles(),this.sourceCaches[_].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},v.prototype._clearSource=function(d){this.sourceCaches[d].clearTiles()},v.prototype._reloadSource=function(d){this.sourceCaches[d].resume(),this.sourceCaches[d].reload()},v.prototype._updateSources=function(d){for(var _ in this.sourceCaches)this.sourceCaches[_].update(d)},v.prototype._generateCollisionBoxes=function(){for(var d in this.sourceCaches)this._reloadSource(d)},v.prototype._updatePlacement=function(d,_,A,M,R){R===void 0&&(R=!1);for(var B=!1,G=!1,J={},ce=0,ve=this._order;ce<ve.length;ce+=1){var ye=this._layers[ve[ce]];if(ye.type==="symbol"){if(!J[ye.source]){var Oe=this.sourceCaches[ye.source];J[ye.source]=Oe.getRenderableIds(!0).map(function(et){return Oe.getTileByID(et)}).sort(function(et,ct){return ct.tileID.overscaledZ-et.tileID.overscaledZ||(et.tileID.isLessThan(ct.tileID)?-1:1)})}var Re=this.crossTileSymbolIndex.addLayer(ye,J[ye.source],d.center.lng);B=B||Re}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((R=R||this._layerOrderChanged||A===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(a.browser.now(),d.zoom))&&(this.pauseablePlacement=new sh(d,this._order,R,_,A,M,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,J),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(a.browser.now()),G=!0),B&&this.pauseablePlacement.placement.setStale()),G||B)for(var Ge=0,Me=this._order;Ge<Me.length;Ge+=1){var He=this._layers[Me[Ge]];He.type==="symbol"&&this.placement.updateLayerOpacities(He,J[He.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(a.browser.now())},v.prototype._releaseSymbolFadeTiles=function(){for(var d in this.sourceCaches)this.sourceCaches[d].releaseSymbolFadeTiles()},v.prototype.getImages=function(d,_,A){this.imageManager.getImages(_.icons,A),this._updateTilesForChangedImages();var M=this.sourceCaches[_.source];M&&M.setDependencies(_.tileID.key,_.type,_.icons)},v.prototype.getGlyphs=function(d,_,A){this.glyphManager.getGlyphs(_.stacks,A)},v.prototype.getResource=function(d,_,A){return a.makeRequest(_,A)},v}(a.Evented);Mi.getSourceType=function(p){return qt[p]},Mi.setSourceType=function(p,v){qt[p]=v},Mi.registerForPluginStateChange=a.registerForPluginStateChange;var ao=a.createLayout([{name:"a_pos",type:"Int16",components:2}]),Hc=Ji(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),Xp=Ji(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Uv=Ji(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),Yp=Ji(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),uh=Ji("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Xu=Ji(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),xf=Ji(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),Fo=Ji("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),lh=Ji("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),lc=Ji("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),jd=Ji(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),Wc=Ji(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),Cs=Ji(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),qp=Ji(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),Ho=Ji(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),Jh=Ji(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),Ms=Ji(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),zl=Ji(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),cc=Ji(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),lo=Ji(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),fc=Ji(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),co=Ji(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),hc=Ji(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),qs=Ji(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),xl=Ji(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),Yu=Ji(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function Ji(p,v){var d=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,_=v.match(/attribute ([\w]+) ([\w]+)/g),A=p.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),M=v.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),R=M?M.concat(A):A,B={};return{fragmentSource:p=p.replace(d,function(G,J,ce,ve,ye){return B[ye]=!0,J==="define"?`
#ifndef HAS_UNIFORM_u_`+ye+`
varying `+ce+" "+ve+" "+ye+`;
#else
uniform `+ce+" "+ve+" u_"+ye+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+ye+`
    `+ce+" "+ve+" "+ye+" = u_"+ye+`;
#endif
`}),vertexSource:v=v.replace(d,function(G,J,ce,ve,ye){var Oe=ve==="float"?"vec2":"vec4",Re=ye.match(/color/)?"color":Oe;return B[ye]?J==="define"?`
#ifndef HAS_UNIFORM_u_`+ye+`
uniform lowp float u_`+ye+`_t;
attribute `+ce+" "+Oe+" a_"+ye+`;
varying `+ce+" "+ve+" "+ye+`;
#else
uniform `+ce+" "+ve+" u_"+ye+`;
#endif
`:Re==="vec4"?`
#ifndef HAS_UNIFORM_u_`+ye+`
    `+ye+" = a_"+ye+`;
#else
    `+ce+" "+ve+" "+ye+" = u_"+ye+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+ye+`
    `+ye+" = unpack_mix_"+Re+"(a_"+ye+", u_"+ye+`_t);
#else
    `+ce+" "+ve+" "+ye+" = u_"+ye+`;
#endif
`:J==="define"?`
#ifndef HAS_UNIFORM_u_`+ye+`
uniform lowp float u_`+ye+`_t;
attribute `+ce+" "+Oe+" a_"+ye+`;
#else
uniform `+ce+" "+ve+" u_"+ye+`;
#endif
`:Re==="vec4"?`
#ifndef HAS_UNIFORM_u_`+ye+`
    `+ce+" "+ve+" "+ye+" = a_"+ye+`;
#else
    `+ce+" "+ve+" "+ye+" = u_"+ye+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+ye+`
    `+ce+" "+ve+" "+ye+" = unpack_mix_"+Re+"(a_"+ye+", u_"+ye+`_t);
#else
    `+ce+" "+ve+" "+ye+" = u_"+ye+`;
#endif
`}),staticAttributes:_,staticUniforms:R}}var oo=Object.freeze({__proto__:null,prelude:Hc,background:Xp,backgroundPattern:Uv,circle:Yp,clippingMask:uh,heatmap:Xu,heatmapTexture:xf,collisionBox:Fo,collisionCircle:lh,debug:lc,fill:jd,fillOutline:Wc,fillOutlinePattern:Cs,fillPattern:qp,fillExtrusion:Ho,fillExtrusionPattern:Jh,hillshadePrepare:Ms,hillshade:zl,line:cc,lineGradient:lo,linePattern:fc,lineSDF:co,raster:hc,symbolIcon:qs,symbolSDF:xl,symbolTextAndIcon:Yu}),qu=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function ep(p){for(var v=[],d=0;d<p.length;d++)if(p[d]!==null){var _=p[d].split(" ");v.push(_.pop())}return v}qu.prototype.bind=function(p,v,d,_,A,M,R,B){this.context=p;for(var G=this.boundPaintVertexBuffers.length!==_.length,J=0;!G&&J<_.length;J++)this.boundPaintVertexBuffers[J]!==_[J]&&(G=!0);p.extVertexArrayObject&&this.vao&&this.boundProgram===v&&this.boundLayoutVertexBuffer===d&&!G&&this.boundIndexBuffer===A&&this.boundVertexOffset===M&&this.boundDynamicVertexBuffer===R&&this.boundDynamicVertexBuffer2===B?(p.bindVertexArrayOES.set(this.vao),R&&R.bind(),A&&A.dynamicDraw&&A.bind(),B&&B.bind()):this.freshBind(v,d,_,A,M,R,B)},qu.prototype.freshBind=function(p,v,d,_,A,M,R){var B,G=p.numAttributes,J=this.context,ce=J.gl;if(J.extVertexArrayObject)this.vao&&this.destroy(),this.vao=J.extVertexArrayObject.createVertexArrayOES(),J.bindVertexArrayOES.set(this.vao),B=0,this.boundProgram=p,this.boundLayoutVertexBuffer=v,this.boundPaintVertexBuffers=d,this.boundIndexBuffer=_,this.boundVertexOffset=A,this.boundDynamicVertexBuffer=M,this.boundDynamicVertexBuffer2=R;else{B=J.currentNumAttributes||0;for(var ve=G;ve<B;ve++)ce.disableVertexAttribArray(ve)}v.enableAttributes(ce,p);for(var ye=0,Oe=d;ye<Oe.length;ye+=1)Oe[ye].enableAttributes(ce,p);M&&M.enableAttributes(ce,p),R&&R.enableAttributes(ce,p),v.bind(),v.setVertexAttribPointers(ce,p,A);for(var Re=0,Ge=d;Re<Ge.length;Re+=1){var Me=Ge[Re];Me.bind(),Me.setVertexAttribPointers(ce,p,A)}M&&(M.bind(),M.setVertexAttribPointers(ce,p,A)),_&&_.bind(),R&&(R.bind(),R.setVertexAttribPointers(ce,p,A)),J.currentNumAttributes=G},qu.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var Zp=function(p,v,d,_,A,M){var R=p.gl;this.program=R.createProgram();for(var B=ep(d.staticAttributes),G=_?_.getBinderAttributes():[],J=B.concat(G),ce=d.staticUniforms?ep(d.staticUniforms):[],ve=_?_.getBinderUniforms():[],ye=[],Oe=0,Re=ce.concat(ve);Oe<Re.length;Oe+=1){var Ge=Re[Oe];ye.indexOf(Ge)<0&&ye.push(Ge)}var Me=_?_.defines():[];M&&Me.push("#define OVERDRAW_INSPECTOR;");var He=Me.concat(Hc.fragmentSource,d.fragmentSource).join(`
`),et=Me.concat(Hc.vertexSource,d.vertexSource).join(`
`),ct=R.createShader(R.FRAGMENT_SHADER);if(R.isContextLost())this.failedToCreate=!0;else{R.shaderSource(ct,He),R.compileShader(ct),R.attachShader(this.program,ct);var Pt=R.createShader(R.VERTEX_SHADER);if(R.isContextLost())this.failedToCreate=!0;else{R.shaderSource(Pt,et),R.compileShader(Pt),R.attachShader(this.program,Pt),this.attributes={};var At={};this.numAttributes=J.length;for(var Ot=0;Ot<this.numAttributes;Ot++)J[Ot]&&(R.bindAttribLocation(this.program,Ot,J[Ot]),this.attributes[J[Ot]]=Ot);R.linkProgram(this.program),R.deleteShader(Pt),R.deleteShader(ct);for(var tr=0;tr<ye.length;tr++){var sr=ye[tr];if(sr&&!At[sr]){var _r=R.getUniformLocation(this.program,sr);_r&&(At[sr]=_r)}}this.fixedUniforms=A(p,At),this.binderUniforms=_?_.getUniforms(p,At):[]}}};function tp(p,v,d){var _=1/ga(d,1,v.transform.tileZoom),A=Math.pow(2,d.tileID.overscaledZ),M=d.tileSize*Math.pow(2,v.transform.tileZoom)/A,R=M*(d.tileID.canonical.x+d.tileID.wrap*A),B=M*d.tileID.canonical.y;return{u_image:0,u_texsize:d.imageAtlasTexture.size,u_scale:[_,p.fromScale,p.toScale],u_fade:p.t,u_pixel_coord_upper:[R>>16,B>>16],u_pixel_coord_lower:[65535&R,65535&B]}}Zp.prototype.draw=function(p,v,d,_,A,M,R,B,G,J,ce,ve,ye,Oe,Re,Ge){var Me,He=p.gl;if(!this.failedToCreate){for(var et in p.program.set(this.program),p.setDepthMode(d),p.setStencilMode(_),p.setColorMode(A),p.setCullFace(M),this.fixedUniforms)this.fixedUniforms[et].set(R[et]);Oe&&Oe.setUniforms(p,this.binderUniforms,ve,{zoom:ye});for(var ct=(Me={},Me[He.LINES]=2,Me[He.TRIANGLES]=3,Me[He.LINE_STRIP]=1,Me)[v],Pt=0,At=ce.get();Pt<At.length;Pt+=1){var Ot=At[Pt],tr=Ot.vaos||(Ot.vaos={});(tr[B]||(tr[B]=new qu)).bind(p,this,G,Oe?Oe.getPaintVertexBuffers():[],J,Ot.vertexOffset,Re,Ge),He.drawElements(v,Ot.primitiveLength*ct,He.UNSIGNED_SHORT,Ot.primitiveOffset*ct*2)}}};var $d=function(p,v,d,_){var A=v.style.light,M=A.properties.get("position"),R=[M.x,M.y,M.z],B=a.create$1();A.properties.get("anchor")==="viewport"&&a.fromRotation(B,-v.transform.angle),a.transformMat3(R,R,B);var G=A.properties.get("color");return{u_matrix:p,u_lightpos:R,u_lightintensity:A.properties.get("intensity"),u_lightcolor:[G.r,G.g,G.b],u_vertical_gradient:+d,u_opacity:_}},pc=function(p,v,d,_,A,M,R){return a.extend($d(p,v,d,_),tp(M,v,R),{u_height_factor:-Math.pow(2,A.overscaledZ)/R.tileSize/8})},wa=function(p){return{u_matrix:p}},Ul=function(p,v,d,_){return a.extend(wa(p),tp(d,v,_))},ch=function(p,v){return{u_matrix:p,u_world:v}},Ps=function(p,v,d,_,A){return a.extend(Ul(p,v,d,_),{u_world:A})},fh=function(p,v,d,_){var A,M,R=p.transform;if(_.paint.get("circle-pitch-alignment")==="map"){var B=ga(d,1,R.zoom);A=!0,M=[B,B]}else A=!1,M=R.pixelsToGLUnits;return{u_camera_to_center_distance:R.cameraToCenterDistance,u_scale_with_map:+(_.paint.get("circle-pitch-scale")==="map"),u_matrix:p.translatePosMatrix(v.posMatrix,d,_.paint.get("circle-translate"),_.paint.get("circle-translate-anchor")),u_pitch_with_map:+A,u_device_pixel_ratio:a.browser.devicePixelRatio,u_extrude_scale:M}},Zu=function(p,v,d){var _=ga(d,1,v.zoom),A=Math.pow(2,v.zoom-d.tileID.overscaledZ),M=d.tileID.overscaleFactor();return{u_matrix:p,u_camera_to_center_distance:v.cameraToCenterDistance,u_pixels_to_tile_units:_,u_extrude_scale:[v.pixelsToGLUnits[0]/(_*A),v.pixelsToGLUnits[1]/(_*A)],u_overscale_factor:M}},Vl=function(p,v,d){return{u_matrix:p,u_inv_matrix:v,u_camera_to_center_distance:d.cameraToCenterDistance,u_viewport_size:[d.width,d.height]}},Ku=function(p,v,d){return d===void 0&&(d=1),{u_matrix:p,u_color:v,u_overlay:0,u_overlay_scale:d}},Au=function(p){return{u_matrix:p}},Xc=function(p,v,d,_){return{u_matrix:p,u_extrude_scale:ga(v,1,d),u_intensity:_}},dc=function(p,v,d){var _=p.transform;return{u_matrix:Zs(p,v,d),u_ratio:1/ga(v,1,_.zoom),u_device_pixel_ratio:a.browser.devicePixelRatio,u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]]}},pa=function(p,v,d,_){return a.extend(dc(p,v,d),{u_image:0,u_image_height:_})},vc=function(p,v,d,_){var A=p.transform,M=Yc(v,A);return{u_matrix:Zs(p,v,d),u_texsize:v.imageAtlasTexture.size,u_ratio:1/ga(v,1,A.zoom),u_device_pixel_ratio:a.browser.devicePixelRatio,u_image:0,u_scale:[M,_.fromScale,_.toScale],u_fade:_.t,u_units_to_pixels:[1/A.pixelsToGLUnits[0],1/A.pixelsToGLUnits[1]]}},Gd=function(p,v,d,_,A){var M=p.lineAtlas,R=Yc(v,p.transform),B=d.layout.get("line-cap")==="round",G=M.getDash(_.from,B),J=M.getDash(_.to,B),ce=G.width*A.fromScale,ve=J.width*A.toScale;return a.extend(dc(p,v,d),{u_patternscale_a:[R/ce,-G.height/2],u_patternscale_b:[R/ve,-J.height/2],u_sdfgamma:M.width/(256*Math.min(ce,ve)*a.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:G.y,u_tex_y_b:J.y,u_mix:A.t})};function Yc(p,v){return 1/ga(p,1,v.tileZoom)}function Zs(p,v,d){return p.translatePosMatrix(v.tileID.posMatrix,v,d.paint.get("line-translate"),d.paint.get("line-translate-anchor"))}var Kp=function(p,v,d,_,A){return{u_matrix:p,u_tl_parent:v,u_scale_parent:d,u_buffer_scale:1,u_fade_t:_.mix,u_opacity:_.opacity*A.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:A.paint.get("raster-brightness-min"),u_brightness_high:A.paint.get("raster-brightness-max"),u_saturation_factor:(R=A.paint.get("raster-saturation"),R>0?1-1/(1.001-R):-R),u_contrast_factor:(M=A.paint.get("raster-contrast"),M>0?1/(1-M):1+M),u_spin_weights:bf(A.paint.get("raster-hue-rotate"))};var M,R};function bf(p){p*=Math.PI/180;var v=Math.sin(p),d=Math.cos(p);return[(2*d+1)/3,(-Math.sqrt(3)*v-d+1)/3,(Math.sqrt(3)*v-d+1)/3]}var qc,bl=function(p,v,d,_,A,M,R,B,G,J){var ce=A.transform;return{u_is_size_zoom_constant:+(p==="constant"||p==="source"),u_is_size_feature_constant:+(p==="constant"||p==="camera"),u_size_t:v?v.uSizeT:0,u_size:v?v.uSize:0,u_camera_to_center_distance:ce.cameraToCenterDistance,u_pitch:ce.pitch/360*2*Math.PI,u_rotate_symbol:+d,u_aspect_ratio:ce.width/ce.height,u_fade_change:A.options.fadeDuration?A.symbolFadeChange:1,u_matrix:M,u_label_plane_matrix:R,u_coord_matrix:B,u_is_text:+G,u_pitch_with_map:+_,u_texsize:J,u_texture:0}},Zc=function(p,v,d,_,A,M,R,B,G,J,ce){var ve=A.transform;return a.extend(bl(p,v,d,_,A,M,R,B,G,J),{u_gamma_scale:_?Math.cos(ve._pitch)*ve.cameraToCenterDistance:1,u_device_pixel_ratio:a.browser.devicePixelRatio,u_is_halo:+ce})},wf=function(p,v,d,_,A,M,R,B,G,J){return a.extend(Zc(p,v,d,_,A,M,R,B,!0,G,!0),{u_texsize_icon:J,u_texture_icon:1})},wl=function(p,v,d){return{u_matrix:p,u_opacity:v,u_color:d}},mc=function(p,v,d,_,A,M){return a.extend(function(R,B,G,J){var ce=G.imageManager.getPattern(R.from.toString()),ve=G.imageManager.getPattern(R.to.toString()),ye=G.imageManager.getPixelSize(),Oe=ye.width,Re=ye.height,Ge=Math.pow(2,J.tileID.overscaledZ),Me=J.tileSize*Math.pow(2,G.transform.tileZoom)/Ge,He=Me*(J.tileID.canonical.x+J.tileID.wrap*Ge),et=Me*J.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:ce.tl,u_pattern_br_a:ce.br,u_pattern_tl_b:ve.tl,u_pattern_br_b:ve.br,u_texsize:[Oe,Re],u_mix:B.t,u_pattern_size_a:ce.displaySize,u_pattern_size_b:ve.displaySize,u_scale_a:B.fromScale,u_scale_b:B.toScale,u_tile_units_to_pixels:1/ga(J,1,G.transform.tileZoom),u_pixel_coord_upper:[He>>16,et>>16],u_pixel_coord_lower:[65535&He,65535&et]}}(_,M,d,A),{u_matrix:p,u_opacity:v})},rp={fillExtrusion:function(p,v){return{u_matrix:new a.UniformMatrix4f(p,v.u_matrix),u_lightpos:new a.Uniform3f(p,v.u_lightpos),u_lightintensity:new a.Uniform1f(p,v.u_lightintensity),u_lightcolor:new a.Uniform3f(p,v.u_lightcolor),u_vertical_gradient:new a.Uniform1f(p,v.u_vertical_gradient),u_opacity:new a.Uniform1f(p,v.u_opacity)}},fillExtrusionPattern:function(p,v){return{u_matrix:new a.UniformMatrix4f(p,v.u_matrix),u_lightpos:new a.Uniform3f(p,v.u_lightpos),u_lightintensity:new a.Uniform1f(p,v.u_lightintensity),u_lightcolor:new a.Uniform3f(p,v.u_lightcolor),u_vertical_gradient:new a.Uniform1f(p,v.u_vertical_gradient),u_height_factor:new a.Uniform1f(p,v.u_height_factor),u_image:new a.Uniform1i(p,v.u_image),u_texsize:new a.Uniform2f(p,v.u_texsize),u_pixel_coord_upper:new a.Uniform2f(p,v.u_pixel_coord_upper),u_pixel_coord_lower:new a.Uniform2f(p,v.u_pixel_coord_lower),u_scale:new a.Uniform3f(p,v.u_scale),u_fade:new a.Uniform1f(p,v.u_fade),u_opacity:new a.Uniform1f(p,v.u_opacity)}},fill:function(p,v){return{u_matrix:new a.UniformMatrix4f(p,v.u_matrix)}},fillPattern:function(p,v){return{u_matrix:new a.UniformMatrix4f(p,v.u_matrix),u_image:new a.Uniform1i(p,v.u_image),u_texsize:new a.Uniform2f(p,v.u_texsize),u_pixel_coord_upper:new a.Uniform2f(p,v.u_pixel_coord_upper),u_pixel_coord_lower:new a.Uniform2f(p,v.u_pixel_coord_lower),u_scale:new a.Uniform3f(p,v.u_scale),u_fade:new a.Uniform1f(p,v.u_fade)}},fillOutline:function(p,v){return{u_matrix:new a.UniformMatrix4f(p,v.u_matrix),u_world:new a.Uniform2f(p,v.u_world)}},fillOutlinePattern:function(p,v){return{u_matrix:new a.UniformMatrix4f(p,v.u_matrix),u_world:new a.Uniform2f(p,v.u_world),u_image:new a.Uniform1i(p,v.u_image),u_texsize:new a.Uniform2f(p,v.u_texsize),u_pixel_coord_upper:new a.Uniform2f(p,v.u_pixel_coord_upper),u_pixel_coord_lower:new a.Uniform2f(p,v.u_pixel_coord_lower),u_scale:new a.Uniform3f(p,v.u_scale),u_fade:new a.Uniform1f(p,v.u_fade)}},circle:function(p,v){return{u_camera_to_center_distance:new a.Uniform1f(p,v.u_camera_to_center_distance),u_scale_with_map:new a.Uniform1i(p,v.u_scale_with_map),u_pitch_with_map:new a.Uniform1i(p,v.u_pitch_with_map),u_extrude_scale:new a.Uniform2f(p,v.u_extrude_scale),u_device_pixel_ratio:new a.Uniform1f(p,v.u_device_pixel_ratio),u_matrix:new a.UniformMatrix4f(p,v.u_matrix)}},collisionBox:function(p,v){return{u_matrix:new a.UniformMatrix4f(p,v.u_matrix),u_camera_to_center_distance:new a.Uniform1f(p,v.u_camera_to_center_distance),u_pixels_to_tile_units:new a.Uniform1f(p,v.u_pixels_to_tile_units),u_extrude_scale:new a.Uniform2f(p,v.u_extrude_scale),u_overscale_factor:new a.Uniform1f(p,v.u_overscale_factor)}},collisionCircle:function(p,v){return{u_matrix:new a.UniformMatrix4f(p,v.u_matrix),u_inv_matrix:new a.UniformMatrix4f(p,v.u_inv_matrix),u_camera_to_center_distance:new a.Uniform1f(p,v.u_camera_to_center_distance),u_viewport_size:new a.Uniform2f(p,v.u_viewport_size)}},debug:function(p,v){return{u_color:new a.UniformColor(p,v.u_color),u_matrix:new a.UniformMatrix4f(p,v.u_matrix),u_overlay:new a.Uniform1i(p,v.u_overlay),u_overlay_scale:new a.Uniform1f(p,v.u_overlay_scale)}},clippingMask:function(p,v){return{u_matrix:new a.UniformMatrix4f(p,v.u_matrix)}},heatmap:function(p,v){return{u_extrude_scale:new a.Uniform1f(p,v.u_extrude_scale),u_intensity:new a.Uniform1f(p,v.u_intensity),u_matrix:new a.UniformMatrix4f(p,v.u_matrix)}},heatmapTexture:function(p,v){return{u_matrix:new a.UniformMatrix4f(p,v.u_matrix),u_world:new a.Uniform2f(p,v.u_world),u_image:new a.Uniform1i(p,v.u_image),u_color_ramp:new a.Uniform1i(p,v.u_color_ramp),u_opacity:new a.Uniform1f(p,v.u_opacity)}},hillshade:function(p,v){return{u_matrix:new a.UniformMatrix4f(p,v.u_matrix),u_image:new a.Uniform1i(p,v.u_image),u_latrange:new a.Uniform2f(p,v.u_latrange),u_light:new a.Uniform2f(p,v.u_light),u_shadow:new a.UniformColor(p,v.u_shadow),u_highlight:new a.UniformColor(p,v.u_highlight),u_accent:new a.UniformColor(p,v.u_accent)}},hillshadePrepare:function(p,v){return{u_matrix:new a.UniformMatrix4f(p,v.u_matrix),u_image:new a.Uniform1i(p,v.u_image),u_dimension:new a.Uniform2f(p,v.u_dimension),u_zoom:new a.Uniform1f(p,v.u_zoom),u_unpack:new a.Uniform4f(p,v.u_unpack)}},line:function(p,v){return{u_matrix:new a.UniformMatrix4f(p,v.u_matrix),u_ratio:new a.Uniform1f(p,v.u_ratio),u_device_pixel_ratio:new a.Uniform1f(p,v.u_device_pixel_ratio),u_units_to_pixels:new a.Uniform2f(p,v.u_units_to_pixels)}},lineGradient:function(p,v){return{u_matrix:new a.UniformMatrix4f(p,v.u_matrix),u_ratio:new a.Uniform1f(p,v.u_ratio),u_device_pixel_ratio:new a.Uniform1f(p,v.u_device_pixel_ratio),u_units_to_pixels:new a.Uniform2f(p,v.u_units_to_pixels),u_image:new a.Uniform1i(p,v.u_image),u_image_height:new a.Uniform1f(p,v.u_image_height)}},linePattern:function(p,v){return{u_matrix:new a.UniformMatrix4f(p,v.u_matrix),u_texsize:new a.Uniform2f(p,v.u_texsize),u_ratio:new a.Uniform1f(p,v.u_ratio),u_device_pixel_ratio:new a.Uniform1f(p,v.u_device_pixel_ratio),u_image:new a.Uniform1i(p,v.u_image),u_units_to_pixels:new a.Uniform2f(p,v.u_units_to_pixels),u_scale:new a.Uniform3f(p,v.u_scale),u_fade:new a.Uniform1f(p,v.u_fade)}},lineSDF:function(p,v){return{u_matrix:new a.UniformMatrix4f(p,v.u_matrix),u_ratio:new a.Uniform1f(p,v.u_ratio),u_device_pixel_ratio:new a.Uniform1f(p,v.u_device_pixel_ratio),u_units_to_pixels:new a.Uniform2f(p,v.u_units_to_pixels),u_patternscale_a:new a.Uniform2f(p,v.u_patternscale_a),u_patternscale_b:new a.Uniform2f(p,v.u_patternscale_b),u_sdfgamma:new a.Uniform1f(p,v.u_sdfgamma),u_image:new a.Uniform1i(p,v.u_image),u_tex_y_a:new a.Uniform1f(p,v.u_tex_y_a),u_tex_y_b:new a.Uniform1f(p,v.u_tex_y_b),u_mix:new a.Uniform1f(p,v.u_mix)}},raster:function(p,v){return{u_matrix:new a.UniformMatrix4f(p,v.u_matrix),u_tl_parent:new a.Uniform2f(p,v.u_tl_parent),u_scale_parent:new a.Uniform1f(p,v.u_scale_parent),u_buffer_scale:new a.Uniform1f(p,v.u_buffer_scale),u_fade_t:new a.Uniform1f(p,v.u_fade_t),u_opacity:new a.Uniform1f(p,v.u_opacity),u_image0:new a.Uniform1i(p,v.u_image0),u_image1:new a.Uniform1i(p,v.u_image1),u_brightness_low:new a.Uniform1f(p,v.u_brightness_low),u_brightness_high:new a.Uniform1f(p,v.u_brightness_high),u_saturation_factor:new a.Uniform1f(p,v.u_saturation_factor),u_contrast_factor:new a.Uniform1f(p,v.u_contrast_factor),u_spin_weights:new a.Uniform3f(p,v.u_spin_weights)}},symbolIcon:function(p,v){return{u_is_size_zoom_constant:new a.Uniform1i(p,v.u_is_size_zoom_constant),u_is_size_feature_constant:new a.Uniform1i(p,v.u_is_size_feature_constant),u_size_t:new a.Uniform1f(p,v.u_size_t),u_size:new a.Uniform1f(p,v.u_size),u_camera_to_center_distance:new a.Uniform1f(p,v.u_camera_to_center_distance),u_pitch:new a.Uniform1f(p,v.u_pitch),u_rotate_symbol:new a.Uniform1i(p,v.u_rotate_symbol),u_aspect_ratio:new a.Uniform1f(p,v.u_aspect_ratio),u_fade_change:new a.Uniform1f(p,v.u_fade_change),u_matrix:new a.UniformMatrix4f(p,v.u_matrix),u_label_plane_matrix:new a.UniformMatrix4f(p,v.u_label_plane_matrix),u_coord_matrix:new a.UniformMatrix4f(p,v.u_coord_matrix),u_is_text:new a.Uniform1i(p,v.u_is_text),u_pitch_with_map:new a.Uniform1i(p,v.u_pitch_with_map),u_texsize:new a.Uniform2f(p,v.u_texsize),u_texture:new a.Uniform1i(p,v.u_texture)}},symbolSDF:function(p,v){return{u_is_size_zoom_constant:new a.Uniform1i(p,v.u_is_size_zoom_constant),u_is_size_feature_constant:new a.Uniform1i(p,v.u_is_size_feature_constant),u_size_t:new a.Uniform1f(p,v.u_size_t),u_size:new a.Uniform1f(p,v.u_size),u_camera_to_center_distance:new a.Uniform1f(p,v.u_camera_to_center_distance),u_pitch:new a.Uniform1f(p,v.u_pitch),u_rotate_symbol:new a.Uniform1i(p,v.u_rotate_symbol),u_aspect_ratio:new a.Uniform1f(p,v.u_aspect_ratio),u_fade_change:new a.Uniform1f(p,v.u_fade_change),u_matrix:new a.UniformMatrix4f(p,v.u_matrix),u_label_plane_matrix:new a.UniformMatrix4f(p,v.u_label_plane_matrix),u_coord_matrix:new a.UniformMatrix4f(p,v.u_coord_matrix),u_is_text:new a.Uniform1i(p,v.u_is_text),u_pitch_with_map:new a.Uniform1i(p,v.u_pitch_with_map),u_texsize:new a.Uniform2f(p,v.u_texsize),u_texture:new a.Uniform1i(p,v.u_texture),u_gamma_scale:new a.Uniform1f(p,v.u_gamma_scale),u_device_pixel_ratio:new a.Uniform1f(p,v.u_device_pixel_ratio),u_is_halo:new a.Uniform1i(p,v.u_is_halo)}},symbolTextAndIcon:function(p,v){return{u_is_size_zoom_constant:new a.Uniform1i(p,v.u_is_size_zoom_constant),u_is_size_feature_constant:new a.Uniform1i(p,v.u_is_size_feature_constant),u_size_t:new a.Uniform1f(p,v.u_size_t),u_size:new a.Uniform1f(p,v.u_size),u_camera_to_center_distance:new a.Uniform1f(p,v.u_camera_to_center_distance),u_pitch:new a.Uniform1f(p,v.u_pitch),u_rotate_symbol:new a.Uniform1i(p,v.u_rotate_symbol),u_aspect_ratio:new a.Uniform1f(p,v.u_aspect_ratio),u_fade_change:new a.Uniform1f(p,v.u_fade_change),u_matrix:new a.UniformMatrix4f(p,v.u_matrix),u_label_plane_matrix:new a.UniformMatrix4f(p,v.u_label_plane_matrix),u_coord_matrix:new a.UniformMatrix4f(p,v.u_coord_matrix),u_is_text:new a.Uniform1i(p,v.u_is_text),u_pitch_with_map:new a.Uniform1i(p,v.u_pitch_with_map),u_texsize:new a.Uniform2f(p,v.u_texsize),u_texsize_icon:new a.Uniform2f(p,v.u_texsize_icon),u_texture:new a.Uniform1i(p,v.u_texture),u_texture_icon:new a.Uniform1i(p,v.u_texture_icon),u_gamma_scale:new a.Uniform1f(p,v.u_gamma_scale),u_device_pixel_ratio:new a.Uniform1f(p,v.u_device_pixel_ratio),u_is_halo:new a.Uniform1i(p,v.u_is_halo)}},background:function(p,v){return{u_matrix:new a.UniformMatrix4f(p,v.u_matrix),u_opacity:new a.Uniform1f(p,v.u_opacity),u_color:new a.UniformColor(p,v.u_color)}},backgroundPattern:function(p,v){return{u_matrix:new a.UniformMatrix4f(p,v.u_matrix),u_opacity:new a.Uniform1f(p,v.u_opacity),u_image:new a.Uniform1i(p,v.u_image),u_pattern_tl_a:new a.Uniform2f(p,v.u_pattern_tl_a),u_pattern_br_a:new a.Uniform2f(p,v.u_pattern_br_a),u_pattern_tl_b:new a.Uniform2f(p,v.u_pattern_tl_b),u_pattern_br_b:new a.Uniform2f(p,v.u_pattern_br_b),u_texsize:new a.Uniform2f(p,v.u_texsize),u_mix:new a.Uniform1f(p,v.u_mix),u_pattern_size_a:new a.Uniform2f(p,v.u_pattern_size_a),u_pattern_size_b:new a.Uniform2f(p,v.u_pattern_size_b),u_scale_a:new a.Uniform1f(p,v.u_scale_a),u_scale_b:new a.Uniform1f(p,v.u_scale_b),u_pixel_coord_upper:new a.Uniform2f(p,v.u_pixel_coord_upper),u_pixel_coord_lower:new a.Uniform2f(p,v.u_pixel_coord_lower),u_tile_units_to_pixels:new a.Uniform1f(p,v.u_tile_units_to_pixels)}}};function cu(p,v,d,_,A,M,R){for(var B=p.context,G=B.gl,J=p.useProgram("collisionBox"),ce=[],ve=0,ye=0,Oe=0;Oe<_.length;Oe++){var Re=_[Oe],Ge=v.getTile(Re),Me=Ge.getBucket(d);if(Me){var He=Re.posMatrix;A[0]===0&&A[1]===0||(He=p.translatePosMatrix(Re.posMatrix,Ge,A,M));var et=R?Me.textCollisionBox:Me.iconCollisionBox,ct=Me.collisionCircleArray;if(ct.length>0){var Pt=a.create(),At=He;a.mul(Pt,Me.placementInvProjMatrix,p.transform.glCoordMatrix),a.mul(Pt,Pt,Me.placementViewportMatrix),ce.push({circleArray:ct,circleOffset:ye,transform:At,invTransform:Pt}),ye=ve+=ct.length/4}et&&J.draw(B,G.LINES,ge.disabled,Le.disabled,p.colorModeForRenderPass(),nt.disabled,Zu(He,p.transform,Ge),d.id,et.layoutVertexBuffer,et.indexBuffer,et.segments,null,p.transform.zoom,null,null,et.collisionVertexBuffer)}}if(R&&ce.length){var Ot=p.useProgram("collisionCircle"),tr=new a.StructArrayLayout2f1f2i16;tr.resize(4*ve),tr._trim();for(var sr=0,_r=0,Ur=ce;_r<Ur.length;_r+=1)for(var hn=Ur[_r],An=0;An<hn.circleArray.length/4;An++){var bn=4*An,Fi=hn.circleArray[bn+0],$r=hn.circleArray[bn+1],Ln=hn.circleArray[bn+2],Yn=hn.circleArray[bn+3];tr.emplace(sr++,Fi,$r,Ln,Yn,0),tr.emplace(sr++,Fi,$r,Ln,Yn,1),tr.emplace(sr++,Fi,$r,Ln,Yn,2),tr.emplace(sr++,Fi,$r,Ln,Yn,3)}(!qc||qc.length<2*ve)&&(qc=function(Ha){var Va=2*Ha,wo=new a.StructArrayLayout3ui6;wo.resize(Va),wo._trim();for(var Ia=0;Ia<Va;Ia++){var Ea=6*Ia;wo.uint16[Ea+0]=4*Ia+0,wo.uint16[Ea+1]=4*Ia+1,wo.uint16[Ea+2]=4*Ia+2,wo.uint16[Ea+3]=4*Ia+2,wo.uint16[Ea+4]=4*Ia+3,wo.uint16[Ea+5]=4*Ia+0}return wo}(ve));for(var $n=B.createIndexBuffer(qc,!0),Fn=B.createVertexBuffer(tr,a.collisionCircleLayout.members,!0),ri=0,zn=ce;ri<zn.length;ri+=1){var pn=zn[ri],Ja=Vl(pn.transform,pn.invTransform,p.transform);Ot.draw(B,G.TRIANGLES,ge.disabled,Le.disabled,p.colorModeForRenderPass(),nt.disabled,Ja,d.id,Fn,$n,a.SegmentVector.simpleSegment(0,2*pn.circleOffset,pn.circleArray.length,pn.circleArray.length/2),null,p.transform.zoom,null,null,null)}Fn.destroy(),$n.destroy()}}var fu=a.identity(new Float32Array(16));function Qp(p,v,d,_,A,M){var R=a.getAnchorAlignment(p),B=-(R.horizontalAlign-.5)*v,G=-(R.verticalAlign-.5)*d,J=a.evaluateVariableOffset(p,_);return new a.Point((B/A+J[0])*M,(G/A+J[1])*M)}function hh(p,v,d,_,A,M,R,B,G,J,ce){var ve=p.text.placedSymbolArray,ye=p.text.dynamicLayoutVertexArray,Oe=p.icon.dynamicLayoutVertexArray,Re={};ye.clear();for(var Ge=0;Ge<ve.length;Ge++){var Me=ve.get(Ge),He=Me.hidden||!Me.crossTileID||p.allowVerticalPlacement&&!Me.placedOrientation?null:_[Me.crossTileID];if(He){var et=new a.Point(Me.anchorX,Me.anchorY),ct=ti(et,d?B:R),Pt=vi(M.cameraToCenterDistance,ct.signedDistanceFromCamera),At=A.evaluateSizeForFeature(p.textSizeData,J,Me)*Pt/a.ONE_EM;d&&(At*=p.tilePixelRatio/G);for(var Ot=Qp(He.anchor,He.width,He.height,He.textOffset,He.textBoxScale,At),tr=d?ti(et.add(Ot),R).point:ct.point.add(v?Ot.rotate(-M.angle):Ot),sr=p.allowVerticalPlacement&&Me.placedOrientation===a.WritingMode.vertical?Math.PI/2:0,_r=0;_r<Me.numGlyphs;_r++)a.addDynamicAttributes(ye,tr,sr);ce&&Me.associatedIconIndex>=0&&(Re[Me.associatedIconIndex]={shiftedAnchor:tr,angle:sr})}else Po(Me.numGlyphs,ye)}if(ce){Oe.clear();for(var Ur=p.icon.placedSymbolArray,hn=0;hn<Ur.length;hn++){var An=Ur.get(hn);if(An.hidden)Po(An.numGlyphs,Oe);else{var bn=Re[hn];if(bn)for(var Fi=0;Fi<An.numGlyphs;Fi++)a.addDynamicAttributes(Oe,bn.shiftedAnchor,bn.angle);else Po(An.numGlyphs,Oe)}}p.icon.dynamicLayoutVertexBuffer.updateData(Oe)}p.text.dynamicLayoutVertexBuffer.updateData(ye)}function np(p,v,d){return d.iconsInText&&v?"symbolTextAndIcon":p?"symbolSDF":"symbolIcon"}function Ns(p,v,d,_,A,M,R,B,G,J,ce,ve){for(var ye=p.context,Oe=ye.gl,Re=p.transform,Ge=B==="map",Me=G==="map",He=Ge&&d.layout.get("symbol-placement")!=="point",et=Ge&&!Me&&!He,ct=d.layout.get("symbol-sort-key").constantOr(1)!==void 0,Pt=!1,At=p.depthModeForSublayer(0,ge.ReadOnly),Ot=d.layout.get("text-variable-anchor"),tr=[],sr=0,_r=_;sr<_r.length;sr+=1){var Ur=_r[sr],hn=v.getTile(Ur),An=hn.getBucket(d);if(An){var bn=A?An.text:An.icon;if(bn&&bn.segments.get().length){var Fi=bn.programConfigurations.get(d.id),$r=A||An.sdfIcons,Ln=A?An.textSizeData:An.iconSizeData,Yn=Me||Re.pitch!==0,$n=p.useProgram(np($r,A,An),Fi),Fn=a.evaluateSizeForZoom(Ln,Re.zoom),ri=void 0,zn=[0,0],pn=void 0,Ja=void 0,Ha=null,Va=void 0;if(A)pn=hn.glyphAtlasTexture,Ja=Oe.LINEAR,ri=hn.glyphAtlasTexture.size,An.iconsInText&&(zn=hn.imageAtlasTexture.size,Ha=hn.imageAtlasTexture,Va=Yn||p.options.rotating||p.options.zooming||Ln.kind==="composite"||Ln.kind==="camera"?Oe.LINEAR:Oe.NEAREST);else{var wo=d.layout.get("icon-size").constantOr(0)!==1||An.iconsNeedLinear;pn=hn.imageAtlasTexture,Ja=$r||p.options.rotating||p.options.zooming||wo||Yn?Oe.LINEAR:Oe.NEAREST,ri=hn.imageAtlasTexture.size}var Ia=ga(hn,1,p.transform.zoom),Ea=Hi(Ur.posMatrix,Me,Ge,p.transform,Ia),ms=Di(Ur.posMatrix,Me,Ge,p.transform,Ia),da=Ot&&An.hasTextData(),rl=d.layout.get("icon-text-fit")!=="none"&&da&&An.hasIconData();He&&As(An,Ur.posMatrix,p,A,Ea,ms,Me,J);var ks=p.translatePosMatrix(Ur.posMatrix,hn,M,R),Iu=He||A&&Ot||rl?fu:Ea,mu=p.translatePosMatrix(ms,hn,M,R,!0),Xl=$r&&d.paint.get(A?"text-halo-width":"icon-halo-width").constantOr(1)!==0,tf={program:$n,buffers:bn,uniformValues:$r?An.iconsInText?wf(Ln.kind,Fn,et,Me,p,ks,Iu,mu,ri,zn):Zc(Ln.kind,Fn,et,Me,p,ks,Iu,mu,A,ri,!0):bl(Ln.kind,Fn,et,Me,p,ks,Iu,mu,A,ri),atlasTexture:pn,atlasTextureIcon:Ha,atlasInterpolation:Ja,atlasInterpolationIcon:Va,isSDF:$r,hasHalo:Xl};if(ct&&An.canOverlap){Pt=!0;for(var gu=0,Yl=bn.segments.get();gu<Yl.length;gu+=1){var rf=Yl[gu];tr.push({segments:new a.SegmentVector([rf]),sortKey:rf.sortKey,state:tf})}}else tr.push({segments:bn.segments,sortKey:0,state:tf})}}}Pt&&tr.sort(function(Tl,Ac){return Tl.sortKey-Ac.sortKey});for(var nl=0,il=tr;nl<il.length;nl+=1){var al=il[nl],Ro=al.state;if(ye.activeTexture.set(Oe.TEXTURE0),Ro.atlasTexture.bind(Ro.atlasInterpolation,Oe.CLAMP_TO_EDGE),Ro.atlasTextureIcon&&(ye.activeTexture.set(Oe.TEXTURE1),Ro.atlasTextureIcon&&Ro.atlasTextureIcon.bind(Ro.atlasInterpolationIcon,Oe.CLAMP_TO_EDGE)),Ro.isSDF){var yu=Ro.uniformValues;Ro.hasHalo&&(yu.u_is_halo=1,jl(Ro.buffers,al.segments,d,p,Ro.program,At,ce,ve,yu)),yu.u_is_halo=0}jl(Ro.buffers,al.segments,d,p,Ro.program,At,ce,ve,Ro.uniformValues)}}function jl(p,v,d,_,A,M,R,B,G){var J=_.context;A.draw(J,J.gl.TRIANGLES,M,R,B,nt.disabled,G,d.id,p.layoutVertexBuffer,p.indexBuffer,v,d.paint,_.transform.zoom,p.programConfigurations.get(d.id),p.dynamicLayoutVertexBuffer,p.opacityVertexBuffer)}function ph(p,v,d,_,A,M,R){var B,G,J,ce,ve,ye=p.context.gl,Oe=d.paint.get("fill-pattern"),Re=Oe&&Oe.constantOr(1),Ge=d.getCrossfadeParameters();R?(G=Re&&!d.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",B=ye.LINES):(G=Re?"fillPattern":"fill",B=ye.TRIANGLES);for(var Me=0,He=_;Me<He.length;Me+=1){var et=He[Me],ct=v.getTile(et);if(!Re||ct.patternsLoaded()){var Pt=ct.getBucket(d);if(Pt){var At=Pt.programConfigurations.get(d.id),Ot=p.useProgram(G,At);Re&&(p.context.activeTexture.set(ye.TEXTURE0),ct.imageAtlasTexture.bind(ye.LINEAR,ye.CLAMP_TO_EDGE),At.updatePaintBuffers(Ge));var tr=Oe.constantOr(null);if(tr&&ct.imageAtlas){var sr=ct.imageAtlas,_r=sr.patternPositions[tr.to.toString()],Ur=sr.patternPositions[tr.from.toString()];_r&&Ur&&At.setConstantPatternPositions(_r,Ur)}var hn=p.translatePosMatrix(et.posMatrix,ct,d.paint.get("fill-translate"),d.paint.get("fill-translate-anchor"));if(R){ce=Pt.indexBuffer2,ve=Pt.segments2;var An=[ye.drawingBufferWidth,ye.drawingBufferHeight];J=G==="fillOutlinePattern"&&Re?Ps(hn,p,Ge,ct,An):ch(hn,An)}else ce=Pt.indexBuffer,ve=Pt.segments,J=Re?Ul(hn,p,Ge,ct):wa(hn);Ot.draw(p.context,B,A,p.stencilModeForClipping(et),M,nt.disabled,J,d.id,Pt.layoutVertexBuffer,ce,ve,d.paint,p.transform.zoom,At)}}}}function ip(p,v,d,_,A,M,R){for(var B=p.context,G=B.gl,J=d.paint.get("fill-extrusion-pattern"),ce=J.constantOr(1),ve=d.getCrossfadeParameters(),ye=d.paint.get("fill-extrusion-opacity"),Oe=0,Re=_;Oe<Re.length;Oe+=1){var Ge=Re[Oe],Me=v.getTile(Ge),He=Me.getBucket(d);if(He){var et=He.programConfigurations.get(d.id),ct=p.useProgram(ce?"fillExtrusionPattern":"fillExtrusion",et);ce&&(p.context.activeTexture.set(G.TEXTURE0),Me.imageAtlasTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE),et.updatePaintBuffers(ve));var Pt=J.constantOr(null);if(Pt&&Me.imageAtlas){var At=Me.imageAtlas,Ot=At.patternPositions[Pt.to.toString()],tr=At.patternPositions[Pt.from.toString()];Ot&&tr&&et.setConstantPatternPositions(Ot,tr)}var sr=p.translatePosMatrix(Ge.posMatrix,Me,d.paint.get("fill-extrusion-translate"),d.paint.get("fill-extrusion-translate-anchor")),_r=d.paint.get("fill-extrusion-vertical-gradient"),Ur=ce?pc(sr,p,_r,ye,Ge,ve,Me):$d(sr,p,_r,ye);ct.draw(B,B.gl.TRIANGLES,A,M,R,nt.backCCW,Ur,d.id,He.layoutVertexBuffer,He.indexBuffer,He.segments,d.paint,p.transform.zoom,et)}}}function dh(p,v,d,_,A,M){var R=p.context,B=R.gl,G=v.fbo;if(G){var J=p.useProgram("hillshade");R.activeTexture.set(B.TEXTURE0),B.bindTexture(B.TEXTURE_2D,G.colorAttachment.get());var ce=function(ve,ye,Oe){var Re=Oe.paint.get("hillshade-shadow-color"),Ge=Oe.paint.get("hillshade-highlight-color"),Me=Oe.paint.get("hillshade-accent-color"),He=Oe.paint.get("hillshade-illumination-direction")*(Math.PI/180);Oe.paint.get("hillshade-illumination-anchor")==="viewport"&&(He-=ve.transform.angle);var et,ct,Pt,At=!ve.options.moving;return{u_matrix:ve.transform.calculatePosMatrix(ye.tileID.toUnwrapped(),At),u_image:0,u_latrange:(et=ye.tileID,ct=Math.pow(2,et.canonical.z),Pt=et.canonical.y,[new a.MercatorCoordinate(0,Pt/ct).toLngLat().lat,new a.MercatorCoordinate(0,(Pt+1)/ct).toLngLat().lat]),u_light:[Oe.paint.get("hillshade-exaggeration"),He],u_shadow:Re,u_highlight:Ge,u_accent:Me}}(p,v,d);J.draw(R,B.TRIANGLES,_,A,M,nt.disabled,ce,d.id,p.rasterBoundsBuffer,p.quadTriangleIndexBuffer,p.rasterBoundsSegments)}}function Qu(p,v,d,_,A,M){var R=p.context,B=R.gl,G=v.dem;if(G&&G.data){var J=G.dim,ce=G.stride,ve=G.getPixels();if(R.activeTexture.set(B.TEXTURE1),R.pixelStoreUnpackPremultiplyAlpha.set(!1),v.demTexture=v.demTexture||p.getTileTexture(ce),v.demTexture){var ye=v.demTexture;ye.update(ve,{premultiply:!1}),ye.bind(B.NEAREST,B.CLAMP_TO_EDGE)}else v.demTexture=new a.Texture(R,ve,B.RGBA,{premultiply:!1}),v.demTexture.bind(B.NEAREST,B.CLAMP_TO_EDGE);R.activeTexture.set(B.TEXTURE0);var Oe=v.fbo;if(!Oe){var Re=new a.Texture(R,{width:J,height:J,data:null},B.RGBA);Re.bind(B.LINEAR,B.CLAMP_TO_EDGE),(Oe=v.fbo=R.createFramebuffer(J,J,!0)).colorAttachment.set(Re.texture)}R.bindFramebuffer.set(Oe.framebuffer),R.viewport.set([0,0,J,J]),p.useProgram("hillshadePrepare").draw(R,B.TRIANGLES,_,A,M,nt.disabled,function(Ge,Me){var He=Me.stride,et=a.create();return a.ortho(et,0,a.EXTENT,-a.EXTENT,0,0,1),a.translate(et,et,[0,-a.EXTENT,0]),{u_matrix:et,u_image:1,u_dimension:[He,He],u_zoom:Ge.overscaledZ,u_unpack:Me.getUnpackVector()}}(v.tileID,G),d.id,p.rasterBoundsBuffer,p.quadTriangleIndexBuffer,p.rasterBoundsSegments),v.needsHillshadePrepare=!1}}function Is(p,v,d,_,A){var M=_.paint.get("raster-fade-duration");if(M>0){var R=a.browser.now(),B=(R-p.timeAdded)/M,G=v?(R-v.timeAdded)/M:-1,J=d.getSource(),ce=A.coveringZoomLevel({tileSize:J.tileSize,roundZoom:J.roundZoom}),ve=!v||Math.abs(v.tileID.overscaledZ-ce)>Math.abs(p.tileID.overscaledZ-ce),ye=ve&&p.refreshedUponExpiration?1:a.clamp(ve?B:1-G,0,1);return p.refreshedUponExpiration&&B>=1&&(p.refreshedUponExpiration=!1),v?{opacity:1,mix:1-ye}:{opacity:ye,mix:0}}return{opacity:1,mix:0}}var Ef=new a.Color(1,0,0,1),Sf=new a.Color(0,1,0,1),Hd=new a.Color(0,0,1,1),ap=new a.Color(1,0,1,1),Jp=new a.Color(0,1,1,1);function vh(p,v,d,_){ft(p,0,v+d/2,p.transform.width,d,_)}function gc(p,v,d,_){ft(p,v-d/2,0,d,p.transform.height,_)}function ft(p,v,d,_,A,M){var R=p.context,B=R.gl;B.enable(B.SCISSOR_TEST),B.scissor(v*a.browser.devicePixelRatio,d*a.browser.devicePixelRatio,_*a.browser.devicePixelRatio,A*a.browser.devicePixelRatio),R.clear({color:M}),B.disable(B.SCISSOR_TEST)}function Jt(p,v,d){var _=p.context,A=_.gl,M=d.posMatrix,R=p.useProgram("debug"),B=ge.disabled,G=Le.disabled,J=p.colorModeForRenderPass();_.activeTexture.set(A.TEXTURE0),p.emptyTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),R.draw(_,A.LINE_STRIP,B,G,J,nt.disabled,Ku(M,a.Color.red),"$debug",p.debugBuffer,p.tileBorderIndexBuffer,p.debugSegments);var ce=v.getTileByID(d.key).latestRawTileData,ve=Math.floor((ce&&ce.byteLength||0)/1024),ye=v.getTile(d).tileSize,Oe=512/Math.min(ye,512)*(d.overscaledZ/p.transform.zoom)*.5,Re=d.canonical.toString();d.overscaledZ!==d.canonical.z&&(Re+=" => "+d.overscaledZ),function(Ge,Me){Ge.initDebugOverlayCanvas();var He=Ge.debugOverlayCanvas,et=Ge.context.gl,ct=Ge.debugOverlayCanvas.getContext("2d");ct.clearRect(0,0,He.width,He.height),ct.shadowColor="white",ct.shadowBlur=2,ct.lineWidth=1.5,ct.strokeStyle="white",ct.textBaseline="top",ct.font="bold 36px Open Sans, sans-serif",ct.fillText(Me,5,5),ct.strokeText(Me,5,5),Ge.debugOverlayTexture.update(He),Ge.debugOverlayTexture.bind(et.LINEAR,et.CLAMP_TO_EDGE)}(p,Re+" "+ve+"kb"),R.draw(_,A.TRIANGLES,B,G,Ke.alphaBlended,nt.disabled,Ku(M,a.Color.transparent,Oe),"$debug",p.debugBuffer,p.quadTriangleIndexBuffer,p.debugSegments)}var Nt={symbol:function(p,v,d,_,A){if(p.renderPass==="translucent"){var M=Le.disabled,R=p.colorModeForRenderPass();d.layout.get("text-variable-anchor")&&function(B,G,J,ce,ve,ye,Oe){for(var Re=G.transform,Ge=ve==="map",Me=ye==="map",He=0,et=B;He<et.length;He+=1){var ct=et[He],Pt=ce.getTile(ct),At=Pt.getBucket(J);if(At&&At.text&&At.text.segments.get().length){var Ot=a.evaluateSizeForZoom(At.textSizeData,Re.zoom),tr=ga(Pt,1,G.transform.zoom),sr=Hi(ct.posMatrix,Me,Ge,G.transform,tr),_r=J.layout.get("icon-text-fit")!=="none"&&At.hasIconData();if(Ot){var Ur=Math.pow(2,Re.zoom-Pt.tileID.overscaledZ);hh(At,Ge,Me,Oe,a.symbolSize,Re,sr,ct.posMatrix,Ur,Ot,_r)}}}}(_,p,d,v,d.layout.get("text-rotation-alignment"),d.layout.get("text-pitch-alignment"),A),d.paint.get("icon-opacity").constantOr(1)!==0&&Ns(p,v,d,_,!1,d.paint.get("icon-translate"),d.paint.get("icon-translate-anchor"),d.layout.get("icon-rotation-alignment"),d.layout.get("icon-pitch-alignment"),d.layout.get("icon-keep-upright"),M,R),d.paint.get("text-opacity").constantOr(1)!==0&&Ns(p,v,d,_,!0,d.paint.get("text-translate"),d.paint.get("text-translate-anchor"),d.layout.get("text-rotation-alignment"),d.layout.get("text-pitch-alignment"),d.layout.get("text-keep-upright"),M,R),v.map.showCollisionBoxes&&(cu(p,v,d,_,d.paint.get("text-translate"),d.paint.get("text-translate-anchor"),!0),cu(p,v,d,_,d.paint.get("icon-translate"),d.paint.get("icon-translate-anchor"),!1))}},circle:function(p,v,d,_){if(p.renderPass==="translucent"){var A=d.paint.get("circle-opacity"),M=d.paint.get("circle-stroke-width"),R=d.paint.get("circle-stroke-opacity"),B=d.layout.get("circle-sort-key").constantOr(1)!==void 0;if(A.constantOr(1)!==0||M.constantOr(1)!==0&&R.constantOr(1)!==0){for(var G=p.context,J=G.gl,ce=p.depthModeForSublayer(0,ge.ReadOnly),ve=Le.disabled,ye=p.colorModeForRenderPass(),Oe=[],Re=0;Re<_.length;Re++){var Ge=_[Re],Me=v.getTile(Ge),He=Me.getBucket(d);if(He){var et=He.programConfigurations.get(d.id),ct={programConfiguration:et,program:p.useProgram("circle",et),layoutVertexBuffer:He.layoutVertexBuffer,indexBuffer:He.indexBuffer,uniformValues:fh(p,Ge,Me,d)};if(B)for(var Pt=0,At=He.segments.get();Pt<At.length;Pt+=1){var Ot=At[Pt];Oe.push({segments:new a.SegmentVector([Ot]),sortKey:Ot.sortKey,state:ct})}else Oe.push({segments:He.segments,sortKey:0,state:ct})}}B&&Oe.sort(function(hn,An){return hn.sortKey-An.sortKey});for(var tr=0,sr=Oe;tr<sr.length;tr+=1){var _r=sr[tr],Ur=_r.state;Ur.program.draw(G,J.TRIANGLES,ce,ve,ye,nt.disabled,Ur.uniformValues,d.id,Ur.layoutVertexBuffer,Ur.indexBuffer,_r.segments,d.paint,p.transform.zoom,Ur.programConfiguration)}}}},heatmap:function(p,v,d,_){if(d.paint.get("heatmap-opacity")!==0)if(p.renderPass==="offscreen"){var A=p.context,M=A.gl,R=Le.disabled,B=new Ke([M.ONE,M.ONE],a.Color.transparent,[!0,!0,!0,!0]);(function(Oe,Re,Ge){var Me=Oe.gl;Oe.activeTexture.set(Me.TEXTURE1),Oe.viewport.set([0,0,Re.width/4,Re.height/4]);var He=Ge.heatmapFbo;if(He)Me.bindTexture(Me.TEXTURE_2D,He.colorAttachment.get()),Oe.bindFramebuffer.set(He.framebuffer);else{var et=Me.createTexture();Me.bindTexture(Me.TEXTURE_2D,et),Me.texParameteri(Me.TEXTURE_2D,Me.TEXTURE_WRAP_S,Me.CLAMP_TO_EDGE),Me.texParameteri(Me.TEXTURE_2D,Me.TEXTURE_WRAP_T,Me.CLAMP_TO_EDGE),Me.texParameteri(Me.TEXTURE_2D,Me.TEXTURE_MIN_FILTER,Me.LINEAR),Me.texParameteri(Me.TEXTURE_2D,Me.TEXTURE_MAG_FILTER,Me.LINEAR),He=Ge.heatmapFbo=Oe.createFramebuffer(Re.width/4,Re.height/4,!1),function(ct,Pt,At,Ot){var tr=ct.gl;tr.texImage2D(tr.TEXTURE_2D,0,tr.RGBA,Pt.width/4,Pt.height/4,0,tr.RGBA,ct.extRenderToTextureHalfFloat?ct.extTextureHalfFloat.HALF_FLOAT_OES:tr.UNSIGNED_BYTE,null),Ot.colorAttachment.set(At)}(Oe,Re,et,He)}})(A,p,d),A.clear({color:a.Color.transparent});for(var G=0;G<_.length;G++){var J=_[G];if(!v.hasRenderableParent(J)){var ce=v.getTile(J),ve=ce.getBucket(d);if(ve){var ye=ve.programConfigurations.get(d.id);p.useProgram("heatmap",ye).draw(A,M.TRIANGLES,ge.disabled,R,B,nt.disabled,Xc(J.posMatrix,ce,p.transform.zoom,d.paint.get("heatmap-intensity")),d.id,ve.layoutVertexBuffer,ve.indexBuffer,ve.segments,d.paint,p.transform.zoom,ye)}}}A.viewport.set([0,0,p.width,p.height])}else p.renderPass==="translucent"&&(p.context.setColorMode(p.colorModeForRenderPass()),function(Oe,Re){var Ge=Oe.context,Me=Ge.gl,He=Re.heatmapFbo;if(He){Ge.activeTexture.set(Me.TEXTURE0),Me.bindTexture(Me.TEXTURE_2D,He.colorAttachment.get()),Ge.activeTexture.set(Me.TEXTURE1);var et=Re.colorRampTexture;et||(et=Re.colorRampTexture=new a.Texture(Ge,Re.colorRamp,Me.RGBA)),et.bind(Me.LINEAR,Me.CLAMP_TO_EDGE),Oe.useProgram("heatmapTexture").draw(Ge,Me.TRIANGLES,ge.disabled,Le.disabled,Oe.colorModeForRenderPass(),nt.disabled,function(ct,Pt,At,Ot){var tr=a.create();a.ortho(tr,0,ct.width,ct.height,0,0,1);var sr=ct.context.gl;return{u_matrix:tr,u_world:[sr.drawingBufferWidth,sr.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:Pt.paint.get("heatmap-opacity")}}(Oe,Re),Re.id,Oe.viewportBuffer,Oe.quadTriangleIndexBuffer,Oe.viewportSegments,Re.paint,Oe.transform.zoom)}}(p,d))},line:function(p,v,d,_){if(p.renderPass==="translucent"){var A=d.paint.get("line-opacity"),M=d.paint.get("line-width");if(A.constantOr(1)!==0&&M.constantOr(1)!==0)for(var R=p.depthModeForSublayer(0,ge.ReadOnly),B=p.colorModeForRenderPass(),G=d.paint.get("line-dasharray"),J=d.paint.get("line-pattern"),ce=J.constantOr(1),ve=d.paint.get("line-gradient"),ye=d.getCrossfadeParameters(),Oe=ce?"linePattern":G?"lineSDF":ve?"lineGradient":"line",Re=p.context,Ge=Re.gl,Me=!0,He=0,et=_;He<et.length;He+=1){var ct=et[He],Pt=v.getTile(ct);if(!ce||Pt.patternsLoaded()){var At=Pt.getBucket(d);if(At){var Ot=At.programConfigurations.get(d.id),tr=p.context.program.get(),sr=p.useProgram(Oe,Ot),_r=Me||sr.program!==tr,Ur=J.constantOr(null);if(Ur&&Pt.imageAtlas){var hn=Pt.imageAtlas,An=hn.patternPositions[Ur.to.toString()],bn=hn.patternPositions[Ur.from.toString()];An&&bn&&Ot.setConstantPatternPositions(An,bn)}var Fi=ce?vc(p,Pt,d,ye):G?Gd(p,Pt,d,G,ye):ve?pa(p,Pt,d,At.lineClipsArray.length):dc(p,Pt,d);if(ce)Re.activeTexture.set(Ge.TEXTURE0),Pt.imageAtlasTexture.bind(Ge.LINEAR,Ge.CLAMP_TO_EDGE),Ot.updatePaintBuffers(ye);else if(G&&(_r||p.lineAtlas.dirty))Re.activeTexture.set(Ge.TEXTURE0),p.lineAtlas.bind(Re);else if(ve){var $r=At.gradients[d.id],Ln=$r.texture;if(d.gradientVersion!==$r.version){var Yn=256;if(d.stepInterpolant){var $n=v.getSource().maxzoom,Fn=ct.canonical.z===$n?Math.ceil(1<<p.transform.maxZoom-ct.canonical.z):1;Yn=a.clamp(a.nextPowerOfTwo(At.maxLineLength/a.EXTENT*1024*Fn),256,Re.maxTextureSize)}$r.gradient=a.renderColorRamp({expression:d.gradientExpression(),evaluationKey:"lineProgress",resolution:Yn,image:$r.gradient||void 0,clips:At.lineClipsArray}),$r.texture?$r.texture.update($r.gradient):$r.texture=new a.Texture(Re,$r.gradient,Ge.RGBA),$r.version=d.gradientVersion,Ln=$r.texture}Re.activeTexture.set(Ge.TEXTURE0),Ln.bind(d.stepInterpolant?Ge.NEAREST:Ge.LINEAR,Ge.CLAMP_TO_EDGE)}sr.draw(Re,Ge.TRIANGLES,R,p.stencilModeForClipping(ct),B,nt.disabled,Fi,d.id,At.layoutVertexBuffer,At.indexBuffer,At.segments,d.paint,p.transform.zoom,Ot,At.layoutVertexBuffer2),Me=!1}}}}},fill:function(p,v,d,_){var A=d.paint.get("fill-color"),M=d.paint.get("fill-opacity");if(M.constantOr(1)!==0){var R=p.colorModeForRenderPass(),B=d.paint.get("fill-pattern"),G=p.opaquePassEnabledForLayer()&&!B.constantOr(1)&&A.constantOr(a.Color.transparent).a===1&&M.constantOr(0)===1?"opaque":"translucent";if(p.renderPass===G){var J=p.depthModeForSublayer(1,p.renderPass==="opaque"?ge.ReadWrite:ge.ReadOnly);ph(p,v,d,_,J,R,!1)}if(p.renderPass==="translucent"&&d.paint.get("fill-antialias")){var ce=p.depthModeForSublayer(d.getPaintProperty("fill-outline-color")?2:0,ge.ReadOnly);ph(p,v,d,_,ce,R,!0)}}},"fill-extrusion":function(p,v,d,_){var A=d.paint.get("fill-extrusion-opacity");if(A!==0&&p.renderPass==="translucent"){var M=new ge(p.context.gl.LEQUAL,ge.ReadWrite,p.depthRangeFor3D);if(A!==1||d.paint.get("fill-extrusion-pattern").constantOr(1))ip(p,v,d,_,M,Le.disabled,Ke.disabled),ip(p,v,d,_,M,p.stencilModeFor3D(),p.colorModeForRenderPass());else{var R=p.colorModeForRenderPass();ip(p,v,d,_,M,Le.disabled,R)}}},hillshade:function(p,v,d,_){if(p.renderPass==="offscreen"||p.renderPass==="translucent"){for(var A=p.context,M=p.depthModeForSublayer(0,ge.ReadOnly),R=p.colorModeForRenderPass(),B=p.renderPass==="translucent"?p.stencilConfigForOverlap(_):[{},_],G=B[0],J=0,ce=B[1];J<ce.length;J+=1){var ve=ce[J],ye=v.getTile(ve);ye.needsHillshadePrepare&&p.renderPass==="offscreen"?Qu(p,ye,d,M,Le.disabled,R):p.renderPass==="translucent"&&dh(p,ye,d,M,G[ve.overscaledZ],R)}A.viewport.set([0,0,p.width,p.height])}},raster:function(p,v,d,_){if(p.renderPass==="translucent"&&d.paint.get("raster-opacity")!==0&&_.length)for(var A=p.context,M=A.gl,R=v.getSource(),B=p.useProgram("raster"),G=p.colorModeForRenderPass(),J=R instanceof gt?[{},_]:p.stencilConfigForOverlap(_),ce=J[0],ve=J[1],ye=ve[ve.length-1].overscaledZ,Oe=!p.options.moving,Re=0,Ge=ve;Re<Ge.length;Re+=1){var Me=Ge[Re],He=p.depthModeForSublayer(Me.overscaledZ-ye,d.paint.get("raster-opacity")===1?ge.ReadWrite:ge.ReadOnly,M.LESS),et=v.getTile(Me),ct=p.transform.calculatePosMatrix(Me.toUnwrapped(),Oe);et.registerFadeDuration(d.paint.get("raster-fade-duration"));var Pt=v.findLoadedParent(Me,0),At=Is(et,Pt,v,d,p.transform),Ot=void 0,tr=void 0,sr=d.paint.get("raster-resampling")==="nearest"?M.NEAREST:M.LINEAR;A.activeTexture.set(M.TEXTURE0),et.texture.bind(sr,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST),A.activeTexture.set(M.TEXTURE1),Pt?(Pt.texture.bind(sr,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST),Ot=Math.pow(2,Pt.tileID.overscaledZ-et.tileID.overscaledZ),tr=[et.tileID.canonical.x*Ot%1,et.tileID.canonical.y*Ot%1]):et.texture.bind(sr,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST);var _r=Kp(ct,tr||[0,0],Ot||1,At,d);R instanceof gt?B.draw(A,M.TRIANGLES,He,Le.disabled,G,nt.disabled,_r,d.id,R.boundsBuffer,p.quadTriangleIndexBuffer,R.boundsSegments):B.draw(A,M.TRIANGLES,He,ce[Me.overscaledZ],G,nt.disabled,_r,d.id,p.rasterBoundsBuffer,p.quadTriangleIndexBuffer,p.rasterBoundsSegments)}},background:function(p,v,d){var _=d.paint.get("background-color"),A=d.paint.get("background-opacity");if(A!==0){var M=p.context,R=M.gl,B=p.transform,G=B.tileSize,J=d.paint.get("background-pattern");if(!p.isPatternMissing(J)){var ce=!J&&_.a===1&&A===1&&p.opaquePassEnabledForLayer()?"opaque":"translucent";if(p.renderPass===ce){var ve=Le.disabled,ye=p.depthModeForSublayer(0,ce==="opaque"?ge.ReadWrite:ge.ReadOnly),Oe=p.colorModeForRenderPass(),Re=p.useProgram(J?"backgroundPattern":"background"),Ge=B.coveringTiles({tileSize:G});J&&(M.activeTexture.set(R.TEXTURE0),p.imageManager.bind(p.context));for(var Me=d.getCrossfadeParameters(),He=0,et=Ge;He<et.length;He+=1){var ct=et[He],Pt=p.transform.calculatePosMatrix(ct.toUnwrapped()),At=J?mc(Pt,A,p,J,{tileID:ct,tileSize:G},Me):wl(Pt,A,_);Re.draw(M,R.TRIANGLES,ye,ve,Oe,nt.disabled,At,d.id,p.tileExtentBuffer,p.quadTriangleIndexBuffer,p.tileExtentSegments)}}}}},debug:function(p,v,d){for(var _=0;_<d.length;_++)Jt(p,v,d[_])},custom:function(p,v,d){var _=p.context,A=d.implementation;if(p.renderPass==="offscreen"){var M=A.prerender;M&&(p.setCustomLayerDefaults(),_.setColorMode(p.colorModeForRenderPass()),M.call(A,_.gl,p.transform.customLayerMatrix()),_.setDirty(),p.setBaseState())}else if(p.renderPass==="translucent"){p.setCustomLayerDefaults(),_.setColorMode(p.colorModeForRenderPass()),_.setStencilMode(Le.disabled);var R=A.renderingMode==="3d"?new ge(p.context.gl.LEQUAL,ge.ReadWrite,p.depthRangeFor3D):p.depthModeForSublayer(0,ge.ReadOnly);_.setDepthMode(R),A.render(_.gl,p.transform.customLayerMatrix()),_.setDirty(),p.setBaseState(),_.bindFramebuffer.set(null)}}},jr=function(p,v){this.context=new de(p),this.transform=v,this._tileTextures={},this.setup(),this.numSublayers=Fe.maxUnderzooming+Fe.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new sc,this.gpuTimers={}};jr.prototype.resize=function(p,v){if(this.width=p*a.browser.devicePixelRatio,this.height=v*a.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var d=0,_=this.style._order;d<_.length;d+=1)this.style._layers[_[d]].resize()},jr.prototype.setup=function(){var p=this.context,v=new a.StructArrayLayout2i4;v.emplaceBack(0,0),v.emplaceBack(a.EXTENT,0),v.emplaceBack(0,a.EXTENT),v.emplaceBack(a.EXTENT,a.EXTENT),this.tileExtentBuffer=p.createVertexBuffer(v,ao.members),this.tileExtentSegments=a.SegmentVector.simpleSegment(0,0,4,2);var d=new a.StructArrayLayout2i4;d.emplaceBack(0,0),d.emplaceBack(a.EXTENT,0),d.emplaceBack(0,a.EXTENT),d.emplaceBack(a.EXTENT,a.EXTENT),this.debugBuffer=p.createVertexBuffer(d,ao.members),this.debugSegments=a.SegmentVector.simpleSegment(0,0,4,5);var _=new a.StructArrayLayout4i8;_.emplaceBack(0,0,0,0),_.emplaceBack(a.EXTENT,0,a.EXTENT,0),_.emplaceBack(0,a.EXTENT,0,a.EXTENT),_.emplaceBack(a.EXTENT,a.EXTENT,a.EXTENT,a.EXTENT),this.rasterBoundsBuffer=p.createVertexBuffer(_,rt.members),this.rasterBoundsSegments=a.SegmentVector.simpleSegment(0,0,4,2);var A=new a.StructArrayLayout2i4;A.emplaceBack(0,0),A.emplaceBack(1,0),A.emplaceBack(0,1),A.emplaceBack(1,1),this.viewportBuffer=p.createVertexBuffer(A,ao.members),this.viewportSegments=a.SegmentVector.simpleSegment(0,0,4,2);var M=new a.StructArrayLayout1ui2;M.emplaceBack(0),M.emplaceBack(1),M.emplaceBack(3),M.emplaceBack(2),M.emplaceBack(0),this.tileBorderIndexBuffer=p.createIndexBuffer(M);var R=new a.StructArrayLayout3ui6;R.emplaceBack(0,1,2),R.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=p.createIndexBuffer(R),this.emptyTexture=new a.Texture(p,{width:1,height:1,data:new Uint8Array([0,0,0,0])},p.gl.RGBA);var B=this.context.gl;this.stencilClearMode=new Le({func:B.ALWAYS,mask:0},0,255,B.ZERO,B.ZERO,B.ZERO)},jr.prototype.clearStencil=function(){var p=this.context,v=p.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var d=a.create();a.ortho(d,0,this.width,this.height,0,0,1),a.scale(d,d,[v.drawingBufferWidth,v.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(p,v.TRIANGLES,ge.disabled,this.stencilClearMode,Ke.disabled,nt.disabled,Au(d),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},jr.prototype._renderTileClippingMasks=function(p,v){if(this.currentStencilSource!==p.source&&p.isTileClipped()&&v&&v.length){this.currentStencilSource=p.source;var d=this.context,_=d.gl;this.nextStencilID+v.length>256&&this.clearStencil(),d.setColorMode(Ke.disabled),d.setDepthMode(ge.disabled);var A=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var M=0,R=v;M<R.length;M+=1){var B=R[M],G=this._tileClippingMaskIDs[B.key]=this.nextStencilID++;A.draw(d,_.TRIANGLES,ge.disabled,new Le({func:_.ALWAYS,mask:0},G,255,_.KEEP,_.KEEP,_.REPLACE),Ke.disabled,nt.disabled,Au(B.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},jr.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var p=this.nextStencilID++,v=this.context.gl;return new Le({func:v.NOTEQUAL,mask:255},p,255,v.KEEP,v.KEEP,v.REPLACE)},jr.prototype.stencilModeForClipping=function(p){var v=this.context.gl;return new Le({func:v.EQUAL,mask:255},this._tileClippingMaskIDs[p.key],0,v.KEEP,v.KEEP,v.REPLACE)},jr.prototype.stencilConfigForOverlap=function(p){var v,d=this.context.gl,_=p.sort(function(G,J){return J.overscaledZ-G.overscaledZ}),A=_[_.length-1].overscaledZ,M=_[0].overscaledZ-A+1;if(M>1){this.currentStencilSource=void 0,this.nextStencilID+M>256&&this.clearStencil();for(var R={},B=0;B<M;B++)R[B+A]=new Le({func:d.GEQUAL,mask:255},B+this.nextStencilID,255,d.KEEP,d.KEEP,d.REPLACE);return this.nextStencilID+=M,[R,_]}return[(v={},v[A]=Le.disabled,v),_]},jr.prototype.colorModeForRenderPass=function(){var p=this.context.gl;return this._showOverdrawInspector?new Ke([p.CONSTANT_COLOR,p.ONE],new a.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Ke.unblended:Ke.alphaBlended},jr.prototype.depthModeForSublayer=function(p,v,d){if(!this.opaquePassEnabledForLayer())return ge.disabled;var _=1-((1+this.currentLayer)*this.numSublayers+p)*this.depthEpsilon;return new ge(d||this.context.gl.LEQUAL,v,[_,_])},jr.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},jr.prototype.render=function(p,v){var d=this;this.style=p,this.options=v,this.lineAtlas=p.lineAtlas,this.imageManager=p.imageManager,this.glyphManager=p.glyphManager,this.symbolFadeChange=p.placement.symbolFadeChange(a.browser.now()),this.imageManager.beginFrame();var _=this.style._order,A=this.style.sourceCaches;for(var M in A){var R=A[M];R.used&&R.prepare(this.context)}var B,G,J={},ce={},ve={};for(var ye in A){var Oe=A[ye];J[ye]=Oe.getVisibleCoordinates(),ce[ye]=J[ye].slice().reverse(),ve[ye]=Oe.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var Re=0;Re<_.length;Re++)if(this.style._layers[_[Re]].is3D()){this.opaquePassCutoff=Re;break}this.renderPass="offscreen";for(var Ge=0,Me=_;Ge<Me.length;Ge+=1){var He=this.style._layers[Me[Ge]];if(He.hasOffscreenPass()&&!He.isHidden(this.transform.zoom)){var et=ce[He.source];(He.type==="custom"||et.length)&&this.renderLayer(this,A[He.source],He,et)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:v.showOverdrawInspector?a.Color.black:a.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=v.showOverdrawInspector,this.depthRangeFor3D=[0,1-(p._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=_.length-1;this.currentLayer>=0;this.currentLayer--){var ct=this.style._layers[_[this.currentLayer]],Pt=A[ct.source],At=J[ct.source];this._renderTileClippingMasks(ct,At),this.renderLayer(this,Pt,ct,At)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<_.length;this.currentLayer++){var Ot=this.style._layers[_[this.currentLayer]],tr=A[Ot.source],sr=(Ot.type==="symbol"?ve:ce)[Ot.source];this._renderTileClippingMasks(Ot,J[Ot.source]),this.renderLayer(this,tr,Ot,sr)}this.options.showTileBoundaries&&(a.values(this.style._layers).forEach(function(_r){_r.source&&!_r.isHidden(d.transform.zoom)&&(_r.source!==(G&&G.id)&&(G=d.style.sourceCaches[_r.source]),(!B||B.getSource().maxzoom<G.getSource().maxzoom)&&(B=G))}),B&&Nt.debug(this,B,B.getVisibleCoordinates())),this.options.showPadding&&function(_r){var Ur=_r.transform.padding;vh(_r,_r.transform.height-(Ur.top||0),3,Ef),vh(_r,Ur.bottom||0,3,Sf),gc(_r,Ur.left||0,3,Hd),gc(_r,_r.transform.width-(Ur.right||0),3,ap);var hn=_r.transform.centerPoint;(function(An,bn,Fi,$r){ft(An,bn-1,Fi-10,2,20,$r),ft(An,bn-10,Fi-1,20,2,$r)})(_r,hn.x,_r.transform.height-hn.y,Jp)}(this),this.context.setDefault()},jr.prototype.renderLayer=function(p,v,d,_){d.isHidden(this.transform.zoom)||(d.type==="background"||d.type==="custom"||_.length)&&(this.id=d.id,this.gpuTimingStart(d),Nt[d.type](p,v,d,_,this.style.placement.variableOffsets),this.gpuTimingEnd())},jr.prototype.gpuTimingStart=function(p){if(this.options.gpuTiming){var v=this.context.extTimerQuery,d=this.gpuTimers[p.id];d||(d=this.gpuTimers[p.id]={calls:0,cpuTime:0,query:v.createQueryEXT()}),d.calls++,v.beginQueryEXT(v.TIME_ELAPSED_EXT,d.query)}},jr.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var p=this.context.extTimerQuery;p.endQueryEXT(p.TIME_ELAPSED_EXT)}},jr.prototype.collectGpuTimers=function(){var p=this.gpuTimers;return this.gpuTimers={},p},jr.prototype.queryGpuTimers=function(p){var v={};for(var d in p){var _=p[d],A=this.context.extTimerQuery,M=A.getQueryObjectEXT(_.query,A.QUERY_RESULT_EXT)/1e6;A.deleteQueryEXT(_.query),v[d]=M}return v},jr.prototype.translatePosMatrix=function(p,v,d,_,A){if(!d[0]&&!d[1])return p;var M=A?_==="map"?this.transform.angle:0:_==="viewport"?-this.transform.angle:0;if(M){var R=Math.sin(M),B=Math.cos(M);d=[d[0]*B-d[1]*R,d[0]*R+d[1]*B]}var G=[A?d[0]:ga(v,d[0],this.transform.zoom),A?d[1]:ga(v,d[1],this.transform.zoom),0],J=new Float32Array(16);return a.translate(J,p,G),J},jr.prototype.saveTileTexture=function(p){var v=this._tileTextures[p.size[0]];v?v.push(p):this._tileTextures[p.size[0]]=[p]},jr.prototype.getTileTexture=function(p){var v=this._tileTextures[p];return v&&v.length>0?v.pop():null},jr.prototype.isPatternMissing=function(p){if(!p)return!1;if(!p.from||!p.to)return!0;var v=this.imageManager.getPattern(p.from.toString()),d=this.imageManager.getPattern(p.to.toString());return!v||!d},jr.prototype.useProgram=function(p,v){this.cache=this.cache||{};var d=""+p+(v?v.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[d]||(this.cache[d]=new Zp(this.context,p,oo[p],v,rp[p],this._showOverdrawInspector)),this.cache[d]},jr.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},jr.prototype.setBaseState=function(){var p=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(p.FUNC_ADD)},jr.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=a.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new a.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},jr.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var si=function(p,v){this.points=p,this.planes=v};si.fromInvProjectionMatrix=function(p,v,d){var _=Math.pow(2,d),A=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(R){return a.transformMat4([],R,p)}).map(function(R){return a.scale$1([],R,1/R[3]/v*_)}),M=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(R){var B=a.sub([],A[R[0]],A[R[1]]),G=a.sub([],A[R[2]],A[R[1]]),J=a.normalize([],a.cross([],B,G)),ce=-a.dot(J,A[R[1]]);return J.concat(ce)});return new si(A,M)};var ji=function(p,v){this.min=p,this.max=v,this.center=a.scale$2([],a.add([],this.min,this.max),.5)};ji.prototype.quadrant=function(p){for(var v=[p%2==0,p<2],d=a.clone$2(this.min),_=a.clone$2(this.max),A=0;A<v.length;A++)d[A]=v[A]?this.min[A]:this.center[A],_[A]=v[A]?this.center[A]:this.max[A];return _[2]=this.max[2],new ji(d,_)},ji.prototype.distanceX=function(p){return Math.max(Math.min(this.max[0],p[0]),this.min[0])-p[0]},ji.prototype.distanceY=function(p){return Math.max(Math.min(this.max[1],p[1]),this.min[1])-p[1]},ji.prototype.intersects=function(p){for(var v=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],d=!0,_=0;_<p.planes.length;_++){for(var A=p.planes[_],M=0,R=0;R<v.length;R++)M+=a.dot$1(A,v[R])>=0;if(M===0)return 0;M!==v.length&&(d=!1)}if(d)return 2;for(var B=0;B<3;B++){for(var G=Number.MAX_VALUE,J=-Number.MAX_VALUE,ce=0;ce<p.points.length;ce++){var ve=p.points[ce][B]-this.min[B];G=Math.min(G,ve),J=Math.max(J,ve)}if(J<0||G>this.max[B]-this.min[B])return 0}return 1};var Ua=function(p,v,d,_){if(p===void 0&&(p=0),v===void 0&&(v=0),d===void 0&&(d=0),_===void 0&&(_=0),isNaN(p)||p<0||isNaN(v)||v<0||isNaN(d)||d<0||isNaN(_)||_<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=p,this.bottom=v,this.left=d,this.right=_};Ua.prototype.interpolate=function(p,v,d){return v.top!=null&&p.top!=null&&(this.top=a.number(p.top,v.top,d)),v.bottom!=null&&p.bottom!=null&&(this.bottom=a.number(p.bottom,v.bottom,d)),v.left!=null&&p.left!=null&&(this.left=a.number(p.left,v.left,d)),v.right!=null&&p.right!=null&&(this.right=a.number(p.right,v.right,d)),this},Ua.prototype.getCenter=function(p,v){var d=a.clamp((this.left+p-this.right)/2,0,p),_=a.clamp((this.top+v-this.bottom)/2,0,v);return new a.Point(d,_)},Ua.prototype.equals=function(p){return this.top===p.top&&this.bottom===p.bottom&&this.left===p.left&&this.right===p.right},Ua.prototype.clone=function(){return new Ua(this.top,this.bottom,this.left,this.right)},Ua.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var Tn=function(p,v,d,_,A){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=A===void 0||A,this._minZoom=p||0,this._maxZoom=v||22,this._minPitch=d??0,this._maxPitch=_??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new a.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Ua,this._posMatrixCache={},this._alignedPosMatrixCache={}},ya={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};Tn.prototype.clone=function(){var p=new Tn(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return p.tileSize=this.tileSize,p.latRange=this.latRange,p.width=this.width,p.height=this.height,p._center=this._center,p.zoom=this.zoom,p.angle=this.angle,p._fov=this._fov,p._pitch=this._pitch,p._unmodified=this._unmodified,p._edgeInsets=this._edgeInsets.clone(),p._calcMatrices(),p},ya.minZoom.get=function(){return this._minZoom},ya.minZoom.set=function(p){this._minZoom!==p&&(this._minZoom=p,this.zoom=Math.max(this.zoom,p))},ya.maxZoom.get=function(){return this._maxZoom},ya.maxZoom.set=function(p){this._maxZoom!==p&&(this._maxZoom=p,this.zoom=Math.min(this.zoom,p))},ya.minPitch.get=function(){return this._minPitch},ya.minPitch.set=function(p){this._minPitch!==p&&(this._minPitch=p,this.pitch=Math.max(this.pitch,p))},ya.maxPitch.get=function(){return this._maxPitch},ya.maxPitch.set=function(p){this._maxPitch!==p&&(this._maxPitch=p,this.pitch=Math.min(this.pitch,p))},ya.renderWorldCopies.get=function(){return this._renderWorldCopies},ya.renderWorldCopies.set=function(p){p===void 0?p=!0:p===null&&(p=!1),this._renderWorldCopies=p},ya.worldSize.get=function(){return this.tileSize*this.scale},ya.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},ya.size.get=function(){return new a.Point(this.width,this.height)},ya.bearing.get=function(){return-this.angle/Math.PI*180},ya.bearing.set=function(p){var v=-a.wrap(p,-180,180)*Math.PI/180;this.angle!==v&&(this._unmodified=!1,this.angle=v,this._calcMatrices(),this.rotationMatrix=a.create$2(),a.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},ya.pitch.get=function(){return this._pitch/Math.PI*180},ya.pitch.set=function(p){var v=a.clamp(p,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==v&&(this._unmodified=!1,this._pitch=v,this._calcMatrices())},ya.fov.get=function(){return this._fov/Math.PI*180},ya.fov.set=function(p){p=Math.max(.01,Math.min(60,p)),this._fov!==p&&(this._unmodified=!1,this._fov=p/180*Math.PI,this._calcMatrices())},ya.zoom.get=function(){return this._zoom},ya.zoom.set=function(p){var v=Math.min(Math.max(p,this.minZoom),this.maxZoom);this._zoom!==v&&(this._unmodified=!1,this._zoom=v,this.scale=this.zoomScale(v),this.tileZoom=Math.floor(v),this.zoomFraction=v-this.tileZoom,this._constrain(),this._calcMatrices())},ya.center.get=function(){return this._center},ya.center.set=function(p){p.lat===this._center.lat&&p.lng===this._center.lng||(this._unmodified=!1,this._center=p,this._constrain(),this._calcMatrices())},ya.padding.get=function(){return this._edgeInsets.toJSON()},ya.padding.set=function(p){this._edgeInsets.equals(p)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,p,1),this._calcMatrices())},ya.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},Tn.prototype.isPaddingEqual=function(p){return this._edgeInsets.equals(p)},Tn.prototype.interpolatePadding=function(p,v,d){this._unmodified=!1,this._edgeInsets.interpolate(p,v,d),this._constrain(),this._calcMatrices()},Tn.prototype.coveringZoomLevel=function(p){var v=(p.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/p.tileSize));return Math.max(0,v)},Tn.prototype.getVisibleUnwrappedCoordinates=function(p){var v=[new a.UnwrappedTileID(0,p)];if(this._renderWorldCopies)for(var d=this.pointCoordinate(new a.Point(0,0)),_=this.pointCoordinate(new a.Point(this.width,0)),A=this.pointCoordinate(new a.Point(this.width,this.height)),M=this.pointCoordinate(new a.Point(0,this.height)),R=Math.floor(Math.min(d.x,_.x,A.x,M.x)),B=Math.floor(Math.max(d.x,_.x,A.x,M.x)),G=R-1;G<=B+1;G++)G!==0&&v.push(new a.UnwrappedTileID(G,p));return v},Tn.prototype.coveringTiles=function(p){var v=this.coveringZoomLevel(p),d=v;if(p.minzoom!==void 0&&v<p.minzoom)return[];p.maxzoom!==void 0&&v>p.maxzoom&&(v=p.maxzoom);var _=a.MercatorCoordinate.fromLngLat(this.center),A=Math.pow(2,v),M=[A*_.x,A*_.y,0],R=si.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,v),B=p.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(B=v);var G=function(_r){return{aabb:new ji([_r*A,0,0],[(_r+1)*A,A,0]),zoom:0,x:0,y:0,wrap:_r,fullyVisible:!1}},J=[],ce=[],ve=v,ye=p.reparseOverscaled?d:v;if(this._renderWorldCopies)for(var Oe=1;Oe<=3;Oe++)J.push(G(-Oe)),J.push(G(Oe));for(J.push(G(0));J.length>0;){var Re=J.pop(),Ge=Re.x,Me=Re.y,He=Re.fullyVisible;if(!He){var et=Re.aabb.intersects(R);if(et===0)continue;He=et===2}var ct=Re.aabb.distanceX(M),Pt=Re.aabb.distanceY(M),At=Math.max(Math.abs(ct),Math.abs(Pt));if(Re.zoom===ve||At>3+(1<<ve-Re.zoom)-2&&Re.zoom>=B)ce.push({tileID:new a.OverscaledTileID(Re.zoom===ve?ye:Re.zoom,Re.wrap,Re.zoom,Ge,Me),distanceSq:a.sqrLen([M[0]-.5-Ge,M[1]-.5-Me])});else for(var Ot=0;Ot<4;Ot++){var tr=(Ge<<1)+Ot%2,sr=(Me<<1)+(Ot>>1);J.push({aabb:Re.aabb.quadrant(Ot),zoom:Re.zoom+1,x:tr,y:sr,wrap:Re.wrap,fullyVisible:He})}}return ce.sort(function(_r,Ur){return _r.distanceSq-Ur.distanceSq}).map(function(_r){return _r.tileID})},Tn.prototype.resize=function(p,v){this.width=p,this.height=v,this.pixelsToGLUnits=[2/p,-2/v],this._constrain(),this._calcMatrices()},ya.unmodified.get=function(){return this._unmodified},Tn.prototype.zoomScale=function(p){return Math.pow(2,p)},Tn.prototype.scaleZoom=function(p){return Math.log(p)/Math.LN2},Tn.prototype.project=function(p){var v=a.clamp(p.lat,-this.maxValidLatitude,this.maxValidLatitude);return new a.Point(a.mercatorXfromLng(p.lng)*this.worldSize,a.mercatorYfromLat(v)*this.worldSize)},Tn.prototype.unproject=function(p){return new a.MercatorCoordinate(p.x/this.worldSize,p.y/this.worldSize).toLngLat()},ya.point.get=function(){return this.project(this.center)},Tn.prototype.setLocationAtPoint=function(p,v){var d=this.pointCoordinate(v),_=this.pointCoordinate(this.centerPoint),A=this.locationCoordinate(p),M=new a.MercatorCoordinate(A.x-(d.x-_.x),A.y-(d.y-_.y));this.center=this.coordinateLocation(M),this._renderWorldCopies&&(this.center=this.center.wrap())},Tn.prototype.locationPoint=function(p){return this.coordinatePoint(this.locationCoordinate(p))},Tn.prototype.pointLocation=function(p){return this.coordinateLocation(this.pointCoordinate(p))},Tn.prototype.locationCoordinate=function(p){return a.MercatorCoordinate.fromLngLat(p)},Tn.prototype.coordinateLocation=function(p){return p.toLngLat()},Tn.prototype.pointCoordinate=function(p){var v=[p.x,p.y,0,1],d=[p.x,p.y,1,1];a.transformMat4(v,v,this.pixelMatrixInverse),a.transformMat4(d,d,this.pixelMatrixInverse);var _=v[3],A=d[3],M=v[1]/_,R=d[1]/A,B=v[2]/_,G=d[2]/A,J=B===G?0:(0-B)/(G-B);return new a.MercatorCoordinate(a.number(v[0]/_,d[0]/A,J)/this.worldSize,a.number(M,R,J)/this.worldSize)},Tn.prototype.coordinatePoint=function(p){var v=[p.x*this.worldSize,p.y*this.worldSize,0,1];return a.transformMat4(v,v,this.pixelMatrix),new a.Point(v[0]/v[3],v[1]/v[3])},Tn.prototype.getBounds=function(){return new a.LngLatBounds().extend(this.pointLocation(new a.Point(0,0))).extend(this.pointLocation(new a.Point(this.width,0))).extend(this.pointLocation(new a.Point(this.width,this.height))).extend(this.pointLocation(new a.Point(0,this.height)))},Tn.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new a.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},Tn.prototype.setMaxBounds=function(p){p?(this.lngRange=[p.getWest(),p.getEast()],this.latRange=[p.getSouth(),p.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},Tn.prototype.calculatePosMatrix=function(p,v){v===void 0&&(v=!1);var d=p.key,_=v?this._alignedPosMatrixCache:this._posMatrixCache;if(_[d])return _[d];var A=p.canonical,M=this.worldSize/this.zoomScale(A.z),R=A.x+Math.pow(2,A.z)*p.wrap,B=a.identity(new Float64Array(16));return a.translate(B,B,[R*M,A.y*M,0]),a.scale(B,B,[M/a.EXTENT,M/a.EXTENT,1]),a.multiply(B,v?this.alignedProjMatrix:this.projMatrix,B),_[d]=new Float32Array(B),_[d]},Tn.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},Tn.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var p,v,d,_,A=-90,M=90,R=-180,B=180,G=this.size,J=this._unmodified;if(this.latRange){var ce=this.latRange;A=a.mercatorYfromLat(ce[1])*this.worldSize,p=(M=a.mercatorYfromLat(ce[0])*this.worldSize)-A<G.y?G.y/(M-A):0}if(this.lngRange){var ve=this.lngRange;R=a.mercatorXfromLng(ve[0])*this.worldSize,v=(B=a.mercatorXfromLng(ve[1])*this.worldSize)-R<G.x?G.x/(B-R):0}var ye=this.point,Oe=Math.max(v||0,p||0);if(Oe)return this.center=this.unproject(new a.Point(v?(B+R)/2:ye.x,p?(M+A)/2:ye.y)),this.zoom+=this.scaleZoom(Oe),this._unmodified=J,void(this._constraining=!1);if(this.latRange){var Re=ye.y,Ge=G.y/2;Re-Ge<A&&(_=A+Ge),Re+Ge>M&&(_=M-Ge)}if(this.lngRange){var Me=ye.x,He=G.x/2;Me-He<R&&(d=R+He),Me+He>B&&(d=B-He)}d===void 0&&_===void 0||(this.center=this.unproject(new a.Point(d!==void 0?d:ye.x,_!==void 0?_:ye.y))),this._unmodified=J,this._constraining=!1}},Tn.prototype._calcMatrices=function(){if(this.height){var p=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var v=Math.PI/2+this._pitch,d=this._fov*(.5+p.y/this.height),_=Math.sin(d)*this.cameraToCenterDistance/Math.sin(a.clamp(Math.PI-v-d,.01,Math.PI-.01)),A=this.point,M=A.x,R=A.y,B=1.01*(Math.cos(Math.PI/2-this._pitch)*_+this.cameraToCenterDistance),G=this.height/50,J=new Float64Array(16);a.perspective(J,this._fov,this.width/this.height,G,B),J[8]=2*-p.x/this.width,J[9]=2*p.y/this.height,a.scale(J,J,[1,-1,1]),a.translate(J,J,[0,0,-this.cameraToCenterDistance]),a.rotateX(J,J,this._pitch),a.rotateZ(J,J,this.angle),a.translate(J,J,[-M,-R,0]),this.mercatorMatrix=a.scale([],J,[this.worldSize,this.worldSize,this.worldSize]),a.scale(J,J,[1,1,a.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=J,this.invProjMatrix=a.invert([],this.projMatrix);var ce=this.width%2/2,ve=this.height%2/2,ye=Math.cos(this.angle),Oe=Math.sin(this.angle),Re=M-Math.round(M)+ye*ce+Oe*ve,Ge=R-Math.round(R)+ye*ve+Oe*ce,Me=new Float64Array(J);if(a.translate(Me,Me,[Re>.5?Re-1:Re,Ge>.5?Ge-1:Ge,0]),this.alignedProjMatrix=Me,J=a.create(),a.scale(J,J,[this.width/2,-this.height/2,1]),a.translate(J,J,[1,-1,0]),this.labelPlaneMatrix=J,J=a.create(),a.scale(J,J,[1,-1,1]),a.translate(J,J,[-1,-1,0]),a.scale(J,J,[2/this.width,2/this.height,1]),this.glCoordMatrix=J,this.pixelMatrix=a.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(J=a.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=J,this._posMatrixCache={},this._alignedPosMatrixCache={}}},Tn.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var p=this.pointCoordinate(new a.Point(0,0)),v=[p.x*this.worldSize,p.y*this.worldSize,0,1];return a.transformMat4(v,v,this.pixelMatrix)[3]/this.cameraToCenterDistance},Tn.prototype.getCameraPoint=function(){var p=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.Point(0,p))},Tn.prototype.getCameraQueryGeometry=function(p){var v=this.getCameraPoint();if(p.length===1)return[p[0],v];for(var d=v.x,_=v.y,A=v.x,M=v.y,R=0,B=p;R<B.length;R+=1){var G=B[R];d=Math.min(d,G.x),_=Math.min(_,G.y),A=Math.max(A,G.x),M=Math.max(M,G.y)}return[new a.Point(d,_),new a.Point(A,_),new a.Point(A,M),new a.Point(d,M),new a.Point(d,_)]},Object.defineProperties(Tn.prototype,ya);var Rs=function(p){var v,d,_,A;this._hashName=p&&encodeURIComponent(p),a.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(v=this._updateHashUnthrottled.bind(this),d=!1,_=null,A=function(){_=null,d&&(v(),_=setTimeout(A,300),d=!1)},function(){return d=!0,_||A(),_})};Rs.prototype.addTo=function(p){return this._map=p,a.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},Rs.prototype.remove=function(){return a.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},Rs.prototype.getHashString=function(p){var v=this._map.getCenter(),d=Math.round(100*this._map.getZoom())/100,_=Math.ceil((d*Math.LN2+Math.log(512/360/.5))/Math.LN10),A=Math.pow(10,_),M=Math.round(v.lng*A)/A,R=Math.round(v.lat*A)/A,B=this._map.getBearing(),G=this._map.getPitch(),J="";if(J+=p?"/"+M+"/"+R+"/"+d:d+"/"+R+"/"+M,(B||G)&&(J+="/"+Math.round(10*B)/10),G&&(J+="/"+Math.round(G)),this._hashName){var ce=this._hashName,ve=!1,ye=a.window.location.hash.slice(1).split("&").map(function(Oe){var Re=Oe.split("=")[0];return Re===ce?(ve=!0,Re+"="+J):Oe}).filter(function(Oe){return Oe});return ve||ye.push(ce+"="+J),"#"+ye.join("&")}return"#"+J},Rs.prototype._getCurrentHash=function(){var p,v=this,d=a.window.location.hash.replace("#","");return this._hashName?(d.split("&").map(function(_){return _.split("=")}).forEach(function(_){_[0]===v._hashName&&(p=_)}),(p&&p[1]||"").split("/")):d.split("/")},Rs.prototype._onHashChange=function(){var p=this._getCurrentHash();if(p.length>=3&&!p.some(function(d){return isNaN(d)})){var v=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(p[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+p[2],+p[1]],zoom:+p[0],bearing:v,pitch:+(p[4]||0)}),!0}return!1},Rs.prototype._updateHashUnthrottled=function(){var p=a.window.location.href.replace(/(#.+)?$/,this.getHashString());try{a.window.history.replaceState(a.window.history.state,null,p)}catch{}};var Ls={linearity:.3,easing:a.bezier(0,0,.3,1)},$l=a.extend({deceleration:2500,maxSpeed:1400},Ls),mh=a.extend({deceleration:20,maxSpeed:1400},Ls),Af=a.extend({deceleration:1e3,maxSpeed:360},Ls),op=a.extend({deceleration:1e3,maxSpeed:90},Ls),yc=function(p){this._map=p,this.clear()};function ua(p,v){(!p.duration||p.duration<v.duration)&&(p.duration=v.duration,p.easing=v.easing)}function El(p,v,d){var _=d.maxSpeed,A=d.linearity,M=d.deceleration,R=a.clamp(p*A/(v/1e3),-_,_),B=Math.abs(R)/(M*A);return{easing:d.easing,duration:1e3*B,amount:R*(B/2)}}yc.prototype.clear=function(){this._inertiaBuffer=[]},yc.prototype.record=function(p){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:a.browser.now(),settings:p})},yc.prototype._drainInertiaBuffer=function(){for(var p=this._inertiaBuffer,v=a.browser.now();p.length>0&&v-p[0].time>160;)p.shift()},yc.prototype._onMoveEnd=function(p){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var v={zoom:0,bearing:0,pitch:0,pan:new a.Point(0,0),pinchAround:void 0,around:void 0},d=0,_=this._inertiaBuffer;d<_.length;d+=1){var A=_[d].settings;v.zoom+=A.zoomDelta||0,v.bearing+=A.bearingDelta||0,v.pitch+=A.pitchDelta||0,A.panDelta&&v.pan._add(A.panDelta),A.around&&(v.around=A.around),A.pinchAround&&(v.pinchAround=A.pinchAround)}var M=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,R={};if(v.pan.mag()){var B=El(v.pan.mag(),M,a.extend({},$l,p||{}));R.offset=v.pan.mult(B.amount/v.pan.mag()),R.center=this._map.transform.center,ua(R,B)}if(v.zoom){var G=El(v.zoom,M,mh);R.zoom=this._map.transform.zoom+G.amount,ua(R,G)}if(v.bearing){var J=El(v.bearing,M,Af);R.bearing=this._map.transform.bearing+a.clamp(J.amount,-179,179),ua(R,J)}if(v.pitch){var ce=El(v.pitch,M,op);R.pitch=this._map.transform.pitch+ce.amount,ua(R,ce)}if(R.zoom||R.bearing){var ve=v.pinchAround===void 0?v.around:v.pinchAround;R.around=ve?this._map.unproject(ve):this._map.getCenter()}return this.clear(),a.extend(R,{noMoveStart:!0})}};var $a=function(p){function v(_,A,M,R){R===void 0&&(R={});var B=c.mousePos(A.getCanvasContainer(),M),G=A.unproject(B);p.call(this,_,a.extend({point:B,lngLat:G,originalEvent:M},R)),this._defaultPrevented=!1,this.target=A}p&&(v.__proto__=p),(v.prototype=Object.create(p&&p.prototype)).constructor=v;var d={defaultPrevented:{configurable:!0}};return v.prototype.preventDefault=function(){this._defaultPrevented=!0},d.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(v.prototype,d),v}(a.Event),_c=function(p){function v(_,A,M){var R=_==="touchend"?M.changedTouches:M.touches,B=c.touchPos(A.getCanvasContainer(),R),G=B.map(function(ve){return A.unproject(ve)}),J=B.reduce(function(ve,ye,Oe,Re){return ve.add(ye.div(Re.length))},new a.Point(0,0)),ce=A.unproject(J);p.call(this,_,{points:B,point:J,lngLats:G,lngLat:ce,originalEvent:M}),this._defaultPrevented=!1}p&&(v.__proto__=p),(v.prototype=Object.create(p&&p.prototype)).constructor=v;var d={defaultPrevented:{configurable:!0}};return v.prototype.preventDefault=function(){this._defaultPrevented=!0},d.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(v.prototype,d),v}(a.Event),gh=function(p){function v(_,A,M){p.call(this,_,{originalEvent:M}),this._defaultPrevented=!1}p&&(v.__proto__=p),(v.prototype=Object.create(p&&p.prototype)).constructor=v;var d={defaultPrevented:{configurable:!0}};return v.prototype.preventDefault=function(){this._defaultPrevented=!0},d.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(v.prototype,d),v}(a.Event),la=function(p,v){this._map=p,this._clickTolerance=v.clickTolerance};la.prototype.reset=function(){delete this._mousedownPos},la.prototype.wheel=function(p){return this._firePreventable(new gh(p.type,this._map,p))},la.prototype.mousedown=function(p,v){return this._mousedownPos=v,this._firePreventable(new $a(p.type,this._map,p))},la.prototype.mouseup=function(p){this._map.fire(new $a(p.type,this._map,p))},la.prototype.click=function(p,v){this._mousedownPos&&this._mousedownPos.dist(v)>=this._clickTolerance||this._map.fire(new $a(p.type,this._map,p))},la.prototype.dblclick=function(p){return this._firePreventable(new $a(p.type,this._map,p))},la.prototype.mouseover=function(p){this._map.fire(new $a(p.type,this._map,p))},la.prototype.mouseout=function(p){this._map.fire(new $a(p.type,this._map,p))},la.prototype.touchstart=function(p){return this._firePreventable(new _c(p.type,this._map,p))},la.prototype.touchmove=function(p){this._map.fire(new _c(p.type,this._map,p))},la.prototype.touchend=function(p){this._map.fire(new _c(p.type,this._map,p))},la.prototype.touchcancel=function(p){this._map.fire(new _c(p.type,this._map,p))},la.prototype._firePreventable=function(p){if(this._map.fire(p),p.defaultPrevented)return{}},la.prototype.isEnabled=function(){return!0},la.prototype.isActive=function(){return!1},la.prototype.enable=function(){},la.prototype.disable=function(){};var Jr=function(p){this._map=p};Jr.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},Jr.prototype.mousemove=function(p){this._map.fire(new $a(p.type,this._map,p))},Jr.prototype.mousedown=function(){this._delayContextMenu=!0},Jr.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new $a("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},Jr.prototype.contextmenu=function(p){this._delayContextMenu?this._contextMenuEvent=p:this._map.fire(new $a(p.type,this._map,p)),this._map.listens("contextmenu")&&p.preventDefault()},Jr.prototype.isEnabled=function(){return!0},Jr.prototype.isActive=function(){return!1},Jr.prototype.enable=function(){},Jr.prototype.disable=function(){};var rs=function(p,v){this._map=p,this._el=p.getCanvasContainer(),this._container=p.getContainer(),this._clickTolerance=v.clickTolerance||1};function Tu(p,v){for(var d={},_=0;_<p.length;_++)d[p[_].identifier]=v[_];return d}rs.prototype.isEnabled=function(){return!!this._enabled},rs.prototype.isActive=function(){return!!this._active},rs.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},rs.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},rs.prototype.mousedown=function(p,v){this.isEnabled()&&p.shiftKey&&p.button===0&&(c.disableDrag(),this._startPos=this._lastPos=v,this._active=!0)},rs.prototype.mousemoveWindow=function(p,v){if(this._active){var d=v;if(!(this._lastPos.equals(d)||!this._box&&d.dist(this._startPos)<this._clickTolerance)){var _=this._startPos;this._lastPos=d,this._box||(this._box=c.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",p));var A=Math.min(_.x,d.x),M=Math.max(_.x,d.x),R=Math.min(_.y,d.y),B=Math.max(_.y,d.y);c.setTransform(this._box,"translate("+A+"px,"+R+"px)"),this._box.style.width=M-A+"px",this._box.style.height=B-R+"px"}}},rs.prototype.mouseupWindow=function(p,v){var d=this;if(this._active&&p.button===0){var _=this._startPos,A=v;if(this.reset(),c.suppressClick(),_.x!==A.x||_.y!==A.y)return this._map.fire(new a.Event("boxzoomend",{originalEvent:p})),{cameraAnimation:function(M){return M.fitScreenCoordinates(_,A,d._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",p)}},rs.prototype.keydown=function(p){this._active&&p.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",p))},rs.prototype.blur=function(){this.reset()},rs.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(c.remove(this._box),this._box=null),c.enableDrag(),delete this._startPos,delete this._lastPos},rs.prototype._fireEvent=function(p,v){return this._map.fire(new a.Event(p,{originalEvent:v}))};var Sl=function(p){this.reset(),this.numTouches=p.numTouches};Sl.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},Sl.prototype.touchstart=function(p,v,d){(this.centroid||d.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=p.timeStamp),d.length===this.numTouches&&(this.centroid=function(_){for(var A=new a.Point(0,0),M=0,R=_;M<R.length;M+=1)A._add(R[M]);return A.div(_.length)}(v),this.touches=Tu(d,v)))},Sl.prototype.touchmove=function(p,v,d){if(!this.aborted&&this.centroid){var _=Tu(d,v);for(var A in this.touches){var M=_[A];(!M||M.dist(this.touches[A])>30)&&(this.aborted=!0)}}},Sl.prototype.touchend=function(p,v,d){if((!this.centroid||p.timeStamp-this.startTime>500)&&(this.aborted=!0),d.length===0){var _=!this.aborted&&this.centroid;if(this.reset(),_)return _}};var hu=function(p){this.singleTap=new Sl(p),this.numTaps=p.numTaps,this.reset()};hu.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},hu.prototype.touchstart=function(p,v,d){this.singleTap.touchstart(p,v,d)},hu.prototype.touchmove=function(p,v,d){this.singleTap.touchmove(p,v,d)},hu.prototype.touchend=function(p,v,d){var _=this.singleTap.touchend(p,v,d);if(_){var A=p.timeStamp-this.lastTime<500,M=!this.lastTap||this.lastTap.dist(_)<30;if(A&&M||this.reset(),this.count++,this.lastTime=p.timeStamp,this.lastTap=_,this.count===this.numTaps)return this.reset(),_}};var ns=function(){this._zoomIn=new hu({numTouches:1,numTaps:2}),this._zoomOut=new hu({numTouches:2,numTaps:1}),this.reset()};ns.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},ns.prototype.touchstart=function(p,v,d){this._zoomIn.touchstart(p,v,d),this._zoomOut.touchstart(p,v,d)},ns.prototype.touchmove=function(p,v,d){this._zoomIn.touchmove(p,v,d),this._zoomOut.touchmove(p,v,d)},ns.prototype.touchend=function(p,v,d){var _=this,A=this._zoomIn.touchend(p,v,d),M=this._zoomOut.touchend(p,v,d);return A?(this._active=!0,p.preventDefault(),setTimeout(function(){return _.reset()},0),{cameraAnimation:function(R){return R.easeTo({duration:300,zoom:R.getZoom()+1,around:R.unproject(A)},{originalEvent:p})}}):M?(this._active=!0,p.preventDefault(),setTimeout(function(){return _.reset()},0),{cameraAnimation:function(R){return R.easeTo({duration:300,zoom:R.getZoom()-1,around:R.unproject(M)},{originalEvent:p})}}):void 0},ns.prototype.touchcancel=function(){this.reset()},ns.prototype.enable=function(){this._enabled=!0},ns.prototype.disable=function(){this._enabled=!1,this.reset()},ns.prototype.isEnabled=function(){return this._enabled},ns.prototype.isActive=function(){return this._active};var yh={0:1,2:2},Nr=function(p){this.reset(),this._clickTolerance=p.clickTolerance||1};Nr.prototype.blur=function(){this.reset()},Nr.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},Nr.prototype._correctButton=function(p,v){return!1},Nr.prototype._move=function(p,v){return{}},Nr.prototype.mousedown=function(p,v){if(!this._lastPoint){var d=c.mouseButton(p);this._correctButton(p,d)&&(this._lastPoint=v,this._eventButton=d)}},Nr.prototype.mousemoveWindow=function(p,v){var d=this._lastPoint;if(d){if(p.preventDefault(),function(_,A){var M=yh[A];return _.buttons===void 0||(_.buttons&M)!==M}(p,this._eventButton))this.reset();else if(this._moved||!(v.dist(d)<this._clickTolerance))return this._moved=!0,this._lastPoint=v,this._move(d,v)}},Nr.prototype.mouseupWindow=function(p){this._lastPoint&&c.mouseButton(p)===this._eventButton&&(this._moved&&c.suppressClick(),this.reset())},Nr.prototype.enable=function(){this._enabled=!0},Nr.prototype.disable=function(){this._enabled=!1,this.reset()},Nr.prototype.isEnabled=function(){return this._enabled},Nr.prototype.isActive=function(){return this._active};var Ju=function(p){function v(){p.apply(this,arguments)}return p&&(v.__proto__=p),(v.prototype=Object.create(p&&p.prototype)).constructor=v,v.prototype.mousedown=function(d,_){p.prototype.mousedown.call(this,d,_),this._lastPoint&&(this._active=!0)},v.prototype._correctButton=function(d,_){return _===0&&!d.ctrlKey},v.prototype._move=function(d,_){return{around:_,panDelta:_.sub(d)}},v}(Nr),xo=function(p){function v(){p.apply(this,arguments)}return p&&(v.__proto__=p),(v.prototype=Object.create(p&&p.prototype)).constructor=v,v.prototype._correctButton=function(d,_){return _===0&&d.ctrlKey||_===2},v.prototype._move=function(d,_){var A=.8*(_.x-d.x);if(A)return this._active=!0,{bearingDelta:A}},v.prototype.contextmenu=function(d){d.preventDefault()},v}(Nr),xc=function(p){function v(){p.apply(this,arguments)}return p&&(v.__proto__=p),(v.prototype=Object.create(p&&p.prototype)).constructor=v,v.prototype._correctButton=function(d,_){return _===0&&d.ctrlKey||_===2},v.prototype._move=function(d,_){var A=-.5*(_.y-d.y);if(A)return this._active=!0,{pitchDelta:A}},v.prototype.contextmenu=function(d){d.preventDefault()},v}(Nr),Wo=function(p){this._minTouches=1,this._clickTolerance=p.clickTolerance||1,this.reset()};Wo.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new a.Point(0,0)},Wo.prototype.touchstart=function(p,v,d){return this._calculateTransform(p,v,d)},Wo.prototype.touchmove=function(p,v,d){if(this._active&&!(d.length<this._minTouches))return p.preventDefault(),this._calculateTransform(p,v,d)},Wo.prototype.touchend=function(p,v,d){this._calculateTransform(p,v,d),this._active&&d.length<this._minTouches&&this.reset()},Wo.prototype.touchcancel=function(){this.reset()},Wo.prototype._calculateTransform=function(p,v,d){d.length>0&&(this._active=!0);var _=Tu(d,v),A=new a.Point(0,0),M=new a.Point(0,0),R=0;for(var B in _){var G=_[B],J=this._touches[B];J&&(A._add(G),M._add(G.sub(J)),R++,_[B]=G)}if(this._touches=_,!(R<this._minTouches)&&M.mag()){var ce=M.div(R);if(this._sum._add(ce),!(this._sum.mag()<this._clickTolerance))return{around:A.div(R),panDelta:ce}}},Wo.prototype.enable=function(){this._enabled=!0},Wo.prototype.disable=function(){this._enabled=!1,this.reset()},Wo.prototype.isEnabled=function(){return this._enabled},Wo.prototype.isActive=function(){return this._active};var fo=function(){this.reset()};function _h(p,v,d){for(var _=0;_<p.length;_++)if(p[_].identifier===d)return v[_]}function xh(p,v){return Math.log(p/v)/Math.LN2}fo.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},fo.prototype._start=function(p){},fo.prototype._move=function(p,v,d){return{}},fo.prototype.touchstart=function(p,v,d){this._firstTwoTouches||d.length<2||(this._firstTwoTouches=[d[0].identifier,d[1].identifier],this._start([v[0],v[1]]))},fo.prototype.touchmove=function(p,v,d){if(this._firstTwoTouches){p.preventDefault();var _=this._firstTwoTouches,A=_[1],M=_h(d,v,_[0]),R=_h(d,v,A);if(M&&R){var B=this._aroundCenter?null:M.add(R).div(2);return this._move([M,R],B,p)}}},fo.prototype.touchend=function(p,v,d){if(this._firstTwoTouches){var _=this._firstTwoTouches,A=_[1],M=_h(d,v,_[0]),R=_h(d,v,A);M&&R||(this._active&&c.suppressClick(),this.reset())}},fo.prototype.touchcancel=function(){this.reset()},fo.prototype.enable=function(p){this._enabled=!0,this._aroundCenter=!!p&&p.around==="center"},fo.prototype.disable=function(){this._enabled=!1,this.reset()},fo.prototype.isEnabled=function(){return this._enabled},fo.prototype.isActive=function(){return this._active};var Ks=function(p){function v(){p.apply(this,arguments)}return p&&(v.__proto__=p),(v.prototype=Object.create(p&&p.prototype)).constructor=v,v.prototype.reset=function(){p.prototype.reset.call(this),delete this._distance,delete this._startDistance},v.prototype._start=function(d){this._startDistance=this._distance=d[0].dist(d[1])},v.prototype._move=function(d,_){var A=this._distance;if(this._distance=d[0].dist(d[1]),this._active||!(Math.abs(xh(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:xh(this._distance,A),pinchAround:_}},v}(fo);function Cu(p,v){return 180*p.angleWith(v)/Math.PI}var bh=function(p){function v(){p.apply(this,arguments)}return p&&(v.__proto__=p),(v.prototype=Object.create(p&&p.prototype)).constructor=v,v.prototype.reset=function(){p.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},v.prototype._start=function(d){this._startVector=this._vector=d[0].sub(d[1]),this._minDiameter=d[0].dist(d[1])},v.prototype._move=function(d,_){var A=this._vector;if(this._vector=d[0].sub(d[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Cu(this._vector,A),pinchAround:_}},v.prototype._isBelowThreshold=function(d){this._minDiameter=Math.min(this._minDiameter,d.mag());var _=25/(Math.PI*this._minDiameter)*360,A=Cu(d,this._startVector);return Math.abs(A)<_},v}(fo);function Kc(p){return Math.abs(p.y)>Math.abs(p.x)}var wh=function(p){function v(){p.apply(this,arguments)}return p&&(v.__proto__=p),(v.prototype=Object.create(p&&p.prototype)).constructor=v,v.prototype.reset=function(){p.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},v.prototype._start=function(d){this._lastPoints=d,Kc(d[0].sub(d[1]))&&(this._valid=!1)},v.prototype._move=function(d,_,A){var M=d[0].sub(this._lastPoints[0]),R=d[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(M,R,A.timeStamp),this._valid)return this._lastPoints=d,this._active=!0,{pitchDelta:(M.y+R.y)/2*-.5}},v.prototype.gestureBeginsVertically=function(d,_,A){if(this._valid!==void 0)return this._valid;var M=d.mag()>=2,R=_.mag()>=2;if(M||R){if(!M||!R)return this._firstMove===void 0&&(this._firstMove=A),A-this._firstMove<100&&void 0;var B=d.y>0==_.y>0;return Kc(d)&&Kc(_)&&B}},v}(fo),Eh={panStep:100,bearingStep:15,pitchStep:10},pu=function(){var p=Eh;this._panStep=p.panStep,this._bearingStep=p.bearingStep,this._pitchStep=p.pitchStep,this._rotationDisabled=!1};function Qs(p){return p*(2-p)}pu.prototype.blur=function(){this.reset()},pu.prototype.reset=function(){this._active=!1},pu.prototype.keydown=function(p){var v=this;if(!(p.altKey||p.ctrlKey||p.metaKey)){var d=0,_=0,A=0,M=0,R=0;switch(p.keyCode){case 61:case 107:case 171:case 187:d=1;break;case 189:case 109:case 173:d=-1;break;case 37:p.shiftKey?_=-1:(p.preventDefault(),M=-1);break;case 39:p.shiftKey?_=1:(p.preventDefault(),M=1);break;case 38:p.shiftKey?A=1:(p.preventDefault(),R=-1);break;case 40:p.shiftKey?A=-1:(p.preventDefault(),R=1);break;default:return}return this._rotationDisabled&&(_=0,A=0),{cameraAnimation:function(B){var G=B.getZoom();B.easeTo({duration:300,easeId:"keyboardHandler",easing:Qs,zoom:d?Math.round(G)+d*(p.shiftKey?2:1):G,bearing:B.getBearing()+_*v._bearingStep,pitch:B.getPitch()+A*v._pitchStep,offset:[-M*v._panStep,-R*v._panStep],center:B.getCenter()},{originalEvent:p})}}}},pu.prototype.enable=function(){this._enabled=!0},pu.prototype.disable=function(){this._enabled=!1,this.reset()},pu.prototype.isEnabled=function(){return this._enabled},pu.prototype.isActive=function(){return this._active},pu.prototype.disableRotation=function(){this._rotationDisabled=!0},pu.prototype.enableRotation=function(){this._rotationDisabled=!1};var Bn=function(p,v){this._map=p,this._el=p.getCanvasContainer(),this._handler=v,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,a.bindAll(["_onTimeout"],this)};Bn.prototype.setZoomRate=function(p){this._defaultZoomRate=p},Bn.prototype.setWheelZoomRate=function(p){this._wheelZoomRate=p},Bn.prototype.isEnabled=function(){return!!this._enabled},Bn.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},Bn.prototype.isZooming=function(){return!!this._zooming},Bn.prototype.enable=function(p){this.isEnabled()||(this._enabled=!0,this._aroundCenter=p&&p.around==="center")},Bn.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Bn.prototype.wheel=function(p){if(this.isEnabled()){var v=p.deltaMode===a.window.WheelEvent.DOM_DELTA_LINE?40*p.deltaY:p.deltaY,d=a.browser.now(),_=d-(this._lastWheelEventTime||0);this._lastWheelEventTime=d,v!==0&&v%4.000244140625==0?this._type="wheel":v!==0&&Math.abs(v)<4?this._type="trackpad":_>400?(this._type=null,this._lastValue=v,this._timeout=setTimeout(this._onTimeout,40,p)):this._type||(this._type=Math.abs(_*v)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,v+=this._lastValue)),p.shiftKey&&v&&(v/=4),this._type&&(this._lastWheelEvent=p,this._delta-=v,this._active||this._start(p)),p.preventDefault()}},Bn.prototype._onTimeout=function(p){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(p)},Bn.prototype._start=function(p){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var v=c.mousePos(this._el,p);this._around=a.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(v)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},Bn.prototype.renderFrame=function(){var p=this;if(this._frameId&&(this._frameId=null,this.isActive())){var v=this._map.transform;if(this._delta!==0){var d=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,_=2/(1+Math.exp(-Math.abs(this._delta*d)));this._delta<0&&_!==0&&(_=1/_);var A=typeof this._targetZoom=="number"?v.zoomScale(this._targetZoom):v.scale;this._targetZoom=Math.min(v.maxZoom,Math.max(v.minZoom,v.scaleZoom(A*_))),this._type==="wheel"&&(this._startZoom=v.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var M,R=typeof this._targetZoom=="number"?this._targetZoom:v.zoom,B=this._startZoom,G=this._easing,J=!1;if(this._type==="wheel"&&B&&G){var ce=Math.min((a.browser.now()-this._lastWheelEventTime)/200,1),ve=G(ce);M=a.number(B,R,ve),ce<1?this._frameId||(this._frameId=!0):J=!0}else M=R,J=!0;return this._active=!0,J&&(this._active=!1,this._finishTimeout=setTimeout(function(){p._zooming=!1,p._handler._triggerRenderFrame(),delete p._targetZoom,delete p._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!J,zoomDelta:M-v.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},Bn.prototype._smoothOutEasing=function(p){var v=a.ease;if(this._prevEase){var d=this._prevEase,_=(a.browser.now()-d.start)/d.duration,A=d.easing(_+.01)-d.easing(_),M=.27/Math.sqrt(A*A+1e-4)*.01,R=Math.sqrt(.0729-M*M);v=a.bezier(M,R,.25,1)}return this._prevEase={start:a.browser.now(),duration:p,easing:v},v},Bn.prototype.blur=function(){this.reset()},Bn.prototype.reset=function(){this._active=!1};var Ga=function(p,v){this._clickZoom=p,this._tapZoom=v};Ga.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},Ga.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},Ga.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},Ga.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var du=function(){this.reset()};du.prototype.reset=function(){this._active=!1},du.prototype.blur=function(){this.reset()},du.prototype.dblclick=function(p,v){return p.preventDefault(),{cameraAnimation:function(d){d.easeTo({duration:300,zoom:d.getZoom()+(p.shiftKey?-1:1),around:d.unproject(v)},{originalEvent:p})}}},du.prototype.enable=function(){this._enabled=!0},du.prototype.disable=function(){this._enabled=!1,this.reset()},du.prototype.isEnabled=function(){return this._enabled},du.prototype.isActive=function(){return this._active};var is=function(){this._tap=new hu({numTouches:1,numTaps:1}),this.reset()};is.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},is.prototype.touchstart=function(p,v,d){this._swipePoint||(this._tapTime&&p.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?d.length>0&&(this._swipePoint=v[0],this._swipeTouch=d[0].identifier):this._tap.touchstart(p,v,d))},is.prototype.touchmove=function(p,v,d){if(this._tapTime){if(this._swipePoint){if(d[0].identifier!==this._swipeTouch)return;var _=v[0],A=_.y-this._swipePoint.y;return this._swipePoint=_,p.preventDefault(),this._active=!0,{zoomDelta:A/128}}}else this._tap.touchmove(p,v,d)},is.prototype.touchend=function(p,v,d){this._tapTime?this._swipePoint&&d.length===0&&this.reset():this._tap.touchend(p,v,d)&&(this._tapTime=p.timeStamp)},is.prototype.touchcancel=function(){this.reset()},is.prototype.enable=function(){this._enabled=!0},is.prototype.disable=function(){this._enabled=!1,this.reset()},is.prototype.isEnabled=function(){return this._enabled},is.prototype.isActive=function(){return this._active};var el=function(p,v,d){this._el=p,this._mousePan=v,this._touchPan=d};el.prototype.enable=function(p){this._inertiaOptions=p||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},el.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},el.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},el.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var bc=function(p,v,d){this._pitchWithRotate=p.pitchWithRotate,this._mouseRotate=v,this._mousePitch=d};bc.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},bc.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},bc.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},bc.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var No=function(p,v,d,_){this._el=p,this._touchZoom=v,this._touchRotate=d,this._tapDragZoom=_,this._rotationDisabled=!1,this._enabled=!0};No.prototype.enable=function(p){this._touchZoom.enable(p),this._rotationDisabled||this._touchRotate.enable(p),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},No.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},No.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},No.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},No.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},No.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var ho=function(p){return p.zoom||p.drag||p.pitch||p.rotate},wc=function(p){function v(){p.apply(this,arguments)}return p&&(v.__proto__=p),(v.prototype=Object.create(p&&p.prototype)).constructor=v,v}(a.Event);function _n(p){return p.panDelta&&p.panDelta.mag()||p.zoomDelta||p.bearingDelta||p.pitchDelta}var on=function(p,v){this._map=p,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new yc(p),this._bearingSnap=v.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(v),a.bindAll(["handleEvent","handleWindowEvent"],this);var d=this._el;this._listeners=[[d,"touchstart",{passive:!0}],[d,"touchmove",{passive:!1}],[d,"touchend",void 0],[d,"touchcancel",void 0],[d,"mousedown",void 0],[d,"mousemove",void 0],[d,"mouseup",void 0],[a.window.document,"mousemove",{capture:!0}],[a.window.document,"mouseup",void 0],[d,"mouseover",void 0],[d,"mouseout",void 0],[d,"dblclick",void 0],[d,"click",void 0],[d,"keydown",{capture:!1}],[d,"keyup",void 0],[d,"wheel",{passive:!1}],[d,"contextmenu",void 0],[a.window,"blur",void 0]];for(var _=0,A=this._listeners;_<A.length;_+=1){var M=A[_],R=M[0];c.addEventListener(R,M[1],R===a.window.document?this.handleWindowEvent:this.handleEvent,M[2])}};on.prototype.destroy=function(){for(var p=0,v=this._listeners;p<v.length;p+=1){var d=v[p],_=d[0];c.removeEventListener(_,d[1],_===a.window.document?this.handleWindowEvent:this.handleEvent,d[2])}},on.prototype._addDefaultHandlers=function(p){var v=this._map,d=v.getCanvasContainer();this._add("mapEvent",new la(v,p));var _=v.boxZoom=new rs(v,p);this._add("boxZoom",_);var A=new ns,M=new du;v.doubleClickZoom=new Ga(M,A),this._add("tapZoom",A),this._add("clickZoom",M);var R=new is;this._add("tapDragZoom",R);var B=v.touchPitch=new wh;this._add("touchPitch",B);var G=new xo(p),J=new xc(p);v.dragRotate=new bc(p,G,J),this._add("mouseRotate",G,["mousePitch"]),this._add("mousePitch",J,["mouseRotate"]);var ce=new Ju(p),ve=new Wo(p);v.dragPan=new el(d,ce,ve),this._add("mousePan",ce),this._add("touchPan",ve,["touchZoom","touchRotate"]);var ye=new bh,Oe=new Ks;v.touchZoomRotate=new No(d,Oe,ye,R),this._add("touchRotate",ye,["touchPan","touchZoom"]),this._add("touchZoom",Oe,["touchPan","touchRotate"]);var Re=v.scrollZoom=new Bn(v,this);this._add("scrollZoom",Re,["mousePan"]);var Ge=v.keyboard=new pu;this._add("keyboard",Ge),this._add("blockableMapEvent",new Jr(v));for(var Me=0,He=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];Me<He.length;Me+=1){var et=He[Me];p.interactive&&p[et]&&v[et].enable(p[et])}},on.prototype._add=function(p,v,d){this._handlers.push({handlerName:p,handler:v,allowed:d}),this._handlersById[p]=v},on.prototype.stop=function(p){if(!this._updatingCamera){for(var v=0,d=this._handlers;v<d.length;v+=1)d[v].handler.reset();this._inertia.clear(),this._fireEvents({},{},p),this._changes=[]}},on.prototype.isActive=function(){for(var p=0,v=this._handlers;p<v.length;p+=1)if(v[p].handler.isActive())return!0;return!1},on.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},on.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},on.prototype.isMoving=function(){return!!ho(this._eventsInProgress)||this.isZooming()},on.prototype._blockedByActive=function(p,v,d){for(var _ in p)if(_!==d&&(!v||v.indexOf(_)<0))return!0;return!1},on.prototype.handleWindowEvent=function(p){this.handleEvent(p,p.type+"Window")},on.prototype._getMapTouches=function(p){for(var v=[],d=0,_=p;d<_.length;d+=1){var A=_[d];this._el.contains(A.target)&&v.push(A)}return v},on.prototype.handleEvent=function(p,v){this._updatingCamera=!0;for(var d=p.type==="renderFrame"?void 0:p,_={needsRenderFrame:!1},A={},M={},R=p.touches?this._getMapTouches(p.touches):void 0,B=R?c.touchPos(this._el,R):c.mousePos(this._el,p),G=0,J=this._handlers;G<J.length;G+=1){var ce=J[G],ve=ce.handlerName,ye=ce.handler,Oe=ce.allowed;if(ye.isEnabled()){var Re=void 0;this._blockedByActive(M,Oe,ve)?ye.reset():ye[v||p.type]&&(Re=ye[v||p.type](p,B,R),this.mergeHandlerResult(_,A,Re,ve,d),Re&&Re.needsRenderFrame&&this._triggerRenderFrame()),(Re||ye.isActive())&&(M[ve]=ye)}}var Ge={};for(var Me in this._previousActiveHandlers)M[Me]||(Ge[Me]=d);this._previousActiveHandlers=M,(Object.keys(Ge).length||_n(_))&&(this._changes.push([_,A,Ge]),this._triggerRenderFrame()),(Object.keys(M).length||_n(_))&&this._map._stop(!0),this._updatingCamera=!1;var He=_.cameraAnimation;He&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],He(this._map))},on.prototype.mergeHandlerResult=function(p,v,d,_,A){if(d){a.extend(p,d);var M={handlerName:_,originalEvent:d.originalEvent||A};d.zoomDelta!==void 0&&(v.zoom=M),d.panDelta!==void 0&&(v.drag=M),d.pitchDelta!==void 0&&(v.pitch=M),d.bearingDelta!==void 0&&(v.rotate=M)}},on.prototype._applyChanges=function(){for(var p={},v={},d={},_=0,A=this._changes;_<A.length;_+=1){var M=A[_],R=M[0],B=M[1],G=M[2];R.panDelta&&(p.panDelta=(p.panDelta||new a.Point(0,0))._add(R.panDelta)),R.zoomDelta&&(p.zoomDelta=(p.zoomDelta||0)+R.zoomDelta),R.bearingDelta&&(p.bearingDelta=(p.bearingDelta||0)+R.bearingDelta),R.pitchDelta&&(p.pitchDelta=(p.pitchDelta||0)+R.pitchDelta),R.around!==void 0&&(p.around=R.around),R.pinchAround!==void 0&&(p.pinchAround=R.pinchAround),R.noInertia&&(p.noInertia=R.noInertia),a.extend(v,B),a.extend(d,G)}this._updateMapTransform(p,v,d),this._changes=[]},on.prototype._updateMapTransform=function(p,v,d){var _=this._map,A=_.transform;if(!_n(p))return this._fireEvents(v,d,!0);var M=p.panDelta,R=p.zoomDelta,B=p.bearingDelta,G=p.pitchDelta,J=p.around,ce=p.pinchAround;ce!==void 0&&(J=ce),_._stop(!0),J=J||_.transform.centerPoint;var ve=A.pointLocation(M?J.sub(M):J);B&&(A.bearing+=B),G&&(A.pitch+=G),R&&(A.zoom+=R),A.setLocationAtPoint(ve,J),this._map._update(),p.noInertia||this._inertia.record(p),this._fireEvents(v,d,!0)},on.prototype._fireEvents=function(p,v,d){var _=this,A=ho(this._eventsInProgress),M=ho(p),R={};for(var B in p)this._eventsInProgress[B]||(R[B+"start"]=p[B].originalEvent),this._eventsInProgress[B]=p[B];for(var G in!A&&M&&this._fireEvent("movestart",M.originalEvent),R)this._fireEvent(G,R[G]);for(var J in M&&this._fireEvent("move",M.originalEvent),p)this._fireEvent(J,p[J].originalEvent);var ce,ve={};for(var ye in this._eventsInProgress){var Oe=this._eventsInProgress[ye],Re=Oe.handlerName,Ge=Oe.originalEvent;this._handlersById[Re].isActive()||(delete this._eventsInProgress[ye],ve[ye+"end"]=ce=v[Re]||Ge)}for(var Me in ve)this._fireEvent(Me,ve[Me]);var He=ho(this._eventsInProgress);if(d&&(A||M)&&!He){this._updatingCamera=!0;var et=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),ct=function(Pt){return Pt!==0&&-_._bearingSnap<Pt&&Pt<_._bearingSnap};et?(ct(et.bearing||this._map.getBearing())&&(et.bearing=0),this._map.easeTo(et,{originalEvent:ce})):(this._map.fire(new a.Event("moveend",{originalEvent:ce})),ct(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},on.prototype._fireEvent=function(p,v){this._map.fire(new a.Event(p,v?{originalEvent:v}:{}))},on.prototype._requestFrame=function(){var p=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(v){delete p._frameId,p.handleEvent(new wc("renderFrame",{timeStamp:v})),p._applyChanges()})},on.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var Gl=function(p){function v(d,_){p.call(this),this._moving=!1,this._zooming=!1,this.transform=d,this._bearingSnap=_.bearingSnap,a.bindAll(["_renderFrameCallback"],this)}return p&&(v.__proto__=p),(v.prototype=Object.create(p&&p.prototype)).constructor=v,v.prototype.getCenter=function(){return new a.LngLat(this.transform.center.lng,this.transform.center.lat)},v.prototype.setCenter=function(d,_){return this.jumpTo({center:d},_)},v.prototype.panBy=function(d,_,A){return d=a.Point.convert(d).mult(-1),this.panTo(this.transform.center,a.extend({offset:d},_),A)},v.prototype.panTo=function(d,_,A){return this.easeTo(a.extend({center:d},_),A)},v.prototype.getZoom=function(){return this.transform.zoom},v.prototype.setZoom=function(d,_){return this.jumpTo({zoom:d},_),this},v.prototype.zoomTo=function(d,_,A){return this.easeTo(a.extend({zoom:d},_),A)},v.prototype.zoomIn=function(d,_){return this.zoomTo(this.getZoom()+1,d,_),this},v.prototype.zoomOut=function(d,_){return this.zoomTo(this.getZoom()-1,d,_),this},v.prototype.getBearing=function(){return this.transform.bearing},v.prototype.setBearing=function(d,_){return this.jumpTo({bearing:d},_),this},v.prototype.getPadding=function(){return this.transform.padding},v.prototype.setPadding=function(d,_){return this.jumpTo({padding:d},_),this},v.prototype.rotateTo=function(d,_,A){return this.easeTo(a.extend({bearing:d},_),A)},v.prototype.resetNorth=function(d,_){return this.rotateTo(0,a.extend({duration:1e3},d),_),this},v.prototype.resetNorthPitch=function(d,_){return this.easeTo(a.extend({bearing:0,pitch:0,duration:1e3},d),_),this},v.prototype.snapToNorth=function(d,_){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(d,_):this},v.prototype.getPitch=function(){return this.transform.pitch},v.prototype.setPitch=function(d,_){return this.jumpTo({pitch:d},_),this},v.prototype.cameraForBounds=function(d,_){d=a.LngLatBounds.convert(d);var A=_&&_.bearing||0;return this._cameraForBoxAndBearing(d.getNorthWest(),d.getSouthEast(),A,_)},v.prototype._cameraForBoxAndBearing=function(d,_,A,M){var R={top:0,bottom:0,right:0,left:0};if(typeof(M=a.extend({padding:R,offset:[0,0],maxZoom:this.transform.maxZoom},M)).padding=="number"){var B=M.padding;M.padding={top:B,bottom:B,right:B,left:B}}M.padding=a.extend(R,M.padding);var G=this.transform,J=G.padding,ce=G.project(a.LngLat.convert(d)),ve=G.project(a.LngLat.convert(_)),ye=ce.rotate(-A*Math.PI/180),Oe=ve.rotate(-A*Math.PI/180),Re=new a.Point(Math.max(ye.x,Oe.x),Math.max(ye.y,Oe.y)),Ge=new a.Point(Math.min(ye.x,Oe.x),Math.min(ye.y,Oe.y)),Me=Re.sub(Ge),He=(G.width-(J.left+J.right+M.padding.left+M.padding.right))/Me.x,et=(G.height-(J.top+J.bottom+M.padding.top+M.padding.bottom))/Me.y;if(!(et<0||He<0)){var ct=Math.min(G.scaleZoom(G.scale*Math.min(He,et)),M.maxZoom),Pt=typeof M.offset.x=="number"?new a.Point(M.offset.x,M.offset.y):a.Point.convert(M.offset),At=new a.Point((M.padding.left-M.padding.right)/2,(M.padding.top-M.padding.bottom)/2).rotate(A*Math.PI/180),Ot=Pt.add(At).mult(G.scale/G.zoomScale(ct));return{center:G.unproject(ce.add(ve).div(2).sub(Ot)),zoom:ct,bearing:A}}a.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},v.prototype.fitBounds=function(d,_,A){return this._fitInternal(this.cameraForBounds(d,_),_,A)},v.prototype.fitScreenCoordinates=function(d,_,A,M,R){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(a.Point.convert(d)),this.transform.pointLocation(a.Point.convert(_)),A,M),M,R)},v.prototype._fitInternal=function(d,_,A){return d?(delete(_=a.extend(d,_)).padding,_.linear?this.easeTo(_,A):this.flyTo(_,A)):this},v.prototype.jumpTo=function(d,_){this.stop();var A=this.transform,M=!1,R=!1,B=!1;return"zoom"in d&&A.zoom!==+d.zoom&&(M=!0,A.zoom=+d.zoom),d.center!==void 0&&(A.center=a.LngLat.convert(d.center)),"bearing"in d&&A.bearing!==+d.bearing&&(R=!0,A.bearing=+d.bearing),"pitch"in d&&A.pitch!==+d.pitch&&(B=!0,A.pitch=+d.pitch),d.padding==null||A.isPaddingEqual(d.padding)||(A.padding=d.padding),this.fire(new a.Event("movestart",_)).fire(new a.Event("move",_)),M&&this.fire(new a.Event("zoomstart",_)).fire(new a.Event("zoom",_)).fire(new a.Event("zoomend",_)),R&&this.fire(new a.Event("rotatestart",_)).fire(new a.Event("rotate",_)).fire(new a.Event("rotateend",_)),B&&this.fire(new a.Event("pitchstart",_)).fire(new a.Event("pitch",_)).fire(new a.Event("pitchend",_)),this.fire(new a.Event("moveend",_))},v.prototype.easeTo=function(d,_){var A=this;this._stop(!1,d.easeId),((d=a.extend({offset:[0,0],duration:500,easing:a.ease},d)).animate===!1||!d.essential&&a.browser.prefersReducedMotion)&&(d.duration=0);var M=this.transform,R=this.getZoom(),B=this.getBearing(),G=this.getPitch(),J=this.getPadding(),ce="zoom"in d?+d.zoom:R,ve="bearing"in d?this._normalizeBearing(d.bearing,B):B,ye="pitch"in d?+d.pitch:G,Oe="padding"in d?d.padding:M.padding,Re=a.Point.convert(d.offset),Ge=M.centerPoint.add(Re),Me=M.pointLocation(Ge),He=a.LngLat.convert(d.center||Me);this._normalizeCenter(He);var et,ct,Pt=M.project(Me),At=M.project(He).sub(Pt),Ot=M.zoomScale(ce-R);d.around&&(et=a.LngLat.convert(d.around),ct=M.locationPoint(et));var tr={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||ce!==R,this._rotating=this._rotating||B!==ve,this._pitching=this._pitching||ye!==G,this._padding=!M.isPaddingEqual(Oe),this._easeId=d.easeId,this._prepareEase(_,d.noMoveStart,tr),this._ease(function(sr){if(A._zooming&&(M.zoom=a.number(R,ce,sr)),A._rotating&&(M.bearing=a.number(B,ve,sr)),A._pitching&&(M.pitch=a.number(G,ye,sr)),A._padding&&(M.interpolatePadding(J,Oe,sr),Ge=M.centerPoint.add(Re)),et)M.setLocationAtPoint(et,ct);else{var _r=M.zoomScale(M.zoom-R),Ur=ce>R?Math.min(2,Ot):Math.max(.5,Ot),hn=Math.pow(Ur,1-sr),An=M.unproject(Pt.add(At.mult(sr*hn)).mult(_r));M.setLocationAtPoint(M.renderWorldCopies?An.wrap():An,Ge)}A._fireMoveEvents(_)},function(sr){A._afterEase(_,sr)},d),this},v.prototype._prepareEase=function(d,_,A){A===void 0&&(A={}),this._moving=!0,_||A.moving||this.fire(new a.Event("movestart",d)),this._zooming&&!A.zooming&&this.fire(new a.Event("zoomstart",d)),this._rotating&&!A.rotating&&this.fire(new a.Event("rotatestart",d)),this._pitching&&!A.pitching&&this.fire(new a.Event("pitchstart",d))},v.prototype._fireMoveEvents=function(d){this.fire(new a.Event("move",d)),this._zooming&&this.fire(new a.Event("zoom",d)),this._rotating&&this.fire(new a.Event("rotate",d)),this._pitching&&this.fire(new a.Event("pitch",d))},v.prototype._afterEase=function(d,_){if(!this._easeId||!_||this._easeId!==_){delete this._easeId;var A=this._zooming,M=this._rotating,R=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,A&&this.fire(new a.Event("zoomend",d)),M&&this.fire(new a.Event("rotateend",d)),R&&this.fire(new a.Event("pitchend",d)),this.fire(new a.Event("moveend",d))}},v.prototype.flyTo=function(d,_){var A=this;if(!d.essential&&a.browser.prefersReducedMotion){var M=a.pick(d,["center","zoom","bearing","pitch","around"]);return this.jumpTo(M,_)}this.stop(),d=a.extend({offset:[0,0],speed:1.2,curve:1.42,easing:a.ease},d);var R=this.transform,B=this.getZoom(),G=this.getBearing(),J=this.getPitch(),ce=this.getPadding(),ve="zoom"in d?a.clamp(+d.zoom,R.minZoom,R.maxZoom):B,ye="bearing"in d?this._normalizeBearing(d.bearing,G):G,Oe="pitch"in d?+d.pitch:J,Re="padding"in d?d.padding:R.padding,Ge=R.zoomScale(ve-B),Me=a.Point.convert(d.offset),He=R.centerPoint.add(Me),et=R.pointLocation(He),ct=a.LngLat.convert(d.center||et);this._normalizeCenter(ct);var Pt=R.project(et),At=R.project(ct).sub(Pt),Ot=d.curve,tr=Math.max(R.width,R.height),sr=tr/Ge,_r=At.mag();if("minZoom"in d){var Ur=a.clamp(Math.min(d.minZoom,B,ve),R.minZoom,R.maxZoom),hn=tr/R.zoomScale(Ur-B);Ot=Math.sqrt(hn/_r*2)}var An=Ot*Ot;function bn(zn){var pn=(sr*sr-tr*tr+(zn?-1:1)*An*An*_r*_r)/(2*(zn?sr:tr)*An*_r);return Math.log(Math.sqrt(pn*pn+1)-pn)}function Fi(zn){return(Math.exp(zn)-Math.exp(-zn))/2}function $r(zn){return(Math.exp(zn)+Math.exp(-zn))/2}var Ln=bn(0),Yn=function(zn){return $r(Ln)/$r(Ln+Ot*zn)},$n=function(zn){return tr*(($r(Ln)*(Fi(pn=Ln+Ot*zn)/$r(pn))-Fi(Ln))/An)/_r;var pn},Fn=(bn(1)-Ln)/Ot;if(Math.abs(_r)<1e-6||!isFinite(Fn)){if(Math.abs(tr-sr)<1e-6)return this.easeTo(d,_);var ri=sr<tr?-1:1;Fn=Math.abs(Math.log(sr/tr))/Ot,$n=function(){return 0},Yn=function(zn){return Math.exp(ri*Ot*zn)}}return d.duration="duration"in d?+d.duration:1e3*Fn/("screenSpeed"in d?+d.screenSpeed/Ot:+d.speed),d.maxDuration&&d.duration>d.maxDuration&&(d.duration=0),this._zooming=!0,this._rotating=G!==ye,this._pitching=Oe!==J,this._padding=!R.isPaddingEqual(Re),this._prepareEase(_,!1),this._ease(function(zn){var pn=zn*Fn,Ja=1/Yn(pn);R.zoom=zn===1?ve:B+R.scaleZoom(Ja),A._rotating&&(R.bearing=a.number(G,ye,zn)),A._pitching&&(R.pitch=a.number(J,Oe,zn)),A._padding&&(R.interpolatePadding(ce,Re,zn),He=R.centerPoint.add(Me));var Ha=zn===1?ct:R.unproject(Pt.add(At.mult($n(pn))).mult(Ja));R.setLocationAtPoint(R.renderWorldCopies?Ha.wrap():Ha,He),A._fireMoveEvents(_)},function(){return A._afterEase(_)},d),this},v.prototype.isEasing=function(){return!!this._easeFrameId},v.prototype.stop=function(){return this._stop()},v.prototype._stop=function(d,_){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var A=this._onEaseEnd;delete this._onEaseEnd,A.call(this,_)}if(!d){var M=this.handlers;M&&M.stop(!1)}return this},v.prototype._ease=function(d,_,A){A.animate===!1||A.duration===0?(d(1),_()):(this._easeStart=a.browser.now(),this._easeOptions=A,this._onEaseFrame=d,this._onEaseEnd=_,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},v.prototype._renderFrameCallback=function(){var d=Math.min((a.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(d)),d<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},v.prototype._normalizeBearing=function(d,_){d=a.wrap(d,-180,180);var A=Math.abs(d-_);return Math.abs(d-360-_)<A&&(d-=360),Math.abs(d+360-_)<A&&(d+=360),d},v.prototype._normalizeCenter=function(d){var _=this.transform;if(_.renderWorldCopies&&!_.lngRange){var A=d.lng-_.center.lng;d.lng+=A>180?-360:A<-180?360:0}},v}(a.Evented),Bo=function(p){p===void 0&&(p={}),this.options=p,a.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};Bo.prototype.getDefaultPosition=function(){return"bottom-right"},Bo.prototype.onAdd=function(p){var v=this.options&&this.options.compact;return this._map=p,this._container=c.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=c.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=c.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),v&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),v===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},Bo.prototype.onRemove=function(){c.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},Bo.prototype._setElementTitle=function(p,v){var d=this._map._getUIString("AttributionControl."+v);p.title=d,p.setAttribute("aria-label",d)},Bo.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},Bo.prototype._updateEditLink=function(){var p=this._editLink;p||(p=this._editLink=this._container.querySelector(".mapbox-improve-map"));var v=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||a.config.ACCESS_TOKEN}];if(p){var d=v.reduce(function(_,A,M){return A.value&&(_+=A.key+"="+A.value+(M<v.length-1?"&":"")),_},"?");p.href=a.config.FEEDBACK_URL+"/"+d+(this._map._hash?this._map._hash.getHashString(!0):""),p.rel="noopener nofollow",this._setElementTitle(p,"MapFeedback")}},Bo.prototype._updateData=function(p){!p||p.sourceDataType!=="metadata"&&p.sourceDataType!=="visibility"&&p.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},Bo.prototype._updateAttributions=function(){if(this._map.style){var p=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?p=p.concat(this.options.customAttribution.map(function(B){return typeof B!="string"?"":B})):typeof this.options.customAttribution=="string"&&p.push(this.options.customAttribution)),this._map.style.stylesheet){var v=this._map.style.stylesheet;this.styleOwner=v.owner,this.styleId=v.id}var d=this._map.style.sourceCaches;for(var _ in d){var A=d[_];if(A.used){var M=A.getSource();M.attribution&&p.indexOf(M.attribution)<0&&p.push(M.attribution)}}p.sort(function(B,G){return B.length-G.length});var R=(p=p.filter(function(B,G){for(var J=G+1;J<p.length;J++)if(p[J].indexOf(B)>=0)return!1;return!0})).join(" | ");R!==this._attribHTML&&(this._attribHTML=R,p.length?(this._innerContainer.innerHTML=R,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},Bo.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var ds=function(){a.bindAll(["_updateLogo"],this),a.bindAll(["_updateCompact"],this)};ds.prototype.onAdd=function(p){this._map=p,this._container=c.create("div","mapboxgl-ctrl");var v=c.create("a","mapboxgl-ctrl-logo");return v.target="_blank",v.rel="noopener nofollow",v.href="https://www.mapbox.com/",v.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),v.setAttribute("rel","noopener nofollow"),this._container.appendChild(v),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},ds.prototype.onRemove=function(){c.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},ds.prototype.getDefaultPosition=function(){return"bottom-left"},ds.prototype._updateLogo=function(p){p&&p.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},ds.prototype._logoRequired=function(){if(this._map.style){var p=this._map.style.sourceCaches;for(var v in p)if(p[v].getSource().mapbox_logo)return!0;return!1}},ds.prototype._updateCompact=function(){var p=this._container.children;if(p.length){var v=p[0];this._map.getCanvasContainer().offsetWidth<250?v.classList.add("mapboxgl-compact"):v.classList.remove("mapboxgl-compact")}};var Xo=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};Xo.prototype.add=function(p){var v=++this._id;return this._queue.push({callback:p,id:v,cancelled:!1}),v},Xo.prototype.remove=function(p){for(var v=this._currentlyRunning,d=0,_=v?this._queue.concat(v):this._queue;d<_.length;d+=1){var A=_[d];if(A.id===p)return void(A.cancelled=!0)}},Xo.prototype.run=function(p){p===void 0&&(p=0);var v=this._currentlyRunning=this._queue;this._queue=[];for(var d=0,_=v;d<_.length;d+=1){var A=_[d];if(!A.cancelled&&(A.callback(p),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},Xo.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var tl={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},sp=a.window.HTMLImageElement,Js=a.window.HTMLElement,ea=a.window.ImageBitmap,bo={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},eu=function(p){function v(_){var A=this;if((_=a.extend({},bo,_)).minZoom!=null&&_.maxZoom!=null&&_.minZoom>_.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(_.minPitch!=null&&_.maxPitch!=null&&_.minPitch>_.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(_.minPitch!=null&&_.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(_.maxPitch!=null&&_.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var M=new Tn(_.minZoom,_.maxZoom,_.minPitch,_.maxPitch,_.renderWorldCopies);if(p.call(this,M,_),this._interactive=_.interactive,this._maxTileCacheSize=_.maxTileCacheSize,this._failIfMajorPerformanceCaveat=_.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=_.preserveDrawingBuffer,this._antialias=_.antialias,this._trackResize=_.trackResize,this._bearingSnap=_.bearingSnap,this._refreshExpiredTiles=_.refreshExpiredTiles,this._fadeDuration=_.fadeDuration,this._crossSourceCollisions=_.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=_.collectResourceTiming,this._renderTaskQueue=new Xo,this._controls=[],this._mapId=a.uniqueId(),this._locale=a.extend({},tl,_.locale),this._clickTolerance=_.clickTolerance,this._requestManager=new a.RequestManager(_.transformRequest,_.accessToken),typeof _.container=="string"){if(this._container=a.window.document.getElementById(_.container),!this._container)throw new Error("Container '"+_.container+"' not found.")}else{if(!(_.container instanceof Js))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=_.container}if(_.maxBounds&&this.setMaxBounds(_.maxBounds),a.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return A._update(!1)}),this.on("moveend",function(){return A._update(!1)}),this.on("zoom",function(){return A._update(!0)}),a.window!==void 0&&(a.window.addEventListener("online",this._onWindowOnline,!1),a.window.addEventListener("resize",this._onWindowResize,!1),a.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new on(this,_),this._hash=_.hash&&new Rs(typeof _.hash=="string"&&_.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:_.center,zoom:_.zoom,bearing:_.bearing,pitch:_.pitch}),_.bounds&&(this.resize(),this.fitBounds(_.bounds,a.extend({},_.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=_.localIdeographFontFamily,_.style&&this.setStyle(_.style,{localIdeographFontFamily:_.localIdeographFontFamily}),_.attributionControl&&this.addControl(new Bo({customAttribution:_.customAttribution})),this.addControl(new ds,_.logoPosition),this.on("style.load",function(){A.transform.unmodified&&A.jumpTo(A.style.stylesheet)}),this.on("data",function(R){A._update(R.dataType==="style"),A.fire(new a.Event(R.dataType+"data",R))}),this.on("dataloading",function(R){A.fire(new a.Event(R.dataType+"dataloading",R))})}p&&(v.__proto__=p),(v.prototype=Object.create(p&&p.prototype)).constructor=v;var d={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return v.prototype._getMapId=function(){return this._mapId},v.prototype.addControl=function(_,A){if(A===void 0&&(A=_.getDefaultPosition?_.getDefaultPosition():"top-right"),!_||!_.onAdd)return this.fire(new a.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var M=_.onAdd(this);this._controls.push(_);var R=this._controlPositions[A];return A.indexOf("bottom")!==-1?R.insertBefore(M,R.firstChild):R.appendChild(M),this},v.prototype.removeControl=function(_){if(!_||!_.onRemove)return this.fire(new a.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var A=this._controls.indexOf(_);return A>-1&&this._controls.splice(A,1),_.onRemove(this),this},v.prototype.hasControl=function(_){return this._controls.indexOf(_)>-1},v.prototype.resize=function(_){var A=this._containerDimensions(),M=A[0],R=A[1];if(M===this.transform.width&&R===this.transform.height)return this;this._resizeCanvas(M,R),this.transform.resize(M,R),this.painter.resize(M,R);var B=!this._moving;return B&&this.fire(new a.Event("movestart",_)).fire(new a.Event("move",_)),this.fire(new a.Event("resize",_)),B&&this.fire(new a.Event("moveend",_)),this},v.prototype.getBounds=function(){return this.transform.getBounds()},v.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},v.prototype.setMaxBounds=function(_){return this.transform.setMaxBounds(a.LngLatBounds.convert(_)),this._update()},v.prototype.setMinZoom=function(_){if((_=_??-2)>=-2&&_<=this.transform.maxZoom)return this.transform.minZoom=_,this._update(),this.getZoom()<_&&this.setZoom(_),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},v.prototype.getMinZoom=function(){return this.transform.minZoom},v.prototype.setMaxZoom=function(_){if((_=_??22)>=this.transform.minZoom)return this.transform.maxZoom=_,this._update(),this.getZoom()>_&&this.setZoom(_),this;throw new Error("maxZoom must be greater than the current minZoom")},v.prototype.getMaxZoom=function(){return this.transform.maxZoom},v.prototype.setMinPitch=function(_){if((_=_??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(_>=0&&_<=this.transform.maxPitch)return this.transform.minPitch=_,this._update(),this.getPitch()<_&&this.setPitch(_),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},v.prototype.getMinPitch=function(){return this.transform.minPitch},v.prototype.setMaxPitch=function(_){if((_=_??60)>60)throw new Error("maxPitch must be less than or equal to 60");if(_>=this.transform.minPitch)return this.transform.maxPitch=_,this._update(),this.getPitch()>_&&this.setPitch(_),this;throw new Error("maxPitch must be greater than the current minPitch")},v.prototype.getMaxPitch=function(){return this.transform.maxPitch},v.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},v.prototype.setRenderWorldCopies=function(_){return this.transform.renderWorldCopies=_,this._update()},v.prototype.project=function(_){return this.transform.locationPoint(a.LngLat.convert(_))},v.prototype.unproject=function(_){return this.transform.pointLocation(a.Point.convert(_))},v.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},v.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},v.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},v.prototype._createDelegatedListener=function(_,A,M){var R,B=this;if(_==="mouseenter"||_==="mouseover"){var G=!1;return{layer:A,listener:M,delegates:{mousemove:function(ce){var ve=B.getLayer(A)?B.queryRenderedFeatures(ce.point,{layers:[A]}):[];ve.length?G||(G=!0,M.call(B,new $a(_,B,ce.originalEvent,{features:ve}))):G=!1},mouseout:function(){G=!1}}}}if(_==="mouseleave"||_==="mouseout"){var J=!1;return{layer:A,listener:M,delegates:{mousemove:function(ce){(B.getLayer(A)?B.queryRenderedFeatures(ce.point,{layers:[A]}):[]).length?J=!0:J&&(J=!1,M.call(B,new $a(_,B,ce.originalEvent)))},mouseout:function(ce){J&&(J=!1,M.call(B,new $a(_,B,ce.originalEvent)))}}}}return{layer:A,listener:M,delegates:(R={},R[_]=function(ce){var ve=B.getLayer(A)?B.queryRenderedFeatures(ce.point,{layers:[A]}):[];ve.length&&(ce.features=ve,M.call(B,ce),delete ce.features)},R)}},v.prototype.on=function(_,A,M){if(M===void 0)return p.prototype.on.call(this,_,A);var R=this._createDelegatedListener(_,A,M);for(var B in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[_]=this._delegatedListeners[_]||[],this._delegatedListeners[_].push(R),R.delegates)this.on(B,R.delegates[B]);return this},v.prototype.once=function(_,A,M){if(M===void 0)return p.prototype.once.call(this,_,A);var R=this._createDelegatedListener(_,A,M);for(var B in R.delegates)this.once(B,R.delegates[B]);return this},v.prototype.off=function(_,A,M){var R=this;return M===void 0?p.prototype.off.call(this,_,A):(this._delegatedListeners&&this._delegatedListeners[_]&&function(B){for(var G=B[_],J=0;J<G.length;J++){var ce=G[J];if(ce.layer===A&&ce.listener===M){for(var ve in ce.delegates)R.off(ve,ce.delegates[ve]);return G.splice(J,1),R}}}(this._delegatedListeners),this)},v.prototype.queryRenderedFeatures=function(_,A){if(!this.style)return[];var M;if(A!==void 0||_===void 0||_ instanceof a.Point||Array.isArray(_)||(A=_,_=void 0),A=A||{},(_=_||[[0,0],[this.transform.width,this.transform.height]])instanceof a.Point||typeof _[0]=="number")M=[a.Point.convert(_)];else{var R=a.Point.convert(_[0]),B=a.Point.convert(_[1]);M=[R,new a.Point(B.x,R.y),B,new a.Point(R.x,B.y),R]}return this.style.queryRenderedFeatures(M,A,this.transform)},v.prototype.querySourceFeatures=function(_,A){return this.style.querySourceFeatures(_,A)},v.prototype.setStyle=function(_,A){return(A=a.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},A)).diff!==!1&&A.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&_?(this._diffStyle(_,A),this):(this._localIdeographFontFamily=A.localIdeographFontFamily,this._updateStyle(_,A))},v.prototype._getUIString=function(_){var A=this._locale[_];if(A==null)throw new Error("Missing UI string '"+_+"'");return A},v.prototype._updateStyle=function(_,A){return this.style&&(this.style.setEventedParent(null),this.style._remove()),_?(this.style=new Mi(this,A||{}),this.style.setEventedParent(this,{style:this.style}),typeof _=="string"?this.style.loadURL(_):this.style.loadJSON(_),this):(delete this.style,this)},v.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new Mi(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},v.prototype._diffStyle=function(_,A){var M=this;if(typeof _=="string"){var R=this._requestManager.normalizeStyleURL(_),B=this._requestManager.transformRequest(R,a.ResourceType.Style);a.getJSON(B,function(G,J){G?M.fire(new a.ErrorEvent(G)):J&&M._updateDiff(J,A)})}else typeof _=="object"&&this._updateDiff(_,A)},v.prototype._updateDiff=function(_,A){try{this.style.setState(_)&&this._update(!0)}catch(M){a.warnOnce("Unable to perform style diff: "+(M.message||M.error||M)+".  Rebuilding the style from scratch."),this._updateStyle(_,A)}},v.prototype.getStyle=function(){if(this.style)return this.style.serialize()},v.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():a.warnOnce("There is no style added to the map.")},v.prototype.addSource=function(_,A){return this._lazyInitEmptyStyle(),this.style.addSource(_,A),this._update(!0)},v.prototype.isSourceLoaded=function(_){var A=this.style&&this.style.sourceCaches[_];if(A!==void 0)return A.loaded();this.fire(new a.ErrorEvent(new Error("There is no source with ID '"+_+"'")))},v.prototype.areTilesLoaded=function(){var _=this.style&&this.style.sourceCaches;for(var A in _){var M=_[A]._tiles;for(var R in M){var B=M[R];if(B.state!=="loaded"&&B.state!=="errored")return!1}}return!0},v.prototype.addSourceType=function(_,A,M){return this._lazyInitEmptyStyle(),this.style.addSourceType(_,A,M)},v.prototype.removeSource=function(_){return this.style.removeSource(_),this._update(!0)},v.prototype.getSource=function(_){return this.style.getSource(_)},v.prototype.addImage=function(_,A,M){M===void 0&&(M={});var R=M.pixelRatio;R===void 0&&(R=1);var B=M.sdf;B===void 0&&(B=!1);var G=M.stretchX,J=M.stretchY,ce=M.content;if(this._lazyInitEmptyStyle(),A instanceof sp||ea&&A instanceof ea){var ve=a.browser.getImageData(A);this.style.addImage(_,{data:new a.RGBAImage({width:ve.width,height:ve.height},ve.data),pixelRatio:R,stretchX:G,stretchY:J,content:ce,sdf:B,version:0})}else{if(A.width===void 0||A.height===void 0)return this.fire(new a.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var ye=A;this.style.addImage(_,{data:new a.RGBAImage({width:A.width,height:A.height},new Uint8Array(A.data)),pixelRatio:R,stretchX:G,stretchY:J,content:ce,sdf:B,version:0,userImage:ye}),ye.onAdd&&ye.onAdd(this,_)}},v.prototype.updateImage=function(_,A){var M=this.style.getImage(_);if(!M)return this.fire(new a.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var R=A instanceof sp||ea&&A instanceof ea?a.browser.getImageData(A):A,B=R.width,G=R.height,J=R.data;return B===void 0||G===void 0?this.fire(new a.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):B!==M.data.width||G!==M.data.height?this.fire(new a.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(M.data.replace(J,!(A instanceof sp||ea&&A instanceof ea)),void this.style.updateImage(_,M))},v.prototype.hasImage=function(_){return _?!!this.style.getImage(_):(this.fire(new a.ErrorEvent(new Error("Missing required image id"))),!1)},v.prototype.removeImage=function(_){this.style.removeImage(_)},v.prototype.loadImage=function(_,A){a.getImage(this._requestManager.transformRequest(_,a.ResourceType.Image),A)},v.prototype.listImages=function(){return this.style.listImages()},v.prototype.addLayer=function(_,A){return this._lazyInitEmptyStyle(),this.style.addLayer(_,A),this._update(!0)},v.prototype.moveLayer=function(_,A){return this.style.moveLayer(_,A),this._update(!0)},v.prototype.removeLayer=function(_){return this.style.removeLayer(_),this._update(!0)},v.prototype.getLayer=function(_){return this.style.getLayer(_)},v.prototype.setLayerZoomRange=function(_,A,M){return this.style.setLayerZoomRange(_,A,M),this._update(!0)},v.prototype.setFilter=function(_,A,M){return M===void 0&&(M={}),this.style.setFilter(_,A,M),this._update(!0)},v.prototype.getFilter=function(_){return this.style.getFilter(_)},v.prototype.setPaintProperty=function(_,A,M,R){return R===void 0&&(R={}),this.style.setPaintProperty(_,A,M,R),this._update(!0)},v.prototype.getPaintProperty=function(_,A){return this.style.getPaintProperty(_,A)},v.prototype.setLayoutProperty=function(_,A,M,R){return R===void 0&&(R={}),this.style.setLayoutProperty(_,A,M,R),this._update(!0)},v.prototype.getLayoutProperty=function(_,A){return this.style.getLayoutProperty(_,A)},v.prototype.setLight=function(_,A){return A===void 0&&(A={}),this._lazyInitEmptyStyle(),this.style.setLight(_,A),this._update(!0)},v.prototype.getLight=function(){return this.style.getLight()},v.prototype.setFeatureState=function(_,A){return this.style.setFeatureState(_,A),this._update()},v.prototype.removeFeatureState=function(_,A){return this.style.removeFeatureState(_,A),this._update()},v.prototype.getFeatureState=function(_){return this.style.getFeatureState(_)},v.prototype.getContainer=function(){return this._container},v.prototype.getCanvasContainer=function(){return this._canvasContainer},v.prototype.getCanvas=function(){return this._canvas},v.prototype._containerDimensions=function(){var _=0,A=0;return this._container&&(_=this._container.clientWidth||400,A=this._container.clientHeight||300),[_,A]},v.prototype._detectMissingCSS=function(){a.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&a.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},v.prototype._setupContainer=function(){var _=this._container;_.classList.add("mapboxgl-map"),(this._missingCSSCanary=c.create("div","mapboxgl-canary",_)).style.visibility="hidden",this._detectMissingCSS();var A=this._canvasContainer=c.create("div","mapboxgl-canvas-container",_);this._interactive&&A.classList.add("mapboxgl-interactive"),this._canvas=c.create("canvas","mapboxgl-canvas",A),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var M=this._containerDimensions();this._resizeCanvas(M[0],M[1]);var R=this._controlContainer=c.create("div","mapboxgl-control-container",_),B=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(G){B[G]=c.create("div","mapboxgl-ctrl-"+G,R)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},v.prototype._resizeCanvas=function(_,A){var M=a.browser.devicePixelRatio||1;this._canvas.width=M*_,this._canvas.height=M*A,this._canvas.style.width=_+"px",this._canvas.style.height=A+"px"},v.prototype._setupPainter=function(){var _=a.extend({},u.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),A=this._canvas.getContext("webgl",_)||this._canvas.getContext("experimental-webgl",_);A?(this.painter=new jr(A,this.transform),a.webpSupported.testSupport(A)):this.fire(new a.ErrorEvent(new Error("Failed to initialize WebGL")))},v.prototype._contextLost=function(_){_.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new a.Event("webglcontextlost",{originalEvent:_}))},v.prototype._contextRestored=function(_){this._setupPainter(),this.resize(),this._update(),this.fire(new a.Event("webglcontextrestored",{originalEvent:_}))},v.prototype._onMapScroll=function(_){if(_.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},v.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},v.prototype._update=function(_){return this.style?(this._styleDirty=this._styleDirty||_,this._sourcesDirty=!0,this.triggerRepaint(),this):this},v.prototype._requestRenderFrame=function(_){return this._update(),this._renderTaskQueue.add(_)},v.prototype._cancelRenderFrame=function(_){this._renderTaskQueue.remove(_)},v.prototype._render=function(_){var A,M=this,R=0,B=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(A=B.createQueryEXT(),B.beginQueryEXT(B.TIME_ELAPSED_EXT,A),R=a.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(_),!this._removed){var G=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var J=this.transform.zoom,ce=a.browser.now();this.style.zoomHistory.update(J,ce);var ve=new a.EvaluationParameters(J,{now:ce,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),ye=ve.crossFadingFactor();ye===1&&ye===this._crossFadingFactor||(G=!0,this._crossFadingFactor=ye),this.style.update(ve)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new a.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new a.Event("load"))),this.style&&(this.style.hasTransitions()||G)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var Oe=a.browser.now()-R;B.endQueryEXT(B.TIME_ELAPSED_EXT,A),setTimeout(function(){var Me=B.getQueryObjectEXT(A,B.QUERY_RESULT_EXT)/1e6;B.deleteQueryEXT(A),M.fire(new a.Event("gpu-timing-frame",{cpuTime:Oe,gpuTime:Me}))},50)}if(this.listens("gpu-timing-layer")){var Re=this.painter.collectGpuTimers();setTimeout(function(){var Me=M.painter.queryGpuTimers(Re);M.fire(new a.Event("gpu-timing-layer",{layerTimes:Me}))},50)}var Ge=this._sourcesDirty||this._styleDirty||this._placementDirty;return Ge||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new a.Event("idle")),!this._loaded||this._fullyLoaded||Ge||(this._fullyLoaded=!0),this}},v.prototype.remove=function(){this._hash&&this._hash.remove();for(var _=0,A=this._controls;_<A.length;_+=1)A[_].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),a.window!==void 0&&(a.window.removeEventListener("resize",this._onWindowResize,!1),a.window.removeEventListener("orientationchange",this._onWindowResize,!1),a.window.removeEventListener("online",this._onWindowOnline,!1));var M=this.painter.context.gl.getExtension("WEBGL_lose_context");M&&M.loseContext(),Al(this._canvasContainer),Al(this._controlContainer),Al(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new a.Event("remove"))},v.prototype.triggerRepaint=function(){var _=this;this.style&&!this._frame&&(this._frame=a.browser.frame(function(A){_._frame=null,_._render(A)}))},v.prototype._onWindowOnline=function(){this._update()},v.prototype._onWindowResize=function(_){this._trackResize&&this.resize({originalEvent:_})._update()},d.showTileBoundaries.get=function(){return!!this._showTileBoundaries},d.showTileBoundaries.set=function(_){this._showTileBoundaries!==_&&(this._showTileBoundaries=_,this._update())},d.showPadding.get=function(){return!!this._showPadding},d.showPadding.set=function(_){this._showPadding!==_&&(this._showPadding=_,this._update())},d.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},d.showCollisionBoxes.set=function(_){this._showCollisionBoxes!==_&&(this._showCollisionBoxes=_,_?this.style._generateCollisionBoxes():this._update())},d.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},d.showOverdrawInspector.set=function(_){this._showOverdrawInspector!==_&&(this._showOverdrawInspector=_,this._update())},d.repaint.get=function(){return!!this._repaint},d.repaint.set=function(_){this._repaint!==_&&(this._repaint=_,this.triggerRepaint())},d.vertices.get=function(){return!!this._vertices},d.vertices.set=function(_){this._vertices=_,this._update()},v.prototype._setCacheLimits=function(_,A){a.setCacheLimits(_,A)},d.version.get=function(){return a.version},Object.defineProperties(v.prototype,d),v}(Gl);function Al(p){p.parentNode&&p.parentNode.removeChild(p)}var me={showCompass:!0,showZoom:!0,visualizePitch:!1},vs=function(p){var v=this;this.options=a.extend({},me,p),this._container=c.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(d){return d.preventDefault()}),this.options.showZoom&&(a.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(d){return v._map.zoomIn({},{originalEvent:d})}),c.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(d){return v._map.zoomOut({},{originalEvent:d})}),c.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(a.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(d){v.options.visualizePitch?v._map.resetNorthPitch({},{originalEvent:d}):v._map.resetNorth({},{originalEvent:d})}),this._compassIcon=c.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};vs.prototype._updateZoomButtons=function(){var p=this._map.getZoom(),v=p===this._map.getMaxZoom(),d=p===this._map.getMinZoom();this._zoomInButton.disabled=v,this._zoomOutButton.disabled=d,this._zoomInButton.setAttribute("aria-disabled",v.toString()),this._zoomOutButton.setAttribute("aria-disabled",d.toString())},vs.prototype._rotateCompassArrow=function(){var p=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=p},vs.prototype.onAdd=function(p){return this._map=p,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new as(this._map,this._compass,this.options.visualizePitch)),this._container},vs.prototype.onRemove=function(){c.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},vs.prototype._createButton=function(p,v){var d=c.create("button",p,this._container);return d.type="button",d.addEventListener("click",v),d},vs.prototype._setButtonTitle=function(p,v){var d=this._map._getUIString("NavigationControl."+v);p.title=d,p.setAttribute("aria-label",d)};var as=function(p,v,d){d===void 0&&(d=!1),this._clickTolerance=10,this.element=v,this.mouseRotate=new xo({clickTolerance:p.dragRotate._mouseRotate._clickTolerance}),this.map=p,d&&(this.mousePitch=new xc({clickTolerance:p.dragRotate._mousePitch._clickTolerance})),a.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),c.addEventListener(v,"mousedown",this.mousedown),c.addEventListener(v,"touchstart",this.touchstart,{passive:!1}),c.addEventListener(v,"touchmove",this.touchmove),c.addEventListener(v,"touchend",this.touchend),c.addEventListener(v,"touchcancel",this.reset)};function os(p,v,d){if(p=new a.LngLat(p.lng,p.lat),v){var _=new a.LngLat(p.lng-360,p.lat),A=new a.LngLat(p.lng+360,p.lat),M=d.locationPoint(p).distSqr(v);d.locationPoint(_).distSqr(v)<M?p=_:d.locationPoint(A).distSqr(v)<M&&(p=A)}for(;Math.abs(p.lng-d.center.lng)>180;){var R=d.locationPoint(p);if(R.x>=0&&R.y>=0&&R.x<=d.width&&R.y<=d.height)break;p.lng>d.center.lng?p.lng-=360:p.lng+=360}return p}as.prototype.down=function(p,v){this.mouseRotate.mousedown(p,v),this.mousePitch&&this.mousePitch.mousedown(p,v),c.disableDrag()},as.prototype.move=function(p,v){var d=this.map,_=this.mouseRotate.mousemoveWindow(p,v);if(_&&_.bearingDelta&&d.setBearing(d.getBearing()+_.bearingDelta),this.mousePitch){var A=this.mousePitch.mousemoveWindow(p,v);A&&A.pitchDelta&&d.setPitch(d.getPitch()+A.pitchDelta)}},as.prototype.off=function(){var p=this.element;c.removeEventListener(p,"mousedown",this.mousedown),c.removeEventListener(p,"touchstart",this.touchstart,{passive:!1}),c.removeEventListener(p,"touchmove",this.touchmove),c.removeEventListener(p,"touchend",this.touchend),c.removeEventListener(p,"touchcancel",this.reset),this.offTemp()},as.prototype.offTemp=function(){c.enableDrag(),c.removeEventListener(a.window,"mousemove",this.mousemove),c.removeEventListener(a.window,"mouseup",this.mouseup)},as.prototype.mousedown=function(p){this.down(a.extend({},p,{ctrlKey:!0,preventDefault:function(){return p.preventDefault()}}),c.mousePos(this.element,p)),c.addEventListener(a.window,"mousemove",this.mousemove),c.addEventListener(a.window,"mouseup",this.mouseup)},as.prototype.mousemove=function(p){this.move(p,c.mousePos(this.element,p))},as.prototype.mouseup=function(p){this.mouseRotate.mouseupWindow(p),this.mousePitch&&this.mousePitch.mouseupWindow(p),this.offTemp()},as.prototype.touchstart=function(p){p.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=c.touchPos(this.element,p.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return p.preventDefault()}},this._startPos))},as.prototype.touchmove=function(p){p.targetTouches.length!==1?this.reset():(this._lastPos=c.touchPos(this.element,p.targetTouches)[0],this.move({preventDefault:function(){return p.preventDefault()}},this._lastPos))},as.prototype.touchend=function(p){p.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},as.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var mi={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Sh(p,v,d){var _=p.classList;for(var A in mi)_.remove("mapboxgl-"+d+"-anchor-"+A);_.add("mapboxgl-"+d+"-anchor-"+v)}var Qc,Ah=function(p){function v(d,_){if(p.call(this),(d instanceof a.window.HTMLElement||_)&&(d=a.extend({element:d},_)),a.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=d&&d.anchor||"center",this._color=d&&d.color||"#3FB1CE",this._scale=d&&d.scale||1,this._draggable=d&&d.draggable||!1,this._clickTolerance=d&&d.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=d&&d.rotation||0,this._rotationAlignment=d&&d.rotationAlignment||"auto",this._pitchAlignment=d&&d.pitchAlignment&&d.pitchAlignment!=="auto"?d.pitchAlignment:this._rotationAlignment,d&&d.element)this._element=d.element,this._offset=a.Point.convert(d&&d.offset||[0,0]);else{this._defaultMarker=!0,this._element=c.create("div"),this._element.setAttribute("aria-label","Map marker");var A=c.createNS("http://www.w3.org/2000/svg","svg");A.setAttributeNS(null,"display","block"),A.setAttributeNS(null,"height","41px"),A.setAttributeNS(null,"width","27px"),A.setAttributeNS(null,"viewBox","0 0 27 41");var M=c.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"stroke","none"),M.setAttributeNS(null,"stroke-width","1"),M.setAttributeNS(null,"fill","none"),M.setAttributeNS(null,"fill-rule","evenodd");var R=c.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"fill-rule","nonzero");var B=c.createNS("http://www.w3.org/2000/svg","g");B.setAttributeNS(null,"transform","translate(3.0, 29.0)"),B.setAttributeNS(null,"fill","#000000");for(var G=0,J=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];G<J.length;G+=1){var ce=J[G],ve=c.createNS("http://www.w3.org/2000/svg","ellipse");ve.setAttributeNS(null,"opacity","0.04"),ve.setAttributeNS(null,"cx","10.5"),ve.setAttributeNS(null,"cy","5.80029008"),ve.setAttributeNS(null,"rx",ce.rx),ve.setAttributeNS(null,"ry",ce.ry),B.appendChild(ve)}var ye=c.createNS("http://www.w3.org/2000/svg","g");ye.setAttributeNS(null,"fill",this._color);var Oe=c.createNS("http://www.w3.org/2000/svg","path");Oe.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),ye.appendChild(Oe);var Re=c.createNS("http://www.w3.org/2000/svg","g");Re.setAttributeNS(null,"opacity","0.25"),Re.setAttributeNS(null,"fill","#000000");var Ge=c.createNS("http://www.w3.org/2000/svg","path");Ge.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Re.appendChild(Ge);var Me=c.createNS("http://www.w3.org/2000/svg","g");Me.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Me.setAttributeNS(null,"fill","#FFFFFF");var He=c.createNS("http://www.w3.org/2000/svg","g");He.setAttributeNS(null,"transform","translate(8.0, 8.0)");var et=c.createNS("http://www.w3.org/2000/svg","circle");et.setAttributeNS(null,"fill","#000000"),et.setAttributeNS(null,"opacity","0.25"),et.setAttributeNS(null,"cx","5.5"),et.setAttributeNS(null,"cy","5.5"),et.setAttributeNS(null,"r","5.4999962");var ct=c.createNS("http://www.w3.org/2000/svg","circle");ct.setAttributeNS(null,"fill","#FFFFFF"),ct.setAttributeNS(null,"cx","5.5"),ct.setAttributeNS(null,"cy","5.5"),ct.setAttributeNS(null,"r","5.4999962"),He.appendChild(et),He.appendChild(ct),R.appendChild(B),R.appendChild(ye),R.appendChild(Re),R.appendChild(Me),R.appendChild(He),A.appendChild(R),A.setAttributeNS(null,"height",41*this._scale+"px"),A.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(A),this._offset=a.Point.convert(d&&d.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(Pt){Pt.preventDefault()}),this._element.addEventListener("mousedown",function(Pt){Pt.preventDefault()}),Sh(this._element,this._anchor,"marker"),this._popup=null}return p&&(v.__proto__=p),(v.prototype=Object.create(p&&p.prototype)).constructor=v,v.prototype.addTo=function(d){return this.remove(),this._map=d,d.getCanvasContainer().appendChild(this._element),d.on("move",this._update),d.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},v.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),c.remove(this._element),this._popup&&this._popup.remove(),this},v.prototype.getLngLat=function(){return this._lngLat},v.prototype.setLngLat=function(d){return this._lngLat=a.LngLat.convert(d),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},v.prototype.getElement=function(){return this._element},v.prototype.setPopup=function(d){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),d){if(!("offset"in d.options)){var _=Math.sqrt(Math.pow(13.5,2)/2);d.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[_,-1*(24.6+_)],"bottom-right":[-_,-1*(24.6+_)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=d,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},v.prototype._onKeyPress=function(d){var _=d.code,A=d.charCode||d.keyCode;_!=="Space"&&_!=="Enter"&&A!==32&&A!==13||this.togglePopup()},v.prototype._onMapClick=function(d){var _=d.originalEvent.target,A=this._element;this._popup&&(_===A||A.contains(_))&&this.togglePopup()},v.prototype.getPopup=function(){return this._popup},v.prototype.togglePopup=function(){var d=this._popup;return d?(d.isOpen()?d.remove():d.addTo(this._map),this):this},v.prototype._update=function(d){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=os(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var _="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?_="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(_="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var A="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?A="rotateX(0deg)":this._pitchAlignment==="map"&&(A="rotateX("+this._map.getPitch()+"deg)"),d&&d.type!=="moveend"||(this._pos=this._pos.round()),c.setTransform(this._element,mi[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+A+" "+_)}},v.prototype.getOffset=function(){return this._offset},v.prototype.setOffset=function(d){return this._offset=a.Point.convert(d),this._update(),this},v.prototype._onMove=function(d){if(!this._isDragging){var _=this._clickTolerance||this._map._clickTolerance;this._isDragging=d.point.dist(this._pointerdownPos)>=_}this._isDragging&&(this._pos=d.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.Event("dragstart"))),this.fire(new a.Event("drag")))},v.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new a.Event("dragend")),this._state="inactive"},v.prototype._addDragHandler=function(d){this._element.contains(d.originalEvent.target)&&(d.preventDefault(),this._positionDelta=d.point.sub(this._pos).add(this._offset),this._pointerdownPos=d.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},v.prototype.setDraggable=function(d){return this._draggable=!!d,this._map&&(d?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},v.prototype.isDraggable=function(){return this._draggable},v.prototype.setRotation=function(d){return this._rotation=d||0,this._update(),this},v.prototype.getRotation=function(){return this._rotation},v.prototype.setRotationAlignment=function(d){return this._rotationAlignment=d||"auto",this._update(),this},v.prototype.getRotationAlignment=function(){return this._rotationAlignment},v.prototype.setPitchAlignment=function(d){return this._pitchAlignment=d&&d!=="auto"?d:this._rotationAlignment,this._update(),this},v.prototype.getPitchAlignment=function(){return this._pitchAlignment},v}(a.Evented),Hl={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},Tf=0,Jc=!1,ed=function(p){function v(d){p.call(this),this.options=a.extend({},Hl,d),a.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return p&&(v.__proto__=p),(v.prototype=Object.create(p&&p.prototype)).constructor=v,v.prototype.onAdd=function(d){var _;return this._map=d,this._container=c.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),_=this._setupUI,Qc!==void 0?_(Qc):a.window.navigator.permissions!==void 0?a.window.navigator.permissions.query({name:"geolocation"}).then(function(A){_(Qc=A.state!=="denied")}):_(Qc=!!a.window.navigator.geolocation),this._container},v.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(a.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),c.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Tf=0,Jc=!1},v.prototype._isOutOfMapMaxBounds=function(d){var _=this._map.getMaxBounds(),A=d.coords;return _&&(A.longitude<_.getWest()||A.longitude>_.getEast()||A.latitude<_.getSouth()||A.latitude>_.getNorth())},v.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},v.prototype._onSuccess=function(d){if(this._map){if(this._isOutOfMapMaxBounds(d))return this._setErrorState(),this.fire(new a.Event("outofmaxbounds",d)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=d,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(d),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(d),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new a.Event("geolocate",d)),this._finish()}},v.prototype._updateCamera=function(d){var _=new a.LngLat(d.coords.longitude,d.coords.latitude),A=d.coords.accuracy,M=this._map.getBearing(),R=a.extend({bearing:M},this.options.fitBoundsOptions);this._map.fitBounds(_.toBounds(A),R,{geolocateSource:!0})},v.prototype._updateMarker=function(d){if(d){var _=new a.LngLat(d.coords.longitude,d.coords.latitude);this._accuracyCircleMarker.setLngLat(_).addTo(this._map),this._userLocationDotMarker.setLngLat(_).addTo(this._map),this._accuracy=d.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},v.prototype._updateCircleRadius=function(){var d=this._map._container.clientHeight/2,_=this._map.unproject([0,d]),A=this._map.unproject([1,d]),M=_.distanceTo(A),R=Math.ceil(2*this._accuracy/M);this._circleElement.style.width=R+"px",this._circleElement.style.height=R+"px"},v.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},v.prototype._onError=function(d){if(this._map){if(this.options.trackUserLocation)if(d.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var _=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=_,this._geolocateButton.setAttribute("aria-label",_),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(d.code===3&&Jc)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new a.Event("error",d)),this._finish()}},v.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},v.prototype._setupUI=function(d){var _=this;if(this._container.addEventListener("contextmenu",function(R){return R.preventDefault()}),this._geolocateButton=c.create("button","mapboxgl-ctrl-geolocate",this._container),c.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",d===!1){a.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var A=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=A,this._geolocateButton.setAttribute("aria-label",A)}else{var M=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=M,this._geolocateButton.setAttribute("aria-label",M)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=c.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new Ah(this._dotElement),this._circleElement=c.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ah({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(R){R.geolocateSource||_._watchState!=="ACTIVE_LOCK"||R.originalEvent&&R.originalEvent.type==="resize"||(_._watchState="BACKGROUND",_._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),_._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),_.fire(new a.Event("trackuserlocationend")))})},v.prototype.trigger=function(){if(!this._setup)return a.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Tf--,Jc=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new a.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var d;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++Tf>1?(d={maximumAge:6e5,timeout:0},Jc=!0):(d=this.options.positionOptions,Jc=!1),this._geolocationWatchID=a.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,d)}}else a.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},v.prototype._clearWatch=function(){a.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},v}(a.Evented),Ec={maxWidth:100,unit:"metric"},Sc=function(p){this.options=a.extend({},Ec,p),a.bindAll(["_onMove","setUnit"],this)};function vu(p,v,d){var _=d&&d.maxWidth||100,A=p._container.clientHeight/2,M=p.unproject([0,A]),R=p.unproject([_,A]),B=M.distanceTo(R);if(d&&d.unit==="imperial"){var G=3.2808*B;G>5280?Wl(v,_,G/5280,p._getUIString("ScaleControl.Miles")):Wl(v,_,G,p._getUIString("ScaleControl.Feet"))}else d&&d.unit==="nautical"?Wl(v,_,B/1852,p._getUIString("ScaleControl.NauticalMiles")):B>=1e3?Wl(v,_,B/1e3,p._getUIString("ScaleControl.Kilometers")):Wl(v,_,B,p._getUIString("ScaleControl.Meters"))}function Wl(p,v,d,_){var A,M,R,B=(A=d,(M=Math.pow(10,(""+Math.floor(A)).length-1))*(R=(R=A/M)>=10?10:R>=5?5:R>=3?3:R>=2?2:R>=1?1:function(G){var J=Math.pow(10,Math.ceil(-Math.log(G)/Math.LN10));return Math.round(G*J)/J}(R)));p.style.width=v*(B/d)+"px",p.innerHTML=B+"&nbsp;"+_}Sc.prototype.getDefaultPosition=function(){return"bottom-left"},Sc.prototype._onMove=function(){vu(this._map,this._container,this.options)},Sc.prototype.onAdd=function(p){return this._map=p,this._container=c.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",p.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},Sc.prototype.onRemove=function(){c.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},Sc.prototype.setUnit=function(p){this.options.unit=p,vu(this._map,this._container,this.options)};var Mu=function(p){this._fullscreen=!1,p&&p.container&&(p.container instanceof a.window.HTMLElement?this._container=p.container:a.warnOnce("Full screen control 'container' must be a DOM element.")),a.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in a.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in a.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in a.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in a.window.document&&(this._fullscreenchange="MSFullscreenChange")};Mu.prototype.onAdd=function(p){return this._map=p,this._container||(this._container=this._map.getContainer()),this._controlContainer=c.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",a.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},Mu.prototype.onRemove=function(){c.remove(this._controlContainer),this._map=null,a.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},Mu.prototype._checkFullscreenSupport=function(){return!!(a.window.document.fullscreenEnabled||a.window.document.mozFullScreenEnabled||a.window.document.msFullscreenEnabled||a.window.document.webkitFullscreenEnabled)},Mu.prototype._setupUI=function(){var p=this._fullscreenButton=c.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);c.create("span","mapboxgl-ctrl-icon",p).setAttribute("aria-hidden",!0),p.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),a.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},Mu.prototype._updateTitle=function(){var p=this._getTitle();this._fullscreenButton.setAttribute("aria-label",p),this._fullscreenButton.title=p},Mu.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},Mu.prototype._isFullscreen=function(){return this._fullscreen},Mu.prototype._changeIcon=function(){(a.window.document.fullscreenElement||a.window.document.mozFullScreenElement||a.window.document.webkitFullscreenElement||a.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},Mu.prototype._onClickFullscreen=function(){this._isFullscreen()?a.window.document.exitFullscreen?a.window.document.exitFullscreen():a.window.document.mozCancelFullScreen?a.window.document.mozCancelFullScreen():a.window.document.msExitFullscreen?a.window.document.msExitFullscreen():a.window.document.webkitCancelFullScreen&&a.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var td={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},ef=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),Cf=function(p){function v(d){p.call(this),this.options=a.extend(Object.create(td),d),a.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return p&&(v.__proto__=p),(v.prototype=Object.create(p&&p.prototype)).constructor=v,v.prototype.addTo=function(d){return this._map&&this.remove(),this._map=d,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new a.Event("open")),this},v.prototype.isOpen=function(){return!!this._map},v.prototype.remove=function(){return this._content&&c.remove(this._content),this._container&&(c.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new a.Event("close")),this},v.prototype.getLngLat=function(){return this._lngLat},v.prototype.setLngLat=function(d){return this._lngLat=a.LngLat.convert(d),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},v.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},v.prototype.getElement=function(){return this._container},v.prototype.setText=function(d){return this.setDOMContent(a.window.document.createTextNode(d))},v.prototype.setHTML=function(d){var _,A=a.window.document.createDocumentFragment(),M=a.window.document.createElement("body");for(M.innerHTML=d;_=M.firstChild;)A.appendChild(_);return this.setDOMContent(A)},v.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},v.prototype.setMaxWidth=function(d){return this.options.maxWidth=d,this._update(),this},v.prototype.setDOMContent=function(d){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=c.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(d),this._createCloseButton(),this._update(),this._focusFirstElement(),this},v.prototype.addClassName=function(d){this._container&&this._container.classList.add(d)},v.prototype.removeClassName=function(d){this._container&&this._container.classList.remove(d)},v.prototype.setOffset=function(d){return this.options.offset=d,this._update(),this},v.prototype.toggleClassName=function(d){if(this._container)return this._container.classList.toggle(d)},v.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=c.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},v.prototype._onMouseUp=function(d){this._update(d.point)},v.prototype._onMouseMove=function(d){this._update(d.point)},v.prototype._onDrag=function(d){this._update(d.point)},v.prototype._update=function(d){var _=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=c.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=c.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(ve){return _._container.classList.add(ve)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=os(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||d)){var A=this._pos=this._trackPointer&&d?d:this._map.project(this._lngLat),M=this.options.anchor,R=function ve(ye){if(ye){if(typeof ye=="number"){var Oe=Math.round(Math.sqrt(.5*Math.pow(ye,2)));return{center:new a.Point(0,0),top:new a.Point(0,ye),"top-left":new a.Point(Oe,Oe),"top-right":new a.Point(-Oe,Oe),bottom:new a.Point(0,-ye),"bottom-left":new a.Point(Oe,-Oe),"bottom-right":new a.Point(-Oe,-Oe),left:new a.Point(ye,0),right:new a.Point(-ye,0)}}if(ye instanceof a.Point||Array.isArray(ye)){var Re=a.Point.convert(ye);return{center:Re,top:Re,"top-left":Re,"top-right":Re,bottom:Re,"bottom-left":Re,"bottom-right":Re,left:Re,right:Re}}return{center:a.Point.convert(ye.center||[0,0]),top:a.Point.convert(ye.top||[0,0]),"top-left":a.Point.convert(ye["top-left"]||[0,0]),"top-right":a.Point.convert(ye["top-right"]||[0,0]),bottom:a.Point.convert(ye.bottom||[0,0]),"bottom-left":a.Point.convert(ye["bottom-left"]||[0,0]),"bottom-right":a.Point.convert(ye["bottom-right"]||[0,0]),left:a.Point.convert(ye.left||[0,0]),right:a.Point.convert(ye.right||[0,0])}}return ve(new a.Point(0,0))}(this.options.offset);if(!M){var B,G=this._container.offsetWidth,J=this._container.offsetHeight;B=A.y+R.bottom.y<J?["top"]:A.y>this._map.transform.height-J?["bottom"]:[],A.x<G/2?B.push("left"):A.x>this._map.transform.width-G/2&&B.push("right"),M=B.length===0?"bottom":B.join("-")}var ce=A.add(R[M]).round();c.setTransform(this._container,mi[M]+" translate("+ce.x+"px,"+ce.y+"px)"),Sh(this._container,M,"popup")}},v.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var d=this._container.querySelector(ef);d&&d.focus()}},v.prototype._onClose=function(){this.remove()},v}(a.Evented),Pu={version:a.version,supported:u,setRTLTextPlugin:a.setRTLTextPlugin,getRTLTextPluginStatus:a.getRTLTextPluginStatus,Map:eu,NavigationControl:vs,GeolocateControl:ed,AttributionControl:Bo,ScaleControl:Sc,FullscreenControl:Mu,Popup:Cf,Marker:Ah,Style:Mi,LngLat:a.LngLat,LngLatBounds:a.LngLatBounds,Point:a.Point,MercatorCoordinate:a.MercatorCoordinate,Evented:a.Evented,config:a.config,prewarm:function(){Dt().acquire(kt)},clearPrewarmedResources:function(){var p=Sr;p&&(p.isPreloaded()&&p.numActive()===1&&(p.release(kt),Sr=null))},get accessToken(){return a.config.ACCESS_TOKEN},set accessToken(p){a.config.ACCESS_TOKEN=p},get baseApiUrl(){return a.config.API_URL},set baseApiUrl(p){a.config.API_URL=p},get workerCount(){return ir.workerCount},set workerCount(p){ir.workerCount=p},get maxParallelImageRequests(){return a.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(p){a.config.MAX_PARALLEL_IMAGE_REQUESTS=p},clearStorage:function(p){a.clearTileCache(p)},workerUrl:""};return Pu}),i})})(rL);var F$=rL.exports;const yy=jc(F$);var N$=function(){function e(){$t(this,e)}return Gt(e,[{key:"syncWithMapCamera",value:function(r){var n=r.center,i=r.zoom,o=r.pitch,a=r.bearing,u=r.viewportHeight,c=r.viewportWidth;this.viewport=new tL({width:c,height:u,longitude:n&&n[0],latitude:n&&n[1],zoom:i,pitch:o,bearing:a})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(r,n){return this.viewport.projectFlat(r,n)}}]),e}(),B$=["id","attributionControl","style","token","rotation","mapInstance"],pM,dM;function z$(e){var t=U$();return function(){var n=Ct(e),i;if(t){var o=Ct(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xn(this,i)}}function U$(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function V$(e,t){var r=typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx<"u"&&wx!==null&&(typeof wx.request<"u"||typeof wx.miniProgram<"u");if(!(r||n)&&(t||(t=document),!!t)){var i=t.head||t.getElementsByTagName("head")[0];if(!i){i=t.createElement("head");var o=t.body||t.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):t.documentElement.appendChild(i)}var a=t.createElement("style");return a.type="text/css",a.styleSheet?a.styleSheet.cssText=e:a.appendChild(t.createTextNode(e)),i.appendChild(a),a}}V$(`.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`);window.mapboxgl=yy;var j$=0,vM="101MlGsZ2AmmA&access_token=pk.eyJ1IjoiZXhhbXBsZXMiLCJhIjoiY2p0MG01MXRqMW45cjQzb2R6b2ptc3J4MSJ9.zA2W0IkI0c6KaAhJfk9bWg",$$=(pM=Ei(),pM(dM=function(e){yn(r,e);var t=z$(r);function r(){var n;$t(this,r);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return n=t.call.apply(t,[this].concat(o)),Q(Ye(n),"version",th.MAPBOX),n}return Gt(r,[{key:"getType",value:function(){return"mapbox"}},{key:"lngLatToCoord",value:function(i){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{x:0,y:0,z:0},a=this.lngLatToMercator(i,0),u=a.x,c=a.y;return[u-o.x,c-o.y]}},{key:"lngLatToMercator",value:function(i,o){var a=window.mapboxgl.MercatorCoordinate.fromLngLat(i,o),u=a.x,c=u===void 0?0:u,h=a.y,y=h===void 0?0:h,x=a.z,E=x===void 0?0:x;return{x:c,y,z:E}}},{key:"getModelMatrix",value:function(i,o,a){var u=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},h=window.mapboxgl.MercatorCoordinate.fromLngLat(i,o),y=h.meterInMercatorCoordinateUnits(),x=Tm();return jy(x,x,Kf(h.x-c.x,h.y-c.y,h.z||0-c.z)),$y(x,x,Kf(y*u[0],-y*u[1],y*u[2])),Bx(x,x,a[0]),KE(x,x,a[1]),QE(x,x,a[2]),x}},{key:"init",value:function(){var n=Vt(Ce.mark(function o(){var a=this,u,c,h,y,x,E,T,I,k,D,V,O,F;return Ce.wrap(function(H){for(;;)switch(H.prev=H.next){case 0:u=this.config,c=u.id,h=c===void 0?"map":c,y=u.attributionControl,x=y===void 0?!1:y,E=u.style,T=E===void 0?"light":E,I=u.token,k=I===void 0?vM:I,D=u.rotation,V=D===void 0?0:D,O=u.mapInstance,F=Zh(u,B$),this.viewport=new N$,!O&&window.mapboxgl,k===vM&&T!=="blank"&&window.mapboxgl.accessToken,!O&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=k),O?(this.map=O,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatMapContainer(h),this.map=new window.mapboxgl.Map(_t({container:this.$mapContainer,style:this.getMapStyleValue(T),attributionControl:x,bearing:V},F))),this.map.on("load",function(){a.handleCameraChanged()}),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 9:case"end":return H.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"destroy",value:function(){var i,o;(i=this.$mapContainer)===null||i===void 0||(o=i.parentNode)===null||o===void 0||o.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(i){for(var o,a=arguments.length,u=new Array(a>1?a-1:0),c=1;c<a;c++)u[c-1]=arguments[c];(o=this.eventEmitter).emit.apply(o,[i].concat(u))}},{key:"once",value:function(i){for(var o,a=arguments.length,u=new Array(a>1?a-1:0),c=1;c<a;c++)u[c-1]=arguments[c];(o=this.eventEmitter).once.apply(o,[i].concat(u))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"meterToCoord",value:function(i,o){var a=new yy.LngLat(i[0],i[1]),u=new yy.LngLat(o[0],o[1]),c=a.distanceTo(u),h=yy.MercatorCoordinate.fromLngLat({lng:i[0],lat:i[1]}),y=yy.MercatorCoordinate.fromLngLat({lng:o[0],lat:o[1]}),x=h.x,E=h.y,T=y.x,I=y.y,k=Math.sqrt(Math.pow(x-T,2)+Math.pow(E-I,2))*4194304*2;return k/c}},{key:"exportMap",value:function(i){var o=this.map.getCanvas(),a=i==="jpg"?o==null?void 0:o.toDataURL("image/jpeg"):o==null?void 0:o.toDataURL("image/png");return a}},{key:"creatMapContainer",value:function(i){var o=i;typeof i=="string"&&(o=document.getElementById(i));var a=document.createElement("div");return a.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,a.id="l7_mapbox_div"+j$++,o.appendChild(a),a}}]),r}(D$))||dM);function G$(e){var t=H$();return function(){var n=Ct(e),i;if(t){var o=Ct(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xn(this,i)}}function H$(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function W$(e,t){var r=typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx<"u"&&wx!==null&&(typeof wx.request<"u"||typeof wx.miniProgram<"u");if(!(r||n)&&(t||(t=document),!!t)){var i=t.head||t.getElementsByTagName("head")[0];if(!i){i=t.createElement("head");var o=t.body||t.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):t.documentElement.appendChild(i)}var a=t.createElement("style");return a.type="text/css",a.styleSheet?a.styleSheet.cssText=e:a.appendChild(t.createTextNode(e)),i.appendChild(a),a}}W$(`.mapboxgl-ctrl-logo {
 display: none !important;
}
`);var X$=function(e){yn(r,e);var t=G$(r);function r(){return $t(this,r),t.apply(this,arguments)}return Gt(r,[{key:"getServiceConstructor",value:function(){return $$}}]),r}(E$);function Y$(e,t){var r=[t[0]-e[0],t[1]-e[1]],n=BI(r),i=[e[0]+n[0]*1e-4,e[1]+n[1]*1e-4];return i}function q$(e,t,r){if(e.length>0&&t.version===th["GAODE2.x"]){var n=r.coordCenter;typeof e[0].coordinates[0]=="number"?e.filter(function(i){return!i.originCoordinates}).map(function(i){i.version=th["GAODE2.x"],i.originCoordinates=Er.cloneDeep(i.coordinates),i.coordinates=t.coordToAMap2RelativeCoordinates(i.coordinates,n)}):e.filter(function(i){return!i.originCoordinates}).map(function(i){i.version=th["GAODE2.x"],i.originCoordinates=Er.cloneDeep(i.coordinates),i.coordinates=t.coordToAMap2RelativeCoordinates(i.coordinates,n)})}}function Z$(e,t){e.length>0&&t.version===th.SIMPLE&&e.map(function(r){r.simpleCoordinate||(r.coordinates=K$(r.coordinates,t),r.simpleCoordinate=!0)})}function K$(e,t){if(typeof e[0]=="number")return t.simpleMapCoord.unproject(e);if(e[0]&&e[0][0]instanceof Array){var r=[];return e.map(function(i){var o=[];i.map(function(a){o.push(t.simpleMapCoord.unproject(a))}),r.push(o)}),r}else{var n=[];return e.map(function(i){n.push(t.simpleMapCoord.unproject(i))}),n}}function Q$(e,t){var r;if(!e.scale)return[];var n=(e==null||(r=e.scale)===null||r===void 0?void 0:r.scalers)||[],i=[];n.forEach(function(a){var u,c=a.field;(t.hasOwnProperty(c)||((u=e.scale)===null||u===void 0?void 0:u.type)==="variable")&&i.push(t[c])});var o=e.mapping?e.mapping(i):[];return o}function J$(e,t,r,n,i){var o=i==null?void 0:i.getLayerConfig(),a=o.arrow,u=a===void 0?{enable:!1}:a,c=t.map(function(h){var y={id:h._id,coordinates:h.coordinates};if(e.filter(function(T){return T.scale!==void 0}).forEach(function(T){var I=Q$(T,h);T.needRemapping=!1,T.name==="color"&&(I=I.map(function(k){return Da(k)})),y[T.name]=Array.isArray(I)&&I.length===1?I[0]:I,T.name==="shape"&&(y.shape=r.getIconFontKey(y[T.name]))}),y.shape==="line"&&u.enable){var x=y.coordinates,E=Y$(x[0],x[1]);y.coordinates.splice(1,0,E,E)}return y});return q$(c,n,i),Z$(c,n),c}function eG(e,t,r,n,i,o){var a=new fS(i,o),u=n.getLayerStyleAttributes()||[],c=a.data.dataArray,h=c,y=J$(u,h,t,r,e);return a.destroy(),y}function nL(e){return e.map(function(t){return typeof t=="string"&&(t=[t,{}]),t})}function iL(e,t,r,n){var i=e.multiPassRenderer,o=e.getLayerConfig(),a=o.enableTAA;return a?i.add(n("taa")):i.add(n("render")),nL(t).forEach(function(u){var c=ei(u,2),h=c[0],y=c[1];i.add(r(h),y)}),i.add(r("copy")),i}var tG=function(){function e(t){$t(this,e),this.layer=t}return Gt(e,[{key:"pickRender",value:function(r){var n=this.layer.getContainer(),i=n.get(Mt.ILayerService),o=this.layer;if(o.tileLayer)return o.tileLayer.pickRender(r);o.hooks.beforePickingEncode.call(),i.renderTileLayerMask(o),o.renderModels({ispick:!0}),o.hooks.afterPickingEncode.call()}},{key:"pick",value:function(r,n){var i=this.layer.getContainer(),o=i.get(Mt.IPickingService);return r.type==="RasterLayer"?this.pickRasterLayer(r,n):(this.pickRender(n),o.pickFromPickingFBO(r,n))}},{key:"pickRasterLayer",value:function(r,n,i){var o=this.layer.getContainer(),a=o.get(Mt.IPickingService),u=o.get(Mt.IMapService),c=this.layer.getSource().extent,h=kF(n.lngLat,c),y={x:n.x,y:n.y,type:n.type,lngLat:n.lngLat,target:n,rasterValue:null},x=i||r;if(h){var E=this.readRasterValue(r,c,u,n.x,n.y);return y.rasterValue=E,a.triggerHoverOnLayer(x,y),!0}else return y.type=n.type==="mousemove"?"mouseout":"un"+n.type,a.triggerHoverOnLayer(x,_t(_t({},y),{},{type:"unpick"})),a.triggerHoverOnLayer(x,y),!1}},{key:"readRasterValue",value:function(r,n,i,o,a){var u=r.getSource().data.dataArray[0],c=ei(n,4),h=c[0],y=h===void 0?0:h,x=c[1],E=x===void 0?0:x,T=c[2],I=T===void 0?10:T,k=c[3],D=k===void 0?-10:k,V=i.lngLatToContainer([y,E]),O=i.lngLatToContainer([I,D]),F=O.x-V.x,N=V.y-O.y,H=[(o-V.x)/F,(a-O.y)/N],q=u.width||1,Y=u.height||1,ee=Math.floor(H[0]*q),pe=Math.floor(H[1]*Y),ue=Math.max(0,pe-1)*q+ee,ie=u.data[ue];return ie}},{key:"selectFeature",value:function(r){var n=this.layer,i=ei(r,3),o=i[0],a=i[1],u=i[2];n.hooks.beforeSelect.call([o,a,u])}},{key:"highlightPickedFeature",value:function(r){var n=ei(r,3),i=n[0],o=n[1],a=n[2];this.layer.hooks.beforeHighlight.call([i,o,a])}},{key:"getFeatureById",value:function(r){return this.layer.getSource().getFeatureById(r)}}]),e}(),rG=function(){function e(t){$t(this,e),this.layer=t;var r=this.layer.getContainer();this.rendererService=r.get(Mt.IRendererService)}return Gt(e,[{key:"getColorTexture",value:function(r,n){var i=this.getTextureKey(r,n);return this.key===i?this.colorTexture:(this.createColorTexture(r,n),this.key=i,this.colorTexture)}},{key:"createColorTexture",value:function(r,n){var i=this.rendererService.createTexture2D,o=this.getColorRampBar(r,n),a=i({data:new Uint8Array(o.data),width:o.width,height:o.height,flipY:!1});return this.colorTexture=a,a}},{key:"setColorTexture",value:function(r,n,i){this.key=this.getTextureKey(n,i),this.colorTexture=r}},{key:"destroy",value:function(){var r;(r=this.colorTexture)===null||r===void 0||r.destroy()}},{key:"getColorRampBar",value:function(r,n){switch(r.type){case"cat":return dF(r);case"quantize":return vF(r);case"custom":return mF(r,n);case"linear":return pF(r,n);default:return LI(r)}}},{key:"getTextureKey",value:function(r,n){var i;return"".concat(r.colors.join("_"),"_").concat(r==null||(i=r.positions)===null||i===void 0?void 0:i.join("_"),"_").concat(r.type,"_").concat(n==null?void 0:n.join("_"))}}]),e}(),nG=["passes"],iG=["moduleName","vertexShader","fragmentShader","inject","triangulation","segmentNumber"],mM,a2,gM;function aG(e,t){var r=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=oG(e))||t&&e&&typeof e.length=="number"){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(h){throw h},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,a=!1,u;return{s:function(){r=r.call(e)},n:function(){var h=r.next();return o=h.done,h},e:function(h){a=!0,u=h},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(a)throw u}}}}function oG(e,t){if(e){if(typeof e=="string")return yM(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return yM(e,t)}}function yM(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function sG(e){var t=uG();return function(){var n=Ct(e),i;if(t){var o=Ct(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xn(this,i)}}function uG(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var _M=0,Mg=(mM=cS(Mt.IGlobalConfigService),a2=function(e){yn(r,e);var t=sG(r);function r(){var n,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return $t(this,r),n=t.call(this),Q(Ye(n),"id","".concat(_M++)),Q(Ye(n),"name","".concat(_M)),Q(Ye(n),"visible",!0),Q(Ye(n),"zIndex",0),Q(Ye(n),"inited",!1),Q(Ye(n),"layerModelNeedUpdate",!1),Q(Ye(n),"pickedFeatureID",null),Q(Ye(n),"selectedFeatureID",null),Q(Ye(n),"styleNeedUpdate",!1),Q(Ye(n),"forceRender",!1),Q(Ye(n),"clusterZoom",0),Q(Ye(n),"defaultSourceConfig",{data:[],options:{parser:{type:"json"}}}),Q(Ye(n),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),Q(Ye(n),"hooks",{init:new OU,afterInit:new f3,beforeRender:new f3,beforeRenderData:new DU,afterRender:new Rp,beforePickingEncode:new Rp,afterPickingEncode:new Rp,beforeHighlight:new Rp(["pickedColor"]),afterHighlight:new Rp,beforeSelect:new Rp(["pickedColor"]),afterSelect:new Rp,beforeDestroy:new Rp,afterDestroy:new Rp}),Q(Ye(n),"models",[]),Q(Ye(n),"startInit",!1),Q(Ye(n),"layerChildren",[]),Q(Ye(n),"masks",[]),Gi(Ye(n),"configService",gM,Ye(n)),Q(Ye(n),"animateOptions",{enable:!1}),Q(Ye(n),"currentPickId",null),Q(Ye(n),"encodeStyleAttribute",{}),Q(Ye(n),"enableEncodeStyles",[]),Q(Ye(n),"pendingStyleAttributes",[]),Q(Ye(n),"scaleOptions",{}),Q(Ye(n),"animateStatus",!1),Q(Ye(n),"isDestroyed",!1),Q(Ye(n),"encodeDataLength",0),Q(Ye(n),"sourceEvent",function(){n.dataState.dataSourceNeedUpdate=!0;var o=n.getLayerConfig();o&&o.autoFit&&n.fitBounds(o.fitBoundsOptions);var a=n.layerSource.getSourceCfg().autoRender;a&&n.reRender()}),n.name=i.name||n.id,n.zIndex=i.zIndex||0,n.rawConfig=i,n}return Gt(r,[{key:"addMask",value:function(i){this.masks.push(i),this.enableMask()}},{key:"removeMask",value:function(i){var o=this.masks.indexOf(i);o>-1&&this.masks.splice(o,1)}},{key:"disableMask",value:function(){this.updateLayerConfig({enableMask:!1})}},{key:"enableMask",value:function(){this.updateLayerConfig({enableMask:!0})}},{key:"addMaskLayer",value:function(i){this.masks.push(i)}},{key:"removeMaskLayer",value:function(i){var o=this.masks.indexOf(i);o>-1&&this.masks.splice(o,1),i.destroy()}},{key:"getAttribute",value:function(i){return this.styleAttributeService.getLayerStyleAttribute(i)}},{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(i){var o=this;if(Object.keys(i).map(function(u){u in o.rawConfig&&(o.rawConfig[u]=i[u])}),!this.startInit)this.needUpdateConfig=_t(_t({},this.needUpdateConfig),i);else{var a=this.container.get(Mt.SceneID);this.configService.setLayerConfig(a,this.id,_t(_t(_t({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),i)),this.needUpdateConfig={}}}},{key:"setContainer",value:function(i,o){this.container=i,this.sceneContainer=o}},{key:"getContainer",value:function(){return this.container}},{key:"addPlugin",value:function(i){return this.plugins.push(i),this}},{key:"init",value:function(){var n=Vt(Ce.mark(function o(){var a=this,u,c,h,y,x,E,T;return Ce.wrap(function(k){for(;;)switch(k.prev=k.next){case 0:u=this.container.get(Mt.SceneID),this.startInit=!0,this.configService.setLayerConfig(u,this.id,this.rawConfig),this.layerType=this.rawConfig.layerType,this.iconService=this.container.get(Mt.IIconService),this.fontService=this.container.get(Mt.IFontService),this.rendererService=this.container.get(Mt.IRendererService),this.layerService=this.container.get(Mt.ILayerService),this.debugService=this.container.get(Mt.IDebugService),this.interactionService=this.container.get(Mt.IInteractionService),this.pickingService=this.container.get(Mt.IPickingService),this.mapService=this.container.get(Mt.IMapService),c=this.getLayerConfig(),h=c.enableMultiPassRenderer,y=c.passes,h&&y!==null&&y!==void 0&&y.length&&y.length>0&&this.mapService.on("mapAfterFrameChange",function(){a.renderLayers()}),this.cameraService=this.container.get(Mt.ICameraService),this.coordinateService=this.container.get(Mt.ICoordinateSystemService),this.shaderModuleService=this.container.get(Mt.IShaderModuleService),this.postProcessingPassFactory=this.container.get(Mt.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(Mt.IFactoryNormalPass),this.styleAttributeService=this.container.get(Mt.IStyleAttributeService),h&&(this.multiPassRenderer=this.container.get(Mt.IMultiPassRenderer),this.multiPassRenderer.setLayer(this)),this.pendingStyleAttributes.forEach(function(D){var V=D.attributeName,O=D.attributeField,F=D.attributeValues,N=D.updateOptions;a.styleAttributeService.updateStyleAttribute(V,{scale:_t({field:O},a.splitValuesAndCallbackInAttribute(F,a.getLayerConfig()[V]))},N)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(Mt.ILayerPlugin),x=aG(this.plugins);try{for(x.s();!(E=x.n()).done;)T=E.value,T.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}catch(D){x.e(D)}finally{x.f()}return this.layerPickService=new tG(this),this.textureService=new rG(this),this.log($s.LayerInitStart),k.next=31,this.hooks.init.promise();case 31:this.log($s.LayerInitEnd),this.inited=!0,this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this.hooks.afterInit.call();case 36:case"end":return k.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"log",value:function(i){var o,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"init";if(!(this.tileLayer||this.isTileLayer)){var u="".concat(this.id,".").concat(a,".").concat(i),c={id:this.id,type:this.type};(o=this.debugService)===null||o===void 0||o.log(u,c)}}},{key:"updateModelData",value:function(i){i.attributes&&i.elements&&this.models.map(function(o){o.updateAttributesAndElements(i.attributes,i.elements)})}},{key:"createModelData",value:function(i,o){var a;if((a=this.layerModel)!==null&&a!==void 0&&a.createModelData)return this.layerModel.createModelData(o);var u=this.calculateEncodeData(i,o),c=this.triangulation;return u&&c?this.styleAttributeService.createAttributesAndIndices(u,c):{attributes:void 0,elements:void 0}}},{key:"setLayerPickService",value:function(i){this.layerPickService=i}},{key:"calculateEncodeData",value:function(i,o){return this.inited?eG(this,this.fontService,this.mapService,this.styleAttributeService,i,o):null}},{key:"prepareBuildModel",value:function(){Object.keys(this.needUpdateConfig||{}).length!==0&&this.updateLayerConfig({});var i=this.getLayerConfig(),o=i.animateOption;o!=null&&o.enable&&(this.layerService.startAnimate(),this.animateStatus=!0)}},{key:"color",value:function(i,o,a){return this.updateStyleAttribute("color",i,o,a),this}},{key:"texture",value:function(i,o,a){return this.updateStyleAttribute("texture",i,o,a),this}},{key:"rotate",value:function(i,o,a){return this.updateStyleAttribute("rotate",i,o,a),this}},{key:"size",value:function(i,o,a){return this.updateStyleAttribute("size",i,o,a),this}},{key:"filter",value:function(i,o,a){var u=this.updateStyleAttribute("filter",i,o,a);return this.dataState.dataSourceNeedUpdate=u&&this.inited,this}},{key:"shape",value:function(i,o,a){this.shapeOption={field:i,values:o};var u=this.updateStyleAttribute("shape",i,o,a);return this.dataState.dataSourceNeedUpdate=u&&this.inited,this}},{key:"label",value:function(i,o,a){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:i,attributeValues:o,updateOptions:a}),this}},{key:"animate",value:function(i){var o={};return Er.isObject(i)?(o.enable=!0,o=_t(_t({},o),i)):o.enable=i,this.updateLayerConfig({animateOption:o}),this}},{key:"source",value:function(i,o){return(i==null?void 0:i.type)==="source"?(this.setSource(i),this):(this.sourceOption={data:i,options:o},this.clusterZoom=0,this)}},{key:"setData",value:function(i,o){var a=this;return this.inited?(this.log($s.SourceInitStart,Hs.UPDATE),this.layerSource.setData(i,o),this.log($s.SourceInitEnd,Hs.UPDATE)):this.on("inited",function(){a.log($s.SourceInitStart,Hs.UPDATE);var u=a.getSource();u?a.layerSource.setData(i,o):a.source(new fS(i,o)),a.layerSource.once("update",function(){a.log($s.SourceInitEnd,Hs.UPDATE)})}),this}},{key:"style",value:function(i){var o=this,a=i.passes,u=Zh(i,nG);a&&nL(a).forEach(function(h){var y=o.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(h[0]);y&&y.updateOptions(h[1])});var c=u;return Object.keys(u).forEach(function(h){var y=u[h];Array.isArray(y)&&y.length===2&&!Er.isNumber(y[0])&&!Er.isNumber(y[1])&&(c[h]={field:y[0],value:y[1]})}),this.encodeStyle(c),this.updateLayerConfig(c),this}},{key:"encodeStyle",value:function(i){var o=this;Object.keys(i).forEach(function(a){o.enableEncodeStyles.includes(a)&&Er.isPlainObject(i[a])&&(i[a].field||i[a].value)&&!Er.isEqual(o.encodeStyleAttribute[a],i[a])?(o.encodeStyleAttribute[a]=i[a],o.updateStyleAttribute(a,i[a].field,i[a].value),o.styleNeedUpdate=!0):o.encodeStyleAttribute[a]&&delete o.encodeStyleAttribute[a]})}},{key:"scale",value:function(i,o){var a=_t({},this.scaleOptions);if(Er.isObject(i)?this.scaleOptions=_t(_t({},this.scaleOptions),i):this.scaleOptions[i]=o,this.styleAttributeService&&!Er.isEqual(a,this.scaleOptions)){var u=Er.isObject(i)?i:Q({},i,o);this.styleAttributeService.updateScaleAttribute(u)}return this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.reRender(),this.rendering=!1}},{key:"render",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.tileLayer?(this.tileLayer.render(),this):(this.layerService.beforeRenderData(this),this.encodeDataLength<=0&&!this.forceRender?this:(this.renderModels(i),this))}},{key:"renderMultiPass",value:function(){var n=Vt(Ce.mark(function o(){return Ce.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(!(this.encodeDataLength<=0&&!this.forceRender)){u.next=2;break}return u.abrupt("return");case 2:if(!(this.multiPassRenderer&&this.multiPassRenderer.getRenderFlag())){u.next=7;break}return u.next=5,this.multiPassRenderer.render();case 5:u.next=8;break;case 7:this.multiPassRenderer?this.renderModels():this.renderModels();case 8:case"end":return u.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"active",value:function(i){var o={};return o.enableHighlight=Er.isObject(i)?!0:i,Er.isObject(i)?(o.enableHighlight=!0,i.color&&(o.highlightColor=i.color),i.mix&&(o.activeMix=i.mix)):o.enableHighlight=!!i,this.updateLayerConfig(o),this}},{key:"setActive",value:function(i,o){var a=this;if(Er.isObject(i)){var u=i.x,c=u===void 0?0:u,h=i.y,y=h===void 0?0:h;this.updateLayerConfig({highlightColor:Er.isObject(o)?o.color:this.getLayerConfig().highlightColor,activeMix:Er.isObject(o)?o.mix:this.getLayerConfig().activeMix}),this.pick({x:c,y})}else this.updateLayerConfig({pickedFeatureID:i,highlightColor:Er.isObject(o)?o.color:this.getLayerConfig().highlightColor,activeMix:Er.isObject(o)?o.mix:this.getLayerConfig().activeMix}),this.hooks.beforeHighlight.call(Dd(i)).then(function(){setTimeout(function(){a.reRender()},1)})}},{key:"select",value:function(i){var o={};return o.enableSelect=Er.isObject(i)?!0:i,Er.isObject(i)?(o.enableSelect=!0,i.color&&(o.selectColor=i.color),i.mix&&(o.selectMix=i.mix)):o.enableSelect=!!i,this.updateLayerConfig(o),this}},{key:"setSelect",value:function(i,o){var a=this;if(Er.isObject(i)){var u=i.x,c=u===void 0?0:u,h=i.y,y=h===void 0?0:h;this.updateLayerConfig({selectColor:Er.isObject(o)?o.color:this.getLayerConfig().selectColor,selectMix:Er.isObject(o)?o.mix:this.getLayerConfig().selectMix}),this.pick({x:c,y})}else this.updateLayerConfig({pickedFeatureID:i,selectColor:Er.isObject(o)?o.color:this.getLayerConfig().selectColor,selectMix:Er.isObject(o)?o.mix:this.getLayerConfig().selectMix}),this.hooks.beforeSelect.call(Dd(i)).then(function(){setTimeout(function(){a.reRender()},1)})}},{key:"setBlend",value:function(i){return this.updateLayerConfig({blend:i}),this.reRender(),this}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this.emit("show"),this}},{key:"hide",value:function(){return this.updateLayerConfig({visible:!1}),this.reRender(),this.emit("hide"),this}},{key:"setIndex",value:function(i){return this.zIndex=i,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}},{key:"setCurrentPickId",value:function(i){this.currentPickId=i}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(i){this.selectedFeatureID=i}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var i=this.mapService.getZoom(),o=this.getLayerConfig(),a=o.visible,u=o.minZoom,c=u===void 0?-1/0:u,h=o.maxZoom,y=h===void 0?1/0:h;return!!a&&i>=c&&i<y}},{key:"setMultiPass",value:function(i,o){if(this.updateLayerConfig({enableMultiPassRenderer:i}),o&&this.updateLayerConfig({passes:o}),i){var a=this.getLayerConfig(),u=a.passes,c=u===void 0?[]:u;this.multiPassRenderer=iL(this,c,this.postProcessingPassFactory,this.normalPassFactory),this.multiPassRenderer.setRenderFlag(!0);var h=this.rendererService.getViewportSize(),y=h.width,x=h.height;this.multiPassRenderer.resize(y,x)}return this}},{key:"setMinZoom",value:function(i){return this.updateLayerConfig({minZoom:i}),this}},{key:"getMinZoom",value:function(){var i=this.getLayerConfig(),o=i.minZoom;return o}},{key:"getMaxZoom",value:function(){var i=this.getLayerConfig(),o=i.maxZoom;return o}},{key:"get",value:function(i){var o=this.getLayerConfig();return o[i]}},{key:"setMaxZoom",value:function(i){return this.updateLayerConfig({maxZoom:i}),this}},{key:"setAutoFit",value:function(i){return this.updateLayerConfig({autoFit:i}),this}},{key:"fitBounds",value:function(i){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var o=this.getSource(),a=o.extent,u=a.some(function(c){return Math.abs(c)===1/0});return u?this:(this.mapService.fitBounds([[a[0],a[1]],[a[2],a[3]]],i),this)}},{key:"destroy",value:function(){var i,o,a,u,c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;if(!this.isDestroyed){this.layerChildren.map(function(x){return x.destroy(!1)}),this.layerChildren=[];var h=this.getLayerConfig(),y=h.maskfence;y&&(this.masks.map(function(x){return x.destroy(!1)}),this.masks=[]),this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),(i=this.multiPassRenderer)===null||i===void 0||i.destroy(),this.textureService.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),(o=this.layerModel)===null||o===void 0||o.clearModels(c),(a=this.tileLayer)===null||a===void 0||a.destroy(),this.models=[],(u=this.debugService)===null||u===void 0||u.removeLog(this.id),this.emit("remove",{target:this,type:"remove"}),this.emit("destroy",{target:this,type:"destroy"}),this.removeAllListeners(),this.isDestroyed=!0}}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){var i;this.models.forEach(function(o){return o.destroy()}),(i=this.layerModel)===null||i===void 0||i.clearModels(),this.models=[]}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(function(i){return i.needRescale||i.needRemapping||i.needRegenerateVertices}).length}},{key:"setSource",value:function(i){var o=this;if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=i,this.clusterZoom=0,this.inited&&this.layerSource.cluster){var a=this.mapService.getZoom();this.layerSource.updateClusterData(a)}this.layerSource.inited&&this.sourceEvent(),this.layerSource.on("update",function(u){var c=u.type;if(o.coordCenter===void 0){var h,y=o.layerSource.center;o.coordCenter=y,(h=o.mapService)!==null&&h!==void 0&&h.setCoordCenter&&o.mapService.setCoordCenter(y)}if(c==="update"){if(o.tileLayer){o.tileLayer.reload();return}o.sourceEvent()}})}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(i){this.encodedData=i,this.encodeDataLength=i.length}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getScale",value:function(i){return this.styleAttributeService.getLayerAttributeScale(i)}},{key:"getLegend",value:function(i){var o,a,u,c=this.styleAttributeService.getLayerStyleAttribute(i),h=(c==null||(o=c.scale)===null||o===void 0?void 0:o.scalers)||[];return{type:(a=h[0].option)===null||a===void 0?void 0:a.type,field:c==null||(u=c.scale)===null||u===void 0?void 0:u.field,items:this.getLegendItems(i)}}},{key:"getLegendItems",value:function(i){var o=this.styleAttributeService.getLayerAttributeScale(i);if(!o)return[];if(o.invertExtent){var a=o.range().map(function(h){return Q({value:o.invertExtent(h)},i,h)});return a}else if(o.ticks){var u=o.ticks().map(function(h){return Q({value:h},i,o(h))});return u}else if(o!=null&&o.domain){var c=o.domain().filter(function(h){return!Er.isUndefined(h)}).map(function(h){return Q({value:h},i,o(h))});return c}return[]}},{key:"pick",value:function(i){var o=i.x,a=i.y;this.interactionService.triggerHover({x:o,y:a})}},{key:"boxSelect",value:function(i,o){this.pickingService.boxPickLayer(this,i,o)}},{key:"buildLayerModel",value:function(){var n=Vt(Ce.mark(function o(a){var u=this,c,h,y,x,E,T,I,k,D,V,O,F;return Ce.wrap(function(H){for(;;)switch(H.prev=H.next){case 0:return c=a.moduleName,h=a.vertexShader,y=a.fragmentShader,x=a.inject,E=a.triangulation,T=a.segmentNumber,I=Zh(a,iG),this.shaderModuleService.registerModule(c,{vs:h,fs:y,inject:x}),k=this.shaderModuleService.getModule(c),D=k.vs,V=k.fs,O=k.uniforms,F=this.rendererService.createModel,H.abrupt("return",new Promise(function(q){var Y=u.styleAttributeService.createAttributesAndIndices(u.encodedData,E,T),ee=Y.attributes,pe=Y.elements,ue=Y.count,ie=_t({attributes:ee,uniforms:O,fs:V,vs:D,elements:pe,blend:KR[Lp.normal]},I);ue&&(ie.count=ue);var xe=F(ie);q(xe)}));case 5:case"end":return H.stop()}},o,this)}));function i(o){return n.apply(this,arguments)}return i}()},{key:"createAttributes",value:function(i){var o=i.triangulation,a=this.styleAttributeService.createAttributes(this.encodedData,o),u=a.attributes;return u}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.animateStatus&&(this.layerService.stopAnimate(),this.animateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(i){var o=this.getLayerConfig(),a=o.enableHighlight,u=a===void 0?!0:a,c=o.enableSelect,h=c===void 0?!0:c,y=this.eventNames().indexOf(i)!==-1||this.eventNames().indexOf("un"+i)!==-1;return(i==="click"||i==="dblclick")&&h&&(y=!0),i==="mousemove"&&(u||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(y=!0),this.isVisible()&&y}},{key:"buildModels",value:function(){var n=Vt(Ce.mark(function o(){return Ce.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return u.stop()}},o)}));function i(){return n.apply(this,arguments)}return i}()},{key:"rebuildModels",value:function(){var n=Vt(Ce.mark(function o(){return Ce.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,this.buildModels();case 2:case"end":return u.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"renderMulPass",value:function(){var n=Vt(Ce.mark(function o(a){return Ce.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,a.render();case 2:case"end":return c.stop()}},o)}));function i(o){return n.apply(this,arguments)}return i}()},{key:"renderModels",value:function(){var i=this,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.encodeDataLength<=0&&!this.forceRender?(this.clearModels(),this):(this.hooks.beforeRender.call(),this.models.forEach(function(a){a.draw({uniforms:i.layerModel.getUninforms(),blend:i.layerModel.getBlend(),stencil:i.layerModel.getStencil(o)},(o==null?void 0:o.ispick)||!1)}),this.hooks.afterRender.call(),this)}},{key:"updateStyleAttribute",value:function(i,o,a,u){var c=this.configService.getAttributeConfig(this.id)||{};return Er.isEqual(c[i],{field:o,values:a})?!1:(["color","size","texture","rotate","filter","label","shape"].indexOf(i)!==-1&&this.configService.setAttributeConfig(this.id,Q({},i,{field:o,values:a})),this.startInit?this.styleAttributeService.updateStyleAttribute(i,{scale:_t({field:o},this.splitValuesAndCallbackInAttribute(a,this.getLayerConfig()[o]))},u):this.pendingStyleAttributes.push({attributeName:i,attributeField:o,attributeValues:a,updateOptions:u}),!0)}},{key:"getLayerAttributeConfig",value:function(){return this.configService.getAttributeConfig(this.id)}},{key:"getShaderPickStat",value:function(){return this.layerService.getShaderPickStat()}},{key:"setEarthTime",value:function(i){}},{key:"processData",value:function(i){return i}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"initLayerModels",value:function(){var n=Vt(Ce.mark(function o(){return Ce.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return this.models.forEach(function(c){return c.destroy()}),this.models=[],u.next=4,this.layerModel.initModels();case 4:this.models=u.sent;case 5:case"end":return u.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"reRender",value:function(){this.inited&&this.layerService.reRender()}},{key:"splitValuesAndCallbackInAttribute",value:function(i,o){return{values:Er.isFunction(i)?void 0:i||o,callback:Er.isFunction(i)?i:void 0}}}]),r}(tc.EventEmitter),gM=Ui(a2.prototype,"configService",[mM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a2);function lG(e,t){return{enable:e,mask:255,func:{cmp:ae.EQUAL,ref:t?1:0,mask:1}}}function xM(e){return e.maskOperation===Z0.OR?{enable:!0,mask:255,func:{cmp:ae.ALWAYS,ref:1,mask:255},opFront:{fail:ae.KEEP,zfail:ae.REPLACE,zpass:ae.REPLACE}}:{enable:!0,mask:255,func:{cmp:e.stencilType===Pd.SINGLE||e.stencilIndex===0?ae.ALWAYS:ae.LESS,ref:e.stencilType===Pd.SINGLE?1:e.stencilIndex===0?2:1,mask:255},opFront:{fail:ae.KEEP,zfail:ae.REPLACE,zpass:ae.REPLACE}}}function cG(e){switch(e){case"stroke":return{name:"stroke",type:gn.Attribute,descriptor:{name:"a_Stroke",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:4,update:function(r){var n=r.stroke,i=n===void 0?[1,1,1,1]:n;return i}}};case"opacity":return{name:"opacity",type:gn.Attribute,descriptor:{name:"a_Opacity",buffer:{usage:ae.STATIC_DRAW,data:[],type:ae.FLOAT},size:1,update:function(r){var n=r.opacity,i=n===void 0?1:n;return[i]}}};case"offsets":return{name:"offsets",type:gn.Attribute,descriptor:{name:"a_Offsets",buffer:{usage:ae.STATIC_DRAW,data:[],type:ae.FLOAT},size:2,update:function(r){var n=r.offsets;return n}}};default:return}}var bM,o2,wM,Co=(bM=cS(Mt.IGlobalConfigService),o2=function(){function e(t){$t(this,e),Q(this,"preStyleAttribute",{}),Q(this,"encodeStyleAttribute",{}),Gi(this,"configService",wM,this),this.layer=t,this.rendererService=t.getContainer().get(Mt.IRendererService),this.pickingService=t.getContainer().get(Mt.IPickingService),this.shaderModuleService=t.getContainer().get(Mt.IShaderModuleService),this.styleAttributeService=t.getContainer().get(Mt.IStyleAttributeService),this.mapService=t.getContainer().get(Mt.IMapService),this.iconService=t.getContainer().get(Mt.IIconService),this.fontService=t.getContainer().get(Mt.IFontService),this.cameraService=t.getContainer().get(Mt.ICameraService),this.layerService=t.getContainer().get(Mt.ILayerService),this.registerStyleAttribute(),this.registerBuiltinAttributes(),this.startModelAnimate();var r=this.rendererService.createTexture2D;this.createTexture2D=r}return Gt(e,[{key:"getBlend",value:function(){var r=this.layer.getLayerConfig(),n=r.blend,i=n===void 0?"normal":n;return KR[Lp[i]]}},{key:"getStencil",value:function(r){var n=this.layer.getLayerConfig(),i=n.mask,o=i===void 0?!1:i,a=n.maskInside,u=a===void 0?!0:a,c=n.enableMask,h=n.maskOperation,y=h===void 0?Z0.AND:h;if(this.layer.type==="MaskLayer")return xM({isStencil:!0,stencilType:Pd.SINGLE});if(r.isStencil)return xM(_t(_t({},r),{},{maskOperation:y}));var x=o||c&&this.layer.masks.length!==0||this.layer.tileMask!==void 0;return lG(x,u)}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){var t=Vt(Ce.mark(function n(){return Ce.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",!1);case 1:case"end":return o.stop()}},n)}));function r(){return t.apply(this,arguments)}return r}()},{key:"buildModels",value:function(){var t=Vt(Ce.mark(function n(){return Ce.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return o.stop()}},n)}));function r(){return t.apply(this,arguments)}return r}()},{key:"initModels",value:function(){var t=Vt(Ce.mark(function n(){return Ce.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return o.stop()}},n)}));function r(){return t.apply(this,arguments)}return r}()},{key:"clearModels",value:function(){}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(r){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(r){return[r.enable?0:1,r.duration||4,r.interval||.2,r.trailLength||.1]}},{key:"startModelAnimate",value:function(){var r=this.layer.getLayerConfig(),n=r.animateOption;n.enable&&this.layer.setAnimateStartTime()}},{key:"getInject",value:function(){var r=this.layer.encodeStyleAttribute,n="",i={opacity:"float",stroke:"vec4",offsets:"vec2",textOffset:"vec2"};this.layer.enableEncodeStyles.forEach(function(a){r[a]&&(n+="#define USE_ATTRIBUTE_".concat(a.toUpperCase(),` 0.0; 

`)),n+=`
      #ifdef USE_ATTRIBUTE_`.concat(a.toUpperCase(),`
  attribute `).concat(i[a]," a_").concat(a.charAt(0).toUpperCase()+a.slice(1),`;
#else
  uniform `).concat(i[a]," u_").concat(a,`;
#endif

`)});var o="";return this.layer.enableEncodeStyles.forEach(function(a){o+=`

#ifdef USE_ATTRIBUTE_`.concat(a.toUpperCase(),`
  `).concat(i[a]," ").concat(a,"  = a_").concat(a.charAt(0).toUpperCase()+a.slice(1),`;
#else
  `).concat(i[a]," ").concat(a," = u_").concat(a,`;
#endif

`)}),{"vs:#decl":n,"vs:#main-start":o}}},{key:"getStyleAttribute",value:function(){var r=this,n={},i={opacity:1,stroke:[1,0,0,1],offsets:[0,0]};return this.layer.enableEncodeStyles.forEach(function(o){if(!r.layer.encodeStyleAttribute[o]){var a=r.layer.getLayerConfig()[o],u=typeof a>"u"?i[o]:a;o==="stroke"&&(u=Da(u)),n["u_"+o]=u}}),n}},{key:"registerStyleAttribute",value:function(){var r=this;Object.keys(this.layer.encodeStyleAttribute).forEach(function(n){var i=cG(n);i&&r.styleAttributeService.registerStyleAttribute(i)})}},{key:"updateEncodeAttribute",value:function(r,n){this.encodeStyleAttribute[r]=n}}]),e}(),wM=Ui(o2.prototype,"configService",[bM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),o2),J1=function(e){return e.VERTICAL="vertical",e.HORIZONTAL="horizontal",e}({}),fG=function(e){return e.NORMAL="normal",e.REPLACE="replace",e}({}),dS=function(e){return e[e.pixel=0]="pixel",e[e.meter=1]="meter",e}({}),vS=100;function EM(e){return e/180*Math.acos(-1)}function aL(e){var t=EM(e[0])+Math.PI/2,r=EM(e[1]),n=vS+Math.random()*.4,i=n*Math.cos(r)*Math.cos(t),o=n*Math.cos(r)*Math.sin(t),a=n*Math.sin(r);return[o,a,i]}var o1=ca();ca();var uu=ca(),hv=ca(),w0=ca();function s2(e,t,r,n,i){Ds(e,r,n),Up(e,e),t=W0(-e[1],e[0]);var o=W0(-r[1],r[0]);return[i/Tv(t,o),t]}function pv(e,t){return gR(e,-t[1],t[0])}function E0(e,t,r){return X0(e,t,r),Up(e,e),e}function u2(e,t){return e[0]===t[0]&&e[1]===t[1]}var hG=function(){function e(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};$t(this,e),Q(this,"lastFlip",-1),Q(this,"miter",W0(0,0)),Q(this,"started",!1),Q(this,"dash",!1),Q(this,"totalDistance",0),Q(this,"currentIndex",0),this.join=t.join||"miter",this.cap=t.cap||"butt",this.miterLimit=t.miterLimit||10,this.thickness=t.thickness||1,this.dash=t.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return Gt(e,[{key:"simpleExtrude",value:function(r){var n=this.complex;if(r.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var i=r.length,o=n.startIndex,a=1;a<i;a++){var u=r[a-1],c=r[a],h=a<r.length-1?r[a+1]:null,y=this.simpleSegment(n,o,u,c,h);o+=y}if(this.dash)for(var x=0;x<n.positions.length/6;x++)n.positions[x*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleExtrude_gaode2",value:function(r,n){var i=this.complex;if(r.length<=1)return i;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var o=r.length,a=i.startIndex,u=1;u<o;u++){var c,h,y,x=r[u-1];x.push((c=n[u-1][2])!==null&&c!==void 0?c:0);var E=n[u-1],T=r[u];T.push((h=n[u][2])!==null&&h!==void 0?h:0);var I=n[u],k=u<r.length-1?[].concat(cn(r[u+1]),[(y=n[u+1][2])!==null&&y!==void 0?y:0]):null,D=u<n.length-1?n[u+1]:null,V=this.simpleSegment(i,a,x,T,k,E,I,D);a+=V}if(this.dash)for(var O=0;O<i.positions.length/6;O++)i.positions[O*6+5]=this.totalDistance;return i.startIndex=i.positions.length/6,i}},{key:"extrude_gaode2",value:function(r,n){var i=this.complex;if(r.length<=1)return i;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var o=r.length,a=i.startIndex,u=1;u<o;u++){var c,h,y,x=r[u-1];x.push((c=n[u-1][2])!==null&&c!==void 0?c:0);var E=n[u-1],T=r[u];T.push((h=n[u][2])!==null&&h!==void 0?h:0);var I=n[u],k=u<r.length-1?[].concat(cn(r[u+1]),[(y=n[u+1][2])!==null&&y!==void 0?y:0]):null,D=u<n.length-1?n[u+1]:null,V=this.segment_gaode2(i,a,x,T,k,E,I,D);a+=V}if(this.dash)for(var O=0;O<i.positions.length/6;O++)i.positions[O*6+5]=this.totalDistance;return i.startIndex=i.positions.length/6,i}},{key:"extrude",value:function(r){var n=this.complex;if(r.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var i=r.length,o=n.startIndex,a=1;a<i;a++){var u=r[a-1],c=r[a],h=a<r.length-1?r[a+1]:null,y=this.segment(n,o,u,c,h);o+=y}if(this.dash)for(var x=0;x<n.positions.length/6;x++)n.positions[x*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleSegment",value:function(r,n,i,o,a){var u=0,c=r.indices,h=r.positions,y=r.normals,x=Vu([o[0],o[1]]),E=Vu([i[0],i[1]]);E0(uu,x,E);var T=0;if(this.dash&&(T=this.lineSegmentDistance(x,E),this.totalDistance+=T),this.normal||(this.normal=ca(),pv(this.normal,uu)),this.started||(this.started=!0,this.extrusions(h,y,i,this.normal,this.thickness,this.totalDistance-T)),c.push(n+0,n+1,n+2),!a)pv(this.normal,uu),this.extrusions(h,y,o,this.normal,this.thickness,this.totalDistance),c.push.apply(c,cn(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),u+=2;else{var I=Vu([a[0],a[1]]);u2(x,I)&&Ds(I,x,Up(I,Rm(I,x,E))),E0(hv,I,x);var k=s2(w0,ca(),uu,hv,this.thickness),D=ei(k,2),V=D[0],O=D[1],F=Tv(w0,this.normal)<0?-1:1;this.extrusions(h,y,o,O,V,this.totalDistance),c.push.apply(c,cn(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),F=-1,Dp(this.normal,O),u+=2,this.lastFlip=F}return u}},{key:"segment_gaode2",value:function(r,n,i,o,a,u,c,h){var y=0,x=r.indices,E=r.positions,T=r.normals,I=this.cap==="square",k=this.join==="bevel",D=Vu([c[0],c[1]]),V=Vu([u[0],u[1]]);E0(uu,o,i);var O=0;if(this.dash&&(O=this.lineSegmentDistance(D,V),this.totalDistance+=O),this.normal||(this.normal=ca(),pv(this.normal,uu)),!this.started)if(this.started=!0,I){var F=ca(),N=ca();Ds(F,this.normal,uu),Ds(N,this.normal,uu),T.push(N[0],N[1],0),T.push(F[0],F[1],0),E.push(i[0],i[1],i[2]|0,this.totalDistance-O,-this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),E.push(i[0],i[1],i[2]|0,this.totalDistance-O,this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(E,T,i,this.normal,this.thickness,this.totalDistance-O);if(x.push(n+0,n+1,n+2),a){u2(o,a)&&Ds(a,o,Up(a,Rm(a,o,i))),E0(hv,a,o);var Y=s2(w0,ca(),uu,hv,this.thickness),ee=ei(Y,2),pe=ee[0],ue=ee[1],ie=Tv(w0,this.normal)<0?-1:1,xe=k;if(!xe&&this.join==="miter"){var Se=pe;Se>this.miterLimit&&(xe=!0)}xe?(T.push(this.normal[0],this.normal[1],0),T.push(ue[0],ue[1],0),E.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*ie,o[2]|0),this.complex.indexes.push(this.currentIndex),E.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness*ie,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,x.push.apply(x,cn(this.lastFlip!==-ie?[n,n+2,n+3]:[n+2,n+1,n+3])),x.push(n+2,n+3,n+4),pv(o1,hv),Dp(this.normal,o1),T.push(this.normal[0],this.normal[1],0),E.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*ie,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,y+=3):(this.extrusions(E,T,o,ue,pe,this.totalDistance),x.push.apply(x,cn(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),ie=-1,Dp(this.normal,ue),y+=2),this.lastFlip=ie}else{if(pv(this.normal,uu),I){var H=ca(),q=ca();X0(q,uu,this.normal),Ds(H,uu,this.normal),T.push(q[0],q[1],0),T.push(H[0],H[1],0),E.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),E.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(E,T,o,this.normal,this.thickness,this.totalDistance);x.push.apply(x,cn(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),y+=2}return y}},{key:"segment",value:function(r,n,i,o,a){var u=0,c=r.indices,h=r.positions,y=r.normals,x=this.cap==="square",E=this.join==="bevel",T=Vu([o[0],o[1]]),I=Vu([i[0],i[1]]);E0(uu,T,I);var k=0;if(this.dash&&(k=this.lineSegmentDistance(T,I),this.totalDistance+=k),this.normal||(this.normal=ca(),pv(this.normal,uu)),!this.started)if(this.started=!0,x){var D=ca(),V=ca();Ds(D,this.normal,uu),Ds(V,this.normal,uu),y.push(V[0],V[1],0),y.push(D[0],D[1],0),h.push(i[0],i[1],i[2]|0,this.totalDistance-k,-this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),h.push(i[0],i[1],i[2]|0,this.totalDistance-k,this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(h,y,i,this.normal,this.thickness,this.totalDistance-k);if(c.push(n+0,n+1,n+2),a){var N=Vu([a[0],a[1]]);u2(T,N)&&Ds(N,T,Up(N,Rm(N,T,I))),E0(hv,N,T);var H=s2(w0,ca(),uu,hv,this.thickness),q=ei(H,2),Y=q[0],ee=q[1],pe=Tv(w0,this.normal)<0?-1:1,ue=E;if(!ue&&this.join==="miter"){var ie=Y;ie>this.miterLimit&&(ue=!0)}ue?(y.push(this.normal[0],this.normal[1],0),y.push(ee[0],ee[1],0),h.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*pe,o[2]|0),this.complex.indexes.push(this.currentIndex),h.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness*pe,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,c.push.apply(c,cn(this.lastFlip!==-pe?[n,n+2,n+3]:[n+2,n+1,n+3])),c.push(n+2,n+3,n+4),pv(o1,hv),Dp(this.normal,o1),y.push(this.normal[0],this.normal[1],0),h.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*pe,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,u+=3):(this.extrusions(h,y,o,ee,Y,this.totalDistance),c.push.apply(c,cn(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),pe=-1,Dp(this.normal,ee),u+=2),this.lastFlip=pe}else{if(pv(this.normal,uu),x){var O=ca(),F=ca();X0(F,uu,this.normal),Ds(O,uu,this.normal),y.push(F[0],F[1],0),y.push(O[0],O[1],0),h.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),h.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(h,y,o,this.normal,this.thickness,this.totalDistance);c.push.apply(c,cn(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),u+=2}return u}},{key:"extrusions",value:function(r,n,i,o,a,u){n.push(o[0],o[1],0),n.push(o[0],o[1],0),r.push(i[0],i[1],i[2]|0,u,-a,i[2]|0),this.complex.indexes.push(this.currentIndex),r.push(i[0],i[1],i[2]|0,u,a,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(r,n){var i=n[0]-r[0],o=n[1]-r[1];return Math.sqrt(i*i+o*o)}}]),e}();function oL(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=e[0][0],n=e[0][e[0].length-1];r[0]===n[0]&&r[1]===n[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var i=e[0].length,o=Iv.flatten(e),a=o.vertices,u=o.dimensions,c=[],h=[],y=[],x=0;x<a.length/u;x++)c.push(a[x*u],a[x*u+1],1,-1,-1),y.push(0,0,1);var E=Iv(o.vertices,o.holes,o.dimensions);h.push.apply(h,cn(E));for(var T=function(){var D=o.vertices.slice(I*u,(I+1)*u),V=o.vertices.slice((I+1)*u,(I+2)*u);V.length===0&&(V=o.vertices.slice(0,u));var O=c.length/5;c.push(D[0],D[1],1,0,0,V[0],V[1],1,.1,0,D[0],D[1],0,0,.8,V[0],V[1],0,.1,.8);var F=pG([V[0],V[1],1],[D[0],D[1],0],[D[0],D[1],1],t);y.push.apply(y,cn(F).concat(cn(F),cn(F),cn(F))),h.push.apply(h,cn([1,2,0,3,2,1].map(function(N){return N+O})))},I=0;I<i;I++)T();return{positions:c,index:h,normals:y}}function pG(e,t,r){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,i=D0(),o=D0(),a=D0();n&&(e=C1(e),t=C1(t),r=C1(r));var u=Kf.apply(jb,cn(e)),c=Kf.apply(jb,cn(t)),h=Kf.apply(jb,cn(r));uw(i,h,c),uw(o,u,c),vR(a,i,o);var y=D0();return F0(y,a),y}var Vf,ey=function(e){return e.CYLINDER="cylinder",e.SQUARECOLUMN="squareColumn",e.TRIANGLECOLUMN="triangleColumn",e.HEXAGONCOLUMN="hexagonColumn",e.PENTAGONCOLUMN="pentagonColumn",e}({}),ty=function(e){return e.CIRCLE="circle",e.SQUARE="square",e.TRIANGLE="triangle",e.HEXAGON="hexagon",e.PENTAGON="pentagon",e}({});function __(e){for(var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=Math.PI*2/e,n=[],i=0;i<e;i++)n.push(r*i+t*Math.PI/12);var o=n.map(function(a){var u=Math.sin(a+Math.PI/4),c=Math.cos(a+Math.PI/4);return[u,c,0]});return o}function SM(){return __(30)}function AM(){return __(4)}function TM(){return __(3)}function CM(){return __(6,1)}function MM(){return __(5)}var l2=(Vf={},Q(Vf,ty.CIRCLE,SM),Q(Vf,ty.HEXAGON,CM),Q(Vf,ty.TRIANGLE,TM),Q(Vf,ty.SQUARE,AM),Q(Vf,ty.PENTAGON,MM),Q(Vf,ey.CYLINDER,SM),Q(Vf,ey.HEXAGONCOLUMN,CM),Q(Vf,ey.TRIANGLECOLUMN,TM),Q(Vf,ey.SQUARECOLUMN,AM),Q(Vf,ey.PENTAGONCOLUMN,MM),Vf),s1={};function ex(e){var t=Id(e.coordinates);return{vertices:[].concat(cn(t),cn(t),cn(t),cn(t)),indices:[0,1,2,2,3,0],size:t.length}}function PM(e){var t=Id(e.coordinates),r=aL(t);return{vertices:[].concat(cn(r),cn(r),cn(r),cn(r)),indices:[0,1,2,2,3,0],size:r.length}}function sL(e){var t=e.shape,r=bG(t,!1),n=r.positions,i=r.index,o=r.normals;return{vertices:n,indices:i,normals:o,size:5}}function dG(e){var t=Id(e.coordinates);return{vertices:cn(t),indices:[0],size:t.length}}function Iw(e){var t=e.coordinates,r=e.originCoordinates,n=e.version,i=new hG({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var o=t;Array.isArray(o[0][0])||(o=[t]);var a=r;Array.isArray(a[0][0])||(a=[r]);for(var u=0;u<o.length;u++){var c=o[u],h=a[u];i.extrude_gaode2(c,h)}}else{var y=t;y[0]&&!Array.isArray(y[0][0])&&(y=[t]),y.forEach(function(E){i.extrude(E)})}var x=i.complex;return{vertices:x.positions,indices:x.indices,normals:x.normals,indexes:x.indexes,size:6}}function vG(e){var t=e.coordinates.flat(),r=1,n=1;return{vertices:[1,0,0].concat(cn(t),[1,2,-3],cn(t),[1,1,-3],cn(t),[0,1,0],cn(t),[0,0,0],cn(t),[1,0,0],cn(t),[1,2,-3],cn(t),[1,1,-3],cn(t),[0,1,0],cn(t),[0,0,0],cn(t)),normals:[-r,2*n,1,2*n,-n,1,n,-n,1,n,-n,1,-r,-n,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],indices:[0,1,2,0,2,3,0,3,4,5,6,7,5,7,8,5,8,9],size:7}}function mG(e){var t=e.coordinates,r=[];if(!Array.isArray(t[0]))return{vertices:[],indices:[],normals:[],size:6,count:0};var n=gG(t),i=n.results,o=n.totalDistance;return i.map(function(a){r.push(a[0],a[1],a[2],a[3],0,o)}),{vertices:r,indices:[],normals:[],size:6,count:i.length}}function IM(e,t){var r=t[0]-e[0],n=t[1]-e[1];return Math.sqrt(r*r+n*n)}function c2(e,t){return e.length<3&&e.push(0),t!==void 0&&e.push(t),e}function gG(e){var t=e;Array.isArray(t)&&Array.isArray(t[0])&&Array.isArray(t[0][0])&&(t=e.flat());var r=0;if(t.length<2)return{results:t,totalDistance:0};var n=[],i=c2(t[0],r);n.push(i);for(var o=1;o<t.length-1;o++){var a=IM(t[o-1],t[o]);r+=a;var u=c2(t[o],r);n.push(u),n.push(u)}var c=IM(t[t.length-2],t[t.length-1]);return r+=c,n.push(c2(t[t.length-1],r)),{results:n,totalDistance:r}}function mS(e){var t=e.coordinates,r=Iv.flatten(t),n=r.vertices,i=r.dimensions,o=r.holes;return{indices:Iv(n,o,i),vertices:n,size:i}}function yG(e){var t=e.coordinates,r=Iv.flatten(t),n=r.vertices,i=r.dimensions,o=r.holes;return{indices:Iv(n,o,i),vertices:_G(n),size:i+4}}function _G(e){for(var t=[],r=zF(e),n=r.center,i=r.radius,o=0;o<e.length;o+=2){var a=e[o],u=e[o+1];t.push.apply(t,[a,u,0].concat(cn(n),[i]))}return t}function xG(e){var t=e.coordinates,r=oL(t,!0),n=r.positions,i=r.index,o=r.normals;return{vertices:n,indices:i,normals:o,size:5}}function Hx(e){var t=e.coordinates,r=[].concat(cn(t[0]),[0,0,1,t[1][0],t[0][1],0,1,1],cn(t[1]),[0,1,0],cn(t[0]),[0,0,1],cn(t[1]),[0,1,0,t[0][0],t[1][1],0,0,0]),n=[0,1,2,3,4,5];return{vertices:r,indices:n,size:5}}function Wx(e,t){for(var r=t||30,n=e.coordinates,i=[],o=[],a=function(h){i.push(h,1,h,n[0][0],n[0][1],n[1][0],n[1][1],h,-1,h,n[0][0],n[0][1],n[1][0],n[1][1]),h!==r-1&&o.push.apply(o,cn([0,1,2,1,3,2].map(function(y){return h*2+y})))},u=0;u<r;u++)a(u);return{vertices:i,indices:o,size:7}}function bG(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(s1&&s1[e])return s1[e];var r=l2[e]?l2[e]():l2.cylinder(),n=oL([r],t);return s1[e]=n,n}function wG(e){var t=EG();return function(){var n=Ct(e),i;if(t){var o=Ct(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xn(this,i)}}function EG(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var SG=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
void main() {
  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));
  gl_FragColor = color;
  gl_FragColor.a *= u_opacity;
  if(gl_FragColor.a < 0.01)
    discard;
}
`,AG=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,TG=function(e){yn(r,e);var t=wG(r);function r(){return $t(this,r),t.apply(this,arguments)}return Gt(r,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),o=i.opacity;return{u_opacity:o||1,u_texture:this.texture}}},{key:"initModels",value:function(){var n=Vt(Ce.mark(function o(){var a=this,u,c,h,y,x,E;return Ce.wrap(function(I){for(;;)switch(I.prev=I.next){case 0:if(u=this.layer.getSource(),c=this.rendererService.createTexture2D,this.texture=c({height:0,width:0}),!gf){I.next=11;break}h=this.layerService.sceneService.getSceneConfig().canvas,y=h.createImage(),y.crossOrigin="anonymous",y.src=u.data.originData,y.onload=function(){a.texture=c({data:y,width:y.width,height:y.height}),a.layerService.reRender()},I.next=15;break;case 11:return I.next=13,u.data.images;case 13:x=I.sent,this.texture=c({data:x[0],width:x[0].width,height:x[0].height,mag:ae.LINEAR,min:ae.LINEAR});case 15:return I.next=17,this.layer.buildLayerModel({moduleName:"rasterImage",vertexShader:AG,fragmentShader:SG,triangulation:Hx,primitive:ae.TRIANGLES,blend:{enable:!0},depth:{enable:!1}});case 17:return E=I.sent,I.abrupt("return",[E]);case 19:case"end":return I.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy()}},{key:"buildModels",value:function(){var n=Vt(Ce.mark(function o(){return Ce.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",this.initModels());case 1:case"end":return u.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:gn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:2,update:function(o,a,u){return[u[3],u[4]]}}})}}]),r}(Co),CG={image:TG};const MG=CG;function PG(e){var t=IG();return function(){var n=Ct(e),i;if(t){var o=Ct(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xn(this,i)}}function IG(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var uL=function(e){yn(r,e);var t=PG(r);function r(){var n;$t(this,r);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return n=t.call.apply(t,[this].concat(o)),Q(Ye(n),"type","ImageLayer"),n}return Gt(r,[{key:"buildModels",value:function(){var n=Vt(Ce.mark(function o(){var a;return Ce.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return a=this.getModelType(),this.layerModel=new MG[a](this),c.next=4,this.initLayerModels();case 4:case"end":return c.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getDefaultConfig",value:function(){var i=this.getModelType(),o={image:{}};return o[i]}},{key:"getModelType",value:function(){return"image"}}]),r}(Mg);function RG(e){var t=LG();return function(){var n=Ct(e),i;if(t){var o=Ct(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xn(this,i)}}function LG(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var kG=`
uniform float u_opacity;

varying vec4 v_dash_array;
varying vec4 v_color;
varying float v_distance_ratio;

uniform float segmentNumber;


#pragma include "picking"

void main() {
  gl_FragColor = v_color;


  float flag = 0.;
  float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    flag = 1.;
  };
  gl_FragColor.a *=flag;
  
  gl_FragColor = filterColor(gl_FragColor);
}`,OG=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
varying vec4 v_color;


uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_lineDir: 1.0;
varying vec4 v_dash_array;
varying float v_distance_ratio;

uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // 正向
    return mid;
  } else { // 逆向
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
  // dash: index / (segmentNumber - 1.);
  // normal: smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
  return index / (segmentNumber - 1.);
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = vec4(a_Color.xyz, a_Color.w * u_opacity);
  
  vec2 source = a_Instance.rg;  // 起始点
  vec2 target =  a_Instance.ba; // 终点
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);

  vec2 s = source;
  vec2 t = target;
  
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    s = unProjCustomCoord(source);
    t = unProjCustomCoord(target);
  }
  float total_Distance = pixelDistance(s, t) / 2.0 * PI;
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;

  v_distance_ratio = segmentIndex / segmentNumber;

  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, u_thetaOffset), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, u_thetaOffset), 0.0, 1.0));
 
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  gl_PointSize = 5.0;
  setPickingColor(a_PickingColor);
}
`,DG=`
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;
varying vec4 v_lineData;


#pragma include "picking"

void main() {
  float animateSpeed = 0.0; // 运动速度
  gl_FragColor = v_color;
  
  gl_FragColor.a *= u_opacity;

  if(u_animate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- v_lineData.b, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  // 当存在贴图时在底色上贴上贴图
  if(u_line_texture == LineTexture) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (v_lineData.r / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);

    float count = v_lineData.g; // 贴图在弧线上重复的数量

    float time = 0.0;
    if(u_animate.x == Animate) {
      time = u_time / u_animate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);
    float v = v_lineData.a; // 横向 v
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture2D(u_texture, uv);

    if(u_animate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_animate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= u_opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
    
  } else {
     gl_FragColor = filterColor(gl_FragColor);
  }
}`,FG=`#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_lineDir: 1.0;

uniform float u_thetaOffset: 0.314;
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;
varying vec4 v_lineData;
varying vec2 v_distance_ratio;

uniform float u_opacity: 1.0;


#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // 正向
    return mid;
  } else { // 逆向
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    // dash: index / (segmentNumber - 1.);
    // normal: smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
    //  return index / (segmentNumber - 1.);
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  vec2 source = a_Instance.rg;  // 起始点
  vec2 target =  a_Instance.ba; // 终点
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;
  
  if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        d_distance_ratio = 1.0 - d_distance_ratio;
      }
  }

 v_lineData.b = d_distance_ratio;

  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, u_thetaOffset), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, u_thetaOffset), 0.0, 1.0));

  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // 当前顶点在弧线中所处的分段位置
 v_lineData.r = d_segmentIndex;

  if(LineTexture == u_line_texture) { // 开启贴图模式

    float arcDistrance = length(source - target); // 起始点和终点的距离
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      arcDistrance *= 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      // arcDistrance *= 8.0;
      arcDistrance = project_pixel_allmap(arcDistrance);
    }
    v_iconMapUV = a_iconMapUV;

    float pixelLen = project_pixel_texture(u_icon_step); // 贴图沿弧线方向的长度 - 随地图缩放改变
    float texCount = floor(arcDistrance/pixelLen); // 贴图在弧线上重复的数量
    v_lineData.g = texCount;

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // 线横向偏移的距离
    float linePixelSize = project_pixel(a_Size); // 定点位置偏移
    v_lineData.a = lineOffsetWidth/linePixelSize; // 线图层贴图部分的 v 坐标值
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,NG=`varying vec4 v_color;

#pragma include "picking"

void main() {
// 当前顶点在弧线中所处的分段位置

  gl_FragColor = v_color;
  gl_FragColor = filterColor(gl_FragColor);
}`,BG=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
varying vec4 v_color;
varying float v_segmentIndex;

uniform float u_lineDir: 1.0;
uniform float u_opacity: 1.0;

uniform float u_thetaOffset: 0.314;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;




#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // 正向
    return mid;
  } else { // 逆向
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  vec2 source = a_Instance.rg;  // 起始点
  vec2 target =  a_Instance.ba; // 终点
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, u_thetaOffset), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, u_thetaOffset), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // 当前顶点在弧线中所处的分段位置

  v_color = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  v_color.a *= u_opacity;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,zG={solid:0,dash:1},UG=function(e){yn(r,e);var t=RG(r);function r(){var n;$t(this,r);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return n=t.call.apply(t,[this].concat(o)),Q(Ye(n),"updateTexture",function(){var u=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=u({data:n.iconService.getCanvas(),mag:ae.NEAREST,min:ae.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return Gt(r,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),o=i.opacity,a=o===void 0?1:o,u=i.sourceColor,c=i.targetColor,h=i.textureBlend,y=h===void 0?"normal":h,x=i.lineType,E=x===void 0?"solid":x,T=i.dashArray,I=T===void 0?[10,5]:T,k=i.forward,D=k===void 0?!0:k,V=i.lineTexture,O=V===void 0?!1:V,F=i.iconStep,N=F===void 0?100:F,H=i.segmentNumber,q=H===void 0?30:H,Y=i.thetaOffset,ee=Y===void 0?.314:Y;I.length===2&&I.push(0,0);var pe=0,ue=[0,0,0,0],ie=[0,0,0,0];return u&&c&&(ue=Da(u),ie=Da(c),pe=1),this.rendererService.getDirty()&&this.texture.bind(),{u_thetaOffset:ee,u_opacity:Er.isNumber(a)?a:1,u_textureBlend:y==="normal"?0:1,segmentNumber:q,u_line_type:zG[E||"solid"],u_dash_array:I,u_blur:.9,u_lineDir:D?1:-1,u_texture:this.texture,u_line_texture:O?1:0,u_icon_step:N,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:pe,u_sourceColor:ue,u_targetColor:ie}}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),o=i.animateOption;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=Vt(Ce.mark(function o(){return Ce.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),u.abrupt("return",this.buildModels());case 3:case"end":return u.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var i=this.layer.getLayerConfig(),o=i.sourceColor,a=i.targetColor,u=i.lineType;return u==="dash"?{frag:kG,vert:OG,type:"Dash"}:o&&a?{frag:NG,vert:BG,type:"Linear"}:{frag:DG,vert:FG,type:""}}},{key:"buildModels",value:function(){var n=Vt(Ce.mark(function o(){var a,u,c,h,y,x,E,T;return Ce.wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return a=this.layer.getLayerConfig(),u=a.segmentNumber,c=u===void 0?30:u,h=this.getShaders(),y=h.frag,x=h.vert,E=h.type,k.next=4,this.layer.buildLayerModel({moduleName:"lineArc2d"+E,vertexShader:x,fragmentShader:y,triangulation:Wx,depth:{enable:!1},segmentNumber:c});case 4:return T=k.sent,k.abrupt("return",[T]);case 6:case"end":return k.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:1,update:function(a){var u=a.size,c=u===void 0?1:u;return Array.isArray(c)?[c[0]]:[c]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:gn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:ae.STATIC_DRAW,data:[],type:ae.FLOAT},size:4,update:function(a,u,c){return[c[3],c[4],c[5],c[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:gn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:2,update:function(a){var u=i.iconService.getIconMap(),c=a.texture,h=u[c]||{x:0,y:0},y=h.x,x=h.y;return[y,x]}}})}}]),r}(Co);function VG(e){var t=jG();return function(){var n=Ct(e),i;if(t){var o=Ct(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xn(this,i)}}function jG(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var $G=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;
varying vec4 v_line_data;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;
uniform float u_opacity;

varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];


#pragma include "picking"

void main() {
  float opacity = u_opacity;
  float animateSpeed = 0.0; // 运动速度
  float d_distance_ratio = v_line_data.g; // 当前点位距离占线总长的比例
  gl_FragColor = v_color;

  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_animate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_animate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = v_line_data.b; // // 贴图在弧线上重复的数量

    float time = 0.0;
    if(u_animate.x == Animate) {
      time = u_time / u_animate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = v_line_data.a;  // 线图层贴图部分的 v 坐标值
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_animate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_animate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,GG=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;
varying vec4 v_line_data;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 是为了对齐坐标
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // 手动增加一些偏移，减轻面的冲突
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  v_line_data.g = d_distance_ratio; // 当前点位距离占线总长的比例

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // 开启贴图模式  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    v_line_data.b = floor(arcDistrance/pixelLen); // 贴图在弧线上重复的数量

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // 线横向偏移的距离
    float linePixelSize = project_pixel(a_Size);  // 定点位置偏移，按地图等级缩放后的距离
    v_line_data.a = lineOffsetWidth/linePixelSize;  // 线图层贴图部分的 v 坐标值

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // 地球模式
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // 线的偏移
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // 计算起始点和终止点的距离
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // 计算飞线各个节点相应的高度
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // 地球点位
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,HG=`
#define Animate 0.0
uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_Color;

varying float v_distance_ratio;
#pragma include "picking"

void main() {

  float animateSpeed = 0.0; // 运动速度
  gl_FragColor = v_Color;

  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_animate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,WG=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;
attribute vec2 a_iconMapUV;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_distance_ratio;

varying vec4 v_dash_array;
varying vec4 v_color;
varying vec2 v_iconMapUV;
varying vec4 v_Color;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 是为了对齐坐标
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // 手动增加一些偏移，减轻面的冲突
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - 数据纹理映射部分的计算

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }


  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);

  float animateSpeed = 0.0; // 运动速度
  v_Color = mix(u_sourceColor, u_targetColor, a_Position.x/segmentNumber);

  v_Color.a *= opacity;


  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // 地球模式
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // 线的偏移
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // 计算起始点和终止点的距离
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // 计算飞线各个节点相应的高度
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // 地球点位
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,XG={solid:0,dash:1},YG=function(e){yn(r,e);var t=VG(r);function r(){var n;$t(this,r);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return n=t.call.apply(t,[this].concat(o)),Q(Ye(n),"updateTexture",function(){var u=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=u({data:n.iconService.getCanvas(),mag:ae.NEAREST,min:ae.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return Gt(r,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),o=i.sourceColor,a=i.targetColor,u=i.textureBlend,c=u===void 0?"normal":u,h=i.lineType,y=h===void 0?"solid":h,x=i.dashArray,E=x===void 0?[10,5]:x,T=i.lineTexture,I=T===void 0?!1:T,k=i.iconStep,D=k===void 0?100:k,V=i.segmentNumber,O=V===void 0?30:V,F=i.globalArcHeight,N=F===void 0?10:F;E.length===2&&E.push(0,0);var H=0,q=[0,0,0,0],Y=[0,0,0,0];return o&&a&&(q=Da(o),Y=Da(a),H=1),this.rendererService.getDirty()&&this.texture.bind(),_t({u_globel:this.mapService.version==="GLOBEL"?1:0,u_globel_radius:vS,u_global_height:N,u_textureBlend:c==="normal"?0:1,segmentNumber:O,u_line_type:XG[y]||0,u_dash_array:E,u_texture:this.texture,u_line_texture:I?1:0,u_icon_step:D,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:H,u_sourceColor:q,u_targetColor:Y},this.getStyleAttribute())}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),o=i.animateOption;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=Vt(Ce.mark(function o(){return Ce.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),u.abrupt("return",this.buildModels());case 3:case"end":return u.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var i=this.layer.getLayerConfig(),o=i.sourceColor,a=i.targetColor;return o&&a?{frag:HG,vert:WG,type:"Linear"}:{frag:$G,vert:GG,type:""}}},{key:"buildModels",value:function(){var n=Vt(Ce.mark(function o(){var a,u,c,h,y,x,E,T;return Ce.wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return a=this.layer.getLayerConfig(),u=a.segmentNumber,c=u===void 0?30:u,h=this.getShaders(),y=h.frag,x=h.vert,E=h.type,k.next=4,this.layer.buildLayerModel({moduleName:"lineArc3d"+E,vertexShader:x,fragmentShader:y,inject:this.getInject(),triangulation:Wx,segmentNumber:c});case 4:return T=k.sent,k.abrupt("return",[T]);case 6:case"end":return k.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:1,update:function(a){var u=a.size,c=u===void 0?1:u;return Array.isArray(c)?[c[0]]:[c]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:gn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:ae.STATIC_DRAW,data:[],type:ae.FLOAT},size:4,update:function(a,u,c){return[c[3],c[4],c[5],c[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:gn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:2,update:function(a){var u=i.iconService.getIconMap(),c=a.texture,h=u[c]||{x:0,y:0},y=h.x,x=h.y;return[y,x]}}})}}]),r}(Co);function qG(e){var t=ZG();return function(){var n=Ct(e),i;if(t){var o=Ct(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xn(this,i)}}function ZG(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var KG=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;
varying vec4 v_line_data;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;
uniform float u_opacity;

varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];


#pragma include "picking"

void main() {
  float opacity = u_opacity;
  float animateSpeed = 0.0; // 运动速度
  float d_distance_ratio = v_line_data.g; // 当前点位距离占线总长的比例
  gl_FragColor = v_color;

  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_animate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_animate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = v_line_data.b; // // 贴图在弧线上重复的数量

    float time = 0.0;
    if(u_animate.x == Animate) {
      time = u_time / u_animate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = v_line_data.a;  // 线图层贴图部分的 v 坐标值
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_animate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_animate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,QG=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;
varying vec4 v_line_data;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 是为了对齐坐标
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // 手动增加一些偏移，减轻面的冲突
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  v_line_data.g = d_distance_ratio; // 当前点位距离占线总长的比例

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // 开启贴图模式  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    v_line_data.b = floor(arcDistrance/pixelLen); // 贴图在弧线上重复的数量

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // 线横向偏移的距离
    float linePixelSize = project_pixel(a_Size);  // 定点位置偏移，按地图等级缩放后的距离
    v_line_data.a = lineOffsetWidth/linePixelSize;  // 线图层贴图部分的 v 坐标值

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // 地球模式
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // 线的偏移
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // 计算起始点和终止点的距离
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // 计算飞线各个节点相应的高度
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // 地球点位
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,JG=`
#define Animate 0.0
uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_Color;

varying float v_distance_ratio;
#pragma include "picking"

void main() {

  float animateSpeed = 0.0; // 运动速度
  gl_FragColor = v_Color;

  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_animate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,eH=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;
attribute vec2 a_iconMapUV;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_distance_ratio;

varying vec4 v_dash_array;
varying vec4 v_color;
varying vec2 v_iconMapUV;
varying vec4 v_Color;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 是为了对齐坐标
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // 手动增加一些偏移，减轻面的冲突
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - 数据纹理映射部分的计算

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }


  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);

  float animateSpeed = 0.0; // 运动速度
  v_Color = mix(u_sourceColor, u_targetColor, a_Position.x/segmentNumber);

  v_Color.a *= opacity;


  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // 地球模式
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // 线的偏移
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // 计算起始点和终止点的距离
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // 计算飞线各个节点相应的高度
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // 地球点位
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,tH={solid:0,dash:1},rH=function(e){yn(r,e);var t=qG(r);function r(){var n;$t(this,r);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return n=t.call.apply(t,[this].concat(o)),Q(Ye(n),"updateTexture",function(){var u=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=u({data:n.iconService.getCanvas(),mag:ae.NEAREST,min:ae.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return Gt(r,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),o=i.opacity,a=o===void 0?1:o,u=i.sourceColor,c=i.targetColor,h=i.textureBlend,y=h===void 0?"normal":h,x=i.lineType,E=x===void 0?"solid":x,T=i.dashArray,I=T===void 0?[10,5]:T,k=i.lineTexture,D=k===void 0?!1:k,V=i.iconStep,O=V===void 0?100:V,F=i.segmentNumber,N=F===void 0?30:F,H=i.globalArcHeight,q=H===void 0?10:H;I.length===2&&I.push(0,0);var Y=0,ee=[0,0,0,0],pe=[0,0,0,0];return u&&c&&(ee=Da(u),pe=Da(c),Y=1),this.rendererService.getDirty()&&this.texture.bind(),{u_globel:1,u_globel_radius:vS,u_global_height:q,u_opacity:a,u_textureBlend:y==="normal"?0:1,segmentNumber:N,u_line_type:tH[E]||0,u_dash_array:I,u_texture:this.texture,u_line_texture:D?1:0,u_icon_step:O,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Y,u_sourceColor:ee,u_targetColor:pe}}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),o=i.animateOption;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=Vt(Ce.mark(function o(){return Ce.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),u.abrupt("return",this.buildModels());case 3:case"end":return u.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var i=this.layer.getLayerConfig(),o=i.sourceColor,a=i.targetColor;return o&&a?{frag:JG,vert:eH,type:"Linear"}:{frag:KG,vert:QG,type:""}}},{key:"buildModels",value:function(){var n=Vt(Ce.mark(function o(){var a,u,c,h,y,x,E,T;return Ce.wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return a=this.layer.getLayerConfig(),u=a.segmentNumber,c=u===void 0?30:u,h=this.getShaders(),y=h.frag,x=h.vert,E=h.type,k.next=4,this.layer.buildLayerModel({moduleName:"lineEarthArc3d"+E,vertexShader:x,fragmentShader:y,triangulation:Wx,depth:{enable:!0},segmentNumber:c});case 4:return T=k.sent,k.abrupt("return",[T]);case 6:case"end":return k.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:1,update:function(a){var u=a.size,c=u===void 0?1:u;return Array.isArray(c)?[c[0]]:[c]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:gn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:ae.STATIC_DRAW,data:[],type:ae.FLOAT},size:4,update:function(a,u,c){return[c[3],c[4],c[5],c[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:gn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:2,update:function(a){var u=i.iconService.getIconMap(),c=a.texture,h=u[c]||{x:0,y:0},y=h.x,x=h.y;return[y,x]}}})}}]),r}(Co);function nH(e){var t=iH();return function(){var n=Ct(e),i;if(t){var o=Ct(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xn(this,i)}}function iH(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var aH=`#extension GL_OES_standard_derivatives : enable

varying vec4 v_color;


// line texture

#pragma include "picking"

void main() {
gl_FragColor = v_color;
gl_FragColor = filterColor(gl_FragColor);
}
`,oH=`attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec4 a_Instance;
attribute vec3 a_Normal;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#pragma include "projection"
#pragma include "picking"
varying vec4 v_color;
uniform float u_gap_width: 1.0;
uniform float u_stroke_width: 1.0;
uniform float u_stroke_opacity: 1.0;


void main() {

// #ifdef USE_ATTRIBUTE_OPACITY
//   float opacity  = a_Opacity;
// #else
//   float opacity = u_opacity;
// #endif


// #ifdef USE_ATTRIBUTE_OFFSETS
//   vec2 offsets  = a_Offsets;
// #else
//   vec2 offsets = u_offsets;
// #endif

  // float opacity = u_opacity;
// 透明度计算
  vec2 source = a_Instance.rg;  // 起始点
  vec2 target =  a_Instance.ba; // 终点
  vec2 flowlineDir = normalize(target - source);
  vec2 perpendicularDir = vec2(-flowlineDir.y, flowlineDir.x);


  vec2 position = mix(source, target, a_Position.x);

  float lengthCommon = length(target - source);    
  vec2 offsetDistances = a_Size.x * project_pixel(a_Position.yz);
  vec2 limitedOffsetDistances = clamp(   
   offsetDistances,
    -lengthCommon*.8, lengthCommon*.8
  );

  float startOffsetCommon = project_pixel(offsets[0]);
  float endOffsetCommon = project_pixel(offsets[1]);
  float endpointOffset = mix(
    clamp(startOffsetCommon, 0.0, lengthCommon*.2),
    -clamp(endOffsetCommon, 0.0, lengthCommon*.2),
    a_Position.x
  );

  vec2 normalsCommon =  u_stroke_width * project_pixel(a_Normal.xy);

  float gapCommon =  project_pixel(u_gap_width);
  vec3 offsetCommon = vec3(
    flowlineDir * (limitedOffsetDistances[1] + normalsCommon.y + endpointOffset * 1.05) -
    perpendicularDir * (limitedOffsetDistances[0] + gapCommon + normalsCommon.x),
    0.0
  );


  vec4 project_pos = project_position(vec4(position.xy, 0, 1.0));

  vec4 fillColor = vec4(a_Color.rgb, a_Color.a * opacity);
  v_color = mix(fillColor, vec4(u_stroke.xyz, u_stroke.w * fillColor.w * u_stroke_opacity), a_Normal.z);


  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offsetCommon.xy, 0., 1.0);
  } else {
     gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offsetCommon.xy, 0., 1.0));
  }



  setPickingColor(a_PickingColor);
}
`,sH=function(e){yn(r,e);var t=nH(r);function r(){return $t(this,r),t.apply(this,arguments)}return Gt(r,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),o=i.gapWidth,a=o===void 0?2:o,u=i.strokeWidth,c=u===void 0?1:u,h=i.stroke,y=h===void 0?"#000":h,x=i.strokeOpacity,E=x===void 0?1:x;return _t({u_gap_width:a,u_stroke_width:c,u_stroke:Da(y),u_stroke_opacity:E},this.getStyleAttribute())}},{key:"initModels",value:function(){var n=Vt(Ce.mark(function o(){return Ce.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",this.buildModels());case 1:case"end":return u.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=Vt(Ce.mark(function o(){var a;return Ce.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.layer.buildLayerModel({moduleName:"flow_line",vertexShader:oH,fragmentShader:aH,inject:this.getInject(),triangulation:vG,primitive:ae.TRIANGLES,depth:{enable:!1},pick:!1});case 2:return a=c.sent,c.abrupt("return",[a]);case 4:case"end":return c.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:2,update:function(o){var a=o.size,u=a===void 0?1:a;return Array.isArray(u)?[u[0],u[1]]:[u,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:gn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:ae.STATIC_DRAW,data:[],type:ae.FLOAT},size:4,update:function(o,a,u){return[u[3],u[4],u[5],u[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:gn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:ae.STATIC_DRAW,data:[],type:ae.FLOAT},size:3,update:function(o,a,u,c,h){return h}}})}}]),r}(Co);function uH(e){var t=lH();return function(){var n=Ct(e),i;if(t){var o=Ct(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xn(this,i)}}function lH(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var cH=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
varying vec4 v_line_data;

#pragma include "picking"
#pragma include "project"
#pragma include "projection"

void main() {
  float opacity = u_opacity;
  float animateSpeed = 0.0;
  float d_segmentIndex = v_line_data.g;
  
  // 设置弧线的底色
  if(u_linearColor == 1.0) { // 使用渐变颜色
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  } else { // 使用 color 方法传入的颜色
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      // 实线部分
    } else {
      // 虚线部分
      discard;
    };
  }

  // 设置弧线的动画模式
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  // 设置弧线的贴图
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { 
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);
    float count = v_line_data.b; // 贴图在弧线上重复的数量
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_animate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }

    float v = v_line_data.a; // 线图层贴图部分的 v 坐标值

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);
    
    // 设置贴图和底色的叠加模式
    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}`,fH=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_color;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;
varying vec4 v_line_data;


#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
    return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
    return index / (segmentNumber - 1.);
}

float paraboloid(vec2 source, vec2 target, float ratio) {
    vec2 x = mix(source, target, ratio);
    vec2 center = mix(source, target, 0.5);
    float dSourceCenter = distance(source, center);
    float dXCenter = distance(x, center);
    return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
     float vertex_height = paraboloid(source, target, segmentRatio);

    return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
    );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) *
    sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 mid = midPoint(source, target);
    vec3 x = vec3(source.x, mid.x, target.x);
    vec3 y = vec3(source.y, mid.y, target.y);
    return vec2(bezier3(x ,t), bezier3(y,t));
  }else {
    if(abs(angularDist - PI) < 0.001) {
      return (1.0 - t) * source + t * target;
    }
    float a = sin((1.0 - t) * angularDist) / sin(angularDist);
    float b = sin(t * angularDist) / sin(angularDist);
    vec2 sin_source = sin(source);
    vec2 cos_source = cos(source);
    vec2 sin_target = sin(target);
    vec2 cos_target = cos(target);
    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
    float z = a * sin_source.y + b * sin_target.y;
    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));
  }
}

void main() {
  

  v_color = a_Color;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    total_Distance = total_Distance*16.0; // total_Distance*16.0 调整默认的效果
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;
  }

  if(u_animate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;
  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

v_line_data.g = a_Position.x; // 该顶点在弧线上的分段排序
  if(LineTexture == u_line_texture) { // 开启贴图模式  
    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;
    float d_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      d_arcDistrance = d_arcDistrance * 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      d_arcDistrance = project_pixel_allmap(d_arcDistrance);
    }
    float d_pixelLen = project_pixel(u_icon_step)/8.0;
v_line_data.b = floor(d_arcDistrance/d_pixelLen); // 贴图在弧线上重复的数量

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // 线横向偏移的距离
    float linePixelSize = project_pixel(a_Size);  // 定点位置偏移，按地图等级缩放后的距离
v_line_data.a = lineOffsetWidth/linePixelSize;  // 线图层贴图部分的 v 坐标值

    v_iconMapUV = a_iconMapUV;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));
  }
  setPickingColor(a_PickingColor);
}

`,hH={solid:0,dash:1},pH=function(e){yn(r,e);var t=uH(r);function r(){var n;$t(this,r);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return n=t.call.apply(t,[this].concat(o)),Q(Ye(n),"updateTexture",function(){var u=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=u({data:n.iconService.getCanvas(),mag:ae.NEAREST,min:ae.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return Gt(r,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),o=i.opacity,a=o===void 0?1:o,u=i.sourceColor,c=i.targetColor,h=i.textureBlend,y=h===void 0?"normal":h,x=i.lineType,E=x===void 0?"solid":x,T=i.dashArray,I=T===void 0?[10,5]:T,k=i.lineTexture,D=k===void 0?!1:k,V=i.iconStep,O=V===void 0?100:V,F=i.segmentNumber,N=F===void 0?30:F;I.length===2&&I.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var H=0,q=[0,0,0,0],Y=[0,0,0,0];return u&&c&&(q=Da(u),Y=Da(c),H=1),{u_opacity:a,u_textureBlend:y==="normal"?0:1,segmentNumber:N,u_line_type:hH[E]||0,u_dash_array:I,u_texture:this.texture,u_line_texture:D?1:0,u_icon_step:O,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:H,u_sourceColor:q,u_targetColor:Y}}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),o=i.animateOption;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=Vt(Ce.mark(function o(){return Ce.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),u.abrupt("return",this.buildModels());case 3:case"end":return u.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var n=Vt(Ce.mark(function o(){var a;return Ce.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.layer.buildLayerModel({moduleName:"lineGreatCircle",vertexShader:fH,fragmentShader:cH,triangulation:Wx,depth:{enable:!1}});case 2:return a=c.sent,c.abrupt("return",[a]);case 4:case"end":return c.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:1,update:function(a){var u=a.size,c=u===void 0?1:u;return Array.isArray(c)?[c[0]]:[c]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:gn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:ae.STATIC_DRAW,data:[],type:ae.FLOAT},size:4,update:function(a,u,c){return[c[3],c[4],c[5],c[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:gn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:2,update:function(a){var u=i.iconService.getIconMap(),c=a.texture,h=u[c]||{x:0,y:0},y=h.x,x=h.y;return[y,x]}}})}}]),r}(Co);function dH(e){var t=vH();return function(){var n=Ct(e),i;if(t){var o=Ct(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xn(this,i)}}function vH(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var mH=`#define LineTypeSolid 0.0
varying vec4 v_color;

// dash
varying vec4 v_dash_array;
varying float v_d_distance_ratio;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ]; // 控制运动

// [animate, duration, interval, trailLength],
void main() {

  gl_FragColor = v_color;

 
  float dashLength = mod(v_d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    // 实线部分
  } else {
    // 虚线部分
    discard;
  };

  gl_FragColor = filterColor(gl_FragColor);
}
`,gH=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];

uniform float u_vertexScale: 1.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;
varying vec4 v_dash_array;
varying float v_d_distance_ratio;

uniform float u_opacity: 1.0;

void main() {

  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  v_color = vec4(a_Color.xyz, a_Color.w * u_opacity);

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  vec2 offset = project_pixel(size.xy);
  v_d_distance_ratio = a_DistanceAndIndex.x / a_Total_Distance;


  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, project_pixel(a_Size.y), 1.0));
  } else {
    float lineHeight = a_Size.y;
 
    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // 保持高度相对不变
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,yH=`#extension GL_OES_standard_derivatives : enable
#define Animate 0.0
#define LineTexture 1.0
uniform float u_opacity : 1.0;
uniform float u_textureBlend;

uniform float u_borderWidth: 0.0;

uniform vec3 u_blur;
uniform vec4 u_borderColor;
varying vec4 v_color;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying vec2 v_iconMapUV;
varying vec4 v_texture_data;


#pragma include "picking"

uniform float u_time;
uniform vec4 u_animate: [ 1, 2., 1.0, 0.2 ]; // 控制运动
// [animate, duration, interval, trailLength],
void main() {
  float animateSpeed = 0.0; // 运动速度
  float d_distance_ratio = v_texture_data.r; // 当前点位距离占线总长的比例
  gl_FragColor = v_color;
  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  gl_FragColor.a *= u_opacity; // 全局透明度
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = v_texture_data.g;      // 当前顶点的距离
    float d_texPixelLen = v_texture_data.b;  // 贴图的像素长度，根据地图层级缩放
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = v_texture_data.a;  // 线图层贴图部分的 v 坐标值

    // v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
     vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor += pattern;
    } else { // replace
        pattern.a *= u_opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = pattern;
    }
  } 

  float v = v_texture_data.a;
  float borderWidth = min(0.5, u_borderWidth);
  // 绘制 border
  if(borderWidth > 0.01) {
    float borderOuterWidth = borderWidth / 2.0;


    if(v >= 1.0 - borderWidth || v <= borderWidth) {
      if(v > borderWidth) { // 外侧
        float linear = smoothstep(0.0, 1.0, (v - (1.0 - borderWidth))/borderWidth);
        //  float linear = step(0.0, (v - (1.0 - borderWidth))/borderWidth);
        gl_FragColor.rgb = mix(gl_FragColor.rgb, u_borderColor.rgb, linear);
      } else if(v <= borderWidth) {
        float linear = smoothstep(0.0, 1.0, v/borderWidth);
        gl_FragColor.rgb = mix(u_borderColor.rgb, gl_FragColor.rgb, linear);
      }
    }

    if(v < borderOuterWidth) {
      gl_FragColor.a = mix(0.0, gl_FragColor.a, v/borderOuterWidth);
    } else if(v > 1.0 - borderOuterWidth) {
      gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);
    }
  }

  // blur
  float blurV = v_texture_data.a;
  if(blurV < 0.5) {
    gl_FragColor.a *= mix(u_blur.r, u_blur.g, blurV/0.5);
  } else {
    gl_FragColor.a *= mix(u_blur.g, u_blur.b, (blurV - 0.5)/0.5);
  }
  
  gl_FragColor = filterColor(gl_FragColor);
}
`,RM=`
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;

uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;
uniform float u_raisingHeight: 0.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;

// texV 线图层 - 贴图部分的 v 坐标（线的宽度方向）
varying vec2 v_iconMapUV;


uniform float u_linearColor: 0;
uniform float u_arrow: 0.0;
uniform float u_arrowHeight: 3.0;
uniform float u_arrowWidth: 2.0;
uniform float u_tailWidth: 1.0;

varying vec4 v_texture_data;

vec2 calculateArrow(vec2 offset) {
  /*
  * 在支持箭头的时候，第二、第三组顶点是额外插入用于构建顶点的
  */
  float arrowFlag = -1.0;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // 高德 2.0 的旋转角度不同
    arrowFlag = 1.0;
  }
  float pi = arrowFlag * 3.1415926/2.;
  if(a_Miter < 0.) {
    // 根据线的两侧偏移不同、旋转的方向相反
    pi = -pi;
  }
  highp float angle_sin = sin(pi);
  highp float angle_cos = cos(pi);
  // 计算垂直与线方向的旋转矩阵
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  float arrowWidth = u_arrowWidth;
  float arrowHeight = u_arrowHeight;

  vec2 arrowOffset = vec2(0.0);
  /*
  * a_DistanceAndIndex.y 用于标记当前顶点属于哪一组（两个顶点一组，构成线的其实是矩形，最简需要四个顶点、两组顶点构成）
  */
  if(a_DistanceAndIndex.y == 0.0) {
    // 箭头尖部
    offset = vec2(0.0);
  } else if(a_DistanceAndIndex.y == 1.0) {
    // 箭头两侧
    arrowOffset = rotation_matrix*(offset * arrowHeight);
    offset += arrowOffset; // 沿线偏移
    offset = offset * arrowWidth; // 垂直线向外偏移（是构建箭头两侧的顶点）
  } else if(a_DistanceAndIndex.y == 2.0 || a_DistanceAndIndex.y == 3.0 || a_DistanceAndIndex.y == 4.0) {
    // 偏移其余的点位（将长度让位给箭头）
    arrowOffset = rotation_matrix*(offset * arrowHeight) * arrowWidth;
    offset += arrowOffset;// 沿线偏移
  }

  return offset;
}

void main() {
  // cal style mapping - 数据纹理映射部分的计算
  
  float d_texPixelLen;    // 贴图的像素长度，根据地图层级缩放

  v_iconMapUV = a_iconMapUV;
  d_texPixelLen = project_float_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 
  if(u_arrow > 0.0) {
      //  计算箭头
    offset = calculateArrow(offset);

    if(a_DistanceAndIndex.y > 4.0) {
      offset *= mix(1.0, u_tailWidth, currentLinePointRatio);
    }
  }

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // 线横向偏移的距离（向两侧偏移的和）
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // 定点位置偏移，按地图等级缩放后的距离 单侧 * 2
  float texV = lineOffsetWidth/linePixelSize; // 线图层贴图部分的 v 坐标值
  
  v_texture_data = vec4(currentLinePointRatio, lineDistance, d_texPixelLen, texV);
  // 设置数据集的参数

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // 线顶点的高度 - 兼容不存在第三个数值的情况 vertex height
  float lineHeight = a_Size.y; // size 第二个参数代表的高度 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // 保持和 amap/mapbox 一致的效果
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // 兼容 mapbox 在线高度上的效果表现基本一致
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // 保持高度相对不变
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight 顶点偏移高度
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,_H=`varying vec4 v_color;
varying vec4 v_texture_data;
uniform float u_linearDir: 1.0;
uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_opacity: 1.0;

#pragma include "picking"


void main() {
  float linearRadio = v_texture_data.r; // 当前点位距离占线总长的比例
  if(u_linearDir < 1.0) {
    linearRadio = v_texture_data.a;
  }

  if(u_linearColor == 1.0) { // 使用渐变颜色
    gl_FragColor = mix(u_sourceColor, u_targetColor, linearRadio);
  } else { // 使用 color 方法传入的颜色
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= u_opacity; // 全局透明度
  gl_FragColor = filterColor(gl_FragColor);
}
`,xH={solid:0,dash:1},lL=function(e){yn(r,e);var t=dH(r);function r(){var n;$t(this,r);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return n=t.call.apply(t,[this].concat(o)),Q(Ye(n),"textureEventFlag",!1),Q(Ye(n),"texture",n.createTexture2D({data:[0,0,0,0],mag:ae.NEAREST,min:ae.NEAREST,premultiplyAlpha:!1,width:1,height:1})),Q(Ye(n),"updateTexture",function(){var u=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=u({data:n.iconService.getCanvas(),mag:ae.NEAREST,min:ae.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return Gt(r,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),o=i.opacity,a=o===void 0?1:o,u=i.sourceColor,c=i.targetColor,h=i.textureBlend,y=h===void 0?"normal":h,x=i.lineType,E=x===void 0?"solid":x,T=i.dashArray,I=T===void 0?[10,5,0,0]:T,k=i.lineTexture,D=k===void 0?!1:k,V=i.iconStep,O=V===void 0?100:V,F=i.vertexHeightScale,N=F===void 0?20:F,H=i.borderWidth,q=H===void 0?0:H,Y=i.borderColor,ee=Y===void 0?"#ccc":Y,pe=i.raisingHeight,ue=pe===void 0?0:pe,ie=i.heightfixed,xe=ie===void 0?!1:ie,Se=i.linearDir,Ne=Se===void 0?J1.VERTICAL:Se,ze=i.blur,Be=ze===void 0?[1,1,1]:ze,$e=i.arrow,it=$e===void 0?{enable:!1,arrowWidth:2,arrowHeight:3,tailWidth:1}:$e;I.length===2&&I.push(0,0),this.rendererService.getDirty()&&this.texture&&this.texture.bind();var mt=0,Qe=[0,0,0,0],rt=[0,0,0,0];return u&&c&&(Qe=Da(u),rt=Da(c),mt=1),{u_opacity:Er.isNumber(a)?a:1,u_textureBlend:y===fG.NORMAL?0:1,u_line_type:xH[E],u_dash_array:I,u_blur:Be,u_texture:this.texture,u_line_texture:D?1:0,u_icon_step:O,u_textSize:[1024,this.iconService.canvasHeight||128],u_borderWidth:q,u_borderColor:Da(ee),u_linearDir:Ne===J1.VERTICAL?1:0,u_linearColor:mt,u_sourceColor:Qe,u_targetColor:rt,u_heightfixed:Number(xe),u_vertexScale:N,u_raisingHeight:Number(ue),u_arrow:Number(it.enable),u_arrowHeight:it.arrowHeight||3,u_arrowWidth:it.arrowWidth||2,u_tailWidth:it.tailWidth===void 0?1:it.tailWidth}}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),o=i.animateOption;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=Vt(Ce.mark(function o(){return Ce.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return this.textureEventFlag||(this.textureEventFlag=!0,this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture)),u.abrupt("return",this.buildModels());case 2:case"end":return u.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var n=Vt(Ce.mark(function o(){var a,u,c,h,y,x,E,T;return Ce.wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return a=this.layer.getLayerConfig(),u=a.depth,c=u===void 0?!1:u,h=this.getShaders(),y=h.frag,x=h.vert,E=h.type,this.layer.triangulation=lw,k.next=5,this.layer.buildLayerModel({moduleName:"line"+E,vertexShader:x,fragmentShader:y,triangulation:lw,depth:{enable:c}});case 5:return T=k.sent,k.abrupt("return",[T]);case 7:case"end":return k.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getShaders",value:function(){var i=this.layer.getLayerConfig(),o=i.sourceColor,a=i.targetColor,u=i.lineType;return u==="dash"?{frag:mH,vert:gH,type:"Dash"}:o&&a?{frag:_H,vert:RM,type:"Linear"}:{frag:yH,vert:RM,type:""}}},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:gn.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:ae.STATIC_DRAW,data:[],type:ae.FLOAT},size:2,update:function(a,u,c,h,y,x){return x===void 0?[c[3],10]:[c[3],x]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:gn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:ae.STATIC_DRAW,data:[],type:ae.FLOAT},size:1,update:function(a,u,c){return[c[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:2,update:function(a){var u=a.size,c=u===void 0?1:u;return Array.isArray(c)?[c[0],c[1]]:[c,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:gn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:ae.STATIC_DRAW,data:[],type:ae.FLOAT},size:3,update:function(a,u,c,h,y){return y}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:gn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:ae.STATIC_DRAW,data:[],type:ae.FLOAT},size:1,update:function(a,u,c){return[c[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:gn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:2,update:function(a){var u=i.iconService.getIconMap(),c=a.texture,h=u[c]||{x:0,y:0},y=h.x,x=h.y;return[y,x]}}})}}]),r}(Co);function bH(e){var t=wH();return function(){var n=Ct(e),i;if(t){var o=Ct(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xn(this,i)}}function wH(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var EH=`
varying vec4 v_Color;
#pragma include "picking"
void main() {

  gl_FragColor = v_Color; // 全局透明度
  gl_FragColor = filterColor(gl_FragColor);
}
`,SH=`
attribute float a_Miter;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;
uniform float u_raisingHeight: 0.0;
uniform float u_opacity : 1.0;
uniform sampler2D u_texture;
uniform float u_linearDir: 1.0;
varying vec4 v_Color;


#pragma include "projection"
#pragma include "picking"


void main() {


  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // 线横向偏移的距离（向两侧偏移的和）
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // 定点位置偏移，按地图等级缩放后的距离 单侧 * 2
  float texV = lineOffsetWidth/linePixelSize; // 线图层贴图部分的 v 坐标值

  float linearRadio =currentLinePointRatio; // 当前点位距离占线总长的比例
  if(u_linearDir < 1.0) {
    linearRadio = texV;
  }

  v_Color = texture2D(u_texture, vec2(linearRadio, 0.5));

  v_Color.a *= u_opacity; // 全局透明度



  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // 线顶点的高度 - 兼容不存在第三个数值的情况 vertex height
  float lineHeight = a_Size.y; // size 第二个参数代表的高度 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // 保持和 amap/mapbox 一致的效果
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // 兼容 mapbox 在线高度上的效果表现基本一致
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // 保持高度相对不变
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight 顶点偏移高度
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,AH=function(e){yn(r,e);var t=bH(r);function r(){var n;$t(this,r);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return n=t.call.apply(t,[this].concat(o)),Q(Ye(n),"updateTexture",function(){var u=n.rendererService.createTexture2D;n.colorTexture&&n.colorTexture.destroy();var c=n.layer.getLayerConfig(),h=c.rampColors,y=LI(h);n.colorTexture=u({data:new Uint8Array(y.data),width:y.width,height:y.height,wrapS:ae.CLAMP_TO_EDGE,wrapT:ae.CLAMP_TO_EDGE,min:ae.NEAREST,mag:ae.NEAREST,flipY:!1})}),n}return Gt(r,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),o=i.opacity,a=o===void 0?1:o,u=i.vertexHeightScale,c=u===void 0?20:u,h=i.raisingHeight,y=h===void 0?0:h,x=i.heightfixed,E=x===void 0?!1:x,T=i.linearDir,I=T===void 0?J1.VERTICAL:T;return this.rendererService.getDirty()&&this.colorTexture.bind(),{u_linearDir:I===J1.VERTICAL?1:0,u_opacity:Er.isNumber(a)?a:1,u_texture:this.colorTexture,u_heightfixed:Number(E),u_vertexScale:c,u_raisingHeight:Number(y)}}},{key:"initModels",value:function(){var n=Vt(Ce.mark(function o(){return Ce.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return this.updateTexture(),u.abrupt("return",this.buildModels());case 2:case"end":return u.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.colorTexture)===null||i===void 0||i.destroy()}},{key:"buildModels",value:function(){var n=Vt(Ce.mark(function o(){var a,u,c,h;return Ce.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return a=this.layer.getLayerConfig(),u=a.depth,c=u===void 0?!1:u,this.layer.triangulation=Iw,x.next=4,this.layer.buildLayerModel({moduleName:"lineRampColors",vertexShader:SH,fragmentShader:EH,triangulation:Iw,depth:{enable:c}});case 4:return h=x.sent,x.abrupt("return",[h]);case 6:case"end":return x.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:gn.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:ae.STATIC_DRAW,data:[],type:ae.FLOAT},size:2,update:function(o,a,u,c,h,y){return y===void 0?[u[3],10]:[u[3],y]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:gn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:ae.STATIC_DRAW,data:[],type:ae.FLOAT},size:1,update:function(o,a,u){return[u[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:2,update:function(o){var a=o.size,u=a===void 0?1:a;return Array.isArray(u)?[u[0],u[1]]:[u,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:gn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:ae.STATIC_DRAW,data:[],type:ae.FLOAT},size:3,update:function(o,a,u,c,h){return h}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:gn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:ae.STATIC_DRAW,data:[],type:ae.FLOAT},size:1,update:function(o,a,u){return[u[4]]}}})}}]),r}(Co);function TH(e){var t=CH();return function(){var n=Ct(e),i;if(t){var o=Ct(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xn(this,i)}}function CH(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var MH=`
varying vec4 v_color;
void main() {
  gl_FragColor = v_color;

}
`,PH=`uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float opacity;
void main() {
  gl_FragColor = mix(u_sourceColor, u_targetColor, v_distanceScale);
  gl_FragColor.a *= opacity; // 全局透明度
}
`,LM=`attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Position;

attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_opacity: 1.0;
uniform float u_vertexScale: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;



#pragma include "projection"

varying vec4 v_color;
varying float v_distanceScale;

void main() {

  v_color = a_Color; 
  v_distanceScale = a_Distance / a_Total_Distance;
  v_color = vec4(a_Color.xyz, a_Color.w * u_opacity); 
  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // 线顶点的高度 - 兼容不存在第三个数值的情况

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, project_pixel(a_Size.y) + h * 0.2, 1.0));
  } else {
    float lineHeight = a_Size.y;
    // 兼容 mapbox 在线高度上的效果表现基本一致
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // 保持高度相对不变
      h *= 2.0/pow(2.0, 20.0 - u_Zoom);
    }

    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // 保持高度相对不变
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, lineHeight + h, 1.0));
    gl_PointSize = 10.0;
  }
}
`,IH=function(e){yn(r,e);var t=TH(r);function r(){return $t(this,r),t.apply(this,arguments)}return Gt(r,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),o=i.opacity,a=o===void 0?1:o,u=i.sourceColor,c=i.targetColor,h=i.vertexHeightScale,y=h===void 0?20:h,x=0,E=[0,0,0,0],T=[0,0,0,0];return u&&c&&(E=Da(u),T=Da(c),x=1),{u_opacity:Er.isNumber(a)?a:1,u_linearColor:x,u_sourceColor:E,u_targetColor:T,u_vertexScale:y}}},{key:"initModels",value:function(){var n=Vt(Ce.mark(function o(){return Ce.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",this.buildModels());case 1:case"end":return u.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getShaders",value:function(){var i=this.layer.getLayerConfig(),o=i.sourceColor,a=i.targetColor;return o&&a?{frag:PH,vert:LM,type:"lineSimpleLinear"}:{frag:MH,vert:LM,type:"lineSimpleNormal"}}},{key:"buildModels",value:function(){var n=Vt(Ce.mark(function o(){var a,u,c,h,y;return Ce.wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return a=this.getShaders(),u=a.frag,c=a.vert,h=a.type,E.next=3,this.layer.buildLayerModel({moduleName:h,vertexShader:c,fragmentShader:u,triangulation:mG,primitive:ae.LINES,depth:{enable:!1},pick:!1});case 3:return y=E.sent,E.abrupt("return",[y]);case 5:case"end":return E.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distance",type:gn.Attribute,descriptor:{name:"a_Distance",buffer:{usage:ae.STATIC_DRAW,data:[],type:ae.FLOAT},size:1,update:function(o,a,u){return[u[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:gn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:ae.STATIC_DRAW,data:[],type:ae.FLOAT},size:1,update:function(o,a,u){return[u[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:2,update:function(o){var a=o.size,u=a===void 0?1:a;return Array.isArray(u)?[u[0],u[1]]:[u,0]}}})}}]),r}(Co);function RH(e){var t=LH();return function(){var n=Ct(e),i;if(t){var o=Ct(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xn(this,i)}}function LH(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var kH=`#define Animate 0.0
#define LineTexture 1.0

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_opacity : 1.0;
uniform float u_textureBlend;
uniform float u_iconStepCount;
uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ]; // 控制运动

varying vec2 v_iconMapUV;
varying float v_blur;
varying float v_radio;
varying vec4 v_color;
varying vec4 v_dataset;

#pragma include "picking"

void main() {
  float opacity = u_opacity;
  float animateSpeed = 0.0; // 运动速度
  float d_distance_ratio = v_dataset.r; // 当前点位距离占线总长的比例
  float v = v_dataset.a;

  if(u_linearColor == 1.0) { // 使用渐变颜色
    gl_FragColor = mix(u_sourceColor, u_targetColor, v);
  } else { // 使用 color 方法传入的颜色
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // 全局透明度
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = v_dataset.g;      // 当前顶点的距离
    float d_texPixelLen = v_dataset.b;  // 贴图的像素长度，根据地图层级缩放
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = v_dataset.a;  // 线图层贴图部分的 v 坐标值

    // 计算纹理间隔 start
    float flag = 0.0;
    if(u > 1.0/u_iconStepCount) {
      flag = 1.0;
    }
    u = fract(u*u_iconStepCount);
    // 计算纹理间隔 end

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    // Tip: 判断纹理间隔
    if(flag > 0.0) {
      pattern = vec4(0.0);
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  }
  

  // blur - AA
  if(v < v_blur) {
    gl_FragColor.a = mix(0.0, gl_FragColor.a, v/v_blur);
  } else if(v > 1.0 - v_blur) {
    gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - v_blur))/v_blur);
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,OH=`#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;
attribute vec2 a_iconMapUV;
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;
uniform float u_heightfixed;
uniform float u_linearColor: 0;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

// texV 线图层 - 贴图部分的 v 坐标（线的宽度方向）
varying vec2 v_iconMapUV;
varying vec4 v_color;
varying float v_blur;
varying float v_radio;
varying vec4 v_dataset;

void main() {


  float d_distance_ratio; // 当前点位距离占线总长的比例
  float d_texPixelLen;    // 贴图的像素长度，根据地图层级缩放

  v_iconMapUV = a_iconMapUV;
  if(u_heightfixed < 1.0) {     // 高度随 zoom 调整
    d_texPixelLen = project_pixel(u_icon_step);
  } else {
    d_texPixelLen = u_icon_step;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  if(u_animate.x == Animate || u_linearColor == 1.0) {
      d_distance_ratio = a_Distance / a_Total_Distance;
  }

  float miter = (a_Miter + 1.0)/2.0;
  // 设置数据集的参数
  v_dataset[0] = d_distance_ratio; // 当前点位距离占线总长的比例
  v_dataset[1] = a_Distance;       // 当前顶点的距离
  v_dataset[2] = d_texPixelLen;    // 贴图的像素长度，根据地图层级缩放
  v_dataset[3] = miter;          // 线图层贴图部分的 v 坐标值 0 - 1

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float originSize = a_Size.x;  // 固定高度
  if(u_heightfixed < 1.0) {     // 高度随 zoom 调整
    originSize = project_float_pixel(a_Size.x);
  }

  float wallHeight = originSize * miter;
  float lightWeight = calc_lighting(vec4(project_pos.xy, wallHeight, 1.0));

  v_blur = min(project_float_pixel(2.0) / originSize, 0.05);
  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, wallHeight, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, wallHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,DH=function(e){yn(r,e);var t=RH(r);function r(){var n;$t(this,r);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return n=t.call.apply(t,[this].concat(o)),Q(Ye(n),"updateTexture",function(){var u=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=u({data:n.iconService.getCanvas(),mag:ae.NEAREST,min:ae.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return Gt(r,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),o=i.opacity,a=o===void 0?1:o,u=i.sourceColor,c=i.targetColor,h=i.textureBlend,y=h===void 0?"normal":h,x=i.heightfixed,E=x===void 0?!1:x,T=i.lineTexture,I=T===void 0?!1:T,k=i.iconStep,D=k===void 0?100:k,V=i.iconStepCount,O=V===void 0?1:V;this.rendererService.getDirty()&&this.texture.bind();var F=0,N=[0,0,0,0],H=[0,0,0,0];return u&&c&&(N=Da(u),H=Da(c),F=1),{u_heightfixed:Number(E),u_opacity:Er.isNumber(a)?a:1,u_textureBlend:y==="normal"?0:1,u_texture:this.texture,u_line_texture:I?1:0,u_iconStepCount:O,u_icon_step:D,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:F,u_sourceColor:N,u_targetColor:H}}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),o=i.animateOption;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=Vt(Ce.mark(function o(){return Ce.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),u.abrupt("return",this.buildModels());case 3:case"end":return u.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var n=Vt(Ce.mark(function o(){var a;return Ce.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.layer.buildLayerModel({moduleName:"lineWall",vertexShader:OH,fragmentShader:kH,triangulation:Iw,depth:{enable:!1},blend:this.getBlend()});case 2:return a=c.sent,c.abrupt("return",[a]);case 4:case"end":return c.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"distance",type:gn.Attribute,descriptor:{name:"a_Distance",buffer:{usage:ae.STATIC_DRAW,data:[],type:ae.FLOAT},size:1,update:function(a,u,c){return[c[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:gn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:ae.STATIC_DRAW,data:[],type:ae.FLOAT},size:1,update:function(a,u,c){return[c[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:2,update:function(a){var u=a.size,c=u===void 0?1:u;return Array.isArray(c)?[c[0],c[1]]:[c,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:gn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:ae.STATIC_DRAW,data:[],type:ae.FLOAT},size:3,update:function(a,u,c,h,y){return y}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:gn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:ae.STATIC_DRAW,data:[],type:ae.FLOAT},size:1,update:function(a,u,c){return[c[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:gn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:2,update:function(a){var u=i.iconService.getIconMap(),c=a.texture,h=u[c]||{x:0,y:0},y=h.x,x=h.y;return[y,x]}}})}}]),r}(Co),FH={arc:UG,arc3d:YG,greatcircle:pH,wall:DH,line:lL,simple:IH,linearline:AH,earthArc3d:rH,flowline:sH};const NH=FH;function BH(e){var t=zH();return function(){var n=Ct(e),i;if(t){var o=Ct(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xn(this,i)}}function zH(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var x_=function(e){yn(r,e);var t=BH(r);function r(){var n;$t(this,r);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return n=t.call.apply(t,[this].concat(o)),Q(Ye(n),"type","LineLayer"),Q(Ye(n),"enableEncodeStyles",["opacity","offsets","stroke"]),Q(Ye(n),"arrowInsertCount",0),Q(Ye(n),"defaultSourceConfig",{data:[{lng1:100,lat1:30,lng2:130,lat2:30}],options:{parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}}}),n}return Gt(r,[{key:"buildModels",value:function(){var n=Vt(Ce.mark(function o(){var a;return Ce.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return a=this.getModelType(),this.layerModel=new NH[a](this),c.next=4,this.initLayerModels();case 4:case"end":return c.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getDefaultConfig",value:function(){var i=this.getModelType(),o={line:{},linearline:{},simple:{},wall:{},arc3d:{blend:"additive"},arc:{blend:"additive"},greatcircle:{blend:"additive"},tileLine:{},earthArc3d:{},flowline:{}};return o[i]}},{key:"getModelType",value:function(){var i;if(this.layerType)return this.layerType;var o=this.styleAttributeService.getLayerStyleAttribute("shape"),a=o==null||(i=o.scale)===null||i===void 0?void 0:i.field;return a||"line"}},{key:"processData",value:function(i){if(this.getModelType()!=="simple")return i;var o=[];return i.map(function(a){if(Array.isArray(a.coordinates)&&Array.isArray(a.coordinates[0])&&Array.isArray(a.coordinates[0][0])){var u=_t({},a);a.coordinates.map(function(c){o.push(_t(_t({},u),{},{coordinates:c}))})}else o.push(a)}),o}}]),r}(Mg);function UH(e){var t=VH();return function(){var n=Ct(e),i;if(t){var o=Ct(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xn(this,i)}}function VH(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var jH=`varying vec4 v_color;
uniform float u_opacity: 1.0;

uniform float u_pickLight: 0.0;

#pragma include "picking"


uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_opacitylinear: 0.0;
uniform float u_opacitylinear_dir: 1.0;
varying float v_lightWeight;
varying float v_barLinearZ;
void main() {

   gl_FragColor = v_color;

  // 开启透明度渐变
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - v_barLinearZ): v_barLinearZ;
  }

  // picking
  if(u_pickLight > 0.0) {
    gl_FragColor = filterColorAlpha(gl_FragColor, v_lightWeight);
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,$H=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform float u_heightfixed: 0.0; // 默认不固定
uniform float u_globel;
uniform float u_r;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform float u_lightEnable: 1;
varying float v_lightWeight;
varying float v_barLinearZ;
// 用于将在顶点着色器中计算好的样式值传递给片元


#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  
  float textureOffset = 0.0; // 在 cell 中取值的偏移量

  textureOffset = opacityAndOffset.g;
  // cal style mapping - 数据纹理映射部分的计算
  vec3 size = a_Size * a_Position;

  // a_Position.z 是在构建网格的时候传入的标准值 0 - 1，在插值器插值可以获取 0～1 线性渐变的值
  v_barLinearZ =  a_Position.z;

  vec3 offset = size; // 控制圆柱体的大小 - 从标准单位圆柱体进行偏移
  if(u_heightfixed < 1.0) { // 圆柱体不固定高度
    
    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // P20 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减1
      offset = offset * pow(2.0, (19.0 - u_Zoom));
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
      // P20_2 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减3
      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));
    }
  } else {// 圆柱体固定高度 （ 处理 mapbox ）
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  // u_r 控制圆柱的生长
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // 圆柱光照效果
  float lightWeight = 1.0;
  if(u_lightEnable > 0.0) { // 取消三元表达式，增强健壮性
    lightWeight = calc_lighting(pos);
  }
  v_lightWeight = lightWeight;
  // 设置圆柱的底色
  if(u_linearColor == 1.0) { // 使用渐变颜色
    v_color = mix(u_sourceColor, u_targetColor, barLinearZ);
    v_color.rgb *= lightWeight;
  } else { // 使用 color 方法传入的颜色
     v_color = a_Color;
  }
  v_color.a *= u_opacity;

    
  // 在地球模式下，将原本垂直于 xy 平面的圆柱调整姿态到适应圆的角度
  //旋转矩阵mx，创建绕x轴旋转矩阵
  float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);
  float xRadian = getXRadian(a_Pos.y, r);
  float xcos = cos(xRadian);//求解旋转角度余弦值
  float xsin = sin(xRadian);//求解旋转角度正弦值
  mat4 mx = mat4(
    1,0,0,0,  
    0,xcos,-xsin,0,  
    0,xsin,xcos,0,  
    0,0,0,1);

  //旋转矩阵my，创建绕y轴旋转矩阵
  float yRadian = getYRadian(a_Pos.x, a_Pos.z);
  float ycos = cos(yRadian);//求解旋转角度余弦值
  float ysin = sin(yRadian);//求解旋转角度正弦值
  mat4 my = mat4(
    ycos,0,-ysin,0,  
    0,1,0,0,  
    ysin,0,ycos,0,  
    0,0,0,1);

  gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);
  

  setPickingColor(a_PickingColor);
}
`,GH=function(e){yn(r,e);var t=UH(r);function r(){var n;$t(this,r);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return n=t.call.apply(t,[this].concat(o)),Q(Ye(n),"raiseCount",0),Q(Ye(n),"raiseRepeat",0),n}return Gt(r,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),o=i.animateOption,a=o===void 0?{enable:!1,speed:.01,repeat:!1}:o,u=i.opacity,c=u===void 0?1:u,h=i.sourceColor,y=i.targetColor,x=i.pickLight,E=x===void 0?!1:x,T=i.heightfixed,I=T===void 0?!1:T,k=i.opacityLinear,D=k===void 0?{enable:!1,dir:"up"}:k,V=i.lightEnable,O=V===void 0?!0:V,F=0,N=[0,0,0,0],H=[0,0,0,0];if(h&&y&&(N=Da(h),H=Da(y),F=1),this.raiseCount<1&&this.raiseRepeat>0&&a.enable){var q=a.speed,Y=q===void 0?.01:q;this.raiseCount+=Y,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}return{u_pickLight:Number(E),u_heightfixed:Number(I),u_r:a.enable&&this.raiseRepeat>0?this.raiseCount:1,u_opacity:Er.isNumber(c)?c:1,u_linearColor:F,u_sourceColor:N,u_targetColor:H,u_opacitylinear:Number(D.enable),u_opacitylinear_dir:D.dir==="up"?1:0,u_lightEnable:Number(O)}}},{key:"initModels",value:function(){var n=Vt(Ce.mark(function o(){return Ce.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",this.buildModels());case 1:case"end":return u.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=Vt(Ce.mark(function o(){var a,u,c,h;return Ce.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return a=this.layer.getLayerConfig(),u=a.animateOption.repeat,c=u===void 0?1:u,this.raiseRepeat=c,x.next=4,this.layer.buildLayerModel({moduleName:"pointEarthExtrude",vertexShader:$H,fragmentShader:jH,triangulation:sL,depth:{enable:!0},cull:{enable:!0,face:zE(this.mapService.version)},blend:this.getBlend()});case 4:return h=x.sent,x.abrupt("return",[h]);case 6:case"end":return x.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:3,update:function(o){var a=o.size;if(a){var u=[];return Array.isArray(a)&&(u=a.length===2?[a[0],a[0],a[1]]:a),Array.isArray(a)||(u=[a,a,a]),u}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:gn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:ae.STATIC_DRAW,data:[],type:ae.FLOAT},size:3,update:function(o,a,u,c,h){return h}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:gn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:3,update:function(o){var a=Id(o.coordinates);return aL([a[0],a[1]])}}})}}]),r}(Co);function HH(e){var t=WH();return function(){var n=Ct(e),i;if(t){var o=Ct(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xn(this,i)}}function WH(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var XH=`uniform float u_additive;
uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  if(outer_df > antialiasblur + 0.018) discard;

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(strokeWidth < 0.01) {
    gl_FragColor = vec4(v_color.rgb, v_color.a * u_opacity);
  } else {
    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), u_stroke_color * u_stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor.a *= opacity_t;
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,YH=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  /*
  *  setPickingSize 设置拾取大小
  */
  float newSize = setPickingSize(a_Size);
  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur);

  // TODP: /abs(extrude.x) 是为了兼容地球模式
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);


  gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1 + u_offsets, 1.0);

  setPickingColor(a_PickingColor);
}
`,qH=function(e){yn(r,e);var t=HH(r);function r(){return $t(this,r),t.apply(this,arguments)}return Gt(r,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),o=i.opacity,a=o===void 0?1:o,u=i.strokeOpacity,c=u===void 0?1:u,h=i.strokeWidth,y=h===void 0?0:h,x=i.stroke,E=x===void 0?"rgba(0,0,0,0)":x,T=i.blend,I=i.blur,k=I===void 0?0:I;return{u_blur:k,u_additive:T==="additive"?1:0,u_opacity:a,u_stroke_opacity:c,u_stroke_width:y,u_stroke_color:Da(E)}}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),o=i.animateOption,a=o===void 0?{enable:!1}:o;return{u_animate:this.animateOption2Array(a),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=Vt(Ce.mark(function o(){return Ce.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",this.buildModels());case 1:case"end":return u.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=Vt(Ce.mark(function o(){var a;return Ce.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return this.layer.triangulation=PM,c.next=3,this.layer.buildLayerModel({moduleName:"pointEarthFill",vertexShader:YH,fragmentShader:XH,triangulation:PM,depth:{enable:!0},blend:this.getBlend()});case 3:return a=c.sent,c.abrupt("return",[a]);case 5:case"end":return c.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"animateOption2Array",value:function(i){return[i.enable?0:1,i.speed||1,i.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:gn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:3,update:function(a,u,c,h){var y=ei(c,3),x=y[0],E=y[1],T=y[2],I=Kf(0,0,1),k=Kf(x,0,T),D=x>=0?sw(I,k):Math.PI*2-sw(I,k),V=Math.PI*2-Math.asin(E/100),O=Tm();KE(O,O,D),Bx(O,O,V);var F=Kf(1,1,0);dy(F,F,O),F0(F,F);var N=Kf(-1,1,0);dy(N,N,O),F0(N,N);var H=Kf(-1,-1,0);dy(H,H,O),F0(H,H);var q=Kf(1,-1,0);dy(q,q,O),F0(q,q);var Y=[].concat(cn(F),cn(N),cn(H),cn(q)),ee=h%4*3;return[Y[ee],Y[ee+1],Y[ee+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:1,update:function(a){var u=a.size,c=u===void 0?5:u;return Array.isArray(c)?[c[0]]:[c]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:gn.Attribute,descriptor:{name:"a_Shape",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:1,update:function(a){var u=a.shape,c=u===void 0?2:u,h=i.layer.getLayerConfig().shape2d,y=h.indexOf(c);return[y]}}})}}]),r}(Co);function ZH(e){var t=KH();return function(){var n=Ct(e),i;if(t){var o=Ct(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xn(this,i)}}function KH(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var QH=`varying vec4 v_color;
varying float v_lightWeight;
uniform float u_pickLight: 0.0;

#pragma include "picking"


void main() {

  gl_FragColor = v_color;
  // 开启透明度渐变
  // picking
  if(u_pickLight > 0.0) {
    gl_FragColor = filterColorAlpha(gl_FragColor, v_lightWeight);
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,JH=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform float u_heightfixed: 0.0; // 默认不固定
uniform float u_r;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;
varying float v_lightWeight;
varying float v_barLinearZ;

uniform float u_opacity : 1;
uniform float u_lightEnable: 1;
uniform float u_opacitylinear: 0.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_opacitylinear_dir: 1.0;
uniform float  u_linearColor: 0.0;


#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {


  vec3 size = a_Size * a_Position;

  vec3 offset = size; // 控制圆柱体的大小 - 从标准单位圆柱体进行偏移

  if(u_heightfixed < 1.0) { // 圆柱体不固定高度
    
    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // P20 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减1
      offset = offset * pow(2.0, (19.0 - u_Zoom));
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
      // P20_2 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减3
      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));
    }
  } else {// 圆柱体固定高度 （ 处理 mapbox ）
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  // u_r 控制圆柱的生长
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // // 圆柱光照效果
  float lightWeight = 1.0;

  if(u_lightEnable > 0.0) { // 取消三元表达式，增强健壮性
    lightWeight = calc_lighting(pos);
  }

  v_lightWeight = lightWeight;

  v_color = a_Color;

    // 设置圆柱的底色
  if(u_linearColor == 1.0) { // 使用渐变颜色
    v_color = mix(u_sourceColor, u_targetColor, a_Position.z);
    v_color.a =  v_color.a * u_opacity;
  } else {
    v_color = vec4(a_Color.rgb * lightWeight, a_Color.w * u_opacity);
  }

    if(u_opacitylinear > 0.0) {
    v_color.a *= u_opacitylinear_dir > 0.0 ? (1.0 - a_Position.z): a_Position.z;
  }


  // gl_Position = project_common_position_to_clipspace(pos);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * pos;
  } else {
    gl_Position = project_common_position_to_clipspace(pos);
  }

  setPickingColor(a_PickingColor);
}
`,cL=function(e){yn(r,e);var t=ZH(r);function r(){var n;$t(this,r);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return n=t.call.apply(t,[this].concat(o)),Q(Ye(n),"raiseCount",0),Q(Ye(n),"raiseRepeat",0),n}return Gt(r,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),o=i.animateOption,a=o===void 0?{enable:!1,speed:.01,repeat:!1}:o,u=i.opacity,c=u===void 0?1:u,h=i.sourceColor,y=i.targetColor,x=i.pickLight,E=x===void 0?!1:x,T=i.heightfixed,I=T===void 0?!1:T,k=i.opacityLinear,D=k===void 0?{enable:!1,dir:"up"}:k,V=i.lightEnable,O=V===void 0?!0:V,F=0,N=[0,0,0,0],H=[0,0,0,0];if(h&&y&&(N=Da(h),H=Da(y),F=1),this.raiseCount<1&&this.raiseRepeat>0&&a.enable){var q=a.speed,Y=q===void 0?.01:q;this.raiseCount+=Y,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}return{u_pickLight:Number(E),u_heightfixed:Number(I),u_r:a.enable&&this.raiseRepeat>0?this.raiseCount:1,u_opacity:c,u_linearColor:F,u_sourceColor:N,u_targetColor:H,u_opacitylinear:Number(D.enable),u_opacitylinear_dir:D.dir==="up"?1:0,u_lightEnable:Number(O)}}},{key:"initModels",value:function(){var n=Vt(Ce.mark(function o(){return Ce.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",this.buildModels());case 1:case"end":return u.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=Vt(Ce.mark(function o(){var a,u,c,h,y,x;return Ce.wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return a=this.layer.getLayerConfig(),u=a.depth,c=u===void 0?!0:u,h=a.animateOption.repeat,y=h===void 0?1:h,this.raiseRepeat=y,T.next=4,this.layer.buildLayerModel({moduleName:"pointExtrude",vertexShader:JH,fragmentShader:QH,triangulation:sL,cull:{enable:!0,face:zE(this.mapService.version)},depth:{enable:c}});case 4:return x=T.sent,T.abrupt("return",[x]);case 6:case"end":return T.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:3,update:function(o){var a=o.size;if(a){var u=[];return Array.isArray(a)&&(u=a.length===2?[a[0],a[0],a[1]]:a),Array.isArray(a)||(u=[a,a,a]),u}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:gn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:ae.STATIC_DRAW,data:[],type:ae.FLOAT},size:3,update:function(o,a,u,c,h){return h}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:gn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:3,update:function(o){var a=Id(o.coordinates);return[a[0],a[1],0]}}})}}]),r}(Co);function eW(e){var t=tW();return function(){var n=Ct(e),i;if(t){var o=Ct(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xn(this,i)}}function tW(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var kM=`
uniform float u_additive;


varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

#pragma include "sdf_2d"
#pragma include "picking"

void main() {

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  
  outer_df = sdCircle(v_data.xy, 1.0);
  inner_df = sdCircle(v_data.xy, r);


  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );
  float PI = 3.14159;
  float N_RINGS = 3.0;
  float FREQ = 1.0;

  gl_FragColor = v_color;

  float d = length(v_data.xy);
  if(d > 0.5) {
    discard;
  }
  float intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_animate.z - u_animate.y * u_time)), 0.0, 1.0);
  
  // 根据叠加模式选择效果
  if(u_additive > 0.0) {
    gl_FragColor *= intensity;
    // 优化水波点 blend additive 模式下有的拾取效果 
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor = vec4(gl_FragColor.xyz, gl_FragColor.a * intensity);
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,rW=`uniform float u_additive;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
varying vec4 v_stroke;


#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));
  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + u_stroke_width);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(u_stroke_width < 0.01) {
    gl_FragColor = v_color;
  } else {
    gl_FragColor = mix(v_color, v_stroke * u_stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor.a *= opacity_t;
    gl_FragColor = filterColor(gl_FragColor);
  }
   // 作为 mask 模板时需要丢弃透明的像素
  if(gl_FragColor.a < 0.01) {
    discard;
  } 
}
`,f2=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform int u_size_unit;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
varying vec4 v_stroke;

// uniform float u_opacity : 1;
uniform float u_stroke_width: 2;
uniform vec3 u_blur_height_fixed: [0, 0, 0];


#pragma include "projection"
#pragma include "picking"


void main() {
  // 透明度计算
  v_stroke = stroke;  
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  /*
  *  setPickingSize 设置拾取大小
  *  u_meter2coord 在等面积大小的时候设置单位
  */
  float newSize = setPickingSize(a_Size);
  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;



  // unpack color(vec2)
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);

  if(u_size_unit == 1) {
    newSize = newSize  * u_PixelsPerMeter.z;
  }

   v_radius = newSize;

  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur_height_fixed.x);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + u_offsets);
  vec3 aPosition = a_Position;

  offset = project_pixel(offset);
  
  // TODP: /abs(extrude.x) 是为了兼容地球模式
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);


  // vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  float raisingHeight = u_blur_height_fixed.y;

  if(u_blur_height_fixed.z < 1.0) { // false
    raisingHeight = project_pixel(u_blur_height_fixed.y);
  } else {
     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_blur_height_fixed.y * mapboxZoomScale;
    }
  }
 

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position =  u_Mvp * vec4(project_pos.xy + offset, raisingHeight, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,fL=function(e){yn(r,e);var t=eW(r);function r(){return $t(this,r),t.apply(this,arguments)}return Gt(r,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),o=i.strokeOpacity,a=o===void 0?1:o,u=i.strokeWidth,c=u===void 0?0:u,h=i.blend,y=i.blur,x=y===void 0?0:y,E=i.raisingHeight,T=E===void 0?0:E,I=i.heightfixed,k=I===void 0?!1:I,D=i.unit,V=D===void 0?"pixel":D;return _t({u_blur_height_fixed:[x,Number(T),Number(k)],u_additive:h==="additive"?1:0,u_stroke_opacity:a,u_stroke_width:c,u_size_unit:dS[V]},this.getStyleAttribute())}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),o=i.animateOption,a=o===void 0?{enable:!1}:o;return{u_animate:this.animateOption2Array(a),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),P1)}},{key:"initModels",value:function(){var n=Vt(Ce.mark(function o(){return Ce.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",this.buildModels());case 1:case"end":return u.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=Vt(Ce.mark(function o(){var a,u,c,h,y,x,E,T;return Ce.wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return a=this.layer.getLayerConfig(),u=a.animateOption,c=u===void 0?{enable:!1}:u,h=this.getShaders(c),y=h.frag,x=h.vert,E=h.type,this.layer.triangulation=P1,k.next=5,this.layer.buildLayerModel({moduleName:E,vertexShader:x,fragmentShader:y,inject:this.getInject(),triangulation:P1,depth:{enable:!1}});case 5:return T=k.sent,k.abrupt("return",[T]);case 7:case"end":return k.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getShaders",value:function(i){if(i.enable)switch(i.type){case"wave":return{frag:kM,vert:f2,type:"pointWave"};default:return{frag:kM,vert:f2,type:"pointWave"}}else return{frag:rW,vert:f2,type:"pointFill"}}},{key:"animateOption2Array",value:function(i){return[i.enable?0:1,i.speed||1,i.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var i=this.layer.getLayerConfig().shape2d;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:gn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:3,update:function(a,u,c,h){var y=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],x=h%4*3;return[y[x],y[x+1],y[x+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:1,update:function(a){var u=a.size,c=u===void 0?5:u;return Array.isArray(c)?[c[0]]:[c]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:gn.Attribute,descriptor:{name:"a_Shape",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:1,update:function(a){var u=a.shape,c=u===void 0?2:u,h=i.indexOf(c);return[h]}}})}}]),r}(Co);function nW(e){var t=iW();return function(){var n=Ct(e),i;if(t){var o=Ct(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xn(this,i)}}function iW(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var aW=`uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

#pragma include "sdf_2d"
#pragma include "picking"
varying vec2 v_uv; // 本身的 uv 坐标
varying vec2 v_Iconuv;

void main() {

  vec2 pos = v_Iconuv / u_textSize + v_uv / u_textSize * 64.;
  gl_FragColor = texture2D(u_texture, pos);
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,oW=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute vec2 a_Uv;
attribute float a_Rotate;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform mat2 u_RotateMatrix;
uniform int u_size_unit;

varying vec2 v_uv; // 本身的 uv 坐标
varying vec2 v_Iconuv; // icon 贴图的 uv 坐标

uniform float u_raisingHeight: 0.0;
uniform float u_heightfixed: 0.0;
uniform float u_opacity : 1;
uniform vec2 u_offsets;



#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 extrude = a_Extrude;
  v_uv = (a_Extrude.xy + 1.0)/2.0;
  v_uv.y = 1.0 - v_uv.y;
  v_Iconuv = a_Uv;


  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  float newSize = a_Size;
  if(u_size_unit == 1) {
    newSize = newSize  * u_PixelsPerMeter.z;
  }

  // vec2 offset = (u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec2 offset = (rotation_matrix * u_RotateMatrix * extrude.xy * (newSize) + u_offsets);
  vec3 aPosition = a_Position;

  offset = project_pixel(offset);

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  float raisingHeight = u_raisingHeight;
  if(u_heightfixed < 1.0) { // height fixed
    raisingHeight = project_pixel(u_raisingHeight);
  } else {
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_raisingHeight * mapboxZoomScale;
    }
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp *vec4(project_pos.xy + offset, raisingHeight, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,sW=function(e){yn(r,e);var t=nW(r);function r(){var n;$t(this,r);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return n=t.call.apply(t,[this].concat(o)),Q(Ye(n),"meter2coord",1),Q(Ye(n),"isMeter",!1),Q(Ye(n),"radian",0),Q(Ye(n),"updateTexture",function(){var u=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),n.layerService.throttleRenderLayers();return}n.texture=u({data:n.iconService.getCanvas(),mag:ae.LINEAR,min:ae.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0})}),n}return Gt(r,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),o=i.opacity,a=o===void 0?1:o,u=i.offsets,c=u===void 0?[0,0]:u,h=i.rotation,y=i.raisingHeight,x=y===void 0?0:y,E=i.heightfixed,T=E===void 0?!1:E,I=i.unit,k=I===void 0?"pixel":I;this.rendererService.getDirty()&&this.texture.bind();var D=1;return(this.mapService.version==="GAODE2.x"||this.mapService.version==="GAODE1.x")&&(D=-1),this.radian=h!==void 0?D*Math.PI*h/180:D*Math.PI*(this.mapService.getRotation()%360)/180,{u_raisingHeight:Number(x),u_heightfixed:Number(T),u_size_unit:dS[k],u_RotateMatrix:new Float32Array([Math.cos(this.radian),Math.sin(this.radian),-Math.sin(this.radian),Math.cos(this.radian)]),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:a,u_offsets:c}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),ex)}},{key:"initModels",value:function(){var n=Vt(Ce.mark(function o(){return Ce.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return this.iconService.on("imageUpdate",this.updateTexture),this.updateTexture(),u.abrupt("return",this.buildModels());case 3:case"end":return u.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=Vt(Ce.mark(function o(){var a;return Ce.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.layer.buildLayerModel({moduleName:"pointFillImage",vertexShader:oW,fragmentShader:aW,triangulation:ex,depth:{enable:!1},cull:{enable:!0,face:zE(this.mapService.version)}});case 2:return a=c.sent,c.abrupt("return",[a]);case 4:case"end":return c.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;this.iconService.off("imageUpdate",this.updateTexture),(i=this.texture)===null||i===void 0||i.destroy()}},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"rotate",type:gn.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:1,update:function(a){var u=a.rotate,c=u===void 0?0:u;return Array.isArray(c)?[c[0]]:[c]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:gn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:2,update:function(a){var u=i.iconService.getIconMap(),c=a.shape,h=u[c]||{x:-64,y:-64},y=h.x,x=h.y;return[y,x]}}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:gn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:3,update:function(a,u,c,h){var y=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],x=h%4*3;return[y[x],y[x+1],y[x+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:1,update:function(a){var u=a.size,c=u===void 0?5:u;return Array.isArray(c)?[c[0]]:[c]}}})}}]),r}(Co);function uW(e){var t=lW();return function(){var n=Ct(e),i;if(t){var o=Ct(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xn(this,i)}}function lW(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var cW=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

#pragma include "picking"

void main(){
      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor;

      // Y = 0.299R + 0.587G + 0.114B // 亮度提取
     
      textureColor = texture2D(u_texture, pos);

      // Tip: 去除边缘部分 mipmap 导致的混合变暗
      float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
      if(fragmengTocenter >= 0.5) {
            float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
            textureColor.a *= luma;
      }
      
      

      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }

      gl_FragColor.a = gl_FragColor.a * u_opacity;
      
      if (gl_FragColor.a < 0.01) {
         discard;
      }
      gl_FragColor = filterColor(gl_FragColor);
}
`,fW=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec2 u_offsets;

uniform float u_opacity : 1;
uniform float u_raisingHeight: 0.0;
uniform float u_heightfixed: 0.0;


#pragma include "projection"
#pragma include "picking"

void main() {

  // cal style mapping - 数据纹理映射部分的计算
  v_color = a_Color;
  v_uv = a_Uv;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  vec2 offset = project_pixel(u_offsets);

  float raisingHeight = u_raisingHeight;
  if(u_heightfixed < 1.0) { // false
    raisingHeight = project_pixel(u_raisingHeight);
  } else {
     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_raisingHeight * mapboxZoomScale;
    }
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, raisingHeight, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`,hL=function(e){yn(r,e);var t=uW(r);function r(){var n;$t(this,r);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return n=t.call.apply(t,[this].concat(o)),Q(Ye(n),"updateTexture",function(){var u=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),setTimeout(function(){n.layerService.throttleRenderLayers()});return}n.texture=u({data:n.iconService.getCanvas(),mag:ae.LINEAR,min:ae.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0})}),n}return Gt(r,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),o=i.opacity,a=o===void 0?1:o,u=i.offsets,c=u===void 0?[0,0]:u,h=i.raisingHeight,y=h===void 0?0:h,x=i.heightfixed,E=x===void 0?!1:x;return this.rendererService.getDirty()&&this.texture.bind(),{u_raisingHeight:Number(y),u_heightfixed:Number(E),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:a,u_offsets:c}}},{key:"initModels",value:function(){var n=Vt(Ce.mark(function o(){return Ce.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return this.iconService.on("imageUpdate",this.updateTexture),this.updateTexture(),u.abrupt("return",this.buildModels());case 3:case"end":return u.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var n=Vt(Ce.mark(function o(){var a;return Ce.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:fW,fragmentShader:cW,triangulation:dG,depth:{enable:!1},primitive:ae.POINTS});case 2:return a=c.sent,c.abrupt("return",[a]);case 4:case"end":return c.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:1,update:function(a){var u=a.size,c=u===void 0?5:u;return Array.isArray(c)?[c[0]]:[c]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:gn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:2,update:function(a){var u=i.iconService.getIconMap(),c=a.shape,h=u[c]||{x:-64,y:-64},y=h.x,x=h.y;return[y,x]}}})}}]),r}(Co);function hW(e){var t=pW();return function(){var n=Ct(e),i;if(t){var o=Ct(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xn(this,i)}}function pW(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var dW=`varying vec4 v_color;
void main() {
  gl_FragColor = v_color;
}
`,vW=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform float u_opacity : 1;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;

varying vec4 v_color;

#pragma include "projection"
#pragma include "project"

void main() {
  v_color = vec4(a_Color.xyz, a_Color.w * u_opacity);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(a_Position.xy, a_Position.z, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
}
`;function OM(e){var t=e.coordinates;return{vertices:cn(t),indices:[0],size:t.length}}var pL=function(e){yn(r,e);var t=hW(r);function r(){return $t(this,r),t.apply(this,arguments)}return Gt(r,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),o=i.opacity,a=o===void 0?1:o;return{u_opacity:Er.isNumber(a)?a:1}}},{key:"initModels",value:function(){var n=Vt(Ce.mark(function o(){return Ce.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",this.buildModels());case 1:case"end":return u.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=Vt(Ce.mark(function o(){var a;return Ce.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return this.layer.triangulation=OM,c.next=3,this.layer.buildLayerModel({moduleName:"pointNormal",vertexShader:vW,fragmentShader:dW,triangulation:OM,depth:{enable:!1},primitive:ae.POINTS,pick:!1});case 3:return a=c.sent,c.abrupt("return",[a]);case 5:case"end":return c.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:1,update:function(o){var a=o.size,u=a===void 0?1:a;return Array.isArray(u)?[u[0]]:[u]}}})}}]),r}(Co);function mW(e){var t=gW();return function(){var n=Ct(e),i;if(t){var o=Ct(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xn(this,i)}}function gW(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var yW=`
uniform float u_additive;
uniform float u_opacity: 1.0;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
varying vec2 v_exteude;
#pragma include "sdf_2d"
#pragma include "picking"

void main() {

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df = sdCircle(v_data.xy, 1.0);
  float inner_df = sdCircle(v_data.xy, r);

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  gl_FragColor = vec4(v_color.rgb, v_color.a * u_opacity);

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
  } else {
    gl_FragColor.a *= opacity_t;
  }

  if(gl_FragColor.a > 0.0) {
    gl_FragColor = filterColor(gl_FragColor);
  }

  vec2 extrude =  v_exteude;
  vec2 dir = normalize(extrude);
  vec2 baseDir = vec2(1.0, 0.0);
  float pi = 3.14159265359;
  // full circle
  // float rades = dot(dir, baseDir);
  // float flag = sign(dir.y);
  // float radar_v = (flag - 1.0) * -0.5 + flag * acos(rades)/pi/2.0;
  
  // half circle
  float flag = sign(dir.y);
  float rades = dot(dir, baseDir);
  float radar_v = (flag - 1.0) * -0.5 * acos(rades)/pi;
  // simple AA
  if(radar_v > 0.99) {
    radar_v = 1.0 - (radar_v - 0.99)/0.01;
  }

  gl_FragColor.a *= radar_v;
}
`,_W=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
uniform float u_speed: 1.0;
uniform float u_time;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform int u_size_unit;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
varying vec2 v_exteude;

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 extrude = a_Extrude;
  float newSize = setPickingSize(a_Size);

  float time = u_time * u_speed;
  mat2 rotateMatrix = mat2( 
    cos(time), sin(time), 
    -sin(time), cos(time)
  );
  v_exteude = rotateMatrix * a_Extrude.xy;

  // unpack color(vec2)
  v_color = a_Color;



  // anti-alias
  float blur = 0.0;
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, blur);

  if(u_size_unit == 1) {
    newSize = newSize  * u_PixelsPerMeter.z;
  }
  // radius(16-bit)
  v_radius = newSize;

  vec2 offset = (extrude.xy * (newSize));
  vec3 aPosition = a_Position;
  
    // 不以米为实际单位
  offset = project_pixel(offset);
  
  v_data = vec4(extrude.x, extrude.y, antialiasblur, -1.0);

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp *vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,xW=function(e){yn(r,e);var t=mW(r);function r(){return $t(this,r),t.apply(this,arguments)}return Gt(r,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),o=i.opacity,a=o===void 0?1:o,u=i.blend,c=i.speed,h=c===void 0?1:c,y=i.unit,x=y===void 0?"pixel":y;return{u_size_unit:dS[x],u_speed:h,u_additive:u==="additive"?1:0,u_opacity:a}}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),o=i.animateOption,a=o===void 0?{enable:!1}:o;return{u_animate:this.animateOption2Array(a),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),ex)}},{key:"initModels",value:function(){var n=Vt(Ce.mark(function o(){return Ce.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",this.buildModels());case 1:case"end":return u.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=Vt(Ce.mark(function o(){var a;return Ce.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.layer.buildLayerModel({moduleName:"pointRadar",vertexShader:_W,fragmentShader:yW,triangulation:ex,depth:{enable:!1}});case 2:return a=c.sent,c.abrupt("return",[a]);case 4:case"end":return c.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"animateOption2Array",value:function(i){return[i.enable?0:1,i.speed||1,i.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"extrude",type:gn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:3,update:function(o,a,u,c){var h=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],y=c%4*3;return[h[y],h[y+1],h[y+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:1,update:function(o){var a=o.size,u=a===void 0?5:a;return Array.isArray(u)?[u[0]]:[u]}}})}}]),r}(Co);function bW(e){var t=wW();return function(){var n=Ct(e),i;if(t){var o=Ct(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xn(this,i)}}function wW(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var EW=`
uniform float u_additive;
uniform float u_stroke_opacity : 1;

uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

varying vec4 v_color;
varying float v_blur;
varying float v_innerRadius;

#pragma include "picking"
void main() {
  vec2 center = vec2(0.5);

  // Tip: 片元到中心点的距离 0 - 1
  float fragmengTocenter = distance(center, gl_PointCoord) * 2.0;
  // Tip: 片元的剪切成圆形
  float circleClipOpacity = 1.0 - smoothstep(v_blur, 1.0, fragmengTocenter);


  if(v_innerRadius < 0.99) {
    // 当存在 stroke 且 stroke > 0.01
    float blurWidth = (1.0 - v_blur)/2.0;
    vec4 stroke = vec4(u_stroke_color.rgb, u_stroke_opacity);
    if(fragmengTocenter > v_innerRadius + blurWidth) {
      gl_FragColor = stroke;
    } else if(fragmengTocenter > v_innerRadius - blurWidth){
      float mixR = (fragmengTocenter - (v_innerRadius - blurWidth)) / (blurWidth * 2.0);
      gl_FragColor = mix(v_color, stroke, mixR);
    } else {
      gl_FragColor = v_color;
    }
  } else {
    // 当不存在 stroke 或 stroke <= 0.01
    gl_FragColor = v_color;
  }

  gl_FragColor = filterColor(gl_FragColor);
  
  if(u_additive > 0.0) {
    gl_FragColor *= circleClipOpacity;
  } else {
    gl_FragColor.a *= circleClipOpacity;
  }

}
`,SW=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_stroke_width;

varying float v_blur;
varying float v_innerRadius;



#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = vec4(a_Color.xyz, a_Color.w * u_opacity);
  v_blur = 1.0 - max(2.0/a_Size, 0.05);
  v_innerRadius = max((a_Size - u_stroke_width) / a_Size, 0.0);
  
  vec2 offset = project_pixel(u_offsets);
  
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function DM(e){var t=e.coordinates;return{vertices:cn(t),indices:[0],size:t.length}}var AW=function(e){yn(r,e);var t=bW(r);function r(){return $t(this,r),t.apply(this,arguments)}return Gt(r,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),o=i.opacity,a=o===void 0?1:o,u=i.offsets,c=u===void 0?[0,0]:u,h=i.blend,y=i.strokeOpacity,x=y===void 0?1:y,E=i.strokeWidth,T=E===void 0?0:E,I=i.stroke,k=I===void 0?"#fff":I;return{u_additive:h==="additive"?1:0,u_opacity:a,u_offsets:c,u_stroke_opacity:x,u_stroke_width:T,u_stroke_color:Da(k)}}},{key:"initModels",value:function(){var n=Vt(Ce.mark(function o(){return Ce.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",this.buildModels());case 1:case"end":return u.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=Vt(Ce.mark(function o(){var a;return Ce.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return this.layer.triangulation=DM,c.next=3,this.layer.buildLayerModel({moduleName:"pointSimple",vertexShader:SW,fragmentShader:EW,triangulation:DM,depth:{enable:!1},primitive:ae.POINTS});case 3:return a=c.sent,c.abrupt("return",[a]);case 5:case"end":return c.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:1,update:function(o){var a=o.size,u=a===void 0?1:a;return Array.isArray(u)?[u[0]]:[u]}}})}}]),r}(Co);function TW(e,t){var r=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=CW(e))||t&&e&&typeof e.length=="number"){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(h){throw h},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,a=!1,u;return{s:function(){r=r.call(e)},n:function(){var h=r.next();return o=h.done,h},e:function(h){a=!0,u=h},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(a)throw u}}}}function CW(e,t){if(e){if(typeof e=="string")return FM(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return FM(e,t)}}function FM(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var MW=function(){function e(t,r,n){$t(this,e),Q(this,"boxCells",[]);var i=this.boxCells;this.xCellCount=Math.ceil(t/n),this.yCellCount=Math.ceil(r/n);for(var o=0;o<this.xCellCount*this.yCellCount;o++)i.push([]);this.boxKeys=[],this.bboxes=[],this.width=t,this.height=r,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/r,this.boxUid=0}return Gt(e,[{key:"insert",value:function(r,n,i,o,a){this.forEachCell(n,i,o,a,this.insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(n),this.bboxes.push(i),this.bboxes.push(o),this.bboxes.push(a)}},{key:"query",value:function(r,n,i,o,a){return this.queryHitTest(r,n,i,o,!1,a)}},{key:"hitTest",value:function(r,n,i,o,a){return this.queryHitTest(r,n,i,o,!0,a)}},{key:"insertBoxCell",value:function(r,n,i,o,a,u){this.boxCells[a].push(u)}},{key:"queryHitTest",value:function(r,n,i,o,a,u){if(i<0||r>this.width||o<0||n>this.height)return a?!1:[];var c=[];if(r<=0&&n<=0&&this.width<=i&&this.height<=o){if(a)return!0;for(var h=0;h<this.boxKeys.length;h++)c.push({key:this.boxKeys[h],x1:this.bboxes[h*4],y1:this.bboxes[h*4+1],x2:this.bboxes[h*4+2],y2:this.bboxes[h*4+3]});return u?c.filter(u):c}var y={hitTest:a,seenUids:{box:{},circle:{}}};return this.forEachCell(r,n,i,o,this.queryCell,c,y,u),a?c.length>0:c}},{key:"queryCell",value:function(r,n,i,o,a,u,c,h){var y=c.seenUids,x=this.boxCells[a];if(x!==null){var E=this.bboxes,T=TW(x),I;try{for(T.s();!(I=T.n()).done;){var k=I.value;if(!y.box[k]){y.box[k]=!0;var D=k*4;if(r<=E[D+2]&&n<=E[D+3]&&i>=E[D+0]&&o>=E[D+1]&&(!h||h(this.boxKeys[k]))){if(c.hitTest)return u.push(!0),!0;u.push({key:this.boxKeys[k],x1:E[D],y1:E[D+1],x2:E[D+2],y2:E[D+3]})}}}}catch(V){T.e(V)}finally{T.f()}}return!1}},{key:"forEachCell",value:function(r,n,i,o,a,u,c,h){for(var y=this.convertToXCellCoord(r),x=this.convertToYCellCoord(n),E=this.convertToXCellCoord(i),T=this.convertToYCellCoord(o),I=y;I<=E;I++)for(var k=x;k<=T;k++){var D=this.xCellCount*k+I;if(a.call(this,r,n,i,o,D,u,c,h))return}}},{key:"convertToXCellCoord",value:function(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}},{key:"convertToYCellCoord",value:function(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}}]),e}();const PW=MW;var IW=function(){function e(t,r){$t(this,e),Q(this,"viewportPadding",100),this.width=t,this.height=r,this.viewportPadding=Math.max(t,r),this.grid=new PW(t+this.viewportPadding,r+this.viewportPadding,25),this.screenRightBoundary=t+this.viewportPadding,this.screenBottomBoundary=r+this.viewportPadding,this.gridRightBoundary=t+2*this.viewportPadding,this.gridBottomBoundary=r+2*this.viewportPadding}return Gt(e,[{key:"placeCollisionBox",value:function(r){var n=r.x1+r.anchorPointX+this.viewportPadding,i=r.y1+r.anchorPointY+this.viewportPadding,o=r.x2+r.anchorPointX+this.viewportPadding,a=r.y2+r.anchorPointY+this.viewportPadding;return!this.isInsideGrid(n,i,o,a)||this.grid.hitTest(n,i,o,a)?{box:[]}:{box:[n,i,o,a]}}},{key:"insertCollisionBox",value:function(r,n){var i={featureIndex:n};this.grid.insert(i,r[0],r[1],r[2],r[3])}},{key:"project",value:function(r,n,i){var o=QN(n,i,0,1),a=mR(),u=KI.apply(_N,cn(r));return JE(a,o,u),{x:(a[0]/a[3]+1)/2*this.width+this.viewportPadding,y:(-a[1]/a[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(r,n,i,o){return i>=0&&r<this.gridRightBoundary&&o>=0&&n<this.gridBottomBoundary}}]),e}();function dL(e,t){var r=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=RW(e))||t&&e&&typeof e.length=="number"){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(h){throw h},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,a=!1,u;return{s:function(){r=r.call(e)},n:function(){var h=r.next();return o=h.done,h},e:function(h){a=!0,u=h},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(a)throw u}}}}function RW(e,t){if(e){if(typeof e=="string")return NM(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return NM(e,t)}}function NM(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function vL(e){var t=.5,r=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0;break;default:t=.5}switch(e){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0;break;default:r=.5}return{horizontalAlign:t,verticalAlign:r}}function mL(e,t,r,n,i){if(i){var o=e[n],a=o.glyph;if(a)for(var u=t[a].advance*o.scale,c=(e[n].x+u)*i,h=r;h<=n;h++)e[h].x-=c}}function gL(e,t,r,n,i,o,a){var u=(t-r)*i,c=(-n*a+.5)*o,h=dL(e),y;try{for(h.s();!(y=h.n()).done;){var x=y.value;x.x+=u,x.y+=c}}catch(E){h.e(E)}finally{h.f()}}function LW(e,t,r,n,i,o,a){var u=-8,c=0,h=u,y=0,x=e.positionedGlyphs,E=o==="right"?1:o==="left"?0:.5,T=x.length;r.forEach(function(O){if(O.split("").forEach(function(N){var H=t[N],q=0;H&&(x.push({glyph:N,x:c,y:h+q,vertical:!1,scale:1,metrics:H}),c+=H.advance+a)}),x.length!==T){var F=c-a;y=Math.max(F,y),mL(x,t,T,x.length-1,E)}c=0,h-=n+5});var I=vL(i),k=I.horizontalAlign,D=I.verticalAlign;gL(x,E,k,D,y,n,r.length);var V=h-u;e.top+=-D*V,e.bottom=e.top-V,e.left+=-k*y,e.right=e.left+y}function kW(e,t,r,n,i,o,a){var u=-8,c=0,h=u,y=0,x=e.positionedGlyphs,E=o==="right"?1:o==="left"?0:.5,T=x.length;r.forEach(function(O){var F=t[O],N=0;if(F&&(x.push({glyph:O,x:F.advance/2,y:h+N,vertical:!1,scale:1,metrics:F}),c+=F.advance+a),x.length!==T){var H=c-a;y=Math.max(H,y),mL(x,t,T,x.length-1,E)}c=0,h-=n+5});var I=vL(i),k=I.horizontalAlign,D=I.verticalAlign;gL(x,E,k,D,y,n,r.length);var V=h-u;e.top+=-D*V,e.bottom=e.top-V,e.left+=-k*y,e.right=e.left+y}function OW(e,t,r,n,i,o){var a=arguments.length>6&&arguments[6]!==void 0?arguments[6]:[0,0],u=arguments.length>7?arguments[7]:void 0,c=e.split(`
`),h=[],y={positionedGlyphs:h,top:a[1],bottom:a[1],left:a[0],right:a[0],lineCount:c.length,text:e};return u?kW(y,t,c,r,n,i,o):LW(y,t,c,r,n,i,o),h.length?y:!1}function DW(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0],r=arguments.length>2?arguments[2]:void 0,n=e.positionedGlyphs,i=n===void 0?[]:n,o=[],a=dL(i),u;try{for(a.s();!(u=a.n()).done;){var c=u.value,h=c.metrics,y=4,x=h.advance*c.scale/2,E=r?[c.x+x,c.y]:[0,0],T=r?[0,0]:[c.x+x+t[0],c.y+t[1]],I=(0-y)*c.scale-x+T[0],k=(0-y)*c.scale+T[1],D=I+h.width*c.scale,V=k+h.height*c.scale,O={x:I,y:k},F={x:D,y:k},N={x:I,y:V},H={x:D,y:V};o.push({tl:O,tr:F,bl:N,br:H,tex:h,glyphOffset:E})}}catch(q){a.e(q)}finally{a.f()}return o}function FW(e,t){var r=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=NW(e))||t&&e&&typeof e.length=="number"){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(h){throw h},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,a=!1,u;return{s:function(){r=r.call(e)},n:function(){var h=r.next();return o=h.done,h},e:function(h){a=!0,u=h},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(a)throw u}}}}function NW(e,t){if(e){if(typeof e=="string")return BM(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return BM(e,t)}}function BM(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function BW(e){var t=zW();return function(){var n=Ct(e),i;if(t){var o=Ct(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xn(this,i)}}function zW(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var zM=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec4 v_stroke_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;


#pragma include "picking"
void main() {
  // get style data mapping

  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);

  gl_FragColor = mix(v_color, v_stroke_color, smoothstep(0., 0.5, 1.- dist));

  gl_FragColor.a *= alpha;
   // 作为 mask 模板时需要丢弃透明的像素
  if (gl_FragColor.a < 0.01) {
    discard;
  }
  gl_FragColor = filterColor(gl_FragColor);
}
`,UM=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;
attribute float a_Rotate;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_raisingHeight: 0.0;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying vec4 v_stroke_color;
varying float v_fontScale;
// uniform float u_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];


#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - 数据纹理映射部分的计算
  
  v_uv = a_tex / u_sdf_map_size;



  v_color = vec4(a_Color.xyz, a_Color.w * opacity);
  v_stroke_color = vec4(u_stroke_color.xyz, u_stroke_color.w * opacity);

  // 文本缩放比例
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  float raiseHeight = u_raisingHeight;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    raiseHeight = u_raisingHeight * mapboxZoomScale;
  }

  vec4 projected_position;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
   projected_position  = u_Mvp *(vec4(a_Position.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));
  } else { // else
   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));
  }

  gl_Position = vec4(
    projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`;function VM(e){var t=this,r=e.id,n=[],i=[];if(!t.glyphInfoMap||!t.glyphInfoMap[r])return{vertices:[],indices:[],size:7};var o=t.glyphInfoMap[r].centroid,a=o.length===2?[o[0],o[1],0]:o;return t.glyphInfoMap[r].glyphQuads.forEach(function(u,c){n.push.apply(n,cn(a).concat([u.tex.x,u.tex.y+u.tex.height,u.tl.x,u.tl.y],cn(a),[u.tex.x+u.tex.width,u.tex.y+u.tex.height,u.tr.x,u.tr.y],cn(a),[u.tex.x+u.tex.width,u.tex.y,u.br.x,u.br.y],cn(a),[u.tex.x,u.tex.y,u.bl.x,u.bl.y])),i.push(0+c*4,1+c*4,2+c*4,2+c*4,3+c*4,0+c*4)}),{vertices:n,indices:i,size:7}}var yL=function(e){yn(r,e);var t=BW(r);function r(){var n;$t(this,r);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return n=t.call.apply(t,[this].concat(o)),Q(Ye(n),"glyphInfoMap",{}),Q(Ye(n),"currentZoom",-1),Q(Ye(n),"textureHeight",0),Q(Ye(n),"textCount",0),Q(Ye(n),"preTextStyle",{}),Q(Ye(n),"mapping",Vt(Ce.mark(function u(){return Ce.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return n.initGlyph(),n.updateTexture(),h.next=4,n.reBuildModel();case 4:case"end":return h.stop()}},u)}))),n}return Gt(r,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig();i.opacity;var o=i.stroke,a=o===void 0?"#fff":o,u=i.strokeWidth,c=u===void 0?0:u,h=i.halo,y=h===void 0?.5:h,x=i.gamma,E=x===void 0?2:x,T=i.raisingHeight,I=T===void 0?0:T,k=this.getFontServiceMapping(),D=this.getFontServiceCanvas();return k&&Object.keys(k).length!==this.textCount&&D&&(this.updateTexture(),this.textCount=Object.keys(k).length),this.preTextStyle=this.getTextStyle(),_t({u_raisingHeight:Number(I),u_stroke_width:c,u_stroke_color:Da(a),u_sdf_map:this.texture,u_halo_blur:y,u_gamma_scale:E,u_sdf_map_size:[(D==null?void 0:D.width)||1,(D==null?void 0:D.height)||1]},this.getStyleAttribute())}},{key:"initModels",value:function(){var n=Vt(Ce.mark(function o(){return Ce.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return this.bindEvent(),this.extent=this.textExtent(),this.rawEncodeData=this.layer.getEncodedData(),this.preTextStyle=this.getTextStyle(),u.abrupt("return",this.buildModels());case 5:case"end":return u.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=Vt(Ce.mark(function o(){var a,u,c,h;return Ce.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return a=this.layer.getLayerConfig(),u=a.textAllowOverlap,c=u===void 0?!1:u,this.initGlyph(),this.updateTexture(),c||this.filterGlyphs(),x.next=6,this.layer.buildLayerModel({moduleName:"pointText",vertexShader:UM,fragmentShader:zM,inject:this.getInject(),triangulation:VM.bind(this),depth:{enable:!1}});case 6:return h=x.sent,x.abrupt("return",[h]);case 8:case"end":return x.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"needUpdate",value:function(){var n=Vt(Ce.mark(function o(){var a,u,c,h,y,x,E,T,I,k,D,V;return Ce.wrap(function(F){for(;;)switch(F.prev=F.next){case 0:if(a=this.getTextStyle(),u=a.textAllowOverlap,c=u===void 0?!1:u,h=a.textAnchor,y=h===void 0?"center":h,x=a.textOffset,E=a.padding,T=a.fontFamily,I=a.fontWeight,!(!Er.isEqual(E,this.preTextStyle.padding)||!Er.isEqual(x,this.preTextStyle.textOffset)||!Er.isEqual(y,this.preTextStyle.textAnchor)||!Er.isEqual(T,this.preTextStyle.fontFamily)||!Er.isEqual(I,this.preTextStyle.fontWeight))){F.next=5;break}return F.next=4,this.mapping();case 4:return F.abrupt("return",!0);case 5:if(!c){F.next=7;break}return F.abrupt("return",!1);case 7:if(k=this.mapService.getZoom(),D=this.mapService.getBounds(),V=NI(this.extent,D),!(Math.abs(this.currentZoom-k)>.5||!V||c!==this.preTextStyle.textAllowOverlap)){F.next=14;break}return F.next=13,this.reBuildModel();case 13:return F.abrupt("return",!0);case 14:return F.abrupt("return",!1);case 15:case"end":return F.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.layer.off("remapping",this.mapping)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"rotate",type:gn.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:1,update:function(o){var a=o.rotate,u=a===void 0?0:a;return Array.isArray(u)?[u[0]]:[u]}}}),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:gn.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:ae.STATIC_DRAW,data:[],type:ae.FLOAT},size:2,update:function(o,a,u){return[u[5],u[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:1,update:function(o){var a=o.size,u=a===void 0?12:a;return Array.isArray(u)?[u[0]]:[u]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:gn.Attribute,descriptor:{name:"a_tex",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:2,update:function(o,a,u){return[u[3],u[4]]}}})}},{key:"bindEvent",value:function(){this.layer.isTileLayer||this.layer.on("remapping",this.mapping)}},{key:"textExtent",value:function(){var i=this.mapService.getBounds();return jE(i,.5)}},{key:"initTextFont",value:function(){var i=this.getTextStyle(),o=i.fontWeight,a=i.fontFamily,u=this.rawEncodeData,c=[];u.forEach(function(h){var y=h.shape,x=y===void 0?"":y;x=x.toString();var E=FW(x),T;try{for(E.s();!(T=E.n()).done;){var I=T.value;c.indexOf(I)===-1&&c.push(I)}}catch(k){E.e(k)}finally{E.f()}}),this.fontService.setFontOptions({characterSet:c,fontWeight:o,fontFamily:a,iconfont:!1})}},{key:"initIconFontTex",value:function(){var i=this.getTextStyle(),o=i.fontWeight,a=i.fontFamily,u=this.rawEncodeData,c=[];u.forEach(function(h){var y=h.shape,x=y===void 0?"":y;x="".concat(x),c.indexOf(x)===-1&&c.push(x)}),this.fontService.setFontOptions({characterSet:c,fontWeight:o,fontFamily:a,iconfont:!0})}},{key:"getTextStyle",value:function(){var i=this.layer.getLayerConfig(),o=i.fontWeight,a=o===void 0?"400":o,u=i.fontFamily,c=u===void 0?"sans-serif":u,h=i.textAllowOverlap,y=h===void 0?!1:h,x=i.padding,E=x===void 0?[0,0]:x,T=i.textAnchor,I=T===void 0?"center":T,k=i.textOffset,D=k===void 0?[0,0]:k,V=i.opacity,O=V===void 0?1:V,F=i.strokeOpacity,N=F===void 0?1:F,H=i.strokeWidth,q=H===void 0?0:H,Y=i.stroke,ee=Y===void 0?"#000":Y;return{fontWeight:a,fontFamily:c,textAllowOverlap:y,padding:E,textAnchor:I,textOffset:D,opacity:O,strokeOpacity:N,strokeWidth:q,stroke:ee}}},{key:"generateGlyphLayout",value:function(i){var o=this,a=this.getFontServiceMapping(),u=this.layer.getLayerConfig(),c=u.spacing,h=c===void 0?2:c,y=u.textAnchor,x=y===void 0?"center":y,E=u.textOffset,T=this.rawEncodeData;this.glyphInfo=T.map(function(I){var k=I.shape,D=k===void 0?"":k,V=I.id,O=I.size,F=O===void 0?1:O,N=OW(D.toString(),a,F,x,"left",h,E,i),H=DW(N,E,!1);return I.shaping=N,I.glyphQuads=H,I.centroid=Id(I.coordinates),I.originCentroid=I.version==="GAODE2.x"?Id(I.originCoordinates):I.originCentroid=I.centroid,o.glyphInfoMap[V]={shaping:N,glyphQuads:H,centroid:Id(I.coordinates)},I})}},{key:"getFontServiceMapping",value:function(){var i=this.layer.getLayerConfig(),o=i.fontWeight,a=o===void 0?"400":o,u=i.fontFamily,c=u===void 0?"sans-serif":u;return this.fontService.getMappingByKey("".concat(c,"_").concat(a))}},{key:"getFontServiceCanvas",value:function(){var i=this.layer.getLayerConfig(),o=i.fontWeight,a=o===void 0?"400":o,u=i.fontFamily,c=u===void 0?"sans-serif":u;return this.fontService.getCanvasByKey("".concat(c,"_").concat(a))}},{key:"filterGlyphs",value:function(){var i=this,o=this.layer.getLayerConfig(),a=o.padding,u=a===void 0?[0,0]:a,c=o.textAllowOverlap,h=c===void 0?!1:c;if(!h){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var y=this.rendererService.getViewportSize(),x=y.width,E=y.height,T=new IW(x,E),I=this.glyphInfo.filter(function(k){var D=k.shaping,V=k.id,O=V===void 0?0:V,F=k.version==="GAODE2.x"?k.originCentroid:k.centroid,N=k.size,H=N/16,q=i.mapService.lngLatToContainer(F),Y=T.placeCollisionBox({x1:D.left*H-u[0],x2:D.right*H+u[0],y1:D.top*H-u[1],y2:D.bottom*H+u[1],anchorPointX:q.x,anchorPointY:q.y}),ee=Y.box;return ee&&ee.length?(T.insertCollisionBox(ee,O),!0):!1});I.forEach(function(k){i.glyphInfoMap[k.id]=k})}}},{key:"initGlyph",value:function(){var i=this.layer.getLayerConfig(),o=i.iconfont,a=o===void 0?!1:o;a?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(a)}},{key:"updateTexture",value:function(){var i=this.rendererService.createTexture2D,o=this.getFontServiceCanvas();this.textureHeight=o.height,this.texture&&this.texture.destroy(),this.texture=i({data:o,mag:ae.LINEAR,min:ae.LINEAR,width:o.width,height:o.height})}},{key:"reBuildModel",value:function(){var n=Vt(Ce.mark(function o(){var a;return Ce.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return this.filterGlyphs(),c.next=3,this.layer.buildLayerModel({moduleName:"pointText",vertexShader:UM,fragmentShader:zM,triangulation:VM.bind(this),inject:this.getInject(),depth:{enable:!1}});case 3:a=c.sent,this.layer.models=[a];case 5:case"end":return c.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()}]),r}(Co),UW={fillImage:sW,fill:fL,radar:xW,image:hL,normal:pL,simplePoint:AW,extrude:cL,text:yL,earthFill:qH,earthExtrude:GH};const VW=UW;function jW(e,t){var r=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=$W(e))||t&&e&&typeof e.length=="number"){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(h){throw h},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,a=!1,u;return{s:function(){r=r.call(e)},n:function(){var h=r.next();return o=h.done,h},e:function(h){a=!0,u=h},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(a)throw u}}}}function $W(e,t){if(e){if(typeof e=="string")return jM(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return jM(e,t)}}function jM(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function GW(e){var t=HW();return function(){var n=Ct(e),i;if(t){var o=Ct(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xn(this,i)}}function HW(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Fm=function(e){yn(r,e);var t=GW(r);function r(){var n;$t(this,r);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return n=t.call.apply(t,[this].concat(o)),Q(Ye(n),"type","PointLayer"),Q(Ye(n),"enableEncodeStyles",["opacity","offsets","stroke"]),Q(Ye(n),"defaultSourceConfig",{data:[],options:{parser:{type:"json",x:"lng",y:"lat"}}}),n}return Gt(r,[{key:"buildModels",value:function(){var n=Vt(Ce.mark(function o(){var a;return Ce.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return a=this.getModelType(),this.layerModel&&this.layerModel.clearModels(),this.layerModel=new VW[a](this),c.next=5,this.initLayerModels();case 5:case"end":return c.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"rebuildModels",value:function(){var n=Vt(Ce.mark(function o(){return Ce.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,this.buildModels();case 2:case"end":return u.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getModelTypeWillEmptyData",value:function(){if(this.shapeOption){var i=this.shapeOption,o=i.field,a=i.values,u=this.getLayerConfig(),c=u.shape2d,h=this.iconService.getIconMap();if(o&&(c==null?void 0:c.indexOf(o))!==-1)return"fill";if(a==="text")return"text";if(a&&a instanceof Array){var y=jW(a),x;try{for(y.s();!(x=y.n()).done;){var E=x.value;if(typeof E=="string"&&h.hasOwnProperty(E))return"image"}}catch(T){y.e(T)}finally{y.f()}}}return"normal"}},{key:"getDefaultConfig",value:function(){var i=this.getModelType(),o={fillImage:{},normal:{blend:"additive"},radar:{},simplePoint:{},fill:{blend:"normal"},extrude:{},image:{},text:{blend:"normal"},tile:{},tileText:{},earthFill:{},earthExtrude:{}};return o[i]}},{key:"getModelType",value:function(){var i=this.getEncodedData(),o=this.getLayerConfig(),a=o.shape2d,u=o.shape3d,c=this.iconService.getIconMap(),h=i.find(function(x){return x.hasOwnProperty("shape")});if(h){var y=h.shape;return y==="dot"?"normal":y==="simple"?"simplePoint":y==="radar"?"radar":this.layerType==="fillImage"?"fillImage":(a==null?void 0:a.indexOf(y))!==-1?this.mapService.version==="GLOBEL"?"earthFill":"fill":(u==null?void 0:u.indexOf(y))!==-1?this.mapService.version==="GLOBEL"?"earthExtrude":"extrude":c.hasOwnProperty(y)?"image":"text"}else return this.getModelTypeWillEmptyData()}}]),r}(Mg);function WW(e){var t=XW();return function(){var n=Ct(e),i;if(t){var o=Ct(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xn(this,i)}}function XW(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var YW=`uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;

#pragma include "picking"

void main() {


     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    gl_FragColor = v_Color;
  

  gl_FragColor = filterColor(gl_FragColor);
}
`,qW=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // 默认不固定
uniform float u_raisingHeight: 0.0;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
 
  float isSide = a_Position.z;
 float topU = a_uvs[0];
 float topV = 1.0 - a_uvs[1];
 float sidey = a_uvs[2];

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  float lightWeight = calc_lighting(pos);

  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // 判断几何体是否固定高度
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }



  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  // Tip: 部分机型 GPU 计算精度兼容
  if(isSide < 0.999) {
    // side face
    // if(u_sidesurface < 1.0) {
    //   discard;
    // }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      v_Color = linearColor;
    } else {
      v_Color = a_Color;
    }

  } else {
    v_Color = a_Color;
  }

  v_Color = vec4(v_Color.rgb * lightWeight, v_Color.w * opacity);


  setPickingColor(a_PickingColor);
}
`,ZW=`uniform sampler2D u_texture;
uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying vec3 v_uvs;
varying vec2 v_texture_data;


#pragma include "picking"

void main() {
  float opacity = u_opacity;
  float isSide = v_texture_data.x;
  float lightWeight = v_texture_data.y;
  float topU = v_uvs[0];
  float topV = 1.0 - v_uvs[1];
  float sidey = v_uvs[2];
  // Tip: 部分机型 GPU 计算精度兼容
  if(isSide < 0.999) {// 是否是边缘
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      gl_FragColor = v_Color;
    }
  } else {

     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    gl_FragColor = texture2D(u_texture, vec2(topU, topV));
    // gl_FragColor = vec4(1.0, 0., 0., 1.0);
  }
  

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,KW=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform sampler2D u_texture;


uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;
varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // 默认不固定
uniform float u_raisingHeight: 0.0;
uniform float u_linearColor: 0.0;

varying vec2 v_texture_data;
varying vec3 v_uvs;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
 
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  float lightWeight = calc_lighting(pos);
  vec4 project_pos = project_position(pos);
  v_uvs = a_uvs;

  v_texture_data = vec2(a_Position.z, lightWeight);

  if(u_heightfixed > 0.0) { // 判断几何体是否固定高度
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }


  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }




  setPickingColor(a_PickingColor);
}
`,QW=`uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying vec3 v_uvs;
varying vec2 v_texture_data;

#pragma include "picking"

void main() {
  float opacity = u_opacity;
  float isSide =  v_texture_data.x;
  float sidey = v_uvs[2];
  float lightWeight = v_texture_data.y;

  // Tip: 部分机型 GPU 计算精度兼容
  if(isSide < 0.999) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }
    
    if( u_linearColor == 1.0) {
      // side use linear
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      // side notuse linear
       gl_FragColor = v_Color;
    }
  } else {
    // top face
    if(u_topsurface < 1.0) {
      discard;
    }
    gl_FragColor = v_Color;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);
}
`,JW=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_heightfixed: 0.0; // 默认不固定
uniform float u_raisingHeight: 0.0;

varying vec2 v_texture_data;
varying vec3 v_uvs;
varying vec4 v_Color;


#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {


  v_uvs = a_uvs;
  // cal style mapping - 数据纹理映射部分的计算
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // 判断几何体是否固定高度
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  v_texture_data = vec2(a_Position.z,lightWeight);

  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,eX=function(e){yn(r,e);var t=WW(r);function r(){return $t(this,r),t.apply(this,arguments)}return Gt(r,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),o=i.heightfixed,a=o===void 0?!1:o,u=i.raisingHeight,c=u===void 0?0:u,h=i.topsurface,y=h===void 0?!0:h,x=i.sidesurface,E=x===void 0?!0:x,T=i.sourceColor,I=i.targetColor,k=0,D=[1,1,1,1],V=[1,1,1,1];return T&&I&&(D=Da(T),V=Da(I),k=1),_t({u_topsurface:Number(y),u_sidesurface:Number(E),u_heightfixed:Number(a),u_raisingHeight:Number(c),u_linearColor:k,u_sourceColor:D,u_targetColor:V,u_texture:this.texture},this.getStyleAttribute())}},{key:"initModels",value:function(){var n=Vt(Ce.mark(function o(){return Ce.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,this.loadTexture();case 2:return u.abrupt("return",this.buildModels());case 3:case"end":return u.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=Vt(Ce.mark(function o(){var a,u,c,h,y;return Ce.wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return a=this.getShaders(),u=a.frag,c=a.vert,h=a.type,E.next=3,this.layer.buildLayerModel({moduleName:h,vertexShader:c,fragmentShader:u,inject:this.getInject(),triangulation:xG});case 3:return y=E.sent,E.abrupt("return",[y]);case 5:case"end":return E.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getShaders",value:function(){var i=this.layer.getLayerConfig(),o=i.pickLight,a=i.mapTexture;return a?{frag:ZW,vert:KW,type:"polygonExtrudeTexture"}:o?{frag:QW,vert:JW,type:"polygonExtrudePickLight"}:{frag:YW,vert:qW,type:"polygonExtrude"}}},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy()}},{key:"registerBuiltinAttributes",value:function(){var i=this.layer.getSource().extent,o=i,a=this.layer.coordCenter||this.layer.getSource().center,u=o[2]-o[0],c=o[3]-o[1];if(this.mapService.version==="GAODE2.x"){var h=this.mapService.coordToAMap2RelativeCoordinates([i[0],i[1]],a),y=ei(h,2),x=y[0],E=y[1],T=this.mapService.coordToAMap2RelativeCoordinates([i[2],i[3]],a),I=ei(T,2),k=I[0],D=I[1];u=k-x,c=D-E,o=[x,E,k,D]}this.styleAttributeService.registerStyleAttribute({name:"uvs",type:gn.Attribute,descriptor:{name:"a_uvs",buffer:{usage:ae.STATIC_DRAW,data:[],type:ae.FLOAT},size:3,update:function(O,F,N){var H=N[0],q=N[1];return[(H-o[0])/u,(q-o[1])/c,N[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:gn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:ae.STATIC_DRAW,data:[],type:ae.FLOAT},size:3,update:function(O,F,N,H,q){return q}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:1,update:function(O){var F=O.size,N=F===void 0?10:F;return Array.isArray(N)?[N[0]]:[N]}}})}},{key:"loadTexture",value:function(){var n=Vt(Ce.mark(function o(){var a=this,u,c,h;return Ce.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(u=this.layer.getLayerConfig(),c=u.mapTexture,h=this.rendererService.createTexture2D,this.texture=h({height:0,width:0}),!c){x.next=5;break}return x.abrupt("return",new Promise(function(E,T){var I=new Image;I.crossOrigin="anonymous",I.src=c,I.onload=function(){return a.texture=h({data:I,width:I.width,height:I.height,wrapS:ae.CLAMP_TO_EDGE,wrapT:ae.CLAMP_TO_EDGE,min:ae.LINEAR,mag:ae.LINEAR}),E(null)},I.onerror=function(){T(new Error("image load error"))}}));case 5:case"end":return x.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()}]),r}(Co);function tX(e){var t=rX();return function(){var n=Ct(e),i;if(t){var o=Ct(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xn(this,i)}}function rX(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var nX=`varying vec4 v_color;
#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor = filterColor(gl_FragColor);
}
`,iX=`#pragma include "picking"
uniform float u_opacitylinear: 0.0;
uniform float u_dir: 1.0;
varying vec3 v_linear;
varying vec2 v_pos;
varying vec4 v_Color;


void main() {
   gl_FragColor = v_Color;
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_dir == 1.0 ? 1.0 - length(v_pos - v_linear.xy)/v_linear.z : length(v_pos - v_linear.xy)/v_linear.z;
  }
  gl_FragColor = filterColor(gl_FragColor);
}
`,aX=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_raisingHeight: 0.0;

varying vec4 v_Color;


#pragma include "projection"
#pragma include "picking"

uniform float u_opacitylinear: 0.0;

attribute vec3 a_linear;
varying vec3 v_linear;
varying vec2 v_pos;

void main() {
  if(u_opacitylinear > 0.0) {
    v_linear = a_linear;
    v_pos = a_Position.xy;
  }
  v_Color = vec4(a_Color.xyz, a_Color.w * opacity);
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}`,oX=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_raisingHeight: 0.0;

varying vec4 v_color;


#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - 数据纹理映射部分的计算

  // cal style mapping - 数据纹理映射部分的计算

  v_color = vec4(a_Color.xyz, a_Color.w * opacity);
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,sX=function(e){yn(r,e);var t=tX(r);function r(){return $t(this,r),t.apply(this,arguments)}return Gt(r,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),o=i.raisingHeight,a=o===void 0?0:o,u=i.opacityLinear,c=u===void 0?{enable:!1,dir:"in"}:u;return _t({u_raisingHeight:Number(a),u_opacitylinear:Number(c.enable),u_dir:c.dir==="in"?1:0},this.getStyleAttribute())}},{key:"initModels",value:function(){var n=Vt(Ce.mark(function o(){return Ce.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",this.buildModels());case 1:case"end":return u.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=Vt(Ce.mark(function o(){var a,u,c,h,y,x,E,T,I,k;return Ce.wrap(function(V){for(;;)switch(V.prev=V.next){case 0:return a=this.getModelParams(),u=a.frag,c=a.vert,h=a.triangulation,y=a.type,x=this.layer.getLayerConfig(),E=x.workerEnabled,T=E===void 0?!1:E,I=x.enablePicking,this.layer.triangulation=h,V.next=5,this.layer.buildLayerModel({moduleName:y,vertexShader:c,fragmentShader:u,inject:this.getInject(),triangulation:h,primitive:ae.TRIANGLES,depth:{enable:!1},workerEnabled:T,workerOptions:{modelType:y,enablePicking:I}});case 5:return k=V.sent,V.abrupt("return",[k]);case 7:case"end":return V.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){var i=this.layer.getLayerConfig(),o=i.opacityLinear,a=o===void 0?{enable:!1,dir:"in"}:o;a.enable&&this.styleAttributeService.registerStyleAttribute({name:"linear",type:gn.Attribute,descriptor:{name:"a_linear",buffer:{usage:ae.STATIC_DRAW,data:[],type:ae.FLOAT},size:3,update:function(c,h,y){return[y[3],y[4],y[5]]}}})}},{key:"getModelParams",value:function(){var i=this.layer.getLayerConfig(),o=i.opacityLinear,a=o===void 0?{enable:!1}:o;return a.enable?{frag:iX,vert:aX,type:"polygonLinear",triangulation:yG}:{frag:nX,vert:oX,type:"polygonFill",triangulation:yR}}}]),r}(Co);function uX(e){var t=lX();return function(){var n=Ct(e),i;if(t){var o=Ct(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xn(this,i)}}function lX(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var cX=`
uniform float u_time: 0.0;
uniform float u_opacity: 1.0;

varying vec2 v_uv;

float coast2water_fadedepth = 0.10;
float large_waveheight      = .750; // change to adjust the "heavy" waves
float large_wavesize        = 3.4;  // factor to adjust the large wave size
float small_waveheight      = 0.6;  // change to adjust the small random waves
float small_wavesize        = 0.5;   // factor to ajust the small wave size
float water_softlight_fact  = 15.;  // range [1..200] (should be << smaller than glossy-fact)
float water_glossylight_fact= 120.; // range [1..200]
float particle_amount       = 70.;
// vec3 watercolor             = vec3(0.43, 0.60, 0.66); // 'transparent' low-water color (RGB)
// vec3 watercolor2            = vec3(0.06, 0.07, 0.11); // deep-water color (RGB, should be darker than the low-water color)
uniform vec4 u_watercolor;
uniform vec4 u_watercolor2;
vec3 water_specularcolor    = vec3(1.3, 1.3, 0.9);    // specular Color (RGB) of the water-highlights
#define light                 vec3(-0., sin(u_time*0.5)*.5 + .35, 2.8) // position of the sun

uniform sampler2D u_texture1;
uniform sampler2D u_texture2;
uniform sampler2D u_texture3;

  

float hash( float n ) {
    return fract(sin(n)*43758.5453123);
}

// 2d noise function
float noise1( in vec2 x ) {
  vec2 p  = floor(x);
  vec2 f  = smoothstep(0.0, 1.0, fract(x));
  float n = p.x + p.y*57.0;
  return mix(mix( hash(n+  0.0), hash(n+  1.0),f.x),
    mix( hash(n+ 57.0), hash(n+ 58.0),f.x),f.y);
}

float noise(vec2 p) {
    return texture2D(u_texture2,p*vec2(1./256.)).x;
}

vec4 highness(vec2 p) {
    vec4 t = texture2D(u_texture1,fract(p));
    float clipped = -2.0-smoothstep(3.,10.,t.a)*6.9-smoothstep(10.,100.,t.a)*89.9-smoothstep(0.,10000.,t.a)*10000.0;
    return clamp(t, 0.0,3.0)+clamp(t/3.0-1.0, 0.0,1.0)+clamp(t/16.0-1.0, 0.0,1.0);
}

float height_map( vec2 p ) {
    vec4 height=highness(p);
    /*
    height = -0.5+
        0.5*smoothstep(-100.,0.,-height)+
        2.75*smoothstep(0.,2.,height)+
        1.75*smoothstep(2.,4.,height)+
        2.75*smoothstep(4.,16.,height)+
        1.5*smoothstep(16.,1000.,height);
    */

    mat2 m = mat2( 0.9563*1.4,  -0.2924*1.4,  0.2924*1.4,  0.9563*1.4 );
    //p = p*6.;
    float f = 0.6000*noise1( p ); p = m*p*1.1*6.;
    f += 0.2500*noise( p ); p = m*p*1.32;
    f += 0.1666*noise( p ); p = m*p*1.11;
    f += 0.0834*noise( p ); p = m*p*1.12;
    f += 0.0634*noise( p ); p = m*p*1.13;
    f += 0.0444*noise( p ); p = m*p*1.14;
    f += 0.0274*noise( p ); p = m*p*1.15;
    f += 0.0134*noise( p ); p = m*p*1.16;
    f += 0.0104*noise( p ); p = m*p*1.17;
    f += 0.0084*noise( p );
    f = .25*f+dot(height,vec4(-.03125,-.125,.25,.25))*.5;
        const float FLAT_LEVEL = 0.92525;
        //f = f*0.25+height*0.75;
    if (f<FLAT_LEVEL)
        f = f;
    else
        f = pow((f-FLAT_LEVEL)/(1.-FLAT_LEVEL), 2.)*(1.-FLAT_LEVEL)*2.0+FLAT_LEVEL; // makes a smooth coast-increase
    return clamp(f, 0., 10.);
}

vec3 plasma_quintic( float x ) {
    x = clamp( x, 0.0, 1.0);
    vec4 x1 = vec4( 1.0, x, x * x, x * x * x ); // 1 x x2 x3
    vec4 x2 = x1 * x1.w * x; // x4 x5 x6 x7
    return vec3(
        dot( x1.xyzw, vec4( +0.063861086, +1.992659096, -1.023901152, -0.490832805 ) ) + dot( x2.xy, vec2( +1.308442123, -0.914547012 ) ),
        dot( x1.xyzw, vec4( +0.049718590, -0.791144343, +2.892305078, +0.811726816 ) ) + dot( x2.xy, vec2( -4.686502417, +2.717794514 ) ),
        dot( x1.xyzw, vec4( +0.513275779, +1.580255060, -5.164414457, +4.559573646 ) ) + dot( x2.xy, vec2( -1.916810682, +0.570638854 ) ) );
}

vec4 color(vec2 p){
    vec4 c1 = vec4(1.7,1.6,.9,1);
    vec4 c2 = vec4(.2,.94,.1,1);
    vec4 c3 = vec4(.3,.2,.0,1);
    vec4 c4 = vec4(.99,.99,1.6,1);
    vec4 v = highness(p);
    float los = smoothstep(0.1,1.1,v.b);
    float his = smoothstep(3.5,6.5,v.b);
    float ces = smoothstep(1.,5.,v.a);
    vec4 lo = mix(c1,c2,los);
    vec4 hi = mix(c3,c4,his);
    vec4 ce = mix(lo,hi,ces);

    return vec4(plasma_quintic(ces),1).ragb;
}

vec3 terrain_map( vec2 p )
{
  return color(p).rgb*0.75+0.25*vec3(0.7, .55, .4)+texture2D(u_texture3, fract(p*5.)).rgb*.5; // test-terrain is simply 'sandstone'
}

const mat2 m = mat2( 0.72, -1.60,  1.60,  0.72 );

float water_map( vec2 p, float height ) {
    vec2 p2 = p*large_wavesize;
    vec2 shift1 = 0.001*vec2( u_time*160.0*2.0, u_time*120.0*2.0 );
    vec2 shift2 = 0.001*vec2( u_time*190.0*2.0, -u_time*130.0*2.0 );

    // coarse crossing 'ocean' waves...
    float f = 0.6000*noise( p );
    f += 0.2500*noise( p*m );
    f += 0.1666*noise( p*m*m );
    float wave = sin(p2.x*0.622+p2.y*0.622+shift2.x*4.269)*large_waveheight*f*height*height ;

    p *= small_wavesize;
    f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<9; i++)
    { p = m*p*.947; f -= amp*abs(sin((noise( p+shift1*s )-.5)*2.)); amp = amp*.59; s*=-1.329; }
    
    return wave+f*small_waveheight;
}

float nautic(vec2 p) {
    p *= 18.;
    float f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*abs(smoothstep(0., 1., noise( p+u_time*s ))-.5); amp = amp*.5; s*=-1.227; }
    return pow(1.-f, 5.);
}

float particles(vec2 p) {
    p *= 200.;
    float f = 0.;
    float amp = 1.0, s = 1.5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*noise( p+u_time*s ); amp = amp*.5; s*=-1.227; }
    return pow(f*.35, 7.)*particle_amount;
}

float test_shadow( vec2 xy, float height) {
    vec3 r0 = vec3(xy, height);
    vec3 rd = normalize( light - r0 );
    
    float hit = 1.0;
    float t   = 0.001;
    for (int j=1; j<25; j++)
    {
        vec3 p = r0 + t*rd;
        float h = height_map( p.xy );
        float height_diff = p.z - h;
        if (height_diff<0.0)
        {
            return 0.0;
        }
        t += 0.01+height_diff*.02;
        hit = min(hit, 2.*height_diff/t); // soft shaddow   
    }
    return hit;
}

vec3 CalcTerrain(vec2 uv, float height) {
    vec3 col = terrain_map( uv );
    vec2 iResolution = vec2(512.);
    float h1 = height_map(uv-vec2(0., 0.5)/ iResolution.xy);
    float h2 = height_map(uv+vec2(0., 0.5)/ iResolution.xy);
    float h3 = height_map(uv-vec2(0.5, 0.)/ iResolution.xy);
    float h4 = height_map(uv+vec2(0.5, 0.)/ iResolution.xy);
    vec3 norm = normalize(vec3(h3-h4, h1-h2, 1.));
    vec3 r0 = vec3(uv, height);
    vec3 rd = normalize( light - r0 );
    float grad = dot(norm, rd);
    col *= grad+pow(grad, 8.);
    float terrainshade = test_shadow( uv, height );
    col = mix(col*.25, col, terrainshade);
    return col;
}


void main() {
  vec3 watercolor = u_watercolor.rgb;
  vec3 watercolor2 = u_watercolor2.rgb;
  vec2 uv = v_uv;
  float WATER_LEVEL = 0.84; // Water level (range: 0.0 - 2.0)
  float deepwater_fadedepth   = 0.4 + coast2water_fadedepth;
  float height = height_map( uv );
  vec3 col;

    float waveheight = clamp(WATER_LEVEL*3.-1.5, 0., 1.);
    float level = WATER_LEVEL + .2*water_map(uv*15. + vec2(u_time*.1), waveheight);
    if (height > level)
    {
        col = CalcTerrain(uv, height);
    }
    if (height <= level)
    {
        vec2 dif = vec2(.0, .01);
        vec2 pos = uv*15. + vec2(u_time*.01);
        float h1 = water_map(pos-dif,waveheight);
        float h2 = water_map(pos+dif,waveheight);
        float h3 = water_map(pos-dif.yx,waveheight);
        float h4 = water_map(pos+dif.yx,waveheight);
        vec3 normwater = normalize(vec3(h3-h4, h1-h2, .125)); // norm-vector of the 'bumpy' water-plane
        uv += normwater.xy*.002*(level-height);
        
        col = CalcTerrain(uv, height);

        float coastfade = clamp((level-height)/coast2water_fadedepth, 0., 1.);
        float coastfade2= clamp((level-height)/deepwater_fadedepth, 0., 1.);
        float intensity = col.r*.2126+col.g*.7152+col.b*.0722;
        watercolor = mix(watercolor*intensity, watercolor2, smoothstep(0., 1., coastfade2));

        vec3 r0 = vec3(uv, WATER_LEVEL);
        vec3 rd = normalize( light - r0 ); // ray-direction to the light from water-position
        float grad     = dot(normwater, rd); // dot-product of norm-vector and light-direction
        float specular = pow(grad, water_softlight_fact);  // used for soft highlights                          
        float specular2= pow(grad, water_glossylight_fact); // used for glossy highlights
        float gradpos  = dot(vec3(0., 0., 1.), rd);
        float specular1= smoothstep(0., 1., pow(gradpos, 5.));  // used for diffusity (some darker corona around light's specular reflections...)                          
        float watershade  = test_shadow( uv, level );
        watercolor *= 2.2+watershade;
        watercolor += (.2+.8*watershade) * ((grad-1.0)*.5+specular) * .25;
        watercolor /= (1.+specular1*1.25);
        watercolor += watershade*specular2*water_specularcolor;
        watercolor += watershade*coastfade*(1.-coastfade2)*(vec3(.5, .6, .7)*nautic(uv)+vec3(1., 1., 1.)*particles(uv));
        
        col = mix(col, watercolor, coastfade);
    }
    

  float opacity = u_opacity;
  gl_FragColor = vec4(col, opacity);  
}
`,fX=`attribute vec2 a_uv;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec2 v_uv;

#pragma include "projection"

void main() {
  v_uv = a_uv;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,hX=function(e){yn(r,e);var t=uX(r);function r(){return $t(this,r),t.apply(this,arguments)}return Gt(r,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),o=i.opacity,a=o===void 0?1:o,u=i.watercolor,c=u===void 0?"#6D99A8":u,h=i.watercolor2,y=h===void 0?"#0F121C":h;return{u_texture1:this.texture1,u_texture2:this.texture2,u_texture3:this.texture3,u_watercolor:Da(c),u_watercolor2:Da(y),u_opacity:Er.isNumber(a)?a:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=Vt(Ce.mark(function o(){return Ce.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return this.loadTexture(),u.abrupt("return",this.buildModels());case 2:case"end":return u.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=Vt(Ce.mark(function o(){var a;return Ce.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.layer.buildLayerModel({moduleName:"polygonOcean",vertexShader:fX,fragmentShader:cX,triangulation:mS,primitive:ae.TRIANGLES,depth:{enable:!1}});case 2:return a=c.sent,c.abrupt("return",[a]);case 4:case"end":return c.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i,o,a;(i=this.texture1)===null||i===void 0||i.destroy(),(o=this.texture2)===null||o===void 0||o.destroy(),(a=this.texture3)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){var i=this.layer.getSource().extent,o=ei(i,4),a=o[0],u=o[1],c=o[2],h=o[3],y=c-a,x=h-u;this.styleAttributeService.registerStyleAttribute({name:"oceanUv",type:gn.Attribute,descriptor:{name:"a_uv",buffer:{usage:ae.STATIC_DRAW,data:[],type:ae.FLOAT},size:2,update:function(T,I,k,D){var V=T.version===th["GAODE2.x"]?T.originCoordinates[0][D]:k,O=ei(V,2),F=O[0],N=O[1];return[(F-a)/y,(N-u)/x]}}})}},{key:"loadTexture",value:function(){var i=this,o=this.rendererService.createTexture2D,a={height:0,width:0};this.texture1=o(a),this.texture2=o(a),this.texture3=o(a),u(function(h){i.texture1=c(h[0]),i.texture2=c(h[1]),i.texture3=c(h[2]),i.layerService.reRender()});function u(h){var y=0,x=[],E=["https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*MJ22QbpuCzIAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*-z2HSIVDsHIAAAAAAAAAAAAAARQnAQ"];E.map(function(T){var I=new Image;I.crossOrigin="",I.src=T,x.push(I),I.onload=function(){y++,y===3&&h(x)}})}function c(h){return o({data:h,width:h.width,height:h.height,wrapS:ae.MIRRORED_REPEAT,wrapT:ae.MIRRORED_REPEAT,min:ae.LINEAR,mag:ae.LINEAR})}}}]),r}(Co);function pX(e){var t=dX();return function(){var n=Ct(e),i;if(t){var o=Ct(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xn(this,i)}}function dX(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var vX=`uniform sampler2D u_texture;
uniform float u_time: 0.0;
uniform float u_speed: 1.0;
uniform float u_opacity: 1.0;

varying vec4 v_Color;
varying vec2 v_uv;

float rand(vec2 n) { return 0.5 + 0.5 * fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453); }

float water(vec3 p) {
  float t = u_time * u_speed;
  p.z += t * 2.; p.x += t * 2.;
  vec3 c1 = texture2D(u_texture, p.xz / 30.).xyz;
  p.z += t * 3.; p.x += t * 0.52;
  vec3 c2 = texture2D(u_texture, p.xz / 30.).xyz;
  p.z += t * 4.; p.x += t * 0.8;
  vec3 c3 = texture2D(u_texture, p.xz / 30.).xyz;
  c1 += c2 - c3;
  float z = (c1.x + c1.y + c1.z) / 3.;
  return p.y + z / 4.;
}

float map(vec3 p) {
  float d = 100.0;
  d = water(p);
  return d;
}

float intersect(vec3 ro, vec3 rd) {
  float d = 0.0;
  for (int i = 0; i <= 100; i++) {
    float h = map(ro + rd * d);
    if (h < 0.1) return  d;
    d += h;
  }
  return 0.0;
}

vec3 norm(vec3 p) {
  float eps = .1;
  return normalize(vec3(
    map(p + vec3(eps, 0, 0)) - map(p + vec3(-eps, 0, 0)),
    map(p + vec3(0, eps, 0)) - map(p + vec3(0, -eps, 0)),
    map(p + vec3(0, 0, eps)) - map(p + vec3(0, 0, -eps))
  ));
} 

float calSpc() {
  vec3 l1 = normalize(vec3(1, 1, 1));
  vec3 ro = vec3(-3, 20, -8);
  vec3 rc = vec3(0, 0, 0);
  vec3 ww = normalize(rc - ro);
  vec3 uu = normalize(cross(vec3(0,1,0), ww));
  vec3 vv = normalize(cross(rc - ro, uu));
  vec3 rd = normalize(uu * v_uv.x + vv * v_uv.y + ww);
  float d = intersect(ro, rd);
  vec3 p = ro + rd * d;
  vec3 n = norm(p);
  float spc = pow(max(0.0, dot(reflect(l1, n), rd)), 30.0);
  return spc;
}

void main() {
  float opacity = u_opacity;
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;

  float spc = calSpc();
  gl_FragColor += spc * 0.4;
}
`,mX=`attribute vec4 a_Color;
attribute vec2 a_uv;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
varying vec2 v_uv;
uniform float u_opacity: 1.0;


#pragma include "projection"

void main() {
  v_uv = a_uv;

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,gX=function(e){yn(r,e);var t=pX(r);function r(){return $t(this,r),t.apply(this,arguments)}return Gt(r,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),o=i.opacity,a=o===void 0?1:o,u=i.speed,c=u===void 0?.5:u;return{u_texture:this.texture,u_speed:c,u_opacity:Er.isNumber(a)?a:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=Vt(Ce.mark(function o(){return Ce.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return this.loadTexture(),u.abrupt("return",this.buildModels());case 2:case"end":return u.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=Vt(Ce.mark(function o(){var a;return Ce.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.layer.buildLayerModel({moduleName:"polygonWater",vertexShader:mX,fragmentShader:vX,triangulation:mS,primitive:ae.TRIANGLES,depth:{enable:!1}});case 2:return a=c.sent,c.abrupt("return",[a]);case 4:case"end":return c.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy()}},{key:"registerBuiltinAttributes",value:function(){var i=this.layer.getSource().extent,o=ei(i,4),a=o[0],u=o[1],c=o[2],h=o[3],y=c-a,x=h-u;this.styleAttributeService.registerStyleAttribute({name:"waterUv",type:gn.Attribute,descriptor:{name:"a_uv",buffer:{usage:ae.STATIC_DRAW,data:[],type:ae.FLOAT},size:2,update:function(T,I,k,D){var V=T.version===th["GAODE2.x"]?T.originCoordinates[0][D]:k,O=ei(V,2),F=O[0],N=O[1];return[(F-a)/y,(N-u)/x]}}})}},{key:"loadTexture",value:function(){var i=this,o=this.layer.getLayerConfig(),a=o.waterTexture,u=this.rendererService.createTexture2D;this.texture=u({height:0,width:0});var c=new Image;c.crossOrigin="",a?c.src=a:c.src="https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ",c.onload=function(){i.texture=u({data:c,width:c.width,height:c.height,wrapS:ae.MIRRORED_REPEAT,wrapT:ae.MIRRORED_REPEAT,min:ae.LINEAR,mag:ae.LINEAR}),i.layerService.reRender()}}}]),r}(Co),yX={fill:sX,line:lL,extrude:eX,text:yL,point_fill:fL,point_image:hL,point_normal:pL,point_extrude:cL,water:gX,ocean:hX};const _X=yX;function xX(e){var t=bX();return function(){var n=Ct(e),i;if(t){var o=Ct(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xn(this,i)}}function bX(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Xx=function(e){yn(r,e);var t=xX(r);function r(){var n;$t(this,r);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return n=t.call.apply(t,[this].concat(o)),Q(Ye(n),"type","PolygonLayer"),Q(Ye(n),"enableEncodeStyles",["opacity"]),n}return Gt(r,[{key:"buildModels",value:function(){var n=Vt(Ce.mark(function o(){var a;return Ce.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return a=this.getModelType(),this.layerModel=new _X[a](this),c.next=4,this.initLayerModels();case 4:case"end":return c.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getModelType",value:function(){var i,o=this.styleAttributeService.getLayerStyleAttribute("shape"),a=o==null||(i=o.scale)===null||i===void 0?void 0:i.field;return a==="fill"||!a?"fill":a==="extrude"?"extrude":a==="water"?"water":a==="ocean"?"ocean":a==="line"?"line":this.getPointModelType()}},{key:"getPointModelType",value:function(){var i=this.getEncodedData(),o=this.getLayerConfig(),a=o.shape2d,u=o.shape3d,c=this.iconService.getIconMap(),h=i.find(function(x){return x.hasOwnProperty("shape")});if(h){var y=h.shape;return y==="dot"?"point_normal":(a==null?void 0:a.indexOf(y))!==-1?"point_fill":(u==null?void 0:u.indexOf(y))!==-1?"point_extrude":c.hasOwnProperty(y)?"point_image":"text"}else return"fill"}}]),r}(Mg);function wX(e){var t=EX();return function(){var n=Ct(e),i;if(t){var o=Ct(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xn(this,i)}}function EX(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var SX=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_min;
uniform float u_max;
uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
varying vec2 v_texCoord;
bool isnan_emu(float x) { return (x > 0.0 || x < 0.0) ? x != x : x != 0.0; }


void main() {

  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;
  if (value == u_noDataValue || isnan_emu(value))
      discard;
  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))
     discard;
  else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);
    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));
    
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
    if(gl_FragColor.a < 0.01)
      discard;
   
  }
}
`,AX=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,$M=function(e){yn(r,e);var t=wX(r);function r(){return $t(this,r),t.apply(this,arguments)}return Gt(r,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),o=i.opacity,a=o===void 0?1:o,u=i.clampLow,c=u===void 0?!0:u,h=i.clampHigh,y=h===void 0?!0:h,x=i.noDataValue,E=x===void 0?-9999999:x,T=i.domain,I=i.rampColors,k=T||BE(I);return this.colorTexture=this.layer.textureService.getColorTexture(I,k),{u_opacity:a||1,u_texture:this.texture,u_domain:k,u_clampLow:c,u_clampHigh:typeof y<"u"?y:c,u_noDataValue:E,u_colorTexture:this.colorTexture}}},{key:"getRasterData",value:function(){var n=Vt(Ce.mark(function o(a){var u,c,h,y;return Ce.wrap(function(E){for(;;)switch(E.prev=E.next){case 0:if(!Array.isArray(a.data)){E.next=4;break}return E.abrupt("return",{data:a.data,width:a.width,height:a.height});case 4:return E.next=6,a.data;case 6:return u=E.sent,c=u.rasterData,h=u.width,y=u.height,E.abrupt("return",{data:Array.from(c),width:h,height:y});case 11:case"end":return E.stop()}},o)}));function i(o){return n.apply(this,arguments)}return i}()},{key:"initModels",value:function(){var n=Vt(Ce.mark(function o(){var a,u,c,h,y,x,E,T;return Ce.wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return a=this.layer.getSource(),u=this.rendererService.createTexture2D,c=a.data.dataArray[0],k.next=5,this.getRasterData(c);case 5:return h=k.sent,y=h.data,x=h.width,E=h.height,this.texture=u({data:y,width:x,height:E,format:ae.LUMINANCE,type:ae.FLOAT}),k.next=12,this.layer.buildLayerModel({moduleName:"rasterImageData",vertexShader:AX,fragmentShader:SX,triangulation:Hx,primitive:ae.TRIANGLES,depth:{enable:!1}});case 12:return T=k.sent,k.abrupt("return",[T]);case 14:case"end":return k.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=Vt(Ce.mark(function o(){return Ce.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",this.initModels());case 1:case"end":return u.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i,o;(i=this.texture)===null||i===void 0||i.destroy(),(o=this.colorTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:gn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:2,update:function(o,a,u){return[u[3],u[4]]}}})}}]),r}(Co),TX=["data"],CX=["rasterData"];function MX(e){var t=PX();return function(){var n=Ct(e),i;if(t){var o=Ct(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xn(this,i)}}function PX(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var IX=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,RX=`precision mediump float;
uniform vec2 u_rminmax: vec2(0,255); 
uniform vec2 u_gminmax: vec2(0,255);
uniform vec2 u_bminmax: vec2(0,255);
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform float u_noDataValue : 0.0;
varying vec2 v_texCoord;

void main() {
  vec3 rgb = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).rgb;
  if(rgb == vec3(u_noDataValue)) {
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  } else {
    gl_FragColor = vec4(rgb.r / (u_rminmax.y -u_rminmax.x), rgb.g /(u_gminmax.y -u_gminmax.x), rgb.b/ (u_bminmax.y - u_bminmax.x), u_opacity);
  }
  if(gl_FragColor.a < 0.01)
    discard;
 
}`,LX=function(e){yn(r,e);var t=MX(r);function r(){var n;$t(this,r);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return n=t.call.apply(t,[this].concat(o)),Q(Ye(n),"dataOption",{}),n}return Gt(r,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),o=i.opacity,a=o===void 0?1:o,u=i.noDataValue,c=u===void 0?0:u,h=this.dataOption,y=h.rMinMax,x=h.gMinMax,E=h.bMinMax;return{u_opacity:a||1,u_texture:this.texture,u_noDataValue:c,u_rminmax:y,u_gminmax:x,u_bminmax:E}}},{key:"getRasterData",value:function(){var n=Vt(Ce.mark(function o(a){var u,c,h,y,x;return Ce.wrap(function(T){for(;;)switch(T.prev=T.next){case 0:if(!Array.isArray(a.data)){T.next=4;break}return u=a.data,c=Zh(a,TX),this.dataOption=c,T.abrupt("return",_t({data:u},c));case 4:return T.next=6,a.data;case 6:if(h=T.sent,y=h.rasterData,x=Zh(h,CX),this.dataOption=x,!Array.isArray(y)){T.next=14;break}return T.abrupt("return",_t({data:y},x));case 14:return T.abrupt("return",_t({data:Array.from(y)},x));case 15:case"end":return T.stop()}},o,this)}));function i(o){return n.apply(this,arguments)}return i}()},{key:"initModels",value:function(){var n=Vt(Ce.mark(function o(){var a,u,c,h,y,x,E,T;return Ce.wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return a=this.layer.getSource(),u=this.rendererService.createTexture2D,c=a.data.dataArray[0],k.next=5,this.getRasterData(c);case 5:return h=k.sent,y=h.data,x=h.width,E=h.height,this.texture=u({data:y,width:x,height:E,format:ae.RGB,type:ae.FLOAT}),k.next=12,this.layer.buildLayerModel({moduleName:"rasterImageDataRGBA",vertexShader:IX,fragmentShader:RX,triangulation:Hx,primitive:ae.TRIANGLES,depth:{enable:!1}});case 12:return T=k.sent,k.abrupt("return",[T]);case 14:case"end":return k.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=Vt(Ce.mark(function o(){return Ce.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",this.initModels());case 1:case"end":return u.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:gn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:2,update:function(o,a,u){return[u[3],u[4]]}}})}}]),r}(Co);function kX(e){var t=OX();return function(){var n=Ct(e),i;if(t){var o=Ct(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xn(this,i)}}function OX(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var DX=`precision mediump float;
uniform float u_opacity: 1.0;

uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;

varying vec2 v_texCoord;

uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
uniform vec4 u_unpack;

float getElevation(vec2 coord, float bias) {
    // Convert encoded elevation value to meters
    vec4 data = texture2D(u_texture, coord,bias) * 255.0;
    data.a = -1.0;
    return dot(data, u_unpack);
}

vec4 getColor(float value) {
   float normalisedValue =(value- u_domain[0]) / (u_domain[1] - u_domain[0]);
    vec2 coord = vec2(normalisedValue, 0);
    return texture2D(u_colorTexture, coord);
}

void main() {
  float value = getElevation(v_texCoord,0.0);
  if (value == u_noDataValue) {
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  } else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1])) {
     gl_FragColor = vec4(0.0, 0, 0, 0.0);
  } else {
   
    gl_FragColor = getColor(value);
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
      if(gl_FragColor.a < 0.01)
      discard;
  }
}
`,FX=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,NX=function(e){yn(r,e);var t=kX(r);function r(){return $t(this,r),t.apply(this,arguments)}return Gt(r,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),o=i.opacity,a=i.clampLow,u=a===void 0?!0:a,c=i.clampHigh,h=c===void 0?!0:c,y=i.noDataValue,x=y===void 0?-9999999:y,E=i.domain,T=i.rampColors,I=i.colorTexture,k=i.rScaler,D=k===void 0?6553.6:k,V=i.gScaler,O=V===void 0?25.6:V,F=i.bScaler,N=F===void 0?.1:F,H=i.offset,q=H===void 0?1e4:H,Y=E||BE(T),ee=I;return I?this.layer.textureService.setColorTexture(I,T,Y):ee=this.layer.textureService.getColorTexture(T,Y),{u_opacity:o||1,u_texture:this.texture,u_domain:Y,u_clampLow:u,u_clampHigh:typeof h<"u"?h:u,u_noDataValue:x,u_unpack:[D,O,N,q],u_colorTexture:ee}}},{key:"initModels",value:function(){var n=Vt(Ce.mark(function o(){var a,u,c,h;return Ce.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return a=this.layer.getSource(),u=this.rendererService.createTexture2D,x.next=4,a.data.images;case 4:return c=x.sent,this.texture=u({data:c[0],width:c[0].width,height:c[0].height,min:ae.LINEAR,mag:ae.LINEAR}),x.next=8,this.layer.buildLayerModel({moduleName:"RasterTileDataImage",vertexShader:FX,fragmentShader:DX,triangulation:Hx,primitive:ae.TRIANGLES,depth:{enable:!1}});case 8:return h=x.sent,x.abrupt("return",[h]);case 10:case"end":return x.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy()}},{key:"buildModels",value:function(){var n=Vt(Ce.mark(function o(){return Ce.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",this.initModels());case 1:case"end":return u.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:gn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:2,update:function(o,a,u){return[u[3],u[4]]}}})}}]),r}(Co),BX={raster:$M,rasterRgb:LX,raster3d:$M,rasterTerrainRgb:NX};const zX=BX;function UX(e){var t=VX();return function(){var n=Ct(e),i;if(t){var o=Ct(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xn(this,i)}}function VX(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var gS=function(e){yn(r,e);var t=UX(r);function r(){var n;$t(this,r);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return n=t.call.apply(t,[this].concat(o)),Q(Ye(n),"type","RasterLayer"),n}return Gt(r,[{key:"buildModels",value:function(){var n=Vt(Ce.mark(function o(){var a;return Ce.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return a=this.getModelType(),this.layerModel=new zX[a](this),c.next=4,this.initLayerModels();case 4:case"end":return c.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getDefaultConfig",value:function(){var i=this.getModelType(),o={raster:{},rasterRgb:{},raster3d:{},rasterTerrainRgb:{}};return o[i]}},{key:"getModelType",value:function(){var i=this.layerSource.getParserType();switch(i){case"raster":return"raster";case"rasterRgb":return"rasterRgb";case"image":return"rasterTerrainRgb";default:return"raster"}}}]),r}(Mg);function jX(e){var t=$X();return function(){var n=Ct(e),i;if(t){var o=Ct(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xn(this,i)}}function $X(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var GX=`uniform float u_opacity : 1.0;
uniform vec4 u_color;

void main() {
  gl_FragColor = u_color;
  gl_FragColor.a *= u_opacity;
}
`,HX=`attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#pragma include "projection"

void main() {
  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,WX=function(e){yn(r,e);var t=jX(r);function r(){return $t(this,r),t.apply(this,arguments)}return Gt(r,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),o=i.opacity,a=o===void 0?1:o,u=i.color,c=u===void 0?"#000":u;return{u_opacity:Er.isNumber(a)?a:0,u_color:Da(c)}}},{key:"initModels",value:function(){var n=Vt(Ce.mark(function o(){return Ce.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",this.buildModels());case 1:case"end":return u.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=Vt(Ce.mark(function o(){var a;return Ce.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.layer.buildLayerModel({moduleName:"mask",vertexShader:HX,fragmentShader:GX,triangulation:mS,depth:{enable:!1},pick:!1});case 2:return a=c.sent,c.abrupt("return",[a]);case 4:case"end":return c.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;i&&this.layerService.clear()}},{key:"registerBuiltinAttributes",value:function(){return""}}]),r}(Co),XX={fill:WX};const YX=XX;function qX(e){var t=ZX();return function(){var n=Ct(e),i;if(t){var o=Ct(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xn(this,i)}}function ZX(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var _L=function(e){yn(r,e);var t=qX(r);function r(){var n;$t(this,r);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return n=t.call.apply(t,[this].concat(o)),Q(Ye(n),"type","MaskLayer"),n}return Gt(r,[{key:"buildModels",value:function(){var n=Vt(Ce.mark(function o(){var a;return Ce.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return a=this.getModelType(),this.layerModel=new YX[a](this),c.next=4,this.initLayerModels();case 4:case"end":return c.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getModelType",value:function(){return"fill"}}]),r}(Mg),GM,HM,WM,XM,u1,YM,qM,KX=(GM=Ei(),HM=na(Mt.IMapService),WM=na(Mt.IFontService),GM(XM=(u1=function(){function e(){$t(this,e),Gi(this,"mapService",YM,this),Gi(this,"fontService",qM,this)}return Gt(e,[{key:"apply",value:function(r,n){var i=this,o=n.styleAttributeService;r.hooks.init.tapPromise("DataMappingPlugin",Vt(Ce.mark(function a(){return Ce.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:r.log($s.MappingStart,Hs.INIT),i.generateMaping(r,{styleAttributeService:o}),r.log($s.MappingEnd,Hs.INIT);case 3:case"end":return c.stop()}},a)}))),r.hooks.beforeRenderData.tapPromise("DataMappingPlugin",function(){var a=Vt(Ce.mark(function u(c){var h;return Ce.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(c){x.next=2;break}return x.abrupt("return",c);case 2:return r.dataState.dataMappingNeedUpdate=!1,r.log($s.MappingStart,Hs.UPDATE),h=i.generateMaping(r,{styleAttributeService:o}),r.log($s.MappingEnd,Hs.UPDATE),x.abrupt("return",h);case 7:case"end":return x.stop()}},u)}));return function(u){return a.apply(this,arguments)}}()),r.hooks.beforeRender.tap("DataMappingPlugin",function(){var a=r.getSource();if(!(r.layerModelNeedUpdate||!a||!a.inited)){var u=o.getLayerStyleAttributes()||[],c=o.getLayerStyleAttribute("filter"),h=a.data.dataArray;if(!(Array.isArray(h)&&h.length===0)){var y=u.filter(function(T){return T.needRemapping}),x=h;if(c!=null&&c.needRemapping&&c!==null&&c!==void 0&&c.scale&&(x=h.filter(function(T){return i.applyAttributeMapping(c,T)[0]})),y.length){var E=i.mapping(r,y,x,r.getEncodedData());r.setEncodedData(E)}}}})}},{key:"generateMaping",value:function(r,n){var i=this,o=n.styleAttributeService,a=o.getLayerStyleAttributes()||[],u=o.getLayerStyleAttribute("filter"),c=r.getSource().data.dataArray,h=c;u!=null&&u.scale&&(h=c.filter(function(x){return i.applyAttributeMapping(u,x)[0]})),h=r.processData(h);var y=this.mapping(r,a,h,void 0);return r.setEncodedData(y),c.length===0&&r.encodeDataLength===0?!1:(r.emit("dataUpdate",null),!0)}},{key:"mapping",value:function(r,n,i,o){var a=this,u=r.getLayerConfig(),c=u.arrow,h=c===void 0?{enable:!1}:c,y=n.filter(function(E){return E.scale!==void 0}).filter(function(E){return E.name!=="filter"}),x=i.map(function(E,T){var I=o?o[T]:{},k=_t({id:E._id,coordinates:E.coordinates},I);if(y.forEach(function(O){var F=a.applyAttributeMapping(O,E);(O.name==="color"||O.name==="stroke")&&(F=F.map(function(N){return Da(N)})),k[O.name]=Array.isArray(F)&&F.length===1?F[0]:F,O.name==="shape"&&(k.shape=a.fontService.getIconFontKey(k[O.name]))}),h.enable&&k.shape==="line"){var D=k.coordinates;if(r.arrowInsertCount<r.encodeDataLength){var V=a.getArrowPoints(D[0],D[1]);k.coordinates.splice(1,0,V,V),r.arrowInsertCount++}}return k});return n.forEach(function(E){E.needRemapping=!1}),this.adjustData2Amap2Coordinates(x,r),this.adjustData2SimpleCoordinates(x),x}},{key:"adjustData2Amap2Coordinates",value:function(r,n){var i=this;if(r.length>0&&this.mapService.version===th["GAODE2.x"]){var o=n.coordCenter||n.getSource().center;r.filter(function(a){return!a.originCoordinates}).map(function(a){a.version=th["GAODE2.x"],a.originCoordinates=Er.cloneDeep(a.coordinates),a.coordinates=i.mapService.coordToAMap2RelativeCoordinates(a.coordinates,o)})}}},{key:"adjustData2SimpleCoordinates",value:function(r){var n=this;r.length>0&&this.mapService.version===th.SIMPLE&&r.map(function(i){i.simpleCoordinate||(i.coordinates=n.unProjectCoordinates(i.coordinates),i.simpleCoordinate=!0)})}},{key:"unProjectCoordinates",value:function(r){var n=this;if(typeof r[0]=="number")return this.mapService.simpleMapCoord.unproject(r);if(r[0]&&r[0][0]instanceof Array){var i=[];return r.map(function(a){var u=[];a.map(function(c){u.push(n.mapService.simpleMapCoord.unproject(c))}),i.push(u)}),i}else{var o=[];return r.map(function(a){o.push(n.mapService.simpleMapCoord.unproject(a))}),o}}},{key:"applyAttributeMapping",value:function(r,n){var i;if(!r.scale)return[];var o=(r==null||(i=r.scale)===null||i===void 0?void 0:i.scalers)||[],a=[];o.forEach(function(c){var h,y=c.field;(n.hasOwnProperty(y)||((h=r.scale)===null||h===void 0?void 0:h.type)==="variable")&&a.push(n[y])});var u=r.mapping?r.mapping(a):[];return u}},{key:"getArrowPoints",value:function(r,n){var i=[n[0]-r[0],n[1]-r[1]],o=BI(i),a=[r[0]+o[0]*1e-4,r[1]+o[1]*1e-4];return a}}]),e}(),YM=Ui(u1.prototype,"mapService",[HM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qM=Ui(u1.prototype,"fontService",[WM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),u1))||XM),ZM,KM,QX=(ZM=Ei(),ZM(KM=function(){function e(){$t(this,e)}return Gt(e,[{key:"apply",value:function(r){var n=this;this.mapService=r.getContainer().get(Mt.IMapService),r.hooks.init.tapPromise("DataSourcePlugin",Vt(Ce.mark(function i(){var o,a,u,c;return Ce.wrap(function(y){for(;;)switch(y.prev=y.next){case 0:if(r.log($s.SourceInitStart,Hs.INIT),o=r.getSource(),o||(a=r.sourceOption||r.defaultSourceConfig,u=a.data,c=a.options,o=new fS(u,c),r.setSource(o)),!o.inited){y.next=8;break}n.updateClusterData(r),r.log($s.SourceInitEnd,Hs.INIT),y.next=10;break;case 8:return y.next=10,new Promise(function(x){o.on("update",function(E){E.type==="inited"&&(n.updateClusterData(r),r.log($s.SourceInitEnd,Hs.INIT)),x(null)})});case 10:case"end":return y.stop()}},i)}))),r.hooks.beforeRenderData.tapPromise("DataSourcePlugin",Vt(Ce.mark(function i(){var o,a,u;return Ce.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return o=n.updateClusterData(r),a=r.dataState.dataSourceNeedUpdate,r.dataState.dataSourceNeedUpdate=!1,u=o||a,h.abrupt("return",u);case 5:case"end":return h.stop()}},i)})))}},{key:"updateClusterData",value:function(r){if(r.isTileLayer||r.tileLayer||!r.getSource())return!1;var n=r.getSource(),i=n.cluster,o=n.clusterOptions.zoom,a=o===void 0?0:o,u=this.mapService.getZoom()-1,c=r.dataState.dataSourceNeedUpdate;return i&&c&&n.updateClusterData(Math.floor(u)),i&&Math.abs(r.clusterZoom-u)>=1?(a!==Math.floor(u)&&n.updateClusterData(Math.floor(u)),r.clusterZoom=u,!0):!1}}]),e}())||KM);function yS(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function xL(e){return e.length===1&&(e=JX(e)),{left:function(t,r,n,i){for(n==null&&(n=0),i==null&&(i=t.length);n<i;){var o=n+i>>>1;e(t[o],r)<0?n=o+1:i=o}return n},right:function(t,r,n,i){for(n==null&&(n=0),i==null&&(i=t.length);n<i;){var o=n+i>>>1;e(t[o],r)>0?i=o:n=o+1}return n}}}function JX(e){return function(t,r){return yS(e(t),r)}}var eY=xL(yS),Yx=eY.right;function tY(e){return e===null?NaN:+e}function QM(e,t){var r=e.length,n=-1,i,o,a;if(t==null){for(;++n<r;)if((i=e[n])!=null&&i>=i)for(o=a=i;++n<r;)(i=e[n])!=null&&(o>i&&(o=i),a<i&&(a=i))}else for(;++n<r;)if((i=t(e[n],n,e))!=null&&i>=i)for(o=a=i;++n<r;)(i=t(e[n],n,e))!=null&&(o>i&&(o=i),a<i&&(a=i));return[o,a]}var Rw=Math.sqrt(50),Lw=Math.sqrt(10),kw=Math.sqrt(2);function bL(e,t,r){var n,i=-1,o,a,u;if(t=+t,e=+e,r=+r,e===t&&r>0)return[e];if((n=t<e)&&(o=e,e=t,t=o),(u=L1(e,t,r))===0||!isFinite(u))return[];if(u>0)for(e=Math.ceil(e/u),t=Math.floor(t/u),a=new Array(o=Math.ceil(t-e+1));++i<o;)a[i]=(e+i)*u;else for(e=Math.floor(e*u),t=Math.ceil(t*u),a=new Array(o=Math.ceil(e-t+1));++i<o;)a[i]=(e-i)/u;return n&&a.reverse(),a}function L1(e,t,r){var n=(t-e)/Math.max(0,r),i=Math.floor(Math.log(n)/Math.LN10),o=n/Math.pow(10,i);return i>=0?(o>=Rw?10:o>=Lw?5:o>=kw?2:1)*Math.pow(10,i):-Math.pow(10,-i)/(o>=Rw?10:o>=Lw?5:o>=kw?2:1)}function Ow(e,t,r){var n=Math.abs(t-e)/Math.max(0,r),i=Math.pow(10,Math.floor(Math.log(n)/Math.LN10)),o=n/i;return o>=Rw?i*=10:o>=Lw?i*=5:o>=kw&&(i*=2),t<e?-i:i}function rY(e,t,r){if(r==null&&(r=tY),!!(n=e.length)){if((t=+t)<=0||n<2)return+r(e[0],0,e);if(t>=1)return+r(e[n-1],n-1,e);var n,i=(n-1)*t,o=Math.floor(i),a=+r(e[o],o,e),u=+r(e[o+1],o+1,e);return a+(u-a)*(i-o)}}function nY(e,t,r,n,i){var o=e*e,a=o*e;return((1-3*e+3*o-a)*t+(4-6*o+3*a)*r+(1+3*e+3*o-3*a)*n+a*i)/6}function iY(e){var t=e.length-1;return function(r){var n=r<=0?r=0:r>=1?(r=1,t-1):Math.floor(r*t),i=e[n],o=e[n+1],a=n>0?e[n-1]:2*i-o,u=n<t-1?e[n+2]:2*o-i;return nY((r-n/t)*t,a,i,o,u)}}function _S(e){return function(){return e}}function aY(e,t){return function(r){return e+r*t}}function oY(e,t,r){return e=Math.pow(e,r),t=Math.pow(t,r)-e,r=1/r,function(n){return Math.pow(e+n*t,r)}}function sY(e){return(e=+e)==1?wL:function(t,r){return r-t?oY(t,r,e):_S(isNaN(t)?r:t)}}function wL(e,t){var r=t-e;return r?aY(e,r):_S(isNaN(e)?t:e)}const JM=function e(t){var r=sY(t);function n(i,o){var a=r((i=G1(i)).r,(o=G1(o)).r),u=r(i.g,o.g),c=r(i.b,o.b),h=wL(i.opacity,o.opacity);return function(y){return i.r=a(y),i.g=u(y),i.b=c(y),i.opacity=h(y),i+""}}return n.gamma=e,n}(1);function uY(e){return function(t){var r=t.length,n=new Array(r),i=new Array(r),o=new Array(r),a,u;for(a=0;a<r;++a)u=G1(t[a]),n[a]=u.r||0,i[a]=u.g||0,o[a]=u.b||0;return n=e(n),i=e(i),o=e(o),u.opacity=1,function(c){return u.r=n(c),u.g=i(c),u.b=o(c),u+""}}}var lY=uY(iY);function cY(e,t){t||(t=[]);var r=e?Math.min(t.length,e.length):0,n=t.slice(),i;return function(o){for(i=0;i<r;++i)n[i]=e[i]*(1-o)+t[i]*o;return n}}function fY(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function hY(e,t){var r=t?t.length:0,n=e?Math.min(r,e.length):0,i=new Array(n),o=new Array(r),a;for(a=0;a<n;++a)i[a]=xS(e[a],t[a]);for(;a<r;++a)o[a]=t[a];return function(u){for(a=0;a<n;++a)o[a]=i[a](u);return o}}function pY(e,t){var r=new Date;return e=+e,t=+t,function(n){return r.setTime(e*(1-n)+t*n),r}}function tx(e,t){return e=+e,t=+t,function(r){return e*(1-r)+t*r}}function dY(e,t){var r={},n={},i;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(i in t)i in e?r[i]=xS(e[i],t[i]):n[i]=t[i];return function(o){for(i in r)n[i]=r[i](o);return n}}var Dw=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,h2=new RegExp(Dw.source,"g");function vY(e){return function(){return e}}function mY(e){return function(t){return e(t)+""}}function gY(e,t){var r=Dw.lastIndex=h2.lastIndex=0,n,i,o,a=-1,u=[],c=[];for(e=e+"",t=t+"";(n=Dw.exec(e))&&(i=h2.exec(t));)(o=i.index)>r&&(o=t.slice(r,o),u[a]?u[a]+=o:u[++a]=o),(n=n[0])===(i=i[0])?u[a]?u[a]+=i:u[++a]=i:(u[++a]=null,c.push({i:a,x:tx(n,i)})),r=h2.lastIndex;return r<t.length&&(o=t.slice(r),u[a]?u[a]+=o:u[++a]=o),u.length<2?c[0]?mY(c[0].x):vY(t):(t=c.length,function(h){for(var y=0,x;y<t;++y)u[(x=c[y]).i]=x.x(h);return u.join("")})}function xS(e,t){var r=typeof t,n;return t==null||r==="boolean"?_S(t):(r==="number"?tx:r==="string"?(n=H0(t))?(t=n,JM):gY:t instanceof H0?JM:t instanceof Date?pY:fY(t)?cY:Array.isArray(t)?hY:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?dY:tx)(e,t)}function yY(e,t){return e=+e,t=+t,function(r){return Math.round(e*(1-r)+t*r)}}function Nv(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}function EL(e,t){switch(arguments.length){case 0:break;case 1:this.interpolator(e);break;default:this.interpolator(t).domain(e);break}return this}var Wf="$";function rx(){}rx.prototype=nx.prototype={constructor:rx,has:function(e){return Wf+e in this},get:function(e){return this[Wf+e]},set:function(e,t){return this[Wf+e]=t,this},remove:function(e){var t=Wf+e;return t in this&&delete this[t]},clear:function(){for(var e in this)e[0]===Wf&&delete this[e]},keys:function(){var e=[];for(var t in this)t[0]===Wf&&e.push(t.slice(1));return e},values:function(){var e=[];for(var t in this)t[0]===Wf&&e.push(this[t]);return e},entries:function(){var e=[];for(var t in this)t[0]===Wf&&e.push({key:t.slice(1),value:this[t]});return e},size:function(){var e=0;for(var t in this)t[0]===Wf&&++e;return e},empty:function(){for(var e in this)if(e[0]===Wf)return!1;return!0},each:function(e){for(var t in this)t[0]===Wf&&e(this[t],t.slice(1),this)}};function nx(e,t){var r=new rx;if(e instanceof rx)e.each(function(u,c){r.set(c,u)});else if(Array.isArray(e)){var n=-1,i=e.length,o;if(t==null)for(;++n<i;)r.set(n,e[n]);else for(;++n<i;)r.set(t(o=e[n],n,e),o)}else if(e)for(var a in e)r.set(a,e[a]);return r}function eP(){}var ym=nx.prototype;eP.prototype={constructor:eP,has:ym.has,add:function(e){return e+="",this[Wf+e]=e,this},remove:ym.remove,clear:ym.clear,values:ym.keys,size:ym.size,empty:ym.empty,each:ym.each};var SL=Array.prototype,AL=SL.map,Nm=SL.slice,tP={name:"implicit"};function ix(){var e=nx(),t=[],r=[],n=tP;function i(o){var a=o+"",u=e.get(a);if(!u){if(n!==tP)return n;e.set(a,u=t.push(o))}return r[(u-1)%r.length]}return i.domain=function(o){if(!arguments.length)return t.slice();t=[],e=nx();for(var a=-1,u=o.length,c,h;++a<u;)e.has(h=(c=o[a])+"")||e.set(h,t.push(c));return i},i.range=function(o){return arguments.length?(r=Nm.call(o),i):r.slice()},i.unknown=function(o){return arguments.length?(n=o,i):n},i.copy=function(){return ix(t,r).unknown(n)},Nv.apply(i,arguments),i}function _Y(e){return function(){return e}}function xY(e){return+e}var rP=[0,1];function Nl(e){return e}function Fw(e,t){return(t-=e=+e)?function(r){return(r-e)/t}:_Y(isNaN(t)?NaN:.5)}function nP(e){var t=e[0],r=e[e.length-1],n;return t>r&&(n=t,t=r,r=n),function(i){return Math.max(t,Math.min(r,i))}}function bY(e,t,r){var n=e[0],i=e[1],o=t[0],a=t[1];return i<n?(n=Fw(i,n),o=r(a,o)):(n=Fw(n,i),o=r(o,a)),function(u){return o(n(u))}}function wY(e,t,r){var n=Math.min(e.length,t.length)-1,i=new Array(n),o=new Array(n),a=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++a<n;)i[a]=Fw(e[a],e[a+1]),o[a]=r(t[a],t[a+1]);return function(u){var c=Yx(e,u,1,n)-1;return o[c](i[c](u))}}function qx(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function bS(){var e=rP,t=rP,r=xS,n,i,o,a=Nl,u,c,h;function y(){return u=Math.min(e.length,t.length)>2?wY:bY,c=h=null,x}function x(E){return isNaN(E=+E)?o:(c||(c=u(e.map(n),t,r)))(n(a(E)))}return x.invert=function(E){return a(i((h||(h=u(t,e.map(n),tx)))(E)))},x.domain=function(E){return arguments.length?(e=AL.call(E,xY),a===Nl||(a=nP(e)),y()):e.slice()},x.range=function(E){return arguments.length?(t=Nm.call(E),y()):t.slice()},x.rangeRound=function(E){return t=Nm.call(E),r=yY,y()},x.clamp=function(E){return arguments.length?(a=E?nP(e):Nl,x):a!==Nl},x.interpolate=function(E){return arguments.length?(r=E,y()):r},x.unknown=function(E){return arguments.length?(o=E,x):o},function(E,T){return n=E,i=T,y()}}function TL(e,t){return bS()(e,t)}function EY(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function ax(e,t){if((r=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var r,n=e.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+e.slice(r+1)]}function K0(e){return e=ax(Math.abs(e)),e?e[1]:NaN}function SY(e,t){return function(r,n){for(var i=r.length,o=[],a=0,u=e[0],c=0;i>0&&u>0&&(c+u+1>n&&(u=Math.max(1,n-c)),o.push(r.substring(i-=u,i+u)),!((c+=u+1)>n));)u=e[a=(a+1)%e.length];return o.reverse().join(t)}}function AY(e){return function(t){return t.replace(/[0-9]/g,function(r){return e[+r]})}}var TY=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function ox(e){if(!(t=TY.exec(e)))throw new Error("invalid format: "+e);var t;return new wS({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}ox.prototype=wS.prototype;function wS(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}wS.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function CY(e){e:for(var t=e.length,r=1,n=-1,i;r<t;++r)switch(e[r]){case".":n=i=r;break;case"0":n===0&&(n=r),i=r;break;default:if(!+e[r])break e;n>0&&(n=0);break}return n>0?e.slice(0,n)+e.slice(i+1):e}var CL;function MY(e,t){var r=ax(e,t);if(!r)return e+"";var n=r[0],i=r[1],o=i-(CL=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,a=n.length;return o===a?n:o>a?n+new Array(o-a+1).join("0"):o>0?n.slice(0,o)+"."+n.slice(o):"0."+new Array(1-o).join("0")+ax(e,Math.max(0,t+o-1))[0]}function iP(e,t){var r=ax(e,t);if(!r)return e+"";var n=r[0],i=r[1];return i<0?"0."+new Array(-i).join("0")+n:n.length>i+1?n.slice(0,i+1)+"."+n.slice(i+1):n+new Array(i-n.length+2).join("0")}const aP={"%":function(e,t){return(e*100).toFixed(t)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:EY,e:function(e,t){return e.toExponential(t)},f:function(e,t){return e.toFixed(t)},g:function(e,t){return e.toPrecision(t)},o:function(e){return Math.round(e).toString(8)},p:function(e,t){return iP(e*100,t)},r:iP,s:MY,X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function oP(e){return e}var sP=Array.prototype.map,uP=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function PY(e){var t=e.grouping===void 0||e.thousands===void 0?oP:SY(sP.call(e.grouping,Number),e.thousands+""),r=e.currency===void 0?"":e.currency[0]+"",n=e.currency===void 0?"":e.currency[1]+"",i=e.decimal===void 0?".":e.decimal+"",o=e.numerals===void 0?oP:AY(sP.call(e.numerals,String)),a=e.percent===void 0?"%":e.percent+"",u=e.minus===void 0?"-":e.minus+"",c=e.nan===void 0?"NaN":e.nan+"";function h(x){x=ox(x);var E=x.fill,T=x.align,I=x.sign,k=x.symbol,D=x.zero,V=x.width,O=x.comma,F=x.precision,N=x.trim,H=x.type;H==="n"?(O=!0,H="g"):aP[H]||(F===void 0&&(F=12),N=!0,H="g"),(D||E==="0"&&T==="=")&&(D=!0,E="0",T="=");var q=k==="$"?r:k==="#"&&/[boxX]/.test(H)?"0"+H.toLowerCase():"",Y=k==="$"?n:/[%p]/.test(H)?a:"",ee=aP[H],pe=/[defgprs%]/.test(H);F=F===void 0?6:/[gprs]/.test(H)?Math.max(1,Math.min(21,F)):Math.max(0,Math.min(20,F));function ue(ie){var xe=q,Se=Y,Ne,ze,Be;if(H==="c")Se=ee(ie)+Se,ie="";else{ie=+ie;var $e=ie<0||1/ie<0;if(ie=isNaN(ie)?c:ee(Math.abs(ie),F),N&&(ie=CY(ie)),$e&&+ie==0&&I!=="+"&&($e=!1),xe=($e?I==="("?I:u:I==="-"||I==="("?"":I)+xe,Se=(H==="s"?uP[8+CL/3]:"")+Se+($e&&I==="("?")":""),pe){for(Ne=-1,ze=ie.length;++Ne<ze;)if(Be=ie.charCodeAt(Ne),48>Be||Be>57){Se=(Be===46?i+ie.slice(Ne+1):ie.slice(Ne))+Se,ie=ie.slice(0,Ne);break}}}O&&!D&&(ie=t(ie,1/0));var it=xe.length+ie.length+Se.length,mt=it<V?new Array(V-it+1).join(E):"";switch(O&&D&&(ie=t(mt+ie,mt.length?V-Se.length:1/0),mt=""),T){case"<":ie=xe+ie+Se+mt;break;case"=":ie=xe+mt+ie+Se;break;case"^":ie=mt.slice(0,it=mt.length>>1)+xe+ie+Se+mt.slice(it);break;default:ie=mt+xe+ie+Se;break}return o(ie)}return ue.toString=function(){return x+""},ue}function y(x,E){var T=h((x=ox(x),x.type="f",x)),I=Math.max(-8,Math.min(8,Math.floor(K0(E)/3)))*3,k=Math.pow(10,-I),D=uP[8+I/3];return function(V){return T(k*V)+D}}return{format:h,formatPrefix:y}}var l1,ES,ML;IY({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function IY(e){return l1=PY(e),ES=l1.format,ML=l1.formatPrefix,l1}function RY(e){return Math.max(0,-K0(Math.abs(e)))}function LY(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(K0(t)/3)))*3-K0(Math.abs(e)))}function kY(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,K0(t)-K0(e))+1}function OY(e,t,r,n){var i=Ow(e,t,r),o;switch(n=ox(n??",f"),n.type){case"s":{var a=Math.max(Math.abs(e),Math.abs(t));return n.precision==null&&!isNaN(o=LY(i,a))&&(n.precision=o),ML(n,a)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(o=kY(i,Math.max(Math.abs(e),Math.abs(t))))&&(n.precision=o-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(o=RY(i))&&(n.precision=o-(n.type==="%")*2);break}}return ES(n)}function b_(e){var t=e.domain;return e.ticks=function(r){var n=t();return bL(n[0],n[n.length-1],r??10)},e.tickFormat=function(r,n){var i=t();return OY(i[0],i[i.length-1],r??10,n)},e.nice=function(r){r==null&&(r=10);var n=t(),i=0,o=n.length-1,a=n[i],u=n[o],c;return u<a&&(c=a,a=u,u=c,c=i,i=o,o=c),c=L1(a,u,r),c>0?(a=Math.floor(a/c)*c,u=Math.ceil(u/c)*c,c=L1(a,u,r)):c<0&&(a=Math.ceil(a*c)/c,u=Math.floor(u*c)/c,c=L1(a,u,r)),c>0?(n[i]=Math.floor(a/c)*c,n[o]=Math.ceil(u/c)*c,t(n)):c<0&&(n[i]=Math.ceil(a*c)/c,n[o]=Math.floor(u*c)/c,t(n)),e},e}function PL(){var e=TL(Nl,Nl);return e.copy=function(){return qx(e,PL())},Nv.apply(e,arguments),b_(e)}function IL(e,t){e=e.slice();var r=0,n=e.length-1,i=e[r],o=e[n],a;return o<i&&(a=r,r=n,n=a,a=i,i=o,o=a),e[r]=t.floor(i),e[n]=t.ceil(o),e}function lP(e){return Math.log(e)}function cP(e){return Math.exp(e)}function DY(e){return-Math.log(-e)}function FY(e){return-Math.exp(-e)}function NY(e){return isFinite(e)?+("1e"+e):e<0?0:e}function BY(e){return e===10?NY:e===Math.E?Math.exp:function(t){return Math.pow(e,t)}}function zY(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),function(t){return Math.log(t)/e})}function fP(e){return function(t){return-e(-t)}}function UY(e){var t=e(lP,cP),r=t.domain,n=10,i,o;function a(){return i=zY(n),o=BY(n),r()[0]<0?(i=fP(i),o=fP(o),e(DY,FY)):e(lP,cP),t}return t.base=function(u){return arguments.length?(n=+u,a()):n},t.domain=function(u){return arguments.length?(r(u),a()):r()},t.ticks=function(u){var c=r(),h=c[0],y=c[c.length-1],x;(x=y<h)&&(E=h,h=y,y=E);var E=i(h),T=i(y),I,k,D,V=u==null?10:+u,O=[];if(!(n%1)&&T-E<V){if(E=Math.round(E)-1,T=Math.round(T)+1,h>0){for(;E<T;++E)for(k=1,I=o(E);k<n;++k)if(D=I*k,!(D<h)){if(D>y)break;O.push(D)}}else for(;E<T;++E)for(k=n-1,I=o(E);k>=1;--k)if(D=I*k,!(D<h)){if(D>y)break;O.push(D)}}else O=bL(E,T,Math.min(T-E,V)).map(o);return x?O.reverse():O},t.tickFormat=function(u,c){if(c==null&&(c=n===10?".0e":","),typeof c!="function"&&(c=ES(c)),u===1/0)return c;u==null&&(u=10);var h=Math.max(1,n*u/t.ticks().length);return function(y){var x=y/o(Math.round(i(y)));return x*n<n-.5&&(x*=n),x<=h?c(y):""}},t.nice=function(){return r(IL(r(),{floor:function(u){return o(Math.floor(i(u)))},ceil:function(u){return o(Math.ceil(i(u)))}}))},t}function RL(){var e=UY(bS()).domain([1,10]);return e.copy=function(){return qx(e,RL()).base(e.base())},Nv.apply(e,arguments),e}function hP(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function VY(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function jY(e){return e<0?-e*e:e*e}function $Y(e){var t=e(Nl,Nl),r=1;function n(){return r===1?e(Nl,Nl):r===.5?e(VY,jY):e(hP(r),hP(1/r))}return t.exponent=function(i){return arguments.length?(r=+i,n()):r},b_(t)}function LL(){var e=$Y(bS());return e.copy=function(){return qx(e,LL()).exponent(e.exponent())},Nv.apply(e,arguments),e}function kL(){var e=[],t=[],r=[],n;function i(){var a=0,u=Math.max(1,t.length);for(r=new Array(u-1);++a<u;)r[a-1]=rY(e,a/u);return o}function o(a){return isNaN(a=+a)?n:t[Yx(r,a)]}return o.invertExtent=function(a){var u=t.indexOf(a);return u<0?[NaN,NaN]:[u>0?r[u-1]:e[0],u<r.length?r[u]:e[e.length-1]]},o.domain=function(a){if(!arguments.length)return e.slice();e=[];for(var u=0,c=a.length,h;u<c;++u)h=a[u],h!=null&&!isNaN(h=+h)&&e.push(h);return e.sort(yS),i()},o.range=function(a){return arguments.length?(t=Nm.call(a),i()):t.slice()},o.unknown=function(a){return arguments.length?(n=a,o):n},o.quantiles=function(){return r.slice()},o.copy=function(){return kL().domain(e).range(t).unknown(n)},Nv.apply(o,arguments)}function OL(){var e=0,t=1,r=1,n=[.5],i=[0,1],o;function a(c){return c<=c?i[Yx(n,c,0,r)]:o}function u(){var c=-1;for(n=new Array(r);++c<r;)n[c]=((c+1)*t-(c-r)*e)/(r+1);return a}return a.domain=function(c){return arguments.length?(e=+c[0],t=+c[1],u()):[e,t]},a.range=function(c){return arguments.length?(r=(i=Nm.call(c)).length-1,u()):i.slice()},a.invertExtent=function(c){var h=i.indexOf(c);return h<0?[NaN,NaN]:h<1?[e,n[0]]:h>=r?[n[r-1],t]:[n[h-1],n[h]]},a.unknown=function(c){return arguments.length&&(o=c),a},a.thresholds=function(){return n.slice()},a.copy=function(){return OL().domain([e,t]).range(i).unknown(o)},Nv.apply(b_(a),arguments)}function DL(){var e=[.5],t=[0,1],r,n=1;function i(o){return o<=o?t[Yx(e,o,0,n)]:r}return i.domain=function(o){return arguments.length?(e=Nm.call(o),n=Math.min(e.length,t.length-1),i):e.slice()},i.range=function(o){return arguments.length?(t=Nm.call(o),n=Math.min(e.length,t.length-1),i):t.slice()},i.invertExtent=function(o){var a=t.indexOf(o);return[e[a-1],e[a]]},i.unknown=function(o){return arguments.length?(r=o,i):r},i.copy=function(){return DL().domain(e).range(t).unknown(r)},Nv.apply(i,arguments)}var p2=new Date,d2=new Date;function rc(e,t,r,n){function i(o){return e(o=arguments.length===0?new Date:new Date(+o)),o}return i.floor=function(o){return e(o=new Date(+o)),o},i.ceil=function(o){return e(o=new Date(o-1)),t(o,1),e(o),o},i.round=function(o){var a=i(o),u=i.ceil(o);return o-a<u-o?a:u},i.offset=function(o,a){return t(o=new Date(+o),a==null?1:Math.floor(a)),o},i.range=function(o,a,u){var c=[],h;if(o=i.ceil(o),u=u==null?1:Math.floor(u),!(o<a)||!(u>0))return c;do c.push(h=new Date(+o)),t(o,u),e(o);while(h<o&&o<a);return c},i.filter=function(o){return rc(function(a){if(a>=a)for(;e(a),!o(a);)a.setTime(a-1)},function(a,u){if(a>=a)if(u<0)for(;++u<=0;)for(;t(a,-1),!o(a););else for(;--u>=0;)for(;t(a,1),!o(a););})},r&&(i.count=function(o,a){return p2.setTime(+o),d2.setTime(+a),e(p2),e(d2),Math.floor(r(p2,d2))},i.every=function(o){return o=Math.floor(o),!isFinite(o)||!(o>0)?null:o>1?i.filter(n?function(a){return n(a)%o===0}:function(a){return i.count(0,a)%o===0}):i}),i}var sx=rc(function(){},function(e,t){e.setTime(+e+t)},function(e,t){return t-e});sx.every=function(e){return e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?rc(function(t){t.setTime(Math.floor(t/e)*e)},function(t,r){t.setTime(+t+r*e)},function(t,r){return(r-t)/e}):sx};const GY=sx;sx.range;var ux=1e3,Ky=6e4,pP=36e5,FL=864e5,NL=6048e5,BL=rc(function(e){e.setTime(e-e.getMilliseconds())},function(e,t){e.setTime(+e+t*ux)},function(e,t){return(t-e)/ux},function(e){return e.getUTCSeconds()});const HY=BL;BL.range;var zL=rc(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*ux)},function(e,t){e.setTime(+e+t*Ky)},function(e,t){return(t-e)/Ky},function(e){return e.getMinutes()});const WY=zL;zL.range;var UL=rc(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*ux-e.getMinutes()*Ky)},function(e,t){e.setTime(+e+t*pP)},function(e,t){return(t-e)/pP},function(e){return e.getHours()});const XY=UL;UL.range;var VL=rc(function(e){e.setHours(0,0,0,0)},function(e,t){e.setDate(e.getDate()+t)},function(e,t){return(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*Ky)/FL},function(e){return e.getDate()-1});const SS=VL;VL.range;function jm(e){return rc(function(t){t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},function(t,r){t.setDate(t.getDate()+r*7)},function(t,r){return(r-t-(r.getTimezoneOffset()-t.getTimezoneOffset())*Ky)/NL})}var AS=jm(0),lx=jm(1),YY=jm(2),qY=jm(3),Q0=jm(4),ZY=jm(5),KY=jm(6);AS.range;lx.range;YY.range;qY.range;Q0.range;ZY.range;KY.range;var jL=rc(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,t){e.setMonth(e.getMonth()+t)},function(e,t){return t.getMonth()-e.getMonth()+(t.getFullYear()-e.getFullYear())*12},function(e){return e.getMonth()});const QY=jL;jL.range;var TS=rc(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,t){e.setFullYear(e.getFullYear()+t)},function(e,t){return t.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()});TS.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:rc(function(t){t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},function(t,r){t.setFullYear(t.getFullYear()+r*e)})};const J0=TS;TS.range;var $L=rc(function(e){e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCDate(e.getUTCDate()+t)},function(e,t){return(t-e)/FL},function(e){return e.getUTCDate()-1});const GL=$L;$L.range;function $m(e){return rc(function(t){t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},function(t,r){t.setUTCDate(t.getUTCDate()+r*7)},function(t,r){return(r-t)/NL})}var HL=$m(0),cx=$m(1),JY=$m(2),eq=$m(3),eg=$m(4),tq=$m(5),rq=$m(6);HL.range;cx.range;JY.range;eq.range;eg.range;tq.range;rq.range;var CS=rc(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCFullYear(e.getUTCFullYear()+t)},function(e,t){return t.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});CS.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:rc(function(t){t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},function(t,r){t.setUTCFullYear(t.getUTCFullYear()+r*e)})};const Qy=CS;CS.range;function v2(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function m2(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function ry(e,t,r){return{y:e,m:t,d:r,H:0,M:0,S:0,L:0}}function nq(e){var t=e.dateTime,r=e.date,n=e.time,i=e.periods,o=e.days,a=e.shortDays,u=e.months,c=e.shortMonths,h=ny(i),y=iy(i),x=ny(o),E=iy(o),T=ny(a),I=iy(a),k=ny(u),D=iy(u),V=ny(c),O=iy(c),F={a:$e,A:it,b:mt,B:Qe,c:null,d:_P,e:_P,f:Tq,g:Fq,G:Bq,H:Eq,I:Sq,j:Aq,L:WL,m:Cq,M:Mq,p:rt,q:gt,Q:wP,s:EP,S:Pq,u:Iq,U:Rq,V:Lq,w:kq,W:Oq,x:null,X:null,y:Dq,Y:Nq,Z:zq,"%":bP},N={a:er,A:zt,b:qt,B:Zr,c:null,d:xP,e:xP,f:$q,g:Jq,G:tZ,H:Uq,I:Vq,j:jq,L:YL,m:Gq,M:Hq,p:Wr,q:On,Q:wP,s:EP,S:Wq,u:Xq,U:Yq,V:qq,w:Zq,W:Kq,x:null,X:null,y:Qq,Y:eZ,Z:rZ,"%":bP},H={a:ue,A:ie,b:xe,B:Se,c:Ne,d:gP,e:gP,f:_q,g:mP,G:vP,H:yP,I:yP,j:vq,L:yq,m:dq,M:mq,p:pe,q:pq,Q:bq,s:wq,S:gq,u:uq,U:lq,V:cq,w:sq,W:fq,x:ze,X:Be,y:mP,Y:vP,Z:hq,"%":xq};F.x=q(r,F),F.X=q(n,F),F.c=q(t,F),N.x=q(r,N),N.X=q(n,N),N.c=q(t,N);function q(Ut,Ar){return function(an){var Ft=[],Mr=-1,mn=0,Nn=Ut.length,Xn,qn,Li;for(an instanceof Date||(an=new Date(+an));++Mr<Nn;)Ut.charCodeAt(Mr)===37&&(Ft.push(Ut.slice(mn,Mr)),(qn=dP[Xn=Ut.charAt(++Mr)])!=null?Xn=Ut.charAt(++Mr):qn=Xn==="e"?" ":"0",(Li=Ar[Xn])&&(Xn=Li(an,qn)),Ft.push(Xn),mn=Mr+1);return Ft.push(Ut.slice(mn,Mr)),Ft.join("")}}function Y(Ut,Ar){return function(an){var Ft=ry(1900,void 0,1),Mr=ee(Ft,Ut,an+="",0),mn,Nn;if(Mr!=an.length)return null;if("Q"in Ft)return new Date(Ft.Q);if("s"in Ft)return new Date(Ft.s*1e3+("L"in Ft?Ft.L:0));if(Ar&&!("Z"in Ft)&&(Ft.Z=0),"p"in Ft&&(Ft.H=Ft.H%12+Ft.p*12),Ft.m===void 0&&(Ft.m="q"in Ft?Ft.q:0),"V"in Ft){if(Ft.V<1||Ft.V>53)return null;"w"in Ft||(Ft.w=1),"Z"in Ft?(mn=m2(ry(Ft.y,0,1)),Nn=mn.getUTCDay(),mn=Nn>4||Nn===0?cx.ceil(mn):cx(mn),mn=GL.offset(mn,(Ft.V-1)*7),Ft.y=mn.getUTCFullYear(),Ft.m=mn.getUTCMonth(),Ft.d=mn.getUTCDate()+(Ft.w+6)%7):(mn=v2(ry(Ft.y,0,1)),Nn=mn.getDay(),mn=Nn>4||Nn===0?lx.ceil(mn):lx(mn),mn=SS.offset(mn,(Ft.V-1)*7),Ft.y=mn.getFullYear(),Ft.m=mn.getMonth(),Ft.d=mn.getDate()+(Ft.w+6)%7)}else("W"in Ft||"U"in Ft)&&("w"in Ft||(Ft.w="u"in Ft?Ft.u%7:"W"in Ft?1:0),Nn="Z"in Ft?m2(ry(Ft.y,0,1)).getUTCDay():v2(ry(Ft.y,0,1)).getDay(),Ft.m=0,Ft.d="W"in Ft?(Ft.w+6)%7+Ft.W*7-(Nn+5)%7:Ft.w+Ft.U*7-(Nn+6)%7);return"Z"in Ft?(Ft.H+=Ft.Z/100|0,Ft.M+=Ft.Z%100,m2(Ft)):v2(Ft)}}function ee(Ut,Ar,an,Ft){for(var Mr=0,mn=Ar.length,Nn=an.length,Xn,qn;Mr<mn;){if(Ft>=Nn)return-1;if(Xn=Ar.charCodeAt(Mr++),Xn===37){if(Xn=Ar.charAt(Mr++),qn=H[Xn in dP?Ar.charAt(Mr++):Xn],!qn||(Ft=qn(Ut,an,Ft))<0)return-1}else if(Xn!=an.charCodeAt(Ft++))return-1}return Ft}function pe(Ut,Ar,an){var Ft=h.exec(Ar.slice(an));return Ft?(Ut.p=y[Ft[0].toLowerCase()],an+Ft[0].length):-1}function ue(Ut,Ar,an){var Ft=T.exec(Ar.slice(an));return Ft?(Ut.w=I[Ft[0].toLowerCase()],an+Ft[0].length):-1}function ie(Ut,Ar,an){var Ft=x.exec(Ar.slice(an));return Ft?(Ut.w=E[Ft[0].toLowerCase()],an+Ft[0].length):-1}function xe(Ut,Ar,an){var Ft=V.exec(Ar.slice(an));return Ft?(Ut.m=O[Ft[0].toLowerCase()],an+Ft[0].length):-1}function Se(Ut,Ar,an){var Ft=k.exec(Ar.slice(an));return Ft?(Ut.m=D[Ft[0].toLowerCase()],an+Ft[0].length):-1}function Ne(Ut,Ar,an){return ee(Ut,t,Ar,an)}function ze(Ut,Ar,an){return ee(Ut,r,Ar,an)}function Be(Ut,Ar,an){return ee(Ut,n,Ar,an)}function $e(Ut){return a[Ut.getDay()]}function it(Ut){return o[Ut.getDay()]}function mt(Ut){return c[Ut.getMonth()]}function Qe(Ut){return u[Ut.getMonth()]}function rt(Ut){return i[+(Ut.getHours()>=12)]}function gt(Ut){return 1+~~(Ut.getMonth()/3)}function er(Ut){return a[Ut.getUTCDay()]}function zt(Ut){return o[Ut.getUTCDay()]}function qt(Ut){return c[Ut.getUTCMonth()]}function Zr(Ut){return u[Ut.getUTCMonth()]}function Wr(Ut){return i[+(Ut.getUTCHours()>=12)]}function On(Ut){return 1+~~(Ut.getUTCMonth()/3)}return{format:function(Ut){var Ar=q(Ut+="",F);return Ar.toString=function(){return Ut},Ar},parse:function(Ut){var Ar=Y(Ut+="",!1);return Ar.toString=function(){return Ut},Ar},utcFormat:function(Ut){var Ar=q(Ut+="",N);return Ar.toString=function(){return Ut},Ar},utcParse:function(Ut){var Ar=Y(Ut+="",!0);return Ar.toString=function(){return Ut},Ar}}}var dP={"-":"",_:" ",0:"0"},Hu=/^\s*\d+/,iq=/^%/,aq=/[\\^$*+?|[\]().{}]/g;function Qa(e,t,r){var n=e<0?"-":"",i=(n?-e:e)+"",o=i.length;return n+(o<r?new Array(r-o+1).join(t)+i:i)}function oq(e){return e.replace(aq,"\\$&")}function ny(e){return new RegExp("^(?:"+e.map(oq).join("|")+")","i")}function iy(e){for(var t={},r=-1,n=e.length;++r<n;)t[e[r].toLowerCase()]=r;return t}function sq(e,t,r){var n=Hu.exec(t.slice(r,r+1));return n?(e.w=+n[0],r+n[0].length):-1}function uq(e,t,r){var n=Hu.exec(t.slice(r,r+1));return n?(e.u=+n[0],r+n[0].length):-1}function lq(e,t,r){var n=Hu.exec(t.slice(r,r+2));return n?(e.U=+n[0],r+n[0].length):-1}function cq(e,t,r){var n=Hu.exec(t.slice(r,r+2));return n?(e.V=+n[0],r+n[0].length):-1}function fq(e,t,r){var n=Hu.exec(t.slice(r,r+2));return n?(e.W=+n[0],r+n[0].length):-1}function vP(e,t,r){var n=Hu.exec(t.slice(r,r+4));return n?(e.y=+n[0],r+n[0].length):-1}function mP(e,t,r){var n=Hu.exec(t.slice(r,r+2));return n?(e.y=+n[0]+(+n[0]>68?1900:2e3),r+n[0].length):-1}function hq(e,t,r){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(r,r+6));return n?(e.Z=n[1]?0:-(n[2]+(n[3]||"00")),r+n[0].length):-1}function pq(e,t,r){var n=Hu.exec(t.slice(r,r+1));return n?(e.q=n[0]*3-3,r+n[0].length):-1}function dq(e,t,r){var n=Hu.exec(t.slice(r,r+2));return n?(e.m=n[0]-1,r+n[0].length):-1}function gP(e,t,r){var n=Hu.exec(t.slice(r,r+2));return n?(e.d=+n[0],r+n[0].length):-1}function vq(e,t,r){var n=Hu.exec(t.slice(r,r+3));return n?(e.m=0,e.d=+n[0],r+n[0].length):-1}function yP(e,t,r){var n=Hu.exec(t.slice(r,r+2));return n?(e.H=+n[0],r+n[0].length):-1}function mq(e,t,r){var n=Hu.exec(t.slice(r,r+2));return n?(e.M=+n[0],r+n[0].length):-1}function gq(e,t,r){var n=Hu.exec(t.slice(r,r+2));return n?(e.S=+n[0],r+n[0].length):-1}function yq(e,t,r){var n=Hu.exec(t.slice(r,r+3));return n?(e.L=+n[0],r+n[0].length):-1}function _q(e,t,r){var n=Hu.exec(t.slice(r,r+6));return n?(e.L=Math.floor(n[0]/1e3),r+n[0].length):-1}function xq(e,t,r){var n=iq.exec(t.slice(r,r+1));return n?r+n[0].length:-1}function bq(e,t,r){var n=Hu.exec(t.slice(r));return n?(e.Q=+n[0],r+n[0].length):-1}function wq(e,t,r){var n=Hu.exec(t.slice(r));return n?(e.s=+n[0],r+n[0].length):-1}function _P(e,t){return Qa(e.getDate(),t,2)}function Eq(e,t){return Qa(e.getHours(),t,2)}function Sq(e,t){return Qa(e.getHours()%12||12,t,2)}function Aq(e,t){return Qa(1+SS.count(J0(e),e),t,3)}function WL(e,t){return Qa(e.getMilliseconds(),t,3)}function Tq(e,t){return WL(e,t)+"000"}function Cq(e,t){return Qa(e.getMonth()+1,t,2)}function Mq(e,t){return Qa(e.getMinutes(),t,2)}function Pq(e,t){return Qa(e.getSeconds(),t,2)}function Iq(e){var t=e.getDay();return t===0?7:t}function Rq(e,t){return Qa(AS.count(J0(e)-1,e),t,2)}function XL(e){var t=e.getDay();return t>=4||t===0?Q0(e):Q0.ceil(e)}function Lq(e,t){return e=XL(e),Qa(Q0.count(J0(e),e)+(J0(e).getDay()===4),t,2)}function kq(e){return e.getDay()}function Oq(e,t){return Qa(lx.count(J0(e)-1,e),t,2)}function Dq(e,t){return Qa(e.getFullYear()%100,t,2)}function Fq(e,t){return e=XL(e),Qa(e.getFullYear()%100,t,2)}function Nq(e,t){return Qa(e.getFullYear()%1e4,t,4)}function Bq(e,t){var r=e.getDay();return e=r>=4||r===0?Q0(e):Q0.ceil(e),Qa(e.getFullYear()%1e4,t,4)}function zq(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+Qa(t/60|0,"0",2)+Qa(t%60,"0",2)}function xP(e,t){return Qa(e.getUTCDate(),t,2)}function Uq(e,t){return Qa(e.getUTCHours(),t,2)}function Vq(e,t){return Qa(e.getUTCHours()%12||12,t,2)}function jq(e,t){return Qa(1+GL.count(Qy(e),e),t,3)}function YL(e,t){return Qa(e.getUTCMilliseconds(),t,3)}function $q(e,t){return YL(e,t)+"000"}function Gq(e,t){return Qa(e.getUTCMonth()+1,t,2)}function Hq(e,t){return Qa(e.getUTCMinutes(),t,2)}function Wq(e,t){return Qa(e.getUTCSeconds(),t,2)}function Xq(e){var t=e.getUTCDay();return t===0?7:t}function Yq(e,t){return Qa(HL.count(Qy(e)-1,e),t,2)}function qL(e){var t=e.getUTCDay();return t>=4||t===0?eg(e):eg.ceil(e)}function qq(e,t){return e=qL(e),Qa(eg.count(Qy(e),e)+(Qy(e).getUTCDay()===4),t,2)}function Zq(e){return e.getUTCDay()}function Kq(e,t){return Qa(cx.count(Qy(e)-1,e),t,2)}function Qq(e,t){return Qa(e.getUTCFullYear()%100,t,2)}function Jq(e,t){return e=qL(e),Qa(e.getUTCFullYear()%100,t,2)}function eZ(e,t){return Qa(e.getUTCFullYear()%1e4,t,4)}function tZ(e,t){var r=e.getUTCDay();return e=r>=4||r===0?eg(e):eg.ceil(e),Qa(e.getUTCFullYear()%1e4,t,4)}function rZ(){return"+0000"}function bP(){return"%"}function wP(e){return+e}function EP(e){return Math.floor(+e/1e3)}var S0,ZL;nZ({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function nZ(e){return S0=nq(e),ZL=S0.format,S0.parse,S0.utcFormat,S0.utcParse,S0}var _y=1e3,xy=_y*60,by=xy*60,Jy=by*24,iZ=Jy*7,SP=Jy*30,g2=Jy*365;function aZ(e){return new Date(e)}function oZ(e){return e instanceof Date?+e:+new Date(+e)}function KL(e,t,r,n,i,o,a,u,c){var h=TL(Nl,Nl),y=h.invert,x=h.domain,E=c(".%L"),T=c(":%S"),I=c("%I:%M"),k=c("%I %p"),D=c("%a %d"),V=c("%b %d"),O=c("%B"),F=c("%Y"),N=[[a,1,_y],[a,5,5*_y],[a,15,15*_y],[a,30,30*_y],[o,1,xy],[o,5,5*xy],[o,15,15*xy],[o,30,30*xy],[i,1,by],[i,3,3*by],[i,6,6*by],[i,12,12*by],[n,1,Jy],[n,2,2*Jy],[r,1,iZ],[t,1,SP],[t,3,3*SP],[e,1,g2]];function H(Y){return(a(Y)<Y?E:o(Y)<Y?T:i(Y)<Y?I:n(Y)<Y?k:t(Y)<Y?r(Y)<Y?D:V:e(Y)<Y?O:F)(Y)}function q(Y,ee,pe,ue){if(Y==null&&(Y=10),typeof Y=="number"){var ie=Math.abs(pe-ee)/Y,xe=xL(function(Se){return Se[2]}).right(N,ie);xe===N.length?(ue=Ow(ee/g2,pe/g2,Y),Y=e):xe?(xe=N[ie/N[xe-1][2]<N[xe][2]/ie?xe-1:xe],ue=xe[1],Y=xe[0]):(ue=Math.max(Ow(ee,pe,Y),1),Y=u)}return ue==null?Y:Y.every(ue)}return h.invert=function(Y){return new Date(y(Y))},h.domain=function(Y){return arguments.length?x(AL.call(Y,oZ)):x().map(aZ)},h.ticks=function(Y,ee){var pe=x(),ue=pe[0],ie=pe[pe.length-1],xe=ie<ue,Se;return xe&&(Se=ue,ue=ie,ie=Se),Se=q(Y,ue,ie,ee),Se=Se?Se.range(ue,ie+1):[],xe?Se.reverse():Se},h.tickFormat=function(Y,ee){return ee==null?H:c(ee)},h.nice=function(Y,ee){var pe=x();return(Y=q(Y,pe[0],pe[pe.length-1],ee))?x(IL(pe,Y)):h},h.copy=function(){return qx(h,KL(e,t,r,n,i,o,a,u,c))},h}function sZ(){return Nv.apply(KL(J0,QY,AS,SS,XY,WY,HY,GY,ZL).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function uZ(){var e=0,t=1,r,n,i,o,a=Nl,u=!1,c;function h(y){return isNaN(y=+y)?c:a(i===0?.5:(y=(o(y)-r)*i,u?Math.max(0,Math.min(1,y)):y))}return h.domain=function(y){return arguments.length?(r=o(e=+y[0]),n=o(t=+y[1]),i=r===n?0:1/(n-r),h):[e,t]},h.clamp=function(y){return arguments.length?(u=!!y,h):u},h.interpolator=function(y){return arguments.length?(a=y,h):a},h.unknown=function(y){return arguments.length?(c=y,h):c},function(y){return o=y,r=y(e),n=y(t),i=r===n?0:1/(n-r),h}}function QL(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function JL(){var e=b_(uZ()(Nl));return e.copy=function(){return QL(e,JL())},EL.apply(e,arguments)}function lZ(){var e=0,t=.5,r=1,n,i,o,a,u,c=Nl,h,y=!1,x;function E(T){return isNaN(T=+T)?x:(T=.5+((T=+h(T))-i)*(T<i?a:u),c(y?Math.max(0,Math.min(1,T)):T))}return E.domain=function(T){return arguments.length?(n=h(e=+T[0]),i=h(t=+T[1]),o=h(r=+T[2]),a=n===i?0:.5/(i-n),u=i===o?0:.5/(o-i),E):[e,t,r]},E.clamp=function(T){return arguments.length?(y=!!T,E):y},E.interpolator=function(T){return arguments.length?(c=T,E):c},E.unknown=function(T){return arguments.length?(x=T,E):x},function(T){return h=T,n=T(e),i=T(t),o=T(r),a=n===i?0:.5/(i-n),u=i===o?0:.5/(o-i),E}}function ek(){var e=b_(lZ()(Nl));return e.copy=function(){return QL(e,ek())},EL.apply(e,arguments)}function tk(e){var t,r=[];function n(i){return i??t}return n.invert=n,n.domain=n.range=function(i){return i?(r=i,i):r},n.unknown=function(i){return i?(t=i,i):t},n.copy=function(){return tk().unknown(t)},n}var ff,AP,TP,cZ=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,fZ=(ff={},Q(ff,io.LINEAR,PL),Q(ff,io.POWER,LL),Q(ff,io.LOG,RL),Q(ff,io.IDENTITY,tk),Q(ff,io.SEQUENTIAL,JL),Q(ff,io.TIME,sZ),Q(ff,io.QUANTILE,kL),Q(ff,io.QUANTIZE,OL),Q(ff,io.THRESHOLD,DL),Q(ff,io.CAT,ix),Q(ff,io.DIVERGING,ek),ff),hZ=(AP=Ei(),AP(TP=function(){function e(){$t(this,e),Q(this,"scaleOptions",{})}return Gt(e,[{key:"apply",value:function(r,n){var i=this,o=n.styleAttributeService;r.hooks.init.tapPromise("FeatureScalePlugin",Vt(Ce.mark(function a(){var u,c,h;return Ce.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(r.log($s.ScaleInitStart,Hs.INIT),i.scaleOptions=r.getScaleOptions(),c=o.getLayerStyleAttributes(),h=(u=r.getSource())===null||u===void 0?void 0:u.data.dataArray,!(Array.isArray(h)&&h.length===0)){x.next=8;break}return x.abrupt("return");case 8:i.caculateScalesForAttributes(c||[],h);case 9:r.log($s.ScaleInitEnd,Hs.INIT);case 10:case"end":return x.stop()}},a)}))),r.hooks.beforeRenderData.tapPromise("FeatureScalePlugin",function(){var a=Vt(Ce.mark(function u(c){var h,y;return Ce.wrap(function(E){for(;;)switch(E.prev=E.next){case 0:if(c){E.next=2;break}return E.abrupt("return",c);case 2:if(r.log($s.ScaleInitStart,Hs.UPDATE),i.scaleOptions=r.getScaleOptions(),h=o.getLayerStyleAttributes(),y=r.getSource().data.dataArray,!(Array.isArray(y)&&y.length===0)){E.next=8;break}return E.abrupt("return",!0);case 8:return i.caculateScalesForAttributes(h||[],y),r.log($s.ScaleInitEnd,Hs.UPDATE),r.layerModelNeedUpdate=!0,E.abrupt("return",!0);case 12:case"end":return E.stop()}},u)}));return function(u){return a.apply(this,arguments)}}()),r.hooks.beforeRender.tap("FeatureScalePlugin",function(){if(!r.layerModelNeedUpdate){i.scaleOptions=r.getScaleOptions();var a=o.getLayerStyleAttributes(),u=r.getSource().data.dataArray;if(!(Array.isArray(u)&&u.length===0)&&a){var c=a.filter(function(h){return h.needRescale});c.length&&i.caculateScalesForAttributes(c,u)}}})}},{key:"isNumber",value:function(r){return!isNaN(parseFloat(r))&&isFinite(r)}},{key:"caculateScalesForAttributes",value:function(r,n){var i=this;r.forEach(function(o){if(o.scale){var a=o.scale;a.names=i.parseFields(o.scale.field||[]);var u=[];a.names.forEach(function(c){var h;u.push(i.createScale(c,o.name,(h=o.scale)===null||h===void 0?void 0:h.values,n))}),u.some(function(c){return c.type===_v.VARIABLE})?(a.type=_v.VARIABLE,u.forEach(function(c){if(!a.callback&&a.values!=="text"){var h;switch((h=c.option)===null||h===void 0?void 0:h.type){case io.LOG:case io.LINEAR:case io.POWER:if(a.values&&a.values.length>2){var y=c.scale.ticks(a.values.length);c.scale.domain(y)}a.values?c.scale.range(a.values):c.scale.range(c.option.domain);break;case io.QUANTILE:case io.QUANTIZE:case io.THRESHOLD:c.scale.range(a.values);break;case io.IDENTITY:break;case io.CAT:a.values?c.scale.range(a.values):c.scale.range(c.option.domain);break;case io.DIVERGING:case io.SEQUENTIAL:c.scale.interpolator(lY(a.values));break}}if(a.values==="text"){var x;c.scale.range((x=c.option)===null||x===void 0?void 0:x.domain)}})):(a.type=_v.CONSTANT,a.defaultValues=u.map(function(c,h){return c.scale(a.names[h])})),a.scalers=u.map(function(c){return{field:c.field,func:c.scale,option:c.option}}),o.needRescale=!1}})}},{key:"parseFields",value:function(r){return Array.isArray(r)?r:Er.isString(r)?r.split("*"):[r]}},{key:"createScale",value:function(r,n,i,o){var a,u,c=this.scaleOptions[n]&&((a=this.scaleOptions[n])===null||a===void 0?void 0:a.field)===r?this.scaleOptions[n]:this.scaleOptions[r],h={field:r,scale:void 0,type:_v.VARIABLE,option:c};if(!o||!o.length)return c&&c.type?h.scale=this.createDefaultScale(c):(h.scale=ix([r]),h.type=_v.CONSTANT),h;var y=(u=o.find(function(T){return!Er.isNil(T[r])}))===null||u===void 0?void 0:u[r];if(this.isNumber(r)||Er.isNil(y)&&!c)h.scale=ix([r]),h.type=_v.CONSTANT;else{var x=c&&c.type||this.getDefaultType(y);i==="text"&&(x=io.CAT);var E=this.createScaleConfig(x,r,c,o);h.scale=this.createDefaultScale(E),h.option=E}return h}},{key:"getDefaultType",value:function(r){var n=io.LINEAR;return typeof r=="string"&&(n=cZ.test(r)?io.TIME:io.CAT),n}},{key:"createScaleConfig",value:function(r,n,i,o){var a={type:r},u=(o==null?void 0:o.map(function(y){return y[n]}))||[];if(i!=null&&i.domain)a.domain=i==null?void 0:i.domain;else if(r===io.CAT||r===io.IDENTITY)a.domain=Er.uniq(u);else if(r===io.QUANTILE)a.domain=u;else if(r===io.DIVERGING){var c=QM(u),h=(i==null?void 0:i.neutral)!==void 0?i==null?void 0:i.neutral:(c[0]+c[1])/2;a.domain=[c[0],h,c[1]]}else a.domain=QM(u);return _t(_t({},a),i)}},{key:"createDefaultScale",value:function(r){var n=r.type,i=r.domain,o=r.unknown,a=r.clamp,u=r.nice,c=fZ[n]();return i&&c.domain&&c.domain(i),o&&c.unknown(o),a!==void 0&&c.clamp&&c.clamp(a),u!==void 0&&c.nice&&c.nice(u),c}}]),e}())||TP),CP,MP,pZ=(CP=Ei(),CP(MP=function(){function e(){$t(this,e)}return Gt(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("LayerAnimateStylePlugin",function(){var n=r.animateStatus;n&&r.models.forEach(function(i){i.addUniforms(_t({},r.layerModel.getAnimateUniforms()))})})}}]),e}())||MP),PP,IP,dZ=(PP=Ei(),PP(IP=function(){function e(){$t(this,e)}return Gt(e,[{key:"apply",value:function(r){r.hooks.afterInit.tap("LayerMaskPlugin",function(){var n=r.getLayerConfig(),i=n.maskLayers,o=n.enableMask;if(!r.tileLayer&&i&&i.length>0){var a;(a=r.masks).push.apply(a,cn(i)),r.updateLayerConfig({mask:o})}})}}]),e}())||IP),vZ=function(){function e(t){var r=t.rendererService,n=t.layerService,i=t.parent;$t(this,e),Q(this,"tileResource",new Map),Q(this,"layerTiles",[]),this.rendererService=r,this.layerService=n,this.parent=i}return Gt(e,[{key:"tiles",get:function(){return this.layerTiles}},{key:"hasTile",value:function(r){return this.layerTiles.some(function(n){return n.key===r})}},{key:"addTile",value:function(r){this.layerTiles.push(r)}},{key:"getTile",value:function(r){return this.layerTiles.find(function(n){return n.key===r})}},{key:"getVisibleTileBylngLat",value:function(r){return this.layerTiles.find(function(n){return n.isLoaded&&n.visible&&n.lnglatInBounds(r)})}},{key:"removeTile",value:function(r){var n=this.layerTiles.findIndex(function(o){return o.key===r}),i=this.layerTiles.splice(n,1);i[0]&&i[0].destroy()}},{key:"updateTileVisible",value:function(r){var n=this.getTile(r.key);n==null||n.updateVisible(r.isVisible)}},{key:"isParentLoaded",value:function(r){var n=r.parent;if(!n)return!0;var i=this.getTile(n==null?void 0:n.key);return!!(i!=null&&i.isLoaded)}},{key:"isChildrenLoaded",value:function(r){var n=this,i=r==null?void 0:r.children;return i.length===0?!0:i.some(function(o){var a=n.getTile(o==null?void 0:o.key);return(a==null?void 0:a.isLoaded)===!1})}},{key:"render",value:function(){var t=Vt(Ce.mark(function n(){var i=this,o,a;return Ce.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return o=this.getRenderLayers(),a=o.map(function(){var h=Vt(Ce.mark(function y(x){return Ce.wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return T.next=2,i.layerService.renderTileLayer(x);case 2:case"end":return T.stop()}},y)}));return function(y){return h.apply(this,arguments)}}()),c.next=4,Promise.all(a);case 4:case"end":return c.stop()}},n,this)}));function r(){return t.apply(this,arguments)}return r}()},{key:"getRenderLayers",value:function(){var r=this.layerTiles.filter(function(i){return i.visible&&i.isLoaded}),n=[];return r.map(function(i){return n.push.apply(n,cn(i.getLayers()))}),n}},{key:"getLayers",value:function(){var r=this.layerTiles.filter(function(i){return i.isLoaded}),n=[];return r.map(function(i){return n.push.apply(n,cn(i.getLayers()))}),n}},{key:"getTiles",value:function(){return this.layerTiles}},{key:"destroy",value:function(){this.layerTiles.forEach(function(r){return r.destroy()}),this.tileResource.clear()}}]),e}();/**
 * splaytree v3.1.2
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function mZ(e,t){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,a;return a={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function u(h){return function(y){return c([h,y])}}function c(h){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(o=h[0]&2?i.return:h[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,h[1])).done)return o;switch(i=0,o&&(h=[h[0]&2,o.value]),h[0]){case 0:case 1:o=h;break;case 4:return r.label++,{value:h[1],done:!1};case 5:r.label++,i=h[1],h=[0];continue;case 7:h=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(h[0]===6||h[0]===2)){r=0;continue}if(h[0]===3&&(!o||h[1]>o[0]&&h[1]<o[3])){r.label=h[1];break}if(h[0]===6&&r.label<o[1]){r.label=o[1],o=h;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(h);break}o[2]&&r.ops.pop(),r.trys.pop();continue}h=t.call(e,r)}catch(y){h=[6,y],i=0}finally{n=o=0}if(h[0]&5)throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}}var kv=function(){function e(t,r){this.next=null,this.key=t,this.data=r,this.left=null,this.right=null}return e}();function gZ(e,t){return e>t?1:e<t?-1:0}function wv(e,t,r){for(var n=new kv(null,null),i=n,o=n;;){var a=r(e,t.key);if(a<0){if(t.left===null)break;if(r(e,t.left.key)<0){var u=t.left;if(t.left=u.right,u.right=t,t=u,t.left===null)break}o.left=t,o=t,t=t.left}else if(a>0){if(t.right===null)break;if(r(e,t.right.key)>0){var u=t.right;if(t.right=u.left,u.left=t,t=u,t.right===null)break}i.right=t,i=t,t=t.right}else break}return i.right=t.left,o.left=t.right,t.left=n.right,t.right=n.left,t}function y2(e,t,r,n){var i=new kv(e,t);if(r===null)return i.left=i.right=null,i;r=wv(e,r,n);var o=n(e,r.key);return o<0?(i.left=r.left,i.right=r,r.left=null):o>=0&&(i.right=r.right,i.left=r,r.right=null),i}function RP(e,t,r){var n=null,i=null;if(t){t=wv(e,t,r);var o=r(t.key,e);o===0?(n=t.left,i=t.right):o<0?(i=t.right,t.right=null,n=t):(n=t.left,t.left=null,i=t)}return{left:n,right:i}}function yZ(e,t,r){return t===null?e:(e===null||(t=wv(e.key,t,r),t.left=e),t)}function Nw(e,t,r,n,i){if(e){n(""+t+(r?"└── ":"├── ")+i(e)+`
`);var o=t+(r?"    ":"│   ");e.left&&Nw(e.left,o,!1,n,i),e.right&&Nw(e.right,o,!0,n,i)}}var MS=function(){function e(t){t===void 0&&(t=gZ),this._root=null,this._size=0,this._comparator=t}return e.prototype.insert=function(t,r){return this._size++,this._root=y2(t,r,this._root,this._comparator)},e.prototype.add=function(t,r){var n=new kv(t,r);this._root===null&&(n.left=n.right=null,this._size++,this._root=n);var i=this._comparator,o=wv(t,this._root,i),a=i(t,o.key);return a===0?this._root=o:(a<0?(n.left=o.left,n.right=o,o.left=null):a>0&&(n.right=o.right,n.left=o,o.right=null),this._size++,this._root=n),this._root},e.prototype.remove=function(t){this._root=this._remove(t,this._root,this._comparator)},e.prototype._remove=function(t,r,n){var i;if(r===null)return null;r=wv(t,r,n);var o=n(t,r.key);return o===0?(r.left===null?i=r.right:(i=wv(t,r.left,n),i.right=r.right),this._size--,i):r},e.prototype.pop=function(){var t=this._root;if(t){for(;t.left;)t=t.left;return this._root=wv(t.key,this._root,this._comparator),this._root=this._remove(t.key,this._root,this._comparator),{key:t.key,data:t.data}}return null},e.prototype.findStatic=function(t){for(var r=this._root,n=this._comparator;r;){var i=n(t,r.key);if(i===0)return r;i<0?r=r.left:r=r.right}return null},e.prototype.find=function(t){return this._root&&(this._root=wv(t,this._root,this._comparator),this._comparator(t,this._root.key)!==0)?null:this._root},e.prototype.contains=function(t){for(var r=this._root,n=this._comparator;r;){var i=n(t,r.key);if(i===0)return!0;i<0?r=r.left:r=r.right}return!1},e.prototype.forEach=function(t,r){for(var n=this._root,i=[],o=!1;!o;)n!==null?(i.push(n),n=n.left):i.length!==0?(n=i.pop(),t.call(r,n),n=n.right):o=!0;return this},e.prototype.range=function(t,r,n,i){for(var o=[],a=this._comparator,u=this._root,c;o.length!==0||u;)if(u)o.push(u),u=u.left;else{if(u=o.pop(),c=a(u.key,r),c>0)break;if(a(u.key,t)>=0&&n.call(i,u))return this;u=u.right}return this},e.prototype.keys=function(){var t=[];return this.forEach(function(r){var n=r.key;return t.push(n)}),t},e.prototype.values=function(){var t=[];return this.forEach(function(r){var n=r.data;return t.push(n)}),t},e.prototype.min=function(){return this._root?this.minNode(this._root).key:null},e.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},e.prototype.minNode=function(t){if(t===void 0&&(t=this._root),t)for(;t.left;)t=t.left;return t},e.prototype.maxNode=function(t){if(t===void 0&&(t=this._root),t)for(;t.right;)t=t.right;return t},e.prototype.at=function(t){for(var r=this._root,n=!1,i=0,o=[];!n;)if(r)o.push(r),r=r.left;else if(o.length>0){if(r=o.pop(),i===t)return r;i++,r=r.right}else n=!0;return null},e.prototype.next=function(t){var r=this._root,n=null;if(t.right){for(n=t.right;n.left;)n=n.left;return n}for(var i=this._comparator;r;){var o=i(t.key,r.key);if(o===0)break;o<0?(n=r,r=r.left):r=r.right}return n},e.prototype.prev=function(t){var r=this._root,n=null;if(t.left!==null){for(n=t.left;n.right;)n=n.right;return n}for(var i=this._comparator;r;){var o=i(t.key,r.key);if(o===0)break;o<0?r=r.left:(n=r,r=r.right)}return n},e.prototype.clear=function(){return this._root=null,this._size=0,this},e.prototype.toList=function(){return xZ(this._root)},e.prototype.load=function(t,r,n){r===void 0&&(r=[]),n===void 0&&(n=!1);var i=t.length,o=this._comparator;if(n&&Uw(t,r,0,i-1,o),this._root===null)this._root=Bw(t,r,0,i),this._size=i;else{var a=bZ(this.toList(),_Z(t,r),o);i=this._size+i,this._root=zw({head:a},0,i)}return this},e.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(e.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),e.prototype.toString=function(t){t===void 0&&(t=function(n){return String(n.key)});var r=[];return Nw(this._root,"",!0,function(n){return r.push(n)},t),r.join("")},e.prototype.update=function(t,r,n){var i=this._comparator,o=RP(t,this._root,i),a=o.left,u=o.right;i(t,r)<0?u=y2(r,n,u,i):a=y2(r,n,a,i),this._root=yZ(a,u,i)},e.prototype.split=function(t){return RP(t,this._root,this._comparator)},e.prototype[Symbol.iterator]=function(){var t,r,n;return mZ(this,function(i){switch(i.label){case 0:t=this._root,r=[],n=!1,i.label=1;case 1:return n?[3,6]:t===null?[3,2]:(r.push(t),t=t.left,[3,5]);case 2:return r.length===0?[3,4]:(t=r.pop(),[4,t]);case 3:return i.sent(),t=t.right,[3,5];case 4:n=!0,i.label=5;case 5:return[3,1];case 6:return[2]}})},e}();function Bw(e,t,r,n){var i=n-r;if(i>0){var o=r+Math.floor(i/2),a=e[o],u=t[o],c=new kv(a,u);return c.left=Bw(e,t,r,o),c.right=Bw(e,t,o+1,n),c}return null}function _Z(e,t){for(var r=new kv(null,null),n=r,i=0;i<e.length;i++)n=n.next=new kv(e[i],t[i]);return n.next=null,r.next}function xZ(e){for(var t=e,r=[],n=!1,i=new kv(null,null),o=i;!n;)t?(r.push(t),t=t.left):r.length>0?(t=o=o.next=r.pop(),t=t.right):n=!0;return o.next=null,i.next}function zw(e,t,r){var n=r-t;if(n>0){var i=t+Math.floor(n/2),o=zw(e,t,i),a=e.head;return a.left=o,e.head=e.head.next,a.right=zw(e,i+1,r),a}return null}function bZ(e,t,r){for(var n=new kv(null,null),i=n,o=e,a=t;o!==null&&a!==null;)r(o.key,a.key)<0?(i.next=o,o=o.next):(i.next=a,a=a.next),i=i.next;return o!==null?i.next=o:a!==null&&(i.next=a),n.next}function Uw(e,t,r,n,i){if(!(r>=n)){for(var o=e[r+n>>1],a=r-1,u=n+1;;){do a++;while(i(e[a],o)<0);do u--;while(i(e[u],o)>0);if(a>=u)break;var c=e[a];e[a]=e[u],e[u]=c,c=t[a],t[a]=t[u],t[u]=c}Uw(e,t,r,u,i),Uw(e,t,u+1,n,i)}}const Ld=11102230246251565e-32,Ol=134217729,wZ=(3+8*Ld)*Ld;function _2(e,t,r,n,i){let o,a,u,c,h=t[0],y=n[0],x=0,E=0;y>h==y>-h?(o=h,h=t[++x]):(o=y,y=n[++E]);let T=0;if(x<e&&E<r)for(y>h==y>-h?(a=h+o,u=o-(a-h),h=t[++x]):(a=y+o,u=o-(a-y),y=n[++E]),o=a,u!==0&&(i[T++]=u);x<e&&E<r;)y>h==y>-h?(a=o+h,c=a-o,u=o-(a-c)+(h-c),h=t[++x]):(a=o+y,c=a-o,u=o-(a-c)+(y-c),y=n[++E]),o=a,u!==0&&(i[T++]=u);for(;x<e;)a=o+h,c=a-o,u=o-(a-c)+(h-c),h=t[++x],o=a,u!==0&&(i[T++]=u);for(;E<r;)a=o+y,c=a-o,u=o-(a-c)+(y-c),y=n[++E],o=a,u!==0&&(i[T++]=u);return(o!==0||T===0)&&(i[T++]=o),T}function EZ(e,t){let r=t[0];for(let n=1;n<e;n++)r+=t[n];return r}function w_(e){return new Float64Array(e)}const SZ=(3+16*Ld)*Ld,AZ=(2+12*Ld)*Ld,TZ=(9+64*Ld)*Ld*Ld,A0=w_(4),LP=w_(8),kP=w_(12),OP=w_(16),ec=w_(4);function CZ(e,t,r,n,i,o,a){let u,c,h,y,x,E,T,I,k,D,V,O,F,N,H,q,Y,ee;const pe=e-i,ue=r-i,ie=t-o,xe=n-o;N=pe*xe,E=Ol*pe,T=E-(E-pe),I=pe-T,E=Ol*xe,k=E-(E-xe),D=xe-k,H=I*D-(N-T*k-I*k-T*D),q=ie*ue,E=Ol*ie,T=E-(E-ie),I=ie-T,E=Ol*ue,k=E-(E-ue),D=ue-k,Y=I*D-(q-T*k-I*k-T*D),V=H-Y,x=H-V,A0[0]=H-(V+x)+(x-Y),O=N+V,x=O-N,F=N-(O-x)+(V-x),V=F-q,x=F-V,A0[1]=F-(V+x)+(x-q),ee=O+V,x=ee-O,A0[2]=O-(ee-x)+(V-x),A0[3]=ee;let Se=EZ(4,A0),Ne=AZ*a;if(Se>=Ne||-Se>=Ne||(x=e-pe,u=e-(pe+x)+(x-i),x=r-ue,h=r-(ue+x)+(x-i),x=t-ie,c=t-(ie+x)+(x-o),x=n-xe,y=n-(xe+x)+(x-o),u===0&&c===0&&h===0&&y===0)||(Ne=TZ*a+wZ*Math.abs(Se),Se+=pe*y+xe*u-(ie*h+ue*c),Se>=Ne||-Se>=Ne))return Se;N=u*xe,E=Ol*u,T=E-(E-u),I=u-T,E=Ol*xe,k=E-(E-xe),D=xe-k,H=I*D-(N-T*k-I*k-T*D),q=c*ue,E=Ol*c,T=E-(E-c),I=c-T,E=Ol*ue,k=E-(E-ue),D=ue-k,Y=I*D-(q-T*k-I*k-T*D),V=H-Y,x=H-V,ec[0]=H-(V+x)+(x-Y),O=N+V,x=O-N,F=N-(O-x)+(V-x),V=F-q,x=F-V,ec[1]=F-(V+x)+(x-q),ee=O+V,x=ee-O,ec[2]=O-(ee-x)+(V-x),ec[3]=ee;const ze=_2(4,A0,4,ec,LP);N=pe*y,E=Ol*pe,T=E-(E-pe),I=pe-T,E=Ol*y,k=E-(E-y),D=y-k,H=I*D-(N-T*k-I*k-T*D),q=ie*h,E=Ol*ie,T=E-(E-ie),I=ie-T,E=Ol*h,k=E-(E-h),D=h-k,Y=I*D-(q-T*k-I*k-T*D),V=H-Y,x=H-V,ec[0]=H-(V+x)+(x-Y),O=N+V,x=O-N,F=N-(O-x)+(V-x),V=F-q,x=F-V,ec[1]=F-(V+x)+(x-q),ee=O+V,x=ee-O,ec[2]=O-(ee-x)+(V-x),ec[3]=ee;const Be=_2(ze,LP,4,ec,kP);N=u*y,E=Ol*u,T=E-(E-u),I=u-T,E=Ol*y,k=E-(E-y),D=y-k,H=I*D-(N-T*k-I*k-T*D),q=c*h,E=Ol*c,T=E-(E-c),I=c-T,E=Ol*h,k=E-(E-h),D=h-k,Y=I*D-(q-T*k-I*k-T*D),V=H-Y,x=H-V,ec[0]=H-(V+x)+(x-Y),O=N+V,x=O-N,F=N-(O-x)+(V-x),V=F-q,x=F-V,ec[1]=F-(V+x)+(x-q),ee=O+V,x=ee-O,ec[2]=O-(ee-x)+(V-x),ec[3]=ee;const $e=_2(Be,kP,4,ec,OP);return OP[$e-1]}function MZ(e,t,r,n,i,o){const a=(t-o)*(r-i),u=(e-i)*(n-o),c=a-u,h=Math.abs(a+u);return Math.abs(c)>=SZ*h?c:-CZ(e,t,r,n,i,o,h)}const ay=(e,t)=>e.ll.x<=t.x&&t.x<=e.ur.x&&e.ll.y<=t.y&&t.y<=e.ur.y,Vw=(e,t)=>{if(t.ur.x<e.ll.x||e.ur.x<t.ll.x||t.ur.y<e.ll.y||e.ur.y<t.ll.y)return null;const r=e.ll.x<t.ll.x?t.ll.x:e.ll.x,n=e.ur.x<t.ur.x?e.ur.x:t.ur.x,i=e.ll.y<t.ll.y?t.ll.y:e.ll.y,o=e.ur.y<t.ur.y?e.ur.y:t.ur.y;return{ll:{x:r,y:i},ur:{x:n,y:o}}};let Av=Number.EPSILON;Av===void 0&&(Av=Math.pow(2,-52));const PZ=Av*Av,DP=(e,t)=>{if(-Av<e&&e<Av&&-Av<t&&t<Av)return 0;const r=e-t;return r*r<PZ*e*t?0:e<t?-1:1};class IZ{constructor(){this.reset()}reset(){this.xRounder=new FP,this.yRounder=new FP}round(t,r){return{x:this.xRounder.round(t),y:this.yRounder.round(r)}}}class FP{constructor(){this.tree=new MS,this.round(0)}round(t){const r=this.tree.add(t),n=this.tree.prev(r);if(n!==null&&DP(r.key,n.key)===0)return this.tree.remove(t),n.key;const i=this.tree.next(r);return i!==null&&DP(r.key,i.key)===0?(this.tree.remove(t),i.key):t}}const e_=new IZ,k1=(e,t)=>e.x*t.y-e.y*t.x,rk=(e,t)=>e.x*t.x+e.y*t.y,NP=(e,t,r)=>{const n=MZ(e.x,e.y,t.x,t.y,r.x,r.y);return n>0?-1:n<0?1:0},fx=e=>Math.sqrt(rk(e,e)),RZ=(e,t,r)=>{const n={x:t.x-e.x,y:t.y-e.y},i={x:r.x-e.x,y:r.y-e.y};return k1(i,n)/fx(i)/fx(n)},LZ=(e,t,r)=>{const n={x:t.x-e.x,y:t.y-e.y},i={x:r.x-e.x,y:r.y-e.y};return rk(i,n)/fx(i)/fx(n)},BP=(e,t,r)=>t.y===0?null:{x:e.x+t.x/t.y*(r-e.y),y:r},zP=(e,t,r)=>t.x===0?null:{x:r,y:e.y+t.y/t.x*(r-e.x)},kZ=(e,t,r,n)=>{if(t.x===0)return zP(r,n,e.x);if(n.x===0)return zP(e,t,r.x);if(t.y===0)return BP(r,n,e.y);if(n.y===0)return BP(e,t,r.y);const i=k1(t,n);if(i==0)return null;const o={x:r.x-e.x,y:r.y-e.y},a=k1(o,t)/i,u=k1(o,n)/i,c=e.x+u*t.x,h=r.x+a*n.x,y=e.y+u*t.y,x=r.y+a*n.y,E=(c+h)/2,T=(y+x)/2;return{x:E,y:T}};class Zf{static compare(t,r){const n=Zf.comparePoints(t.point,r.point);return n!==0?n:(t.point!==r.point&&t.link(r),t.isLeft!==r.isLeft?t.isLeft?1:-1:Pv.compare(t.segment,r.segment))}static comparePoints(t,r){return t.x<r.x?-1:t.x>r.x?1:t.y<r.y?-1:t.y>r.y?1:0}constructor(t,r){t.events===void 0?t.events=[this]:t.events.push(this),this.point=t,this.isLeft=r}link(t){if(t.point===this.point)throw new Error("Tried to link already linked events");const r=t.point.events;for(let n=0,i=r.length;n<i;n++){const o=r[n];this.point.events.push(o),o.point=this.point}this.checkForConsuming()}checkForConsuming(){const t=this.point.events.length;for(let r=0;r<t;r++){const n=this.point.events[r];if(n.segment.consumedBy===void 0)for(let i=r+1;i<t;i++){const o=this.point.events[i];o.consumedBy===void 0&&n.otherSE.point.events===o.otherSE.point.events&&n.segment.consume(o.segment)}}}getAvailableLinkedEvents(){const t=[];for(let r=0,n=this.point.events.length;r<n;r++){const i=this.point.events[r];i!==this&&!i.segment.ringOut&&i.segment.isInResult()&&t.push(i)}return t}getLeftmostComparator(t){const r=new Map,n=i=>{const o=i.otherSE;r.set(i,{sine:RZ(this.point,t.point,o.point),cosine:LZ(this.point,t.point,o.point)})};return(i,o)=>{r.has(i)||n(i),r.has(o)||n(o);const{sine:a,cosine:u}=r.get(i),{sine:c,cosine:h}=r.get(o);return a>=0&&c>=0?u<h?1:u>h?-1:0:a<0&&c<0?u<h?-1:u>h?1:0:c<a?-1:c>a?1:0}}}let OZ=0;class Pv{static compare(t,r){const n=t.leftSE.point.x,i=r.leftSE.point.x,o=t.rightSE.point.x,a=r.rightSE.point.x;if(a<n)return 1;if(o<i)return-1;const u=t.leftSE.point.y,c=r.leftSE.point.y,h=t.rightSE.point.y,y=r.rightSE.point.y;if(n<i){if(c<u&&c<h)return 1;if(c>u&&c>h)return-1;const x=t.comparePoint(r.leftSE.point);if(x<0)return 1;if(x>0)return-1;const E=r.comparePoint(t.rightSE.point);return E!==0?E:-1}if(n>i){if(u<c&&u<y)return-1;if(u>c&&u>y)return 1;const x=r.comparePoint(t.leftSE.point);if(x!==0)return x;const E=t.comparePoint(r.rightSE.point);return E<0?1:E>0?-1:1}if(u<c)return-1;if(u>c)return 1;if(o<a){const x=r.comparePoint(t.rightSE.point);if(x!==0)return x}if(o>a){const x=t.comparePoint(r.rightSE.point);if(x<0)return 1;if(x>0)return-1}if(o!==a){const x=h-u,E=o-n,T=y-c,I=a-i;if(x>E&&T<I)return 1;if(x<E&&T>I)return-1}return o>a?1:o<a||h<y?-1:h>y?1:t.id<r.id?-1:t.id>r.id?1:0}constructor(t,r,n,i){this.id=++OZ,this.leftSE=t,t.segment=this,t.otherSE=r,this.rightSE=r,r.segment=this,r.otherSE=t,this.rings=n,this.windings=i}static fromRing(t,r,n){let i,o,a;const u=Zf.comparePoints(t,r);if(u<0)i=t,o=r,a=1;else if(u>0)i=r,o=t,a=-1;else throw new Error(`Tried to create degenerate segment at [${t.x}, ${t.y}]`);const c=new Zf(i,!0),h=new Zf(o,!1);return new Pv(c,h,[n],[a])}replaceRightSE(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const t=this.leftSE.point.y,r=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<r?t:r},ur:{x:this.rightSE.point.x,y:t>r?t:r}}}vector(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}isAnEndpoint(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}comparePoint(t){if(this.isAnEndpoint(t))return 0;const r=this.leftSE.point,n=this.rightSE.point,i=this.vector();if(r.x===n.x)return t.x===r.x?0:t.x<r.x?1:-1;const o=(t.y-r.y)/i.y,a=r.x+o*i.x;if(t.x===a)return 0;const u=(t.x-r.x)/i.x,c=r.y+u*i.y;return t.y===c?0:t.y<c?-1:1}getIntersection(t){const r=this.bbox(),n=t.bbox(),i=Vw(r,n);if(i===null)return null;const o=this.leftSE.point,a=this.rightSE.point,u=t.leftSE.point,c=t.rightSE.point,h=ay(r,u)&&this.comparePoint(u)===0,y=ay(n,o)&&t.comparePoint(o)===0,x=ay(r,c)&&this.comparePoint(c)===0,E=ay(n,a)&&t.comparePoint(a)===0;if(y&&h)return E&&!x?a:!E&&x?c:null;if(y)return x&&o.x===c.x&&o.y===c.y?null:o;if(h)return E&&a.x===u.x&&a.y===u.y?null:u;if(E&&x)return null;if(E)return a;if(x)return c;const T=kZ(o,this.vector(),u,t.vector());return T===null||!ay(i,T)?null:e_.round(T.x,T.y)}split(t){const r=[],n=t.events!==void 0,i=new Zf(t,!0),o=new Zf(t,!1),a=this.rightSE;this.replaceRightSE(o),r.push(o),r.push(i);const u=new Pv(i,a,this.rings.slice(),this.windings.slice());return Zf.comparePoints(u.leftSE.point,u.rightSE.point)>0&&u.swapEvents(),Zf.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),n&&(i.checkForConsuming(),o.checkForConsuming()),r}swapEvents(){const t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let r=0,n=this.windings.length;r<n;r++)this.windings[r]*=-1}consume(t){let r=this,n=t;for(;r.consumedBy;)r=r.consumedBy;for(;n.consumedBy;)n=n.consumedBy;const i=Pv.compare(r,n);if(i!==0){if(i>0){const o=r;r=n,n=o}if(r.prev===n){const o=r;r=n,n=o}for(let o=0,a=n.rings.length;o<a;o++){const u=n.rings[o],c=n.windings[o],h=r.rings.indexOf(u);h===-1?(r.rings.push(u),r.windings.push(c)):r.windings[h]+=c}n.rings=null,n.windings=null,n.consumedBy=r,n.leftSE.consumedBy=r.leftSE,n.rightSE.consumedBy=r.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};const r=this._afterState.rings,n=this._afterState.windings,i=this._afterState.multiPolys;for(let u=0,c=this.rings.length;u<c;u++){const h=this.rings[u],y=this.windings[u],x=r.indexOf(h);x===-1?(r.push(h),n.push(y)):n[x]+=y}const o=[],a=[];for(let u=0,c=r.length;u<c;u++){if(n[u]===0)continue;const h=r[u],y=h.poly;if(a.indexOf(y)===-1)if(h.isExterior)o.push(y);else{a.indexOf(y)===-1&&a.push(y);const x=o.indexOf(h.poly);x!==-1&&o.splice(x,1)}}for(let u=0,c=o.length;u<c;u++){const h=o[u].multiPoly;i.indexOf(h)===-1&&i.push(h)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const t=this.beforeState().multiPolys,r=this.afterState().multiPolys;switch(Xh.type){case"union":{const n=t.length===0,i=r.length===0;this._isInResult=n!==i;break}case"intersection":{let n,i;t.length<r.length?(n=t.length,i=r.length):(n=r.length,i=t.length),this._isInResult=i===Xh.numMultiPolys&&n<i;break}case"xor":{const n=Math.abs(t.length-r.length);this._isInResult=n%2===1;break}case"difference":{const n=i=>i.length===1&&i[0].isSubject;this._isInResult=n(t)!==n(r);break}default:throw new Error(`Unrecognized operation type found ${Xh.type}`)}return this._isInResult}}class UP{constructor(t,r,n){if(!Array.isArray(t)||t.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=r,this.isExterior=n,this.segments=[],typeof t[0][0]!="number"||typeof t[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const i=e_.round(t[0][0],t[0][1]);this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};let o=i;for(let a=1,u=t.length;a<u;a++){if(typeof t[a][0]!="number"||typeof t[a][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let c=e_.round(t[a][0],t[a][1]);c.x===o.x&&c.y===o.y||(this.segments.push(Pv.fromRing(o,c,this)),c.x<this.bbox.ll.x&&(this.bbox.ll.x=c.x),c.y<this.bbox.ll.y&&(this.bbox.ll.y=c.y),c.x>this.bbox.ur.x&&(this.bbox.ur.x=c.x),c.y>this.bbox.ur.y&&(this.bbox.ur.y=c.y),o=c)}(i.x!==o.x||i.y!==o.y)&&this.segments.push(Pv.fromRing(o,i,this))}getSweepEvents(){const t=[];for(let r=0,n=this.segments.length;r<n;r++){const i=this.segments[r];t.push(i.leftSE),t.push(i.rightSE)}return t}}class DZ{constructor(t,r){if(!Array.isArray(t))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new UP(t[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let n=1,i=t.length;n<i;n++){const o=new UP(t[n],this,!1);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.interiorRings.push(o)}this.multiPoly=r}getSweepEvents(){const t=this.exteriorRing.getSweepEvents();for(let r=0,n=this.interiorRings.length;r<n;r++){const i=this.interiorRings[r].getSweepEvents();for(let o=0,a=i.length;o<a;o++)t.push(i[o])}return t}}class VP{constructor(t,r){if(!Array.isArray(t))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof t[0][0][0]=="number"&&(t=[t])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(let n=0,i=t.length;n<i;n++){const o=new DZ(t[n],this);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.polys.push(o)}this.isSubject=r}getSweepEvents(){const t=[];for(let r=0,n=this.polys.length;r<n;r++){const i=this.polys[r].getSweepEvents();for(let o=0,a=i.length;o<a;o++)t.push(i[o])}return t}}class hx{static factory(t){const r=[];for(let n=0,i=t.length;n<i;n++){const o=t[n];if(!o.isInResult()||o.ringOut)continue;let a=null,u=o.leftSE,c=o.rightSE;const h=[u],y=u.point,x=[];for(;a=u,u=c,h.push(u),u.point!==y;)for(;;){const E=u.getAvailableLinkedEvents();if(E.length===0){const k=h[0].point,D=h[h.length-1].point;throw new Error(`Unable to complete output ring starting at [${k.x}, ${k.y}]. Last matching segment found ends at [${D.x}, ${D.y}].`)}if(E.length===1){c=E[0].otherSE;break}let T=null;for(let k=0,D=x.length;k<D;k++)if(x[k].point===u.point){T=k;break}if(T!==null){const k=x.splice(T)[0],D=h.splice(k.index);D.unshift(D[0].otherSE),r.push(new hx(D.reverse()));continue}x.push({index:h.length,point:u.point});const I=u.getLeftmostComparator(a);c=E.sort(I)[0].otherSE;break}r.push(new hx(h))}return r}constructor(t){this.events=t;for(let r=0,n=t.length;r<n;r++)t[r].segment.ringOut=this;this.poly=null}getGeom(){let t=this.events[0].point;const r=[t];for(let h=1,y=this.events.length-1;h<y;h++){const x=this.events[h].point,E=this.events[h+1].point;NP(x,t,E)!==0&&(r.push(x),t=x)}if(r.length===1)return null;const n=r[0],i=r[1];NP(n,t,i)===0&&r.shift(),r.push(r[0]);const o=this.isExteriorRing()?1:-1,a=this.isExteriorRing()?0:r.length-1,u=this.isExteriorRing()?r.length:-1,c=[];for(let h=a;h!=u;h+=o)c.push([r[h].x,r[h].y]);return c}isExteriorRing(){if(this._isExteriorRing===void 0){const t=this.enclosingRing();this._isExteriorRing=t?!t.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let t=this.events[0];for(let i=1,o=this.events.length;i<o;i++){const a=this.events[i];Zf.compare(t,a)>0&&(t=a)}let r=t.segment.prevInResult(),n=r?r.prevInResult():null;for(;;){if(!r)return null;if(!n)return r.ringOut;if(n.ringOut!==r.ringOut)return n.ringOut.enclosingRing()!==r.ringOut?r.ringOut:r.ringOut.enclosingRing();r=n.prevInResult(),n=r?r.prevInResult():null}}}class jP{constructor(t){this.exteriorRing=t,t.poly=this,this.interiorRings=[]}addInterior(t){this.interiorRings.push(t),t.poly=this}getGeom(){const t=[this.exteriorRing.getGeom()];if(t[0]===null)return null;for(let r=0,n=this.interiorRings.length;r<n;r++){const i=this.interiorRings[r].getGeom();i!==null&&t.push(i)}return t}}class FZ{constructor(t){this.rings=t,this.polys=this._composePolys(t)}getGeom(){const t=[];for(let r=0,n=this.polys.length;r<n;r++){const i=this.polys[r].getGeom();i!==null&&t.push(i)}return t}_composePolys(t){const r=[];for(let n=0,i=t.length;n<i;n++){const o=t[n];if(!o.poly)if(o.isExteriorRing())r.push(new jP(o));else{const a=o.enclosingRing();a.poly||r.push(new jP(a)),a.poly.addInterior(o)}}return r}}class NZ{constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Pv.compare;this.queue=t,this.tree=new MS(r),this.segments=[]}process(t){const r=t.segment,n=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(r),n;const i=t.isLeft?this.tree.add(r):this.tree.find(r);if(!i)throw new Error(`Unable to find segment #${r.id} [${r.leftSE.point.x}, ${r.leftSE.point.y}] -> [${r.rightSE.point.x}, ${r.rightSE.point.y}] in SweepLine tree.`);let o=i,a=i,u,c;for(;u===void 0;)o=this.tree.prev(o),o===null?u=null:o.key.consumedBy===void 0&&(u=o.key);for(;c===void 0;)a=this.tree.next(a),a===null?c=null:a.key.consumedBy===void 0&&(c=a.key);if(t.isLeft){let h=null;if(u){const x=u.getIntersection(r);if(x!==null&&(r.isAnEndpoint(x)||(h=x),!u.isAnEndpoint(x))){const E=this._splitSafely(u,x);for(let T=0,I=E.length;T<I;T++)n.push(E[T])}}let y=null;if(c){const x=c.getIntersection(r);if(x!==null&&(r.isAnEndpoint(x)||(y=x),!c.isAnEndpoint(x))){const E=this._splitSafely(c,x);for(let T=0,I=E.length;T<I;T++)n.push(E[T])}}if(h!==null||y!==null){let x=null;h===null?x=y:y===null?x=h:x=Zf.comparePoints(h,y)<=0?h:y,this.queue.remove(r.rightSE),n.push(r.rightSE);const E=r.split(x);for(let T=0,I=E.length;T<I;T++)n.push(E[T])}n.length>0?(this.tree.remove(r),n.push(t)):(this.segments.push(r),r.prev=u)}else{if(u&&c){const h=u.getIntersection(c);if(h!==null){if(!u.isAnEndpoint(h)){const y=this._splitSafely(u,h);for(let x=0,E=y.length;x<E;x++)n.push(y[x])}if(!c.isAnEndpoint(h)){const y=this._splitSafely(c,h);for(let x=0,E=y.length;x<E;x++)n.push(y[x])}}}this.tree.remove(r)}return n}_splitSafely(t,r){this.tree.remove(t);const n=t.rightSE;this.queue.remove(n);const i=t.split(r);return i.push(n),t.consumedBy===void 0&&this.tree.add(t),i}}const $P=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,BZ=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6;class zZ{run(t,r,n){Xh.type=t,e_.reset();const i=[new VP(r,!0)];for(let x=0,E=n.length;x<E;x++)i.push(new VP(n[x],!1));if(Xh.numMultiPolys=i.length,Xh.type==="difference"){const x=i[0];let E=1;for(;E<i.length;)Vw(i[E].bbox,x.bbox)!==null?E++:i.splice(E,1)}if(Xh.type==="intersection")for(let x=0,E=i.length;x<E;x++){const T=i[x];for(let I=x+1,k=i.length;I<k;I++)if(Vw(T.bbox,i[I].bbox)===null)return[]}const o=new MS(Zf.compare);for(let x=0,E=i.length;x<E;x++){const T=i[x].getSweepEvents();for(let I=0,k=T.length;I<k;I++)if(o.insert(T[I]),o.size>$P)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big).")}const a=new NZ(o);let u=o.size,c=o.pop();for(;c;){const x=c.key;if(o.size===u){const T=x.segment;throw new Error(`Unable to pop() ${x.isLeft?"left":"right"} SweepEvent [${x.point.x}, ${x.point.y}] from segment #${T.id} [${T.leftSE.point.x}, ${T.leftSE.point.y}] -> [${T.rightSE.point.x}, ${T.rightSE.point.y}] from queue.`)}if(o.size>$P)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big).");if(a.segments.length>BZ)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments).");const E=a.process(x);for(let T=0,I=E.length;T<I;T++){const k=E[T];k.consumedBy===void 0&&o.insert(k)}u=o.size,c=o.pop()}e_.reset();const h=hx.factory(a.segments);return new FZ(h).getGeom()}}const Xh=new zZ,UZ=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return Xh.run("union",e,r)},VZ=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return Xh.run("intersection",e,r)},jZ=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return Xh.run("xor",e,r)},$Z=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return Xh.run("difference",e,r)};var GZ={union:UZ,intersection:VZ,xor:jZ,difference:$Z};function HZ(e,t,r){r===void 0&&(r={});var n=G0(e),i=G0(t),o=GZ.union(n.coordinates,i.coordinates);return o.length===0?null:o.length===1?Um(o[0],r.properties):ME(o,r.properties)}var WZ=function(){function e(){$t(this,e)}return Gt(e,[{key:"getCombineFeature",value:function(r){var n=null,i=r[0];return r.map(function(o){var a=Um(o.coordinates);n===null?n=a:n=HZ(n,a)}),i&&(n.properties=_t({},i)),n}}]),e}(),oy="select",sy="active",XZ=function(){function e(t){var r=t.layerService,n=t.tileLayerService,i=t.parent;$t(this,e),Q(this,"tilePickID",new Map),this.layerService=r,this.tileLayerService=n,this.parent=i,this.tileSourceService=new WZ}return Gt(e,[{key:"pickRender",value:function(r){var n=this.tileLayerService.getVisibleTileBylngLat(r.lngLat);if(n){var i=n.getMainLayer();i==null||i.layerPickService.pickRender(r)}}},{key:"pick",value:function(r,n){var i=this.parent.getContainer(),o=i.get(Mt.IPickingService);if(r.type==="RasterLayer"){var a=this.tileLayerService.getVisibleTileBylngLat(n.lngLat);if(a&&a.getMainLayer()!==void 0){var u=a.getMainLayer();return u.layerPickService.pickRasterLayer(u,n,this.parent)}return!1}return this.pickRender(n),o.pickFromPickingFBO(r,n)}},{key:"selectFeature",value:function(r){var n=ei(r,3),i=n[0],o=n[1],a=n[2],u=this.color2PickId(i,o,a);this.tilePickID.set(oy,u),this.updateHighLight(i,o,a,oy)}},{key:"highlightPickedFeature",value:function(r){var n=ei(r,3),i=n[0],o=n[1],a=n[2],u=this.color2PickId(i,o,a);this.tilePickID.set(sy,u),this.updateHighLight(i,o,a,sy)}},{key:"updateHighLight",value:function(r,n,i,o){this.tileLayerService.tiles.map(function(a){var u=a.getMainLayer();switch(o){case oy:u==null||u.hooks.beforeSelect.call([r,n,i]);break;case sy:u==null||u.hooks.beforeHighlight.call([r,n,i]);break}})}},{key:"setPickState",value:function(){var r=this.tilePickID.get(oy),n=this.tilePickID.get(sy);if(r){var i=this.pickId2Color(r),o=ei(i,3),a=o[0],u=o[1],c=o[2];this.updateHighLight(a,u,c,oy);return}if(n){var h=this.pickId2Color(n),y=ei(h,3),x=y[0],E=y[1],T=y[2];this.updateHighLight(x,E,T,sy);return}}},{key:"color2PickId",value:function(r,n,i){return Pm(new Uint8Array([r,n,i]))}},{key:"pickId2Color",value:function(r){return Dd(r)}},{key:"getFeatureById",value:function(r){var n=this.tileLayerService.getTiles().filter(function(o){return o.visible}),i=[];return n.forEach(function(o){i.push.apply(i,cn(o.getFeatureById(r)))}),i}},{key:"pickRasterLayer",value:function(r,n,i){return!1}}]),e}(),YZ=["shape","color","size","style","animate","filter","rotate","scale","setBlend","setSelect","setActive","disableMask","enableMask"];function qZ(e){return e==="PolygonLayer"?Xx:e==="LineLayer"?x_:Fm}function ZZ(e){return["PolygonLayer","LineLayer"].indexOf(e)!==-1}var Gm=function(){function e(t,r){$t(this,e),Q(this,"visible",!0),Q(this,"layers",[]),Q(this,"isLoaded",!1),Q(this,"tileMaskLayers",[]),this.parent=r,this.sourceTile=t,this.x=t.x,this.y=t.y,this.z=t.z,this.key="".concat(this.x,"_").concat(this.y,"_").concat(this.z)}return Gt(e,[{key:"getLayers",value:function(){return this.layers}},{key:"styleUpdate",value:function(){}},{key:"lnglatInBounds",value:function(r){var n=ei(this.sourceTile.bounds,4),i=n[0],o=n[1],a=n[2],u=n[3],c=r.lng,h=r.lat;return c>=i&&c<=a&&h>=o&&h<=u}},{key:"getLayerOptions",value:function(){var r,n=this.parent.getLayerConfig();return _t(_t({},n),{},{textAllowOverlap:!0,autoFit:!1,maskLayers:this.getMaskLayer(),tileMask:ZZ(this.parent.type),mask:n.mask||((r=n.maskLayers)===null||r===void 0?void 0:r.length)!==0&&n.enableMask})}},{key:"getMaskLayer",value:function(){var r=this,n=this.parent.getLayerConfig(),i=n.maskLayers,o=[];return i==null||i.forEach(function(a){if(!a.tileLayer)return o.push(a),a;var u=a.tileLayer,c=u.getTile(r.sourceTile.key),h=c==null?void 0:c.getLayers()[0];h&&o.push(h)}),o}},{key:"addTileMask",value:function(){var t=Vt(Ce.mark(function n(){var i,o,a;return Ce.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return i=new Xx({visible:!1,enablePicking:!1}).source({type:"FeatureCollection",features:[this.sourceTile.bboxPolygon]},{parser:{type:"geojson",featureId:"id"}}).shape("fill"),o=Ty(this.parent.sceneContainer),i.setContainer(o,this.parent.sceneContainer),c.next=5,i.init();case 5:return this.tileMask=i,a=this.getMainLayer(),a!==void 0&&(a.tileMask=i),c.abrupt("return",i);case 9:case"end":return c.stop()}},n,this)}));function r(){return t.apply(this,arguments)}return r}()},{key:"addMask",value:function(){var t=Vt(Ce.mark(function n(i,o){var a;return Ce.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return a=Ty(this.parent.sceneContainer),o.setContainer(a,this.parent.sceneContainer),c.next=4,o.init();case 4:i.addMask(o),this.tileMaskLayers.push(o);case 6:case"end":return c.stop()}},n,this)}));function r(n,i){return t.apply(this,arguments)}return r}()},{key:"addLayer",value:function(){var t=Vt(Ce.mark(function n(i){var o;return Ce.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return i.isTileLayer=!0,o=Ty(this.parent.sceneContainer),i.setContainer(o,this.parent.sceneContainer),this.layers.push(i),u.next=6,i.init();case 6:case"end":return u.stop()}},n,this)}));function r(n){return t.apply(this,arguments)}return r}()},{key:"updateVisible",value:function(r){this.visible=r,this.updateOptions("visible",r)}},{key:"updateOptions",value:function(r,n){this.layers.forEach(function(i){i.updateLayerConfig(Q({},r,n))})}},{key:"getMainLayer",value:function(){return this.layers[0]}},{key:"getFeatures",value:function(r){return[]}},{key:"getFeatureById",value:function(r){return[]}},{key:"destroy",value:function(){var r;(r=this.tileMask)===null||r===void 0||r.destroy(),this.layers.forEach(function(n){return n.destroy()})}}]),e}();function KZ(e){var t=QZ();return function(){var n=Ct(e),i;if(t){var o=Ct(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xn(this,i)}}function QZ(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var JZ=function(e){yn(r,e);var t=KZ(r);function r(){return $t(this,r),t.apply(this,arguments)}return Gt(r,[{key:"initTileLayer",value:function(){var n=Vt(Ce.mark(function o(){var a,u,c,h;return Ce.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return a=this.getSourceOption(),u=a.data.features[0].properties,c=new x_().source(a.data,a.options).size(1).shape("line").color("red"),h=new Fm({minZoom:this.z-1,maxZoom:this.z+1,textAllowOverlap:!0}).source([u],{parser:{type:"json",x:"x",y:"y"}}).size(20).color("red").shape(this.key).style({stroke:"#fff",strokeWidth:2}),x.next=6,this.addLayer(c);case 6:return x.next=8,this.addLayer(h);case 8:this.isLoaded=!0;case 9:case"end":return x.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getSourceOption",value:function(){var i=this.parent.getSource(),o=this.sourceTile.data.layers.testTile.features;return{data:{type:"FeatureCollection",features:o},options:{parser:{type:"geojson"},transforms:i.transforms}}}}]),r}(Gm);function eK(e){var t=tK();return function(){var n=Ct(e),i;if(t){var o=Ct(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xn(this,i)}}function tK(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var rK=function(e){yn(r,e);var t=eK(r);function r(){return $t(this,r),t.apply(this,arguments)}return Gt(r,[{key:"initTileLayer",value:function(){var n=Vt(Ce.mark(function o(){var a,u,c,h;return Ce.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return a=this.parent.getLayerAttributeConfig(),u=this.getLayerOptions(),c=this.getSourceOption(),h=new uL(_t({},u)).source(c.data,c.options),a&&Object.keys(a).forEach(function(E){var T,I,k=E;h[k]((T=a[k])===null||T===void 0?void 0:T.field,(I=a[k])===null||I===void 0?void 0:I.values)}),x.next=7,this.addLayer(h);case 7:this.isLoaded=!0;case 8:case"end":return x.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getSourceOption",value:function(){var i=this.parent.getSource();return{data:this.sourceTile.data,options:{parser:{type:"image",extent:this.sourceTile.bounds},transforms:i.transforms}}}}]),r}(Gm);function nK(e){var t=iK();return function(){var n=Ct(e),i;if(t){var o=Ct(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xn(this,i)}}function iK(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var aK=function(e){yn(r,e);var t=nK(r);function r(){return $t(this,r),t.apply(this,arguments)}return Gt(r,[{key:"initTileLayer",value:function(){var n=Vt(Ce.mark(function o(){var a,u,c,h;return Ce.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return a=this.parent.getLayerAttributeConfig(),u=this.getLayerOptions(),c=this.getSourceOption(),h=new _L(_t({},u)).source(c.data,c.options),a&&Object.keys(a).forEach(function(E){var T,I,k=E;h[k]((T=a[k])===null||T===void 0?void 0:T.field,(I=a[k])===null||I===void 0?void 0:I.values)}),x.next=7,this.addLayer(h);case 7:this.isLoaded=!0;case 8:case"end":return x.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getFeatures",value:function(i){if(!i)return[];var o=this.sourceTile.data;return o.getTileData(i)}},{key:"getSourceOption",value:function(){var i=this.parent.getSource(),o=this.parent.getLayerConfig(),a=o.sourceLayer,u=o.featureId,c=this.getFeatures(a);return{data:{type:"FeatureCollection",features:c},options:{parser:{type:"geojson",featureId:u},transforms:i.transforms}}}}]),r}(Gm),oK=["rasterData"];function sK(e){var t=uK();return function(){var n=Ct(e),i;if(t){var o=Ct(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xn(this,i)}}function uK(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var lK=function(e){yn(r,e);var t=sK(r);function r(){return $t(this,r),t.apply(this,arguments)}return Gt(r,[{key:"initTileLayer",value:function(){var n=Vt(Ce.mark(function o(){var a,u,c,h;return Ce.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return a=this.parent.getLayerAttributeConfig(),u=this.getLayerOptions(),c=this.getSourceOption(),h=new gS(_t({},u)).source(c.data,c.options),a&&Object.keys(a).forEach(function(E){var T,I,k=E;h[k]((T=a[k])===null||T===void 0?void 0:T.field,(I=a[k])===null||I===void 0?void 0:I.values)}),x.next=7,this.addLayer(h);case 7:this.isLoaded=!0;case 8:case"end":return x.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getSourceOption",value:function(){var i=this.parent.getSource(),o=this.sourceTile.data.data,a=o.rasterData,u=Zh(o,oK);return{data:a,options:{parser:_t({type:"rasterRgb",extent:this.sourceTile.bounds},u),transforms:i.transforms}}}}]),r}(Gm);function cK(e){var t=fK();return function(){var n=Ct(e),i;if(t){var o=Ct(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xn(this,i)}}function fK(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var hK=function(e){yn(r,e);var t=cK(r);function r(){return $t(this,r),t.apply(this,arguments)}return Gt(r,[{key:"initTileLayer",value:function(){var n=Vt(Ce.mark(function o(){var a,u,c,h;return Ce.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return a=this.parent.getLayerAttributeConfig(),u=this.getLayerOptions(),c=this.getSourceOption(),h=new gS(_t({},u)).source(c.data,c.options),a&&Object.keys(a).forEach(function(E){var T,I,k=E;h[k]((T=a[k])===null||T===void 0?void 0:T.field,(I=a[k])===null||I===void 0?void 0:I.values)}),x.next=7,this.addLayer(h);case 7:this.isLoaded=!0;case 8:case"end":return x.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getSourceOption",value:function(){var i=this.parent.getSource();return{data:this.sourceTile.data,options:{parser:{type:"image",extent:this.sourceTile.bounds},transforms:i.transforms}}}}]),r}(Gm),pK=["rasterData"];function dK(e){var t=vK();return function(){var n=Ct(e),i;if(t){var o=Ct(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xn(this,i)}}function vK(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var mK={positions:[0,1],colors:["#000","#fff"]},gK=function(e){yn(r,e);var t=dK(r);function r(){return $t(this,r),t.apply(this,arguments)}return Gt(r,[{key:"initTileLayer",value:function(){var n=Vt(Ce.mark(function o(){var a,u,c,h,y,x,E;return Ce.wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return a=this.parent.getLayerAttributeConfig(),u=this.getLayerOptions(),c=this.getSourceOption(),h=this.getLayerOptions(),y=h.rampColors,x=h.domain,this.colorTexture=this.parent.textureService.getColorTexture(y,x),E=new gS(_t(_t({},u),{},{colorTexture:this.colorTexture})).source(c.data,c.options),a&&Object.keys(a).forEach(function(k){var D,V,O=k;E[O]((D=a[O])===null||D===void 0?void 0:D.field,(V=a[O])===null||V===void 0?void 0:V.values)}),I.next=9,this.addLayer(E);case 9:this.isLoaded=!0;case 10:case"end":return I.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getSourceOption",value:function(){var i=this.parent.getSource(),o=this.sourceTile.data.data,a=o.rasterData,u=Zh(o,pK);return{data:a,options:{parser:_t({type:"raster",extent:this.sourceTile.bounds},u),transforms:i.transforms}}}},{key:"styleUpdate",value:function(){for(var i=this,o=arguments.length,a=new Array(o),u=0;u<o;u++)a[u]=arguments[u];var c=a,h=c.rampColors,y=h===void 0?mK:h,x=c.domain;this.colorTexture=this.parent.textureService.getColorTexture(y,x||BE(y)),this.layers.forEach(function(E){return E.style({colorTexture:i.colorTexture})})}},{key:"destroy",value:function(){this.layers.forEach(function(i){return i.destroy()})}}]),r}(Gm);function yK(e){var t=_K();return function(){var n=Ct(e),i;if(t){var o=Ct(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xn(this,i)}}function _K(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var c1=function(e){yn(r,e);var t=yK(r);function r(){return $t(this,r),t.apply(this,arguments)}return Gt(r,[{key:"initTileLayer",value:function(){var n=Vt(Ce.mark(function o(){var a,u,c,h,y;return Ce.wrap(function(E){for(;;)switch(E.prev=E.next){case 0:if(a=this.parent.getLayerAttributeConfig(),u=this.getLayerOptions(),c=qZ(this.parent.type),h=this.getSourceOption(),h){E.next=7;break}return this.isLoaded=!0,E.abrupt("return");case 7:return y=new c(_t({},u)).source(h.data,h.options),Object.keys(a).forEach(function(T){var I,k,D=T;y[D]((I=a[D])===null||I===void 0?void 0:I.field,(k=a[D])===null||k===void 0?void 0:k.values)}),E.next=11,this.addLayer(y);case 11:if(!u.tileMask){E.next=14;break}return E.next=14,this.addTileMask();case 14:this.setLayerMinMaxZoom(y),this.isLoaded=!0;case 16:case"end":return E.stop()}},o,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getSourceOption",value:function(){var i=this.parent.getSource(),o=this.parent.getLayerConfig(),a=o.sourceLayer,u=a===void 0?"defaultLayer":a,c=o.featureId,h=c===void 0?"id":c,y=this.getFeatures(u);return{data:{type:"FeatureCollection",features:y},options:{parser:{type:"geojson",featureId:h},transforms:i.transforms}}}},{key:"setLayerMinMaxZoom",value:function(i){i.getModelType()==="text"&&i.updateLayerConfig({maxZoom:this.z+1,minZoom:this.z-1})}},{key:"getFeatures",value:function(i){var o=this.sourceTile.data;return o.getTileData(i)}},{key:"getFeatureById",value:function(i){var o=this.getMainLayer();if(!o)return[];var a=o.getSource().data.dataArray.filter(function(u){return u._id===i});return a}}]),r}(Gm);function xK(e){var t=e.type;switch(t){case"PolygonLayer":return c1;case"LineLayer":return c1;case"PointLayer":return c1;case"TileDebugLayer":return JZ;case"MaskLayer":return aK;case"RasterLayer":var r=e.getSource().parser.dataType;switch(r){case Eu.RGB:case Eu.CUSTOMRGB:return lK;case Eu.ARRAYBUFFER:case Eu.CUSTOMARRAYBUFFER:return gK;case Eu.TERRAINRGB:case Eu.CUSTOMTERRAINRGB:return hK;default:return rK}default:return c1}}var GP=function(){function e(t){var r=this;$t(this,e),Q(this,"initedTileset",!1),Q(this,"mapchange",function(){var i,o=r.getCurrentView(),a=o.latLonBounds,u=o.zoom;if(r.mapService.version==="GAODE1.x"){var c=r.parent.getLayerConfig(),h=c.visible;u<2&&h?(r.parent.updateLayerConfig({visible:!1}),r.layerService.reRender()):u>=2&&!h&&(r.parent.updateLayerConfig({visible:!0}),r.layerService.reRender())}r.lastViewStates&&r.lastViewStates.zoom===u&&r.lastViewStates.latLonBounds.toString()===a.toString()||(r.lastViewStates={zoom:u,latLonBounds:a},(i=r.tilesetManager)===null||i===void 0||i.throttleUpdate(u,a))}),Q(this,"viewchange",Er.debounce(this.mapchange,24)),this.parent=t;var n=this.parent.getContainer();this.rendererService=n.get(Mt.IRendererService),this.layerService=n.get(Mt.ILayerService),this.mapService=n.get(Mt.IMapService),this.pickingService=n.get(Mt.IPickingService),this.tileLayerService=new vZ({rendererService:this.rendererService,layerService:this.layerService,parent:t}),this.tilePickService=new XZ({tileLayerService:this.tileLayerService,layerService:this.layerService,parent:t}),this.parent.setLayerPickService(this.tilePickService),this.proxy(t),this.initTileSetManager()}return Gt(e,[{key:"initTileSetManager",value:function(){var r,n=this.parent.getSource();this.tilesetManager=n.tileset,this.initedTileset||(this.bindTilesetEvent(),this.initedTileset=!0);var i=this.getCurrentView(),o=i.latLonBounds,a=i.zoom;(r=this.tilesetManager)===null||r===void 0||r.update(a,o)}},{key:"getCurrentView",value:function(){var r=this.mapService.getBounds(),n=[r[0][0],r[0][1],r[1][0],r[1][1]],i=this.mapService.getZoom();return{latLonBounds:n,zoom:i}}},{key:"bindTilesetEvent",value:function(){var r=this;this.tilesetManager.on("tile-loaded",function(n){}),this.tilesetManager.on("tile-unload",function(n){r.tileUnLoad(n)}),this.tilesetManager.on("tile-error",function(n,i){r.tileError(n)}),this.tilesetManager.on("tile-update",function(){r.tileUpdate()}),this.mapService.on("zoomend",this.mapchange),this.mapService.on("moveend",this.viewchange)}},{key:"render",value:function(){this.tileLayerService.render()}},{key:"getLayers",value:function(){return this.tileLayerService.getLayers()}},{key:"getTiles",value:function(){return this.tileLayerService.getTiles()}},{key:"getTile",value:function(r){return this.tileLayerService.getTile(r)}},{key:"tileLoaded",value:function(r){}},{key:"tileError",value:function(r){}},{key:"destroy",value:function(){var r;this.mapService.off("zoomend",this.mapchange),this.mapService.off("moveend",this.viewchange),(r=this.tilesetManager)===null||r===void 0||r.destroy(),this.tileLayerService.destroy()}},{key:"reload",value:function(){var r;this.tilesetManager.clear();var n=this.getCurrentView(),i=n.latLonBounds,o=n.zoom;(r=this.tilesetManager)===null||r===void 0||r.update(o,i)}},{key:"tileUnLoad",value:function(r){this.tileLayerService.removeTile(r.key)}},{key:"tileUpdate",value:function(){var t=Vt(Ce.mark(function n(){var i=this,o,a;return Ce.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(this.tilesetManager){c.next=2;break}return c.abrupt("return");case 2:return o=this.parent.getMinZoom(),a=this.parent.getMaxZoom(),c.next=6,Promise.all(this.tilesetManager.tiles.filter(function(h){return h.isLoaded}).filter(function(h){return h.isVisibleChange}).filter(function(h){return h.data}).filter(function(h){return h.z>=o&&h.z<a}).map(function(){var h=Vt(Ce.mark(function y(x){var E,T;return Ce.wrap(function(k){for(;;)switch(k.prev=k.next){case 0:if(i.tileLayerService.hasTile(x.key)){k.next=9;break}return E=xK(i.parent),T=new E(x,i.parent),k.next=5,T.initTileLayer();case 5:i.tilePickService.setPickState(),T.getLayers().length!==0&&(i.tileLayerService.addTile(T),i.tileLayerService.updateTileVisible(x),i.layerService.reRender()),k.next=12;break;case 9:i.tileLayerService.updateTileVisible(x),i.tilePickService.setPickState(),i.layerService.reRender();case 12:case"end":return k.stop()}},y)}));return function(y){return h.apply(this,arguments)}}()));case 6:this.tilesetManager.isLoaded&&this.parent.emit("tiles-loaded",this.tilesetManager.currentTiles);case 7:case"end":return c.stop()}},n,this)}));function r(){return t.apply(this,arguments)}return r}()},{key:"setPickState",value:function(r){}},{key:"pickRender",value:function(r){this.tilePickService.pickRender(r)}},{key:"selectFeature",value:function(r){this.tilePickService.selectFeature(r)}},{key:"highlightPickedFeature",value:function(r){this.tilePickService.highlightPickedFeature(r)}},{key:"proxy",value:function(r){var n=this;YZ.forEach(function(i){var o=r[i].bind(r);r[i]=function(){for(var a=arguments.length,u=new Array(a),c=0;c<a;c++)u[c]=arguments[c];return o.apply(void 0,u),n.getLayers().map(function(h){h[i].apply(h,u)}),i==="style"&&n.getTiles().forEach(function(h){return h.styleUpdate.apply(h,u)}),r}})}}]),e}(),HP,WP,bK=(HP=Ei(),HP(WP=function(){function e(){$t(this,e)}return Gt(e,[{key:"build",value:function(){var t=Vt(Ce.mark(function n(i){return Ce.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return i.prepareBuildModel(),a.next=3,i.buildModels();case 3:case"end":return a.stop()}},n)}));function r(n){return t.apply(this,arguments)}return r}()},{key:"initLayerModel",value:function(){var t=Vt(Ce.mark(function n(i){return Ce.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.build(i);case 2:i.styleNeedUpdate=!1;case 3:case"end":return a.stop()}},n,this)}));function r(n){return t.apply(this,arguments)}return r}()},{key:"prepareLayerModel",value:function(){var t=Vt(Ce.mark(function n(i){return Ce.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.build(i);case 2:i.styleNeedUpdate=!1;case 3:case"end":return a.stop()}},n,this)}));function r(n){return t.apply(this,arguments)}return r}()},{key:"apply",value:function(r){var n=this;r.hooks.init.tapPromise("LayerModelPlugin",Vt(Ce.mark(function i(){return Ce.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(!r.getSource().isTile){a.next=4;break}return r.prepareBuildModel(),r.tileLayer=new GP(r),a.abrupt("return");case 4:return r.log($s.BuildModelStart,Hs.INIT),a.next=7,n.initLayerModel(r);case 7:r.log($s.BuildModelEnd,Hs.INIT);case 8:case"end":return a.stop()}},i)}))),r.hooks.beforeRenderData.tapPromise("LayerModelPlugin",function(){var i=Vt(Ce.mark(function o(a){return Ce.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(a){c.next=2;break}return c.abrupt("return",!1);case 2:if(!r.getSource().isTile){c.next=5;break}return r.tileLayer=new GP(r),c.abrupt("return",!1);case 5:return r.log($s.BuildModelStart,Hs.UPDATE),c.next=8,n.prepareLayerModel(r);case 8:return r.log($s.BuildModelEnd,Hs.UPDATE),c.abrupt("return",!0);case 10:case"end":return c.stop()}},o)}));return function(o){return i.apply(this,arguments)}}()),r.hooks.beforeRender.tap("LayerModelPlugin",function(){r.styleNeedUpdate&&n.prepareLayerModel(r).then(function(){r.styleNeedUpdate=!1,r.renderLayers()}),r.styleNeedUpdate=!1})}}]),e}())||WP),XP,YP,wK=(XP=Ei(),XP(YP=function(){function e(){$t(this,e)}return Gt(e,[{key:"apply",value:function(r){r.hooks.afterInit.tap("LayerStylePlugin",function(){var n=r.getLayerConfig(),i=n.autoFit,o=n.fitBoundsOptions;i&&r.fitBounds(o)})}}]),e}())||YP),qP,ZP,EK=["type"],KP={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},SK={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},AK={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},TK={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5};function CK(e){var t={u_DirectionalLights:new Array(3).fill(_t({},AK)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill(_t({},TK)),u_NumOfSpotLights:0};return(!e||!e.length)&&(e=[SK]),e.forEach(function(r){var n=r.type,i=n===void 0?"directional":n,o=Zh(r,EK),a=KP[i].lights,u=KP[i].num,c=t[u];t[a][c]=_t(_t({},t[a][c]),o),t[u]++}),t}var MK=(qP=Ei(),qP(ZP=function(){function e(){$t(this,e)}return Gt(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("LightingPlugin",function(){var n=r.getLayerConfig(),i=n.enableLighting;i&&r.models.forEach(function(o){return o.addUniforms(_t({},CK()))})})}}]),e}())||ZP),QP,JP,PK=(QP=Ei(),QP(JP=function(){function e(){$t(this,e)}return Gt(e,[{key:"apply",value:function(r,n){var i=this,o=n.rendererService,a=n.postProcessingPassFactory,u=n.normalPassFactory;r.hooks.init.tapPromise("MultiPassRendererPlugin",function(){var c=r.getLayerConfig(),h=c.enableMultiPassRenderer,y=c.passes,x=y===void 0?[]:y;i.enabled=!!h&&r.getLayerConfig().enableMultiPassRenderer!==!1,i.enabled&&(r.multiPassRenderer=iL(r,x,a,u),r.multiPassRenderer.setRenderFlag(!0))}),r.hooks.beforeRender.tap("MultiPassRendererPlugin",function(){if(i.enabled){var c=o.getViewportSize(),h=c.width,y=c.height;r.multiPassRenderer.resize(h,y)}})}}]),e}())||JP),e4,t4,f1={NONE:0,ENCODE:1,HIGHLIGHT:2},IK=(e4=Ei(),e4(t4=function(){function e(){$t(this,e)}return Gt(e,[{key:"apply",value:function(r,n){var i=n.styleAttributeService;r.hooks.init.tapPromise("PixelPickingPlugin",function(){var o=r.getLayerConfig(),a=o.enablePicking;i.registerStyleAttribute({name:"pickingColor",type:gn.Attribute,descriptor:{name:"a_PickingColor",buffer:{data:[],type:ae.FLOAT},size:3,update:function(c){var h=c.id;return a?Dd(h):[0,0,0]}}})}),r.hooks.beforePickingEncode.tap("PixelPickingPlugin",function(){var o=r.getLayerConfig(),a=o.enablePicking;a&&r.isVisible()&&r.models.forEach(function(u){return u.addUniforms({u_PickingStage:f1.ENCODE})})}),r.hooks.afterPickingEncode.tap("PixelPickingPlugin",function(){var o=r.getLayerConfig(),a=o.enablePicking;a&&r.isVisible()&&r.models.forEach(function(u){return u.addUniforms({u_PickingStage:f1.HIGHLIGHT})})}),r.hooks.beforeHighlight.tap("PixelPickingPlugin",function(o){var a=r.getLayerConfig(),u=a.highlightColor,c=a.activeMix,h=c===void 0?0:c,y=typeof u=="string"?Da(u):u||[1,0,0,1];r.updateLayerConfig({pickedFeatureID:Pm(new Uint8Array(o))}),r.models.forEach(function(x){return x.addUniforms({u_PickingStage:f1.HIGHLIGHT,u_PickingColor:o,u_HighlightColor:y.map(function(E){return E*255}),u_activeMix:h})})}),r.hooks.beforeSelect.tap("PixelPickingPlugin",function(o){var a=r.getLayerConfig(),u=a.selectColor,c=a.selectMix,h=c===void 0?0:c,y=typeof u=="string"?Da(u):u||[1,0,0,1];r.updateLayerConfig({pickedFeatureID:Pm(new Uint8Array(o))}),r.models.forEach(function(x){return x.addUniforms({u_PickingStage:f1.HIGHLIGHT,u_PickingColor:o,u_HighlightColor:y.map(function(E){return E*255}),u_activeMix:h,u_CurrentSelectedId:o,u_SelectColor:y.map(function(E){return E*255}),u_EnableSelect:1})})})}}]),e}())||t4),RK=["mvt","geojsonvt","testTile"];function LK(e){var t=e.getSource();return RK.includes(t.parser.type)}var r4,n4,kK=(r4=Ei(),r4(n4=function(){function e(){$t(this,e)}return Gt(e,[{key:"apply",value:function(r,n){var i=this,o=n.styleAttributeService;r.hooks.init.tapPromise("RegisterStyleAttributePlugin",function(){LK(r)||i.registerBuiltinAttributes(o,r)})}},{key:"registerBuiltinAttributes",value:function(r,n){if(n.type==="MaskLayer"){this.registerPositionAttribute(r);return}this.registerPositionAttribute(r),this.registerColorAttribute(r),this.registerVertexIdAttribute(r)}},{key:"registerPositionAttribute",value:function(r){r.registerStyleAttribute({name:"position",type:gn.Attribute,descriptor:{name:"a_Position",buffer:{data:[],type:ae.FLOAT},size:3,update:function(i,o,a){return a.length===2?[a[0],a[1],0]:[a[0],a[1],a[2]]}}})}},{key:"registerFilterAttribute",value:function(r){r.registerStyleAttribute({name:"filter",type:gn.Attribute,descriptor:{name:"filter",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:1,update:function(i){var o=i.filter;return o?[1]:[0]}}})}},{key:"registerColorAttribute",value:function(r){r.registerStyleAttribute({name:"color",type:gn.Attribute,descriptor:{name:"a_Color",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:4,update:function(i){var o=i.color;return!o||!o.length?[1,1,1,1]:o}}})}},{key:"registerVertexIdAttribute",value:function(r){r.registerStyleAttribute({name:"vertexId",type:gn.Attribute,descriptor:{name:"a_vertexId",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:1,update:function(i,o){return[o]}}})}}]),e}())||n4),i4,a4,o4,s4,u4,l4,T0,c4,f4,h4,p4,OK=(i4=Ei(),a4=na(Mt.ICameraService),o4=na(Mt.ICoordinateSystemService),s4=na(Mt.IRendererService),u4=na(Mt.IMapService),i4(l4=(T0=function(){function e(){$t(this,e),Gi(this,"cameraService",c4,this),Gi(this,"coordinateSystemService",f4,this),Gi(this,"rendererService",h4,this),Gi(this,"mapService",p4,this)}return Gt(e,[{key:"apply",value:function(r){var n=this,i=this.mapService.version,o=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],a=[0,0];r.hooks.beforeRender.tap("ShaderUniformPlugin",function(){var u=r.getLayerConfig().tileOrigin;n.coordinateSystemService.refresh(u),i==="GAODE2.x"&&(n.setLayerCenter(r),o=n.mapService.map.customCoords.getMVPMatrix(),a=n.mapService.getCustomCoordCenter());var c=n.rendererService.getViewportSize(),h=c.width,y=c.height;r.models.forEach(function(x){var E;x.addUniforms((E={},Q(E,gm.ProjectionMatrix,n.cameraService.getProjectionMatrix()),Q(E,gm.ViewMatrix,n.cameraService.getViewMatrix()),Q(E,gm.ViewProjectionMatrix,n.cameraService.getViewProjectionMatrix()),Q(E,gm.Zoom,n.cameraService.getZoom()),Q(E,gm.ZoomScale,n.cameraService.getZoomScale()),Q(E,gm.FocalDistance,n.cameraService.getFocalDistance()),Q(E,gm.CameraPosition,n.cameraService.getCameraPosition()),Q(E,vm.CoordinateSystem,n.coordinateSystemService.getCoordinateSystem()),Q(E,vm.ViewportCenter,n.coordinateSystemService.getViewportCenter()),Q(E,vm.ViewportCenterProjection,n.coordinateSystemService.getViewportCenterProjection()),Q(E,vm.PixelsPerDegree,n.coordinateSystemService.getPixelsPerDegree()),Q(E,vm.PixelsPerDegree2,n.coordinateSystemService.getPixelsPerDegree2()),Q(E,vm.PixelsPerMeter,n.coordinateSystemService.getPixelsPerMeter()),Q(E,vm.Mvp,o),Q(E,"u_sceneCenterMercator",a),Q(E,"u_ViewportSize",[h,y]),Q(E,"u_ModelMatrix",n.cameraService.getModelMatrix()),Q(E,"u_DevicePixelRatio",ja.devicePixelRatio),Q(E,"u_PickingBuffer",r.getLayerConfig().pickingBuffer||0),Q(E,"u_shaderPick",Number(r.getShaderPickStat())),E))})})}},{key:"setLayerCenter",value:function(r){r.coordCenter===void 0&&(r.coordCenter=r.getSource().center),this.mapService.setCoordCenter&&this.mapService.setCoordCenter(r.coordCenter)}}]),e}(),c4=Ui(T0.prototype,"cameraService",[a4],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),f4=Ui(T0.prototype,"coordinateSystemService",[o4],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),h4=Ui(T0.prototype,"rendererService",[s4],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),p4=Ui(T0.prototype,"mapService",[u4],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),T0))||l4),d4,v4,DK=(d4=Ei(),d4(v4=function(){function e(){$t(this,e)}return Gt(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("UpdateModelPlugin",function(){r.layerModel&&r.layerModel.needUpdate().then(function(n){n&&r.renderLayers()})}),r.hooks.afterRender.tap("UpdateModelPlugin",function(){r.layerModelNeedUpdate=!1})}}]),e}())||v4),m4,g4,FK=(m4=Ei(),m4(g4=function(){function e(){$t(this,e)}return Gt(e,[{key:"apply",value:function(r,n){var i=this,o=n.styleAttributeService;r.hooks.init.tapPromise("UpdateStyleAttributePlugin",function(){i.initStyleAttribute(r,{styleAttributeService:o})}),r.hooks.beforeRender.tap("UpdateStyleAttributePlugin",function(){r.layerModelNeedUpdate||r.inited&&i.updateStyleAttribute(r,{styleAttributeService:o})})}},{key:"updateStyleAttribute",value:function(r,n){var i=n.styleAttributeService,o=i.getLayerStyleAttributes()||[],a=i.getLayerStyleAttribute("filter");if(a&&a.needRegenerateVertices){r.layerModelNeedUpdate=!0,o.forEach(function(u){return u.needRegenerateVertices=!1});return}o.filter(function(u){return u.needRegenerateVertices}).forEach(function(u){i.updateAttributeByFeatureRange(u.name,r.getEncodedData(),u.featureRange.startIndex,u.featureRange.endIndex,r),u.needRegenerateVertices=!1})}},{key:"initStyleAttribute",value:function(r,n){var i=n.styleAttributeService,o=i.getLayerStyleAttributes()||[];o.filter(function(a){return a.needRegenerateVertices}).forEach(function(a){i.updateAttributeByFeatureRange(a.name,r.getEncodedData(),a.featureRange.startIndex,a.featureRange.endIndex),a.needRegenerateVertices=!1})}}]),e}())||g4);Gu.bind(Mt.ILayerPlugin).to(QX).inRequestScope();Gu.bind(Mt.ILayerPlugin).to(kK).inRequestScope();Gu.bind(Mt.ILayerPlugin).to(hZ).inRequestScope();Gu.bind(Mt.ILayerPlugin).to(KX).inRequestScope();Gu.bind(Mt.ILayerPlugin).to(wK).inRequestScope();Gu.bind(Mt.ILayerPlugin).to(dZ).inRequestScope();Gu.bind(Mt.ILayerPlugin).to(FK).inRequestScope();Gu.bind(Mt.ILayerPlugin).to(DK).inRequestScope();Gu.bind(Mt.ILayerPlugin).to(PK).inRequestScope();Gu.bind(Mt.ILayerPlugin).to(OK).inRequestScope();Gu.bind(Mt.ILayerPlugin).to(pZ).inRequestScope();Gu.bind(Mt.ILayerPlugin).to(MK).inRequestScope();Gu.bind(Mt.ILayerPlugin).to(IK).inRequestScope();Gu.bind(Mt.ILayerPlugin).to(bK).inRequestScope();var nk={exports:{}},x2={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},b2="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",NK={5:b2,"5module":b2+" export import",6:b2+" const class extends export import super"},BK=/^in(stanceof)?$/,PS="ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽͿΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԯԱ-Ֆՙՠ-ֈא-תׯ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࡠ-ࡪࢠ-ࢴࢶ-ࣇऄ-हऽॐक़-ॡॱ-ঀঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱৼਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡૹଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-హఽౘ-ౚౠౡಀಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഄ-ഌഎ-ഐഒ-ഺഽൎൔ-ൖൟ-ൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄຆ-ຊຌ-ຣລວ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏽᏸ-ᏽᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛮ-ᛸᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡸᢀ-ᢨᢪᢰ-ᣵᤀ-ᤞᥐ-ᥭᥰ-ᥴᦀ-ᦫᦰ-ᧉᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᲀ-ᲈᲐ-ᲺᲽ-Ჿᳩ-ᳬᳮ-ᳳᳵᳶᳺᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕ℘-ℝℤΩℨK-ℹℼ-ℿⅅ-ⅉⅎⅠ-ↈⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞ々-〇〡-〩〱-〵〸-〼ぁ-ゖ゛-ゟァ-ヺー-ヿㄅ-ㄯㄱ-ㆎㆠ-ㆿㇰ-ㇿ㐀-䶿一-鿼ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚝꚠ-ꛯꜗ-ꜟꜢ-ꞈꞋ-ꞿꟂ-ꟊꟵ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꣽꣾꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꧠ-ꧤꧦ-ꧯꧺ-ꧾꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꩾ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꬰ-ꭚꭜ-ꭩꭰ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ",ik="‌‍·̀-ͯ·҃-֑҇-ׇֽֿׁׂׅׄؐ-ًؚ-٩ٰۖ-ۜ۟-۪ۤۧۨ-ۭ۰-۹ܑܰ-݊ަ-ް߀-߉߫-߽߳ࠖ-࠙ࠛ-ࠣࠥ-ࠧࠩ-࡙࠭-࡛࣓-ࣣ࣡-ःऺ-़ा-ॏ॑-ॗॢॣ०-९ঁ-ঃ়া-ৄেৈো-্ৗৢৣ০-৯৾ਁ-ਃ਼ਾ-ੂੇੈੋ-੍ੑ੦-ੱੵઁ-ઃ઼ા-ૅે-ૉો-્ૢૣ૦-૯ૺ-૿ଁ-ଃ଼ା-ୄେୈୋ-୍୕-ୗୢୣ୦-୯ஂா-ூெ-ைொ-்ௗ௦-௯ఀ-ఄా-ౄె-ైొ-్ౕౖౢౣ౦-౯ಁ-ಃ಼ಾ-ೄೆ-ೈೊ-್ೕೖೢೣ೦-೯ഀ-ഃ഻഼ാ-ൄെ-ൈൊ-്ൗൢൣ൦-൯ඁ-ඃ්ා-ුූෘ-ෟ෦-෯ෲෳัิ-ฺ็-๎๐-๙ັິ-ຼ່-ໍ໐-໙༘༙༠-༩༹༵༷༾༿ཱ-྄྆྇ྍ-ྗྙ-ྼ࿆ါ-ှ၀-၉ၖ-ၙၞ-ၠၢ-ၤၧ-ၭၱ-ၴႂ-ႍႏ-ႝ፝-፟፩-፱ᜒ-᜔ᜲ-᜴ᝒᝓᝲᝳ឴-៓៝០-៩᠋-᠍᠐-᠙ᢩᤠ-ᤫᤰ-᤻᥆-᥏᧐-᧚ᨗ-ᨛᩕ-ᩞ᩠-᩿᩼-᪉᪐-᪙᪰-᪽ᪿᫀᬀ-ᬄ᬴-᭄᭐-᭙᭫-᭳ᮀ-ᮂᮡ-ᮭ᮰-᮹᯦-᯳ᰤ-᰷᱀-᱉᱐-᱙᳐-᳔᳒-᳨᳭᳴᳷-᳹᷀-᷹᷻-᷿‿⁀⁔⃐-⃥⃜⃡-⃰⳯-⵿⳱ⷠ-〪ⷿ-゙゚〯꘠-꘩꙯ꙴ-꙽ꚞꚟ꛰꛱ꠂ꠆ꠋꠣ-ꠧ꠬ꢀꢁꢴ-ꣅ꣐-꣙꣠-꣱ꣿ-꤉ꤦ-꤭ꥇ-꥓ꦀ-ꦃ꦳-꧀꧐-꧙ꧥ꧰-꧹ꨩ-ꨶꩃꩌꩍ꩐-꩙ꩻ-ꩽꪰꪲ-ꪴꪷꪸꪾ꪿꫁ꫫ-ꫯꫵ꫶ꯣ-ꯪ꯬꯭꯰-꯹ﬞ︀-️︠-︯︳︴﹍-﹏０-９＿",zK=new RegExp("["+PS+"]"),UK=new RegExp("["+PS+ik+"]");PS=ik=null;var ak=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,349,41,7,1,79,28,11,0,9,21,107,20,28,22,13,52,76,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,230,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,35,56,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,190,0,80,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,689,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,43,8,8952,286,50,2,18,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,2357,44,11,6,17,0,370,43,1301,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42717,35,4148,12,221,3,5761,15,7472,3104,541,1507,4938],VK=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,370,1,154,10,176,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,161,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,19306,9,135,4,60,6,26,9,1014,0,2,54,8,3,82,0,12,1,19628,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,262,6,10,9,419,13,1495,6,110,6,6,9,4759,9,787719,239];function jw(e,t){for(var r=65536,n=0;n<t.length;n+=2){if(r+=t[n],r>e)return!1;if(r+=t[n+1],r>=e)return!0}}function Ov(e,t){return e<65?e===36:e<91?!0:e<97?e===95:e<123?!0:e<=65535?e>=170&&zK.test(String.fromCharCode(e)):t===!1?!1:jw(e,ak)}function tg(e,t){return e<48?e===36:e<58?!0:e<65?!1:e<91?!0:e<97?e===95:e<123?!0:e<=65535?e>=170&&UK.test(String.fromCharCode(e)):t===!1?!1:jw(e,ak)||jw(e,VK)}var Za=function(t,r){r===void 0&&(r={}),this.label=t,this.keyword=r.keyword,this.beforeExpr=!!r.beforeExpr,this.startsExpr=!!r.startsExpr,this.isLoop=!!r.isLoop,this.isAssign=!!r.isAssign,this.prefix=!!r.prefix,this.postfix=!!r.postfix,this.binop=r.binop||null,this.updateContext=null};function jf(e,t){return new Za(e,{beforeExpr:!0,binop:t})}var $f={beforeExpr:!0},hf={startsExpr:!0},IS={};function Oa(e,t){return t===void 0&&(t={}),t.keyword=e,IS[e]=new Za(e,t)}var Ee={num:new Za("num",hf),regexp:new Za("regexp",hf),string:new Za("string",hf),name:new Za("name",hf),eof:new Za("eof"),bracketL:new Za("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new Za("]"),braceL:new Za("{",{beforeExpr:!0,startsExpr:!0}),braceR:new Za("}"),parenL:new Za("(",{beforeExpr:!0,startsExpr:!0}),parenR:new Za(")"),comma:new Za(",",$f),semi:new Za(";",$f),colon:new Za(":",$f),dot:new Za("."),question:new Za("?",$f),questionDot:new Za("?."),arrow:new Za("=>",$f),template:new Za("template"),invalidTemplate:new Za("invalidTemplate"),ellipsis:new Za("...",$f),backQuote:new Za("`",hf),dollarBraceL:new Za("${",{beforeExpr:!0,startsExpr:!0}),eq:new Za("=",{beforeExpr:!0,isAssign:!0}),assign:new Za("_=",{beforeExpr:!0,isAssign:!0}),incDec:new Za("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new Za("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:jf("||",1),logicalAND:jf("&&",2),bitwiseOR:jf("|",3),bitwiseXOR:jf("^",4),bitwiseAND:jf("&",5),equality:jf("==/!=/===/!==",6),relational:jf("</>/<=/>=",7),bitShift:jf("<</>>/>>>",8),plusMin:new Za("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:jf("%",10),star:jf("*",10),slash:jf("/",10),starstar:new Za("**",{beforeExpr:!0}),coalesce:jf("??",1),_break:Oa("break"),_case:Oa("case",$f),_catch:Oa("catch"),_continue:Oa("continue"),_debugger:Oa("debugger"),_default:Oa("default",$f),_do:Oa("do",{isLoop:!0,beforeExpr:!0}),_else:Oa("else",$f),_finally:Oa("finally"),_for:Oa("for",{isLoop:!0}),_function:Oa("function",hf),_if:Oa("if"),_return:Oa("return",$f),_switch:Oa("switch"),_throw:Oa("throw",$f),_try:Oa("try"),_var:Oa("var"),_const:Oa("const"),_while:Oa("while",{isLoop:!0}),_with:Oa("with"),_new:Oa("new",{beforeExpr:!0,startsExpr:!0}),_this:Oa("this",hf),_super:Oa("super",hf),_class:Oa("class",hf),_extends:Oa("extends",$f),_export:Oa("export"),_import:Oa("import",hf),_null:Oa("null",hf),_true:Oa("true",hf),_false:Oa("false",hf),_in:Oa("in",{beforeExpr:!0,binop:7}),_instanceof:Oa("instanceof",{beforeExpr:!0,binop:7}),_typeof:Oa("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:Oa("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:Oa("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},oh=/\r\n?|\n|\u2028|\u2029/,t_=new RegExp(oh.source,"g");function E_(e,t){return e===10||e===13||!t&&(e===8232||e===8233)}var ok=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,Qf=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,sk=Object.prototype,jK=sk.hasOwnProperty,$K=sk.toString;function Zx(e,t){return jK.call(e,t)}var y4=Array.isArray||function(e){return $K.call(e)==="[object Array]"};function Cm(e){return new RegExp("^(?:"+e.replace(/ /g,"|")+")$")}var r_=function(t,r){this.line=t,this.column=r};r_.prototype.offset=function(t){return new r_(this.line,this.column+t)};var Kx=function(t,r,n){this.start=r,this.end=n,t.sourceFile!==null&&(this.source=t.sourceFile)};function uk(e,t){for(var r=1,n=0;;){t_.lastIndex=n;var i=t_.exec(e);if(i&&i.index<t)++r,n=i.index+i[0].length;else return new r_(r,t-n)}}var $w={ecmaVersion:10,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:!1,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1};function GK(e){var t={};for(var r in $w)t[r]=e&&Zx(e,r)?e[r]:$w[r];if(t.ecmaVersion>=2015&&(t.ecmaVersion-=2009),t.allowReserved==null&&(t.allowReserved=t.ecmaVersion<5),y4(t.onToken)){var n=t.onToken;t.onToken=function(i){return n.push(i)}}return y4(t.onComment)&&(t.onComment=HK(t,t.onComment)),t}function HK(e,t){return function(r,n,i,o,a,u){var c={type:r?"Block":"Line",value:n,start:i,end:o};e.locations&&(c.loc=new Kx(this,a,u)),e.ranges&&(c.range=[i,o]),t.push(c)}}var n_=1,S_=2,RS=n_|S_,lk=4,ck=8,fk=16,hk=32,pk=64,dk=128;function LS(e,t){return S_|(e?lk:0)|(t?ck:0)}var _4=0,kS=1,kd=2,vk=3,mk=4,gk=5,lu=function(t,r,n){this.options=t=GK(t),this.sourceFile=t.sourceFile,this.keywords=Cm(NK[t.ecmaVersion>=6?6:t.sourceType==="module"?"5module":5]);var i="";if(t.allowReserved!==!0){for(var o=t.ecmaVersion;!(i=x2[o]);o--);t.sourceType==="module"&&(i+=" await")}this.reservedWords=Cm(i);var a=(i?i+" ":"")+x2.strict;this.reservedWordsStrict=Cm(a),this.reservedWordsStrictBind=Cm(a+" "+x2.strictBind),this.input=String(r),this.containsEsc=!1,n?(this.pos=n,this.lineStart=this.input.lastIndexOf(`
`,n-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(oh).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=Ee.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule=t.sourceType==="module",this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports={},this.pos===0&&t.allowHashBang&&this.input.slice(0,2)==="#!"&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(n_),this.regexpState=null},Hm={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0}};lu.prototype.parse=function(){var t=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(t)};Hm.inFunction.get=function(){return(this.currentVarScope().flags&S_)>0};Hm.inGenerator.get=function(){return(this.currentVarScope().flags&ck)>0};Hm.inAsync.get=function(){return(this.currentVarScope().flags&lk)>0};Hm.allowSuper.get=function(){return(this.currentThisScope().flags&pk)>0};Hm.allowDirectSuper.get=function(){return(this.currentThisScope().flags&dk)>0};Hm.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())};lu.prototype.inNonArrowFunction=function(){return(this.currentThisScope().flags&S_)>0};lu.extend=function(){for(var t=[],r=arguments.length;r--;)t[r]=arguments[r];for(var n=this,i=0;i<t.length;i++)n=t[i](n);return n};lu.parse=function(t,r){return new this(r,t).parse()};lu.parseExpressionAt=function(t,r,n){var i=new this(n,t,r);return i.nextToken(),i.parseExpression()};lu.tokenizer=function(t,r){return new this(r,t)};Object.defineProperties(lu.prototype,Hm);var nc=lu.prototype,WK=/^(?:'((?:\\.|[^'\\])*?)'|"((?:\\.|[^"\\])*?)")/;nc.strictDirective=function(e){for(;;){Qf.lastIndex=e,e+=Qf.exec(this.input)[0].length;var t=WK.exec(this.input.slice(e));if(!t)return!1;if((t[1]||t[2])==="use strict"){Qf.lastIndex=e+t[0].length;var r=Qf.exec(this.input),n=r.index+r[0].length,i=this.input.charAt(n);return i===";"||i==="}"||oh.test(r[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test(i)||i==="!"&&this.input.charAt(n+1)==="=")}e+=t[0].length,Qf.lastIndex=e,e+=Qf.exec(this.input)[0].length,this.input[e]===";"&&e++}};nc.eat=function(e){return this.type===e?(this.next(),!0):!1};nc.isContextual=function(e){return this.type===Ee.name&&this.value===e&&!this.containsEsc};nc.eatContextual=function(e){return this.isContextual(e)?(this.next(),!0):!1};nc.expectContextual=function(e){this.eatContextual(e)||this.unexpected()};nc.canInsertSemicolon=function(){return this.type===Ee.eof||this.type===Ee.braceR||oh.test(this.input.slice(this.lastTokEnd,this.start))};nc.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0};nc.semicolon=function(){!this.eat(Ee.semi)&&!this.insertSemicolon()&&this.unexpected()};nc.afterTrailingComma=function(e,t){if(this.type===e)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),t||this.next(),!0};nc.expect=function(e){this.eat(e)||this.unexpected()};nc.unexpected=function(e){this.raise(e??this.start,"Unexpected token")};function Qx(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1}nc.checkPatternErrors=function(e,t){if(e){e.trailingComma>-1&&this.raiseRecoverable(e.trailingComma,"Comma is not permitted after the rest element");var r=t?e.parenthesizedAssign:e.parenthesizedBind;r>-1&&this.raiseRecoverable(r,"Parenthesized pattern")}};nc.checkExpressionErrors=function(e,t){if(!e)return!1;var r=e.shorthandAssign,n=e.doubleProto;if(!t)return r>=0||n>=0;r>=0&&this.raise(r,"Shorthand property assignments are valid only in destructuring patterns"),n>=0&&this.raiseRecoverable(n,"Redefinition of __proto__ property")};nc.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")};nc.isSimpleAssignTarget=function(e){return e.type==="ParenthesizedExpression"?this.isSimpleAssignTarget(e.expression):e.type==="Identifier"||e.type==="MemberExpression"};var Ki=lu.prototype;Ki.parseTopLevel=function(e){var t={};for(e.body||(e.body=[]);this.type!==Ee.eof;){var r=this.parseStatement(null,!0,t);e.body.push(r)}if(this.inModule)for(var n=0,i=Object.keys(this.undefinedExports);n<i.length;n+=1){var o=i[n];this.raiseRecoverable(this.undefinedExports[o].start,"Export '"+o+"' is not defined")}return this.adaptDirectivePrologue(e.body),this.next(),e.sourceType=this.options.sourceType,this.finishNode(e,"Program")};var OS={kind:"loop"},XK={kind:"switch"};Ki.isLet=function(e){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;Qf.lastIndex=this.pos;var t=Qf.exec(this.input),r=this.pos+t[0].length,n=this.input.charCodeAt(r);if(n===91)return!0;if(e)return!1;if(n===123)return!0;if(Ov(n,!0)){for(var i=r+1;tg(this.input.charCodeAt(i),!0);)++i;var o=this.input.slice(r,i);if(!BK.test(o))return!0}return!1};Ki.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;Qf.lastIndex=this.pos;var e=Qf.exec(this.input),t=this.pos+e[0].length;return!oh.test(this.input.slice(this.pos,t))&&this.input.slice(t,t+8)==="function"&&(t+8===this.input.length||!tg(this.input.charAt(t+8)))};Ki.parseStatement=function(e,t,r){var n=this.type,i=this.startNode(),o;switch(this.isLet(e)&&(n=Ee._var,o="let"),n){case Ee._break:case Ee._continue:return this.parseBreakContinueStatement(i,n.keyword);case Ee._debugger:return this.parseDebuggerStatement(i);case Ee._do:return this.parseDoStatement(i);case Ee._for:return this.parseForStatement(i);case Ee._function:return e&&(this.strict||e!=="if"&&e!=="label")&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(i,!1,!e);case Ee._class:return e&&this.unexpected(),this.parseClass(i,!0);case Ee._if:return this.parseIfStatement(i);case Ee._return:return this.parseReturnStatement(i);case Ee._switch:return this.parseSwitchStatement(i);case Ee._throw:return this.parseThrowStatement(i);case Ee._try:return this.parseTryStatement(i);case Ee._const:case Ee._var:return o=o||this.value,e&&o!=="var"&&this.unexpected(),this.parseVarStatement(i,o);case Ee._while:return this.parseWhileStatement(i);case Ee._with:return this.parseWithStatement(i);case Ee.braceL:return this.parseBlock(!0,i);case Ee.semi:return this.parseEmptyStatement(i);case Ee._export:case Ee._import:if(this.options.ecmaVersion>10&&n===Ee._import){Qf.lastIndex=this.pos;var a=Qf.exec(this.input),u=this.pos+a[0].length,c=this.input.charCodeAt(u);if(c===40||c===46)return this.parseExpressionStatement(i,this.parseExpression())}return this.options.allowImportExportEverywhere||(t||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),n===Ee._import?this.parseImport(i):this.parseExport(i,r);default:if(this.isAsyncFunction())return e&&this.unexpected(),this.next(),this.parseFunctionStatement(i,!0,!e);var h=this.value,y=this.parseExpression();return n===Ee.name&&y.type==="Identifier"&&this.eat(Ee.colon)?this.parseLabeledStatement(i,h,y,e):this.parseExpressionStatement(i,y)}};Ki.parseBreakContinueStatement=function(e,t){var r=t==="break";this.next(),this.eat(Ee.semi)||this.insertSemicolon()?e.label=null:this.type!==Ee.name?this.unexpected():(e.label=this.parseIdent(),this.semicolon());for(var n=0;n<this.labels.length;++n){var i=this.labels[n];if((e.label==null||i.name===e.label.name)&&(i.kind!=null&&(r||i.kind==="loop")||e.label&&r))break}return n===this.labels.length&&this.raise(e.start,"Unsyntactic "+t),this.finishNode(e,r?"BreakStatement":"ContinueStatement")};Ki.parseDebuggerStatement=function(e){return this.next(),this.semicolon(),this.finishNode(e,"DebuggerStatement")};Ki.parseDoStatement=function(e){return this.next(),this.labels.push(OS),e.body=this.parseStatement("do"),this.labels.pop(),this.expect(Ee._while),e.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(Ee.semi):this.semicolon(),this.finishNode(e,"DoWhileStatement")};Ki.parseForStatement=function(e){this.next();var t=this.options.ecmaVersion>=9&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction)&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(OS),this.enterScope(0),this.expect(Ee.parenL),this.type===Ee.semi)return t>-1&&this.unexpected(t),this.parseFor(e,null);var r=this.isLet();if(this.type===Ee._var||this.type===Ee._const||r){var n=this.startNode(),i=r?"let":this.value;return this.next(),this.parseVar(n,!0,i),this.finishNode(n,"VariableDeclaration"),(this.type===Ee._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&n.declarations.length===1?(this.options.ecmaVersion>=9&&(this.type===Ee._in?t>-1&&this.unexpected(t):e.await=t>-1),this.parseForIn(e,n)):(t>-1&&this.unexpected(t),this.parseFor(e,n))}var o=new Qx,a=this.parseExpression(!0,o);return this.type===Ee._in||this.options.ecmaVersion>=6&&this.isContextual("of")?(this.options.ecmaVersion>=9&&(this.type===Ee._in?t>-1&&this.unexpected(t):e.await=t>-1),this.toAssignable(a,!1,o),this.checkLVal(a),this.parseForIn(e,a)):(this.checkExpressionErrors(o,!0),t>-1&&this.unexpected(t),this.parseFor(e,a))};Ki.parseFunctionStatement=function(e,t,r){return this.next(),this.parseFunction(e,My|(r?0:Gw),!1,t)};Ki.parseIfStatement=function(e){return this.next(),e.test=this.parseParenExpression(),e.consequent=this.parseStatement("if"),e.alternate=this.eat(Ee._else)?this.parseStatement("if"):null,this.finishNode(e,"IfStatement")};Ki.parseReturnStatement=function(e){return!this.inFunction&&!this.options.allowReturnOutsideFunction&&this.raise(this.start,"'return' outside of function"),this.next(),this.eat(Ee.semi)||this.insertSemicolon()?e.argument=null:(e.argument=this.parseExpression(),this.semicolon()),this.finishNode(e,"ReturnStatement")};Ki.parseSwitchStatement=function(e){this.next(),e.discriminant=this.parseParenExpression(),e.cases=[],this.expect(Ee.braceL),this.labels.push(XK),this.enterScope(0);for(var t,r=!1;this.type!==Ee.braceR;)if(this.type===Ee._case||this.type===Ee._default){var n=this.type===Ee._case;t&&this.finishNode(t,"SwitchCase"),e.cases.push(t=this.startNode()),t.consequent=[],this.next(),n?t.test=this.parseExpression():(r&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),r=!0,t.test=null),this.expect(Ee.colon)}else t||this.unexpected(),t.consequent.push(this.parseStatement(null));return this.exitScope(),t&&this.finishNode(t,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(e,"SwitchStatement")};Ki.parseThrowStatement=function(e){return this.next(),oh.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),e.argument=this.parseExpression(),this.semicolon(),this.finishNode(e,"ThrowStatement")};var YK=[];Ki.parseTryStatement=function(e){if(this.next(),e.block=this.parseBlock(),e.handler=null,this.type===Ee._catch){var t=this.startNode();if(this.next(),this.eat(Ee.parenL)){t.param=this.parseBindingAtom();var r=t.param.type==="Identifier";this.enterScope(r?hk:0),this.checkLVal(t.param,r?mk:kd),this.expect(Ee.parenR)}else this.options.ecmaVersion<10&&this.unexpected(),t.param=null,this.enterScope(0);t.body=this.parseBlock(!1),this.exitScope(),e.handler=this.finishNode(t,"CatchClause")}return e.finalizer=this.eat(Ee._finally)?this.parseBlock():null,!e.handler&&!e.finalizer&&this.raise(e.start,"Missing catch or finally clause"),this.finishNode(e,"TryStatement")};Ki.parseVarStatement=function(e,t){return this.next(),this.parseVar(e,!1,t),this.semicolon(),this.finishNode(e,"VariableDeclaration")};Ki.parseWhileStatement=function(e){return this.next(),e.test=this.parseParenExpression(),this.labels.push(OS),e.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(e,"WhileStatement")};Ki.parseWithStatement=function(e){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),e.object=this.parseParenExpression(),e.body=this.parseStatement("with"),this.finishNode(e,"WithStatement")};Ki.parseEmptyStatement=function(e){return this.next(),this.finishNode(e,"EmptyStatement")};Ki.parseLabeledStatement=function(e,t,r,n){for(var i=0,o=this.labels;i<o.length;i+=1){var a=o[i];a.name===t&&this.raise(r.start,"Label '"+t+"' is already declared")}for(var u=this.type.isLoop?"loop":this.type===Ee._switch?"switch":null,c=this.labels.length-1;c>=0;c--){var h=this.labels[c];if(h.statementStart===e.start)h.statementStart=this.start,h.kind=u;else break}return this.labels.push({name:t,kind:u,statementStart:this.start}),e.body=this.parseStatement(n?n.indexOf("label")===-1?n+"label":n:"label"),this.labels.pop(),e.label=r,this.finishNode(e,"LabeledStatement")};Ki.parseExpressionStatement=function(e,t){return e.expression=t,this.semicolon(),this.finishNode(e,"ExpressionStatement")};Ki.parseBlock=function(e,t,r){for(e===void 0&&(e=!0),t===void 0&&(t=this.startNode()),t.body=[],this.expect(Ee.braceL),e&&this.enterScope(0);this.type!==Ee.braceR;){var n=this.parseStatement(null);t.body.push(n)}return r&&(this.strict=!1),this.next(),e&&this.exitScope(),this.finishNode(t,"BlockStatement")};Ki.parseFor=function(e,t){return e.init=t,this.expect(Ee.semi),e.test=this.type===Ee.semi?null:this.parseExpression(),this.expect(Ee.semi),e.update=this.type===Ee.parenR?null:this.parseExpression(),this.expect(Ee.parenR),e.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(e,"ForStatement")};Ki.parseForIn=function(e,t){var r=this.type===Ee._in;return this.next(),t.type==="VariableDeclaration"&&t.declarations[0].init!=null&&(!r||this.options.ecmaVersion<8||this.strict||t.kind!=="var"||t.declarations[0].id.type!=="Identifier")?this.raise(t.start,(r?"for-in":"for-of")+" loop variable declaration may not have an initializer"):t.type==="AssignmentPattern"&&this.raise(t.start,"Invalid left-hand side in for-loop"),e.left=t,e.right=r?this.parseExpression():this.parseMaybeAssign(),this.expect(Ee.parenR),e.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(e,r?"ForInStatement":"ForOfStatement")};Ki.parseVar=function(e,t,r){for(e.declarations=[],e.kind=r;;){var n=this.startNode();if(this.parseVarId(n,r),this.eat(Ee.eq)?n.init=this.parseMaybeAssign(t):r==="const"&&!(this.type===Ee._in||this.options.ecmaVersion>=6&&this.isContextual("of"))?this.unexpected():n.id.type!=="Identifier"&&!(t&&(this.type===Ee._in||this.isContextual("of")))?this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):n.init=null,e.declarations.push(this.finishNode(n,"VariableDeclarator")),!this.eat(Ee.comma))break}return e};Ki.parseVarId=function(e,t){e.id=this.parseBindingAtom(),this.checkLVal(e.id,t==="var"?kS:kd,!1)};var My=1,Gw=2,yk=4;Ki.parseFunction=function(e,t,r,n){this.initFunction(e),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!n)&&(this.type===Ee.star&&t&Gw&&this.unexpected(),e.generator=this.eat(Ee.star)),this.options.ecmaVersion>=8&&(e.async=!!n),t&My&&(e.id=t&yk&&this.type!==Ee.name?null:this.parseIdent(),e.id&&!(t&Gw)&&this.checkLVal(e.id,this.strict||e.generator||e.async?this.treatFunctionsAsVar?kS:kd:vk));var i=this.yieldPos,o=this.awaitPos,a=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(LS(e.async,e.generator)),t&My||(e.id=this.type===Ee.name?this.parseIdent():null),this.parseFunctionParams(e),this.parseFunctionBody(e,r,!1),this.yieldPos=i,this.awaitPos=o,this.awaitIdentPos=a,this.finishNode(e,t&My?"FunctionDeclaration":"FunctionExpression")};Ki.parseFunctionParams=function(e){this.expect(Ee.parenL),e.params=this.parseBindingList(Ee.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()};Ki.parseClass=function(e,t){this.next();var r=this.strict;this.strict=!0,this.parseClassId(e,t),this.parseClassSuper(e);var n=this.startNode(),i=!1;for(n.body=[],this.expect(Ee.braceL);this.type!==Ee.braceR;){var o=this.parseClassElement(e.superClass!==null);o&&(n.body.push(o),o.type==="MethodDefinition"&&o.kind==="constructor"&&(i&&this.raise(o.start,"Duplicate constructor in the same class"),i=!0))}return this.strict=r,this.next(),e.body=this.finishNode(n,"ClassBody"),this.finishNode(e,t?"ClassDeclaration":"ClassExpression")};Ki.parseClassElement=function(e){var t=this;if(this.eat(Ee.semi))return null;var r=this.startNode(),n=function(c,h){h===void 0&&(h=!1);var y=t.start,x=t.startLoc;return t.eatContextual(c)?t.type!==Ee.parenL&&(!h||!t.canInsertSemicolon())?!0:(r.key&&t.unexpected(),r.computed=!1,r.key=t.startNodeAt(y,x),r.key.name=c,t.finishNode(r.key,"Identifier"),!1):!1};r.kind="method",r.static=n("static");var i=this.eat(Ee.star),o=!1;i||(this.options.ecmaVersion>=8&&n("async",!0)?(o=!0,i=this.options.ecmaVersion>=9&&this.eat(Ee.star)):n("get")?r.kind="get":n("set")&&(r.kind="set")),r.key||this.parsePropertyName(r);var a=r.key,u=!1;return!r.computed&&!r.static&&(a.type==="Identifier"&&a.name==="constructor"||a.type==="Literal"&&a.value==="constructor")?(r.kind!=="method"&&this.raise(a.start,"Constructor can't have get/set modifier"),i&&this.raise(a.start,"Constructor can't be a generator"),o&&this.raise(a.start,"Constructor can't be an async method"),r.kind="constructor",u=e):r.static&&a.type==="Identifier"&&a.name==="prototype"&&this.raise(a.start,"Classes may not have a static property named prototype"),this.parseClassMethod(r,i,o,u),r.kind==="get"&&r.value.params.length!==0&&this.raiseRecoverable(r.value.start,"getter should have no params"),r.kind==="set"&&r.value.params.length!==1&&this.raiseRecoverable(r.value.start,"setter should have exactly one param"),r.kind==="set"&&r.value.params[0].type==="RestElement"&&this.raiseRecoverable(r.value.params[0].start,"Setter cannot use rest params"),r};Ki.parseClassMethod=function(e,t,r,n){return e.value=this.parseMethod(t,r,n),this.finishNode(e,"MethodDefinition")};Ki.parseClassId=function(e,t){this.type===Ee.name?(e.id=this.parseIdent(),t&&this.checkLVal(e.id,kd,!1)):(t===!0&&this.unexpected(),e.id=null)};Ki.parseClassSuper=function(e){e.superClass=this.eat(Ee._extends)?this.parseExprSubscripts():null};Ki.parseExport=function(e,t){if(this.next(),this.eat(Ee.star))return this.options.ecmaVersion>=11&&(this.eatContextual("as")?(e.exported=this.parseIdent(!0),this.checkExport(t,e.exported.name,this.lastTokStart)):e.exported=null),this.expectContextual("from"),this.type!==Ee.string&&this.unexpected(),e.source=this.parseExprAtom(),this.semicolon(),this.finishNode(e,"ExportAllDeclaration");if(this.eat(Ee._default)){this.checkExport(t,"default",this.lastTokStart);var r;if(this.type===Ee._function||(r=this.isAsyncFunction())){var n=this.startNode();this.next(),r&&this.next(),e.declaration=this.parseFunction(n,My|yk,!1,r)}else if(this.type===Ee._class){var i=this.startNode();e.declaration=this.parseClass(i,"nullableID")}else e.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(e,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())e.declaration=this.parseStatement(null),e.declaration.type==="VariableDeclaration"?this.checkVariableExport(t,e.declaration.declarations):this.checkExport(t,e.declaration.id.name,e.declaration.id.start),e.specifiers=[],e.source=null;else{if(e.declaration=null,e.specifiers=this.parseExportSpecifiers(t),this.eatContextual("from"))this.type!==Ee.string&&this.unexpected(),e.source=this.parseExprAtom();else{for(var o=0,a=e.specifiers;o<a.length;o+=1){var u=a[o];this.checkUnreserved(u.local),this.checkLocalExport(u.local)}e.source=null}this.semicolon()}return this.finishNode(e,"ExportNamedDeclaration")};Ki.checkExport=function(e,t,r){e&&(Zx(e,t)&&this.raiseRecoverable(r,"Duplicate export '"+t+"'"),e[t]=!0)};Ki.checkPatternExport=function(e,t){var r=t.type;if(r==="Identifier")this.checkExport(e,t.name,t.start);else if(r==="ObjectPattern")for(var n=0,i=t.properties;n<i.length;n+=1){var o=i[n];this.checkPatternExport(e,o)}else if(r==="ArrayPattern")for(var a=0,u=t.elements;a<u.length;a+=1){var c=u[a];c&&this.checkPatternExport(e,c)}else r==="Property"?this.checkPatternExport(e,t.value):r==="AssignmentPattern"?this.checkPatternExport(e,t.left):r==="RestElement"?this.checkPatternExport(e,t.argument):r==="ParenthesizedExpression"&&this.checkPatternExport(e,t.expression)};Ki.checkVariableExport=function(e,t){if(e)for(var r=0,n=t;r<n.length;r+=1){var i=n[r];this.checkPatternExport(e,i.id)}};Ki.shouldParseExportStatement=function(){return this.type.keyword==="var"||this.type.keyword==="const"||this.type.keyword==="class"||this.type.keyword==="function"||this.isLet()||this.isAsyncFunction()};Ki.parseExportSpecifiers=function(e){var t=[],r=!0;for(this.expect(Ee.braceL);!this.eat(Ee.braceR);){if(r)r=!1;else if(this.expect(Ee.comma),this.afterTrailingComma(Ee.braceR))break;var n=this.startNode();n.local=this.parseIdent(!0),n.exported=this.eatContextual("as")?this.parseIdent(!0):n.local,this.checkExport(e,n.exported.name,n.exported.start),t.push(this.finishNode(n,"ExportSpecifier"))}return t};Ki.parseImport=function(e){return this.next(),this.type===Ee.string?(e.specifiers=YK,e.source=this.parseExprAtom()):(e.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),e.source=this.type===Ee.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(e,"ImportDeclaration")};Ki.parseImportSpecifiers=function(){var e=[],t=!0;if(this.type===Ee.name){var r=this.startNode();if(r.local=this.parseIdent(),this.checkLVal(r.local,kd),e.push(this.finishNode(r,"ImportDefaultSpecifier")),!this.eat(Ee.comma))return e}if(this.type===Ee.star){var n=this.startNode();return this.next(),this.expectContextual("as"),n.local=this.parseIdent(),this.checkLVal(n.local,kd),e.push(this.finishNode(n,"ImportNamespaceSpecifier")),e}for(this.expect(Ee.braceL);!this.eat(Ee.braceR);){if(t)t=!1;else if(this.expect(Ee.comma),this.afterTrailingComma(Ee.braceR))break;var i=this.startNode();i.imported=this.parseIdent(!0),this.eatContextual("as")?i.local=this.parseIdent():(this.checkUnreserved(i.imported),i.local=i.imported),this.checkLVal(i.local,kd),e.push(this.finishNode(i,"ImportSpecifier"))}return e};Ki.adaptDirectivePrologue=function(e){for(var t=0;t<e.length&&this.isDirectiveCandidate(e[t]);++t)e[t].directive=e[t].expression.raw.slice(1,-1)};Ki.isDirectiveCandidate=function(e){return e.type==="ExpressionStatement"&&e.expression.type==="Literal"&&typeof e.expression.value=="string"&&(this.input[e.start]==='"'||this.input[e.start]==="'")};var zd=lu.prototype;zd.toAssignable=function(e,t,r){if(this.options.ecmaVersion>=6&&e)switch(e.type){case"Identifier":this.inAsync&&e.name==="await"&&this.raise(e.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"RestElement":break;case"ObjectExpression":e.type="ObjectPattern",r&&this.checkPatternErrors(r,!0);for(var n=0,i=e.properties;n<i.length;n+=1){var o=i[n];this.toAssignable(o,t),o.type==="RestElement"&&(o.argument.type==="ArrayPattern"||o.argument.type==="ObjectPattern")&&this.raise(o.argument.start,"Unexpected token")}break;case"Property":e.kind!=="init"&&this.raise(e.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(e.value,t);break;case"ArrayExpression":e.type="ArrayPattern",r&&this.checkPatternErrors(r,!0),this.toAssignableList(e.elements,t);break;case"SpreadElement":e.type="RestElement",this.toAssignable(e.argument,t),e.argument.type==="AssignmentPattern"&&this.raise(e.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":e.operator!=="="&&this.raise(e.left.end,"Only '=' operator can be used for specifying default value."),e.type="AssignmentPattern",delete e.operator,this.toAssignable(e.left,t);case"AssignmentPattern":break;case"ParenthesizedExpression":this.toAssignable(e.expression,t,r);break;case"ChainExpression":this.raiseRecoverable(e.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!t)break;default:this.raise(e.start,"Assigning to rvalue")}else r&&this.checkPatternErrors(r,!0);return e};zd.toAssignableList=function(e,t){for(var r=e.length,n=0;n<r;n++){var i=e[n];i&&this.toAssignable(i,t)}if(r){var o=e[r-1];this.options.ecmaVersion===6&&t&&o&&o.type==="RestElement"&&o.argument.type!=="Identifier"&&this.unexpected(o.argument.start)}return e};zd.parseSpread=function(e){var t=this.startNode();return this.next(),t.argument=this.parseMaybeAssign(!1,e),this.finishNode(t,"SpreadElement")};zd.parseRestBinding=function(){var e=this.startNode();return this.next(),this.options.ecmaVersion===6&&this.type!==Ee.name&&this.unexpected(),e.argument=this.parseBindingAtom(),this.finishNode(e,"RestElement")};zd.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case Ee.bracketL:var e=this.startNode();return this.next(),e.elements=this.parseBindingList(Ee.bracketR,!0,!0),this.finishNode(e,"ArrayPattern");case Ee.braceL:return this.parseObj(!0)}return this.parseIdent()};zd.parseBindingList=function(e,t,r){for(var n=[],i=!0;!this.eat(e);)if(i?i=!1:this.expect(Ee.comma),t&&this.type===Ee.comma)n.push(null);else{if(r&&this.afterTrailingComma(e))break;if(this.type===Ee.ellipsis){var o=this.parseRestBinding();this.parseBindingListItem(o),n.push(o),this.type===Ee.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.expect(e);break}else{var a=this.parseMaybeDefault(this.start,this.startLoc);this.parseBindingListItem(a),n.push(a)}}return n};zd.parseBindingListItem=function(e){return e};zd.parseMaybeDefault=function(e,t,r){if(r=r||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(Ee.eq))return r;var n=this.startNodeAt(e,t);return n.left=r,n.right=this.parseMaybeAssign(),this.finishNode(n,"AssignmentPattern")};zd.checkLVal=function(e,t,r){switch(t===void 0&&(t=_4),e.type){case"Identifier":t===kd&&e.name==="let"&&this.raiseRecoverable(e.start,"let is disallowed as a lexically bound name"),this.strict&&this.reservedWordsStrictBind.test(e.name)&&this.raiseRecoverable(e.start,(t?"Binding ":"Assigning to ")+e.name+" in strict mode"),r&&(Zx(r,e.name)&&this.raiseRecoverable(e.start,"Argument name clash"),r[e.name]=!0),t!==_4&&t!==gk&&this.declareName(e.name,t,e.start);break;case"ChainExpression":this.raiseRecoverable(e.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":t&&this.raiseRecoverable(e.start,"Binding member expression");break;case"ObjectPattern":for(var n=0,i=e.properties;n<i.length;n+=1){var o=i[n];this.checkLVal(o,t,r)}break;case"Property":this.checkLVal(e.value,t,r);break;case"ArrayPattern":for(var a=0,u=e.elements;a<u.length;a+=1){var c=u[a];c&&this.checkLVal(c,t,r)}break;case"AssignmentPattern":this.checkLVal(e.left,t,r);break;case"RestElement":this.checkLVal(e.argument,t,r);break;case"ParenthesizedExpression":this.checkLVal(e.expression,t,r);break;default:this.raise(e.start,(t?"Binding":"Assigning to")+" rvalue")}};var fa=lu.prototype;fa.checkPropClash=function(e,t,r){if(!(this.options.ecmaVersion>=9&&e.type==="SpreadElement")&&!(this.options.ecmaVersion>=6&&(e.computed||e.method||e.shorthand))){var n=e.key,i;switch(n.type){case"Identifier":i=n.name;break;case"Literal":i=String(n.value);break;default:return}var o=e.kind;if(this.options.ecmaVersion>=6){i==="__proto__"&&o==="init"&&(t.proto&&(r?r.doubleProto<0&&(r.doubleProto=n.start):this.raiseRecoverable(n.start,"Redefinition of __proto__ property")),t.proto=!0);return}i="$"+i;var a=t[i];if(a){var u;o==="init"?u=this.strict&&a.init||a.get||a.set:u=a.init||a[o],u&&this.raiseRecoverable(n.start,"Redefinition of property")}else a=t[i]={init:!1,get:!1,set:!1};a[o]=!0}};fa.parseExpression=function(e,t){var r=this.start,n=this.startLoc,i=this.parseMaybeAssign(e,t);if(this.type===Ee.comma){var o=this.startNodeAt(r,n);for(o.expressions=[i];this.eat(Ee.comma);)o.expressions.push(this.parseMaybeAssign(e,t));return this.finishNode(o,"SequenceExpression")}return i};fa.parseMaybeAssign=function(e,t,r){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(e);this.exprAllowed=!1}var n=!1,i=-1,o=-1;t?(i=t.parenthesizedAssign,o=t.trailingComma,t.parenthesizedAssign=t.trailingComma=-1):(t=new Qx,n=!0);var a=this.start,u=this.startLoc;(this.type===Ee.parenL||this.type===Ee.name)&&(this.potentialArrowAt=this.start);var c=this.parseMaybeConditional(e,t);if(r&&(c=r.call(this,c,a,u)),this.type.isAssign){var h=this.startNodeAt(a,u);return h.operator=this.value,h.left=this.type===Ee.eq?this.toAssignable(c,!1,t):c,n||(t.parenthesizedAssign=t.trailingComma=t.doubleProto=-1),t.shorthandAssign>=h.left.start&&(t.shorthandAssign=-1),this.checkLVal(c),this.next(),h.right=this.parseMaybeAssign(e),this.finishNode(h,"AssignmentExpression")}else n&&this.checkExpressionErrors(t,!0);return i>-1&&(t.parenthesizedAssign=i),o>-1&&(t.trailingComma=o),c};fa.parseMaybeConditional=function(e,t){var r=this.start,n=this.startLoc,i=this.parseExprOps(e,t);if(this.checkExpressionErrors(t))return i;if(this.eat(Ee.question)){var o=this.startNodeAt(r,n);return o.test=i,o.consequent=this.parseMaybeAssign(),this.expect(Ee.colon),o.alternate=this.parseMaybeAssign(e),this.finishNode(o,"ConditionalExpression")}return i};fa.parseExprOps=function(e,t){var r=this.start,n=this.startLoc,i=this.parseMaybeUnary(t,!1);return this.checkExpressionErrors(t)||i.start===r&&i.type==="ArrowFunctionExpression"?i:this.parseExprOp(i,r,n,-1,e)};fa.parseExprOp=function(e,t,r,n,i){var o=this.type.binop;if(o!=null&&(!i||this.type!==Ee._in)&&o>n){var a=this.type===Ee.logicalOR||this.type===Ee.logicalAND,u=this.type===Ee.coalesce;u&&(o=Ee.logicalAND.binop);var c=this.value;this.next();var h=this.start,y=this.startLoc,x=this.parseExprOp(this.parseMaybeUnary(null,!1),h,y,o,i),E=this.buildBinary(t,r,e,x,c,a||u);return(a&&this.type===Ee.coalesce||u&&(this.type===Ee.logicalOR||this.type===Ee.logicalAND))&&this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses"),this.parseExprOp(E,t,r,n,i)}return e};fa.buildBinary=function(e,t,r,n,i,o){var a=this.startNodeAt(e,t);return a.left=r,a.operator=i,a.right=n,this.finishNode(a,o?"LogicalExpression":"BinaryExpression")};fa.parseMaybeUnary=function(e,t){var r=this.start,n=this.startLoc,i;if(this.isContextual("await")&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction))i=this.parseAwait(),t=!0;else if(this.type.prefix){var o=this.startNode(),a=this.type===Ee.incDec;o.operator=this.value,o.prefix=!0,this.next(),o.argument=this.parseMaybeUnary(null,!0),this.checkExpressionErrors(e,!0),a?this.checkLVal(o.argument):this.strict&&o.operator==="delete"&&o.argument.type==="Identifier"?this.raiseRecoverable(o.start,"Deleting local variable in strict mode"):t=!0,i=this.finishNode(o,a?"UpdateExpression":"UnaryExpression")}else{if(i=this.parseExprSubscripts(e),this.checkExpressionErrors(e))return i;for(;this.type.postfix&&!this.canInsertSemicolon();){var u=this.startNodeAt(r,n);u.operator=this.value,u.prefix=!1,u.argument=i,this.checkLVal(i),this.next(),i=this.finishNode(u,"UpdateExpression")}}return!t&&this.eat(Ee.starstar)?this.buildBinary(r,n,i,this.parseMaybeUnary(null,!1),"**",!1):i};fa.parseExprSubscripts=function(e){var t=this.start,r=this.startLoc,n=this.parseExprAtom(e);if(n.type==="ArrowFunctionExpression"&&this.input.slice(this.lastTokStart,this.lastTokEnd)!==")")return n;var i=this.parseSubscripts(n,t,r);return e&&i.type==="MemberExpression"&&(e.parenthesizedAssign>=i.start&&(e.parenthesizedAssign=-1),e.parenthesizedBind>=i.start&&(e.parenthesizedBind=-1)),i};fa.parseSubscripts=function(e,t,r,n){for(var i=this.options.ecmaVersion>=8&&e.type==="Identifier"&&e.name==="async"&&this.lastTokEnd===e.end&&!this.canInsertSemicolon()&&e.end-e.start===5&&this.potentialArrowAt===e.start,o=!1;;){var a=this.parseSubscript(e,t,r,n,i,o);if(a.optional&&(o=!0),a===e||a.type==="ArrowFunctionExpression"){if(o){var u=this.startNodeAt(t,r);u.expression=a,a=this.finishNode(u,"ChainExpression")}return a}e=a}};fa.parseSubscript=function(e,t,r,n,i,o){var a=this.options.ecmaVersion>=11,u=a&&this.eat(Ee.questionDot);n&&u&&this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");var c=this.eat(Ee.bracketL);if(c||u&&this.type!==Ee.parenL&&this.type!==Ee.backQuote||this.eat(Ee.dot)){var h=this.startNodeAt(t,r);h.object=e,h.property=c?this.parseExpression():this.parseIdent(this.options.allowReserved!=="never"),h.computed=!!c,c&&this.expect(Ee.bracketR),a&&(h.optional=u),e=this.finishNode(h,"MemberExpression")}else if(!n&&this.eat(Ee.parenL)){var y=new Qx,x=this.yieldPos,E=this.awaitPos,T=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var I=this.parseExprList(Ee.parenR,this.options.ecmaVersion>=8,!1,y);if(i&&!u&&!this.canInsertSemicolon()&&this.eat(Ee.arrow))return this.checkPatternErrors(y,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=x,this.awaitPos=E,this.awaitIdentPos=T,this.parseArrowExpression(this.startNodeAt(t,r),I,!0);this.checkExpressionErrors(y,!0),this.yieldPos=x||this.yieldPos,this.awaitPos=E||this.awaitPos,this.awaitIdentPos=T||this.awaitIdentPos;var k=this.startNodeAt(t,r);k.callee=e,k.arguments=I,a&&(k.optional=u),e=this.finishNode(k,"CallExpression")}else if(this.type===Ee.backQuote){(u||o)&&this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");var D=this.startNodeAt(t,r);D.tag=e,D.quasi=this.parseTemplate({isTagged:!0}),e=this.finishNode(D,"TaggedTemplateExpression")}return e};fa.parseExprAtom=function(e){this.type===Ee.slash&&this.readRegexp();var t,r=this.potentialArrowAt===this.start;switch(this.type){case Ee._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),t=this.startNode(),this.next(),this.type===Ee.parenL&&!this.allowDirectSuper&&this.raise(t.start,"super() call outside constructor of a subclass"),this.type!==Ee.dot&&this.type!==Ee.bracketL&&this.type!==Ee.parenL&&this.unexpected(),this.finishNode(t,"Super");case Ee._this:return t=this.startNode(),this.next(),this.finishNode(t,"ThisExpression");case Ee.name:var n=this.start,i=this.startLoc,o=this.containsEsc,a=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!o&&a.name==="async"&&!this.canInsertSemicolon()&&this.eat(Ee._function))return this.parseFunction(this.startNodeAt(n,i),0,!1,!0);if(r&&!this.canInsertSemicolon()){if(this.eat(Ee.arrow))return this.parseArrowExpression(this.startNodeAt(n,i),[a],!1);if(this.options.ecmaVersion>=8&&a.name==="async"&&this.type===Ee.name&&!o)return a=this.parseIdent(!1),(this.canInsertSemicolon()||!this.eat(Ee.arrow))&&this.unexpected(),this.parseArrowExpression(this.startNodeAt(n,i),[a],!0)}return a;case Ee.regexp:var u=this.value;return t=this.parseLiteral(u.value),t.regex={pattern:u.pattern,flags:u.flags},t;case Ee.num:case Ee.string:return this.parseLiteral(this.value);case Ee._null:case Ee._true:case Ee._false:return t=this.startNode(),t.value=this.type===Ee._null?null:this.type===Ee._true,t.raw=this.type.keyword,this.next(),this.finishNode(t,"Literal");case Ee.parenL:var c=this.start,h=this.parseParenAndDistinguishExpression(r);return e&&(e.parenthesizedAssign<0&&!this.isSimpleAssignTarget(h)&&(e.parenthesizedAssign=c),e.parenthesizedBind<0&&(e.parenthesizedBind=c)),h;case Ee.bracketL:return t=this.startNode(),this.next(),t.elements=this.parseExprList(Ee.bracketR,!0,!0,e),this.finishNode(t,"ArrayExpression");case Ee.braceL:return this.parseObj(!1,e);case Ee._function:return t=this.startNode(),this.next(),this.parseFunction(t,0);case Ee._class:return this.parseClass(this.startNode(),!1);case Ee._new:return this.parseNew();case Ee.backQuote:return this.parseTemplate();case Ee._import:return this.options.ecmaVersion>=11?this.parseExprImport():this.unexpected();default:this.unexpected()}};fa.parseExprImport=function(){var e=this.startNode();this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import");var t=this.parseIdent(!0);switch(this.type){case Ee.parenL:return this.parseDynamicImport(e);case Ee.dot:return e.meta=t,this.parseImportMeta(e);default:this.unexpected()}};fa.parseDynamicImport=function(e){if(this.next(),e.source=this.parseMaybeAssign(),!this.eat(Ee.parenR)){var t=this.start;this.eat(Ee.comma)&&this.eat(Ee.parenR)?this.raiseRecoverable(t,"Trailing comma is not allowed in import()"):this.unexpected(t)}return this.finishNode(e,"ImportExpression")};fa.parseImportMeta=function(e){this.next();var t=this.containsEsc;return e.property=this.parseIdent(!0),e.property.name!=="meta"&&this.raiseRecoverable(e.property.start,"The only valid meta property for import is 'import.meta'"),t&&this.raiseRecoverable(e.start,"'import.meta' must not contain escaped characters"),this.options.sourceType!=="module"&&this.raiseRecoverable(e.start,"Cannot use 'import.meta' outside a module"),this.finishNode(e,"MetaProperty")};fa.parseLiteral=function(e){var t=this.startNode();return t.value=e,t.raw=this.input.slice(this.start,this.end),t.raw.charCodeAt(t.raw.length-1)===110&&(t.bigint=t.raw.slice(0,-1).replace(/_/g,"")),this.next(),this.finishNode(t,"Literal")};fa.parseParenExpression=function(){this.expect(Ee.parenL);var e=this.parseExpression();return this.expect(Ee.parenR),e};fa.parseParenAndDistinguishExpression=function(e){var t=this.start,r=this.startLoc,n,i=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var o=this.start,a=this.startLoc,u=[],c=!0,h=!1,y=new Qx,x=this.yieldPos,E=this.awaitPos,T;for(this.yieldPos=0,this.awaitPos=0;this.type!==Ee.parenR;)if(c?c=!1:this.expect(Ee.comma),i&&this.afterTrailingComma(Ee.parenR,!0)){h=!0;break}else if(this.type===Ee.ellipsis){T=this.start,u.push(this.parseParenItem(this.parseRestBinding())),this.type===Ee.comma&&this.raise(this.start,"Comma is not permitted after the rest element");break}else u.push(this.parseMaybeAssign(!1,y,this.parseParenItem));var I=this.start,k=this.startLoc;if(this.expect(Ee.parenR),e&&!this.canInsertSemicolon()&&this.eat(Ee.arrow))return this.checkPatternErrors(y,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=x,this.awaitPos=E,this.parseParenArrowList(t,r,u);(!u.length||h)&&this.unexpected(this.lastTokStart),T&&this.unexpected(T),this.checkExpressionErrors(y,!0),this.yieldPos=x||this.yieldPos,this.awaitPos=E||this.awaitPos,u.length>1?(n=this.startNodeAt(o,a),n.expressions=u,this.finishNodeAt(n,"SequenceExpression",I,k)):n=u[0]}else n=this.parseParenExpression();if(this.options.preserveParens){var D=this.startNodeAt(t,r);return D.expression=n,this.finishNode(D,"ParenthesizedExpression")}else return n};fa.parseParenItem=function(e){return e};fa.parseParenArrowList=function(e,t,r){return this.parseArrowExpression(this.startNodeAt(e,t),r)};var qK=[];fa.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var e=this.startNode(),t=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(Ee.dot)){e.meta=t;var r=this.containsEsc;return e.property=this.parseIdent(!0),e.property.name!=="target"&&this.raiseRecoverable(e.property.start,"The only valid meta property for new is 'new.target'"),r&&this.raiseRecoverable(e.start,"'new.target' must not contain escaped characters"),this.inNonArrowFunction()||this.raiseRecoverable(e.start,"'new.target' can only be used in functions"),this.finishNode(e,"MetaProperty")}var n=this.start,i=this.startLoc,o=this.type===Ee._import;return e.callee=this.parseSubscripts(this.parseExprAtom(),n,i,!0),o&&e.callee.type==="ImportExpression"&&this.raise(n,"Cannot use new with import()"),this.eat(Ee.parenL)?e.arguments=this.parseExprList(Ee.parenR,this.options.ecmaVersion>=8,!1):e.arguments=qK,this.finishNode(e,"NewExpression")};fa.parseTemplateElement=function(e){var t=e.isTagged,r=this.startNode();return this.type===Ee.invalidTemplate?(t||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),r.value={raw:this.value,cooked:null}):r.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,`
`),cooked:this.value},this.next(),r.tail=this.type===Ee.backQuote,this.finishNode(r,"TemplateElement")};fa.parseTemplate=function(e){e===void 0&&(e={});var t=e.isTagged;t===void 0&&(t=!1);var r=this.startNode();this.next(),r.expressions=[];var n=this.parseTemplateElement({isTagged:t});for(r.quasis=[n];!n.tail;)this.type===Ee.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(Ee.dollarBraceL),r.expressions.push(this.parseExpression()),this.expect(Ee.braceR),r.quasis.push(n=this.parseTemplateElement({isTagged:t}));return this.next(),this.finishNode(r,"TemplateLiteral")};fa.isAsyncProp=function(e){return!e.computed&&e.key.type==="Identifier"&&e.key.name==="async"&&(this.type===Ee.name||this.type===Ee.num||this.type===Ee.string||this.type===Ee.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===Ee.star)&&!oh.test(this.input.slice(this.lastTokEnd,this.start))};fa.parseObj=function(e,t){var r=this.startNode(),n=!0,i={};for(r.properties=[],this.next();!this.eat(Ee.braceR);){if(n)n=!1;else if(this.expect(Ee.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(Ee.braceR))break;var o=this.parseProperty(e,t);e||this.checkPropClash(o,i,t),r.properties.push(o)}return this.finishNode(r,e?"ObjectPattern":"ObjectExpression")};fa.parseProperty=function(e,t){var r=this.startNode(),n,i,o,a;if(this.options.ecmaVersion>=9&&this.eat(Ee.ellipsis))return e?(r.argument=this.parseIdent(!1),this.type===Ee.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.finishNode(r,"RestElement")):(this.type===Ee.parenL&&t&&(t.parenthesizedAssign<0&&(t.parenthesizedAssign=this.start),t.parenthesizedBind<0&&(t.parenthesizedBind=this.start)),r.argument=this.parseMaybeAssign(!1,t),this.type===Ee.comma&&t&&t.trailingComma<0&&(t.trailingComma=this.start),this.finishNode(r,"SpreadElement"));this.options.ecmaVersion>=6&&(r.method=!1,r.shorthand=!1,(e||t)&&(o=this.start,a=this.startLoc),e||(n=this.eat(Ee.star)));var u=this.containsEsc;return this.parsePropertyName(r),!e&&!u&&this.options.ecmaVersion>=8&&!n&&this.isAsyncProp(r)?(i=!0,n=this.options.ecmaVersion>=9&&this.eat(Ee.star),this.parsePropertyName(r,t)):i=!1,this.parsePropertyValue(r,e,n,i,o,a,t,u),this.finishNode(r,"Property")};fa.parsePropertyValue=function(e,t,r,n,i,o,a,u){if((r||n)&&this.type===Ee.colon&&this.unexpected(),this.eat(Ee.colon))e.value=t?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,a),e.kind="init";else if(this.options.ecmaVersion>=6&&this.type===Ee.parenL)t&&this.unexpected(),e.kind="init",e.method=!0,e.value=this.parseMethod(r,n);else if(!t&&!u&&this.options.ecmaVersion>=5&&!e.computed&&e.key.type==="Identifier"&&(e.key.name==="get"||e.key.name==="set")&&this.type!==Ee.comma&&this.type!==Ee.braceR&&this.type!==Ee.eq){(r||n)&&this.unexpected(),e.kind=e.key.name,this.parsePropertyName(e),e.value=this.parseMethod(!1);var c=e.kind==="get"?0:1;if(e.value.params.length!==c){var h=e.value.start;e.kind==="get"?this.raiseRecoverable(h,"getter should have no params"):this.raiseRecoverable(h,"setter should have exactly one param")}else e.kind==="set"&&e.value.params[0].type==="RestElement"&&this.raiseRecoverable(e.value.params[0].start,"Setter cannot use rest params")}else this.options.ecmaVersion>=6&&!e.computed&&e.key.type==="Identifier"?((r||n)&&this.unexpected(),this.checkUnreserved(e.key),e.key.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=i),e.kind="init",t?e.value=this.parseMaybeDefault(i,o,e.key):this.type===Ee.eq&&a?(a.shorthandAssign<0&&(a.shorthandAssign=this.start),e.value=this.parseMaybeDefault(i,o,e.key)):e.value=e.key,e.shorthand=!0):this.unexpected()};fa.parsePropertyName=function(e){if(this.options.ecmaVersion>=6){if(this.eat(Ee.bracketL))return e.computed=!0,e.key=this.parseMaybeAssign(),this.expect(Ee.bracketR),e.key;e.computed=!1}return e.key=this.type===Ee.num||this.type===Ee.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never")};fa.initFunction=function(e){e.id=null,this.options.ecmaVersion>=6&&(e.generator=e.expression=!1),this.options.ecmaVersion>=8&&(e.async=!1)};fa.parseMethod=function(e,t,r){var n=this.startNode(),i=this.yieldPos,o=this.awaitPos,a=this.awaitIdentPos;return this.initFunction(n),this.options.ecmaVersion>=6&&(n.generator=e),this.options.ecmaVersion>=8&&(n.async=!!t),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(LS(t,n.generator)|pk|(r?dk:0)),this.expect(Ee.parenL),n.params=this.parseBindingList(Ee.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(n,!1,!0),this.yieldPos=i,this.awaitPos=o,this.awaitIdentPos=a,this.finishNode(n,"FunctionExpression")};fa.parseArrowExpression=function(e,t,r){var n=this.yieldPos,i=this.awaitPos,o=this.awaitIdentPos;return this.enterScope(LS(r,!1)|fk),this.initFunction(e),this.options.ecmaVersion>=8&&(e.async=!!r),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,e.params=this.toAssignableList(t,!0),this.parseFunctionBody(e,!0,!1),this.yieldPos=n,this.awaitPos=i,this.awaitIdentPos=o,this.finishNode(e,"ArrowFunctionExpression")};fa.parseFunctionBody=function(e,t,r){var n=t&&this.type!==Ee.braceL,i=this.strict,o=!1;if(n)e.body=this.parseMaybeAssign(),e.expression=!0,this.checkParams(e,!1);else{var a=this.options.ecmaVersion>=7&&!this.isSimpleParamList(e.params);(!i||a)&&(o=this.strictDirective(this.end),o&&a&&this.raiseRecoverable(e.start,"Illegal 'use strict' directive in function with non-simple parameter list"));var u=this.labels;this.labels=[],o&&(this.strict=!0),this.checkParams(e,!i&&!o&&!t&&!r&&this.isSimpleParamList(e.params)),this.strict&&e.id&&this.checkLVal(e.id,gk),e.body=this.parseBlock(!1,void 0,o&&!i),e.expression=!1,this.adaptDirectivePrologue(e.body.body),this.labels=u}this.exitScope()};fa.isSimpleParamList=function(e){for(var t=0,r=e;t<r.length;t+=1){var n=r[t];if(n.type!=="Identifier")return!1}return!0};fa.checkParams=function(e,t){for(var r={},n=0,i=e.params;n<i.length;n+=1){var o=i[n];this.checkLVal(o,kS,t?null:r)}};fa.parseExprList=function(e,t,r,n){for(var i=[],o=!0;!this.eat(e);){if(o)o=!1;else if(this.expect(Ee.comma),t&&this.afterTrailingComma(e))break;var a=void 0;r&&this.type===Ee.comma?a=null:this.type===Ee.ellipsis?(a=this.parseSpread(n),n&&this.type===Ee.comma&&n.trailingComma<0&&(n.trailingComma=this.start)):a=this.parseMaybeAssign(!1,n),i.push(a)}return i};fa.checkUnreserved=function(e){var t=e.start,r=e.end,n=e.name;if(this.inGenerator&&n==="yield"&&this.raiseRecoverable(t,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&n==="await"&&this.raiseRecoverable(t,"Cannot use 'await' as identifier inside an async function"),this.keywords.test(n)&&this.raise(t,"Unexpected keyword '"+n+"'"),!(this.options.ecmaVersion<6&&this.input.slice(t,r).indexOf("\\")!==-1)){var i=this.strict?this.reservedWordsStrict:this.reservedWords;i.test(n)&&(!this.inAsync&&n==="await"&&this.raiseRecoverable(t,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(t,"The keyword '"+n+"' is reserved"))}};fa.parseIdent=function(e,t){var r=this.startNode();return this.type===Ee.name?r.name=this.value:this.type.keyword?(r.name=this.type.keyword,(r.name==="class"||r.name==="function")&&(this.lastTokEnd!==this.lastTokStart+1||this.input.charCodeAt(this.lastTokStart)!==46)&&this.context.pop()):this.unexpected(),this.next(!!e),this.finishNode(r,"Identifier"),e||(this.checkUnreserved(r),r.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=r.start)),r};fa.parseYield=function(e){this.yieldPos||(this.yieldPos=this.start);var t=this.startNode();return this.next(),this.type===Ee.semi||this.canInsertSemicolon()||this.type!==Ee.star&&!this.type.startsExpr?(t.delegate=!1,t.argument=null):(t.delegate=this.eat(Ee.star),t.argument=this.parseMaybeAssign(e)),this.finishNode(t,"YieldExpression")};fa.parseAwait=function(){this.awaitPos||(this.awaitPos=this.start);var e=this.startNode();return this.next(),e.argument=this.parseMaybeUnary(null,!1),this.finishNode(e,"AwaitExpression")};var px=lu.prototype;px.raise=function(e,t){var r=uk(this.input,e);t+=" ("+r.line+":"+r.column+")";var n=new SyntaxError(t);throw n.pos=e,n.loc=r,n.raisedAt=this.pos,n};px.raiseRecoverable=px.raise;px.curPosition=function(){if(this.options.locations)return new r_(this.curLine,this.pos-this.lineStart)};var Bv=lu.prototype,ZK=function(t){this.flags=t,this.var=[],this.lexical=[],this.functions=[]};Bv.enterScope=function(e){this.scopeStack.push(new ZK(e))};Bv.exitScope=function(){this.scopeStack.pop()};Bv.treatFunctionsAsVarInScope=function(e){return e.flags&S_||!this.inModule&&e.flags&n_};Bv.declareName=function(e,t,r){var n=!1;if(t===kd){var i=this.currentScope();n=i.lexical.indexOf(e)>-1||i.functions.indexOf(e)>-1||i.var.indexOf(e)>-1,i.lexical.push(e),this.inModule&&i.flags&n_&&delete this.undefinedExports[e]}else if(t===mk){var o=this.currentScope();o.lexical.push(e)}else if(t===vk){var a=this.currentScope();this.treatFunctionsAsVar?n=a.lexical.indexOf(e)>-1:n=a.lexical.indexOf(e)>-1||a.var.indexOf(e)>-1,a.functions.push(e)}else for(var u=this.scopeStack.length-1;u>=0;--u){var c=this.scopeStack[u];if(c.lexical.indexOf(e)>-1&&!(c.flags&hk&&c.lexical[0]===e)||!this.treatFunctionsAsVarInScope(c)&&c.functions.indexOf(e)>-1){n=!0;break}if(c.var.push(e),this.inModule&&c.flags&n_&&delete this.undefinedExports[e],c.flags&RS)break}n&&this.raiseRecoverable(r,"Identifier '"+e+"' has already been declared")};Bv.checkLocalExport=function(e){this.scopeStack[0].lexical.indexOf(e.name)===-1&&this.scopeStack[0].var.indexOf(e.name)===-1&&(this.undefinedExports[e.name]=e)};Bv.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]};Bv.currentVarScope=function(){for(var e=this.scopeStack.length-1;;e--){var t=this.scopeStack[e];if(t.flags&RS)return t}};Bv.currentThisScope=function(){for(var e=this.scopeStack.length-1;;e--){var t=this.scopeStack[e];if(t.flags&RS&&!(t.flags&fk))return t}};var DS=function(t,r,n){this.type="",this.start=r,this.end=0,t.options.locations&&(this.loc=new Kx(t,n)),t.options.directSourceFile&&(this.sourceFile=t.options.directSourceFile),t.options.ranges&&(this.range=[r,0])},Jx=lu.prototype;Jx.startNode=function(){return new DS(this,this.start,this.startLoc)};Jx.startNodeAt=function(e,t){return new DS(this,e,t)};function _k(e,t,r,n){return e.type=t,e.end=r,this.options.locations&&(e.loc.end=n),this.options.ranges&&(e.range[1]=r),e}Jx.finishNode=function(e,t){return _k.call(this,e,t,this.lastTokEnd,this.lastTokEndLoc)};Jx.finishNodeAt=function(e,t,r,n){return _k.call(this,e,t,r,n)};var jh=function(t,r,n,i,o){this.token=t,this.isExpr=!!r,this.preserveSpace=!!n,this.override=i,this.generator=!!o},Gs={b_stat:new jh("{",!1),b_expr:new jh("{",!0),b_tmpl:new jh("${",!1),p_stat:new jh("(",!1),p_expr:new jh("(",!0),q_tmpl:new jh("`",!0,!0,function(e){return e.tryReadTemplateToken()}),f_stat:new jh("function",!1),f_expr:new jh("function",!0),f_expr_gen:new jh("function",!0,!1,null,!0),f_gen:new jh("function",!1,!1,null,!0)},eb=lu.prototype;eb.initialContext=function(){return[Gs.b_stat]};eb.braceIsBlock=function(e){var t=this.curContext();return t===Gs.f_expr||t===Gs.f_stat?!0:e===Ee.colon&&(t===Gs.b_stat||t===Gs.b_expr)?!t.isExpr:e===Ee._return||e===Ee.name&&this.exprAllowed?oh.test(this.input.slice(this.lastTokEnd,this.start)):e===Ee._else||e===Ee.semi||e===Ee.eof||e===Ee.parenR||e===Ee.arrow?!0:e===Ee.braceL?t===Gs.b_stat:e===Ee._var||e===Ee._const||e===Ee.name?!1:!this.exprAllowed};eb.inGeneratorContext=function(){for(var e=this.context.length-1;e>=1;e--){var t=this.context[e];if(t.token==="function")return t.generator}return!1};eb.updateContext=function(e){var t,r=this.type;r.keyword&&e===Ee.dot?this.exprAllowed=!1:(t=r.updateContext)?t.call(this,e):this.exprAllowed=r.beforeExpr};Ee.parenR.updateContext=Ee.braceR.updateContext=function(){if(this.context.length===1){this.exprAllowed=!0;return}var e=this.context.pop();e===Gs.b_stat&&this.curContext().token==="function"&&(e=this.context.pop()),this.exprAllowed=!e.isExpr};Ee.braceL.updateContext=function(e){this.context.push(this.braceIsBlock(e)?Gs.b_stat:Gs.b_expr),this.exprAllowed=!0};Ee.dollarBraceL.updateContext=function(){this.context.push(Gs.b_tmpl),this.exprAllowed=!0};Ee.parenL.updateContext=function(e){var t=e===Ee._if||e===Ee._for||e===Ee._with||e===Ee._while;this.context.push(t?Gs.p_stat:Gs.p_expr),this.exprAllowed=!0};Ee.incDec.updateContext=function(){};Ee._function.updateContext=Ee._class.updateContext=function(e){e.beforeExpr&&e!==Ee.semi&&e!==Ee._else&&!(e===Ee._return&&oh.test(this.input.slice(this.lastTokEnd,this.start)))&&!((e===Ee.colon||e===Ee.braceL)&&this.curContext()===Gs.b_stat)?this.context.push(Gs.f_expr):this.context.push(Gs.f_stat),this.exprAllowed=!1};Ee.backQuote.updateContext=function(){this.curContext()===Gs.q_tmpl?this.context.pop():this.context.push(Gs.q_tmpl),this.exprAllowed=!1};Ee.star.updateContext=function(e){if(e===Ee._function){var t=this.context.length-1;this.context[t]===Gs.f_expr?this.context[t]=Gs.f_expr_gen:this.context[t]=Gs.f_gen}this.exprAllowed=!0};Ee.name.updateContext=function(e){var t=!1;this.options.ecmaVersion>=6&&e!==Ee.dot&&(this.value==="of"&&!this.exprAllowed||this.value==="yield"&&this.inGeneratorContext())&&(t=!0),this.exprAllowed=t};var xk="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",bk=xk+" Extended_Pictographic",KK=bk,QK={9:xk,10:bk,11:KK},x4="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",wk="Adlam Adlm Ahom Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",Ek=wk+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",JK=Ek+" Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho",eQ={9:wk,10:Ek,11:JK},Sk={};function FS(e){var t=Sk[e]={binary:Cm(QK[e]+" "+x4),nonBinary:{General_Category:Cm(x4),Script:Cm(eQ[e])}};t.nonBinary.Script_Extensions=t.nonBinary.Script,t.nonBinary.gc=t.nonBinary.General_Category,t.nonBinary.sc=t.nonBinary.Script,t.nonBinary.scx=t.nonBinary.Script_Extensions}FS(9);FS(10);FS(11);var pi=lu.prototype,Ud=function(t){this.parser=t,this.validFlags="gim"+(t.options.ecmaVersion>=6?"uy":"")+(t.options.ecmaVersion>=9?"s":""),this.unicodeProperties=Sk[t.options.ecmaVersion>=11?11:t.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=[],this.backReferenceNames=[]};Ud.prototype.reset=function(t,r,n){var i=n.indexOf("u")!==-1;this.start=t|0,this.source=r+"",this.flags=n,this.switchU=i&&this.parser.options.ecmaVersion>=6,this.switchN=i&&this.parser.options.ecmaVersion>=9};Ud.prototype.raise=function(t){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+t)};Ud.prototype.at=function(t,r){r===void 0&&(r=!1);var n=this.source,i=n.length;if(t>=i)return-1;var o=n.charCodeAt(t);if(!(r||this.switchU)||o<=55295||o>=57344||t+1>=i)return o;var a=n.charCodeAt(t+1);return a>=56320&&a<=57343?(o<<10)+a-56613888:o};Ud.prototype.nextIndex=function(t,r){r===void 0&&(r=!1);var n=this.source,i=n.length;if(t>=i)return i;var o=n.charCodeAt(t),a;return!(r||this.switchU)||o<=55295||o>=57344||t+1>=i||(a=n.charCodeAt(t+1))<56320||a>57343?t+1:t+2};Ud.prototype.current=function(t){return t===void 0&&(t=!1),this.at(this.pos,t)};Ud.prototype.lookahead=function(t){return t===void 0&&(t=!1),this.at(this.nextIndex(this.pos,t),t)};Ud.prototype.advance=function(t){t===void 0&&(t=!1),this.pos=this.nextIndex(this.pos,t)};Ud.prototype.eat=function(t,r){return r===void 0&&(r=!1),this.current(r)===t?(this.advance(r),!0):!1};function dx(e){return e<=65535?String.fromCharCode(e):(e-=65536,String.fromCharCode((e>>10)+55296,(e&1023)+56320))}pi.validateRegExpFlags=function(e){for(var t=e.validFlags,r=e.flags,n=0;n<r.length;n++){var i=r.charAt(n);t.indexOf(i)===-1&&this.raise(e.start,"Invalid regular expression flag"),r.indexOf(i,n+1)>-1&&this.raise(e.start,"Duplicate regular expression flag")}};pi.validateRegExpPattern=function(e){this.regexp_pattern(e),!e.switchN&&this.options.ecmaVersion>=9&&e.groupNames.length>0&&(e.switchN=!0,this.regexp_pattern(e))};pi.regexp_pattern=function(e){e.pos=0,e.lastIntValue=0,e.lastStringValue="",e.lastAssertionIsQuantifiable=!1,e.numCapturingParens=0,e.maxBackReference=0,e.groupNames.length=0,e.backReferenceNames.length=0,this.regexp_disjunction(e),e.pos!==e.source.length&&(e.eat(41)&&e.raise("Unmatched ')'"),(e.eat(93)||e.eat(125))&&e.raise("Lone quantifier brackets")),e.maxBackReference>e.numCapturingParens&&e.raise("Invalid escape");for(var t=0,r=e.backReferenceNames;t<r.length;t+=1){var n=r[t];e.groupNames.indexOf(n)===-1&&e.raise("Invalid named capture referenced")}};pi.regexp_disjunction=function(e){for(this.regexp_alternative(e);e.eat(124);)this.regexp_alternative(e);this.regexp_eatQuantifier(e,!0)&&e.raise("Nothing to repeat"),e.eat(123)&&e.raise("Lone quantifier brackets")};pi.regexp_alternative=function(e){for(;e.pos<e.source.length&&this.regexp_eatTerm(e););};pi.regexp_eatTerm=function(e){return this.regexp_eatAssertion(e)?(e.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(e)&&e.switchU&&e.raise("Invalid quantifier"),!0):(e.switchU?this.regexp_eatAtom(e):this.regexp_eatExtendedAtom(e))?(this.regexp_eatQuantifier(e),!0):!1};pi.regexp_eatAssertion=function(e){var t=e.pos;if(e.lastAssertionIsQuantifiable=!1,e.eat(94)||e.eat(36))return!0;if(e.eat(92)){if(e.eat(66)||e.eat(98))return!0;e.pos=t}if(e.eat(40)&&e.eat(63)){var r=!1;if(this.options.ecmaVersion>=9&&(r=e.eat(60)),e.eat(61)||e.eat(33))return this.regexp_disjunction(e),e.eat(41)||e.raise("Unterminated group"),e.lastAssertionIsQuantifiable=!r,!0}return e.pos=t,!1};pi.regexp_eatQuantifier=function(e,t){return t===void 0&&(t=!1),this.regexp_eatQuantifierPrefix(e,t)?(e.eat(63),!0):!1};pi.regexp_eatQuantifierPrefix=function(e,t){return e.eat(42)||e.eat(43)||e.eat(63)||this.regexp_eatBracedQuantifier(e,t)};pi.regexp_eatBracedQuantifier=function(e,t){var r=e.pos;if(e.eat(123)){var n=0,i=-1;if(this.regexp_eatDecimalDigits(e)&&(n=e.lastIntValue,e.eat(44)&&this.regexp_eatDecimalDigits(e)&&(i=e.lastIntValue),e.eat(125)))return i!==-1&&i<n&&!t&&e.raise("numbers out of order in {} quantifier"),!0;e.switchU&&!t&&e.raise("Incomplete quantifier"),e.pos=r}return!1};pi.regexp_eatAtom=function(e){return this.regexp_eatPatternCharacters(e)||e.eat(46)||this.regexp_eatReverseSolidusAtomEscape(e)||this.regexp_eatCharacterClass(e)||this.regexp_eatUncapturingGroup(e)||this.regexp_eatCapturingGroup(e)};pi.regexp_eatReverseSolidusAtomEscape=function(e){var t=e.pos;if(e.eat(92)){if(this.regexp_eatAtomEscape(e))return!0;e.pos=t}return!1};pi.regexp_eatUncapturingGroup=function(e){var t=e.pos;if(e.eat(40)){if(e.eat(63)&&e.eat(58)){if(this.regexp_disjunction(e),e.eat(41))return!0;e.raise("Unterminated group")}e.pos=t}return!1};pi.regexp_eatCapturingGroup=function(e){if(e.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(e):e.current()===63&&e.raise("Invalid group"),this.regexp_disjunction(e),e.eat(41))return e.numCapturingParens+=1,!0;e.raise("Unterminated group")}return!1};pi.regexp_eatExtendedAtom=function(e){return e.eat(46)||this.regexp_eatReverseSolidusAtomEscape(e)||this.regexp_eatCharacterClass(e)||this.regexp_eatUncapturingGroup(e)||this.regexp_eatCapturingGroup(e)||this.regexp_eatInvalidBracedQuantifier(e)||this.regexp_eatExtendedPatternCharacter(e)};pi.regexp_eatInvalidBracedQuantifier=function(e){return this.regexp_eatBracedQuantifier(e,!0)&&e.raise("Nothing to repeat"),!1};pi.regexp_eatSyntaxCharacter=function(e){var t=e.current();return Ak(t)?(e.lastIntValue=t,e.advance(),!0):!1};function Ak(e){return e===36||e>=40&&e<=43||e===46||e===63||e>=91&&e<=94||e>=123&&e<=125}pi.regexp_eatPatternCharacters=function(e){for(var t=e.pos,r=0;(r=e.current())!==-1&&!Ak(r);)e.advance();return e.pos!==t};pi.regexp_eatExtendedPatternCharacter=function(e){var t=e.current();return t!==-1&&t!==36&&!(t>=40&&t<=43)&&t!==46&&t!==63&&t!==91&&t!==94&&t!==124?(e.advance(),!0):!1};pi.regexp_groupSpecifier=function(e){if(e.eat(63)){if(this.regexp_eatGroupName(e)){e.groupNames.indexOf(e.lastStringValue)!==-1&&e.raise("Duplicate capture group name"),e.groupNames.push(e.lastStringValue);return}e.raise("Invalid group")}};pi.regexp_eatGroupName=function(e){if(e.lastStringValue="",e.eat(60)){if(this.regexp_eatRegExpIdentifierName(e)&&e.eat(62))return!0;e.raise("Invalid capture group name")}return!1};pi.regexp_eatRegExpIdentifierName=function(e){if(e.lastStringValue="",this.regexp_eatRegExpIdentifierStart(e)){for(e.lastStringValue+=dx(e.lastIntValue);this.regexp_eatRegExpIdentifierPart(e);)e.lastStringValue+=dx(e.lastIntValue);return!0}return!1};pi.regexp_eatRegExpIdentifierStart=function(e){var t=e.pos,r=this.options.ecmaVersion>=11,n=e.current(r);return e.advance(r),n===92&&this.regexp_eatRegExpUnicodeEscapeSequence(e,r)&&(n=e.lastIntValue),tQ(n)?(e.lastIntValue=n,!0):(e.pos=t,!1)};function tQ(e){return Ov(e,!0)||e===36||e===95}pi.regexp_eatRegExpIdentifierPart=function(e){var t=e.pos,r=this.options.ecmaVersion>=11,n=e.current(r);return e.advance(r),n===92&&this.regexp_eatRegExpUnicodeEscapeSequence(e,r)&&(n=e.lastIntValue),rQ(n)?(e.lastIntValue=n,!0):(e.pos=t,!1)};function rQ(e){return tg(e,!0)||e===36||e===95||e===8204||e===8205}pi.regexp_eatAtomEscape=function(e){return this.regexp_eatBackReference(e)||this.regexp_eatCharacterClassEscape(e)||this.regexp_eatCharacterEscape(e)||e.switchN&&this.regexp_eatKGroupName(e)?!0:(e.switchU&&(e.current()===99&&e.raise("Invalid unicode escape"),e.raise("Invalid escape")),!1)};pi.regexp_eatBackReference=function(e){var t=e.pos;if(this.regexp_eatDecimalEscape(e)){var r=e.lastIntValue;if(e.switchU)return r>e.maxBackReference&&(e.maxBackReference=r),!0;if(r<=e.numCapturingParens)return!0;e.pos=t}return!1};pi.regexp_eatKGroupName=function(e){if(e.eat(107)){if(this.regexp_eatGroupName(e))return e.backReferenceNames.push(e.lastStringValue),!0;e.raise("Invalid named reference")}return!1};pi.regexp_eatCharacterEscape=function(e){return this.regexp_eatControlEscape(e)||this.regexp_eatCControlLetter(e)||this.regexp_eatZero(e)||this.regexp_eatHexEscapeSequence(e)||this.regexp_eatRegExpUnicodeEscapeSequence(e,!1)||!e.switchU&&this.regexp_eatLegacyOctalEscapeSequence(e)||this.regexp_eatIdentityEscape(e)};pi.regexp_eatCControlLetter=function(e){var t=e.pos;if(e.eat(99)){if(this.regexp_eatControlLetter(e))return!0;e.pos=t}return!1};pi.regexp_eatZero=function(e){return e.current()===48&&!tb(e.lookahead())?(e.lastIntValue=0,e.advance(),!0):!1};pi.regexp_eatControlEscape=function(e){var t=e.current();return t===116?(e.lastIntValue=9,e.advance(),!0):t===110?(e.lastIntValue=10,e.advance(),!0):t===118?(e.lastIntValue=11,e.advance(),!0):t===102?(e.lastIntValue=12,e.advance(),!0):t===114?(e.lastIntValue=13,e.advance(),!0):!1};pi.regexp_eatControlLetter=function(e){var t=e.current();return Tk(t)?(e.lastIntValue=t%32,e.advance(),!0):!1};function Tk(e){return e>=65&&e<=90||e>=97&&e<=122}pi.regexp_eatRegExpUnicodeEscapeSequence=function(e,t){t===void 0&&(t=!1);var r=e.pos,n=t||e.switchU;if(e.eat(117)){if(this.regexp_eatFixedHexDigits(e,4)){var i=e.lastIntValue;if(n&&i>=55296&&i<=56319){var o=e.pos;if(e.eat(92)&&e.eat(117)&&this.regexp_eatFixedHexDigits(e,4)){var a=e.lastIntValue;if(a>=56320&&a<=57343)return e.lastIntValue=(i-55296)*1024+(a-56320)+65536,!0}e.pos=o,e.lastIntValue=i}return!0}if(n&&e.eat(123)&&this.regexp_eatHexDigits(e)&&e.eat(125)&&nQ(e.lastIntValue))return!0;n&&e.raise("Invalid unicode escape"),e.pos=r}return!1};function nQ(e){return e>=0&&e<=1114111}pi.regexp_eatIdentityEscape=function(e){if(e.switchU)return this.regexp_eatSyntaxCharacter(e)?!0:e.eat(47)?(e.lastIntValue=47,!0):!1;var t=e.current();return t!==99&&(!e.switchN||t!==107)?(e.lastIntValue=t,e.advance(),!0):!1};pi.regexp_eatDecimalEscape=function(e){e.lastIntValue=0;var t=e.current();if(t>=49&&t<=57){do e.lastIntValue=10*e.lastIntValue+(t-48),e.advance();while((t=e.current())>=48&&t<=57);return!0}return!1};pi.regexp_eatCharacterClassEscape=function(e){var t=e.current();if(iQ(t))return e.lastIntValue=-1,e.advance(),!0;if(e.switchU&&this.options.ecmaVersion>=9&&(t===80||t===112)){if(e.lastIntValue=-1,e.advance(),e.eat(123)&&this.regexp_eatUnicodePropertyValueExpression(e)&&e.eat(125))return!0;e.raise("Invalid property name")}return!1};function iQ(e){return e===100||e===68||e===115||e===83||e===119||e===87}pi.regexp_eatUnicodePropertyValueExpression=function(e){var t=e.pos;if(this.regexp_eatUnicodePropertyName(e)&&e.eat(61)){var r=e.lastStringValue;if(this.regexp_eatUnicodePropertyValue(e)){var n=e.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(e,r,n),!0}}if(e.pos=t,this.regexp_eatLoneUnicodePropertyNameOrValue(e)){var i=e.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(e,i),!0}return!1};pi.regexp_validateUnicodePropertyNameAndValue=function(e,t,r){Zx(e.unicodeProperties.nonBinary,t)||e.raise("Invalid property name"),e.unicodeProperties.nonBinary[t].test(r)||e.raise("Invalid property value")};pi.regexp_validateUnicodePropertyNameOrValue=function(e,t){e.unicodeProperties.binary.test(t)||e.raise("Invalid property name")};pi.regexp_eatUnicodePropertyName=function(e){var t=0;for(e.lastStringValue="";Ck(t=e.current());)e.lastStringValue+=dx(t),e.advance();return e.lastStringValue!==""};function Ck(e){return Tk(e)||e===95}pi.regexp_eatUnicodePropertyValue=function(e){var t=0;for(e.lastStringValue="";aQ(t=e.current());)e.lastStringValue+=dx(t),e.advance();return e.lastStringValue!==""};function aQ(e){return Ck(e)||tb(e)}pi.regexp_eatLoneUnicodePropertyNameOrValue=function(e){return this.regexp_eatUnicodePropertyValue(e)};pi.regexp_eatCharacterClass=function(e){if(e.eat(91)){if(e.eat(94),this.regexp_classRanges(e),e.eat(93))return!0;e.raise("Unterminated character class")}return!1};pi.regexp_classRanges=function(e){for(;this.regexp_eatClassAtom(e);){var t=e.lastIntValue;if(e.eat(45)&&this.regexp_eatClassAtom(e)){var r=e.lastIntValue;e.switchU&&(t===-1||r===-1)&&e.raise("Invalid character class"),t!==-1&&r!==-1&&t>r&&e.raise("Range out of order in character class")}}};pi.regexp_eatClassAtom=function(e){var t=e.pos;if(e.eat(92)){if(this.regexp_eatClassEscape(e))return!0;if(e.switchU){var r=e.current();(r===99||Ik(r))&&e.raise("Invalid class escape"),e.raise("Invalid escape")}e.pos=t}var n=e.current();return n!==93?(e.lastIntValue=n,e.advance(),!0):!1};pi.regexp_eatClassEscape=function(e){var t=e.pos;if(e.eat(98))return e.lastIntValue=8,!0;if(e.switchU&&e.eat(45))return e.lastIntValue=45,!0;if(!e.switchU&&e.eat(99)){if(this.regexp_eatClassControlLetter(e))return!0;e.pos=t}return this.regexp_eatCharacterClassEscape(e)||this.regexp_eatCharacterEscape(e)};pi.regexp_eatClassControlLetter=function(e){var t=e.current();return tb(t)||t===95?(e.lastIntValue=t%32,e.advance(),!0):!1};pi.regexp_eatHexEscapeSequence=function(e){var t=e.pos;if(e.eat(120)){if(this.regexp_eatFixedHexDigits(e,2))return!0;e.switchU&&e.raise("Invalid escape"),e.pos=t}return!1};pi.regexp_eatDecimalDigits=function(e){var t=e.pos,r=0;for(e.lastIntValue=0;tb(r=e.current());)e.lastIntValue=10*e.lastIntValue+(r-48),e.advance();return e.pos!==t};function tb(e){return e>=48&&e<=57}pi.regexp_eatHexDigits=function(e){var t=e.pos,r=0;for(e.lastIntValue=0;Mk(r=e.current());)e.lastIntValue=16*e.lastIntValue+Pk(r),e.advance();return e.pos!==t};function Mk(e){return e>=48&&e<=57||e>=65&&e<=70||e>=97&&e<=102}function Pk(e){return e>=65&&e<=70?10+(e-65):e>=97&&e<=102?10+(e-97):e-48}pi.regexp_eatLegacyOctalEscapeSequence=function(e){if(this.regexp_eatOctalDigit(e)){var t=e.lastIntValue;if(this.regexp_eatOctalDigit(e)){var r=e.lastIntValue;t<=3&&this.regexp_eatOctalDigit(e)?e.lastIntValue=t*64+r*8+e.lastIntValue:e.lastIntValue=t*8+r}else e.lastIntValue=t;return!0}return!1};pi.regexp_eatOctalDigit=function(e){var t=e.current();return Ik(t)?(e.lastIntValue=t-48,e.advance(),!0):(e.lastIntValue=0,!1)};function Ik(e){return e>=48&&e<=55}pi.regexp_eatFixedHexDigits=function(e,t){var r=e.pos;e.lastIntValue=0;for(var n=0;n<t;++n){var i=e.current();if(!Mk(i))return e.pos=r,!1;e.lastIntValue=16*e.lastIntValue+Pk(i),e.advance()}return!0};var NS=function(t){this.type=t.type,this.value=t.value,this.start=t.start,this.end=t.end,t.options.locations&&(this.loc=new Kx(t,t.startLoc,t.endLoc)),t.options.ranges&&(this.range=[t.start,t.end])},Ca=lu.prototype;Ca.next=function(e){!e&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new NS(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()};Ca.getToken=function(){return this.next(),new NS(this)};typeof Symbol<"u"&&(Ca[Symbol.iterator]=function(){var e=this;return{next:function(){var t=e.getToken();return{done:t.type===Ee.eof,value:t}}}});Ca.curContext=function(){return this.context[this.context.length-1]};Ca.nextToken=function(){var e=this.curContext();if((!e||!e.preserveSpace)&&this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length)return this.finishToken(Ee.eof);if(e.override)return e.override(this);this.readToken(this.fullCharCodeAtPos())};Ca.readToken=function(e){return Ov(e,this.options.ecmaVersion>=6)||e===92?this.readWord():this.getTokenFromCode(e)};Ca.fullCharCodeAtPos=function(){var e=this.input.charCodeAt(this.pos);if(e<=55295||e>=57344)return e;var t=this.input.charCodeAt(this.pos+1);return(e<<10)+t-56613888};Ca.skipBlockComment=function(){var e=this.options.onComment&&this.curPosition(),t=this.pos,r=this.input.indexOf("*/",this.pos+=2);if(r===-1&&this.raise(this.pos-2,"Unterminated comment"),this.pos=r+2,this.options.locations){t_.lastIndex=t;for(var n;(n=t_.exec(this.input))&&n.index<this.pos;)++this.curLine,this.lineStart=n.index+n[0].length}this.options.onComment&&this.options.onComment(!0,this.input.slice(t+2,r),t,this.pos,e,this.curPosition())};Ca.skipLineComment=function(e){for(var t=this.pos,r=this.options.onComment&&this.curPosition(),n=this.input.charCodeAt(this.pos+=e);this.pos<this.input.length&&!E_(n);)n=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(t+e,this.pos),t,this.pos,r,this.curPosition())};Ca.skipSpace=function(){e:for(;this.pos<this.input.length;){var e=this.input.charCodeAt(this.pos);switch(e){case 32:case 160:++this.pos;break;case 13:this.input.charCodeAt(this.pos+1)===10&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break e}break;default:if(e>8&&e<14||e>=5760&&ok.test(String.fromCharCode(e)))++this.pos;else break e}}};Ca.finishToken=function(e,t){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var r=this.type;this.type=e,this.value=t,this.updateContext(r)};Ca.readToken_dot=function(){var e=this.input.charCodeAt(this.pos+1);if(e>=48&&e<=57)return this.readNumber(!0);var t=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&e===46&&t===46?(this.pos+=3,this.finishToken(Ee.ellipsis)):(++this.pos,this.finishToken(Ee.dot))};Ca.readToken_slash=function(){var e=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):e===61?this.finishOp(Ee.assign,2):this.finishOp(Ee.slash,1)};Ca.readToken_mult_modulo_exp=function(e){var t=this.input.charCodeAt(this.pos+1),r=1,n=e===42?Ee.star:Ee.modulo;return this.options.ecmaVersion>=7&&e===42&&t===42&&(++r,n=Ee.starstar,t=this.input.charCodeAt(this.pos+2)),t===61?this.finishOp(Ee.assign,r+1):this.finishOp(n,r)};Ca.readToken_pipe_amp=function(e){var t=this.input.charCodeAt(this.pos+1);if(t===e){if(this.options.ecmaVersion>=12){var r=this.input.charCodeAt(this.pos+2);if(r===61)return this.finishOp(Ee.assign,3)}return this.finishOp(e===124?Ee.logicalOR:Ee.logicalAND,2)}return t===61?this.finishOp(Ee.assign,2):this.finishOp(e===124?Ee.bitwiseOR:Ee.bitwiseAND,1)};Ca.readToken_caret=function(){var e=this.input.charCodeAt(this.pos+1);return e===61?this.finishOp(Ee.assign,2):this.finishOp(Ee.bitwiseXOR,1)};Ca.readToken_plus_min=function(e){var t=this.input.charCodeAt(this.pos+1);return t===e?t===45&&!this.inModule&&this.input.charCodeAt(this.pos+2)===62&&(this.lastTokEnd===0||oh.test(this.input.slice(this.lastTokEnd,this.pos)))?(this.skipLineComment(3),this.skipSpace(),this.nextToken()):this.finishOp(Ee.incDec,2):t===61?this.finishOp(Ee.assign,2):this.finishOp(Ee.plusMin,1)};Ca.readToken_lt_gt=function(e){var t=this.input.charCodeAt(this.pos+1),r=1;return t===e?(r=e===62&&this.input.charCodeAt(this.pos+2)===62?3:2,this.input.charCodeAt(this.pos+r)===61?this.finishOp(Ee.assign,r+1):this.finishOp(Ee.bitShift,r)):t===33&&e===60&&!this.inModule&&this.input.charCodeAt(this.pos+2)===45&&this.input.charCodeAt(this.pos+3)===45?(this.skipLineComment(4),this.skipSpace(),this.nextToken()):(t===61&&(r=2),this.finishOp(Ee.relational,r))};Ca.readToken_eq_excl=function(e){var t=this.input.charCodeAt(this.pos+1);return t===61?this.finishOp(Ee.equality,this.input.charCodeAt(this.pos+2)===61?3:2):e===61&&t===62&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(Ee.arrow)):this.finishOp(e===61?Ee.eq:Ee.prefix,1)};Ca.readToken_question=function(){var e=this.options.ecmaVersion;if(e>=11){var t=this.input.charCodeAt(this.pos+1);if(t===46){var r=this.input.charCodeAt(this.pos+2);if(r<48||r>57)return this.finishOp(Ee.questionDot,2)}if(t===63){if(e>=12){var n=this.input.charCodeAt(this.pos+2);if(n===61)return this.finishOp(Ee.assign,3)}return this.finishOp(Ee.coalesce,2)}}return this.finishOp(Ee.question,1)};Ca.getTokenFromCode=function(e){switch(e){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(Ee.parenL);case 41:return++this.pos,this.finishToken(Ee.parenR);case 59:return++this.pos,this.finishToken(Ee.semi);case 44:return++this.pos,this.finishToken(Ee.comma);case 91:return++this.pos,this.finishToken(Ee.bracketL);case 93:return++this.pos,this.finishToken(Ee.bracketR);case 123:return++this.pos,this.finishToken(Ee.braceL);case 125:return++this.pos,this.finishToken(Ee.braceR);case 58:return++this.pos,this.finishToken(Ee.colon);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(Ee.backQuote);case 48:var t=this.input.charCodeAt(this.pos+1);if(t===120||t===88)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(t===111||t===79)return this.readRadixNumber(8);if(t===98||t===66)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(e);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(e);case 124:case 38:return this.readToken_pipe_amp(e);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(e);case 60:case 62:return this.readToken_lt_gt(e);case 61:case 33:return this.readToken_eq_excl(e);case 63:return this.readToken_question();case 126:return this.finishOp(Ee.prefix,1)}this.raise(this.pos,"Unexpected character '"+BS(e)+"'")};Ca.finishOp=function(e,t){var r=this.input.slice(this.pos,this.pos+t);return this.pos+=t,this.finishToken(e,r)};Ca.readRegexp=function(){for(var e,t,r=this.pos;;){this.pos>=this.input.length&&this.raise(r,"Unterminated regular expression");var n=this.input.charAt(this.pos);if(oh.test(n)&&this.raise(r,"Unterminated regular expression"),e)e=!1;else{if(n==="[")t=!0;else if(n==="]"&&t)t=!1;else if(n==="/"&&!t)break;e=n==="\\"}++this.pos}var i=this.input.slice(r,this.pos);++this.pos;var o=this.pos,a=this.readWord1();this.containsEsc&&this.unexpected(o);var u=this.regexpState||(this.regexpState=new Ud(this));u.reset(r,i,a),this.validateRegExpFlags(u),this.validateRegExpPattern(u);var c=null;try{c=new RegExp(i,a)}catch{}return this.finishToken(Ee.regexp,{pattern:i,flags:a,value:c})};Ca.readInt=function(e,t,r){for(var n=this.options.ecmaVersion>=12&&t===void 0,i=r&&this.input.charCodeAt(this.pos)===48,o=this.pos,a=0,u=0,c=0,h=t??1/0;c<h;++c,++this.pos){var y=this.input.charCodeAt(this.pos),x=void 0;if(n&&y===95){i&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals"),u===95&&this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore"),c===0&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits"),u=y;continue}if(y>=97?x=y-97+10:y>=65?x=y-65+10:y>=48&&y<=57?x=y-48:x=1/0,x>=e)break;u=y,a=a*e+x}return n&&u===95&&this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits"),this.pos===o||t!=null&&this.pos-o!==t?null:a};function oQ(e,t){return t?parseInt(e,8):parseFloat(e.replace(/_/g,""))}function Rk(e){return typeof BigInt!="function"?null:BigInt(e.replace(/_/g,""))}Ca.readRadixNumber=function(e){var t=this.pos;this.pos+=2;var r=this.readInt(e);return r==null&&this.raise(this.start+2,"Expected number in radix "+e),this.options.ecmaVersion>=11&&this.input.charCodeAt(this.pos)===110?(r=Rk(this.input.slice(t,this.pos)),++this.pos):Ov(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(Ee.num,r)};Ca.readNumber=function(e){var t=this.pos;!e&&this.readInt(10,void 0,!0)===null&&this.raise(t,"Invalid number");var r=this.pos-t>=2&&this.input.charCodeAt(t)===48;r&&this.strict&&this.raise(t,"Invalid number");var n=this.input.charCodeAt(this.pos);if(!r&&!e&&this.options.ecmaVersion>=11&&n===110){var i=Rk(this.input.slice(t,this.pos));return++this.pos,Ov(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(Ee.num,i)}r&&/[89]/.test(this.input.slice(t,this.pos))&&(r=!1),n===46&&!r&&(++this.pos,this.readInt(10),n=this.input.charCodeAt(this.pos)),(n===69||n===101)&&!r&&(n=this.input.charCodeAt(++this.pos),(n===43||n===45)&&++this.pos,this.readInt(10)===null&&this.raise(t,"Invalid number")),Ov(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var o=oQ(this.input.slice(t,this.pos),r);return this.finishToken(Ee.num,o)};Ca.readCodePoint=function(){var e=this.input.charCodeAt(this.pos),t;if(e===123){this.options.ecmaVersion<6&&this.unexpected();var r=++this.pos;t=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,t>1114111&&this.invalidStringToken(r,"Code point out of bounds")}else t=this.readHexChar(4);return t};function BS(e){return e<=65535?String.fromCharCode(e):(e-=65536,String.fromCharCode((e>>10)+55296,(e&1023)+56320))}Ca.readString=function(e){for(var t="",r=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var n=this.input.charCodeAt(this.pos);if(n===e)break;n===92?(t+=this.input.slice(r,this.pos),t+=this.readEscapedChar(!1),r=this.pos):(E_(n,this.options.ecmaVersion>=10)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return t+=this.input.slice(r,this.pos++),this.finishToken(Ee.string,t)};var Lk={};Ca.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(e){if(e===Lk)this.readInvalidTemplateToken();else throw e}this.inTemplateElement=!1};Ca.invalidStringToken=function(e,t){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw Lk;this.raise(e,t)};Ca.readTmplToken=function(){for(var e="",t=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var r=this.input.charCodeAt(this.pos);if(r===96||r===36&&this.input.charCodeAt(this.pos+1)===123)return this.pos===this.start&&(this.type===Ee.template||this.type===Ee.invalidTemplate)?r===36?(this.pos+=2,this.finishToken(Ee.dollarBraceL)):(++this.pos,this.finishToken(Ee.backQuote)):(e+=this.input.slice(t,this.pos),this.finishToken(Ee.template,e));if(r===92)e+=this.input.slice(t,this.pos),e+=this.readEscapedChar(!0),t=this.pos;else if(E_(r)){switch(e+=this.input.slice(t,this.pos),++this.pos,r){case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:e+=`
`;break;default:e+=String.fromCharCode(r);break}this.options.locations&&(++this.curLine,this.lineStart=this.pos),t=this.pos}else++this.pos}};Ca.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if(this.input[this.pos+1]!=="{")break;case"`":return this.finishToken(Ee.invalidTemplate,this.input.slice(this.start,this.pos))}this.raise(this.start,"Unterminated template")};Ca.readEscapedChar=function(e){var t=this.input.charCodeAt(++this.pos);switch(++this.pos,t){case 110:return`
`;case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return BS(this.readCodePoint());case 116:return"	";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(e){var r=this.pos-1;return this.invalidStringToken(r,"Invalid escape sequence in template string"),null}default:if(t>=48&&t<=55){var n=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],i=parseInt(n,8);return i>255&&(n=n.slice(0,-1),i=parseInt(n,8)),this.pos+=n.length-1,t=this.input.charCodeAt(this.pos),(n!=="0"||t===56||t===57)&&(this.strict||e)&&this.invalidStringToken(this.pos-1-n.length,e?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(i)}return E_(t)?"":String.fromCharCode(t)}};Ca.readHexChar=function(e){var t=this.pos,r=this.readInt(16,e);return r===null&&this.invalidStringToken(t,"Bad character escape sequence"),r};Ca.readWord1=function(){this.containsEsc=!1;for(var e="",t=!0,r=this.pos,n=this.options.ecmaVersion>=6;this.pos<this.input.length;){var i=this.fullCharCodeAtPos();if(tg(i,n))this.pos+=i<=65535?1:2;else if(i===92){this.containsEsc=!0,e+=this.input.slice(r,this.pos);var o=this.pos;this.input.charCodeAt(++this.pos)!==117&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var a=this.readCodePoint();(t?Ov:tg)(a,n)||this.invalidStringToken(o,"Invalid Unicode escape"),e+=BS(a),r=this.pos}else break;t=!1}return e+this.input.slice(r,this.pos)};Ca.readWord=function(){var e=this.readWord1(),t=Ee.name;return this.keywords.test(e)&&(t=IS[e]),this.finishToken(t,e)};var sQ="7.4.1";lu.acorn={Parser:lu,version:sQ,defaultOptions:$w,Position:r_,SourceLocation:Kx,getLineInfo:uk,Node:DS,TokenType:Za,tokTypes:Ee,keywordTypes:IS,TokContext:jh,tokContexts:Gs,isIdentifierChar:tg,isIdentifierStart:Ov,Token:NS,isNewLine:E_,lineBreak:oh,lineBreakG:t_,nonASCIIwhitespace:ok};function uQ(e,t){return lu.parse(e,t)}function Wm(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}function rg(e){var t=typeof Map=="function"?new Map:void 0;return rg=function(n){if(n===null||!cQ(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(typeof t<"u"){if(t.has(n))return t.get(n);t.set(n,i)}function i(){return O1(n,arguments,Hw(this).constructor)}return i.prototype=Object.create(n.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),vx(i,n)},rg(e)}function lQ(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function O1(e,t,r){return lQ()?O1=Reflect.construct:O1=function(i,o,a){var u=[null];u.push.apply(u,o);var c=Function.bind.apply(i,u),h=new c;return a&&vx(h,a.prototype),h},O1.apply(null,arguments)}function cQ(e){return Function.toString.call(e).indexOf("[native code]")!==-1}function vx(e,t){return vx=Object.setPrototypeOf||function(n,i){return n.__proto__=i,n},vx(e,t)}function Hw(e){return Hw=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},Hw(e)}var fQ=function(e){Wm(t,e);function t(){return e.apply(this,arguments)||this}return t}(rg(Error)),hQ=function(e){Wm(t,e);function t(){return e.apply(this,arguments)||this}return t}(rg(SyntaxError)),Ww=function(e){Wm(t,e);function t(){return e.apply(this,arguments)||this}return t}(rg(ReferenceError)),pQ=function(e){Wm(t,e);function t(){return e.apply(this,arguments)||this}return t}(rg(TypeError)),Xw=function(e){Wm(t,e);function t(){return e.apply(this,arguments)||this}return t}(fQ),dQ=function(e){Wm(t,e);function t(){return e.apply(this,arguments)||this}return t}(hQ),$h=function(e){Wm(t,e);function t(){return e.apply(this,arguments)||this}return t}(Ww),Dl={UnknownError:[3001,"%0",Xw],ExecutionTimeOutError:[3002,"Script execution timed out after %0ms",Xw],NodeTypeSyntaxError:[1001,"Unknown node type: %0",$h],BinaryOperatorSyntaxError:[1002,"Unknown binary operator: %0",$h],LogicalOperatorSyntaxError:[1003,"Unknown logical operator: %0",$h],UnaryOperatorSyntaxError:[1004,"Unknown unary operator: %0",$h],UpdateOperatorSyntaxError:[1005,"Unknown update operator: %0",$h],ObjectStructureSyntaxError:[1006,"Unknown object structure: %0",$h],AssignmentExpressionSyntaxError:[1007,"Unknown assignment expression: %0",$h],VariableTypeSyntaxError:[1008,"Unknown variable type: %0",$h],ParamTypeSyntaxError:[1009,"Unknown param type: %0",$h],AssignmentTypeSyntaxError:[1010,"Unknown assignment type: %0",$h],FunctionUndefinedReferenceError:[2001,"%0 is not a function",Ww],VariableUndefinedReferenceError:[2002,"%0 is not defined",Ww],IsNotConstructor:[2003,"%0 is not a constructor",pQ]};function vQ(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function D1(e,t,r){return vQ()?D1=Reflect.construct:D1=function(i,o,a){var u=[null];u.push.apply(u,o);var c=Function.bind.apply(i,u),h=new c;return a&&Yw(h,a.prototype),h},D1.apply(null,arguments)}function Yw(e,t){return Yw=Object.setPrototypeOf||function(n,i){return n.__proto__=i,n},Yw(e,t)}var mQ="0.0.3";function b4(e,t){Object.defineProperty(e,"name",{value:t,writable:!1,enumerable:!1,configurable:!0})}var gQ=Object.prototype.hasOwnProperty,_m=Symbol("Break"),xm=Symbol("Continue"),w4=Symbol("DefaultCase"),Uu=Symbol("EmptyStatementReturn"),E4=Symbol("WithScopeName"),S4=Symbol("SuperScopeName"),A4=Symbol("RootScopeName"),T4=Symbol("GlobalScopeName");function w2(e){return typeof e=="function"}var xv=function(){function e(r){this.interpreter=r}var t=e.prototype;return t.generator=function(){var n=this.interpreter;function i(){return this.getCurrentScope()}function o(){return this.getGlobalScope()}function a(){return this.getCurrentContext()}return{getOptions:n.getOptions.bind(n),getCurrentScope:i.bind(n),getGlobalScope:o.bind(n),getCurrentContext:a.bind(n),getExecStartTime:n.getExecStartTime.bind(n)}},e}();function zS(e,t,r){if(r===void 0&&(r=!0),!(e instanceof xv))throw new Error("Illegal call");if(typeof t!="string")return t;if(t){var n=e.generator(),i=n.getOptions(),o={timeout:i.timeout,_initEnv:function(){r||this.setCurrentContext(n.getCurrentContext()),this.execStartTime=n.getExecStartTime(),this.execEndTime=this.execStartTime}},a=r?n.getGlobalScope():n.getCurrentScope(),u=new Kh(a,o);return u.evaluate(t)}}Object.defineProperty(zS,"__IS_EVAL_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});function US(e){if(!(e instanceof xv))throw new Error("Illegal call");for(var t=e.generator(),r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];var o=n.pop(),a=new Kh(t.getGlobalScope(),t.getOptions()),u=`
		    (function anonymous(`+n.join(",")+`){
		        `+o+`
		    });
		    `;return a.evaluate(u)}Object.defineProperty(US,"__IS_FUNCTION_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});var Tp=function(t){this.value=t},bm=function(t){this.value=t},dv=function(t){this.value=t},L0=function(t,r,n){r===void 0&&(r=null),this.name=n,this.parent=r,this.data=t,this.labelStack=[]};function h1(){}function yQ(e,t){return e===void 0&&(e=null),new L0(Object.create(null),e,t)}function _Q(e){return Object.create(e)}var Hp={NaN:NaN,Infinity:1/0,undefined:void 0,Object,Array,String,Boolean,Number,Date,RegExp,Error,URIError,TypeError,RangeError,SyntaxError,ReferenceError,Float32Array,Float64Array,Uint32Array,Math,parseInt,parseFloat,isNaN,isFinite,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,escape,unescape,eval:zS,Function:US};typeof JSON<"u"&&(Hp.JSON=JSON);typeof Promise<"u"&&(Hp.Promise=Promise);typeof Set<"u"&&(Hp.Set=Set);typeof Map<"u"&&(Hp.Map=Map);typeof Symbol<"u"&&(Hp.Symbol=Symbol);typeof Proxy<"u"&&(Hp.Proxy=Proxy);typeof WeakMap<"u"&&(Hp.WeakMap=WeakMap);typeof WeakSet<"u"&&(Hp.WeakSet=WeakSet);typeof Reflect<"u"&&(Hp.Reflect=Reflect);var Kh=function(){function e(r,n){r===void 0&&(r=e.global),n===void 0&&(n={}),this.sourceList=[],this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.isVarDeclMode=!1,this.lastExecNode=null,this.isRunning=!1,this.options={ecmaVersion:n.ecmaVersion||e.ecmaVersion,timeout:n.timeout||0,rootContext:n.rootContext,globalContextInFunction:n.globalContextInFunction===void 0?e.globalContextInFunction:n.globalContextInFunction,_initEnv:n._initEnv},this.context=r||Object.create(null),this.callStack=[],this.initEnvironment(this.context)}var t=e.prototype;return t.initEnvironment=function(n){var i;if(n instanceof L0)i=n;else{var o=null,a=this.createSuperScope(n);this.options.rootContext&&(o=new L0(_Q(this.options.rootContext),a,A4)),i=new L0(n,o||a,T4)}this.globalScope=i,this.currentScope=this.globalScope,this.globalContext=i.data,this.currentContext=i.data,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.execStartTime=Date.now(),this.execEndTime=this.execStartTime;var u=this.options._initEnv;u&&u.call(this)},t.getExecStartTime=function(){return this.execStartTime},t.getExecutionTime=function(){return this.execEndTime-this.execStartTime},t.setExecTimeout=function(n){n===void 0&&(n=0),this.options.timeout=n},t.getOptions=function(){return this.options},t.getGlobalScope=function(){return this.globalScope},t.getCurrentScope=function(){return this.currentScope},t.getCurrentContext=function(){return this.currentContext},t.isInterruptThrow=function(n){return n instanceof Xw||n instanceof $h||n instanceof dQ},t.createSuperScope=function(n){var i=Object.assign({},Hp),o=Object.keys(i);return o.forEach(function(a){a in n&&delete i[a]}),new L0(i,null,S4)},t.setCurrentContext=function(n){this.currentContext=n},t.setCurrentScope=function(n){this.currentScope=n},t.evaluate=function(n){n===void 0&&(n="");var i;if(n)return i=uQ(n,{ranges:!0,locations:!0,ecmaVersion:this.options.ecmaVersion||e.ecmaVersion}),this.evaluateNode(i,n)},t.appendCode=function(n){return this.evaluate(n)},t.evaluateNode=function(n,i){var o=this;i===void 0&&(i=""),this.value=void 0,this.source=i,this.sourceList.push(i),this.isRunning=!0,this.execStartTime=Date.now(),this.execEndTime=this.execStartTime,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var a=this.getCurrentScope(),u=this.getCurrentContext(),c=a.labelStack.concat([]),h=this.callStack.concat([]),y=function(){o.setCurrentScope(a),o.setCurrentContext(u),a.labelStack=c,o.callStack=h};try{var x=this.createClosure(n);this.addDeclarationsToScope(this.collectDeclVars,this.collectDeclFuncs,this.getCurrentScope()),x()}catch(E){throw E}finally{y(),this.execEndTime=Date.now()}return this.isRunning=!1,this.getValue()},t.createErrorMessage=function(n,i,o){var a=n[1].replace("%0",String(i));return o!==null&&(a+=this.getNodePosition(o||this.lastExecNode)),a},t.createError=function(n,i){return new i(n)},t.createThrowError=function(n,i){return this.createError(n,i)},t.createInternalThrowError=function(n,i,o){return this.createError(this.createErrorMessage(n,i,o),n[2])},t.checkTimeout=function(){if(!this.isRunning)return!1;var n=this.options.timeout||0,i=Date.now();return i-this.execStartTime>n},t.getNodePosition=function(n){if(n){var i="";return n.loc?" ["+n.loc.start.line+":"+n.loc.start.column+"]"+i:""}return""},t.createClosure=function(n){var i=this,o;switch(n.type){case"BinaryExpression":o=this.binaryExpressionHandler(n);break;case"LogicalExpression":o=this.logicalExpressionHandler(n);break;case"UnaryExpression":o=this.unaryExpressionHandler(n);break;case"UpdateExpression":o=this.updateExpressionHandler(n);break;case"ObjectExpression":o=this.objectExpressionHandler(n);break;case"ArrayExpression":o=this.arrayExpressionHandler(n);break;case"CallExpression":o=this.callExpressionHandler(n);break;case"NewExpression":o=this.newExpressionHandler(n);break;case"MemberExpression":o=this.memberExpressionHandler(n);break;case"ThisExpression":o=this.thisExpressionHandler(n);break;case"SequenceExpression":o=this.sequenceExpressionHandler(n);break;case"Literal":o=this.literalHandler(n);break;case"Identifier":o=this.identifierHandler(n);break;case"AssignmentExpression":o=this.assignmentExpressionHandler(n);break;case"FunctionDeclaration":o=this.functionDeclarationHandler(n);break;case"VariableDeclaration":o=this.variableDeclarationHandler(n);break;case"BlockStatement":case"Program":o=this.programHandler(n);break;case"ExpressionStatement":o=this.expressionStatementHandler(n);break;case"EmptyStatement":o=this.emptyStatementHandler(n);break;case"ReturnStatement":o=this.returnStatementHandler(n);break;case"FunctionExpression":o=this.functionExpressionHandler(n);break;case"IfStatement":o=this.ifStatementHandler(n);break;case"ConditionalExpression":o=this.conditionalExpressionHandler(n);break;case"ForStatement":o=this.forStatementHandler(n);break;case"WhileStatement":o=this.whileStatementHandler(n);break;case"DoWhileStatement":o=this.doWhileStatementHandler(n);break;case"ForInStatement":o=this.forInStatementHandler(n);break;case"WithStatement":o=this.withStatementHandler(n);break;case"ThrowStatement":o=this.throwStatementHandler(n);break;case"TryStatement":o=this.tryStatementHandler(n);break;case"ContinueStatement":o=this.continueStatementHandler(n);break;case"BreakStatement":o=this.breakStatementHandler(n);break;case"SwitchStatement":o=this.switchStatementHandler(n);break;case"LabeledStatement":o=this.labeledStatementHandler(n);break;case"DebuggerStatement":o=this.debuggerStatementHandler(n);break;default:throw this.createInternalThrowError(Dl.NodeTypeSyntaxError,n.type,n)}return function(){var a=i.options.timeout;if(a&&a>0&&i.checkTimeout())throw i.createInternalThrowError(Dl.ExecutionTimeOutError,a,null);return i.lastExecNode=n,o.apply(void 0,arguments)}},t.binaryExpressionHandler=function(n){var i=this,o=this.createClosure(n.left),a=this.createClosure(n.right);return function(){var u=o(),c=a();switch(n.operator){case"==":return u==c;case"!=":return u!=c;case"===":return u===c;case"!==":return u!==c;case"<":return u<c;case"<=":return u<=c;case">":return u>c;case">=":return u>=c;case"<<":return u<<c;case">>":return u>>c;case">>>":return u>>>c;case"+":return u+c;case"-":return u-c;case"*":return u*c;case"**":return Math.pow(u,c);case"/":return u/c;case"%":return u%c;case"|":return u|c;case"^":return u^c;case"&":return u&c;case"in":return u in c;case"instanceof":return u instanceof c;default:throw i.createInternalThrowError(Dl.BinaryOperatorSyntaxError,n.operator,n)}}},t.logicalExpressionHandler=function(n){var i=this,o=this.createClosure(n.left),a=this.createClosure(n.right);return function(){switch(n.operator){case"||":return o()||a();case"&&":return o()&&a();default:throw i.createInternalThrowError(Dl.LogicalOperatorSyntaxError,n.operator,n)}}},t.unaryExpressionHandler=function(n){var i=this;switch(n.operator){case"delete":var o=this.createObjectGetter(n.argument),a=this.createNameGetter(n.argument);return function(){var y=o(),x=a();return delete y[x]};default:var u;if(n.operator==="typeof"&&n.argument.type==="Identifier"){var c=this.createObjectGetter(n.argument),h=this.createNameGetter(n.argument);u=function(){return c()[h()]}}else u=this.createClosure(n.argument);return function(){var y=u();switch(n.operator){case"-":return-y;case"+":return+y;case"!":return!y;case"~":return~y;case"void":return;case"typeof":return typeof y;default:throw i.createInternalThrowError(Dl.UnaryOperatorSyntaxError,n.operator,n)}}}},t.updateExpressionHandler=function(n){var i=this,o=this.createObjectGetter(n.argument),a=this.createNameGetter(n.argument);return function(){var u=o(),c=a();switch(i.assertVariable(u,c,n),n.operator){case"++":return n.prefix?++u[c]:u[c]++;case"--":return n.prefix?--u[c]:u[c]--;default:throw i.createInternalThrowError(Dl.UpdateOperatorSyntaxError,n.operator,n)}}},t.objectExpressionHandler=function(n){var i=this,o=[];function a(c){return c.type==="Identifier"?c.name:c.type==="Literal"?c.value:this.throwError(Dl.ObjectStructureSyntaxError,c.type,c)}var u=Object.create(null);return n.properties.forEach(function(c){var h=c.kind,y=a(c.key);(!u[y]||h==="init")&&(u[y]={}),u[y][h]=i.createClosure(c.value),o.push({key:y,property:c})}),function(){for(var c={},h=o.length,y=0;y<h;y++){var x=o[y],E=x.key,T=u[E],I=T.init?T.init():void 0,k=T.get?T.get():function(){},D=T.set?T.set():function(N){};if("set"in T||"get"in T){var V={configurable:!0,enumerable:!0,get:k,set:D};Object.defineProperty(c,E,V)}else{var O=x.property,F=O.kind;O.key.type==="Identifier"&&O.value.type==="FunctionExpression"&&F==="init"&&!O.value.id&&b4(I,O.key.name),c[E]=I}}return c}},t.arrayExpressionHandler=function(n){var i=this,o=n.elements.map(function(a){return a&&i.createClosure(a)});return function(){for(var a=o.length,u=Array(a),c=0;c<a;c++){var h=o[c];h&&(u[c]=h())}return u}},t.safeObjectGet=function(n,i,o){return n[i]},t.createCallFunctionGetter=function(n){var i=this;switch(n.type){case"MemberExpression":var o=this.createClosure(n.object),a=this.createMemberKeyGetter(n),u=this.source;return function(){var h=o(),y=a(),x=i.safeObjectGet(h,y,n);if(!x||!w2(x)){var E=u.slice(n.start,n.end);throw i.createInternalThrowError(Dl.FunctionUndefinedReferenceError,E,n)}return x.__IS_EVAL_FUNC?function(T){return x(new xv(i),T,!0)}:x.__IS_FUNCTION_FUNC?function(){for(var T=arguments.length,I=new Array(T),k=0;k<T;k++)I[k]=arguments[k];return x.apply(void 0,[new xv(i)].concat(I))}:x.bind(h)};default:var c=this.createClosure(n);return function(){var h="";n.type==="Identifier"&&(h=n.name);var y=c();if(!y||!w2(y))throw i.createInternalThrowError(Dl.FunctionUndefinedReferenceError,h,n);if(n.type==="Identifier"&&y.__IS_EVAL_FUNC&&h==="eval")return function(T){var I=i.getScopeFromName(h,i.getCurrentScope()),k=I.name===S4||I.name===T4||I.name===A4;return y(new xv(i),T,!k)};if(y.__IS_EVAL_FUNC)return function(T){return y(new xv(i),T,!0)};if(y.__IS_FUNCTION_FUNC)return function(){for(var T=arguments.length,I=new Array(T),k=0;k<T;k++)I[k]=arguments[k];return y.apply(void 0,[new xv(i)].concat(I))};var x=i.options.globalContextInFunction;if(n.type==="Identifier"){var E=i.getIdentifierScope(n);E.name===E4&&(x=E.data)}return y.bind(x)}}},t.callExpressionHandler=function(n){var i=this,o=this.createCallFunctionGetter(n.callee),a=n.arguments.map(function(u){return i.createClosure(u)});return function(){return o().apply(void 0,a.map(function(u){return u()}))}},t.functionExpressionHandler=function(n){var i=this,o=this,a=this.source,u=this.collectDeclVars,c=this.collectDeclFuncs;this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var h=n.id?n.id.name:"",y=n.params.length,x=n.params.map(function(k){return i.createParamNameGetter(k)}),E=this.createClosure(n.body),T=this.collectDeclVars,I=this.collectDeclFuncs;return this.collectDeclVars=u,this.collectDeclFuncs=c,function(){var k=o.getCurrentScope(),D=function V(){for(var O=arguments.length,F=new Array(O),N=0;N<O;N++)F[N]=arguments[N];o.callStack.push(""+h);var H=o.getCurrentScope(),q=yQ(k,"FunctionScope("+h+")");o.setCurrentScope(q),o.addDeclarationsToScope(T,I,q),h&&(q.data[h]=V),q.data.arguments=arguments,x.forEach(function(pe,ue){q.data[pe()]=F[ue]});var Y=o.getCurrentContext();o.setCurrentContext(this);var ee=E();if(o.setCurrentContext(Y),o.setCurrentScope(H),o.callStack.pop(),ee instanceof Tp)return ee.value};return b4(D,h),Object.defineProperty(D,"length",{value:y,writable:!1,enumerable:!1,configurable:!0}),Object.defineProperty(D,"toString",{value:function(){return a.slice(n.start,n.end)},writable:!0,configurable:!0,enumerable:!1}),Object.defineProperty(D,"valueOf",{value:function(){return a.slice(n.start,n.end)},writable:!0,configurable:!0,enumerable:!1}),D}},t.newExpressionHandler=function(n){var i=this,o=this.source,a=this.createClosure(n.callee),u=n.arguments.map(function(c){return i.createClosure(c)});return function(){var c=a();if(!w2(c)||c.__IS_EVAL_FUNC){var h=n.callee,y=o.slice(h.start,h.end);throw i.createInternalThrowError(Dl.IsNotConstructor,y,n)}return c.__IS_FUNCTION_FUNC?c.apply(void 0,[new xv(i)].concat(u.map(function(x){return x()}))):D1(c,u.map(function(x){return x()}))}},t.memberExpressionHandler=function(n){var i=this.createClosure(n.object),o=this.createMemberKeyGetter(n);return function(){var a=i(),u=o();return a[u]}},t.thisExpressionHandler=function(n){var i=this;return function(){return i.getCurrentContext()}},t.sequenceExpressionHandler=function(n){var i=this,o=n.expressions.map(function(a){return i.createClosure(a)});return function(){for(var a,u=o.length,c=0;c<u;c++){var h=o[c];a=h()}return a}},t.literalHandler=function(n){return function(){return n.regex?new RegExp(n.regex.pattern,n.regex.flags):n.value}},t.identifierHandler=function(n){var i=this;return function(){var o=i.getCurrentScope(),a=i.getScopeDataFromName(n.name,o);return i.assertVariable(a,n.name,n),a[n.name]}},t.getIdentifierScope=function(n){var i=this.getCurrentScope(),o=this.getScopeFromName(n.name,i);return o},t.assignmentExpressionHandler=function(n){var i=this;n.left.type==="Identifier"&&n.right.type==="FunctionExpression"&&!n.right.id&&(n.right.id={type:"Identifier",name:n.left.name});var o=this.createObjectGetter(n.left),a=this.createNameGetter(n.left),u=this.createClosure(n.right);return function(){var c=o(),h=a(),y=u();switch(n.operator!=="="&&i.assertVariable(c,h,n),n.operator){case"=":return c[h]=y;case"+=":return c[h]+=y;case"-=":return c[h]-=y;case"*=":return c[h]*=y;case"**=":return c[h]=Math.pow(c[h],y);case"/=":return c[h]/=y;case"%=":return c[h]%=y;case"<<=":return c[h]<<=y;case">>=":return c[h]>>=y;case">>>=":return c[h]>>>=y;case"&=":return c[h]&=y;case"^=":return c[h]^=y;case"|=":return c[h]|=y;default:throw i.createInternalThrowError(Dl.AssignmentExpressionSyntaxError,n.type,n)}}},t.functionDeclarationHandler=function(n){if(n.id){var i=this.functionExpressionHandler(n);Object.defineProperty(i,"isFunctionDeclareClosure",{value:!0,writable:!1,configurable:!1,enumerable:!1}),this.funcDeclaration(n.id.name,i)}return function(){return Uu}},t.getVariableName=function(n){if(n.type==="Identifier")return n.name;throw this.createInternalThrowError(Dl.VariableTypeSyntaxError,n.type,n)},t.variableDeclarationHandler=function(n){for(var i=this,o,a=[],u=0;u<n.declarations.length;u++){var c=n.declarations[u];this.varDeclaration(this.getVariableName(c.id)),c.init&&a.push({type:"AssignmentExpression",operator:"=",left:c.id,right:c.init})}return a.length&&(o=this.createClosure({type:"BlockStatement",body:a})),function(){if(o){var h=i.isVarDeclMode;i.isVarDeclMode=!0,o(),i.isVarDeclMode=h}return Uu}},t.assertVariable=function(n,i,o){if(n===this.globalScope.data&&!(i in n))throw this.createInternalThrowError(Dl.VariableUndefinedReferenceError,i,o)},t.programHandler=function(n){var i=this,o=n.body.map(function(a){return i.createClosure(a)});return function(){for(var a=Uu,u=0;u<o.length;u++){var c=o[u],h=i.setValue(c());if(h!==Uu&&(a=h,a instanceof Tp||a instanceof bm||a instanceof dv||a===_m||a===xm))break}return a}},t.expressionStatementHandler=function(n){return this.createClosure(n.expression)},t.emptyStatementHandler=function(n){return function(){return Uu}},t.returnStatementHandler=function(n){var i=n.argument?this.createClosure(n.argument):h1;return function(){return new Tp(i())}},t.ifStatementHandler=function(n){var i=this.createClosure(n.test),o=this.createClosure(n.consequent),a=n.alternate?this.createClosure(n.alternate):function(){return Uu};return function(){return i()?o():a()}},t.conditionalExpressionHandler=function(n){return this.ifStatementHandler(n)},t.forStatementHandler=function(n){var i=this,o=h1,a=n.test?this.createClosure(n.test):function(){return!0},u=h1,c=this.createClosure(n.body);return n.type==="ForStatement"&&(o=n.init?this.createClosure(n.init):o,u=n.update?this.createClosure(n.update):h1),function(h){var y,x=Uu,E=n.type==="DoWhileStatement";for(h&&h.type==="LabeledStatement"&&(y=h.label.name),o();E||a();u()){E=!1;var T=i.setValue(c());if(!(T===Uu||T===xm)){if(T===_m)break;if(x=T,x instanceof dv&&x.value===y){x=Uu;continue}if(x instanceof Tp||x instanceof bm||x instanceof dv)break}}return x}},t.whileStatementHandler=function(n){return this.forStatementHandler(n)},t.doWhileStatementHandler=function(n){return this.forStatementHandler(n)},t.forInStatementHandler=function(n){var i=this,o=n.left,a=this.createClosure(n.right),u=this.createClosure(n.body);return n.left.type==="VariableDeclaration"&&(this.createClosure(n.left)(),o=n.left.declarations[0].id),function(c){var h,y=Uu,x;c&&c.type==="LabeledStatement"&&(h=c.label.name);var E=a();for(x in E){i.assignmentExpressionHandler({type:"AssignmentExpression",operator:"=",left:o,right:{type:"Literal",value:x}})();var T=i.setValue(u());if(!(T===Uu||T===xm)){if(T===_m)break;if(y=T,y instanceof dv&&y.value===h){y=Uu;continue}if(y instanceof Tp||y instanceof bm||y instanceof dv)break}}return y}},t.withStatementHandler=function(n){var i=this,o=this.createClosure(n.object),a=this.createClosure(n.body);return function(){var u=o(),c=i.getCurrentScope(),h=new L0(u,c,E4);i.setCurrentScope(h);var y=i.setValue(a());return i.setCurrentScope(c),y}},t.throwStatementHandler=function(n){var i=this,o=this.createClosure(n.argument);return function(){throw i.setValue(void 0),o()}},t.tryStatementHandler=function(n){var i=this,o=this.createClosure(n.block),a=n.handler?this.catchClauseHandler(n.handler):null,u=n.finalizer?this.createClosure(n.finalizer):null;return function(){var c=i.getCurrentScope(),h=i.getCurrentContext(),y=c.labelStack.concat([]),x=i.callStack.concat([]),E=Uu,T,I,k=function(){i.setCurrentScope(c),i.setCurrentContext(h),c.labelStack=y,i.callStack=x};try{E=i.setValue(o()),E instanceof Tp&&(T=E)}catch(D){if(k(),i.isInterruptThrow(D))throw D;if(a)try{E=i.setValue(a(D)),E instanceof Tp&&(T=E)}catch(V){if(k(),i.isInterruptThrow(V))throw V;I=V}}if(u)try{E=u(),E instanceof Tp&&(T=E)}catch(D){if(k(),i.isInterruptThrow(D))throw D;I=D}if(I)throw I;return T||E}},t.catchClauseHandler=function(n){var i=this,o=this.createParamNameGetter(n.param),a=this.createClosure(n.body);return function(u){var c,h=i.getCurrentScope(),y=h.data,x=o(),E=gQ.call(y,x),T=y[x];return y[x]=u,c=a(),E?y[x]=T:delete y[x],c}},t.continueStatementHandler=function(n){return function(){return n.label?new dv(n.label.name):xm}},t.breakStatementHandler=function(n){return function(){return n.label?new bm(n.label.name):_m}},t.switchStatementHandler=function(n){var i=this,o=this.createClosure(n.discriminant),a=n.cases.map(function(u){return i.switchCaseHandler(u)});return function(){for(var u=o(),c=!1,h,y,x,E=0;E<a.length;E++){var T=a[E](),I=T.testClosure();if(I===w4){x=T;continue}if(c||I===u){if(c=!0,y=i.setValue(T.bodyClosure()),y===Uu)continue;if(y===_m||(h=y,h instanceof Tp||h instanceof bm||h instanceof dv||h===xm))break}}if(!c&&x){y=i.setValue(x.bodyClosure());var k=y===Uu||y===_m||y===xm;k||(h=y)}return h}},t.switchCaseHandler=function(n){var i=n.test?this.createClosure(n.test):function(){return w4},o=this.createClosure({type:"BlockStatement",body:n.consequent});return function(){return{testClosure:i,bodyClosure:o}}},t.labeledStatementHandler=function(n){var i=this,o=n.label.name,a=this.createClosure(n.body);return function(){var u,c=i.getCurrentScope();return c.labelStack.push(o),u=a(n),u instanceof bm&&u.value===o&&(u=Uu),c.labelStack.pop(),u}},t.debuggerStatementHandler=function(n){return function(){return Uu}},t.createParamNameGetter=function(n){if(n.type==="Identifier")return function(){return n.name};throw this.createInternalThrowError(Dl.ParamTypeSyntaxError,n.type,n)},t.createObjectKeyGetter=function(n){var i;return n.type==="Identifier"?i=function(){return n.name}:i=this.createClosure(n),function(){return i()}},t.createMemberKeyGetter=function(n){return n.computed?this.createClosure(n.property):this.createObjectKeyGetter(n.property)},t.createObjectGetter=function(n){var i=this;switch(n.type){case"Identifier":return function(){return i.getScopeDataFromName(n.name,i.getCurrentScope())};case"MemberExpression":return this.createClosure(n.object);default:throw this.createInternalThrowError(Dl.AssignmentTypeSyntaxError,n.type,n)}},t.createNameGetter=function(n){switch(n.type){case"Identifier":return function(){return n.name};case"MemberExpression":return this.createMemberKeyGetter(n);default:throw this.createInternalThrowError(Dl.AssignmentTypeSyntaxError,n.type,n)}},t.varDeclaration=function(n){var i=this.collectDeclVars;i[n]=void 0},t.funcDeclaration=function(n,i){var o=this.collectDeclFuncs;o[n]=i},t.addDeclarationsToScope=function(n,i,o){var a=o.data;for(var u in i){var c=i[u];a[u]=c&&c()}for(var h in n)h in a||(a[h]=void 0)},t.getScopeValue=function(n,i){var o=this.getScopeFromName(n,i);return o.data[n]},t.getScopeDataFromName=function(n,i){return this.getScopeFromName(n,i).data},t.getScopeFromName=function(n,i){var o=i;do if(n in o.data)return o;while(o=o.parent);return this.globalScope},t.setValue=function(n){var i=this.callStack.length;return this.isVarDeclMode||i||n===Uu||n===_m||n===xm||n instanceof bm||n instanceof dv||(this.value=n instanceof Tp?n.value:n),n},t.getValue=function(){return this.value},e}();Kh.version=mQ;Kh.eval=zS;Kh.Function=US;Kh.ecmaVersion=5;Kh.globalContextInFunction=void 0;Kh.global=Object.create(null);function xQ(e){return e===void 0&&(e=Object.create(null)),e}function kk(e,t,r){t===void 0&&(t=[]),r===void 0&&(r={});var n=r.parsingContext,i=r.timeout===void 0?0:r.timeout,o=`
    (function anonymous(`+t.join(",")+`){
         `+e+`
    });
    `,a=new Kh(n,{ecmaVersion:r.ecmaVersion,timeout:i,rootContext:r.rootContext,globalContextInFunction:r.globalContextInFunction});return a.evaluate(o)}function i_(e,t,r){var n=new Kh(t,r);return n.evaluate(e)}var bQ=i_,wQ=function(){function e(r){this._code=r}var t=e.prototype;return t.runInContext=function(n){return i_(this._code,n)},t.runInNewContext=function(n){return i_(this._code,n)},e}();const EQ=Object.freeze(Object.defineProperty({__proto__:null,Script:wQ,compileFunction:kk,createContext:xQ,runInContext:i_,runInNewContext:bQ},Symbol.toStringTag,{value:"Module"})),C4=function(e,t,r){return i_(e,t,r)};function SQ(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n=t.pop();return kk(n||"",t)}const AQ=Object.freeze(Object.defineProperty({__proto__:null,Function:SQ,Interpreter:Kh,default:C4,evaluate:C4,vm:EQ},Symbol.toStringTag,{value:"Module"})),TQ=v_(AQ);(function(e,t){(function(r,n){e.exports=n(TQ)})(mf,function(r){var n=function(j){return j instanceof Uint8Array||j instanceof Uint16Array||j instanceof Uint32Array||j instanceof Int8Array||j instanceof Int16Array||j instanceof Int32Array||j instanceof Float32Array||j instanceof Float64Array||j instanceof Uint8ClampedArray},i=function(j,_e){for(var De=Object.keys(_e),bt=0;bt<De.length;++bt)j[De[bt]]=_e[De[bt]];return j},o=`
`;function a(j){return typeof atob<"u"?atob(j):"base64:"+j}function u(j){var _e=new Error("(regl) "+j);throw _e}function c(j,_e){j||u(_e)}function h(j){return j?": "+j:""}function y(j,_e,De){j in _e||u("unknown parameter ("+j+")"+h(De)+". possible values: "+Object.keys(_e).join())}function x(j,_e){n(j)||u("invalid parameter type"+h(_e)+". must be a typed array")}function E(j,_e){switch(_e){case"number":return typeof j=="number";case"object":return typeof j=="object";case"string":return typeof j=="string";case"boolean":return typeof j=="boolean";case"function":return typeof j=="function";case"undefined":return typeof j>"u";case"symbol":return typeof j=="symbol"}}function T(j,_e,De){E(j,_e)||u("invalid parameter type"+h(De)+". expected "+_e+", got "+typeof j)}function I(j,_e){j>=0&&(j|0)===j||u("invalid parameter type, ("+j+")"+h(_e)+". must be a nonnegative integer")}function k(j,_e,De){_e.indexOf(j)<0&&u("invalid value"+h(De)+". must be one of: "+_e)}var D=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function V(j){Object.keys(j).forEach(function(_e){D.indexOf(_e)<0&&u('invalid regl constructor argument "'+_e+'". must be one of '+D)})}function O(j,_e){for(j=j+"";j.length<_e;)j=" "+j;return j}function F(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function N(j,_e){this.number=j,this.line=_e,this.errors=[]}function H(j,_e,De){this.file=j,this.line=_e,this.message=De}function q(){var j=new Error,_e=(j.stack||j).toString(),De=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(_e);if(De)return De[1];var bt=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(_e);return bt?bt[1]:"unknown"}function Y(){var j=new Error,_e=(j.stack||j).toString(),De=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(_e);if(De)return De[1];var bt=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(_e);return bt?bt[1]:"unknown"}function ee(j,_e){var De=j.split(`
`),bt=1,Xt=0,xt={unknown:new F,0:new F};xt.unknown.name=xt[0].name=_e||q(),xt.unknown.lines.push(new N(0,""));for(var Bt=0;Bt<De.length;++Bt){var Kt=De[Bt],ur=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(Kt);if(ur)switch(ur[1]){case"line":var dr=/(\d+)(\s+\d+)?/.exec(ur[2]);dr&&(bt=dr[1]|0,dr[2]&&(Xt=dr[2]|0,Xt in xt||(xt[Xt]=new F)));break;case"define":var pr=/SHADER_NAME(_B64)?\s+(.*)$/.exec(ur[2]);pr&&(xt[Xt].name=pr[1]?a(pr[2]):pr[2]);break}xt[Xt].lines.push(new N(bt++,Kt))}return Object.keys(xt).forEach(function(rr){var hr=xt[rr];hr.lines.forEach(function(ar){hr.index[ar.number]=ar})}),xt}function pe(j){var _e=[];return j.split(`
`).forEach(function(De){if(!(De.length<5)){var bt=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(De);bt?_e.push(new H(bt[1]|0,bt[2]|0,bt[3].trim())):De.length>0&&_e.push(new H("unknown",0,De))}}),_e}function ue(j,_e){_e.forEach(function(De){var bt=j[De.file];if(bt){var Xt=bt.index[De.line];if(Xt){Xt.errors.push(De),bt.hasErrors=!0;return}}j.unknown.hasErrors=!0,j.unknown.lines[0].errors.push(De)})}function ie(j,_e,De,bt,Xt){if(!j.getShaderParameter(_e,j.COMPILE_STATUS)){var xt=j.getShaderInfoLog(_e),Bt=bt===j.FRAGMENT_SHADER?"fragment":"vertex";it(De,"string",Bt+" shader source must be a string",Xt);var Kt=ee(De,Xt),ur=pe(xt);ue(Kt,ur),Object.keys(Kt).forEach(function(dr){var pr=Kt[dr];if(!pr.hasErrors)return;var rr=[""],hr=[""];function ar(vr,lt){rr.push(vr),hr.push(lt||"")}ar("file number "+dr+": "+pr.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),pr.lines.forEach(function(vr){if(vr.errors.length>0){ar(O(vr.number,4)+"|  ","background-color:yellow; font-weight:bold"),ar(vr.line+o,"color:red; background-color:yellow; font-weight:bold");var lt=0;vr.errors.forEach(function(Rt){var lr=Rt.message,Br=/^\s*'(.*)'\s*:\s*(.*)$/.exec(lr);if(Br){var Zt=Br[1];switch(lr=Br[2],Zt){case"assign":Zt="=";break}lt=Math.max(vr.line.indexOf(Zt,lt),0)}else lt=0;ar(O("| ",6)),ar(O("^^^",lt+3)+o,"font-weight:bold"),ar(O("| ",6)),ar(lr+o,"font-weight:bold")}),ar(O("| ",6)+o)}else ar(O(vr.number,4)+"|  "),ar(vr.line+o,"color:red")}),typeof document<"u"&&!window.chrome&&(hr[0]=rr.join("%c"))}),c.raise("Error compiling "+Bt+" shader, "+Kt[0].name)}}function xe(j,_e,De,bt,Xt){if(!j.getProgramParameter(_e,j.LINK_STATUS)){var xt=j.getProgramInfoLog(_e),Bt=ee(De,Xt),Kt=ee(bt,Xt),ur='Error linking program with vertex shader, "'+Kt[0].name+'", and fragment shader "'+Bt[0].name+'"';c.raise(ur)}}function Se(j){j._commandRef=q()}function Ne(j,_e,De,bt){Se(j);function Xt(ur){return ur?bt.id(ur):0}j._fragId=Xt(j.static.frag),j._vertId=Xt(j.static.vert);function xt(ur,dr){Object.keys(dr).forEach(function(pr){ur[bt.id(pr)]=!0})}var Bt=j._uniformSet={};xt(Bt,_e.static),xt(Bt,_e.dynamic);var Kt=j._attributeSet={};xt(Kt,De.static),xt(Kt,De.dynamic),j._hasCount="count"in j.static||"count"in j.dynamic||"elements"in j.static||"elements"in j.dynamic}function ze(j,_e){var De=Y();u(j+" in command "+(_e||q())+(De==="unknown"?"":" called from "+De))}function Be(j,_e,De){j||ze(_e,De||q())}function $e(j,_e,De,bt){j in _e||ze("unknown parameter ("+j+")"+h(De)+". possible values: "+Object.keys(_e).join(),bt||q())}function it(j,_e,De,bt){E(j,_e)||ze("invalid parameter type"+h(De)+". expected "+_e+", got "+typeof j,bt||q())}function mt(j){j()}function Qe(j,_e,De){j.texture?k(j.texture._texture.internalformat,_e,"unsupported texture format for attachment"):k(j.renderbuffer._renderbuffer.format,De,"unsupported renderbuffer format for attachment")}var rt=33071,gt=9728,er=9984,zt=9985,qt=9986,Zr=9987,Wr=5120,On=5121,Ut=5122,Ar=5123,an=5124,Ft=5125,Mr=5126,mn=32819,Nn=32820,Xn=33635,qn=34042,Li=36193,ci={};ci[Wr]=ci[On]=1,ci[Ut]=ci[Ar]=ci[Li]=ci[Xn]=ci[mn]=ci[Nn]=2,ci[an]=ci[Ft]=ci[Mr]=ci[qn]=4;function Ai(j,_e){return j===Nn||j===mn||j===Xn?2:j===qn?4:ci[j]*_e}function Vi(j){return!(j&j-1)&&!!j}function za(j,_e,De){var bt,Xt=_e.width,xt=_e.height,Bt=_e.channels;c(Xt>0&&Xt<=De.maxTextureSize&&xt>0&&xt<=De.maxTextureSize,"invalid texture shape"),(j.wrapS!==rt||j.wrapT!==rt)&&c(Vi(Xt)&&Vi(xt),"incompatible wrap mode for texture, both width and height must be power of 2"),_e.mipmask===1?Xt!==1&&xt!==1&&c(j.minFilter!==er&&j.minFilter!==qt&&j.minFilter!==zt&&j.minFilter!==Zr,"min filter requires mipmap"):(c(Vi(Xt)&&Vi(xt),"texture must be a square power of 2 to support mipmapping"),c(_e.mipmask===(Xt<<1)-1,"missing or incomplete mipmap data")),_e.type===Mr&&(De.extensions.indexOf("oes_texture_float_linear")<0&&c(j.minFilter===gt&&j.magFilter===gt,"filter not supported, must enable oes_texture_float_linear"),c(!j.genMipmaps,"mipmap generation not supported with float textures"));var Kt=_e.images;for(bt=0;bt<16;++bt)if(Kt[bt]){var ur=Xt>>bt,dr=xt>>bt;c(_e.mipmask&1<<bt,"missing mipmap data");var pr=Kt[bt];if(c(pr.width===ur&&pr.height===dr,"invalid shape for mip images"),c(pr.format===_e.format&&pr.internalformat===_e.internalformat&&pr.type===_e.type,"incompatible type for mip image"),!pr.compressed)if(pr.data){var rr=Math.ceil(Ai(pr.type,Bt)*ur/pr.unpackAlignment)*pr.unpackAlignment;c(pr.data.byteLength===rr*dr,"invalid data for image, buffer size is inconsistent with image format")}else pr.element||pr.copy}else j.genMipmaps||c((_e.mipmask&1<<bt)===0,"extra mipmap data");_e.compressed&&c(!j.genMipmaps,"mipmap generation for compressed images not supported")}function ia(j,_e,De,bt){var Xt=j.width,xt=j.height,Bt=j.channels;c(Xt>0&&Xt<=bt.maxTextureSize&&xt>0&&xt<=bt.maxTextureSize,"invalid texture shape"),c(Xt===xt,"cube map must be square"),c(_e.wrapS===rt&&_e.wrapT===rt,"wrap mode not supported by cube map");for(var Kt=0;Kt<De.length;++Kt){var ur=De[Kt];c(ur.width===Xt&&ur.height===xt,"inconsistent cube map face shape"),_e.genMipmaps&&(c(!ur.compressed,"can not generate mipmap for compressed textures"),c(ur.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var dr=ur.images,pr=0;pr<16;++pr){var rr=dr[pr];if(rr){var hr=Xt>>pr,ar=xt>>pr;c(ur.mipmask&1<<pr,"missing mipmap data"),c(rr.width===hr&&rr.height===ar,"invalid shape for mip images"),c(rr.format===j.format&&rr.internalformat===j.internalformat&&rr.type===j.type,"incompatible type for mip image"),rr.compressed||(rr.data?c(rr.data.byteLength===hr*ar*Math.max(Ai(rr.type,Bt),rr.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):rr.element||rr.copy)}}}}var X=i(c,{optional:mt,raise:u,commandRaise:ze,command:Be,parameter:y,commandParameter:$e,constructor:V,type:T,commandType:it,isTypedArray:x,nni:I,oneOf:k,shaderError:ie,linkError:xe,callSite:Y,saveCommandRef:Se,saveDrawInfo:Ne,framebufferFormat:Qe,guessCommand:q,texture2D:za,textureCube:ia}),Ht=0,or=0,Yr=5,wn=6;function Qi(j,_e){this.id=Ht++,this.type=j,this.data=_e}function Zn(j){return j.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function Hn(j){if(j.length===0)return[];var _e=j.charAt(0),De=j.charAt(j.length-1);if(j.length>1&&_e===De&&(_e==='"'||_e==="'"))return['"'+Zn(j.substr(1,j.length-2))+'"'];var bt=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(j);if(bt)return Hn(j.substr(0,bt.index)).concat(Hn(bt[1])).concat(Hn(j.substr(bt.index+bt[0].length)));var Xt=j.split(".");if(Xt.length===1)return['"'+Zn(j)+'"'];for(var xt=[],Bt=0;Bt<Xt.length;++Bt)xt=xt.concat(Hn(Xt[Bt]));return xt}function Dn(j){return"["+Hn(j).join("][")+"]"}function di(j,_e){return new Qi(j,Dn(_e+""))}function wt(j){return typeof j=="function"&&!j._reglType||j instanceof Qi}function rn(j,_e){if(typeof j=="function")return new Qi(or,j);if(typeof j=="number"||typeof j=="boolean")return new Qi(Yr,j);if(Array.isArray(j))return new Qi(wn,j.map(function(De,bt){return rn(De,_e+"["+bt+"]")}));if(j instanceof Qi)return j;X(!1,"invalid option type in uniform "+_e)}var En={DynamicVariable:Qi,define:di,isDynamic:wt,unbox:rn,accessor:Dn},Ii={next:typeof requestAnimationFrame=="function"?function(j){return requestAnimationFrame(j)}:function(j){return setTimeout(j,16)},cancel:typeof cancelAnimationFrame=="function"?function(j){return cancelAnimationFrame(j)}:clearTimeout},ki=typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,uo=ki?function(){return+new Date}:typeof performance<"u"&&performance.now?function(){return performance.now()}:function(){return+new Date};function go(){var j={"":0},_e=[""];return{id:function(De){var bt=j[De];return bt||(bt=j[De]=_e.length,_e.push(De),bt)},str:function(De){return _e[De]}}}function yo(j,_e,De){var bt=document.createElement("canvas");i(bt.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),j.appendChild(bt),j===document.body&&(bt.style.position="absolute",i(j.style,{margin:0,padding:0}));function Xt(){var Kt=window.innerWidth,ur=window.innerHeight;if(j!==document.body){var dr=bt.getBoundingClientRect();Kt=dr.right-dr.left,ur=dr.bottom-dr.top}bt.width=De*Kt,bt.height=De*ur}var xt;j!==document.body&&typeof ResizeObserver=="function"?(xt=new ResizeObserver(function(){setTimeout(Xt)}),xt.observe(j)):window.addEventListener("resize",Xt,!1);function Bt(){xt?xt.disconnect():window.removeEventListener("resize",Xt),j.removeChild(bt)}return Xt(),{canvas:bt,onDestroy:Bt}}function Fs(j,_e){function De(bt){try{return j.getContext(bt,_e)}catch{return null}}return De("webgl")||De("experimental-webgl")||De("webgl-experimental")}function Ss(j){return typeof j.nodeName=="string"&&typeof j.appendChild=="function"&&typeof j.getBoundingClientRect=="function"}function Su(j){return typeof j.drawArrays=="function"||typeof j.drawElements=="function"}function ha(j){return typeof j=="string"?j.split():(X(Array.isArray(j),"invalid extension array"),j)}function Z(j){return typeof j=="string"?(X(typeof document<"u","not supported outside of DOM"),document.querySelector(j)):j}function re(j){var _e=j||{},De,bt,Xt,xt,Bt={},Kt=[],ur=[],dr=typeof window>"u"?1:window.devicePixelRatio,pr=!1,rr=function(vr){vr&&X.raise(vr)},hr=function(){};if(typeof _e=="string"?(X(typeof document<"u","selector queries only supported in DOM environments"),De=document.querySelector(_e),X(De,"invalid query string for element")):typeof _e=="object"?Ss(_e)?De=_e:Su(_e)?(xt=_e,Xt=xt.canvas):(X.constructor(_e),"gl"in _e?xt=_e.gl:"canvas"in _e?Xt=Z(_e.canvas):"container"in _e&&(bt=Z(_e.container)),"attributes"in _e&&(Bt=_e.attributes,X.type(Bt,"object","invalid context attributes")),"extensions"in _e&&(Kt=ha(_e.extensions)),"optionalExtensions"in _e&&(ur=ha(_e.optionalExtensions)),"onDone"in _e&&(X.type(_e.onDone,"function","invalid or missing onDone callback"),rr=_e.onDone),"profile"in _e&&(pr=!!_e.profile),"pixelRatio"in _e&&(dr=+_e.pixelRatio,X(dr>0,"invalid pixel ratio"))):X.raise("invalid arguments to regl"),De&&(De.nodeName.toLowerCase()==="canvas"?Xt=De:bt=De),!xt){if(!Xt){X(typeof document<"u","must manually specify webgl context outside of DOM environments");var ar=yo(bt||document.body,rr,dr);if(!ar)return null;Xt=ar.canvas,hr=ar.onDestroy}Bt.premultipliedAlpha===void 0&&(Bt.premultipliedAlpha=!0),xt=Fs(Xt,Bt)}return xt?{gl:xt,canvas:Xt,container:bt,extensions:Kt,optionalExtensions:ur,pixelRatio:dr,profile:pr,onDone:rr,onDestroy:hr}:(hr(),rr("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function oe(j,_e){var De={};function bt(Kt){X.type(Kt,"string","extension name must be string");var ur=Kt.toLowerCase(),dr;try{dr=De[ur]=Xt(Kt)}catch{}return!!dr}function Xt(Kt){return j.getExtension(Kt)?j.getExtension(Kt):j.getExtension(Kt.toLowerCase())?j.getExtension(Kt.toLowerCase()):null}for(var xt=0;xt<_e.extensions.length;++xt){var Bt=_e.extensions[xt];if(!bt(Bt))return _e.onDestroy(),_e.onDone('"'+Bt+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return _e.optionalExtensions.forEach(bt),{extensions:De,restore:function(){Object.keys(De).forEach(function(Kt){if(De[Kt]&&!bt(Kt))throw new Error("(regl): error restoring extension "+Kt)})}}}function ge(j,_e){for(var De=Array(j),bt=0;bt<j;++bt)De[bt]=_e(bt);return De}var Le=5120,Ke=5121,nt=5122,de=5123,Fe=5124,ht=5125,nr=5126;function cr(j){for(var _e=16;_e<=1<<28;_e*=16)if(j<=_e)return _e;return 0}function kt(j){var _e,De;return _e=(j>65535)<<4,j>>>=_e,De=(j>255)<<3,j>>>=De,_e|=De,De=(j>15)<<2,j>>>=De,_e|=De,De=(j>3)<<1,j>>>=De,_e|=De,_e|j>>1}function ir(){var j=ge(8,function(){return[]});function _e(xt){var Bt=cr(xt),Kt=j[kt(Bt)>>2];return Kt.length>0?Kt.pop():new ArrayBuffer(Bt)}function De(xt){j[kt(xt.byteLength)>>2].push(xt)}function bt(xt,Bt){var Kt=null;switch(xt){case Le:Kt=new Int8Array(_e(Bt),0,Bt);break;case Ke:Kt=new Uint8Array(_e(Bt),0,Bt);break;case nt:Kt=new Int16Array(_e(2*Bt),0,Bt);break;case de:Kt=new Uint16Array(_e(2*Bt),0,Bt);break;case Fe:Kt=new Int32Array(_e(4*Bt),0,Bt);break;case ht:Kt=new Uint32Array(_e(4*Bt),0,Bt);break;case nr:Kt=new Float32Array(_e(4*Bt),0,Bt);break;default:return null}return Kt.length!==Bt?Kt.subarray(0,Bt):Kt}function Xt(xt){De(xt.buffer)}return{alloc:_e,free:De,allocType:bt,freeType:Xt}}var Sr=ir();Sr.zero=ir();var nn=3408,Dt=3410,Kr=3411,Ir=3412,Dr=3413,ii=3414,Fr=3415,fi=33901,Oi=33902,oi=3379,Si=3386,Ti=34921,Jo=36347,Ni=36348,Hi=35661,Di=35660,ti=34930,vi=36349,Mo=34076,As=34024,Ma=7936,Go=7937,$c=7938,Wu=35724,Wi=34047,_l=36063,Po=34852,Pa=3553,es=34067,ga=34069,hs=33984,Fa=6408,ic=5126,Ts=5121,ac=36160,Ws=36053,_o=36064,ps=16384,se=function(j,_e){var De=1;_e.ext_texture_filter_anisotropic&&(De=j.getParameter(Wi));var bt=1,Xt=1;_e.webgl_draw_buffers&&(bt=j.getParameter(Po),Xt=j.getParameter(_l));var xt=!!_e.oes_texture_float;if(xt){var Bt=j.createTexture();j.bindTexture(Pa,Bt),j.texImage2D(Pa,0,Fa,1,1,0,Fa,ic,null);var Kt=j.createFramebuffer();if(j.bindFramebuffer(ac,Kt),j.framebufferTexture2D(ac,_o,Pa,Bt,0),j.bindTexture(Pa,null),j.checkFramebufferStatus(ac)!==Ws)xt=!1;else{j.viewport(0,0,1,1),j.clearColor(1,0,0,1),j.clear(ps);var ur=Sr.allocType(ic,4);j.readPixels(0,0,1,1,Fa,ic,ur),j.getError()?xt=!1:(j.deleteFramebuffer(Kt),j.deleteTexture(Bt),xt=ur[0]===1),Sr.freeType(ur)}}var dr=typeof navigator<"u"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),pr=!0;if(!dr){var rr=j.createTexture(),hr=Sr.allocType(Ts,36);j.activeTexture(hs),j.bindTexture(es,rr),j.texImage2D(ga,0,Fa,3,3,0,Fa,Ts,hr),Sr.freeType(hr),j.bindTexture(es,null),j.deleteTexture(rr),pr=!j.getError()}return{colorBits:[j.getParameter(Dt),j.getParameter(Kr),j.getParameter(Ir),j.getParameter(Dr)],depthBits:j.getParameter(ii),stencilBits:j.getParameter(Fr),subpixelBits:j.getParameter(nn),extensions:Object.keys(_e).filter(function(ar){return!!_e[ar]}),maxAnisotropic:De,maxDrawbuffers:bt,maxColorAttachments:Xt,pointSizeDims:j.getParameter(fi),lineWidthDims:j.getParameter(Oi),maxViewportDims:j.getParameter(Si),maxCombinedTextureUnits:j.getParameter(Hi),maxCubeMapSize:j.getParameter(Mo),maxRenderbufferSize:j.getParameter(As),maxTextureUnits:j.getParameter(ti),maxTextureSize:j.getParameter(oi),maxAttributes:j.getParameter(Ti),maxVertexUniforms:j.getParameter(Jo),maxVertexTextureUnits:j.getParameter(Di),maxVaryingVectors:j.getParameter(Ni),maxFragmentUniforms:j.getParameter(vi),glsl:j.getParameter(Wu),renderer:j.getParameter(Go),vendor:j.getParameter(Ma),version:j.getParameter($c),readFloat:xt,npotTextureCube:pr}};function be(j){return!!j&&typeof j=="object"&&Array.isArray(j.shape)&&Array.isArray(j.stride)&&typeof j.offset=="number"&&j.shape.length===j.stride.length&&(Array.isArray(j.data)||n(j.data))}var Xe=function(j){return Object.keys(j).map(function(_e){return j[_e]})},Lt={shape:ts,flatten:Oo};function xr(j,_e,De){for(var bt=0;bt<_e;++bt)De[bt]=j[bt]}function Sn(j,_e,De,bt){for(var Xt=0,xt=0;xt<_e;++xt)for(var Bt=j[xt],Kt=0;Kt<De;++Kt)bt[Xt++]=Bt[Kt]}function Ci(j,_e,De,bt,Xt,xt){for(var Bt=xt,Kt=0;Kt<_e;++Kt)for(var ur=j[Kt],dr=0;dr<De;++dr)for(var pr=ur[dr],rr=0;rr<bt;++rr)Xt[Bt++]=pr[rr]}function Io(j,_e,De,bt,Xt){for(var xt=1,Bt=De+1;Bt<_e.length;++Bt)xt*=_e[Bt];var Kt=_e[De];if(_e.length-De===4){var ur=_e[De+1],dr=_e[De+2],pr=_e[De+3];for(Bt=0;Bt<Kt;++Bt)Ci(j[Bt],ur,dr,pr,bt,Xt),Xt+=xt}else for(Bt=0;Bt<Kt;++Bt)Io(j[Bt],_e,De+1,bt,Xt),Xt+=xt}function Oo(j,_e,De,bt){var Xt=1;if(_e.length)for(var xt=0;xt<_e.length;++xt)Xt*=_e[xt];else Xt=0;var Bt=bt||Sr.allocType(De,Xt);switch(_e.length){case 0:break;case 1:xr(j,_e[0],Bt);break;case 2:Sn(j,_e[0],_e[1],Bt);break;case 3:Ci(j,_e[0],_e[1],_e[2],Bt,0);break;default:Io(j,_e,0,Bt,0)}return Bt}function ts(j){for(var _e=[],De=j;De.length;De=De[0])_e.push(De.length);return _e}var Do={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Wp=5120,sh=5122,Vd=5124,Qh=5121,Xs=5123,oc=5125,sc=5126,Gc=5126,Ys={int8:Wp,int16:sh,int32:Vd,uint8:Qh,uint16:Xs,uint32:oc,float:sc,float32:Gc},uc=35048,Na=35040,Mi={dynamic:uc,stream:Na,static:35044},ao=Lt.flatten,Hc=Lt.shape,Xp=35044,Uv=35040,Yp=5121,uh=5126,Xu=[];Xu[5120]=1,Xu[5122]=2,Xu[5124]=4,Xu[5121]=1,Xu[5123]=2,Xu[5125]=4,Xu[5126]=4;function xf(j){return Do[Object.prototype.toString.call(j)]|0}function Fo(j,_e){for(var De=0;De<_e.length;++De)j[De]=_e[De]}function lh(j,_e,De,bt,Xt,xt,Bt){for(var Kt=0,ur=0;ur<De;++ur)for(var dr=0;dr<bt;++dr)j[Kt++]=_e[Xt*ur+xt*dr+Bt]}function lc(j,_e,De,bt){var Xt=0,xt={};function Bt(lt){this.id=Xt++,this.buffer=j.createBuffer(),this.type=lt,this.usage=Xp,this.byteLength=0,this.dimension=1,this.dtype=Yp,this.persistentData=null,De.profile&&(this.stats={size:0})}Bt.prototype.bind=function(){j.bindBuffer(this.type,this.buffer)},Bt.prototype.destroy=function(){hr(this)};var Kt=[];function ur(lt,Rt){var lr=Kt.pop();return lr||(lr=new Bt(lt)),lr.bind(),rr(lr,Rt,Uv,0,1,!1),lr}function dr(lt){Kt.push(lt)}function pr(lt,Rt,lr){lt.byteLength=Rt.byteLength,j.bufferData(lt.type,Rt,lr)}function rr(lt,Rt,lr,Br,Zt,br){var Lr;if(lt.usage=lr,Array.isArray(Rt)){if(lt.dtype=Br||uh,Rt.length>0){var sn;if(Array.isArray(Rt[0])){Lr=Hc(Rt);for(var Wt=1,jt=1;jt<Lr.length;++jt)Wt*=Lr[jt];lt.dimension=Wt,sn=ao(Rt,Lr,lt.dtype),pr(lt,sn,lr),br?lt.persistentData=sn:Sr.freeType(sn)}else if(typeof Rt[0]=="number"){lt.dimension=Zt;var kr=Sr.allocType(lt.dtype,Rt.length);Fo(kr,Rt),pr(lt,kr,lr),br?lt.persistentData=kr:Sr.freeType(kr)}else n(Rt[0])?(lt.dimension=Rt[0].length,lt.dtype=Br||xf(Rt[0])||uh,sn=ao(Rt,[Rt.length,Rt[0].length],lt.dtype),pr(lt,sn,lr),br?lt.persistentData=sn:Sr.freeType(sn)):X.raise("invalid buffer data")}}else if(n(Rt))lt.dtype=Br||xf(Rt),lt.dimension=Zt,pr(lt,Rt,lr),br&&(lt.persistentData=new Uint8Array(new Uint8Array(Rt.buffer)));else if(be(Rt)){Lr=Rt.shape;var Pr=Rt.stride,fr=Rt.offset,zr=0,Vr=0,Gn=0,Vn=0;Lr.length===1?(zr=Lr[0],Vr=1,Gn=Pr[0],Vn=0):Lr.length===2?(zr=Lr[0],Vr=Lr[1],Gn=Pr[0],Vn=Pr[1]):X.raise("invalid shape"),lt.dtype=Br||xf(Rt.data)||uh,lt.dimension=Vr;var Gr=Sr.allocType(lt.dtype,zr*Vr);lh(Gr,Rt.data,zr,Vr,Gn,Vn,fr),pr(lt,Gr,lr),br?lt.persistentData=Gr:Sr.freeType(Gr)}else Rt instanceof ArrayBuffer?(lt.dtype=Yp,lt.dimension=Zt,pr(lt,Rt,lr),br&&(lt.persistentData=new Uint8Array(new Uint8Array(Rt)))):X.raise("invalid buffer data")}function hr(lt){_e.bufferCount--,bt(lt);var Rt=lt.buffer;X(Rt,"buffer must not be deleted already"),j.deleteBuffer(Rt),lt.buffer=null,delete xt[lt.id]}function ar(lt,Rt,lr,Br){_e.bufferCount++;var Zt=new Bt(Rt);xt[Zt.id]=Zt;function br(Wt){var jt=Xp,kr=null,Pr=0,fr=0,zr=1;return Array.isArray(Wt)||n(Wt)||be(Wt)||Wt instanceof ArrayBuffer?kr=Wt:typeof Wt=="number"?Pr=Wt|0:Wt&&(X.type(Wt,"object","buffer arguments must be an object, a number or an array"),"data"in Wt&&(X(kr===null||Array.isArray(kr)||n(kr)||be(kr),"invalid data for buffer"),kr=Wt.data),"usage"in Wt&&(X.parameter(Wt.usage,Mi,"invalid buffer usage"),jt=Mi[Wt.usage]),"type"in Wt&&(X.parameter(Wt.type,Ys,"invalid buffer type"),fr=Ys[Wt.type]),"dimension"in Wt&&(X.type(Wt.dimension,"number","invalid dimension"),zr=Wt.dimension|0),"length"in Wt&&(X.nni(Pr,"buffer length must be a nonnegative integer"),Pr=Wt.length|0)),Zt.bind(),kr?rr(Zt,kr,jt,fr,zr,Br):(Pr&&j.bufferData(Zt.type,Pr,jt),Zt.dtype=fr||Yp,Zt.usage=jt,Zt.dimension=zr,Zt.byteLength=Pr),De.profile&&(Zt.stats.size=Zt.byteLength*Xu[Zt.dtype]),br}function Lr(Wt,jt){X(jt+Wt.byteLength<=Zt.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+Wt.byteLength+" starting from offset "+jt+" to a buffer of size "+Zt.byteLength),j.bufferSubData(Zt.type,jt,Wt)}function sn(Wt,jt){var kr=(jt||0)|0,Pr;if(Zt.bind(),n(Wt)||Wt instanceof ArrayBuffer)Lr(Wt,kr);else if(Array.isArray(Wt)){if(Wt.length>0)if(typeof Wt[0]=="number"){var fr=Sr.allocType(Zt.dtype,Wt.length);Fo(fr,Wt),Lr(fr,kr),Sr.freeType(fr)}else if(Array.isArray(Wt[0])||n(Wt[0])){Pr=Hc(Wt);var zr=ao(Wt,Pr,Zt.dtype);Lr(zr,kr),Sr.freeType(zr)}else X.raise("invalid buffer data")}else if(be(Wt)){Pr=Wt.shape;var Vr=Wt.stride,Gn=0,Vn=0,Gr=0,Xr=0;Pr.length===1?(Gn=Pr[0],Vn=1,Gr=Vr[0],Xr=0):Pr.length===2?(Gn=Pr[0],Vn=Pr[1],Gr=Vr[0],Xr=Vr[1]):X.raise("invalid shape");var Pn=Array.isArray(Wt.data)?Zt.dtype:xf(Wt.data),Wn=Sr.allocType(Pn,Gn*Vn);lh(Wn,Wt.data,Gn,Vn,Gr,Xr,Wt.offset),Lr(Wn,kr),Sr.freeType(Wn)}else X.raise("invalid data for buffer subdata");return br}return lr||br(lt),br._reglType="buffer",br._buffer=Zt,br.subdata=sn,De.profile&&(br.stats=Zt.stats),br.destroy=function(){hr(Zt)},br}function vr(){Xe(xt).forEach(function(lt){lt.buffer=j.createBuffer(),j.bindBuffer(lt.type,lt.buffer),j.bufferData(lt.type,lt.persistentData||lt.byteLength,lt.usage)})}return De.profile&&(_e.getTotalBufferSize=function(){var lt=0;return Object.keys(xt).forEach(function(Rt){lt+=xt[Rt].stats.size}),lt}),{create:ar,createStream:ur,destroyStream:dr,clear:function(){Xe(xt).forEach(hr),Kt.forEach(hr)},getBuffer:function(lt){return lt&&lt._buffer instanceof Bt?lt._buffer:null},restore:vr,_initBuffer:rr}}var jd=0,Wc=0,Cs=1,qp=1,Ho=4,Jh=4,Ms={points:jd,point:Wc,lines:Cs,line:qp,triangles:Ho,triangle:Jh,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},zl=0,cc=1,lo=4,fc=5120,co=5121,hc=5122,qs=5123,xl=5124,Yu=5125,Ji=34963,oo=35040,qu=35044;function ep(j,_e,De,bt){var Xt={},xt=0,Bt={uint8:co,uint16:qs};_e.oes_element_index_uint&&(Bt.uint32=Yu);function Kt(vr){this.id=xt++,Xt[this.id]=this,this.buffer=vr,this.primType=lo,this.vertCount=0,this.type=0}Kt.prototype.bind=function(){this.buffer.bind()};var ur=[];function dr(vr){var lt=ur.pop();return lt||(lt=new Kt(De.create(null,Ji,!0,!1)._buffer)),rr(lt,vr,oo,-1,-1,0,0),lt}function pr(vr){ur.push(vr)}function rr(vr,lt,Rt,lr,Br,Zt,br){vr.buffer.bind();var Lr;if(lt){var sn=br;!br&&(!n(lt)||be(lt)&&!n(lt.data))&&(sn=_e.oes_element_index_uint?Yu:qs),De._initBuffer(vr.buffer,lt,Rt,sn,3)}else j.bufferData(Ji,Zt,Rt),vr.buffer.dtype=Lr||co,vr.buffer.usage=Rt,vr.buffer.dimension=3,vr.buffer.byteLength=Zt;if(Lr=br,!br){switch(vr.buffer.dtype){case co:case fc:Lr=co;break;case qs:case hc:Lr=qs;break;case Yu:case xl:Lr=Yu;break;default:X.raise("unsupported type for element array")}vr.buffer.dtype=Lr}vr.type=Lr,X(Lr!==Yu||!!_e.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var Wt=Br;Wt<0&&(Wt=vr.buffer.byteLength,Lr===qs?Wt>>=1:Lr===Yu&&(Wt>>=2)),vr.vertCount=Wt;var jt=lr;if(lr<0){jt=lo;var kr=vr.buffer.dimension;kr===1&&(jt=zl),kr===2&&(jt=cc),kr===3&&(jt=lo)}vr.primType=jt}function hr(vr){bt.elementsCount--,X(vr.buffer!==null,"must not double destroy elements"),delete Xt[vr.id],vr.buffer.destroy(),vr.buffer=null}function ar(vr,lt){var Rt=De.create(null,Ji,!0),lr=new Kt(Rt._buffer);bt.elementsCount++;function Br(Zt){if(!Zt)Rt(),lr.primType=lo,lr.vertCount=0,lr.type=co;else if(typeof Zt=="number")Rt(Zt),lr.primType=lo,lr.vertCount=Zt|0,lr.type=co;else{var br=null,Lr=qu,sn=-1,Wt=-1,jt=0,kr=0;Array.isArray(Zt)||n(Zt)||be(Zt)?br=Zt:(X.type(Zt,"object","invalid arguments for elements"),"data"in Zt&&(br=Zt.data,X(Array.isArray(br)||n(br)||be(br),"invalid data for element buffer")),"usage"in Zt&&(X.parameter(Zt.usage,Mi,"invalid element buffer usage"),Lr=Mi[Zt.usage]),"primitive"in Zt&&(X.parameter(Zt.primitive,Ms,"invalid element buffer primitive"),sn=Ms[Zt.primitive]),"count"in Zt&&(X(typeof Zt.count=="number"&&Zt.count>=0,"invalid vertex count for elements"),Wt=Zt.count|0),"type"in Zt&&(X.parameter(Zt.type,Bt,"invalid buffer type"),kr=Bt[Zt.type]),"length"in Zt?jt=Zt.length|0:(jt=Wt,kr===qs||kr===hc?jt*=2:(kr===Yu||kr===xl)&&(jt*=4))),rr(lr,br,Lr,sn,Wt,jt,kr)}return Br}return Br(vr),Br._reglType="elements",Br._elements=lr,Br.subdata=function(Zt,br){return Rt.subdata(Zt,br),Br},Br.destroy=function(){hr(lr)},Br}return{create:ar,createStream:dr,destroyStream:pr,getElements:function(vr){return typeof vr=="function"&&vr._elements instanceof Kt?vr._elements:null},clear:function(){Xe(Xt).forEach(hr)}}}var Zp=new Float32Array(1),tp=new Uint32Array(Zp.buffer),$d=5123;function pc(j){for(var _e=Sr.allocType($d,j.length),De=0;De<j.length;++De)if(isNaN(j[De]))_e[De]=65535;else if(j[De]===1/0)_e[De]=31744;else if(j[De]===-1/0)_e[De]=64512;else{Zp[0]=j[De];var bt=tp[0],Xt=bt>>>31<<15,xt=(bt<<1>>>24)-127,Bt=bt>>13&1024-1;if(xt<-24)_e[De]=Xt;else if(xt<-14){var Kt=-14-xt;_e[De]=Xt+(Bt+1024>>Kt)}else xt>15?_e[De]=Xt+31744:_e[De]=Xt+(xt+15<<10)+Bt}return _e}function wa(j){return Array.isArray(j)||n(j)}var Ul=function(j){return!(j&j-1)&&!!j},ch=34467,Ps=3553,fh=34067,Zu=34069,Vl=6408,Ku=6406,Au=6407,Xc=6409,dc=6410,pa=32854,vc=32855,Gd=36194,Yc=32819,Zs=32820,Kp=33635,bf=34042,qc=6402,bl=34041,Zc=35904,wf=35906,wl=36193,mc=33776,rp=33777,cu=33778,fu=33779,Qp=35986,hh=35987,np=34798,Ns=35840,jl=35841,ph=35842,ip=35843,dh=36196,Qu=5121,Is=5123,Ef=5125,Sf=5126,Hd=10242,ap=10243,Jp=10497,vh=33071,gc=33648,ft=10240,Jt=10241,Nt=9728,jr=9729,si=9984,ji=9985,Ua=9986,Tn=9987,ya=33170,Rs=4352,Ls=4353,$l=4354,mh=34046,Af=3317,op=37440,yc=37441,ua=37443,El=37444,$a=33984,_c=[si,Ua,ji,Tn],gh=[0,Xc,dc,Au,Vl],la={};la[Xc]=la[Ku]=la[qc]=1,la[bl]=la[dc]=2,la[Au]=la[Zc]=3,la[Vl]=la[wf]=4;function Jr(j){return"[object "+j+"]"}var rs=Jr("HTMLCanvasElement"),Tu=Jr("OffscreenCanvas"),Sl=Jr("CanvasRenderingContext2D"),hu=Jr("ImageBitmap"),ns=Jr("HTMLImageElement"),yh=Jr("HTMLVideoElement"),Nr=Object.keys(Do).concat([rs,Tu,Sl,hu,ns,yh]),Ju=[];Ju[Qu]=1,Ju[Sf]=4,Ju[wl]=2,Ju[Is]=2,Ju[Ef]=4;var xo=[];xo[pa]=2,xo[vc]=2,xo[Gd]=2,xo[bl]=4,xo[mc]=.5,xo[rp]=.5,xo[cu]=1,xo[fu]=1,xo[Qp]=.5,xo[hh]=1,xo[np]=1,xo[Ns]=.5,xo[jl]=.25,xo[ph]=.5,xo[ip]=.25,xo[dh]=.5;function xc(j){return Array.isArray(j)&&(j.length===0||typeof j[0]=="number")}function Wo(j){if(!Array.isArray(j))return!1;var _e=j.length;return!(_e===0||!wa(j[0]))}function fo(j){return Object.prototype.toString.call(j)}function _h(j){return fo(j)===rs}function xh(j){return fo(j)===Tu}function Ks(j){return fo(j)===Sl}function Cu(j){return fo(j)===hu}function bh(j){return fo(j)===ns}function Kc(j){return fo(j)===yh}function wh(j){var _e=typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return!!(_e&&j&&j.getContext)}function Eh(j){var _e=typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return!!(_e&&j&&"src"in j&&"crossOrigin"in j)}function pu(j){if(!j)return!1;if(wh(j)||Eh(j))return!0;var _e=fo(j);return Nr.indexOf(_e)>=0?!0:xc(j)||Wo(j)||be(j)}function Qs(j){return Do[Object.prototype.toString.call(j)]|0}function Bn(j,_e){var De=_e.length;switch(j.type){case Qu:case Is:case Ef:case Sf:var bt=Sr.allocType(j.type,De);bt.set(_e),j.data=bt;break;case wl:j.data=pc(_e);break;default:X.raise("unsupported texture type, must specify a typed array")}}function Ga(j,_e){return Sr.allocType(j.type===wl?Sf:j.type,_e)}function du(j,_e){j.type===wl?(j.data=pc(_e),Sr.freeType(_e)):j.data=_e}function is(j,_e,De,bt,Xt,xt){for(var Bt=j.width,Kt=j.height,ur=j.channels,dr=Bt*Kt*ur,pr=Ga(j,dr),rr=0,hr=0;hr<Kt;++hr)for(var ar=0;ar<Bt;++ar)for(var vr=0;vr<ur;++vr)pr[rr++]=_e[De*ar+bt*hr+Xt*vr+xt];du(j,pr)}function el(j,_e,De,bt,Xt,xt){var Bt;if(typeof xo[j]<"u"?Bt=xo[j]:Bt=la[j]*Ju[_e],xt&&(Bt*=6),Xt){for(var Kt=0,ur=De;ur>=1;)Kt+=Bt*ur*ur,ur/=2;return Kt}else return Bt*De*bt}function bc(j,_e,De,bt,Xt,xt,Bt){var Kt={"don't care":Rs,"dont care":Rs,nice:$l,fast:Ls},ur={repeat:Jp,clamp:vh,mirror:gc},dr={nearest:Nt,linear:jr},pr=i({mipmap:Tn,"nearest mipmap nearest":si,"linear mipmap nearest":ji,"nearest mipmap linear":Ua,"linear mipmap linear":Tn},dr),rr={none:0,browser:El},hr={uint8:Qu,rgba4:Yc,rgb565:Kp,"rgb5 a1":Zs},ar={alpha:Ku,luminance:Xc,"luminance alpha":dc,rgb:Au,rgba:Vl,rgba4:pa,"rgb5 a1":vc,rgb565:Gd},vr={};_e.ext_srgb&&(ar.srgb=Zc,ar.srgba=wf),_e.oes_texture_float&&(hr.float32=hr.float=Sf),_e.oes_texture_half_float&&(hr.float16=hr["half float"]=wl),_e.webgl_depth_texture&&(i(ar,{depth:qc,"depth stencil":bl}),i(hr,{uint16:Is,uint32:Ef,"depth stencil":bf})),_e.webgl_compressed_texture_s3tc&&i(vr,{"rgb s3tc dxt1":mc,"rgba s3tc dxt1":rp,"rgba s3tc dxt3":cu,"rgba s3tc dxt5":fu}),_e.webgl_compressed_texture_atc&&i(vr,{"rgb atc":Qp,"rgba atc explicit alpha":hh,"rgba atc interpolated alpha":np}),_e.webgl_compressed_texture_pvrtc&&i(vr,{"rgb pvrtc 4bppv1":Ns,"rgb pvrtc 2bppv1":jl,"rgba pvrtc 4bppv1":ph,"rgba pvrtc 2bppv1":ip}),_e.webgl_compressed_texture_etc1&&(vr["rgb etc1"]=dh);var lt=Array.prototype.slice.call(j.getParameter(ch)||new Uint32Array(0));Object.keys(vr).forEach(function(Pe){var St=vr[Pe];lt.indexOf(St)>=0&&(ar[Pe]=St)});var Rt=Object.keys(ar);De.textureFormats=Rt;var lr=[];Object.keys(ar).forEach(function(Pe){var St=ar[Pe];lr[St]=Pe});var Br=[];Object.keys(hr).forEach(function(Pe){var St=hr[Pe];Br[St]=Pe});var Zt=[];Object.keys(dr).forEach(function(Pe){var St=dr[Pe];Zt[St]=Pe});var br=[];Object.keys(pr).forEach(function(Pe){var St=pr[Pe];br[St]=Pe});var Lr=[];Object.keys(ur).forEach(function(Pe){var St=ur[Pe];Lr[St]=Pe});var sn=Rt.reduce(function(Pe,St){var pt=ar[St];return pt===Xc||pt===Ku||pt===Xc||pt===dc||pt===qc||pt===bl||_e.ext_srgb&&(pt===Zc||pt===wf)?Pe[pt]=pt:pt===vc||St.indexOf("rgba")>=0?Pe[pt]=Vl:Pe[pt]=Au,Pe},{});function Wt(){this.internalformat=Vl,this.format=Vl,this.type=Qu,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=El,this.width=0,this.height=0,this.channels=0}function jt(Pe,St){Pe.internalformat=St.internalformat,Pe.format=St.format,Pe.type=St.type,Pe.compressed=St.compressed,Pe.premultiplyAlpha=St.premultiplyAlpha,Pe.flipY=St.flipY,Pe.unpackAlignment=St.unpackAlignment,Pe.colorSpace=St.colorSpace,Pe.width=St.width,Pe.height=St.height,Pe.channels=St.channels}function kr(Pe,St){if(!(typeof St!="object"||!St)){if("premultiplyAlpha"in St&&(X.type(St.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),Pe.premultiplyAlpha=St.premultiplyAlpha),"flipY"in St&&(X.type(St.flipY,"boolean","invalid texture flip"),Pe.flipY=St.flipY),"alignment"in St&&(X.oneOf(St.alignment,[1,2,4,8],"invalid texture unpack alignment"),Pe.unpackAlignment=St.alignment),"colorSpace"in St&&(X.parameter(St.colorSpace,rr,"invalid colorSpace"),Pe.colorSpace=rr[St.colorSpace]),"type"in St){var pt=St.type;X(_e.oes_texture_float||!(pt==="float"||pt==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),X(_e.oes_texture_half_float||!(pt==="half float"||pt==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),X(_e.webgl_depth_texture||!(pt==="uint16"||pt==="uint32"||pt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),X.parameter(pt,hr,"invalid texture type"),Pe.type=hr[pt]}var en=Pe.width,_i=Pe.height,Ae=Pe.channels,fe=!1;"shape"in St?(X(Array.isArray(St.shape)&&St.shape.length>=2,"shape must be an array"),en=St.shape[0],_i=St.shape[1],St.shape.length===3&&(Ae=St.shape[2],X(Ae>0&&Ae<=4,"invalid number of channels"),fe=!0),X(en>=0&&en<=De.maxTextureSize,"invalid width"),X(_i>=0&&_i<=De.maxTextureSize,"invalid height")):("radius"in St&&(en=_i=St.radius,X(en>=0&&en<=De.maxTextureSize,"invalid radius")),"width"in St&&(en=St.width,X(en>=0&&en<=De.maxTextureSize,"invalid width")),"height"in St&&(_i=St.height,X(_i>=0&&_i<=De.maxTextureSize,"invalid height")),"channels"in St&&(Ae=St.channels,X(Ae>0&&Ae<=4,"invalid number of channels"),fe=!0)),Pe.width=en|0,Pe.height=_i|0,Pe.channels=Ae|0;var Ue=!1;if("format"in St){var ut=St.format;X(_e.webgl_depth_texture||!(ut==="depth"||ut==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),X.parameter(ut,ar,"invalid texture format");var Et=Pe.internalformat=ar[ut];Pe.format=sn[Et],ut in hr&&("type"in St||(Pe.type=hr[ut])),ut in vr&&(Pe.compressed=!0),Ue=!0}!fe&&Ue?Pe.channels=la[Pe.format]:fe&&!Ue?Pe.channels!==gh[Pe.format]&&(Pe.format=Pe.internalformat=gh[Pe.channels]):Ue&&fe&&X(Pe.channels===la[Pe.format],"number of channels inconsistent with specified format")}}function Pr(Pe){j.pixelStorei(op,Pe.flipY),j.pixelStorei(yc,Pe.premultiplyAlpha),j.pixelStorei(ua,Pe.colorSpace),j.pixelStorei(Af,Pe.unpackAlignment)}function fr(){Wt.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function zr(Pe,St){var pt=null;if(pu(St)?pt=St:St&&(X.type(St,"object","invalid pixel data type"),kr(Pe,St),"x"in St&&(Pe.xOffset=St.x|0),"y"in St&&(Pe.yOffset=St.y|0),pu(St.data)&&(pt=St.data)),X(!Pe.compressed||pt instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),St.copy){X(!pt,"can not specify copy and data field for the same texture");var en=Xt.viewportWidth,_i=Xt.viewportHeight;Pe.width=Pe.width||en-Pe.xOffset,Pe.height=Pe.height||_i-Pe.yOffset,Pe.needsCopy=!0,X(Pe.xOffset>=0&&Pe.xOffset<en&&Pe.yOffset>=0&&Pe.yOffset<_i&&Pe.width>0&&Pe.width<=en&&Pe.height>0&&Pe.height<=_i,"copy texture read out of bounds")}else if(!pt)Pe.width=Pe.width||1,Pe.height=Pe.height||1,Pe.channels=Pe.channels||4;else if(n(pt))Pe.channels=Pe.channels||4,Pe.data=pt,!("type"in St)&&Pe.type===Qu&&(Pe.type=Qs(pt));else if(xc(pt))Pe.channels=Pe.channels||4,Bn(Pe,pt),Pe.alignment=1,Pe.needsFree=!0;else if(be(pt)){var Ae=pt.data;!Array.isArray(Ae)&&Pe.type===Qu&&(Pe.type=Qs(Ae));var fe=pt.shape,Ue=pt.stride,ut,Et,Je,We,tt,he;fe.length===3?(Je=fe[2],he=Ue[2]):(X(fe.length===2,"invalid ndarray pixel data, must be 2 or 3D"),Je=1,he=1),ut=fe[0],Et=fe[1],We=Ue[0],tt=Ue[1],Pe.alignment=1,Pe.width=ut,Pe.height=Et,Pe.channels=Je,Pe.format=Pe.internalformat=gh[Je],Pe.needsFree=!0,is(Pe,Ae,We,tt,he,pt.offset)}else if(wh(pt)||_h(pt)||xh(pt)||Ks(pt))wh(pt)||_h(pt)||xh(pt)?Pe.element=pt:Pe.element=pt.canvas,Pe.width=Pe.element.width,Pe.height=Pe.element.height,Pe.channels=4;else if(Cu(pt))Pe.element=pt,Pe.width=pt.width,Pe.height=pt.height,Pe.channels=4;else if(bh(pt))Pe.element=pt,Pe.width=pt.naturalWidth,Pe.height=pt.naturalHeight,Pe.channels=4;else if(Eh(pt))Pe.element=pt,Pe.width=pt.width,Pe.height=pt.height,Pe.channels=4;else if(Kc(pt))Pe.element=pt,Pe.width=pt.videoWidth,Pe.height=pt.videoHeight,Pe.channels=4;else if(Wo(pt)){var je=Pe.width||pt[0].length,Te=Pe.height||pt.length,at=Pe.channels;wa(pt[0][0])?at=at||pt[0][0].length:at=at||1;for(var dt=Lt.shape(pt),Qt=1,Tr=0;Tr<dt.length;++Tr)Qt*=dt[Tr];var Cr=Ga(Pe,Qt);Lt.flatten(pt,dt,"",Cr),du(Pe,Cr),Pe.alignment=1,Pe.width=je,Pe.height=Te,Pe.channels=at,Pe.format=Pe.internalformat=gh[at],Pe.needsFree=!0}Pe.type===Sf?X(De.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):Pe.type===wl&&X(De.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function Vr(Pe,St,pt){var en=Pe.element,_i=Pe.data,Ae=Pe.internalformat,fe=Pe.format,Ue=Pe.type,ut=Pe.width,Et=Pe.height;Pr(Pe),en?j.texImage2D(St,pt,fe,fe,Ue,en):Pe.compressed?j.compressedTexImage2D(St,pt,Ae,ut,Et,0,_i):Pe.needsCopy?(bt(),j.copyTexImage2D(St,pt,fe,Pe.xOffset,Pe.yOffset,ut,Et,0)):j.texImage2D(St,pt,fe,ut,Et,0,fe,Ue,_i||null)}function Gn(Pe,St,pt,en,_i){var Ae=Pe.element,fe=Pe.data,Ue=Pe.internalformat,ut=Pe.format,Et=Pe.type,Je=Pe.width,We=Pe.height;Pr(Pe),Ae?j.texSubImage2D(St,_i,pt,en,ut,Et,Ae):Pe.compressed?j.compressedTexSubImage2D(St,_i,pt,en,Ue,Je,We,fe):Pe.needsCopy?(bt(),j.copyTexSubImage2D(St,_i,pt,en,Pe.xOffset,Pe.yOffset,Je,We)):j.texSubImage2D(St,_i,pt,en,Je,We,ut,Et,fe)}var Vn=[];function Gr(){return Vn.pop()||new fr}function Xr(Pe){Pe.needsFree&&Sr.freeType(Pe.data),fr.call(Pe),Vn.push(Pe)}function Pn(){Wt.call(this),this.genMipmaps=!1,this.mipmapHint=Rs,this.mipmask=0,this.images=Array(16)}function Wn(Pe,St,pt){var en=Pe.images[0]=Gr();Pe.mipmask=1,en.width=Pe.width=St,en.height=Pe.height=pt,en.channels=Pe.channels=4}function Jn(Pe,St){var pt=null;if(pu(St))pt=Pe.images[0]=Gr(),jt(pt,Pe),zr(pt,St),Pe.mipmask=1;else if(kr(Pe,St),Array.isArray(St.mipmap))for(var en=St.mipmap,_i=0;_i<en.length;++_i)pt=Pe.images[_i]=Gr(),jt(pt,Pe),pt.width>>=_i,pt.height>>=_i,zr(pt,en[_i]),Pe.mipmask|=1<<_i;else pt=Pe.images[0]=Gr(),jt(pt,Pe),zr(pt,St),Pe.mipmask=1;jt(Pe,Pe.images[0]),Pe.compressed&&(Pe.internalformat===mc||Pe.internalformat===rp||Pe.internalformat===cu||Pe.internalformat===fu)&&X(Pe.width%4===0&&Pe.height%4===0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function _a(Pe,St){for(var pt=Pe.images,en=0;en<pt.length;++en){if(!pt[en])return;Vr(pt[en],St,en)}}var po=[];function gi(){var Pe=po.pop()||new Pn;Wt.call(Pe),Pe.mipmask=0;for(var St=0;St<16;++St)Pe.images[St]=null;return Pe}function ss(Pe){for(var St=Pe.images,pt=0;pt<St.length;++pt)St[pt]&&Xr(St[pt]),St[pt]=null;po.push(Pe)}function Ba(){this.minFilter=Nt,this.magFilter=Nt,this.wrapS=vh,this.wrapT=vh,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=Rs}function Uo(Pe,St){if("min"in St){var pt=St.min;X.parameter(pt,pr),Pe.minFilter=pr[pt],_c.indexOf(Pe.minFilter)>=0&&!("faces"in St)&&(Pe.genMipmaps=!0)}if("mag"in St){var en=St.mag;X.parameter(en,dr),Pe.magFilter=dr[en]}var _i=Pe.wrapS,Ae=Pe.wrapT;if("wrap"in St){var fe=St.wrap;typeof fe=="string"?(X.parameter(fe,ur),_i=Ae=ur[fe]):Array.isArray(fe)&&(X.parameter(fe[0],ur),X.parameter(fe[1],ur),_i=ur[fe[0]],Ae=ur[fe[1]])}else{if("wrapS"in St){var Ue=St.wrapS;X.parameter(Ue,ur),_i=ur[Ue]}if("wrapT"in St){var ut=St.wrapT;X.parameter(ut,ur),Ae=ur[ut]}}if(Pe.wrapS=_i,Pe.wrapT=Ae,"anisotropic"in St){var Et=St.anisotropic;X(typeof Et=="number"&&Et>=1&&Et<=De.maxAnisotropic,"aniso samples must be between 1 and "),Pe.anisotropic=St.anisotropic}if("mipmap"in St){var Je=!1;switch(typeof St.mipmap){case"string":X.parameter(St.mipmap,Kt,"invalid mipmap hint"),Pe.mipmapHint=Kt[St.mipmap],Pe.genMipmaps=!0,Je=!0;break;case"boolean":Je=Pe.genMipmaps=St.mipmap;break;case"object":X(Array.isArray(St.mipmap),"invalid mipmap type"),Pe.genMipmaps=!1,Je=!0;break;default:X.raise("invalid mipmap type")}Je&&!("min"in St)&&(Pe.minFilter=si)}}function Lo(Pe,St){j.texParameteri(St,Jt,Pe.minFilter),j.texParameteri(St,ft,Pe.magFilter),j.texParameteri(St,Hd,Pe.wrapS),j.texParameteri(St,ap,Pe.wrapT),_e.ext_texture_filter_anisotropic&&j.texParameteri(St,mh,Pe.anisotropic),Pe.genMipmaps&&(j.hint(ya,Pe.mipmapHint),j.generateMipmap(St))}var us=0,ls={},ys=De.maxTextureUnits,so=Array(ys).map(function(){return null});function ui(Pe){Wt.call(this),this.mipmask=0,this.internalformat=Vl,this.id=us++,this.refCount=1,this.target=Pe,this.texture=j.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new Ba,Bt.profile&&(this.stats={size:0})}function Vo(Pe){j.activeTexture($a),j.bindTexture(Pe.target,Pe.texture)}function Zi(){var Pe=so[0];Pe?j.bindTexture(Pe.target,Pe.texture):j.bindTexture(Ps,null)}function So(Pe){var St=Pe.texture;X(St,"must not double destroy texture");var pt=Pe.unit,en=Pe.target;pt>=0&&(j.activeTexture($a+pt),j.bindTexture(en,null),so[pt]=null),j.deleteTexture(St),Pe.texture=null,Pe.params=null,Pe.pixels=null,Pe.refCount=0,delete ls[Pe.id],xt.textureCount--}i(ui.prototype,{bind:function(){var Pe=this;Pe.bindCount+=1;var St=Pe.unit;if(St<0){for(var pt=0;pt<ys;++pt){var en=so[pt];if(en){if(en.bindCount>0)continue;en.unit=-1}so[pt]=Pe,St=pt;break}St>=ys&&X.raise("insufficient number of texture units"),Bt.profile&&xt.maxTextureUnits<St+1&&(xt.maxTextureUnits=St+1),Pe.unit=St,j.activeTexture($a+St),j.bindTexture(Pe.target,Pe.texture)}return St},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&So(this)}});function kn(Pe,St){var pt=new ui(Ps);ls[pt.id]=pt,xt.textureCount++;function en(fe,Ue){var ut=pt.texInfo;Ba.call(ut);var Et=gi();return typeof fe=="number"?typeof Ue=="number"?Wn(Et,fe|0,Ue|0):Wn(Et,fe|0,fe|0):fe?(X.type(fe,"object","invalid arguments to regl.texture"),Uo(ut,fe),Jn(Et,fe)):Wn(Et,1,1),ut.genMipmaps&&(Et.mipmask=(Et.width<<1)-1),pt.mipmask=Et.mipmask,jt(pt,Et),X.texture2D(ut,Et,De),pt.internalformat=Et.internalformat,en.width=Et.width,en.height=Et.height,Vo(pt),_a(Et,Ps),Lo(ut,Ps),Zi(),ss(Et),Bt.profile&&(pt.stats.size=el(pt.internalformat,pt.type,Et.width,Et.height,ut.genMipmaps,!1)),en.format=lr[pt.internalformat],en.type=Br[pt.type],en.mag=Zt[ut.magFilter],en.min=br[ut.minFilter],en.wrapS=Lr[ut.wrapS],en.wrapT=Lr[ut.wrapT],en}function _i(fe,Ue,ut,Et){X(!!fe,"must specify image data");var Je=Ue|0,We=ut|0,tt=Et|0,he=Gr();return jt(he,pt),he.width=0,he.height=0,zr(he,fe),he.width=he.width||(pt.width>>tt)-Je,he.height=he.height||(pt.height>>tt)-We,X(pt.type===he.type&&pt.format===he.format&&pt.internalformat===he.internalformat,"incompatible format for texture.subimage"),X(Je>=0&&We>=0&&Je+he.width<=pt.width&&We+he.height<=pt.height,"texture.subimage write out of bounds"),X(pt.mipmask&1<<tt,"missing mipmap data"),X(he.data||he.element||he.needsCopy,"missing image data"),Vo(pt),Gn(he,Ps,Je,We,tt),Zi(),Xr(he),en}function Ae(fe,Ue){var ut=fe|0,Et=Ue|0||ut;if(ut===pt.width&&Et===pt.height)return en;en.width=pt.width=ut,en.height=pt.height=Et,Vo(pt);for(var Je=0;pt.mipmask>>Je;++Je){var We=ut>>Je,tt=Et>>Je;if(!We||!tt)break;j.texImage2D(Ps,Je,pt.format,We,tt,0,pt.format,pt.type,null)}return Zi(),Bt.profile&&(pt.stats.size=el(pt.internalformat,pt.type,ut,Et,!1,!1)),en}return en(Pe,St),en.subimage=_i,en.resize=Ae,en._reglType="texture2d",en._texture=pt,Bt.profile&&(en.stats=pt.stats),en.destroy=function(){pt.decRef()},en}function yi(Pe,St,pt,en,_i,Ae){var fe=new ui(fh);ls[fe.id]=fe,xt.cubeCount++;var Ue=new Array(6);function ut(We,tt,he,je,Te,at){var dt,Qt=fe.texInfo;for(Ba.call(Qt),dt=0;dt<6;++dt)Ue[dt]=gi();if(typeof We=="number"||!We){var Tr=We|0||1;for(dt=0;dt<6;++dt)Wn(Ue[dt],Tr,Tr)}else if(typeof We=="object")if(tt)Jn(Ue[0],We),Jn(Ue[1],tt),Jn(Ue[2],he),Jn(Ue[3],je),Jn(Ue[4],Te),Jn(Ue[5],at);else if(Uo(Qt,We),kr(fe,We),"faces"in We){var Cr=We.faces;for(X(Array.isArray(Cr)&&Cr.length===6,"cube faces must be a length 6 array"),dt=0;dt<6;++dt)X(typeof Cr[dt]=="object"&&!!Cr[dt],"invalid input for cube map face"),jt(Ue[dt],fe),Jn(Ue[dt],Cr[dt])}else for(dt=0;dt<6;++dt)Jn(Ue[dt],We);else X.raise("invalid arguments to cube map");for(jt(fe,Ue[0]),X.optional(function(){De.npotTextureCube||X(Ul(fe.width)&&Ul(fe.height),"your browser does not support non power or two texture dimensions")}),Qt.genMipmaps?fe.mipmask=(Ue[0].width<<1)-1:fe.mipmask=Ue[0].mipmask,X.textureCube(fe,Qt,Ue,De),fe.internalformat=Ue[0].internalformat,ut.width=Ue[0].width,ut.height=Ue[0].height,Vo(fe),dt=0;dt<6;++dt)_a(Ue[dt],Zu+dt);for(Lo(Qt,fh),Zi(),Bt.profile&&(fe.stats.size=el(fe.internalformat,fe.type,ut.width,ut.height,Qt.genMipmaps,!0)),ut.format=lr[fe.internalformat],ut.type=Br[fe.type],ut.mag=Zt[Qt.magFilter],ut.min=br[Qt.minFilter],ut.wrapS=Lr[Qt.wrapS],ut.wrapT=Lr[Qt.wrapT],dt=0;dt<6;++dt)ss(Ue[dt]);return ut}function Et(We,tt,he,je,Te){X(!!tt,"must specify image data"),X(typeof We=="number"&&We===(We|0)&&We>=0&&We<6,"invalid face");var at=he|0,dt=je|0,Qt=Te|0,Tr=Gr();return jt(Tr,fe),Tr.width=0,Tr.height=0,zr(Tr,tt),Tr.width=Tr.width||(fe.width>>Qt)-at,Tr.height=Tr.height||(fe.height>>Qt)-dt,X(fe.type===Tr.type&&fe.format===Tr.format&&fe.internalformat===Tr.internalformat,"incompatible format for texture.subimage"),X(at>=0&&dt>=0&&at+Tr.width<=fe.width&&dt+Tr.height<=fe.height,"texture.subimage write out of bounds"),X(fe.mipmask&1<<Qt,"missing mipmap data"),X(Tr.data||Tr.element||Tr.needsCopy,"missing image data"),Vo(fe),Gn(Tr,Zu+We,at,dt,Qt),Zi(),Xr(Tr),ut}function Je(We){var tt=We|0;if(tt!==fe.width){ut.width=fe.width=tt,ut.height=fe.height=tt,Vo(fe);for(var he=0;he<6;++he)for(var je=0;fe.mipmask>>je;++je)j.texImage2D(Zu+he,je,fe.format,tt>>je,tt>>je,0,fe.format,fe.type,null);return Zi(),Bt.profile&&(fe.stats.size=el(fe.internalformat,fe.type,ut.width,ut.height,!1,!0)),ut}}return ut(Pe,St,pt,en,_i,Ae),ut.subimage=Et,ut.resize=Je,ut._reglType="textureCube",ut._texture=fe,Bt.profile&&(ut.stats=fe.stats),ut.destroy=function(){fe.decRef()},ut}function Sa(){for(var Pe=0;Pe<ys;++Pe)j.activeTexture($a+Pe),j.bindTexture(Ps,null),so[Pe]=null;Xe(ls).forEach(So),xt.cubeCount=0,xt.textureCount=0}Bt.profile&&(xt.getTotalTextureSize=function(){var Pe=0;return Object.keys(ls).forEach(function(St){Pe+=ls[St].stats.size}),Pe});function jo(){for(var Pe=0;Pe<ys;++Pe){var St=so[Pe];St&&(St.bindCount=0,St.unit=-1,so[Pe]=null)}Xe(ls).forEach(function(pt){pt.texture=j.createTexture(),j.bindTexture(pt.target,pt.texture);for(var en=0;en<32;++en)if(pt.mipmask&1<<en)if(pt.target===Ps)j.texImage2D(Ps,en,pt.internalformat,pt.width>>en,pt.height>>en,0,pt.internalformat,pt.type,null);else for(var _i=0;_i<6;++_i)j.texImage2D(Zu+_i,en,pt.internalformat,pt.width>>en,pt.height>>en,0,pt.internalformat,pt.type,null);Lo(pt.texInfo,pt.target)})}function Du(){for(var Pe=0;Pe<ys;++Pe){var St=so[Pe];St&&(St.bindCount=0,St.unit=-1,so[Pe]=null),j.activeTexture($a+Pe),j.bindTexture(Ps,null),j.bindTexture(fh,null)}}return{create2D:kn,createCube:yi,clear:Sa,getTexture:function(Pe){return null},restore:jo,refresh:Du}}var No=36161,ho=32854,wc=32855,_n=36194,on=33189,Gl=36168,Bo=34041,ds=35907,Xo=34836,tl=34842,sp=34843,Js=[];Js[ho]=2,Js[wc]=2,Js[_n]=2,Js[on]=2,Js[Gl]=1,Js[Bo]=4,Js[ds]=4,Js[Xo]=16,Js[tl]=8,Js[sp]=6;function ea(j,_e,De){return Js[j]*_e*De}var bo=function(j,_e,De,bt,Xt){var xt={rgba4:ho,rgb565:_n,"rgb5 a1":wc,depth:on,stencil:Gl,"depth stencil":Bo};_e.ext_srgb&&(xt.srgba=ds),_e.ext_color_buffer_half_float&&(xt.rgba16f=tl,xt.rgb16f=sp),_e.webgl_color_buffer_float&&(xt.rgba32f=Xo);var Bt=[];Object.keys(xt).forEach(function(ar){var vr=xt[ar];Bt[vr]=ar});var Kt=0,ur={};function dr(ar){this.id=Kt++,this.refCount=1,this.renderbuffer=ar,this.format=ho,this.width=0,this.height=0,Xt.profile&&(this.stats={size:0})}dr.prototype.decRef=function(){--this.refCount<=0&&pr(this)};function pr(ar){var vr=ar.renderbuffer;X(vr,"must not double destroy renderbuffer"),j.bindRenderbuffer(No,null),j.deleteRenderbuffer(vr),ar.renderbuffer=null,ar.refCount=0,delete ur[ar.id],bt.renderbufferCount--}function rr(ar,vr){var lt=new dr(j.createRenderbuffer());ur[lt.id]=lt,bt.renderbufferCount++;function Rt(Br,Zt){var br=0,Lr=0,sn=ho;if(typeof Br=="object"&&Br){var Wt=Br;if("shape"in Wt){var jt=Wt.shape;X(Array.isArray(jt)&&jt.length>=2,"invalid renderbuffer shape"),br=jt[0]|0,Lr=jt[1]|0}else"radius"in Wt&&(br=Lr=Wt.radius|0),"width"in Wt&&(br=Wt.width|0),"height"in Wt&&(Lr=Wt.height|0);"format"in Wt&&(X.parameter(Wt.format,xt,"invalid renderbuffer format"),sn=xt[Wt.format])}else typeof Br=="number"?(br=Br|0,typeof Zt=="number"?Lr=Zt|0:Lr=br):Br?X.raise("invalid arguments to renderbuffer constructor"):br=Lr=1;if(X(br>0&&Lr>0&&br<=De.maxRenderbufferSize&&Lr<=De.maxRenderbufferSize,"invalid renderbuffer size"),!(br===lt.width&&Lr===lt.height&&sn===lt.format))return Rt.width=lt.width=br,Rt.height=lt.height=Lr,lt.format=sn,j.bindRenderbuffer(No,lt.renderbuffer),j.renderbufferStorage(No,sn,br,Lr),X(j.getError()===0,"invalid render buffer format"),Xt.profile&&(lt.stats.size=ea(lt.format,lt.width,lt.height)),Rt.format=Bt[lt.format],Rt}function lr(Br,Zt){var br=Br|0,Lr=Zt|0||br;return br===lt.width&&Lr===lt.height||(X(br>0&&Lr>0&&br<=De.maxRenderbufferSize&&Lr<=De.maxRenderbufferSize,"invalid renderbuffer size"),Rt.width=lt.width=br,Rt.height=lt.height=Lr,j.bindRenderbuffer(No,lt.renderbuffer),j.renderbufferStorage(No,lt.format,br,Lr),X(j.getError()===0,"invalid render buffer format"),Xt.profile&&(lt.stats.size=ea(lt.format,lt.width,lt.height))),Rt}return Rt(ar,vr),Rt.resize=lr,Rt._reglType="renderbuffer",Rt._renderbuffer=lt,Xt.profile&&(Rt.stats=lt.stats),Rt.destroy=function(){lt.decRef()},Rt}Xt.profile&&(bt.getTotalRenderbufferSize=function(){var ar=0;return Object.keys(ur).forEach(function(vr){ar+=ur[vr].stats.size}),ar});function hr(){Xe(ur).forEach(function(ar){ar.renderbuffer=j.createRenderbuffer(),j.bindRenderbuffer(No,ar.renderbuffer),j.renderbufferStorage(No,ar.format,ar.width,ar.height)}),j.bindRenderbuffer(No,null)}return{create:rr,clear:function(){Xe(ur).forEach(pr)},restore:hr}},eu=36160,Al=36161,me=3553,vs=34069,as=36064,os=36096,mi=36128,Sh=33306,Qc=36053,Ah=36054,Hl=36055,Tf=36057,Jc=36061,ed=36193,Ec=5121,Sc=5126,vu=6407,Wl=6408,Mu=6402,td=[vu,Wl],ef=[];ef[Wl]=4,ef[vu]=3;var Cf=[];Cf[Ec]=1,Cf[Sc]=4,Cf[ed]=2;var Pu=32854,p=32855,v=36194,d=33189,_=36168,A=34041,M=35907,R=34836,B=34842,G=34843,J=[Pu,p,v,M,B,G,R],ce={};ce[Qc]="complete",ce[Ah]="incomplete attachment",ce[Tf]="incomplete dimensions",ce[Hl]="incomplete, missing attachment",ce[Jc]="unsupported";function ve(j,_e,De,bt,Xt,xt){var Bt={cur:null,next:null,dirty:!1,setFBO:null},Kt=["rgba"],ur=["rgba4","rgb565","rgb5 a1"];_e.ext_srgb&&ur.push("srgba"),_e.ext_color_buffer_half_float&&ur.push("rgba16f","rgb16f"),_e.webgl_color_buffer_float&&ur.push("rgba32f");var dr=["uint8"];_e.oes_texture_half_float&&dr.push("half float","float16"),_e.oes_texture_float&&dr.push("float","float32");function pr(fr,zr,Vr){this.target=fr,this.texture=zr,this.renderbuffer=Vr;var Gn=0,Vn=0;zr?(Gn=zr.width,Vn=zr.height):Vr&&(Gn=Vr.width,Vn=Vr.height),this.width=Gn,this.height=Vn}function rr(fr){fr&&(fr.texture&&fr.texture._texture.decRef(),fr.renderbuffer&&fr.renderbuffer._renderbuffer.decRef())}function hr(fr,zr,Vr){if(fr)if(fr.texture){var Gn=fr.texture._texture,Vn=Math.max(1,Gn.width),Gr=Math.max(1,Gn.height);X(Vn===zr&&Gr===Vr,"inconsistent width/height for supplied texture"),Gn.refCount+=1}else{var Xr=fr.renderbuffer._renderbuffer;X(Xr.width===zr&&Xr.height===Vr,"inconsistent width/height for renderbuffer"),Xr.refCount+=1}}function ar(fr,zr){zr&&(zr.texture?j.framebufferTexture2D(eu,fr,zr.target,zr.texture._texture.texture,0):j.framebufferRenderbuffer(eu,fr,Al,zr.renderbuffer._renderbuffer.renderbuffer))}function vr(fr){var zr=me,Vr=null,Gn=null,Vn=fr;typeof fr=="object"&&(Vn=fr.data,"target"in fr&&(zr=fr.target|0)),X.type(Vn,"function","invalid attachment data");var Gr=Vn._reglType;return Gr==="texture2d"?(Vr=Vn,X(zr===me)):Gr==="textureCube"?(Vr=Vn,X(zr>=vs&&zr<vs+6,"invalid cube map target")):Gr==="renderbuffer"?(Gn=Vn,zr=Al):X.raise("invalid regl object for attachment"),new pr(zr,Vr,Gn)}function lt(fr,zr,Vr,Gn,Vn){if(Vr){var Gr=bt.create2D({width:fr,height:zr,format:Gn,type:Vn});return Gr._texture.refCount=0,new pr(me,Gr,null)}else{var Xr=Xt.create({width:fr,height:zr,format:Gn});return Xr._renderbuffer.refCount=0,new pr(Al,null,Xr)}}function Rt(fr){return fr&&(fr.texture||fr.renderbuffer)}function lr(fr,zr,Vr){fr&&(fr.texture?fr.texture.resize(zr,Vr):fr.renderbuffer&&fr.renderbuffer.resize(zr,Vr),fr.width=zr,fr.height=Vr)}var Br=0,Zt={};function br(){this.id=Br++,Zt[this.id]=this,this.framebuffer=j.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function Lr(fr){fr.colorAttachments.forEach(rr),rr(fr.depthAttachment),rr(fr.stencilAttachment),rr(fr.depthStencilAttachment)}function sn(fr){var zr=fr.framebuffer;X(zr,"must not double destroy framebuffer"),j.deleteFramebuffer(zr),fr.framebuffer=null,xt.framebufferCount--,delete Zt[fr.id]}function Wt(fr){var zr;j.bindFramebuffer(eu,fr.framebuffer);var Vr=fr.colorAttachments;for(zr=0;zr<Vr.length;++zr)ar(as+zr,Vr[zr]);for(zr=Vr.length;zr<De.maxColorAttachments;++zr)j.framebufferTexture2D(eu,as+zr,me,null,0);j.framebufferTexture2D(eu,Sh,me,null,0),j.framebufferTexture2D(eu,os,me,null,0),j.framebufferTexture2D(eu,mi,me,null,0),ar(os,fr.depthAttachment),ar(mi,fr.stencilAttachment),ar(Sh,fr.depthStencilAttachment);var Gn=j.checkFramebufferStatus(eu);!j.isContextLost()&&Gn!==Qc&&X.raise("framebuffer configuration not supported, status = "+ce[Gn]),j.bindFramebuffer(eu,Bt.next?Bt.next.framebuffer:null),Bt.cur=Bt.next,j.getError()}function jt(fr,zr){var Vr=new br;xt.framebufferCount++;function Gn(Gr,Xr){var Pn;X(Bt.next!==Vr,"can not update framebuffer which is currently in use");var Wn=0,Jn=0,_a=!0,po=!0,gi=null,ss=!0,Ba="rgba",Uo="uint8",Lo=1,us=null,ls=null,ys=null,so=!1;if(typeof Gr=="number")Wn=Gr|0,Jn=Xr|0||Wn;else if(!Gr)Wn=Jn=1;else{X.type(Gr,"object","invalid arguments for framebuffer");var ui=Gr;if("shape"in ui){var Vo=ui.shape;X(Array.isArray(Vo)&&Vo.length>=2,"invalid shape for framebuffer"),Wn=Vo[0],Jn=Vo[1]}else"radius"in ui&&(Wn=Jn=ui.radius),"width"in ui&&(Wn=ui.width),"height"in ui&&(Jn=ui.height);("color"in ui||"colors"in ui)&&(gi=ui.color||ui.colors,Array.isArray(gi)&&X(gi.length===1||_e.webgl_draw_buffers,"multiple render targets not supported")),gi||("colorCount"in ui&&(Lo=ui.colorCount|0,X(Lo>0,"invalid color buffer count")),"colorTexture"in ui&&(ss=!!ui.colorTexture,Ba="rgba4"),"colorType"in ui&&(Uo=ui.colorType,ss?(X(_e.oes_texture_float||!(Uo==="float"||Uo==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),X(_e.oes_texture_half_float||!(Uo==="half float"||Uo==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):Uo==="half float"||Uo==="float16"?(X(_e.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),Ba="rgba16f"):(Uo==="float"||Uo==="float32")&&(X(_e.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),Ba="rgba32f"),X.oneOf(Uo,dr,"invalid color type")),"colorFormat"in ui&&(Ba=ui.colorFormat,Kt.indexOf(Ba)>=0?ss=!0:ur.indexOf(Ba)>=0?ss=!1:X.optional(function(){ss?X.oneOf(ui.colorFormat,Kt,"invalid color format for texture"):X.oneOf(ui.colorFormat,ur,"invalid color format for renderbuffer")}))),("depthTexture"in ui||"depthStencilTexture"in ui)&&(so=!!(ui.depthTexture||ui.depthStencilTexture),X(!so||_e.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in ui&&(typeof ui.depth=="boolean"?_a=ui.depth:(us=ui.depth,po=!1)),"stencil"in ui&&(typeof ui.stencil=="boolean"?po=ui.stencil:(ls=ui.stencil,_a=!1)),"depthStencil"in ui&&(typeof ui.depthStencil=="boolean"?_a=po=ui.depthStencil:(ys=ui.depthStencil,_a=!1,po=!1))}var Zi=null,So=null,kn=null,yi=null;if(Array.isArray(gi))Zi=gi.map(vr);else if(gi)Zi=[vr(gi)];else for(Zi=new Array(Lo),Pn=0;Pn<Lo;++Pn)Zi[Pn]=lt(Wn,Jn,ss,Ba,Uo);X(_e.webgl_draw_buffers||Zi.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),X(Zi.length<=De.maxColorAttachments,"too many color attachments, not supported"),Wn=Wn||Zi[0].width,Jn=Jn||Zi[0].height,us?So=vr(us):_a&&!po&&(So=lt(Wn,Jn,so,"depth","uint32")),ls?kn=vr(ls):po&&!_a&&(kn=lt(Wn,Jn,!1,"stencil","uint8")),ys?yi=vr(ys):!us&&!ls&&po&&_a&&(yi=lt(Wn,Jn,so,"depth stencil","depth stencil")),X(!!us+!!ls+!!ys<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var Sa=null;for(Pn=0;Pn<Zi.length;++Pn)if(hr(Zi[Pn],Wn,Jn),X(!Zi[Pn]||Zi[Pn].texture&&td.indexOf(Zi[Pn].texture._texture.format)>=0||Zi[Pn].renderbuffer&&J.indexOf(Zi[Pn].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+Pn+" is invalid"),Zi[Pn]&&Zi[Pn].texture){var jo=ef[Zi[Pn].texture._texture.format]*Cf[Zi[Pn].texture._texture.type];Sa===null?Sa=jo:X(Sa===jo,"all color attachments much have the same number of bits per pixel.")}return hr(So,Wn,Jn),X(!So||So.texture&&So.texture._texture.format===Mu||So.renderbuffer&&So.renderbuffer._renderbuffer.format===d,"invalid depth attachment for framebuffer object"),hr(kn,Wn,Jn),X(!kn||kn.renderbuffer&&kn.renderbuffer._renderbuffer.format===_,"invalid stencil attachment for framebuffer object"),hr(yi,Wn,Jn),X(!yi||yi.texture&&yi.texture._texture.format===A||yi.renderbuffer&&yi.renderbuffer._renderbuffer.format===A,"invalid depth-stencil attachment for framebuffer object"),Lr(Vr),Vr.width=Wn,Vr.height=Jn,Vr.colorAttachments=Zi,Vr.depthAttachment=So,Vr.stencilAttachment=kn,Vr.depthStencilAttachment=yi,Gn.color=Zi.map(Rt),Gn.depth=Rt(So),Gn.stencil=Rt(kn),Gn.depthStencil=Rt(yi),Gn.width=Vr.width,Gn.height=Vr.height,Wt(Vr),Gn}function Vn(Gr,Xr){X(Bt.next!==Vr,"can not resize a framebuffer which is currently in use");var Pn=Math.max(Gr|0,1),Wn=Math.max(Xr|0||Pn,1);if(Pn===Vr.width&&Wn===Vr.height)return Gn;for(var Jn=Vr.colorAttachments,_a=0;_a<Jn.length;++_a)lr(Jn[_a],Pn,Wn);return lr(Vr.depthAttachment,Pn,Wn),lr(Vr.stencilAttachment,Pn,Wn),lr(Vr.depthStencilAttachment,Pn,Wn),Vr.width=Gn.width=Pn,Vr.height=Gn.height=Wn,Wt(Vr),Gn}return Gn(fr,zr),i(Gn,{resize:Vn,_reglType:"framebuffer",_framebuffer:Vr,destroy:function(){sn(Vr),Lr(Vr)},use:function(Gr){Bt.setFBO({framebuffer:Gn},Gr)}})}function kr(fr){var zr=Array(6);function Vr(Vn){var Gr;X(zr.indexOf(Bt.next)<0,"can not update framebuffer which is currently in use");var Xr={color:null},Pn=0,Wn=null,Jn="rgba",_a="uint8",po=1;if(typeof Vn=="number")Pn=Vn|0;else if(!Vn)Pn=1;else{X.type(Vn,"object","invalid arguments for framebuffer");var gi=Vn;if("shape"in gi){var ss=gi.shape;X(Array.isArray(ss)&&ss.length>=2,"invalid shape for framebuffer"),X(ss[0]===ss[1],"cube framebuffer must be square"),Pn=ss[0]}else"radius"in gi&&(Pn=gi.radius|0),"width"in gi?(Pn=gi.width|0,"height"in gi&&X(gi.height===Pn,"must be square")):"height"in gi&&(Pn=gi.height|0);("color"in gi||"colors"in gi)&&(Wn=gi.color||gi.colors,Array.isArray(Wn)&&X(Wn.length===1||_e.webgl_draw_buffers,"multiple render targets not supported")),Wn||("colorCount"in gi&&(po=gi.colorCount|0,X(po>0,"invalid color buffer count")),"colorType"in gi&&(X.oneOf(gi.colorType,dr,"invalid color type"),_a=gi.colorType),"colorFormat"in gi&&(Jn=gi.colorFormat,X.oneOf(gi.colorFormat,Kt,"invalid color format for texture"))),"depth"in gi&&(Xr.depth=gi.depth),"stencil"in gi&&(Xr.stencil=gi.stencil),"depthStencil"in gi&&(Xr.depthStencil=gi.depthStencil)}var Ba;if(Wn)if(Array.isArray(Wn))for(Ba=[],Gr=0;Gr<Wn.length;++Gr)Ba[Gr]=Wn[Gr];else Ba=[Wn];else{Ba=Array(po);var Uo={radius:Pn,format:Jn,type:_a};for(Gr=0;Gr<po;++Gr)Ba[Gr]=bt.createCube(Uo)}for(Xr.color=Array(Ba.length),Gr=0;Gr<Ba.length;++Gr){var Lo=Ba[Gr];X(typeof Lo=="function"&&Lo._reglType==="textureCube","invalid cube map"),Pn=Pn||Lo.width,X(Lo.width===Pn&&Lo.height===Pn,"invalid cube map shape"),Xr.color[Gr]={target:vs,data:Ba[Gr]}}for(Gr=0;Gr<6;++Gr){for(var us=0;us<Ba.length;++us)Xr.color[us].target=vs+Gr;Gr>0&&(Xr.depth=zr[0].depth,Xr.stencil=zr[0].stencil,Xr.depthStencil=zr[0].depthStencil),zr[Gr]?zr[Gr](Xr):zr[Gr]=jt(Xr)}return i(Vr,{width:Pn,height:Pn,color:Ba})}function Gn(Vn){var Gr,Xr=Vn|0;if(X(Xr>0&&Xr<=De.maxCubeMapSize,"invalid radius for cube fbo"),Xr===Vr.width)return Vr;var Pn=Vr.color;for(Gr=0;Gr<Pn.length;++Gr)Pn[Gr].resize(Xr);for(Gr=0;Gr<6;++Gr)zr[Gr].resize(Xr);return Vr.width=Vr.height=Xr,Vr}return Vr(fr),i(Vr,{faces:zr,resize:Gn,_reglType:"framebufferCube",destroy:function(){zr.forEach(function(Vn){Vn.destroy()})}})}function Pr(){Bt.cur=null,Bt.next=null,Bt.dirty=!0,Xe(Zt).forEach(function(fr){fr.framebuffer=j.createFramebuffer(),Wt(fr)})}return i(Bt,{getFramebuffer:function(fr){if(typeof fr=="function"&&fr._reglType==="framebuffer"){var zr=fr._framebuffer;if(zr instanceof br)return zr}return null},create:jt,createCube:kr,clear:function(){Xe(Zt).forEach(sn)},restore:Pr})}var ye=5126,Oe=34962,Re=34963,Ge=["attributes","elements","offset","count","primitive","instances"];function Me(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=ye,this.offset=0,this.stride=0,this.divisor=0}function He(j,_e,De,bt,Xt,xt,Bt){for(var Kt=De.maxAttributes,ur=new Array(Kt),dr=0;dr<Kt;++dr)ur[dr]=new Me;var pr=0,rr={},hr={Record:Me,scope:{},state:ur,currentVAO:null,targetVAO:null,restore:vr()?Lr:function(){},createVAO:sn,getVAO:Rt,destroyBuffer:ar,setVAO:vr()?lr:Br,clear:vr()?Zt:function(){}};function ar(Wt){for(var jt=0;jt<ur.length;++jt){var kr=ur[jt];kr.buffer===Wt&&(j.disableVertexAttribArray(jt),kr.buffer=null)}}function vr(){return _e.oes_vertex_array_object}function lt(){return _e.angle_instanced_arrays}function Rt(Wt){return typeof Wt=="function"&&Wt._vao?Wt._vao:null}function lr(Wt){if(Wt!==hr.currentVAO){var jt=vr();Wt?jt.bindVertexArrayOES(Wt.vao):jt.bindVertexArrayOES(null),hr.currentVAO=Wt}}function Br(Wt){if(Wt!==hr.currentVAO){if(Wt)Wt.bindAttrs();else{for(var jt=lt(),kr=0;kr<ur.length;++kr){var Pr=ur[kr];Pr.buffer?(j.enableVertexAttribArray(kr),Pr.buffer.bind(),j.vertexAttribPointer(kr,Pr.size,Pr.type,Pr.normalized,Pr.stride,Pr.offfset),jt&&Pr.divisor&&jt.vertexAttribDivisorANGLE(kr,Pr.divisor)):(j.disableVertexAttribArray(kr),j.vertexAttrib4f(kr,Pr.x,Pr.y,Pr.z,Pr.w))}Bt.elements?j.bindBuffer(Re,Bt.elements.buffer.buffer):j.bindBuffer(Re,null)}hr.currentVAO=Wt}}function Zt(){Xe(rr).forEach(function(Wt){Wt.destroy()})}function br(){this.id=++pr,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var Wt=vr();Wt?this.vao=Wt.createVertexArrayOES():this.vao=null,rr[this.id]=this,this.buffers=[]}br.prototype.bindAttrs=function(){for(var Wt=lt(),jt=this.attributes,kr=0;kr<jt.length;++kr){var Pr=jt[kr];Pr.buffer?(j.enableVertexAttribArray(kr),j.bindBuffer(Oe,Pr.buffer.buffer),j.vertexAttribPointer(kr,Pr.size,Pr.type,Pr.normalized,Pr.stride,Pr.offset),Wt&&Pr.divisor&&Wt.vertexAttribDivisorANGLE(kr,Pr.divisor)):(j.disableVertexAttribArray(kr),j.vertexAttrib4f(kr,Pr.x,Pr.y,Pr.z,Pr.w))}for(var fr=jt.length;fr<Kt;++fr)j.disableVertexAttribArray(fr);var zr=xt.getElements(this.elements);zr?j.bindBuffer(Re,zr.buffer.buffer):j.bindBuffer(Re,null)},br.prototype.refresh=function(){var Wt=vr();Wt&&(Wt.bindVertexArrayOES(this.vao),this.bindAttrs(),hr.currentVAO=null,Wt.bindVertexArrayOES(null))},br.prototype.destroy=function(){if(this.vao){var Wt=vr();this===hr.currentVAO&&(hr.currentVAO=null,Wt.bindVertexArrayOES(null)),Wt.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),rr[this.id]&&(delete rr[this.id],bt.vaoCount-=1)};function Lr(){var Wt=vr();Wt&&Xe(rr).forEach(function(jt){jt.refresh()})}function sn(Wt){var jt=new br;bt.vaoCount+=1;function kr(Pr){var fr;if(Array.isArray(Pr))fr=Pr,jt.elements&&jt.ownsElements&&jt.elements.destroy(),jt.elements=null,jt.ownsElements=!1,jt.offset=0,jt.count=0,jt.instances=-1,jt.primitive=4;else{if(X(typeof Pr=="object","invalid arguments for create vao"),X("attributes"in Pr,"must specify attributes for vao"),Pr.elements){var zr=Pr.elements;jt.ownsElements?typeof zr=="function"&&zr._reglType==="elements"?(jt.elements.destroy(),jt.ownsElements=!1):(jt.elements(zr),jt.ownsElements=!1):xt.getElements(Pr.elements)?(jt.elements=Pr.elements,jt.ownsElements=!1):(jt.elements=xt.create(Pr.elements),jt.ownsElements=!0)}else jt.elements=null,jt.ownsElements=!1;fr=Pr.attributes,jt.offset=0,jt.count=-1,jt.instances=-1,jt.primitive=4,jt.elements&&(jt.count=jt.elements._elements.vertCount,jt.primitive=jt.elements._elements.primType),"offset"in Pr&&(jt.offset=Pr.offset|0),"count"in Pr&&(jt.count=Pr.count|0),"instances"in Pr&&(jt.instances=Pr.instances|0),"primitive"in Pr&&(X(Pr.primitive in Ms,"bad primitive type: "+Pr.primitive),jt.primitive=Ms[Pr.primitive]),X.optional(function(){for(var _a=Object.keys(Pr),po=0;po<_a.length;++po)X(Ge.indexOf(_a[po])>=0,'invalid option for vao: "'+_a[po]+'" valid options are '+Ge)}),X(Array.isArray(fr),"attributes must be an array")}X(fr.length<Kt,"too many attributes"),X(fr.length>0,"must specify at least one attribute");var Vr={},Gn=jt.attributes;Gn.length=fr.length;for(var Vn=0;Vn<fr.length;++Vn){var Gr=fr[Vn],Xr=Gn[Vn]=new Me,Pn=Gr.data||Gr;if(Array.isArray(Pn)||n(Pn)||be(Pn)){var Wn;jt.buffers[Vn]&&(Wn=jt.buffers[Vn],n(Pn)&&Wn._buffer.byteLength>=Pn.byteLength?Wn.subdata(Pn):(Wn.destroy(),jt.buffers[Vn]=null)),jt.buffers[Vn]||(Wn=jt.buffers[Vn]=Xt.create(Gr,Oe,!1,!0)),Xr.buffer=Xt.getBuffer(Wn),Xr.size=Xr.buffer.dimension|0,Xr.normalized=!1,Xr.type=Xr.buffer.dtype,Xr.offset=0,Xr.stride=0,Xr.divisor=0,Xr.state=1,Vr[Vn]=1}else Xt.getBuffer(Gr)?(Xr.buffer=Xt.getBuffer(Gr),Xr.size=Xr.buffer.dimension|0,Xr.normalized=!1,Xr.type=Xr.buffer.dtype,Xr.offset=0,Xr.stride=0,Xr.divisor=0,Xr.state=1):Xt.getBuffer(Gr.buffer)?(Xr.buffer=Xt.getBuffer(Gr.buffer),Xr.size=(+Gr.size||Xr.buffer.dimension)|0,Xr.normalized=!!Gr.normalized||!1,"type"in Gr?(X.parameter(Gr.type,Ys,"invalid buffer type"),Xr.type=Ys[Gr.type]):Xr.type=Xr.buffer.dtype,Xr.offset=(Gr.offset||0)|0,Xr.stride=(Gr.stride||0)|0,Xr.divisor=(Gr.divisor||0)|0,Xr.state=1,X(Xr.size>=1&&Xr.size<=4,"size must be between 1 and 4"),X(Xr.offset>=0,"invalid offset"),X(Xr.stride>=0&&Xr.stride<=255,"stride must be between 0 and 255"),X(Xr.divisor>=0,"divisor must be positive"),X(!Xr.divisor||!!_e.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in Gr?(X(Vn>0,"first attribute must not be a constant"),Xr.x=+Gr.x||0,Xr.y=+Gr.y||0,Xr.z=+Gr.z||0,Xr.w=+Gr.w||0,Xr.state=2):X(!1,"invalid attribute spec for location "+Vn)}for(var Jn=0;Jn<jt.buffers.length;++Jn)!Vr[Jn]&&jt.buffers[Jn]&&(jt.buffers[Jn].destroy(),jt.buffers[Jn]=null);return jt.refresh(),kr}return kr.destroy=function(){for(var Pr=0;Pr<jt.buffers.length;++Pr)jt.buffers[Pr]&&jt.buffers[Pr].destroy();jt.buffers.length=0,jt.ownsElements&&(jt.elements.destroy(),jt.elements=null,jt.ownsElements=!1),jt.destroy()},kr._vao=jt,kr._reglType="vao",kr(Wt)}return hr}var et=35632,ct=35633,Pt=35718,At=35721;function Ot(j,_e,De,bt){var Xt={},xt={};function Bt(lt,Rt,lr,Br){this.name=lt,this.id=Rt,this.location=lr,this.info=Br}function Kt(lt,Rt){for(var lr=0;lr<lt.length;++lr)if(lt[lr].id===Rt.id){lt[lr].location=Rt.location;return}lt.push(Rt)}function ur(lt,Rt,lr){var Br=lt===et?Xt:xt,Zt=Br[Rt];if(!Zt){var br=_e.str(Rt);Zt=j.createShader(lt),j.shaderSource(Zt,br),j.compileShader(Zt),X.shaderError(j,Zt,br,lt,lr),Br[Rt]=Zt}return Zt}var dr={},pr=[],rr=0;function hr(lt,Rt){this.id=rr++,this.fragId=lt,this.vertId=Rt,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,bt.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function ar(lt,Rt,lr){var Br,Zt,br=ur(et,lt.fragId),Lr=ur(ct,lt.vertId),sn=lt.program=j.createProgram();if(j.attachShader(sn,br),j.attachShader(sn,Lr),lr)for(Br=0;Br<lr.length;++Br){var Wt=lr[Br];j.bindAttribLocation(sn,Wt[0],Wt[1])}j.linkProgram(sn),X.linkError(j,sn,_e.str(lt.fragId),_e.str(lt.vertId),Rt);var jt=j.getProgramParameter(sn,Pt);bt.profile&&(lt.stats.uniformsCount=jt);var kr=lt.uniforms;for(Br=0;Br<jt;++Br)if(Zt=j.getActiveUniform(sn,Br),Zt)if(Zt.size>1)for(var Pr=0;Pr<Zt.size;++Pr){var fr=Zt.name.replace("[0]","["+Pr+"]");Kt(kr,new Bt(fr,_e.id(fr),j.getUniformLocation(sn,fr),Zt))}else Kt(kr,new Bt(Zt.name,_e.id(Zt.name),j.getUniformLocation(sn,Zt.name),Zt));var zr=j.getProgramParameter(sn,At);bt.profile&&(lt.stats.attributesCount=zr);var Vr=lt.attributes;for(Br=0;Br<zr;++Br)Zt=j.getActiveAttrib(sn,Br),Zt&&Kt(Vr,new Bt(Zt.name,_e.id(Zt.name),j.getAttribLocation(sn,Zt.name),Zt))}bt.profile&&(De.getMaxUniformsCount=function(){var lt=0;return pr.forEach(function(Rt){Rt.stats.uniformsCount>lt&&(lt=Rt.stats.uniformsCount)}),lt},De.getMaxAttributesCount=function(){var lt=0;return pr.forEach(function(Rt){Rt.stats.attributesCount>lt&&(lt=Rt.stats.attributesCount)}),lt});function vr(){Xt={},xt={};for(var lt=0;lt<pr.length;++lt)ar(pr[lt],null,pr[lt].attributes.map(function(Rt){return[Rt.location,Rt.name]}))}return{clear:function(){var lt=j.deleteShader.bind(j);Xe(Xt).forEach(lt),Xt={},Xe(xt).forEach(lt),xt={},pr.forEach(function(Rt){j.deleteProgram(Rt.program)}),pr.length=0,dr={},De.shaderCount=0},program:function(lt,Rt,lr,Br){X.command(lt>=0,"missing vertex shader",lr),X.command(Rt>=0,"missing fragment shader",lr);var Zt=dr[Rt];Zt||(Zt=dr[Rt]={});var br=Zt[lt];if(br&&(br.refCount++,!Br))return br;var Lr=new hr(Rt,lt);return De.shaderCount++,ar(Lr,lr,Br),br||(Zt[lt]=Lr),pr.push(Lr),i(Lr,{destroy:function(){if(Lr.refCount--,Lr.refCount<=0){j.deleteProgram(Lr.program);var sn=pr.indexOf(Lr);pr.splice(sn,1),De.shaderCount--}Zt[Lr.vertId].refCount<=0&&(j.deleteShader(xt[Lr.vertId]),delete xt[Lr.vertId],delete dr[Lr.fragId][Lr.vertId]),Object.keys(dr[Lr.fragId]).length||(j.deleteShader(Xt[Lr.fragId]),delete Xt[Lr.fragId],delete dr[Lr.fragId])}})},restore:vr,shader:ur,frag:-1,vert:-1}}var tr=6408,sr=5121,_r=3333,Ur=5126;function hn(j,_e,De,bt,Xt,xt,Bt){function Kt(pr){var rr;_e.next===null?(X(Xt.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),rr=sr):(X(_e.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),rr=_e.next.colorAttachments[0].texture._texture.type,X.optional(function(){xt.oes_texture_float?(X(rr===sr||rr===Ur,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),rr===Ur&&X(Bt.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):X(rr===sr,"Reading from a framebuffer is only allowed for the type 'uint8'")}));var hr=0,ar=0,vr=bt.framebufferWidth,lt=bt.framebufferHeight,Rt=null;n(pr)?Rt=pr:pr&&(X.type(pr,"object","invalid arguments to regl.read()"),hr=pr.x|0,ar=pr.y|0,X(hr>=0&&hr<bt.framebufferWidth,"invalid x offset for regl.read"),X(ar>=0&&ar<bt.framebufferHeight,"invalid y offset for regl.read"),vr=(pr.width||bt.framebufferWidth-hr)|0,lt=(pr.height||bt.framebufferHeight-ar)|0,Rt=pr.data||null),Rt&&(rr===sr?X(Rt instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):rr===Ur&&X(Rt instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),X(vr>0&&vr+hr<=bt.framebufferWidth,"invalid width for read pixels"),X(lt>0&&lt+ar<=bt.framebufferHeight,"invalid height for read pixels"),De();var lr=vr*lt*4;return Rt||(rr===sr?Rt=new Uint8Array(lr):rr===Ur&&(Rt=Rt||new Float32Array(lr))),X.isTypedArray(Rt,"data buffer for regl.read() must be a typedarray"),X(Rt.byteLength>=lr,"data buffer for regl.read() too small"),j.pixelStorei(_r,4),j.readPixels(hr,ar,vr,lt,tr,rr,Rt),Rt}function ur(pr){var rr;return _e.setFBO({framebuffer:pr.framebuffer},function(){rr=Kt(pr)}),rr}function dr(pr){return!pr||!("framebuffer"in pr)?Kt(pr):ur(pr)}return dr}function An(j){return Array.prototype.slice.call(j)}function bn(j){return An(j).join("")}function Fi(){var j=0,_e=[],De=[];function bt(rr){for(var hr=0;hr<De.length;++hr)if(De[hr]===rr)return _e[hr];var ar="g"+j++;return _e.push(ar),De.push(rr),ar}function Xt(){var rr=[];function hr(){rr.push.apply(rr,An(arguments))}var ar=[];function vr(){var lt="v"+j++;return ar.push(lt),arguments.length>0&&(rr.push(lt,"="),rr.push.apply(rr,An(arguments)),rr.push(";")),lt}return i(hr,{def:vr,toString:function(){return bn([ar.length>0?"var "+ar.join(",")+";":"",bn(rr)])}})}function xt(){var rr=Xt(),hr=Xt(),ar=rr.toString,vr=hr.toString;function lt(Rt,lr){hr(Rt,lr,"=",rr.def(Rt,lr),";")}return i(function(){rr.apply(rr,An(arguments))},{def:rr.def,entry:rr,exit:hr,save:lt,set:function(Rt,lr,Br){lt(Rt,lr),rr(Rt,lr,"=",Br,";")},toString:function(){return ar()+vr()}})}function Bt(){var rr=bn(arguments),hr=xt(),ar=xt(),vr=hr.toString,lt=ar.toString;return i(hr,{then:function(){return hr.apply(hr,An(arguments)),this},else:function(){return ar.apply(ar,An(arguments)),this},toString:function(){var Rt=lt();return Rt&&(Rt="else{"+Rt+"}"),bn(["if(",rr,"){",vr(),"}",Rt])}})}var Kt=Xt(),ur={};function dr(rr,hr){var ar=[];function vr(){var Zt="a"+ar.length;return ar.push(Zt),Zt}hr=hr||0;for(var lt=0;lt<hr;++lt)vr();var Rt=xt(),lr=Rt.toString,Br=ur[rr]=i(Rt,{arg:vr,toString:function(){return bn(["function(",ar.join(),"){",lr(),"}"])}});return Br}function pr(){var rr=['"use strict";',Kt,"return {"];Object.keys(ur).forEach(function(lt){rr.push('"',lt,'":',ur[lt].toString(),",")}),rr.push("}");var hr=bn(rr).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),ar=typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,vr=ar?r.Function.apply(null,_e.concat(hr)):Function.apply(null,_e.concat(hr));return vr.apply(null,De)}return{global:Kt,link:bt,block:Xt,proc:dr,scope:xt,cond:Bt,compile:pr}}var $r="xyzw".split(""),Ln=5121,Yn=1,$n=2,Fn=0,ri=1,zn=2,pn=3,Ja=4,Ha=5,Va=6,wo="dither",Ia="blend.enable",Ea="blend.color",ms="blend.equation",da="blend.func",rl="depth.enable",ks="depth.func",Iu="depth.range",mu="depth.mask",Xl="colorMask",tf="cull.enable",gu="cull.face",Yl="frontFace",rf="lineWidth",nl="polygonOffset.enable",il="polygonOffset.offset",al="sample.alpha",Ro="sample.enable",yu="sample.coverage",Tl="stencil.enable",Ac="stencil.mask",$i="stencil.func",Bs="stencil.opFront",zo="stencil.opBack",Cl="scissor.enable",up="scissor.box",tu="viewport",Mf="profile",Ru="framebuffer",nf="vert",_u="frag",Ml="elements",Tc="primitive",Lu="count",gs="offset",rd="instances",lp="vao",nd="Width",Wd="Height",Pf=Ru+nd,cp=Ru+Wd,id=tu+nd,Xi=tu+Wd,ad="drawingBuffer",Vv=ad+nd,ol=ad+Wd,fp=[da,ms,$i,Bs,zo,yu,tu,up,il],hp=34962,jv=34963,Pl=35632,Ig=35633,od=3553,$v=34067,Xm=2884,Xd=3042,sl=3024,ul=2960,Gv=2929,Eo=3089,Th=32823,Hv=32926,pp=32928,Ch=5126,Cc=35664,Mh=35665,Il=35666,Ph=5124,ll=35667,Ih=35668,sd=35669,af=35670,Yd=35671,dp=35672,qd=35673,If=35674,Rf=35675,xu=35676,vp=35678,mp=35680,ru=4,ku=1028,Lf=1029,Rh=2304,gp=2305,yp=32775,Wv=32776,Xv=519,kf=7680,Yv=0,Rl=1,_p=32774,qv=513,Lh=36160,Ll=36064,cl={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Zv=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],of={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Ou={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},xp={frag:Pl,vert:Ig},Kv={cw:Rh,ccw:gp};function ud(j){return Array.isArray(j)||n(j)||be(j)}function ld(j){return j.sort(function(_e,De){return _e===tu?-1:De===tu?1:_e<De?-1:1})}function Yo(j,_e,De,bt){this.thisDep=j,this.contextDep=_e,this.propDep=De,this.append=bt}function ql(j){return j&&!(j.thisDep||j.contextDep||j.propDep)}function qi(j){return new Yo(!1,!1,!1,j)}function bu(j,_e){var De=j.type;if(De===Fn){var bt=j.data.length;return new Yo(!0,bt>=1,bt>=2,_e)}else if(De===Ja){var Xt=j.data;return new Yo(Xt.thisDep,Xt.contextDep,Xt.propDep,_e)}else{if(De===Ha)return new Yo(!1,!1,!1,_e);if(De===Va){for(var xt=!1,Bt=!1,Kt=!1,ur=0;ur<j.data.length;++ur){var dr=j.data[ur];if(dr.type===ri)Kt=!0;else if(dr.type===zn)Bt=!0;else if(dr.type===pn)xt=!0;else if(dr.type===Fn){xt=!0;var pr=dr.data;pr>=1&&(Bt=!0),pr>=2&&(Kt=!0)}else dr.type===Ja&&(xt=xt||dr.data.thisDep,Bt=Bt||dr.data.contextDep,Kt=Kt||dr.data.propDep)}return new Yo(xt,Bt,Kt,_e)}else return new Yo(De===pn,De===zn,De===ri,_e)}}var Zl=new Yo(!1,!1,!1,function(){});function Qv(j,_e,De,bt,Xt,xt,Bt,Kt,ur,dr,pr,rr,hr,ar,vr){var lt=dr.Record,Rt={add:32774,subtract:32778,"reverse subtract":32779};De.ext_blend_minmax&&(Rt.min=yp,Rt.max=Wv);var lr=De.angle_instanced_arrays,Br=De.webgl_draw_buffers,Zt=De.oes_vertex_array_object,br={dirty:!0,profile:vr.profile},Lr={},sn=[],Wt={},jt={};function kr(Ae){return Ae.replace(".","_")}function Pr(Ae,fe,Ue){var ut=kr(Ae);sn.push(Ae),Lr[ut]=br[ut]=!!Ue,Wt[ut]=fe}function fr(Ae,fe,Ue){var ut=kr(Ae);sn.push(Ae),Array.isArray(Ue)?(br[ut]=Ue.slice(),Lr[ut]=Ue.slice()):br[ut]=Lr[ut]=Ue,jt[ut]=fe}Pr(wo,sl),Pr(Ia,Xd),fr(Ea,"blendColor",[0,0,0,0]),fr(ms,"blendEquationSeparate",[_p,_p]),fr(da,"blendFuncSeparate",[Rl,Yv,Rl,Yv]),Pr(rl,Gv,!0),fr(ks,"depthFunc",qv),fr(Iu,"depthRange",[0,1]),fr(mu,"depthMask",!0),fr(Xl,Xl,[!0,!0,!0,!0]),Pr(tf,Xm),fr(gu,"cullFace",Lf),fr(Yl,Yl,gp),fr(rf,rf,1),Pr(nl,Th),fr(il,"polygonOffset",[0,0]),Pr(al,Hv),Pr(Ro,pp),fr(yu,"sampleCoverage",[1,!1]),Pr(Tl,ul),fr(Ac,"stencilMask",-1),fr($i,"stencilFunc",[Xv,0,-1]),fr(Bs,"stencilOpSeparate",[ku,kf,kf,kf]),fr(zo,"stencilOpSeparate",[Lf,kf,kf,kf]),Pr(Cl,Eo),fr(up,"scissor",[0,0,j.drawingBufferWidth,j.drawingBufferHeight]),fr(tu,tu,[0,0,j.drawingBufferWidth,j.drawingBufferHeight]);var zr={gl:j,context:hr,strings:_e,next:Lr,current:br,draw:rr,elements:xt,buffer:Xt,shader:pr,attributes:dr.state,vao:dr,uniforms:ur,framebuffer:Kt,extensions:De,timer:ar,isBufferArgs:ud},Vr={primTypes:Ms,compareFuncs:of,blendFuncs:cl,blendEquations:Rt,stencilOps:Ou,glTypes:Ys,orientationType:Kv};X.optional(function(){zr.isArrayLike=wa}),Br&&(Vr.backBuffer=[Lf],Vr.drawBuffer=ge(bt.maxDrawbuffers,function(Ae){return Ae===0?[0]:ge(Ae,function(fe){return Ll+fe})}));var Gn=0;function Vn(){var Ae=Fi(),fe=Ae.link,Ue=Ae.global;Ae.id=Gn++,Ae.batchId="0";var ut=fe(zr),Et=Ae.shared={props:"a0"};Object.keys(zr).forEach(function(je){Et[je]=Ue.def(ut,".",je)}),X.optional(function(){Ae.CHECK=fe(X),Ae.commandStr=X.guessCommand(),Ae.command=fe(Ae.commandStr),Ae.assert=function(je,Te,at){je("if(!(",Te,"))",this.CHECK,".commandRaise(",fe(at),",",this.command,");")},Vr.invalidBlendCombinations=Zv});var Je=Ae.next={},We=Ae.current={};Object.keys(jt).forEach(function(je){Array.isArray(br[je])&&(Je[je]=Ue.def(Et.next,".",je),We[je]=Ue.def(Et.current,".",je))});var tt=Ae.constants={};Object.keys(Vr).forEach(function(je){tt[je]=Ue.def(JSON.stringify(Vr[je]))}),Ae.invoke=function(je,Te){switch(Te.type){case Fn:var at=["this",Et.context,Et.props,Ae.batchId];return je.def(fe(Te.data),".call(",at.slice(0,Math.max(Te.data.length+1,4)),")");case ri:return je.def(Et.props,Te.data);case zn:return je.def(Et.context,Te.data);case pn:return je.def("this",Te.data);case Ja:return Te.data.append(Ae,je),Te.data.ref;case Ha:return Te.data.toString();case Va:return Te.data.map(function(dt){return Ae.invoke(je,dt)})}},Ae.attribCache={};var he={};return Ae.scopeAttrib=function(je){var Te=_e.id(je);if(Te in he)return he[Te];var at=dr.scope[Te];at||(at=dr.scope[Te]=new lt);var dt=he[Te]=fe(at);return dt},Ae}function Gr(Ae){var fe=Ae.static,Ue=Ae.dynamic,ut;if(Mf in fe){var Et=!!fe[Mf];ut=qi(function(We,tt){return Et}),ut.enable=Et}else if(Mf in Ue){var Je=Ue[Mf];ut=bu(Je,function(We,tt){return We.invoke(tt,Je)})}return ut}function Xr(Ae,fe){var Ue=Ae.static,ut=Ae.dynamic;if(Ru in Ue){var Et=Ue[Ru];return Et?(Et=Kt.getFramebuffer(Et),X.command(Et,"invalid framebuffer object"),qi(function(We,tt){var he=We.link(Et),je=We.shared;tt.set(je.framebuffer,".next",he);var Te=je.context;return tt.set(Te,"."+Pf,he+".width"),tt.set(Te,"."+cp,he+".height"),he})):qi(function(We,tt){var he=We.shared;tt.set(he.framebuffer,".next","null");var je=he.context;return tt.set(je,"."+Pf,je+"."+Vv),tt.set(je,"."+cp,je+"."+ol),"null"})}else if(Ru in ut){var Je=ut[Ru];return bu(Je,function(We,tt){var he=We.invoke(tt,Je),je=We.shared,Te=je.framebuffer,at=tt.def(Te,".getFramebuffer(",he,")");X.optional(function(){We.assert(tt,"!"+he+"||"+at,"invalid framebuffer object")}),tt.set(Te,".next",at);var dt=je.context;return tt.set(dt,"."+Pf,at+"?"+at+".width:"+dt+"."+Vv),tt.set(dt,"."+cp,at+"?"+at+".height:"+dt+"."+ol),at})}else return null}function Pn(Ae,fe,Ue){var ut=Ae.static,Et=Ae.dynamic;function Je(he){if(he in ut){var je=ut[he];X.commandType(je,"object","invalid "+he,Ue.commandStr);var Te=!0,at=je.x|0,dt=je.y|0,Qt,Tr;return"width"in je?(Qt=je.width|0,X.command(Qt>=0,"invalid "+he,Ue.commandStr)):Te=!1,"height"in je?(Tr=je.height|0,X.command(Tr>=0,"invalid "+he,Ue.commandStr)):Te=!1,new Yo(!Te&&fe&&fe.thisDep,!Te&&fe&&fe.contextDep,!Te&&fe&&fe.propDep,function(wr,dn){var Qr=wr.shared.context,un=Qt;"width"in je||(un=dn.def(Qr,".",Pf,"-",at));var ln=Tr;return"height"in je||(ln=dn.def(Qr,".",cp,"-",dt)),[at,dt,un,ln]})}else if(he in Et){var Cr=Et[he],Hr=bu(Cr,function(wr,dn){var Qr=wr.invoke(dn,Cr);X.optional(function(){wr.assert(dn,Qr+"&&typeof "+Qr+'==="object"',"invalid "+he)});var un=wr.shared.context,ln=dn.def(Qr,".x|0"),fn=dn.def(Qr,".y|0"),Un=dn.def('"width" in ',Qr,"?",Qr,".width|0:","(",un,".",Pf,"-",ln,")"),aa=dn.def('"height" in ',Qr,"?",Qr,".height|0:","(",un,".",cp,"-",fn,")");return X.optional(function(){wr.assert(dn,Un+">=0&&"+aa+">=0","invalid "+he)}),[ln,fn,Un,aa]});return fe&&(Hr.thisDep=Hr.thisDep||fe.thisDep,Hr.contextDep=Hr.contextDep||fe.contextDep,Hr.propDep=Hr.propDep||fe.propDep),Hr}else return fe?new Yo(fe.thisDep,fe.contextDep,fe.propDep,function(wr,dn){var Qr=wr.shared.context;return[0,0,dn.def(Qr,".",Pf),dn.def(Qr,".",cp)]}):null}var We=Je(tu);if(We){var tt=We;We=new Yo(We.thisDep,We.contextDep,We.propDep,function(he,je){var Te=tt.append(he,je),at=he.shared.context;return je.set(at,"."+id,Te[2]),je.set(at,"."+Xi,Te[3]),Te})}return{viewport:We,scissor_box:Je(up)}}function Wn(Ae,fe){var Ue=Ae.static,ut=typeof Ue[_u]=="string"&&typeof Ue[nf]=="string";if(ut){if(Object.keys(fe.dynamic).length>0)return null;var Et=fe.static,Je=Object.keys(Et);if(Je.length>0&&typeof Et[Je[0]]=="number"){for(var We=[],tt=0;tt<Je.length;++tt)X(typeof Et[Je[tt]]=="number","must specify all vertex attribute locations when using vaos"),We.push([Et[Je[tt]]|0,Je[tt]]);return We}}return null}function Jn(Ae,fe,Ue){var ut=Ae.static,Et=Ae.dynamic;function Je(Te){if(Te in ut){var at=_e.id(ut[Te]);X.optional(function(){pr.shader(xp[Te],at,X.guessCommand())});var dt=qi(function(){return at});return dt.id=at,dt}else if(Te in Et){var Qt=Et[Te];return bu(Qt,function(Tr,Cr){var Hr=Tr.invoke(Cr,Qt),wr=Cr.def(Tr.shared.strings,".id(",Hr,")");return X.optional(function(){Cr(Tr.shared.shader,".shader(",xp[Te],",",wr,",",Tr.command,");")}),wr})}return null}var We=Je(_u),tt=Je(nf),he=null,je;return ql(We)&&ql(tt)?(he=pr.program(tt.id,We.id,null,Ue),je=qi(function(Te,at){return Te.link(he)})):je=new Yo(We&&We.thisDep||tt&&tt.thisDep,We&&We.contextDep||tt&&tt.contextDep,We&&We.propDep||tt&&tt.propDep,function(Te,at){var dt=Te.shared.shader,Qt;We?Qt=We.append(Te,at):Qt=at.def(dt,".",_u);var Tr;tt?Tr=tt.append(Te,at):Tr=at.def(dt,".",nf);var Cr=dt+".program("+Tr+","+Qt;return X.optional(function(){Cr+=","+Te.command}),at.def(Cr+")")}),{frag:We,vert:tt,progVar:je,program:he}}function _a(Ae,fe){var Ue=Ae.static,ut=Ae.dynamic,Et={},Je=!1;function We(){if(lp in Ue){var dn=Ue[lp];return dn!==null&&dr.getVAO(dn)===null&&(dn=dr.createVAO(dn)),Je=!0,Et.vao=dn,qi(function(un){var ln=dr.getVAO(dn);return ln?un.link(ln):"null"})}else if(lp in ut){Je=!0;var Qr=ut[lp];return bu(Qr,function(un,ln){var fn=un.invoke(ln,Qr);return ln.def(un.shared.vao+".getVAO("+fn+")")})}return null}var tt=We(),he=!1;function je(){if(Ml in Ue){var dn=Ue[Ml];if(Et.elements=dn,ud(dn)){var Qr=Et.elements=xt.create(dn,!0);dn=xt.getElements(Qr),he=!0}else dn&&(dn=xt.getElements(dn),he=!0,X.command(dn,"invalid elements",fe.commandStr));var un=qi(function(fn,Un){if(dn){var aa=fn.link(dn);return fn.ELEMENTS=aa,aa}return fn.ELEMENTS=null,null});return un.value=dn,un}else if(Ml in ut){he=!0;var ln=ut[Ml];return bu(ln,function(fn,Un){var aa=fn.shared,qo=aa.isBufferArgs,Fu=aa.elements,Pc=fn.invoke(Un,ln),Ra=Un.def("null"),Pi=Un.def(qo,"(",Pc,")"),Kl=fn.cond(Pi).then(Ra,"=",Fu,".createStream(",Pc,");").else(Ra,"=",Fu,".getElements(",Pc,");");return X.optional(function(){fn.assert(Kl.else,"!"+Pc+"||"+Ra,"invalid elements")}),Un.entry(Kl),Un.exit(fn.cond(Pi).then(Fu,".destroyStream(",Ra,");")),fn.ELEMENTS=Ra,Ra})}else if(Je)return new Yo(tt.thisDep,tt.contextDep,tt.propDep,function(fn,Un){return Un.def(fn.shared.vao+".currentVAO?"+fn.shared.elements+".getElements("+fn.shared.vao+".currentVAO.elements):null")});return null}var Te=je();function at(){if(Tc in Ue){var dn=Ue[Tc];return Et.primitive=dn,X.commandParameter(dn,Ms,"invalid primitve",fe.commandStr),qi(function(un,ln){return Ms[dn]})}else if(Tc in ut){var Qr=ut[Tc];return bu(Qr,function(un,ln){var fn=un.constants.primTypes,Un=un.invoke(ln,Qr);return X.optional(function(){un.assert(ln,Un+" in "+fn,"invalid primitive, must be one of "+Object.keys(Ms))}),ln.def(fn,"[",Un,"]")})}else{if(he)return ql(Te)?Te.value?qi(function(un,ln){return ln.def(un.ELEMENTS,".primType")}):qi(function(){return ru}):new Yo(Te.thisDep,Te.contextDep,Te.propDep,function(un,ln){var fn=un.ELEMENTS;return ln.def(fn,"?",fn,".primType:",ru)});if(Je)return new Yo(tt.thisDep,tt.contextDep,tt.propDep,function(un,ln){return ln.def(un.shared.vao+".currentVAO?"+un.shared.vao+".currentVAO.primitive:"+ru)})}return null}function dt(dn,Qr){if(dn in Ue){var un=Ue[dn]|0;return Qr?Et.offset=un:Et.instances=un,X.command(!Qr||un>=0,"invalid "+dn,fe.commandStr),qi(function(fn,Un){return Qr&&(fn.OFFSET=un),un})}else if(dn in ut){var ln=ut[dn];return bu(ln,function(fn,Un){var aa=fn.invoke(Un,ln);return Qr&&(fn.OFFSET=aa,X.optional(function(){fn.assert(Un,aa+">=0","invalid "+dn)})),aa})}else if(Qr){if(he)return qi(function(fn,Un){return fn.OFFSET=0,0});if(Je)return new Yo(tt.thisDep,tt.contextDep,tt.propDep,function(fn,Un){return Un.def(fn.shared.vao+".currentVAO?"+fn.shared.vao+".currentVAO.offset:0")})}else if(Je)return new Yo(tt.thisDep,tt.contextDep,tt.propDep,function(fn,Un){return Un.def(fn.shared.vao+".currentVAO?"+fn.shared.vao+".currentVAO.instances:-1")});return null}var Qt=dt(gs,!0);function Tr(){if(Lu in Ue){var dn=Ue[Lu]|0;return Et.count=dn,X.command(typeof dn=="number"&&dn>=0,"invalid vertex count",fe.commandStr),qi(function(){return dn})}else if(Lu in ut){var Qr=ut[Lu];return bu(Qr,function(Un,aa){var qo=Un.invoke(aa,Qr);return X.optional(function(){Un.assert(aa,"typeof "+qo+'==="number"&&'+qo+">=0&&"+qo+"===("+qo+"|0)","invalid vertex count")}),qo})}else if(he)if(ql(Te)){if(Te)return Qt?new Yo(Qt.thisDep,Qt.contextDep,Qt.propDep,function(Un,aa){var qo=aa.def(Un.ELEMENTS,".vertCount-",Un.OFFSET);return X.optional(function(){Un.assert(aa,qo+">=0","invalid vertex offset/element buffer too small")}),qo}):qi(function(Un,aa){return aa.def(Un.ELEMENTS,".vertCount")});var un=qi(function(){return-1});return X.optional(function(){un.MISSING=!0}),un}else{var ln=new Yo(Te.thisDep||Qt.thisDep,Te.contextDep||Qt.contextDep,Te.propDep||Qt.propDep,function(Un,aa){var qo=Un.ELEMENTS;return Un.OFFSET?aa.def(qo,"?",qo,".vertCount-",Un.OFFSET,":-1"):aa.def(qo,"?",qo,".vertCount:-1")});return X.optional(function(){ln.DYNAMIC=!0}),ln}else if(Je){var fn=new Yo(tt.thisDep,tt.contextDep,tt.propDep,function(Un,aa){return aa.def(Un.shared.vao,".currentVAO?",Un.shared.vao,".currentVAO.count:-1")});return fn}return null}var Cr=at(),Hr=Tr(),wr=dt(rd,!1);return{elements:Te,primitive:Cr,count:Hr,instances:wr,offset:Qt,vao:tt,vaoActive:Je,elementsActive:he,static:Et}}function po(Ae,fe){var Ue=Ae.static,ut=Ae.dynamic,Et={};return sn.forEach(function(Je){var We=kr(Je);function tt(he,je){if(Je in Ue){var Te=he(Ue[Je]);Et[We]=qi(function(){return Te})}else if(Je in ut){var at=ut[Je];Et[We]=bu(at,function(dt,Qt){return je(dt,Qt,dt.invoke(Qt,at))})}}switch(Je){case tf:case Ia:case wo:case Tl:case rl:case Cl:case nl:case al:case Ro:case mu:return tt(function(he){return X.commandType(he,"boolean",Je,fe.commandStr),he},function(he,je,Te){return X.optional(function(){he.assert(je,"typeof "+Te+'==="boolean"',"invalid flag "+Je,he.commandStr)}),Te});case ks:return tt(function(he){return X.commandParameter(he,of,"invalid "+Je,fe.commandStr),of[he]},function(he,je,Te){var at=he.constants.compareFuncs;return X.optional(function(){he.assert(je,Te+" in "+at,"invalid "+Je+", must be one of "+Object.keys(of))}),je.def(at,"[",Te,"]")});case Iu:return tt(function(he){return X.command(wa(he)&&he.length===2&&typeof he[0]=="number"&&typeof he[1]=="number"&&he[0]<=he[1],"depth range is 2d array",fe.commandStr),he},function(he,je,Te){X.optional(function(){he.assert(je,he.shared.isArrayLike+"("+Te+")&&"+Te+".length===2&&typeof "+Te+'[0]==="number"&&typeof '+Te+'[1]==="number"&&'+Te+"[0]<="+Te+"[1]","depth range must be a 2d array")});var at=je.def("+",Te,"[0]"),dt=je.def("+",Te,"[1]");return[at,dt]});case da:return tt(function(he){X.commandType(he,"object","blend.func",fe.commandStr);var je="srcRGB"in he?he.srcRGB:he.src,Te="srcAlpha"in he?he.srcAlpha:he.src,at="dstRGB"in he?he.dstRGB:he.dst,dt="dstAlpha"in he?he.dstAlpha:he.dst;return X.commandParameter(je,cl,We+".srcRGB",fe.commandStr),X.commandParameter(Te,cl,We+".srcAlpha",fe.commandStr),X.commandParameter(at,cl,We+".dstRGB",fe.commandStr),X.commandParameter(dt,cl,We+".dstAlpha",fe.commandStr),X.command(Zv.indexOf(je+", "+at)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+je+", "+at+")",fe.commandStr),[cl[je],cl[at],cl[Te],cl[dt]]},function(he,je,Te){var at=he.constants.blendFuncs;X.optional(function(){he.assert(je,Te+"&&typeof "+Te+'==="object"',"invalid blend func, must be an object")});function dt(Qr,un){var ln=je.def('"',Qr,un,'" in ',Te,"?",Te,".",Qr,un,":",Te,".",Qr);return X.optional(function(){he.assert(je,ln+" in "+at,"invalid "+Je+"."+Qr+un+", must be one of "+Object.keys(cl))}),ln}var Qt=dt("src","RGB"),Tr=dt("dst","RGB");X.optional(function(){var Qr=he.constants.invalidBlendCombinations;he.assert(je,Qr+".indexOf("+Qt+'+", "+'+Tr+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var Cr=je.def(at,"[",Qt,"]"),Hr=je.def(at,"[",dt("src","Alpha"),"]"),wr=je.def(at,"[",Tr,"]"),dn=je.def(at,"[",dt("dst","Alpha"),"]");return[Cr,wr,Hr,dn]});case ms:return tt(function(he){if(typeof he=="string")return X.commandParameter(he,Rt,"invalid "+Je,fe.commandStr),[Rt[he],Rt[he]];if(typeof he=="object")return X.commandParameter(he.rgb,Rt,Je+".rgb",fe.commandStr),X.commandParameter(he.alpha,Rt,Je+".alpha",fe.commandStr),[Rt[he.rgb],Rt[he.alpha]];X.commandRaise("invalid blend.equation",fe.commandStr)},function(he,je,Te){var at=he.constants.blendEquations,dt=je.def(),Qt=je.def(),Tr=he.cond("typeof ",Te,'==="string"');return X.optional(function(){function Cr(Hr,wr,dn){he.assert(Hr,dn+" in "+at,"invalid "+wr+", must be one of "+Object.keys(Rt))}Cr(Tr.then,Je,Te),he.assert(Tr.else,Te+"&&typeof "+Te+'==="object"',"invalid "+Je),Cr(Tr.else,Je+".rgb",Te+".rgb"),Cr(Tr.else,Je+".alpha",Te+".alpha")}),Tr.then(dt,"=",Qt,"=",at,"[",Te,"];"),Tr.else(dt,"=",at,"[",Te,".rgb];",Qt,"=",at,"[",Te,".alpha];"),je(Tr),[dt,Qt]});case Ea:return tt(function(he){return X.command(wa(he)&&he.length===4,"blend.color must be a 4d array",fe.commandStr),ge(4,function(je){return+he[je]})},function(he,je,Te){return X.optional(function(){he.assert(je,he.shared.isArrayLike+"("+Te+")&&"+Te+".length===4","blend.color must be a 4d array")}),ge(4,function(at){return je.def("+",Te,"[",at,"]")})});case Ac:return tt(function(he){return X.commandType(he,"number",We,fe.commandStr),he|0},function(he,je,Te){return X.optional(function(){he.assert(je,"typeof "+Te+'==="number"',"invalid stencil.mask")}),je.def(Te,"|0")});case $i:return tt(function(he){X.commandType(he,"object",We,fe.commandStr);var je=he.cmp||"keep",Te=he.ref||0,at="mask"in he?he.mask:-1;return X.commandParameter(je,of,Je+".cmp",fe.commandStr),X.commandType(Te,"number",Je+".ref",fe.commandStr),X.commandType(at,"number",Je+".mask",fe.commandStr),[of[je],Te,at]},function(he,je,Te){var at=he.constants.compareFuncs;X.optional(function(){function Cr(){he.assert(je,Array.prototype.join.call(arguments,""),"invalid stencil.func")}Cr(Te+"&&typeof ",Te,'==="object"'),Cr('!("cmp" in ',Te,")||(",Te,".cmp in ",at,")")});var dt=je.def('"cmp" in ',Te,"?",at,"[",Te,".cmp]",":",kf),Qt=je.def(Te,".ref|0"),Tr=je.def('"mask" in ',Te,"?",Te,".mask|0:-1");return[dt,Qt,Tr]});case Bs:case zo:return tt(function(he){X.commandType(he,"object",We,fe.commandStr);var je=he.fail||"keep",Te=he.zfail||"keep",at=he.zpass||"keep";return X.commandParameter(je,Ou,Je+".fail",fe.commandStr),X.commandParameter(Te,Ou,Je+".zfail",fe.commandStr),X.commandParameter(at,Ou,Je+".zpass",fe.commandStr),[Je===zo?Lf:ku,Ou[je],Ou[Te],Ou[at]]},function(he,je,Te){var at=he.constants.stencilOps;X.optional(function(){he.assert(je,Te+"&&typeof "+Te+'==="object"',"invalid "+Je)});function dt(Qt){return X.optional(function(){he.assert(je,'!("'+Qt+'" in '+Te+")||("+Te+"."+Qt+" in "+at+")","invalid "+Je+"."+Qt+", must be one of "+Object.keys(Ou))}),je.def('"',Qt,'" in ',Te,"?",at,"[",Te,".",Qt,"]:",kf)}return[Je===zo?Lf:ku,dt("fail"),dt("zfail"),dt("zpass")]});case il:return tt(function(he){X.commandType(he,"object",We,fe.commandStr);var je=he.factor|0,Te=he.units|0;return X.commandType(je,"number",We+".factor",fe.commandStr),X.commandType(Te,"number",We+".units",fe.commandStr),[je,Te]},function(he,je,Te){X.optional(function(){he.assert(je,Te+"&&typeof "+Te+'==="object"',"invalid "+Je)});var at=je.def(Te,".factor|0"),dt=je.def(Te,".units|0");return[at,dt]});case gu:return tt(function(he){var je=0;return he==="front"?je=ku:he==="back"&&(je=Lf),X.command(!!je,We,fe.commandStr),je},function(he,je,Te){return X.optional(function(){he.assert(je,Te+'==="front"||'+Te+'==="back"',"invalid cull.face")}),je.def(Te,'==="front"?',ku,":",Lf)});case rf:return tt(function(he){return X.command(typeof he=="number"&&he>=bt.lineWidthDims[0]&&he<=bt.lineWidthDims[1],"invalid line width, must be a positive number between "+bt.lineWidthDims[0]+" and "+bt.lineWidthDims[1],fe.commandStr),he},function(he,je,Te){return X.optional(function(){he.assert(je,"typeof "+Te+'==="number"&&'+Te+">="+bt.lineWidthDims[0]+"&&"+Te+"<="+bt.lineWidthDims[1],"invalid line width")}),Te});case Yl:return tt(function(he){return X.commandParameter(he,Kv,We,fe.commandStr),Kv[he]},function(he,je,Te){return X.optional(function(){he.assert(je,Te+'==="cw"||'+Te+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),je.def(Te+'==="cw"?'+Rh+":"+gp)});case Xl:return tt(function(he){return X.command(wa(he)&&he.length===4,"color.mask must be length 4 array",fe.commandStr),he.map(function(je){return!!je})},function(he,je,Te){return X.optional(function(){he.assert(je,he.shared.isArrayLike+"("+Te+")&&"+Te+".length===4","invalid color.mask")}),ge(4,function(at){return"!!"+Te+"["+at+"]"})});case yu:return tt(function(he){X.command(typeof he=="object"&&he,We,fe.commandStr);var je="value"in he?he.value:1,Te=!!he.invert;return X.command(typeof je=="number"&&je>=0&&je<=1,"sample.coverage.value must be a number between 0 and 1",fe.commandStr),[je,Te]},function(he,je,Te){X.optional(function(){he.assert(je,Te+"&&typeof "+Te+'==="object"',"invalid sample.coverage")});var at=je.def('"value" in ',Te,"?+",Te,".value:1"),dt=je.def("!!",Te,".invert");return[at,dt]})}}),Et}function gi(Ae,fe){var Ue=Ae.static,ut=Ae.dynamic,Et={};return Object.keys(Ue).forEach(function(Je){var We=Ue[Je],tt;if(typeof We=="number"||typeof We=="boolean")tt=qi(function(){return We});else if(typeof We=="function"){var he=We._reglType;he==="texture2d"||he==="textureCube"?tt=qi(function(je){return je.link(We)}):he==="framebuffer"||he==="framebufferCube"?(X.command(We.color.length>0,'missing color attachment for framebuffer sent to uniform "'+Je+'"',fe.commandStr),tt=qi(function(je){return je.link(We.color[0])})):X.commandRaise('invalid data for uniform "'+Je+'"',fe.commandStr)}else wa(We)?tt=qi(function(je){var Te=je.global.def("[",ge(We.length,function(at){return X.command(typeof We[at]=="number"||typeof We[at]=="boolean","invalid uniform "+Je,je.commandStr),We[at]}),"]");return Te}):X.commandRaise('invalid or missing data for uniform "'+Je+'"',fe.commandStr);tt.value=We,Et[Je]=tt}),Object.keys(ut).forEach(function(Je){var We=ut[Je];Et[Je]=bu(We,function(tt,he){return tt.invoke(he,We)})}),Et}function ss(Ae,fe){var Ue=Ae.static,ut=Ae.dynamic,Et={};return Object.keys(Ue).forEach(function(Je){var We=Ue[Je],tt=_e.id(Je),he=new lt;if(ud(We))he.state=Yn,he.buffer=Xt.getBuffer(Xt.create(We,hp,!1,!0)),he.type=0;else{var je=Xt.getBuffer(We);if(je)he.state=Yn,he.buffer=je,he.type=0;else if(X.command(typeof We=="object"&&We,"invalid data for attribute "+Je,fe.commandStr),"constant"in We){var Te=We.constant;he.buffer="null",he.state=$n,typeof Te=="number"?he.x=Te:(X.command(wa(Te)&&Te.length>0&&Te.length<=4,"invalid constant for attribute "+Je,fe.commandStr),$r.forEach(function(wr,dn){dn<Te.length&&(he[wr]=Te[dn])}))}else{ud(We.buffer)?je=Xt.getBuffer(Xt.create(We.buffer,hp,!1,!0)):je=Xt.getBuffer(We.buffer),X.command(!!je,'missing buffer for attribute "'+Je+'"',fe.commandStr);var at=We.offset|0;X.command(at>=0,'invalid offset for attribute "'+Je+'"',fe.commandStr);var dt=We.stride|0;X.command(dt>=0&&dt<256,'invalid stride for attribute "'+Je+'", must be integer betweeen [0, 255]',fe.commandStr);var Qt=We.size|0;X.command(!("size"in We)||Qt>0&&Qt<=4,'invalid size for attribute "'+Je+'", must be 1,2,3,4',fe.commandStr);var Tr=!!We.normalized,Cr=0;"type"in We&&(X.commandParameter(We.type,Ys,"invalid type for attribute "+Je,fe.commandStr),Cr=Ys[We.type]);var Hr=We.divisor|0;X.optional(function(){"divisor"in We&&(X.command(Hr===0||lr,'cannot specify divisor for attribute "'+Je+'", instancing not supported',fe.commandStr),X.command(Hr>=0,'invalid divisor for attribute "'+Je+'"',fe.commandStr));var wr=fe.commandStr,dn=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(We).forEach(function(Qr){X.command(dn.indexOf(Qr)>=0,'unknown parameter "'+Qr+'" for attribute pointer "'+Je+'" (valid parameters are '+dn+")",wr)})}),he.buffer=je,he.state=Yn,he.size=Qt,he.normalized=Tr,he.type=Cr||je.dtype,he.offset=at,he.stride=dt,he.divisor=Hr}}Et[Je]=qi(function(wr,dn){var Qr=wr.attribCache;if(tt in Qr)return Qr[tt];var un={isStream:!1};return Object.keys(he).forEach(function(ln){un[ln]=he[ln]}),he.buffer&&(un.buffer=wr.link(he.buffer),un.type=un.type||un.buffer+".dtype"),Qr[tt]=un,un})}),Object.keys(ut).forEach(function(Je){var We=ut[Je];function tt(he,je){var Te=he.invoke(je,We),at=he.shared,dt=he.constants,Qt=at.isBufferArgs,Tr=at.buffer;X.optional(function(){he.assert(je,Te+"&&(typeof "+Te+'==="object"||typeof '+Te+'==="function")&&('+Qt+"("+Te+")||"+Tr+".getBuffer("+Te+")||"+Tr+".getBuffer("+Te+".buffer)||"+Qt+"("+Te+'.buffer)||("constant" in '+Te+"&&(typeof "+Te+'.constant==="number"||'+at.isArrayLike+"("+Te+".constant))))",'invalid dynamic attribute "'+Je+'"')});var Cr={isStream:je.def(!1)},Hr=new lt;Hr.state=Yn,Object.keys(Hr).forEach(function(un){Cr[un]=je.def(""+Hr[un])});var wr=Cr.buffer,dn=Cr.type;je("if(",Qt,"(",Te,")){",Cr.isStream,"=true;",wr,"=",Tr,".createStream(",hp,",",Te,");",dn,"=",wr,".dtype;","}else{",wr,"=",Tr,".getBuffer(",Te,");","if(",wr,"){",dn,"=",wr,".dtype;",'}else if("constant" in ',Te,"){",Cr.state,"=",$n,";","if(typeof "+Te+'.constant === "number"){',Cr[$r[0]],"=",Te,".constant;",$r.slice(1).map(function(un){return Cr[un]}).join("="),"=0;","}else{",$r.map(function(un,ln){return Cr[un]+"="+Te+".constant.length>"+ln+"?"+Te+".constant["+ln+"]:0;"}).join(""),"}}else{","if(",Qt,"(",Te,".buffer)){",wr,"=",Tr,".createStream(",hp,",",Te,".buffer);","}else{",wr,"=",Tr,".getBuffer(",Te,".buffer);","}",dn,'="type" in ',Te,"?",dt.glTypes,"[",Te,".type]:",wr,".dtype;",Cr.normalized,"=!!",Te,".normalized;");function Qr(un){je(Cr[un],"=",Te,".",un,"|0;")}return Qr("size"),Qr("offset"),Qr("stride"),Qr("divisor"),je("}}"),je.exit("if(",Cr.isStream,"){",Tr,".destroyStream(",wr,");","}"),Cr}Et[Je]=bu(We,tt)}),Et}function Ba(Ae){var fe=Ae.static,Ue=Ae.dynamic,ut={};return Object.keys(fe).forEach(function(Et){var Je=fe[Et];ut[Et]=qi(function(We,tt){return typeof Je=="number"||typeof Je=="boolean"?""+Je:We.link(Je)})}),Object.keys(Ue).forEach(function(Et){var Je=Ue[Et];ut[Et]=bu(Je,function(We,tt){return We.invoke(tt,Je)})}),ut}function Uo(Ae,fe,Ue,ut,Et){var Je=Ae.static,We=Ae.dynamic;X.optional(function(){var Qr=[Ru,nf,_u,Ml,Tc,gs,Lu,rd,Mf,lp].concat(sn);function un(ln){Object.keys(ln).forEach(function(fn){X.command(Qr.indexOf(fn)>=0,'unknown parameter "'+fn+'"',Et.commandStr)})}un(Je),un(We)});var tt=Wn(Ae,fe),he=Xr(Ae),je=Pn(Ae,he,Et),Te=_a(Ae,Et),at=po(Ae,Et),dt=Jn(Ae,Et,tt);function Qt(Qr){var un=je[Qr];un&&(at[Qr]=un)}Qt(tu),Qt(kr(up));var Tr=Object.keys(at).length>0,Cr={framebuffer:he,draw:Te,shader:dt,state:at,dirty:Tr,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(Cr.profile=Gr(Ae),Cr.uniforms=gi(Ue,Et),Cr.drawVAO=Cr.scopeVAO=Te.vao,!Cr.drawVAO&&dt.program&&!tt&&De.angle_instanced_arrays&&Te.static.elements){var Hr=!0,wr=dt.program.attributes.map(function(Qr){var un=fe.static[Qr];return Hr=Hr&&!!un,un});if(Hr&&wr.length>0){var dn=dr.getVAO(dr.createVAO({attributes:wr,elements:Te.static.elements}));Cr.drawVAO=new Yo(null,null,null,function(Qr,un){return Qr.link(dn)}),Cr.useVAO=!0}}return tt?Cr.useVAO=!0:Cr.attributes=ss(fe,Et),Cr.context=Ba(ut),Cr}function Lo(Ae,fe,Ue){var ut=Ae.shared,Et=ut.context,Je=Ae.scope();Object.keys(Ue).forEach(function(We){fe.save(Et,"."+We);var tt=Ue[We],he=tt.append(Ae,fe);Array.isArray(he)?Je(Et,".",We,"=[",he.join(),"];"):Je(Et,".",We,"=",he,";")}),fe(Je)}function us(Ae,fe,Ue,ut){var Et=Ae.shared,Je=Et.gl,We=Et.framebuffer,tt;Br&&(tt=fe.def(Et.extensions,".webgl_draw_buffers"));var he=Ae.constants,je=he.drawBuffer,Te=he.backBuffer,at;Ue?at=Ue.append(Ae,fe):at=fe.def(We,".next"),ut||fe("if(",at,"!==",We,".cur){"),fe("if(",at,"){",Je,".bindFramebuffer(",Lh,",",at,".framebuffer);"),Br&&fe(tt,".drawBuffersWEBGL(",je,"[",at,".colorAttachments.length]);"),fe("}else{",Je,".bindFramebuffer(",Lh,",null);"),Br&&fe(tt,".drawBuffersWEBGL(",Te,");"),fe("}",We,".cur=",at,";"),ut||fe("}")}function ls(Ae,fe,Ue){var ut=Ae.shared,Et=ut.gl,Je=Ae.current,We=Ae.next,tt=ut.current,he=ut.next,je=Ae.cond(tt,".dirty");sn.forEach(function(Te){var at=kr(Te);if(!(at in Ue.state)){var dt,Qt;if(at in We){dt=We[at],Qt=Je[at];var Tr=ge(br[at].length,function(Hr){return je.def(dt,"[",Hr,"]")});je(Ae.cond(Tr.map(function(Hr,wr){return Hr+"!=="+Qt+"["+wr+"]"}).join("||")).then(Et,".",jt[at],"(",Tr,");",Tr.map(function(Hr,wr){return Qt+"["+wr+"]="+Hr}).join(";"),";"))}else{dt=je.def(he,".",at);var Cr=Ae.cond(dt,"!==",tt,".",at);je(Cr),at in Wt?Cr(Ae.cond(dt).then(Et,".enable(",Wt[at],");").else(Et,".disable(",Wt[at],");"),tt,".",at,"=",dt,";"):Cr(Et,".",jt[at],"(",dt,");",tt,".",at,"=",dt,";")}}}),Object.keys(Ue.state).length===0&&je(tt,".dirty=false;"),fe(je)}function ys(Ae,fe,Ue,ut){var Et=Ae.shared,Je=Ae.current,We=Et.current,tt=Et.gl;ld(Object.keys(Ue)).forEach(function(he){var je=Ue[he];if(!(ut&&!ut(je))){var Te=je.append(Ae,fe);if(Wt[he]){var at=Wt[he];ql(je)?Te?fe(tt,".enable(",at,");"):fe(tt,".disable(",at,");"):fe(Ae.cond(Te).then(tt,".enable(",at,");").else(tt,".disable(",at,");")),fe(We,".",he,"=",Te,";")}else if(wa(Te)){var dt=Je[he];fe(tt,".",jt[he],"(",Te,");",Te.map(function(Qt,Tr){return dt+"["+Tr+"]="+Qt}).join(";"),";")}else fe(tt,".",jt[he],"(",Te,");",We,".",he,"=",Te,";")}})}function so(Ae,fe){lr&&(Ae.instancing=fe.def(Ae.shared.extensions,".angle_instanced_arrays"))}function ui(Ae,fe,Ue,ut,Et){var Je=Ae.shared,We=Ae.stats,tt=Je.current,he=Je.timer,je=Ue.profile;function Te(){var Qr=typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return Qr||typeof performance>"u"?"Date.now()":"performance.now()"}var at,dt;function Qt(Qr){at=fe.def(),Qr(at,"=",Te(),";"),typeof Et=="string"?Qr(We,".count+=",Et,";"):Qr(We,".count++;"),ar&&(ut?(dt=fe.def(),Qr(dt,"=",he,".getNumPendingQueries();")):Qr(he,".beginQuery(",We,");"))}function Tr(Qr){Qr(We,".cpuTime+=",Te(),"-",at,";"),ar&&(ut?Qr(he,".pushScopeStats(",dt,",",he,".getNumPendingQueries(),",We,");"):Qr(he,".endQuery();"))}function Cr(Qr){var un=fe.def(tt,".profile");fe(tt,".profile=",Qr,";"),fe.exit(tt,".profile=",un,";")}var Hr;if(je){if(ql(je)){je.enable?(Qt(fe),Tr(fe.exit),Cr("true")):Cr("false");return}Hr=je.append(Ae,fe),Cr(Hr)}else Hr=fe.def(tt,".profile");var wr=Ae.block();Qt(wr),fe("if(",Hr,"){",wr,"}");var dn=Ae.block();Tr(dn),fe.exit("if(",Hr,"){",dn,"}")}function Vo(Ae,fe,Ue,ut,Et){var Je=Ae.shared;function We(he){switch(he){case Cc:case ll:case Yd:return 2;case Mh:case Ih:case dp:return 3;case Il:case sd:case qd:return 4;default:return 1}}function tt(he,je,Te){var at=Je.gl,dt=fe.def(he,".location"),Qt=fe.def(Je.attributes,"[",dt,"]"),Tr=Te.state,Cr=Te.buffer,Hr=[Te.x,Te.y,Te.z,Te.w],wr=["buffer","normalized","offset","stride"];function dn(){fe("if(!",Qt,".buffer){",at,".enableVertexAttribArray(",dt,");}");var un=Te.type,ln;if(Te.size?ln=fe.def(Te.size,"||",je):ln=je,fe("if(",Qt,".type!==",un,"||",Qt,".size!==",ln,"||",wr.map(function(Un){return Qt+"."+Un+"!=="+Te[Un]}).join("||"),"){",at,".bindBuffer(",hp,",",Cr,".buffer);",at,".vertexAttribPointer(",[dt,ln,un,Te.normalized,Te.stride,Te.offset],");",Qt,".type=",un,";",Qt,".size=",ln,";",wr.map(function(Un){return Qt+"."+Un+"="+Te[Un]+";"}).join(""),"}"),lr){var fn=Te.divisor;fe("if(",Qt,".divisor!==",fn,"){",Ae.instancing,".vertexAttribDivisorANGLE(",[dt,fn],");",Qt,".divisor=",fn,";}")}}function Qr(){fe("if(",Qt,".buffer){",at,".disableVertexAttribArray(",dt,");",Qt,".buffer=null;","}if(",$r.map(function(un,ln){return Qt+"."+un+"!=="+Hr[ln]}).join("||"),"){",at,".vertexAttrib4f(",dt,",",Hr,");",$r.map(function(un,ln){return Qt+"."+un+"="+Hr[ln]+";"}).join(""),"}")}Tr===Yn?dn():Tr===$n?Qr():(fe("if(",Tr,"===",Yn,"){"),dn(),fe("}else{"),Qr(),fe("}"))}ut.forEach(function(he){var je=he.name,Te=Ue.attributes[je],at;if(Te){if(!Et(Te))return;at=Te.append(Ae,fe)}else{if(!Et(Zl))return;var dt=Ae.scopeAttrib(je);X.optional(function(){Ae.assert(fe,dt+".state","missing attribute "+je)}),at={},Object.keys(new lt).forEach(function(Qt){at[Qt]=fe.def(dt,".",Qt)})}tt(Ae.link(he),We(he.info.type),at)})}function Zi(Ae,fe,Ue,ut,Et,Je){for(var We=Ae.shared,tt=We.gl,he,je=0;je<ut.length;++je){var Te=ut[je],at=Te.name,dt=Te.info.type,Qt=Ue.uniforms[at],Tr=Ae.link(Te),Cr=Tr+".location",Hr;if(Qt){if(!Et(Qt))continue;if(ql(Qt)){var wr=Qt.value;if(X.command(wr!==null&&typeof wr<"u",'missing uniform "'+at+'"',Ae.commandStr),dt===vp||dt===mp){X.command(typeof wr=="function"&&(dt===vp&&(wr._reglType==="texture2d"||wr._reglType==="framebuffer")||dt===mp&&(wr._reglType==="textureCube"||wr._reglType==="framebufferCube")),"invalid texture for uniform "+at,Ae.commandStr);var dn=Ae.link(wr._texture||wr.color[0]._texture);fe(tt,".uniform1i(",Cr,",",dn+".bind());"),fe.exit(dn,".unbind();")}else if(dt===If||dt===Rf||dt===xu){X.optional(function(){X.command(wa(wr),"invalid matrix for uniform "+at,Ae.commandStr),X.command(dt===If&&wr.length===4||dt===Rf&&wr.length===9||dt===xu&&wr.length===16,"invalid length for matrix uniform "+at,Ae.commandStr)});var Qr=Ae.global.def("new Float32Array(["+Array.prototype.slice.call(wr)+"])"),un=2;dt===Rf?un=3:dt===xu&&(un=4),fe(tt,".uniformMatrix",un,"fv(",Cr,",false,",Qr,");")}else{switch(dt){case Ch:X.commandType(wr,"number","uniform "+at,Ae.commandStr),he="1f";break;case Cc:X.command(wa(wr)&&wr.length===2,"uniform "+at,Ae.commandStr),he="2f";break;case Mh:X.command(wa(wr)&&wr.length===3,"uniform "+at,Ae.commandStr),he="3f";break;case Il:X.command(wa(wr)&&wr.length===4,"uniform "+at,Ae.commandStr),he="4f";break;case af:X.commandType(wr,"boolean","uniform "+at,Ae.commandStr),he="1i";break;case Ph:X.commandType(wr,"number","uniform "+at,Ae.commandStr),he="1i";break;case Yd:X.command(wa(wr)&&wr.length===2,"uniform "+at,Ae.commandStr),he="2i";break;case ll:X.command(wa(wr)&&wr.length===2,"uniform "+at,Ae.commandStr),he="2i";break;case dp:X.command(wa(wr)&&wr.length===3,"uniform "+at,Ae.commandStr),he="3i";break;case Ih:X.command(wa(wr)&&wr.length===3,"uniform "+at,Ae.commandStr),he="3i";break;case qd:X.command(wa(wr)&&wr.length===4,"uniform "+at,Ae.commandStr),he="4i";break;case sd:X.command(wa(wr)&&wr.length===4,"uniform "+at,Ae.commandStr),he="4i";break}fe(tt,".uniform",he,"(",Cr,",",wa(wr)?Array.prototype.slice.call(wr):wr,");")}continue}else Hr=Qt.append(Ae,fe)}else{if(!Et(Zl))continue;Hr=fe.def(We.uniforms,"[",_e.id(at),"]")}dt===vp?(X(!Array.isArray(Hr),"must specify a scalar prop for textures"),fe("if(",Hr,"&&",Hr,'._reglType==="framebuffer"){',Hr,"=",Hr,".color[0];","}")):dt===mp&&(X(!Array.isArray(Hr),"must specify a scalar prop for cube maps"),fe("if(",Hr,"&&",Hr,'._reglType==="framebufferCube"){',Hr,"=",Hr,".color[0];","}")),X.optional(function(){function Pi(hl,tm){Ae.assert(fe,hl,'bad data or missing for uniform "'+at+'".  '+tm)}function Kl(hl){X(!Array.isArray(Hr),"must not specify an array type for uniform"),Pi("typeof "+Hr+'==="'+hl+'"',"invalid type, expected "+hl)}function fl(hl,tm){Array.isArray(Hr)?X(Hr.length===hl,"must have length "+hl):Pi(We.isArrayLike+"("+Hr+")&&"+Hr+".length==="+hl,"invalid vector, should have length "+hl,Ae.commandStr)}function cd(hl){X(!Array.isArray(Hr),"must not specify a value type"),Pi("typeof "+Hr+'==="function"&&'+Hr+'._reglType==="texture'+(hl===od?"2d":"Cube")+'"',"invalid texture type",Ae.commandStr)}switch(dt){case Ph:Kl("number");break;case ll:fl(2);break;case Ih:fl(3);break;case sd:fl(4);break;case Ch:Kl("number");break;case Cc:fl(2);break;case Mh:fl(3);break;case Il:fl(4);break;case af:Kl("boolean");break;case Yd:fl(2);break;case dp:fl(3);break;case qd:fl(4);break;case If:fl(4);break;case Rf:fl(9);break;case xu:fl(16);break;case vp:cd(od);break;case mp:cd($v);break}});var ln=1;switch(dt){case vp:case mp:var fn=fe.def(Hr,"._texture");fe(tt,".uniform1i(",Cr,",",fn,".bind());"),fe.exit(fn,".unbind();");continue;case Ph:case af:he="1i";break;case ll:case Yd:he="2i",ln=2;break;case Ih:case dp:he="3i",ln=3;break;case sd:case qd:he="4i",ln=4;break;case Ch:he="1f";break;case Cc:he="2f",ln=2;break;case Mh:he="3f",ln=3;break;case Il:he="4f",ln=4;break;case If:he="Matrix2fv";break;case Rf:he="Matrix3fv";break;case xu:he="Matrix4fv";break}if(he.charAt(0)==="M"){fe(tt,".uniform",he,"(",Cr,",");var Un=Math.pow(dt-If+2,2),aa=Ae.global.def("new Float32Array(",Un,")");Array.isArray(Hr)?fe("false,(",ge(Un,function(Pi){return aa+"["+Pi+"]="+Hr[Pi]}),",",aa,")"):fe("false,(Array.isArray(",Hr,")||",Hr," instanceof Float32Array)?",Hr,":(",ge(Un,function(Pi){return aa+"["+Pi+"]="+Hr+"["+Pi+"]"}),",",aa,")"),fe(");")}else if(ln>1){for(var qo=[],Fu=[],Pc=0;Pc<ln;++Pc)Array.isArray(Hr)?Fu.push(Hr[Pc]):Fu.push(fe.def(Hr+"["+Pc+"]")),Je&&qo.push(fe.def());Je&&fe("if(!",Ae.batchId,"||",qo.map(function(Pi,Kl){return Pi+"!=="+Fu[Kl]}).join("||"),"){",qo.map(function(Pi,Kl){return Pi+"="+Fu[Kl]+";"}).join("")),fe(tt,".uniform",he,"(",Cr,",",Fu.join(","),");"),Je&&fe("}")}else{if(X(!Array.isArray(Hr),"uniform value must not be an array"),Je){var Ra=fe.def();fe("if(!",Ae.batchId,"||",Ra,"!==",Hr,"){",Ra,"=",Hr,";")}fe(tt,".uniform",he,"(",Cr,",",Hr,");"),Je&&fe("}")}}}function So(Ae,fe,Ue,ut){var Et=Ae.shared,Je=Et.gl,We=Et.draw,tt=ut.draw;function he(){var ln=tt.elements,fn,Un=fe;return ln?((ln.contextDep&&ut.contextDynamic||ln.propDep)&&(Un=Ue),fn=ln.append(Ae,Un),tt.elementsActive&&Un("if("+fn+")"+Je+".bindBuffer("+jv+","+fn+".buffer.buffer);")):(fn=Un.def(),Un(fn,"=",We,".",Ml,";","if(",fn,"){",Je,".bindBuffer(",jv,",",fn,".buffer.buffer);}","else if(",Et.vao,".currentVAO){",fn,"=",Ae.shared.elements+".getElements("+Et.vao,".currentVAO.elements);",Zt?"":"if("+fn+")"+Je+".bindBuffer("+jv+","+fn+".buffer.buffer);","}")),fn}function je(){var ln=tt.count,fn,Un=fe;return ln?((ln.contextDep&&ut.contextDynamic||ln.propDep)&&(Un=Ue),fn=ln.append(Ae,Un),X.optional(function(){ln.MISSING&&Ae.assert(fe,"false","missing vertex count"),ln.DYNAMIC&&Ae.assert(Un,fn+">=0","missing vertex count")})):(fn=Un.def(We,".",Lu),X.optional(function(){Ae.assert(Un,fn+">=0","missing vertex count")})),fn}var Te=he();function at(ln){var fn=tt[ln];return fn?fn.contextDep&&ut.contextDynamic||fn.propDep?fn.append(Ae,Ue):fn.append(Ae,fe):fe.def(We,".",ln)}var dt=at(Tc),Qt=at(gs),Tr=je();if(typeof Tr=="number"){if(Tr===0)return}else Ue("if(",Tr,"){"),Ue.exit("}");var Cr,Hr;lr&&(Cr=at(rd),Hr=Ae.instancing);var wr=Te+".type",dn=tt.elements&&ql(tt.elements)&&!tt.vaoActive;function Qr(){function ln(){Ue(Hr,".drawElementsInstancedANGLE(",[dt,Tr,wr,Qt+"<<(("+wr+"-"+Ln+")>>1)",Cr],");")}function fn(){Ue(Hr,".drawArraysInstancedANGLE(",[dt,Qt,Tr,Cr],");")}Te&&Te!=="null"?dn?ln():(Ue("if(",Te,"){"),ln(),Ue("}else{"),fn(),Ue("}")):fn()}function un(){function ln(){Ue(Je+".drawElements("+[dt,Tr,wr,Qt+"<<(("+wr+"-"+Ln+")>>1)"]+");")}function fn(){Ue(Je+".drawArrays("+[dt,Qt,Tr]+");")}Te&&Te!=="null"?dn?ln():(Ue("if(",Te,"){"),ln(),Ue("}else{"),fn(),Ue("}")):fn()}lr&&(typeof Cr!="number"||Cr>=0)?typeof Cr=="string"?(Ue("if(",Cr,">0){"),Qr(),Ue("}else if(",Cr,"<0){"),un(),Ue("}")):Qr():un()}function kn(Ae,fe,Ue,ut,Et){var Je=Vn(),We=Je.proc("body",Et);return X.optional(function(){Je.commandStr=fe.commandStr,Je.command=Je.link(fe.commandStr)}),lr&&(Je.instancing=We.def(Je.shared.extensions,".angle_instanced_arrays")),Ae(Je,We,Ue,ut),Je.compile().body}function yi(Ae,fe,Ue,ut){so(Ae,fe),Ue.useVAO?Ue.drawVAO?fe(Ae.shared.vao,".setVAO(",Ue.drawVAO.append(Ae,fe),");"):fe(Ae.shared.vao,".setVAO(",Ae.shared.vao,".targetVAO);"):(fe(Ae.shared.vao,".setVAO(null);"),Vo(Ae,fe,Ue,ut.attributes,function(){return!0})),Zi(Ae,fe,Ue,ut.uniforms,function(){return!0},!1),So(Ae,fe,fe,Ue)}function Sa(Ae,fe){var Ue=Ae.proc("draw",1);so(Ae,Ue),Lo(Ae,Ue,fe.context),us(Ae,Ue,fe.framebuffer),ls(Ae,Ue,fe),ys(Ae,Ue,fe.state),ui(Ae,Ue,fe,!1,!0);var ut=fe.shader.progVar.append(Ae,Ue);if(Ue(Ae.shared.gl,".useProgram(",ut,".program);"),fe.shader.program)yi(Ae,Ue,fe,fe.shader.program);else{Ue(Ae.shared.vao,".setVAO(null);");var Et=Ae.global.def("{}"),Je=Ue.def(ut,".id"),We=Ue.def(Et,"[",Je,"]");Ue(Ae.cond(We).then(We,".call(this,a0);").else(We,"=",Et,"[",Je,"]=",Ae.link(function(tt){return kn(yi,Ae,fe,tt,1)}),"(",ut,");",We,".call(this,a0);"))}Object.keys(fe.state).length>0&&Ue(Ae.shared.current,".dirty=true;"),Ae.shared.vao&&Ue(Ae.shared.vao,".setVAO(null);")}function jo(Ae,fe,Ue,ut){Ae.batchId="a1",so(Ae,fe);function Et(){return!0}Vo(Ae,fe,Ue,ut.attributes,Et),Zi(Ae,fe,Ue,ut.uniforms,Et,!1),So(Ae,fe,fe,Ue)}function Du(Ae,fe,Ue,ut){so(Ae,fe);var Et=Ue.contextDep,Je=fe.def(),We="a0",tt="a1",he=fe.def();Ae.shared.props=he,Ae.batchId=Je;var je=Ae.scope(),Te=Ae.scope();fe(je.entry,"for(",Je,"=0;",Je,"<",tt,";++",Je,"){",he,"=",We,"[",Je,"];",Te,"}",je.exit);function at(wr){return wr.contextDep&&Et||wr.propDep}function dt(wr){return!at(wr)}if(Ue.needsContext&&Lo(Ae,Te,Ue.context),Ue.needsFramebuffer&&us(Ae,Te,Ue.framebuffer),ys(Ae,Te,Ue.state,at),Ue.profile&&at(Ue.profile)&&ui(Ae,Te,Ue,!1,!0),ut)Ue.useVAO?Ue.drawVAO?at(Ue.drawVAO)?Te(Ae.shared.vao,".setVAO(",Ue.drawVAO.append(Ae,Te),");"):je(Ae.shared.vao,".setVAO(",Ue.drawVAO.append(Ae,je),");"):je(Ae.shared.vao,".setVAO(",Ae.shared.vao,".targetVAO);"):(je(Ae.shared.vao,".setVAO(null);"),Vo(Ae,je,Ue,ut.attributes,dt),Vo(Ae,Te,Ue,ut.attributes,at)),Zi(Ae,je,Ue,ut.uniforms,dt,!1),Zi(Ae,Te,Ue,ut.uniforms,at,!0),So(Ae,je,Te,Ue);else{var Qt=Ae.global.def("{}"),Tr=Ue.shader.progVar.append(Ae,Te),Cr=Te.def(Tr,".id"),Hr=Te.def(Qt,"[",Cr,"]");Te(Ae.shared.gl,".useProgram(",Tr,".program);","if(!",Hr,"){",Hr,"=",Qt,"[",Cr,"]=",Ae.link(function(wr){return kn(jo,Ae,Ue,wr,2)}),"(",Tr,");}",Hr,".call(this,a0[",Je,"],",Je,");")}}function Pe(Ae,fe){var Ue=Ae.proc("batch",2);Ae.batchId="0",so(Ae,Ue);var ut=!1,Et=!0;Object.keys(fe.context).forEach(function(Qt){ut=ut||fe.context[Qt].propDep}),ut||(Lo(Ae,Ue,fe.context),Et=!1);var Je=fe.framebuffer,We=!1;Je?(Je.propDep?ut=We=!0:Je.contextDep&&ut&&(We=!0),We||us(Ae,Ue,Je)):us(Ae,Ue,null),fe.state.viewport&&fe.state.viewport.propDep&&(ut=!0);function tt(Qt){return Qt.contextDep&&ut||Qt.propDep}ls(Ae,Ue,fe),ys(Ae,Ue,fe.state,function(Qt){return!tt(Qt)}),(!fe.profile||!tt(fe.profile))&&ui(Ae,Ue,fe,!1,"a1"),fe.contextDep=ut,fe.needsContext=Et,fe.needsFramebuffer=We;var he=fe.shader.progVar;if(he.contextDep&&ut||he.propDep)Du(Ae,Ue,fe,null);else{var je=he.append(Ae,Ue);if(Ue(Ae.shared.gl,".useProgram(",je,".program);"),fe.shader.program)Du(Ae,Ue,fe,fe.shader.program);else{Ue(Ae.shared.vao,".setVAO(null);");var Te=Ae.global.def("{}"),at=Ue.def(je,".id"),dt=Ue.def(Te,"[",at,"]");Ue(Ae.cond(dt).then(dt,".call(this,a0,a1);").else(dt,"=",Te,"[",at,"]=",Ae.link(function(Qt){return kn(Du,Ae,fe,Qt,2)}),"(",je,");",dt,".call(this,a0,a1);"))}}Object.keys(fe.state).length>0&&Ue(Ae.shared.current,".dirty=true;"),Ae.shared.vao&&Ue(Ae.shared.vao,".setVAO(null);")}function St(Ae,fe){var Ue=Ae.proc("scope",3);Ae.batchId="a2";var ut=Ae.shared,Et=ut.current;Lo(Ae,Ue,fe.context),fe.framebuffer&&fe.framebuffer.append(Ae,Ue),ld(Object.keys(fe.state)).forEach(function(We){var tt=fe.state[We],he=tt.append(Ae,Ue);wa(he)?he.forEach(function(je,Te){Ue.set(Ae.next[We],"["+Te+"]",je)}):Ue.set(ut.next,"."+We,he)}),ui(Ae,Ue,fe,!0,!0),[Ml,gs,Lu,rd,Tc].forEach(function(We){var tt=fe.draw[We];tt&&Ue.set(ut.draw,"."+We,""+tt.append(Ae,Ue))}),Object.keys(fe.uniforms).forEach(function(We){var tt=fe.uniforms[We].append(Ae,Ue);Array.isArray(tt)&&(tt="["+tt.join()+"]"),Ue.set(ut.uniforms,"["+_e.id(We)+"]",tt)}),Object.keys(fe.attributes).forEach(function(We){var tt=fe.attributes[We].append(Ae,Ue),he=Ae.scopeAttrib(We);Object.keys(new lt).forEach(function(je){Ue.set(he,"."+je,tt[je])})}),fe.scopeVAO&&Ue.set(ut.vao,".targetVAO",fe.scopeVAO.append(Ae,Ue));function Je(We){var tt=fe.shader[We];tt&&Ue.set(ut.shader,"."+We,tt.append(Ae,Ue))}Je(nf),Je(_u),Object.keys(fe.state).length>0&&(Ue(Et,".dirty=true;"),Ue.exit(Et,".dirty=true;")),Ue("a1(",Ae.shared.context,",a0,",Ae.batchId,");")}function pt(Ae){if(!(typeof Ae!="object"||wa(Ae))){for(var fe=Object.keys(Ae),Ue=0;Ue<fe.length;++Ue)if(En.isDynamic(Ae[fe[Ue]]))return!0;return!1}}function en(Ae,fe,Ue){var ut=fe.static[Ue];if(!ut||!pt(ut))return;var Et=Ae.global,Je=Object.keys(ut),We=!1,tt=!1,he=!1,je=Ae.global.def("{}");Je.forEach(function(at){var dt=ut[at];if(En.isDynamic(dt)){typeof dt=="function"&&(dt=ut[at]=En.unbox(dt));var Qt=bu(dt,null);We=We||Qt.thisDep,he=he||Qt.propDep,tt=tt||Qt.contextDep}else{switch(Et(je,".",at,"="),typeof dt){case"number":Et(dt);break;case"string":Et('"',dt,'"');break;case"object":Array.isArray(dt)&&Et("[",dt.join(),"]");break;default:Et(Ae.link(dt));break}Et(";")}});function Te(at,dt){Je.forEach(function(Qt){var Tr=ut[Qt];if(En.isDynamic(Tr)){var Cr=at.invoke(dt,Tr);dt(je,".",Qt,"=",Cr,";")}})}fe.dynamic[Ue]=new En.DynamicVariable(Ja,{thisDep:We,contextDep:tt,propDep:he,ref:je,append:Te}),delete fe.static[Ue]}function _i(Ae,fe,Ue,ut,Et){var Je=Vn();Je.stats=Je.link(Et),Object.keys(fe.static).forEach(function(tt){en(Je,fe,tt)}),fp.forEach(function(tt){en(Je,Ae,tt)});var We=Uo(Ae,fe,Ue,ut,Je);return Sa(Je,We),St(Je,We),Pe(Je,We),i(Je.compile(),{destroy:function(){We.shader.program.destroy()}})}return{next:Lr,current:br,procs:function(){var Ae=Vn(),fe=Ae.proc("poll"),Ue=Ae.proc("refresh"),ut=Ae.block();fe(ut),Ue(ut);var Et=Ae.shared,Je=Et.gl,We=Et.next,tt=Et.current;ut(tt,".dirty=false;"),us(Ae,fe),us(Ae,Ue,null,!0);var he;lr&&(he=Ae.link(lr)),De.oes_vertex_array_object&&Ue(Ae.link(De.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var je=0;je<bt.maxAttributes;++je){var Te=Ue.def(Et.attributes,"[",je,"]"),at=Ae.cond(Te,".buffer");at.then(Je,".enableVertexAttribArray(",je,");",Je,".bindBuffer(",hp,",",Te,".buffer.buffer);",Je,".vertexAttribPointer(",je,",",Te,".size,",Te,".type,",Te,".normalized,",Te,".stride,",Te,".offset);").else(Je,".disableVertexAttribArray(",je,");",Je,".vertexAttrib4f(",je,",",Te,".x,",Te,".y,",Te,".z,",Te,".w);",Te,".buffer=null;"),Ue(at),lr&&Ue(he,".vertexAttribDivisorANGLE(",je,",",Te,".divisor);")}return Ue(Ae.shared.vao,".currentVAO=null;",Ae.shared.vao,".setVAO(",Ae.shared.vao,".targetVAO);"),Object.keys(Wt).forEach(function(dt){var Qt=Wt[dt],Tr=ut.def(We,".",dt),Cr=Ae.block();Cr("if(",Tr,"){",Je,".enable(",Qt,")}else{",Je,".disable(",Qt,")}",tt,".",dt,"=",Tr,";"),Ue(Cr),fe("if(",Tr,"!==",tt,".",dt,"){",Cr,"}")}),Object.keys(jt).forEach(function(dt){var Qt=jt[dt],Tr=br[dt],Cr,Hr,wr=Ae.block();if(wr(Je,".",Qt,"("),wa(Tr)){var dn=Tr.length;Cr=Ae.global.def(We,".",dt),Hr=Ae.global.def(tt,".",dt),wr(ge(dn,function(Qr){return Cr+"["+Qr+"]"}),");",ge(dn,function(Qr){return Hr+"["+Qr+"]="+Cr+"["+Qr+"];"}).join("")),fe("if(",ge(dn,function(Qr){return Cr+"["+Qr+"]!=="+Hr+"["+Qr+"]"}).join("||"),"){",wr,"}")}else Cr=ut.def(We,".",dt),Hr=ut.def(tt,".",dt),wr(Cr,");",tt,".",dt,"=",Cr,";"),fe("if(",Cr,"!==",Hr,"){",wr,"}");Ue(wr)}),Ae.compile()}(),compile:_i}}function Ym(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var qm=34918,Zm=34919,Km=35007,Rg=function(j,_e){if(!_e.ext_disjoint_timer_query)return null;var De=[];function bt(){return De.pop()||_e.ext_disjoint_timer_query.createQueryEXT()}function Xt(lr){De.push(lr)}var xt=[];function Bt(lr){var Br=bt();_e.ext_disjoint_timer_query.beginQueryEXT(Km,Br),xt.push(Br),ar(xt.length-1,xt.length,lr)}function Kt(){_e.ext_disjoint_timer_query.endQueryEXT(Km)}function ur(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var dr=[];function pr(){return dr.pop()||new ur}function rr(lr){dr.push(lr)}var hr=[];function ar(lr,Br,Zt){var br=pr();br.startQueryIndex=lr,br.endQueryIndex=Br,br.sum=0,br.stats=Zt,hr.push(br)}var vr=[],lt=[];function Rt(){var lr,Br,Zt=xt.length;if(Zt!==0){lt.length=Math.max(lt.length,Zt+1),vr.length=Math.max(vr.length,Zt+1),vr[0]=0,lt[0]=0;var br=0;for(lr=0,Br=0;Br<xt.length;++Br){var Lr=xt[Br];_e.ext_disjoint_timer_query.getQueryObjectEXT(Lr,Zm)?(br+=_e.ext_disjoint_timer_query.getQueryObjectEXT(Lr,qm),Xt(Lr)):xt[lr++]=Lr,vr[Br+1]=br,lt[Br+1]=lr}for(xt.length=lr,lr=0,Br=0;Br<hr.length;++Br){var sn=hr[Br],Wt=sn.startQueryIndex,jt=sn.endQueryIndex;sn.sum+=vr[jt]-vr[Wt];var kr=lt[Wt],Pr=lt[jt];Pr===kr?(sn.stats.gpuTime+=sn.sum/1e6,rr(sn)):(sn.startQueryIndex=kr,sn.endQueryIndex=Pr,hr[lr++]=sn)}hr.length=lr}}return{beginQuery:Bt,endQuery:Kt,pushScopeStats:ar,update:Rt,getNumPendingQueries:function(){return xt.length},clear:function(){De.push.apply(De,xt);for(var lr=0;lr<De.length;lr++)_e.ext_disjoint_timer_query.deleteQueryEXT(De[lr]);xt.length=0,De.length=0},restore:function(){xt.length=0,De.length=0}}},Mc=16384,Jv=256,em=1024,kh=34962,bp="webglcontextlost",Of="webglcontextrestored",Qn=1,va=2,Zd=3;function nu(j,_e){for(var De=0;De<j.length;++De)if(j[De]===_e)return De;return-1}function wp(j){var _e=re(j);if(!_e)return null;var De=_e.gl,bt=De.getContextAttributes(),Xt=De.isContextLost(),xt=oe(De,_e);if(!xt)return null;var Bt=go(),Kt=Ym(),ur=xt.extensions,dr=Rg(De,ur),pr=uo(),rr=De.drawingBufferWidth,hr=De.drawingBufferHeight,ar={tick:0,time:0,viewportWidth:rr,viewportHeight:hr,framebufferWidth:rr,framebufferHeight:hr,drawingBufferWidth:rr,drawingBufferHeight:hr,pixelRatio:_e.pixelRatio},vr={},lt={elements:null,primitive:4,count:-1,offset:0,instances:-1},Rt=se(De,ur),lr=lc(De,Kt,_e,br),Br=ep(De,ur,lr,Kt),Zt=He(De,ur,Rt,Kt,lr,Br,lt);function br(kn){return Zt.destroyBuffer(kn)}var Lr=Ot(De,Bt,Kt,_e),sn=bc(De,ur,Rt,function(){kr.procs.poll()},ar,Kt,_e),Wt=bo(De,ur,Rt,Kt,_e),jt=ve(De,ur,Rt,sn,Wt,Kt),kr=Qv(De,Bt,ur,Rt,lr,Br,sn,jt,vr,Zt,Lr,lt,ar,dr,_e),Pr=hn(De,jt,kr.procs.poll,ar,bt,ur,Rt),fr=kr.next,zr=De.canvas,Vr=[],Gn=[],Vn=[],Gr=[_e.onDestroy],Xr=null;function Pn(){if(Vr.length===0){dr&&dr.update(),Xr=null;return}Xr=Ii.next(Pn),so();for(var kn=Vr.length-1;kn>=0;--kn){var yi=Vr[kn];yi&&yi(ar,null,0)}De.flush(),dr&&dr.update()}function Wn(){!Xr&&Vr.length>0&&(Xr=Ii.next(Pn))}function Jn(){Xr&&(Ii.cancel(Pn),Xr=null)}function _a(kn){kn.preventDefault(),Xt=!0,Jn(),Gn.forEach(function(yi){yi()})}function po(kn){De.getError(),Xt=!1,xt.restore(),Lr.restore(),lr.restore(),sn.restore(),Wt.restore(),jt.restore(),Zt.restore(),dr&&dr.restore(),kr.procs.refresh(),Wn(),Vn.forEach(function(yi){yi()})}var gi=typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;!gi&&zr&&(zr.addEventListener(bp,_a,!1),zr.addEventListener(Of,po,!1));function ss(){Vr.length=0,Jn(),!gi&&zr&&(zr.removeEventListener(bp,_a),zr.removeEventListener(Of,po)),Lr.clear(),jt.clear(),Wt.clear(),Zt.clear(),sn.clear(),Br.clear(),lr.clear(),dr&&dr.clear(),Gr.forEach(function(kn){kn()})}function Ba(kn){X(!!kn,"invalid args to regl({...})"),X.type(kn,"object","invalid args to regl({...})");function yi(Je){var We=i({},Je);delete We.uniforms,delete We.attributes,delete We.context,delete We.vao,"stencil"in We&&We.stencil.op&&(We.stencil.opBack=We.stencil.opFront=We.stencil.op,delete We.stencil.op);function tt(he){if(he in We){var je=We[he];delete We[he],Object.keys(je).forEach(function(Te){We[he+"."+Te]=je[Te]})}}return tt("blend"),tt("depth"),tt("cull"),tt("stencil"),tt("polygonOffset"),tt("scissor"),tt("sample"),"vao"in Je&&(We.vao=Je.vao),We}function Sa(Je,We){var tt={},he={};return Object.keys(Je).forEach(function(je){var Te=Je[je];if(En.isDynamic(Te)){he[je]=En.unbox(Te,je);return}else if(We&&Array.isArray(Te)){for(var at=0;at<Te.length;++at)if(En.isDynamic(Te[at])){he[je]=En.unbox(Te,je);return}}tt[je]=Te}),{dynamic:he,static:tt}}var jo=Sa(kn.context||{},!0),Du=Sa(kn.uniforms||{},!0),Pe=Sa(kn.attributes||{},!1),St=Sa(yi(kn),!1),pt={gpuTime:0,cpuTime:0,count:0},en=kr.compile(St,Pe,Du,jo,pt),_i=en.draw,Ae=en.batch,fe=en.scope,Ue=[];function ut(Je){for(;Ue.length<Je;)Ue.push(null);return Ue}function Et(Je,We){var tt;if(Xt&&X.raise("context lost"),typeof Je=="function")return fe.call(this,null,Je,0);if(typeof We=="function")if(typeof Je=="number")for(tt=0;tt<Je;++tt)fe.call(this,null,We,tt);else if(Array.isArray(Je))for(tt=0;tt<Je.length;++tt)fe.call(this,Je[tt],We,tt);else return fe.call(this,Je,We,0);else if(typeof Je=="number"){if(Je>0)return Ae.call(this,ut(Je|0),Je|0)}else if(Array.isArray(Je)){if(Je.length)return Ae.call(this,Je,Je.length)}else return _i.call(this,Je)}return i(Et,{stats:pt,destroy:function(){en.destroy()}})}var Uo=jt.setFBO=Ba({framebuffer:En.define.call(null,Qn,"framebuffer")});function Lo(kn,yi){var Sa=0;kr.procs.poll();var jo=yi.color;jo&&(De.clearColor(+jo[0]||0,+jo[1]||0,+jo[2]||0,+jo[3]||0),Sa|=Mc),"depth"in yi&&(De.clearDepth(+yi.depth),Sa|=Jv),"stencil"in yi&&(De.clearStencil(yi.stencil|0),Sa|=em),X(!!Sa,"called regl.clear with no buffer specified"),De.clear(Sa)}function us(kn){if(X(typeof kn=="object"&&kn,"regl.clear() takes an object as input"),"framebuffer"in kn)if(kn.framebuffer&&kn.framebuffer_reglType==="framebufferCube")for(var yi=0;yi<6;++yi)Uo(i({framebuffer:kn.framebuffer.faces[yi]},kn),Lo);else Uo(kn,Lo);else Lo(null,kn)}function ls(kn){X.type(kn,"function","regl.frame() callback must be a function"),Vr.push(kn);function yi(){var Sa=nu(Vr,kn);X(Sa>=0,"cannot cancel a frame twice");function jo(){var Du=nu(Vr,jo);Vr[Du]=Vr[Vr.length-1],Vr.length-=1,Vr.length<=0&&Jn()}Vr[Sa]=jo}return Wn(),{cancel:yi}}function ys(){var kn=fr.viewport,yi=fr.scissor_box;kn[0]=kn[1]=yi[0]=yi[1]=0,ar.viewportWidth=ar.framebufferWidth=ar.drawingBufferWidth=kn[2]=yi[2]=De.drawingBufferWidth,ar.viewportHeight=ar.framebufferHeight=ar.drawingBufferHeight=kn[3]=yi[3]=De.drawingBufferHeight}function so(){ar.tick+=1,ar.time=Vo(),ys(),kr.procs.poll()}function ui(){sn.refresh(),ys(),kr.procs.refresh(),dr&&dr.update()}function Vo(){return(uo()-pr)/1e3}ui();function Zi(kn,yi){X.type(yi,"function","listener callback must be a function");var Sa;switch(kn){case"frame":return ls(yi);case"lost":Sa=Gn;break;case"restore":Sa=Vn;break;case"destroy":Sa=Gr;break;default:X.raise("invalid event, must be one of frame,lost,restore,destroy")}return Sa.push(yi),{cancel:function(){for(var jo=0;jo<Sa.length;++jo)if(Sa[jo]===yi){Sa[jo]=Sa[Sa.length-1],Sa.pop();return}}}}var So=i(Ba,{clear:us,prop:En.define.bind(null,Qn),context:En.define.bind(null,va),this:En.define.bind(null,Zd),draw:Ba({}),buffer:function(kn){return lr.create(kn,kh,!1,!1)},elements:function(kn){return Br.create(kn,!1)},texture:sn.create2D,cube:sn.createCube,renderbuffer:Wt.create,framebuffer:jt.create,framebufferCube:jt.createCube,vao:Zt.createVAO,attributes:bt,frame:ls,on:Zi,limits:Rt,hasExtension:function(kn){return Rt.extensions.indexOf(kn.toLowerCase())>=0},read:Pr,destroy:ss,_gl:De,_refresh:ui,poll:function(){so(),dr&&dr.update()},now:Vo,stats:Kt});return _e.onDone(null,So),So}return wp})})(nk);var CQ=nk.exports;const MQ=jc(CQ);var PQ=function(){function e(t,r){$t(this,e);var n=r.buffer,i=r.offset,o=r.stride,a=r.normalized,u=r.size,c=r.divisor;this.buffer=n,this.attribute={buffer:n.get(),offset:i||0,stride:o||0,normalized:a||!1,divisor:c||0},u&&(this.attribute.size=u)}return Gt(e,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(r){this.buffer.subData(r)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),wd,uy,Ed,Gf,ly,vv,cy,p1,Cp,wm,pl,Mp,Pp,d1,IQ=(wd={},Q(wd,ae.POINTS,"points"),Q(wd,ae.LINES,"lines"),Q(wd,ae.LINE_LOOP,"line loop"),Q(wd,ae.LINE_STRIP,"line strip"),Q(wd,ae.TRIANGLES,"triangles"),Q(wd,ae.TRIANGLE_FAN,"triangle fan"),Q(wd,ae.TRIANGLE_STRIP,"triangle strip"),wd),Ok=(uy={},Q(uy,ae.STATIC_DRAW,"static"),Q(uy,ae.DYNAMIC_DRAW,"dynamic"),Q(uy,ae.STREAM_DRAW,"stream"),uy),VS=(Ed={},Q(Ed,ae.BYTE,"int8"),Q(Ed,ae.UNSIGNED_INT,"int16"),Q(Ed,ae.INT,"int32"),Q(Ed,ae.UNSIGNED_BYTE,"uint8"),Q(Ed,ae.UNSIGNED_SHORT,"uint16"),Q(Ed,ae.UNSIGNED_INT,"uint32"),Q(Ed,ae.FLOAT,"float"),Ed),RQ=(Gf={},Q(Gf,ae.ALPHA,"alpha"),Q(Gf,ae.LUMINANCE,"luminance"),Q(Gf,ae.LUMINANCE_ALPHA,"luminance alpha"),Q(Gf,ae.RGB,"rgb"),Q(Gf,ae.RGBA,"rgba"),Q(Gf,ae.RGBA4,"rgba4"),Q(Gf,ae.RGB5_A1,"rgb5 a1"),Q(Gf,ae.RGB565,"rgb565"),Q(Gf,ae.DEPTH_COMPONENT,"depth"),Q(Gf,ae.DEPTH_STENCIL,"depth stencil"),Gf),LQ=(ly={},Q(ly,ae.DONT_CARE,"dont care"),Q(ly,ae.NICEST,"nice"),Q(ly,ae.FASTEST,"fast"),ly),M4=(vv={},Q(vv,ae.NEAREST,"nearest"),Q(vv,ae.LINEAR,"linear"),Q(vv,ae.LINEAR_MIPMAP_LINEAR,"mipmap"),Q(vv,ae.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),Q(vv,ae.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),Q(vv,ae.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),vv),P4=(cy={},Q(cy,ae.REPEAT,"repeat"),Q(cy,ae.CLAMP_TO_EDGE,"clamp"),Q(cy,ae.MIRRORED_REPEAT,"mirror"),cy),kQ=(p1={},Q(p1,ae.NONE,"none"),Q(p1,ae.BROWSER_DEFAULT_WEBGL,"browser"),p1),OQ=(Cp={},Q(Cp,ae.NEVER,"never"),Q(Cp,ae.ALWAYS,"always"),Q(Cp,ae.LESS,"less"),Q(Cp,ae.LEQUAL,"lequal"),Q(Cp,ae.GREATER,"greater"),Q(Cp,ae.GEQUAL,"gequal"),Q(Cp,ae.EQUAL,"equal"),Q(Cp,ae.NOTEQUAL,"notequal"),Cp),I4=(wm={},Q(wm,ae.FUNC_ADD,"add"),Q(wm,ae.MIN_EXT,"min"),Q(wm,ae.MAX_EXT,"max"),Q(wm,ae.FUNC_SUBTRACT,"subtract"),Q(wm,ae.FUNC_REVERSE_SUBTRACT,"reverse subtract"),wm),v1=(pl={},Q(pl,ae.ZERO,"zero"),Q(pl,ae.ONE,"one"),Q(pl,ae.SRC_COLOR,"src color"),Q(pl,ae.ONE_MINUS_SRC_COLOR,"one minus src color"),Q(pl,ae.SRC_ALPHA,"src alpha"),Q(pl,ae.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),Q(pl,ae.DST_COLOR,"dst color"),Q(pl,ae.ONE_MINUS_DST_COLOR,"one minus dst color"),Q(pl,ae.DST_ALPHA,"dst alpha"),Q(pl,ae.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),Q(pl,ae.CONSTANT_COLOR,"constant color"),Q(pl,ae.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),Q(pl,ae.CONSTANT_ALPHA,"constant alpha"),Q(pl,ae.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),Q(pl,ae.SRC_ALPHA_SATURATE,"src alpha saturate"),pl),DQ=(Mp={},Q(Mp,ae.NEVER,"never"),Q(Mp,ae.ALWAYS,"always"),Q(Mp,ae.LESS,"less"),Q(Mp,ae.LEQUAL,"lequal"),Q(Mp,ae.GREATER,"greater"),Q(Mp,ae.GEQUAL,"gequal"),Q(Mp,ae.EQUAL,"equal"),Q(Mp,ae.NOTEQUAL,"notequal"),Mp),C0=(Pp={},Q(Pp,ae.ZERO,"zero"),Q(Pp,ae.KEEP,"keep"),Q(Pp,ae.REPLACE,"replace"),Q(Pp,ae.INVERT,"invert"),Q(Pp,ae.INCR,"increment"),Q(Pp,ae.DECR,"decrement"),Q(Pp,ae.INCR_WRAP,"increment wrap"),Q(Pp,ae.DECR_WRAP,"decrement wrap"),Pp),FQ=(d1={},Q(d1,ae.FRONT,"front"),Q(d1,ae.BACK,"back"),d1),NQ=function(){function e(t,r){$t(this,e);var n=r.data,i=r.usage,o=r.type;this.buffer=t.buffer({data:n,usage:Ok[i||ae.STATIC_DRAW],type:VS[o||ae.UNSIGNED_BYTE]})}return Gt(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.buffer.destroy()}},{key:"subData",value:function(r){var n=r.data,i=r.offset;this.buffer.subdata(n,i)}}]),e}(),BQ=function(){function e(t,r){$t(this,e);var n=r.data,i=r.usage,o=r.type,a=r.count;this.elements=t.elements({data:n,usage:Ok[i||ae.STATIC_DRAW],type:VS[o||ae.UNSIGNED_BYTE],count:a})}return Gt(e,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(r){var n=r.data;this.elements.subdata(n)}},{key:"destroy",value:function(){}}]),e}(),zQ=function(){function e(t,r){$t(this,e);var n=r.width,i=r.height,o=r.color,a=r.colors,u={width:n,height:i};Array.isArray(a)&&(u.colors=a.map(function(c){return c.get()})),o&&typeof o!="boolean"&&(u.color=o.get()),this.framebuffer=t.framebuffer(u)}return Gt(e,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(r){var n=r.width,i=r.height;this.framebuffer.resize(n,i)}}]),e}(),UQ=function(){function e(t,r){$t(this,e),Q(this,"destroyed",!1),Q(this,"uniforms",{}),this.reGl=t;var n=r.vs,i=r.fs,o=r.attributes,a=r.uniforms,u=r.primitive,c=r.count,h=r.elements,y=r.depth,x=r.cull,E=r.instances,T={};this.options=r,a&&(this.uniforms=this.extractUniforms(a),Object.keys(a).forEach(function(D){T[D]=t.prop(D)}));var I={};Object.keys(o).forEach(function(D){I[D]=o[D].get()});var k={attributes:I,frag:i,uniforms:T,vert:n,colorMask:t.prop("colorMask"),lineWidth:1,blend:{enable:t.prop("blend.enable"),func:t.prop("blend.func"),equation:t.prop("blend.equation"),color:t.prop("blend.color")},stencil:{enable:t.prop("stencil.enable"),mask:t.prop("stencil.mask"),func:t.prop("stencil.func"),opFront:t.prop("stencil.opFront"),opBack:t.prop("stencil.opBack")},primitive:IQ[u===void 0?ae.TRIANGLES:u]};E&&(k.instances=E),c?k.count=c:h&&(k.elements=h.get()),this.initDepthDrawParams({depth:y},k),this.initCullDrawParams({cull:x},k),this.drawCommand=t(k),this.drawParams=k}return Gt(e,[{key:"updateAttributesAndElements",value:function(r,n){var i={};Object.keys(r).forEach(function(o){i[o]=r[o].get()}),this.drawParams.attributes=i,this.drawParams.elements=n.get(),this.drawCommand=this.reGl(this.drawParams)}},{key:"updateAttributes",value:function(r){var n={};Object.keys(r).forEach(function(i){n[i]=r[i].get()}),this.drawParams.attributes=n,this.drawCommand=this.reGl(this.drawParams)}},{key:"addUniforms",value:function(r){this.uniforms=_t(_t({},this.uniforms),this.extractUniforms(r))}},{key:"draw",value:function(r,n){if(!(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)){var i=_t(_t({},this.uniforms),this.extractUniforms(r.uniforms||{})),o={};Object.keys(i).forEach(function(a){var u=qh(i[a]);u==="boolean"||u==="number"||Array.isArray(i[a])||i[a].BYTES_PER_ELEMENT?o[a]=i[a]:o[a]=i[a].get()}),o.blend=n?this.getBlendDrawParams({blend:{enable:!1}}):this.getBlendDrawParams(r),o.stencil=this.getStencilDrawParams(r),o.colorMask=this.getColorMaskDrawParams(r,n),this.drawCommand(o)}}},{key:"destroy",value:function(){var r,n;(r=this.drawParams)===null||r===void 0||(n=r.elements)===null||n===void 0||n.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(function(i){i==null||i.destroy()}),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(r,n){var i=r.depth;i&&(n.depth={enable:i.enable===void 0?!0:!!i.enable,mask:i.mask===void 0?!0:!!i.mask,func:OQ[i.func||ae.LESS],range:i.range||[0,1]})}},{key:"getBlendDrawParams",value:function(r){var n=r.blend,i=n||{},o=i.enable,a=i.func,u=i.equation,c=i.color,h=c===void 0?[0,0,0,0]:c;return{enable:!!o,func:{srcRGB:v1[a&&a.srcRGB||ae.SRC_ALPHA],srcAlpha:v1[a&&a.srcAlpha||ae.SRC_ALPHA],dstRGB:v1[a&&a.dstRGB||ae.ONE_MINUS_SRC_ALPHA],dstAlpha:v1[a&&a.dstAlpha||ae.ONE_MINUS_SRC_ALPHA]},equation:{rgb:I4[u&&u.rgb||ae.FUNC_ADD],alpha:I4[u&&u.alpha||ae.FUNC_ADD]},color:h}}},{key:"getStencilDrawParams",value:function(r){var n=r.stencil,i=n||{},o=i.enable,a=i.mask,u=a===void 0?-1:a,c=i.func,h=c===void 0?{cmp:ae.ALWAYS,ref:0,mask:-1}:c,y=i.opFront,x=y===void 0?{fail:ae.KEEP,zfail:ae.KEEP,zpass:ae.KEEP}:y,E=i.opBack,T=E===void 0?{fail:ae.KEEP,zfail:ae.KEEP,zpass:ae.KEEP}:E;return{enable:!!o,mask:u,func:_t(_t({},h),{},{cmp:DQ[h.cmp]}),opFront:{fail:C0[x.fail],zfail:C0[x.zfail],zpass:C0[x.zpass]},opBack:{fail:C0[T.fail],zfail:C0[T.zfail],zpass:C0[T.zpass]}}}},{key:"getColorMaskDrawParams",value:function(r,n){var i=r.stencil,o=i!=null&&i.enable&&i.opFront&&!n?[!1,!1,!1,!1]:[!0,!0,!0,!0];return o}},{key:"initCullDrawParams",value:function(r,n){var i=r.cull;if(i){var o=i.enable,a=i.face,u=a===void 0?ae.BACK:a;n.cull={enable:!!o,face:FQ[u]}}}},{key:"extractUniforms",value:function(r){var n=this,i={};return Object.keys(r).forEach(function(o){n.extractUniformsRecursively(o,r[o],i,"")}),i}},{key:"extractUniformsRecursively",value:function(r,n,i,o){var a=this;if(n===null||typeof n=="number"||typeof n=="boolean"||Array.isArray(n)&&typeof n[0]=="number"||Er.isTypedArray(n)||n===""||"resize"in n){i["".concat(o&&o+".").concat(r)]=n;return}Er.isPlainObject(n)&&Object.keys(n).forEach(function(u){a.extractUniformsRecursively(u,n[u],i,"".concat(o&&o+".").concat(r))}),Array.isArray(n)&&n.forEach(function(u,c){Object.keys(u).forEach(function(h){a.extractUniformsRecursively(h,u[h],i,"".concat(o&&o+".").concat(r,"[").concat(c,"]"))})})}}]),e}(),VQ=function(){function e(t,r){$t(this,e),Q(this,"isDestroy",!1);var n=r.data,i=r.type,o=i===void 0?ae.UNSIGNED_BYTE:i,a=r.width,u=r.height,c=r.flipY,h=c===void 0?!1:c,y=r.format,x=y===void 0?ae.RGBA:y,E=r.mipmap,T=E===void 0?!1:E,I=r.wrapS,k=I===void 0?ae.CLAMP_TO_EDGE:I,D=r.wrapT,V=D===void 0?ae.CLAMP_TO_EDGE:D,O=r.aniso,F=O===void 0?0:O,N=r.alignment,H=N===void 0?1:N,q=r.premultiplyAlpha,Y=q===void 0?!1:q,ee=r.mag,pe=ee===void 0?ae.NEAREST:ee,ue=r.min,ie=ue===void 0?ae.NEAREST:ue,xe=r.colorSpace,Se=xe===void 0?ae.BROWSER_DEFAULT_WEBGL:xe,Ne=r.x,ze=Ne===void 0?0:Ne,Be=r.y,$e=Be===void 0?0:Be,it=r.copy,mt=it===void 0?!1:it;this.width=a,this.height=u;var Qe={width:a,height:u,type:VS[o],format:RQ[x],wrapS:P4[k],wrapT:P4[V],mag:M4[pe],min:M4[ie],alignment:H,flipY:h,colorSpace:kQ[Se],premultiplyAlpha:Y,aniso:F,x:ze,y:$e,copy:mt};n&&(Qe.data=n),typeof T=="number"?Qe.mipmap=LQ[T]:typeof T=="boolean"&&(Qe.mipmap=T),this.texture=t.texture(Qe)}return Gt(e,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.texture(r)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(r){var n=r.width,i=r.height;this.texture.resize(n,i),this.width=n,this.height=i}},{key:"getSize",value:function(){return[this.width,this.height]}},{key:"destroy",value:function(){if(!this.isDestroy){var r;(r=this.texture)===null||r===void 0||r.destroy()}this.isDestroy=!0}}]),e}(),R4,L4,jQ=(R4=Ei(),R4(L4=function(){function e(){var t=this;$t(this,e),Q(this,"createModel",function(r){return new UQ(t.gl,r)}),Q(this,"createAttribute",function(r){return new PQ(t.gl,r)}),Q(this,"createBuffer",function(r){return new NQ(t.gl,r)}),Q(this,"createElements",function(r){return new BQ(t.gl,r)}),Q(this,"createTexture2D",function(r){return new VQ(t.gl,r)}),Q(this,"createFramebuffer",function(r){return new zQ(t.gl,r)}),Q(this,"useFramebuffer",function(r,n){t.gl({framebuffer:r?r.get():null})(n)}),Q(this,"clear",function(r){var n,i=r.color,o=r.depth,a=r.stencil,u=r.framebuffer,c=u===void 0?null:u,h={color:i,depth:o,stencil:a};h.framebuffer=c===null?c:c.get(),(n=t.gl)===null||n===void 0||n.clear(h)}),Q(this,"viewport",function(r){var n=r.x,i=r.y,o=r.width,a=r.height;t.gl._gl.viewport(n,i,o,a),t.width=o,t.height=a,t.gl._refresh()}),Q(this,"readPixels",function(r){var n=r.framebuffer,i=r.x,o=r.y,a=r.width,u=r.height,c={x:i,y:o,width:a,height:u};return n&&(c.framebuffer=n.get()),t.gl.read(c)}),Q(this,"getViewportSize",function(){return{width:t.gl._gl.drawingBufferWidth,height:t.gl._gl.drawingBufferHeight}}),Q(this,"getContainer",function(){if(gf)return t.canvas;var r;return(r=t.canvas)===null||r===void 0?void 0:r.parentElement}),Q(this,"getCanvas",function(){return t.canvas}),Q(this,"getGLContext",function(){return t.gl._gl}),Q(this,"destroy",function(){var r,n,i;t.canvas=null,(r=t.gl)===null||r===void 0||(n=r._gl)===null||n===void 0||(i=n.getExtension("WEBGL_lose_context"))===null||i===void 0||i.loseContext(),t.gl.destroy(),t.gl=null})}return Gt(e,[{key:"init",value:function(){var t=Vt(Ce.mark(function n(i,o,a){var u=this;return Ce.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:if(this.canvas=i,!a){h.next=5;break}this.gl=a,h.next=8;break;case 5:return h.next=7,new Promise(function(y,x){MQ({canvas:u.canvas,attributes:{alpha:!0,antialias:o.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:o.preserveDrawingBuffer,stencil:o.stencil},extensions:["OES_element_index_uint","OES_standard_derivatives","ANGLE_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture","WEBGL_lose_context"],profile:!0,onDone:function(T,I){(T||!I)&&x(T),y(I)}})});case 7:this.gl=h.sent;case 8:this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 9:case"end":return h.stop()}},n,this)}));function r(n,i,o){return t.apply(this,arguments)}return r}()},{key:"getPointSizeRange",value:function(){return this.gl._gl.getParameter(this.gl._gl.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(r){return!!this.getGLContext().getExtension(r)}},{key:"setState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!0,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var r=this.getGLContext();r.disable(r.CULL_FACE)}},{key:"setDirty",value:function(r){this.isDirty=r}},{key:"getDirty",value:function(){return this.isDirty}}]),e}())||L4);function $Q(e){var t=GQ();return function(){var n=Ct(e),i;if(t){var o=Ct(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xn(this,i)}}function GQ(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var E2=["selectstart","selecting","selectend"],HQ=function(e){yn(r,e);var t=$Q(r);function r(n){var i,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return $t(this,r),i=t.call(this),Q(Ye(i),"isEnable",!1),Q(Ye(i),"onDragStart",function(a){i.box.style.display="block",i.startEvent=i.endEvent=a,i.syncBoxBound(),i.emit("selectstart",i.getLngLatBox(),i.startEvent,i.endEvent)}),Q(Ye(i),"onDragging",function(a){i.endEvent=a,i.syncBoxBound(),i.emit("selecting",i.getLngLatBox(),i.startEvent,i.endEvent)}),Q(Ye(i),"onDragEnd",function(a){i.endEvent=a,i.box.style.display="none",i.emit("selectend",i.getLngLatBox(),i.startEvent,i.endEvent)}),i.scene=n,i.options=o,i}return Gt(r,[{key:"container",get:function(){return this.scene.getMapService().getMarkerContainer()}},{key:"enable",value:function(){if(!this.isEnable){var i=this.options.className;if(this.scene.setMapStatus({dragEnable:!1}),this.container.style.cursor="crosshair",!this.box){var o=$u("div",void 0,this.container);o.classList.add("l7-select-box"),i&&o.classList.add(i),o.style.display="none",this.box=o}this.scene.on("dragstart",this.onDragStart),this.scene.on("dragging",this.onDragging),this.scene.on("dragend",this.onDragEnd),this.isEnable=!0}}},{key:"disable",value:function(){this.isEnable&&(this.scene.setMapStatus({dragEnable:!0}),this.container.style.cursor="auto",this.scene.off("dragstart",this.onDragStart),this.scene.off("dragging",this.onDragging),this.scene.off("dragend",this.onDragEnd),this.isEnable=!1)}},{key:"syncBoxBound",value:function(){var i=this.startEvent,o=i.x,a=i.y,u=this.endEvent,c=u.x,h=u.y,y=Math.min(o,c),x=Math.min(a,h),E=Math.abs(o-c),T=Math.abs(a-h);this.box.style.top="".concat(x,"px"),this.box.style.left="".concat(y,"px"),this.box.style.width="".concat(E,"px"),this.box.style.height="".concat(T,"px")}},{key:"getLngLatBox",value:function(){var i=this.startEvent.lngLat,o=i.lng,a=i.lat,u=this.endEvent.lngLat,c=u.lng,h=u.lat;return UF([[o,a],[c,h]])}}]),r}(tc.EventEmitter),WQ=function(){function e(t){$t(this,e);var r=t.id,n=t.map,i=t.canvas,o=t.hasBaseMap,a=_j();this.container=a,n.setContainer(a,r,i,o),a.bind(Mt.IRendererService).to(jQ).inSingletonScope(),this.sceneService=a.get(Mt.ISceneService),this.mapService=a.get(Mt.IMapService),this.iconService=a.get(Mt.IIconService),this.fontService=a.get(Mt.IFontService),this.controlService=a.get(Mt.IControlService),this.layerService=a.get(Mt.ILayerService),this.debugService=a.get(Mt.IDebugService),this.debugService.setEnable(t.debug),this.markerService=a.get(Mt.IMarkerService),this.interactionService=a.get(Mt.IInteractionService),this.popupService=a.get(Mt.IPopupService),this.boxSelect=new HQ(this,{}),G8((t==null?void 0:t.isMini)||!1),gf?this.sceneService.initMiniScene(t):(this.initComponent(r),this.sceneService.init(t),this.initControl())}return Gt(e,[{key:"map",get:function(){return this.mapService.map}},{key:"loaded",get:function(){return this.sceneService.loaded}},{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"getDebugService",value:function(){return this.debugService}},{key:"exportPng",value:function(){var t=Vt(Ce.mark(function n(i){return Ce.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",this.sceneService.exportPng(i));case 1:case"end":return a.stop()}},n,this)}));function r(n){return t.apply(this,arguments)}return r}()},{key:"exportMap",value:function(){var t=Vt(Ce.mark(function n(i){return Ce.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",this.sceneService.exportPng(i));case 1:case"end":return a.stop()}},n,this)}));function r(n){return t.apply(this,arguments)}return r}()},{key:"registerRenderService",value:function(r){var n=this;if(this.sceneService.loaded){var i=new r(this);i.init()}else this.on("loaded",function(){var o=new r(n);o.init()})}},{key:"setBgColor",value:function(r){this.mapService.setBgColor(r)}},{key:"addLayer",value:function(r){var n=this,i=Ty(this.container);if(r.setContainer(i,this.container),this.sceneService.addLayer(r),r.inited){var o=this.initMask(r);this.addMask(o,r.id)}else r.on("inited",function(){var a=n.initMask(r);n.addMask(a,r.id)})}},{key:"initMask",value:function(r){var n=r.getLayerConfig(),i=n.mask,o=n.maskfence,a=n.maskColor,u=a===void 0?"#000":a,c=n.maskOpacity,h=c===void 0?0:c;if(!(!i||!o)){var y=new _L().source(o).shape("fill").style({color:u,opacity:h});return y}}},{key:"addMask",value:function(r,n){if(r){var i=this.getLayer(n);if(i){var o=Ty(this.container);r.setContainer(o,this.container),i.addMaskLayer(r),this.sceneService.addMask(r)}}}},{key:"getPickedLayer",value:function(){return this.layerService.pickedLayerId}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(r){return this.layerService.getLayer(r)}},{key:"getLayerByName",value:function(r){return this.layerService.getLayerByName(r)}},{key:"removeLayer",value:function(){var t=Vt(Ce.mark(function n(i,o){return Ce.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,this.layerService.remove(i,o);case 2:case"end":return u.stop()}},n,this)}));function r(n,i){return t.apply(this,arguments)}return r}()},{key:"removeAllLayer",value:function(){var t=Vt(Ce.mark(function n(){return Ce.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.layerService.removeAllLayers();case 2:case"end":return o.stop()}},n,this)}));function r(){return t.apply(this,arguments)}return r}()},{key:"render",value:function(){this.sceneService.render()}},{key:"setEnableRender",value:function(r){this.layerService.setEnableRender(r)}},{key:"addIconFont",value:function(r,n){this.fontService.addIconFont(r,n)}},{key:"addIconFonts",value:function(r){var n=this;r.forEach(function(i){var o=ei(i,2),a=o[0],u=o[1];n.fontService.addIconFont(a,u)})}},{key:"addFontFace",value:function(r,n){var i=this;this.fontService.once("fontloaded",function(o){i.emit("fontloaded",o)}),this.fontService.addFontFace(r,n)}},{key:"addImage",value:function(){var t=Vt(Ce.mark(function n(i,o){return Ce.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(gf){u.next=5;break}return u.next=3,this.iconService.addImage(i,o);case 3:u.next=6;break;case 5:this.iconService.addImageMini(i,o,this.sceneService);case 6:case"end":return u.stop()}},n,this)}));function r(n,i){return t.apply(this,arguments)}return r}()},{key:"hasImage",value:function(r){return this.iconService.hasImage(r)}},{key:"removeImage",value:function(r){this.iconService.removeImage(r)}},{key:"addIconFontGlyphs",value:function(r,n){this.fontService.addIconGlyphs(n)}},{key:"addControl",value:function(r){this.controlService.addControl(r,this.container)}},{key:"removeControl",value:function(r){this.controlService.removeControl(r)}},{key:"getControlByName",value:function(r){return this.controlService.getControlByName(r)}},{key:"addMarker",value:function(r){this.markerService.addMarker(r)}},{key:"addMarkerLayer",value:function(r){this.markerService.addMarkerLayer(r)}},{key:"removeMarkerLayer",value:function(r){this.markerService.removeMarkerLayer(r)}},{key:"removeAllMarkers",value:function(){this.markerService.removeAllMarkers()}},{key:"removeAllMakers",value:function(){this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(r){this.popupService.addPopup(r)}},{key:"removePopup",value:function(r){this.popupService.removePopup(r)}},{key:"on",value:function(r,n){if(E2.includes(r)){var i;(i=this.boxSelect)===null||i===void 0||i.on(r,n)}else a1.includes(r)?this.sceneService.on(r,n):this.mapService.on(r,n)}},{key:"once",value:function(r,n){if(E2.includes(r)){var i;(i=this.boxSelect)===null||i===void 0||i.once(r,n)}else a1.includes(r)?this.sceneService.once(r,n):this.mapService.once(r,n)}},{key:"emit",value:function(r,n){a1.indexOf(r)===-1?this.mapService.on(r,n):this.sceneService.emit(r,n)}},{key:"off",value:function(r,n){if(E2.includes(r)){var i;(i=this.boxSelect)===null||i===void 0||i.off(r,n)}else a1.includes(r)?this.sceneService.off(r,n):this.mapService.off(r,n)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(r){return this.mapService.getCenter(r)}},{key:"setCenter",value:function(r,n){return this.mapService.setCenter(r,n)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(r){return this.mapService.setPitch(r)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(r){this.mapService.setRotation(r)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(r){this.mapService.panTo(r)}},{key:"panBy",value:function(r,n){this.mapService.panBy(r,n)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(r){this.mapService.setZoom(r)}},{key:"fitBounds",value:function(r,n){var i=this.sceneService.getSceneConfig(),o=i.fitBoundsOptions,a=i.animate;this.mapService.fitBounds(r,n||_t(_t({},o),{},{animate:a}))}},{key:"setZoomAndCenter",value:function(r,n){this.mapService.setZoomAndCenter(r,n)}},{key:"setMapStyle",value:function(r){this.mapService.setMapStyle(r)}},{key:"setMapStatus",value:function(r){this.mapService.setMapStatus(r)}},{key:"pixelToLngLat",value:function(r){return this.mapService.pixelToLngLat(r)}},{key:"lngLatToPixel",value:function(r){return this.mapService.lngLatToPixel(r)}},{key:"containerToLngLat",value:function(r){return this.mapService.containerToLngLat(r)}},{key:"lngLatToContainer",value:function(r){return this.mapService.lngLatToContainer(r)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(r,n){this.container.bind(Mt.IPostProcessingPass).to(r).whenTargetNamed(n)}},{key:"enableShaderPick",value:function(){this.layerService.enableShaderPick()}},{key:"diasbleShaderPick",value:function(){this.layerService.disableShaderPick()}},{key:"enableBoxSelect",value:function(){var r=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.boxSelect.enable(),n&&this.boxSelect.once("selectend",function(){r.disableBoxSelect()})}},{key:"disableBoxSelect",value:function(){this.boxSelect.disable()}},{key:"getPointSizeRange",value:function(){return this.sceneService.getPointSizeRange()}},{key:"initComponent",value:function(r){this.controlService.init({container:xF(r)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var r=this.sceneService.getSceneConfig(),n=r.logoVisible,i=r.logoPosition;n&&this.addControl(new y$({position:i}))}}]),e}(),XQ={draw:"crosshair",pointHover:"pointer",pointDrag:"move",lineHover:"pointer",lineDrag:"move",polygonHover:"pointer",polygonDrag:"move"},YQ={point:[],line:[],polygon:[],midPoint:[],dashLine:[],text:[]},Uc="top",ih="bottom",ah="right",Vc="left",jS="auto",A_=[Uc,ih,ah,Vc],ng="start",a_="end",qQ="clippingParents",Dk="viewport",fy="popper",ZQ="reference",k4=A_.reduce(function(e,t){return e.concat([t+"-"+ng,t+"-"+a_])},[]),Fk=[].concat(A_,[jS]).reduce(function(e,t){return e.concat([t,t+"-"+ng,t+"-"+a_])},[]),KQ="beforeRead",QQ="read",JQ="afterRead",eJ="beforeMain",tJ="main",rJ="afterMain",nJ="beforeWrite",iJ="write",aJ="afterWrite",oJ=[KQ,QQ,JQ,eJ,tJ,rJ,nJ,iJ,aJ];function $p(e){return e?(e.nodeName||"").toLowerCase():null}function _f(e){if(e==null)return window;if(e.toString()!=="[object Window]"){var t=e.ownerDocument;return t&&t.defaultView||window}return e}function Bm(e){var t=_f(e).Element;return e instanceof t||e instanceof Element}function rh(e){var t=_f(e).HTMLElement;return e instanceof t||e instanceof HTMLElement}function $S(e){if(typeof ShadowRoot>"u")return!1;var t=_f(e).ShadowRoot;return e instanceof t||e instanceof ShadowRoot}function sJ(e){var t=e.state;Object.keys(t.elements).forEach(function(r){var n=t.styles[r]||{},i=t.attributes[r]||{},o=t.elements[r];!rh(o)||!$p(o)||(Object.assign(o.style,n),Object.keys(i).forEach(function(a){var u=i[a];u===!1?o.removeAttribute(a):o.setAttribute(a,u===!0?"":u)}))})}function uJ(e){var t=e.state,r={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(t.elements.popper.style,r.popper),t.styles=r,t.elements.arrow&&Object.assign(t.elements.arrow.style,r.arrow),function(){Object.keys(t.elements).forEach(function(n){var i=t.elements[n],o=t.attributes[n]||{},a=Object.keys(t.styles.hasOwnProperty(n)?t.styles[n]:r[n]),u=a.reduce(function(c,h){return c[h]="",c},{});!rh(i)||!$p(i)||(Object.assign(i.style,u),Object.keys(o).forEach(function(c){i.removeAttribute(c)}))})}}const Nk={name:"applyStyles",enabled:!0,phase:"write",fn:sJ,effect:uJ,requires:["computeStyles"]};function Vp(e){return e.split("-")[0]}var Lm=Math.max,mx=Math.min,ig=Math.round;function qw(){var e=navigator.userAgentData;return e!=null&&e.brands&&Array.isArray(e.brands)?e.brands.map(function(t){return t.brand+"/"+t.version}).join(" "):navigator.userAgent}function Bk(){return!/^((?!chrome|android).)*safari/i.test(qw())}function ag(e,t,r){t===void 0&&(t=!1),r===void 0&&(r=!1);var n=e.getBoundingClientRect(),i=1,o=1;t&&rh(e)&&(i=e.offsetWidth>0&&ig(n.width)/e.offsetWidth||1,o=e.offsetHeight>0&&ig(n.height)/e.offsetHeight||1);var a=Bm(e)?_f(e):window,u=a.visualViewport,c=!Bk()&&r,h=(n.left+(c&&u?u.offsetLeft:0))/i,y=(n.top+(c&&u?u.offsetTop:0))/o,x=n.width/i,E=n.height/o;return{width:x,height:E,top:y,right:h+x,bottom:y+E,left:h,x:h,y}}function GS(e){var t=ag(e),r=e.offsetWidth,n=e.offsetHeight;return Math.abs(t.width-r)<=1&&(r=t.width),Math.abs(t.height-n)<=1&&(n=t.height),{x:e.offsetLeft,y:e.offsetTop,width:r,height:n}}function zk(e,t){var r=t.getRootNode&&t.getRootNode();if(e.contains(t))return!0;if(r&&$S(r)){var n=t;do{if(n&&e.isSameNode(n))return!0;n=n.parentNode||n.host}while(n)}return!1}function Fd(e){return _f(e).getComputedStyle(e)}function lJ(e){return["table","td","th"].indexOf($p(e))>=0}function zv(e){return((Bm(e)?e.ownerDocument:e.document)||window.document).documentElement}function rb(e){return $p(e)==="html"?e:e.assignedSlot||e.parentNode||($S(e)?e.host:null)||zv(e)}function O4(e){return!rh(e)||Fd(e).position==="fixed"?null:e.offsetParent}function cJ(e){var t=/firefox/i.test(qw()),r=/Trident/i.test(qw());if(r&&rh(e)){var n=Fd(e);if(n.position==="fixed")return null}var i=rb(e);for($S(i)&&(i=i.host);rh(i)&&["html","body"].indexOf($p(i))<0;){var o=Fd(i);if(o.transform!=="none"||o.perspective!=="none"||o.contain==="paint"||["transform","perspective"].indexOf(o.willChange)!==-1||t&&o.willChange==="filter"||t&&o.filter&&o.filter!=="none")return i;i=i.parentNode}return null}function T_(e){for(var t=_f(e),r=O4(e);r&&lJ(r)&&Fd(r).position==="static";)r=O4(r);return r&&($p(r)==="html"||$p(r)==="body"&&Fd(r).position==="static")?t:r||cJ(e)||t}function HS(e){return["top","bottom"].indexOf(e)>=0?"x":"y"}function Py(e,t,r){return Lm(e,mx(t,r))}function fJ(e,t,r){var n=Py(e,t,r);return n>r?r:n}function Uk(){return{top:0,right:0,bottom:0,left:0}}function Vk(e){return Object.assign({},Uk(),e)}function jk(e,t){return t.reduce(function(r,n){return r[n]=e,r},{})}var hJ=function(t,r){return t=typeof t=="function"?t(Object.assign({},r.rects,{placement:r.placement})):t,Vk(typeof t!="number"?t:jk(t,A_))};function pJ(e){var t,r=e.state,n=e.name,i=e.options,o=r.elements.arrow,a=r.modifiersData.popperOffsets,u=Vp(r.placement),c=HS(u),h=[Vc,ah].indexOf(u)>=0,y=h?"height":"width";if(!(!o||!a)){var x=hJ(i.padding,r),E=GS(o),T=c==="y"?Uc:Vc,I=c==="y"?ih:ah,k=r.rects.reference[y]+r.rects.reference[c]-a[c]-r.rects.popper[y],D=a[c]-r.rects.reference[c],V=T_(o),O=V?c==="y"?V.clientHeight||0:V.clientWidth||0:0,F=k/2-D/2,N=x[T],H=O-E[y]-x[I],q=O/2-E[y]/2+F,Y=Py(N,q,H),ee=c;r.modifiersData[n]=(t={},t[ee]=Y,t.centerOffset=Y-q,t)}}function dJ(e){var t=e.state,r=e.options,n=r.element,i=n===void 0?"[data-popper-arrow]":n;i!=null&&(typeof i=="string"&&(i=t.elements.popper.querySelector(i),!i)||zk(t.elements.popper,i)&&(t.elements.arrow=i))}const vJ={name:"arrow",enabled:!0,phase:"main",fn:pJ,effect:dJ,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function og(e){return e.split("-")[1]}var mJ={top:"auto",right:"auto",bottom:"auto",left:"auto"};function gJ(e,t){var r=e.x,n=e.y,i=t.devicePixelRatio||1;return{x:ig(r*i)/i||0,y:ig(n*i)/i||0}}function D4(e){var t,r=e.popper,n=e.popperRect,i=e.placement,o=e.variation,a=e.offsets,u=e.position,c=e.gpuAcceleration,h=e.adaptive,y=e.roundOffsets,x=e.isFixed,E=a.x,T=E===void 0?0:E,I=a.y,k=I===void 0?0:I,D=typeof y=="function"?y({x:T,y:k}):{x:T,y:k};T=D.x,k=D.y;var V=a.hasOwnProperty("x"),O=a.hasOwnProperty("y"),F=Vc,N=Uc,H=window;if(h){var q=T_(r),Y="clientHeight",ee="clientWidth";if(q===_f(r)&&(q=zv(r),Fd(q).position!=="static"&&u==="absolute"&&(Y="scrollHeight",ee="scrollWidth")),q=q,i===Uc||(i===Vc||i===ah)&&o===a_){N=ih;var pe=x&&q===H&&H.visualViewport?H.visualViewport.height:q[Y];k-=pe-n.height,k*=c?1:-1}if(i===Vc||(i===Uc||i===ih)&&o===a_){F=ah;var ue=x&&q===H&&H.visualViewport?H.visualViewport.width:q[ee];T-=ue-n.width,T*=c?1:-1}}var ie=Object.assign({position:u},h&&mJ),xe=y===!0?gJ({x:T,y:k},_f(r)):{x:T,y:k};if(T=xe.x,k=xe.y,c){var Se;return Object.assign({},ie,(Se={},Se[N]=O?"0":"",Se[F]=V?"0":"",Se.transform=(H.devicePixelRatio||1)<=1?"translate("+T+"px, "+k+"px)":"translate3d("+T+"px, "+k+"px, 0)",Se))}return Object.assign({},ie,(t={},t[N]=O?k+"px":"",t[F]=V?T+"px":"",t.transform="",t))}function yJ(e){var t=e.state,r=e.options,n=r.gpuAcceleration,i=n===void 0?!0:n,o=r.adaptive,a=o===void 0?!0:o,u=r.roundOffsets,c=u===void 0?!0:u,h={placement:Vp(t.placement),variation:og(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:i,isFixed:t.options.strategy==="fixed"};t.modifiersData.popperOffsets!=null&&(t.styles.popper=Object.assign({},t.styles.popper,D4(Object.assign({},h,{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:a,roundOffsets:c})))),t.modifiersData.arrow!=null&&(t.styles.arrow=Object.assign({},t.styles.arrow,D4(Object.assign({},h,{offsets:t.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:c})))),t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-placement":t.placement})}const _J={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:yJ,data:{}};var m1={passive:!0};function xJ(e){var t=e.state,r=e.instance,n=e.options,i=n.scroll,o=i===void 0?!0:i,a=n.resize,u=a===void 0?!0:a,c=_f(t.elements.popper),h=[].concat(t.scrollParents.reference,t.scrollParents.popper);return o&&h.forEach(function(y){y.addEventListener("scroll",r.update,m1)}),u&&c.addEventListener("resize",r.update,m1),function(){o&&h.forEach(function(y){y.removeEventListener("scroll",r.update,m1)}),u&&c.removeEventListener("resize",r.update,m1)}}const bJ={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:xJ,data:{}};var wJ={left:"right",right:"left",bottom:"top",top:"bottom"};function F1(e){return e.replace(/left|right|bottom|top/g,function(t){return wJ[t]})}var EJ={start:"end",end:"start"};function F4(e){return e.replace(/start|end/g,function(t){return EJ[t]})}function WS(e){var t=_f(e),r=t.pageXOffset,n=t.pageYOffset;return{scrollLeft:r,scrollTop:n}}function XS(e){return ag(zv(e)).left+WS(e).scrollLeft}function SJ(e,t){var r=_f(e),n=zv(e),i=r.visualViewport,o=n.clientWidth,a=n.clientHeight,u=0,c=0;if(i){o=i.width,a=i.height;var h=Bk();(h||!h&&t==="fixed")&&(u=i.offsetLeft,c=i.offsetTop)}return{width:o,height:a,x:u+XS(e),y:c}}function AJ(e){var t,r=zv(e),n=WS(e),i=(t=e.ownerDocument)==null?void 0:t.body,o=Lm(r.scrollWidth,r.clientWidth,i?i.scrollWidth:0,i?i.clientWidth:0),a=Lm(r.scrollHeight,r.clientHeight,i?i.scrollHeight:0,i?i.clientHeight:0),u=-n.scrollLeft+XS(e),c=-n.scrollTop;return Fd(i||r).direction==="rtl"&&(u+=Lm(r.clientWidth,i?i.clientWidth:0)-o),{width:o,height:a,x:u,y:c}}function YS(e){var t=Fd(e),r=t.overflow,n=t.overflowX,i=t.overflowY;return/auto|scroll|overlay|hidden/.test(r+i+n)}function $k(e){return["html","body","#document"].indexOf($p(e))>=0?e.ownerDocument.body:rh(e)&&YS(e)?e:$k(rb(e))}function Iy(e,t){var r;t===void 0&&(t=[]);var n=$k(e),i=n===((r=e.ownerDocument)==null?void 0:r.body),o=_f(n),a=i?[o].concat(o.visualViewport||[],YS(n)?n:[]):n,u=t.concat(a);return i?u:u.concat(Iy(rb(a)))}function Zw(e){return Object.assign({},e,{left:e.x,top:e.y,right:e.x+e.width,bottom:e.y+e.height})}function TJ(e,t){var r=ag(e,!1,t==="fixed");return r.top=r.top+e.clientTop,r.left=r.left+e.clientLeft,r.bottom=r.top+e.clientHeight,r.right=r.left+e.clientWidth,r.width=e.clientWidth,r.height=e.clientHeight,r.x=r.left,r.y=r.top,r}function N4(e,t,r){return t===Dk?Zw(SJ(e,r)):Bm(t)?TJ(t,r):Zw(AJ(zv(e)))}function CJ(e){var t=Iy(rb(e)),r=["absolute","fixed"].indexOf(Fd(e).position)>=0,n=r&&rh(e)?T_(e):e;return Bm(n)?t.filter(function(i){return Bm(i)&&zk(i,n)&&$p(i)!=="body"}):[]}function MJ(e,t,r,n){var i=t==="clippingParents"?CJ(e):[].concat(t),o=[].concat(i,[r]),a=o[0],u=o.reduce(function(c,h){var y=N4(e,h,n);return c.top=Lm(y.top,c.top),c.right=mx(y.right,c.right),c.bottom=mx(y.bottom,c.bottom),c.left=Lm(y.left,c.left),c},N4(e,a,n));return u.width=u.right-u.left,u.height=u.bottom-u.top,u.x=u.left,u.y=u.top,u}function Gk(e){var t=e.reference,r=e.element,n=e.placement,i=n?Vp(n):null,o=n?og(n):null,a=t.x+t.width/2-r.width/2,u=t.y+t.height/2-r.height/2,c;switch(i){case Uc:c={x:a,y:t.y-r.height};break;case ih:c={x:a,y:t.y+t.height};break;case ah:c={x:t.x+t.width,y:u};break;case Vc:c={x:t.x-r.width,y:u};break;default:c={x:t.x,y:t.y}}var h=i?HS(i):null;if(h!=null){var y=h==="y"?"height":"width";switch(o){case ng:c[h]=c[h]-(t[y]/2-r[y]/2);break;case a_:c[h]=c[h]+(t[y]/2-r[y]/2);break}}return c}function o_(e,t){t===void 0&&(t={});var r=t,n=r.placement,i=n===void 0?e.placement:n,o=r.strategy,a=o===void 0?e.strategy:o,u=r.boundary,c=u===void 0?qQ:u,h=r.rootBoundary,y=h===void 0?Dk:h,x=r.elementContext,E=x===void 0?fy:x,T=r.altBoundary,I=T===void 0?!1:T,k=r.padding,D=k===void 0?0:k,V=Vk(typeof D!="number"?D:jk(D,A_)),O=E===fy?ZQ:fy,F=e.rects.popper,N=e.elements[I?O:E],H=MJ(Bm(N)?N:N.contextElement||zv(e.elements.popper),c,y,a),q=ag(e.elements.reference),Y=Gk({reference:q,element:F,strategy:"absolute",placement:i}),ee=Zw(Object.assign({},F,Y)),pe=E===fy?ee:q,ue={top:H.top-pe.top+V.top,bottom:pe.bottom-H.bottom+V.bottom,left:H.left-pe.left+V.left,right:pe.right-H.right+V.right},ie=e.modifiersData.offset;if(E===fy&&ie){var xe=ie[i];Object.keys(ue).forEach(function(Se){var Ne=[ah,ih].indexOf(Se)>=0?1:-1,ze=[Uc,ih].indexOf(Se)>=0?"y":"x";ue[Se]+=xe[ze]*Ne})}return ue}function PJ(e,t){t===void 0&&(t={});var r=t,n=r.placement,i=r.boundary,o=r.rootBoundary,a=r.padding,u=r.flipVariations,c=r.allowedAutoPlacements,h=c===void 0?Fk:c,y=og(n),x=y?u?k4:k4.filter(function(I){return og(I)===y}):A_,E=x.filter(function(I){return h.indexOf(I)>=0});E.length===0&&(E=x);var T=E.reduce(function(I,k){return I[k]=o_(e,{placement:k,boundary:i,rootBoundary:o,padding:a})[Vp(k)],I},{});return Object.keys(T).sort(function(I,k){return T[I]-T[k]})}function IJ(e){if(Vp(e)===jS)return[];var t=F1(e);return[F4(e),t,F4(t)]}function RJ(e){var t=e.state,r=e.options,n=e.name;if(!t.modifiersData[n]._skip){for(var i=r.mainAxis,o=i===void 0?!0:i,a=r.altAxis,u=a===void 0?!0:a,c=r.fallbackPlacements,h=r.padding,y=r.boundary,x=r.rootBoundary,E=r.altBoundary,T=r.flipVariations,I=T===void 0?!0:T,k=r.allowedAutoPlacements,D=t.options.placement,V=Vp(D),O=V===D,F=c||(O||!I?[F1(D)]:IJ(D)),N=[D].concat(F).reduce(function(zt,qt){return zt.concat(Vp(qt)===jS?PJ(t,{placement:qt,boundary:y,rootBoundary:x,padding:h,flipVariations:I,allowedAutoPlacements:k}):qt)},[]),H=t.rects.reference,q=t.rects.popper,Y=new Map,ee=!0,pe=N[0],ue=0;ue<N.length;ue++){var ie=N[ue],xe=Vp(ie),Se=og(ie)===ng,Ne=[Uc,ih].indexOf(xe)>=0,ze=Ne?"width":"height",Be=o_(t,{placement:ie,boundary:y,rootBoundary:x,altBoundary:E,padding:h}),$e=Ne?Se?ah:Vc:Se?ih:Uc;H[ze]>q[ze]&&($e=F1($e));var it=F1($e),mt=[];if(o&&mt.push(Be[xe]<=0),u&&mt.push(Be[$e]<=0,Be[it]<=0),mt.every(function(zt){return zt})){pe=ie,ee=!1;break}Y.set(ie,mt)}if(ee)for(var Qe=I?3:1,rt=function(qt){var Zr=N.find(function(Wr){var On=Y.get(Wr);if(On)return On.slice(0,qt).every(function(Ut){return Ut})});if(Zr)return pe=Zr,"break"},gt=Qe;gt>0;gt--){var er=rt(gt);if(er==="break")break}t.placement!==pe&&(t.modifiersData[n]._skip=!0,t.placement=pe,t.reset=!0)}}const LJ={name:"flip",enabled:!0,phase:"main",fn:RJ,requiresIfExists:["offset"],data:{_skip:!1}};function B4(e,t,r){return r===void 0&&(r={x:0,y:0}),{top:e.top-t.height-r.y,right:e.right-t.width+r.x,bottom:e.bottom-t.height+r.y,left:e.left-t.width-r.x}}function z4(e){return[Uc,ah,ih,Vc].some(function(t){return e[t]>=0})}function kJ(e){var t=e.state,r=e.name,n=t.rects.reference,i=t.rects.popper,o=t.modifiersData.preventOverflow,a=o_(t,{elementContext:"reference"}),u=o_(t,{altBoundary:!0}),c=B4(a,n),h=B4(u,i,o),y=z4(c),x=z4(h);t.modifiersData[r]={referenceClippingOffsets:c,popperEscapeOffsets:h,isReferenceHidden:y,hasPopperEscaped:x},t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-reference-hidden":y,"data-popper-escaped":x})}const OJ={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:kJ};function DJ(e,t,r){var n=Vp(e),i=[Vc,Uc].indexOf(n)>=0?-1:1,o=typeof r=="function"?r(Object.assign({},t,{placement:e})):r,a=o[0],u=o[1];return a=a||0,u=(u||0)*i,[Vc,ah].indexOf(n)>=0?{x:u,y:a}:{x:a,y:u}}function FJ(e){var t=e.state,r=e.options,n=e.name,i=r.offset,o=i===void 0?[0,0]:i,a=Fk.reduce(function(y,x){return y[x]=DJ(x,t.rects,o),y},{}),u=a[t.placement],c=u.x,h=u.y;t.modifiersData.popperOffsets!=null&&(t.modifiersData.popperOffsets.x+=c,t.modifiersData.popperOffsets.y+=h),t.modifiersData[n]=a}const NJ={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:FJ};function BJ(e){var t=e.state,r=e.name;t.modifiersData[r]=Gk({reference:t.rects.reference,element:t.rects.popper,strategy:"absolute",placement:t.placement})}const zJ={name:"popperOffsets",enabled:!0,phase:"read",fn:BJ,data:{}};function UJ(e){return e==="x"?"y":"x"}function VJ(e){var t=e.state,r=e.options,n=e.name,i=r.mainAxis,o=i===void 0?!0:i,a=r.altAxis,u=a===void 0?!1:a,c=r.boundary,h=r.rootBoundary,y=r.altBoundary,x=r.padding,E=r.tether,T=E===void 0?!0:E,I=r.tetherOffset,k=I===void 0?0:I,D=o_(t,{boundary:c,rootBoundary:h,padding:x,altBoundary:y}),V=Vp(t.placement),O=og(t.placement),F=!O,N=HS(V),H=UJ(N),q=t.modifiersData.popperOffsets,Y=t.rects.reference,ee=t.rects.popper,pe=typeof k=="function"?k(Object.assign({},t.rects,{placement:t.placement})):k,ue=typeof pe=="number"?{mainAxis:pe,altAxis:pe}:Object.assign({mainAxis:0,altAxis:0},pe),ie=t.modifiersData.offset?t.modifiersData.offset[t.placement]:null,xe={x:0,y:0};if(q){if(o){var Se,Ne=N==="y"?Uc:Vc,ze=N==="y"?ih:ah,Be=N==="y"?"height":"width",$e=q[N],it=$e+D[Ne],mt=$e-D[ze],Qe=T?-ee[Be]/2:0,rt=O===ng?Y[Be]:ee[Be],gt=O===ng?-ee[Be]:-Y[Be],er=t.elements.arrow,zt=T&&er?GS(er):{width:0,height:0},qt=t.modifiersData["arrow#persistent"]?t.modifiersData["arrow#persistent"].padding:Uk(),Zr=qt[Ne],Wr=qt[ze],On=Py(0,Y[Be],zt[Be]),Ut=F?Y[Be]/2-Qe-On-Zr-ue.mainAxis:rt-On-Zr-ue.mainAxis,Ar=F?-Y[Be]/2+Qe+On+Wr+ue.mainAxis:gt+On+Wr+ue.mainAxis,an=t.elements.arrow&&T_(t.elements.arrow),Ft=an?N==="y"?an.clientTop||0:an.clientLeft||0:0,Mr=(Se=ie==null?void 0:ie[N])!=null?Se:0,mn=$e+Ut-Mr-Ft,Nn=$e+Ar-Mr,Xn=Py(T?mx(it,mn):it,$e,T?Lm(mt,Nn):mt);q[N]=Xn,xe[N]=Xn-$e}if(u){var qn,Li=N==="x"?Uc:Vc,ci=N==="x"?ih:ah,Ai=q[H],Vi=H==="y"?"height":"width",za=Ai+D[Li],ia=Ai-D[ci],X=[Uc,Vc].indexOf(V)!==-1,Ht=(qn=ie==null?void 0:ie[H])!=null?qn:0,or=X?za:Ai-Y[Vi]-ee[Vi]-Ht+ue.altAxis,Yr=X?Ai+Y[Vi]+ee[Vi]-Ht-ue.altAxis:ia,wn=T&&X?fJ(or,Ai,Yr):Py(T?or:za,Ai,T?Yr:ia);q[H]=wn,xe[H]=wn-Ai}t.modifiersData[n]=xe}}const jJ={name:"preventOverflow",enabled:!0,phase:"main",fn:VJ,requiresIfExists:["offset"]};function $J(e){return{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}}function GJ(e){return e===_f(e)||!rh(e)?WS(e):$J(e)}function HJ(e){var t=e.getBoundingClientRect(),r=ig(t.width)/e.offsetWidth||1,n=ig(t.height)/e.offsetHeight||1;return r!==1||n!==1}function WJ(e,t,r){r===void 0&&(r=!1);var n=rh(t),i=rh(t)&&HJ(t),o=zv(t),a=ag(e,i,r),u={scrollLeft:0,scrollTop:0},c={x:0,y:0};return(n||!n&&!r)&&(($p(t)!=="body"||YS(o))&&(u=GJ(t)),rh(t)?(c=ag(t,!0),c.x+=t.clientLeft,c.y+=t.clientTop):o&&(c.x=XS(o))),{x:a.left+u.scrollLeft-c.x,y:a.top+u.scrollTop-c.y,width:a.width,height:a.height}}function XJ(e){var t=new Map,r=new Set,n=[];e.forEach(function(o){t.set(o.name,o)});function i(o){r.add(o.name);var a=[].concat(o.requires||[],o.requiresIfExists||[]);a.forEach(function(u){if(!r.has(u)){var c=t.get(u);c&&i(c)}}),n.push(o)}return e.forEach(function(o){r.has(o.name)||i(o)}),n}function YJ(e){var t=XJ(e);return oJ.reduce(function(r,n){return r.concat(t.filter(function(i){return i.phase===n}))},[])}function qJ(e){var t;return function(){return t||(t=new Promise(function(r){Promise.resolve().then(function(){t=void 0,r(e())})})),t}}function ZJ(e){var t=e.reduce(function(r,n){var i=r[n.name];return r[n.name]=i?Object.assign({},i,n,{options:Object.assign({},i.options,n.options),data:Object.assign({},i.data,n.data)}):n,r},{});return Object.keys(t).map(function(r){return t[r]})}var U4={placement:"bottom",modifiers:[],strategy:"absolute"};function V4(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return!t.some(function(n){return!(n&&typeof n.getBoundingClientRect=="function")})}function KJ(e){e===void 0&&(e={});var t=e,r=t.defaultModifiers,n=r===void 0?[]:r,i=t.defaultOptions,o=i===void 0?U4:i;return function(u,c,h){h===void 0&&(h=o);var y={placement:"bottom",orderedModifiers:[],options:Object.assign({},U4,o),modifiersData:{},elements:{reference:u,popper:c},attributes:{},styles:{}},x=[],E=!1,T={state:y,setOptions:function(V){var O=typeof V=="function"?V(y.options):V;k(),y.options=Object.assign({},o,y.options,O),y.scrollParents={reference:Bm(u)?Iy(u):u.contextElement?Iy(u.contextElement):[],popper:Iy(c)};var F=YJ(ZJ([].concat(n,y.options.modifiers)));return y.orderedModifiers=F.filter(function(N){return N.enabled}),I(),T.update()},forceUpdate:function(){if(!E){var V=y.elements,O=V.reference,F=V.popper;if(V4(O,F)){y.rects={reference:WJ(O,T_(F),y.options.strategy==="fixed"),popper:GS(F)},y.reset=!1,y.placement=y.options.placement,y.orderedModifiers.forEach(function(ue){return y.modifiersData[ue.name]=Object.assign({},ue.data)});for(var N=0;N<y.orderedModifiers.length;N++){if(y.reset===!0){y.reset=!1,N=-1;continue}var H=y.orderedModifiers[N],q=H.fn,Y=H.options,ee=Y===void 0?{}:Y,pe=H.name;typeof q=="function"&&(y=q({state:y,options:ee,name:pe,instance:T})||y)}}}},update:qJ(function(){return new Promise(function(D){T.forceUpdate(),D(y)})}),destroy:function(){k(),E=!0}};if(!V4(u,c))return T;T.setOptions(h).then(function(D){!E&&h.onFirstUpdate&&h.onFirstUpdate(D)});function I(){y.orderedModifiers.forEach(function(D){var V=D.name,O=D.options,F=O===void 0?{}:O,N=D.effect;if(typeof N=="function"){var H=N({state:y,name:V,instance:T,options:F}),q=function(){};x.push(H||q)}})}function k(){x.forEach(function(D){return D()}),x=[]}return T}}var QJ=[bJ,zJ,_J,Nk,NJ,LJ,jJ,vJ,OJ],JJ=KJ({defaultModifiers:QJ}),eee="tippy-box",Hk="tippy-content",tee="tippy-backdrop",Wk="tippy-arrow",Xk="tippy-svg-arrow",Em={passive:!0,capture:!0},Yk=function(){return document.body};function S2(e,t,r){if(Array.isArray(e)){var n=e[t];return n??(Array.isArray(r)?r[t]:r)}return e}function qS(e,t){var r={}.toString.call(e);return r.indexOf("[object")===0&&r.indexOf(t+"]")>-1}function qk(e,t){return typeof e=="function"?e.apply(void 0,t):e}function j4(e,t){if(t===0)return e;var r;return function(n){clearTimeout(r),r=setTimeout(function(){e(n)},t)}}function ree(e){return e.split(/\s+/).filter(Boolean)}function k0(e){return[].concat(e)}function $4(e,t){e.indexOf(t)===-1&&e.push(t)}function nee(e){return e.filter(function(t,r){return e.indexOf(t)===r})}function iee(e){return e.split("-")[0]}function gx(e){return[].slice.call(e)}function G4(e){return Object.keys(e).reduce(function(t,r){return e[r]!==void 0&&(t[r]=e[r]),t},{})}function Ry(){return document.createElement("div")}function nb(e){return["Element","Fragment"].some(function(t){return qS(e,t)})}function aee(e){return qS(e,"NodeList")}function Zk(e){return qS(e,"MouseEvent")}function oee(e){return!!(e&&e._tippy&&e._tippy.reference===e)}function see(e){return nb(e)?[e]:aee(e)?gx(e):Array.isArray(e)?e:gx(document.querySelectorAll(e))}function A2(e,t){e.forEach(function(r){r&&(r.style.transitionDuration=t+"ms")})}function H4(e,t){e.forEach(function(r){r&&r.setAttribute("data-state",t)})}function Kk(e){var t,r=k0(e),n=r[0];return n!=null&&(t=n.ownerDocument)!=null&&t.body?n.ownerDocument:document}function uee(e,t){var r=t.clientX,n=t.clientY;return e.every(function(i){var o=i.popperRect,a=i.popperState,u=i.props,c=u.interactiveBorder,h=iee(a.placement),y=a.modifiersData.offset;if(!y)return!0;var x=h==="bottom"?y.top.y:0,E=h==="top"?y.bottom.y:0,T=h==="right"?y.left.x:0,I=h==="left"?y.right.x:0,k=o.top-n+x>c,D=n-o.bottom-E>c,V=o.left-r+T>c,O=r-o.right-I>c;return k||D||V||O})}function T2(e,t,r){var n=t+"EventListener";["transitionend","webkitTransitionEnd"].forEach(function(i){e[n](i,r)})}function W4(e,t){for(var r=t;r;){var n;if(e.contains(r))return!0;r=r.getRootNode==null||(n=r.getRootNode())==null?void 0:n.host}return!1}var kp={isTouch:!1},X4=0;function lee(){kp.isTouch||(kp.isTouch=!0,window.performance&&document.addEventListener("mousemove",Qk))}function Qk(){var e=performance.now();e-X4<20&&(kp.isTouch=!1,document.removeEventListener("mousemove",Qk)),X4=e}function cee(){var e=document.activeElement;if(oee(e)){var t=e._tippy;e.blur&&!t.state.isVisible&&e.blur()}}function fee(){document.addEventListener("touchstart",lee,Em),window.addEventListener("blur",cee)}var hee=typeof window<"u"&&typeof document<"u",pee=hee?!!window.msCrypto:!1,dee={animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},vee={allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999},Yh=Object.assign({appendTo:Yk,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},dee,vee),mee=Object.keys(Yh),gee=function(t){var r=Object.keys(t);r.forEach(function(n){Yh[n]=t[n]})};function Jk(e){var t=e.plugins||[],r=t.reduce(function(n,i){var o=i.name,a=i.defaultValue;if(o){var u;n[o]=e[o]!==void 0?e[o]:(u=Yh[o])!=null?u:a}return n},{});return Object.assign({},e,r)}function yee(e,t){var r=t?Object.keys(Jk(Object.assign({},Yh,{plugins:t}))):mee,n=r.reduce(function(i,o){var a=(e.getAttribute("data-tippy-"+o)||"").trim();if(!a)return i;if(o==="content")i[o]=a;else try{i[o]=JSON.parse(a)}catch{i[o]=a}return i},{});return n}function Y4(e,t){var r=Object.assign({},t,{content:qk(t.content,[e])},t.ignoreAttributes?{}:yee(e,t.plugins));return r.aria=Object.assign({},Yh.aria,r.aria),r.aria={expanded:r.aria.expanded==="auto"?t.interactive:r.aria.expanded,content:r.aria.content==="auto"?t.interactive?null:"describedby":r.aria.content},r}var _ee=function(){return"innerHTML"};function Kw(e,t){e[_ee()]=t}function q4(e){var t=Ry();return e===!0?t.className=Wk:(t.className=Xk,nb(e)?t.appendChild(e):Kw(t,e)),t}function Z4(e,t){nb(t.content)?(Kw(e,""),e.appendChild(t.content)):typeof t.content!="function"&&(t.allowHTML?Kw(e,t.content):e.textContent=t.content)}function Qw(e){var t=e.firstElementChild,r=gx(t.children);return{box:t,content:r.find(function(n){return n.classList.contains(Hk)}),arrow:r.find(function(n){return n.classList.contains(Wk)||n.classList.contains(Xk)}),backdrop:r.find(function(n){return n.classList.contains(tee)})}}function eO(e){var t=Ry(),r=Ry();r.className=eee,r.setAttribute("data-state","hidden"),r.setAttribute("tabindex","-1");var n=Ry();n.className=Hk,n.setAttribute("data-state","hidden"),Z4(n,e.props),t.appendChild(r),r.appendChild(n),i(e.props,e.props);function i(o,a){var u=Qw(t),c=u.box,h=u.content,y=u.arrow;a.theme?c.setAttribute("data-theme",a.theme):c.removeAttribute("data-theme"),typeof a.animation=="string"?c.setAttribute("data-animation",a.animation):c.removeAttribute("data-animation"),a.inertia?c.setAttribute("data-inertia",""):c.removeAttribute("data-inertia"),c.style.maxWidth=typeof a.maxWidth=="number"?a.maxWidth+"px":a.maxWidth,a.role?c.setAttribute("role",a.role):c.removeAttribute("role"),(o.content!==a.content||o.allowHTML!==a.allowHTML)&&Z4(h,e.props),a.arrow?y?o.arrow!==a.arrow&&(c.removeChild(y),c.appendChild(q4(a.arrow))):c.appendChild(q4(a.arrow)):y&&c.removeChild(y)}return{popper:t,onUpdate:i}}eO.$$tippy=!0;var xee=1,g1=[],C2=[];function bee(e,t){var r=Y4(e,Object.assign({},Yh,Jk(G4(t)))),n,i,o,a=!1,u=!1,c=!1,h=!1,y,x,E,T=[],I=j4(mn,r.interactiveDebounce),k,D=xee++,V=null,O=nee(r.plugins),F={isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},N={id:D,reference:e,popper:Ry(),popperInstance:V,props:r,state:F,plugins:O,clearDelayTimeouts:or,setProps:Yr,setContent:wn,show:Qi,hide:Zn,hideWithInteractivity:Hn,enable:X,disable:Ht,unmount:Dn,destroy:di};if(!r.render)return N;var H=r.render(N),q=H.popper,Y=H.onUpdate;q.setAttribute("data-tippy-root",""),q.id="tippy-"+N.id,N.popper=q,e._tippy=N,q._tippy=N;var ee=O.map(function(wt){return wt.fn(N)}),pe=e.hasAttribute("aria-expanded");return an(),Qe(),$e(),it("onCreate",[N]),r.showOnCreate&&za(),q.addEventListener("mouseenter",function(){N.props.interactive&&N.state.isVisible&&N.clearDelayTimeouts()}),q.addEventListener("mouseleave",function(){N.props.interactive&&N.props.trigger.indexOf("mouseenter")>=0&&Ne().addEventListener("mousemove",I)}),N;function ue(){var wt=N.props.touch;return Array.isArray(wt)?wt:[wt,0]}function ie(){return ue()[0]==="hold"}function xe(){var wt;return!!((wt=N.props.render)!=null&&wt.$$tippy)}function Se(){return k||e}function Ne(){var wt=Se().parentNode;return wt?Kk(wt):document}function ze(){return Qw(q)}function Be(wt){return N.state.isMounted&&!N.state.isVisible||kp.isTouch||y&&y.type==="focus"?0:S2(N.props.delay,wt?0:1,Yh.delay)}function $e(wt){wt===void 0&&(wt=!1),q.style.pointerEvents=N.props.interactive&&!wt?"":"none",q.style.zIndex=""+N.props.zIndex}function it(wt,rn,En){if(En===void 0&&(En=!0),ee.forEach(function(ki){ki[wt]&&ki[wt].apply(ki,rn)}),En){var Ii;(Ii=N.props)[wt].apply(Ii,rn)}}function mt(){var wt=N.props.aria;if(wt.content){var rn="aria-"+wt.content,En=q.id,Ii=k0(N.props.triggerTarget||e);Ii.forEach(function(ki){var uo=ki.getAttribute(rn);if(N.state.isVisible)ki.setAttribute(rn,uo?uo+" "+En:En);else{var go=uo&&uo.replace(En,"").trim();go?ki.setAttribute(rn,go):ki.removeAttribute(rn)}})}}function Qe(){if(!(pe||!N.props.aria.expanded)){var wt=k0(N.props.triggerTarget||e);wt.forEach(function(rn){N.props.interactive?rn.setAttribute("aria-expanded",N.state.isVisible&&rn===Se()?"true":"false"):rn.removeAttribute("aria-expanded")})}}function rt(){Ne().removeEventListener("mousemove",I),g1=g1.filter(function(wt){return wt!==I})}function gt(wt){if(!(kp.isTouch&&(c||wt.type==="mousedown"))){var rn=wt.composedPath&&wt.composedPath()[0]||wt.target;if(!(N.props.interactive&&W4(q,rn))){if(k0(N.props.triggerTarget||e).some(function(En){return W4(En,rn)})){if(kp.isTouch||N.state.isVisible&&N.props.trigger.indexOf("click")>=0)return}else it("onClickOutside",[N,wt]);N.props.hideOnClick===!0&&(N.clearDelayTimeouts(),N.hide(),u=!0,setTimeout(function(){u=!1}),N.state.isMounted||Zr())}}}function er(){c=!0}function zt(){c=!1}function qt(){var wt=Ne();wt.addEventListener("mousedown",gt,!0),wt.addEventListener("touchend",gt,Em),wt.addEventListener("touchstart",zt,Em),wt.addEventListener("touchmove",er,Em)}function Zr(){var wt=Ne();wt.removeEventListener("mousedown",gt,!0),wt.removeEventListener("touchend",gt,Em),wt.removeEventListener("touchstart",zt,Em),wt.removeEventListener("touchmove",er,Em)}function Wr(wt,rn){Ut(wt,function(){!N.state.isVisible&&q.parentNode&&q.parentNode.contains(q)&&rn()})}function On(wt,rn){Ut(wt,rn)}function Ut(wt,rn){var En=ze().box;function Ii(ki){ki.target===En&&(T2(En,"remove",Ii),rn())}if(wt===0)return rn();T2(En,"remove",x),T2(En,"add",Ii),x=Ii}function Ar(wt,rn,En){En===void 0&&(En=!1);var Ii=k0(N.props.triggerTarget||e);Ii.forEach(function(ki){ki.addEventListener(wt,rn,En),T.push({node:ki,eventType:wt,handler:rn,options:En})})}function an(){ie()&&(Ar("touchstart",Mr,{passive:!0}),Ar("touchend",Nn,{passive:!0})),ree(N.props.trigger).forEach(function(wt){if(wt!=="manual")switch(Ar(wt,Mr),wt){case"mouseenter":Ar("mouseleave",Nn);break;case"focus":Ar(pee?"focusout":"blur",Xn);break;case"focusin":Ar("focusout",Xn);break}})}function Ft(){T.forEach(function(wt){var rn=wt.node,En=wt.eventType,Ii=wt.handler,ki=wt.options;rn.removeEventListener(En,Ii,ki)}),T=[]}function Mr(wt){var rn,En=!1;if(!(!N.state.isEnabled||qn(wt)||u)){var Ii=((rn=y)==null?void 0:rn.type)==="focus";y=wt,k=wt.currentTarget,Qe(),!N.state.isVisible&&Zk(wt)&&g1.forEach(function(ki){return ki(wt)}),wt.type==="click"&&(N.props.trigger.indexOf("mouseenter")<0||a)&&N.props.hideOnClick!==!1&&N.state.isVisible?En=!0:za(wt),wt.type==="click"&&(a=!En),En&&!Ii&&ia(wt)}}function mn(wt){var rn=wt.target,En=Se().contains(rn)||q.contains(rn);if(!(wt.type==="mousemove"&&En)){var Ii=Vi().concat(q).map(function(ki){var uo,go=ki._tippy,yo=(uo=go.popperInstance)==null?void 0:uo.state;return yo?{popperRect:ki.getBoundingClientRect(),popperState:yo,props:r}:null}).filter(Boolean);uee(Ii,wt)&&(rt(),ia(wt))}}function Nn(wt){var rn=qn(wt)||N.props.trigger.indexOf("click")>=0&&a;if(!rn){if(N.props.interactive){N.hideWithInteractivity(wt);return}ia(wt)}}function Xn(wt){N.props.trigger.indexOf("focusin")<0&&wt.target!==Se()||N.props.interactive&&wt.relatedTarget&&q.contains(wt.relatedTarget)||ia(wt)}function qn(wt){return kp.isTouch?ie()!==wt.type.indexOf("touch")>=0:!1}function Li(){ci();var wt=N.props,rn=wt.popperOptions,En=wt.placement,Ii=wt.offset,ki=wt.getReferenceClientRect,uo=wt.moveTransition,go=xe()?Qw(q).arrow:null,yo=ki?{getBoundingClientRect:ki,contextElement:ki.contextElement||Se()}:e,Fs={name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(ha){var Z=ha.state;if(xe()){var re=ze(),oe=re.box;["placement","reference-hidden","escaped"].forEach(function(ge){ge==="placement"?oe.setAttribute("data-placement",Z.placement):Z.attributes.popper["data-popper-"+ge]?oe.setAttribute("data-"+ge,""):oe.removeAttribute("data-"+ge)}),Z.attributes.popper={}}}},Ss=[{name:"offset",options:{offset:Ii}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!uo}},Fs];xe()&&go&&Ss.push({name:"arrow",options:{element:go,padding:3}}),Ss.push.apply(Ss,(rn==null?void 0:rn.modifiers)||[]),N.popperInstance=JJ(yo,q,Object.assign({},rn,{placement:En,onFirstUpdate:E,modifiers:Ss}))}function ci(){N.popperInstance&&(N.popperInstance.destroy(),N.popperInstance=null)}function Ai(){var wt=N.props.appendTo,rn,En=Se();N.props.interactive&&wt===Yk||wt==="parent"?rn=En.parentNode:rn=qk(wt,[En]),rn.contains(q)||rn.appendChild(q),N.state.isMounted=!0,Li()}function Vi(){return gx(q.querySelectorAll("[data-tippy-root]"))}function za(wt){N.clearDelayTimeouts(),wt&&it("onTrigger",[N,wt]),qt();var rn=Be(!0),En=ue(),Ii=En[0],ki=En[1];kp.isTouch&&Ii==="hold"&&ki&&(rn=ki),rn?n=setTimeout(function(){N.show()},rn):N.show()}function ia(wt){if(N.clearDelayTimeouts(),it("onUntrigger",[N,wt]),!N.state.isVisible){Zr();return}if(!(N.props.trigger.indexOf("mouseenter")>=0&&N.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(wt.type)>=0&&a)){var rn=Be(!1);rn?i=setTimeout(function(){N.state.isVisible&&N.hide()},rn):o=requestAnimationFrame(function(){N.hide()})}}function X(){N.state.isEnabled=!0}function Ht(){N.hide(),N.state.isEnabled=!1}function or(){clearTimeout(n),clearTimeout(i),cancelAnimationFrame(o)}function Yr(wt){if(!N.state.isDestroyed){it("onBeforeUpdate",[N,wt]),Ft();var rn=N.props,En=Y4(e,Object.assign({},rn,G4(wt),{ignoreAttributes:!0}));N.props=En,an(),rn.interactiveDebounce!==En.interactiveDebounce&&(rt(),I=j4(mn,En.interactiveDebounce)),rn.triggerTarget&&!En.triggerTarget?k0(rn.triggerTarget).forEach(function(Ii){Ii.removeAttribute("aria-expanded")}):En.triggerTarget&&e.removeAttribute("aria-expanded"),Qe(),$e(),Y&&Y(rn,En),N.popperInstance&&(Li(),Vi().forEach(function(Ii){requestAnimationFrame(Ii._tippy.popperInstance.forceUpdate)})),it("onAfterUpdate",[N,wt])}}function wn(wt){N.setProps({content:wt})}function Qi(){var wt=N.state.isVisible,rn=N.state.isDestroyed,En=!N.state.isEnabled,Ii=kp.isTouch&&!N.props.touch,ki=S2(N.props.duration,0,Yh.duration);if(!(wt||rn||En||Ii)&&!Se().hasAttribute("disabled")&&(it("onShow",[N],!1),N.props.onShow(N)!==!1)){if(N.state.isVisible=!0,xe()&&(q.style.visibility="visible"),$e(),qt(),N.state.isMounted||(q.style.transition="none"),xe()){var uo=ze(),go=uo.box,yo=uo.content;A2([go,yo],0)}E=function(){var Ss;if(!(!N.state.isVisible||h)){if(h=!0,q.offsetHeight,q.style.transition=N.props.moveTransition,xe()&&N.props.animation){var Su=ze(),ha=Su.box,Z=Su.content;A2([ha,Z],ki),H4([ha,Z],"visible")}mt(),Qe(),$4(C2,N),(Ss=N.popperInstance)==null||Ss.forceUpdate(),it("onMount",[N]),N.props.animation&&xe()&&On(ki,function(){N.state.isShown=!0,it("onShown",[N])})}},Ai()}}function Zn(){var wt=!N.state.isVisible,rn=N.state.isDestroyed,En=!N.state.isEnabled,Ii=S2(N.props.duration,1,Yh.duration);if(!(wt||rn||En)&&(it("onHide",[N],!1),N.props.onHide(N)!==!1)){if(N.state.isVisible=!1,N.state.isShown=!1,h=!1,a=!1,xe()&&(q.style.visibility="hidden"),rt(),Zr(),$e(!0),xe()){var ki=ze(),uo=ki.box,go=ki.content;N.props.animation&&(A2([uo,go],Ii),H4([uo,go],"hidden"))}mt(),Qe(),N.props.animation?xe()&&Wr(Ii,N.unmount):N.unmount()}}function Hn(wt){Ne().addEventListener("mousemove",I),$4(g1,I),I(wt)}function Dn(){N.state.isVisible&&N.hide(),N.state.isMounted&&(ci(),Vi().forEach(function(wt){wt._tippy.unmount()}),q.parentNode&&q.parentNode.removeChild(q),C2=C2.filter(function(wt){return wt!==N}),N.state.isMounted=!1,it("onHidden",[N]))}function di(){N.state.isDestroyed||(N.clearDelayTimeouts(),N.unmount(),Ft(),delete e._tippy,N.state.isDestroyed=!0,it("onDestroy",[N]))}}function C_(e,t){t===void 0&&(t={});var r=Yh.plugins.concat(t.plugins||[]);fee();var n=Object.assign({},t,{plugins:r}),i=see(e),o=i.reduce(function(a,u){var c=u&&bee(u,n);return c&&a.push(c),a},[]);return nb(e)?o[0]:o}C_.defaultProps=Yh;C_.setDefaultProps=gee;C_.currentInput=kp;Object.assign({},Nk,{effect:function(t){var r=t.state,n={popper:{position:r.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(r.elements.popper.style,n.popper),r.styles=n,r.elements.arrow&&Object.assign(r.elements.arrow.style,n.arrow)}});var Jw={clientX:0,clientY:0},y1=[];function tO(e){var t=e.clientX,r=e.clientY;Jw={clientX:t,clientY:r}}function wee(e){e.addEventListener("mousemove",tO)}function Eee(e){e.removeEventListener("mousemove",tO)}var See={name:"followCursor",defaultValue:!1,fn:function(t){var r=t.reference,n=Kk(t.props.triggerTarget||r),i=!1,o=!1,a=!0,u=t.props;function c(){return t.props.followCursor==="initial"&&t.state.isVisible}function h(){n.addEventListener("mousemove",E)}function y(){n.removeEventListener("mousemove",E)}function x(){i=!0,t.setProps({getReferenceClientRect:null}),i=!1}function E(k){var D=k.target?r.contains(k.target):!0,V=t.props.followCursor,O=k.clientX,F=k.clientY,N=r.getBoundingClientRect(),H=O-N.left,q=F-N.top;(D||!t.props.interactive)&&t.setProps({getReferenceClientRect:function(){var ee=r.getBoundingClientRect(),pe=O,ue=F;V==="initial"&&(pe=ee.left+H,ue=ee.top+q);var ie=V==="horizontal"?ee.top:ue,xe=V==="vertical"?ee.right:pe,Se=V==="horizontal"?ee.bottom:ue,Ne=V==="vertical"?ee.left:pe;return{width:xe-Ne,height:Se-ie,top:ie,right:xe,bottom:Se,left:Ne}}})}function T(){t.props.followCursor&&(y1.push({instance:t,doc:n}),wee(n))}function I(){y1=y1.filter(function(k){return k.instance!==t}),y1.filter(function(k){return k.doc===n}).length===0&&Eee(n)}return{onCreate:T,onDestroy:I,onBeforeUpdate:function(){u=t.props},onAfterUpdate:function(D,V){var O=V.followCursor;i||O!==void 0&&u.followCursor!==O&&(I(),O?(T(),t.state.isMounted&&!o&&!c()&&h()):(y(),x()))},onMount:function(){t.props.followCursor&&!o&&(a&&(E(Jw),a=!1),c()||h())},onTrigger:function(D,V){Zk(V)&&(Jw={clientX:V.clientX,clientY:V.clientY}),o=V.type==="focus"},onHidden:function(){t.props.followCursor&&(x(),y(),a=!0)}}}};C_.setDefaultProps({render:eO});var Aee={showTotalDistance:!1,showDashDistance:!0,showWhen:["normal","active"],format:function(t){return t>=1e3?+(t/1e3).toFixed(2)+"km":+t.toFixed(2)+"m"}},Tee={showWhen:["normal","active"],format:function(t){return t>1e6?"".concat(+(t/1e6).toFixed(2),"km²"):"".concat(+t.toFixed(2),"m²")}},Cee={maxSize:100},Mee={remove:["del","backspace"],revert:["command+z","ctrl+z"],redo:["command+shift+z","ctrl+shift+z"]},Pee={allowHTML:!0,followCursor:!0,placement:"bottom-start",offset:[-10,20],plugins:[See],trigger:"manual",hideOnClick:!1,theme:"light"},Iee={data:"drawData",pointAdsorbPixel:12,lineAdsorbPixel:10},Ka;(function(e){e.Init="init",e.Destroy="destroy",e.Enable="enable",e.Disable="disable",e.Add="add",e.Edit="edit",e.Remove="remove",e.Clear="clear",e.Change="change",e.DragStart="dragStart",e.Dragging="dragging",e.DragEnd="dragEnd",e.Select="select",e.AddNode="addNode",e.RemoveNode="removeNode"})(Ka||(Ka={}));var j0;(function(e){e.Change="change",e.Update="update"})(j0||(j0={}));var li;(function(e){e.Click="click",e.UnClick="unclick",e.Dragstart="dragstart",e.Mousemove="mousemove",e.Mouseout="mouseout",e.Dragging="dragging",e.Dragend="dragend",e.DblClick="dblClick",e.Contextmenu="contextmenu"})(li||(li={}));var Ta;(function(e){e.Mousedown="mousedown",e.Mouseup="mouseup",e.Click="click",e.UnClick="unclick",e.Dblclick="dblclick",e.Mousemove="mousemove",e.Mouseover="mouseover",e.Mouseenter="mouseenter",e.Mouseleave="mouseleave",e.Mouseout="mouseout",e.Contextmenu="contextmenu"})(Ta||(Ta={}));var ma;(function(e){e.Loaded="loaded",e.MapMove="mapmove",e.MoveStart="movestart",e.MoveEnd="moveend",e.ZoomChange="zoomchange",e.ZoomStart="zoomstart",e.ZoomEnd="zoomend",e.Click="click",e.Dblclick="dblclick",e.Mousemove="mousemove",e.Mousewheel="mousewheel",e.Mouseover="mouseover",e.Mouseout="mouseout",e.Mouseup="mouseup",e.Mousedown="mousedown",e.Contextmenu="contextmenu",e.Dragstart="dragstart",e.Dragging="dragging",e.Dragend="dragend"})(ma||(ma={}));var K4;(function(e){e.DrawChange="drawchange",e.DataChange="datachange"})(K4||(K4={}));var ZS={exports:{}},rO={exports:{}};(function(e,t){(function(r,n){e.exports=n()})(mf,function(){function r(O,F,N,H,q){(function Y(ee,pe,ue,ie,xe){for(;ie>ue;){if(ie-ue>600){var Se=ie-ue+1,Ne=pe-ue+1,ze=Math.log(Se),Be=.5*Math.exp(2*ze/3),$e=.5*Math.sqrt(ze*Be*(Se-Be)/Se)*(Ne-Se/2<0?-1:1),it=Math.max(ue,Math.floor(pe-Ne*Be/Se+$e)),mt=Math.min(ie,Math.floor(pe+(Se-Ne)*Be/Se+$e));Y(ee,pe,it,mt,xe)}var Qe=ee[pe],rt=ue,gt=ie;for(n(ee,ue,pe),xe(ee[ie],Qe)>0&&n(ee,ue,ie);rt<gt;){for(n(ee,rt,gt),rt++,gt--;xe(ee[rt],Qe)<0;)rt++;for(;xe(ee[gt],Qe)>0;)gt--}xe(ee[ue],Qe)===0?n(ee,ue,gt):n(ee,++gt,ie),gt<=pe&&(ue=gt+1),pe<=gt&&(ie=gt-1)}})(O,F,N||0,H||O.length-1,q||i)}function n(O,F,N){var H=O[F];O[F]=O[N],O[N]=H}function i(O,F){return O<F?-1:O>F?1:0}var o=function(O){O===void 0&&(O=9),this._maxEntries=Math.max(4,O),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function a(O,F,N){if(!N)return F.indexOf(O);for(var H=0;H<F.length;H++)if(N(O,F[H]))return H;return-1}function u(O,F){c(O,0,O.children.length,F,O)}function c(O,F,N,H,q){q||(q=D(null)),q.minX=1/0,q.minY=1/0,q.maxX=-1/0,q.maxY=-1/0;for(var Y=F;Y<N;Y++){var ee=O.children[Y];h(q,O.leaf?H(ee):ee)}return q}function h(O,F){return O.minX=Math.min(O.minX,F.minX),O.minY=Math.min(O.minY,F.minY),O.maxX=Math.max(O.maxX,F.maxX),O.maxY=Math.max(O.maxY,F.maxY),O}function y(O,F){return O.minX-F.minX}function x(O,F){return O.minY-F.minY}function E(O){return(O.maxX-O.minX)*(O.maxY-O.minY)}function T(O){return O.maxX-O.minX+(O.maxY-O.minY)}function I(O,F){return O.minX<=F.minX&&O.minY<=F.minY&&F.maxX<=O.maxX&&F.maxY<=O.maxY}function k(O,F){return F.minX<=O.maxX&&F.minY<=O.maxY&&F.maxX>=O.minX&&F.maxY>=O.minY}function D(O){return{children:O,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function V(O,F,N,H,q){for(var Y=[F,N];Y.length;)if(!((N=Y.pop())-(F=Y.pop())<=H)){var ee=F+Math.ceil((N-F)/H/2)*H;r(O,ee,F,N,q),Y.push(F,ee,ee,N)}}return o.prototype.all=function(){return this._all(this.data,[])},o.prototype.search=function(O){var F=this.data,N=[];if(!k(O,F))return N;for(var H=this.toBBox,q=[];F;){for(var Y=0;Y<F.children.length;Y++){var ee=F.children[Y],pe=F.leaf?H(ee):ee;k(O,pe)&&(F.leaf?N.push(ee):I(O,pe)?this._all(ee,N):q.push(ee))}F=q.pop()}return N},o.prototype.collides=function(O){var F=this.data;if(!k(O,F))return!1;for(var N=[];F;){for(var H=0;H<F.children.length;H++){var q=F.children[H],Y=F.leaf?this.toBBox(q):q;if(k(O,Y)){if(F.leaf||I(O,Y))return!0;N.push(q)}}F=N.pop()}return!1},o.prototype.load=function(O){if(!O||!O.length)return this;if(O.length<this._minEntries){for(var F=0;F<O.length;F++)this.insert(O[F]);return this}var N=this._build(O.slice(),0,O.length-1,0);if(this.data.children.length)if(this.data.height===N.height)this._splitRoot(this.data,N);else{if(this.data.height<N.height){var H=this.data;this.data=N,N=H}this._insert(N,this.data.height-N.height-1,!0)}else this.data=N;return this},o.prototype.insert=function(O){return O&&this._insert(O,this.data.height-1),this},o.prototype.clear=function(){return this.data=D([]),this},o.prototype.remove=function(O,F){if(!O)return this;for(var N,H,q,Y=this.data,ee=this.toBBox(O),pe=[],ue=[];Y||pe.length;){if(Y||(Y=pe.pop(),H=pe[pe.length-1],N=ue.pop(),q=!0),Y.leaf){var ie=a(O,Y.children,F);if(ie!==-1)return Y.children.splice(ie,1),pe.push(Y),this._condense(pe),this}q||Y.leaf||!I(Y,ee)?H?(N++,Y=H.children[N],q=!1):Y=null:(pe.push(Y),ue.push(N),N=0,H=Y,Y=Y.children[0])}return this},o.prototype.toBBox=function(O){return O},o.prototype.compareMinX=function(O,F){return O.minX-F.minX},o.prototype.compareMinY=function(O,F){return O.minY-F.minY},o.prototype.toJSON=function(){return this.data},o.prototype.fromJSON=function(O){return this.data=O,this},o.prototype._all=function(O,F){for(var N=[];O;)O.leaf?F.push.apply(F,O.children):N.push.apply(N,O.children),O=N.pop();return F},o.prototype._build=function(O,F,N,H){var q,Y=N-F+1,ee=this._maxEntries;if(Y<=ee)return u(q=D(O.slice(F,N+1)),this.toBBox),q;H||(H=Math.ceil(Math.log(Y)/Math.log(ee)),ee=Math.ceil(Y/Math.pow(ee,H-1))),(q=D([])).leaf=!1,q.height=H;var pe=Math.ceil(Y/ee),ue=pe*Math.ceil(Math.sqrt(ee));V(O,F,N,ue,this.compareMinX);for(var ie=F;ie<=N;ie+=ue){var xe=Math.min(ie+ue-1,N);V(O,ie,xe,pe,this.compareMinY);for(var Se=ie;Se<=xe;Se+=pe){var Ne=Math.min(Se+pe-1,xe);q.children.push(this._build(O,Se,Ne,H-1))}}return u(q,this.toBBox),q},o.prototype._chooseSubtree=function(O,F,N,H){for(;H.push(F),!F.leaf&&H.length-1!==N;){for(var q=1/0,Y=1/0,ee=void 0,pe=0;pe<F.children.length;pe++){var ue=F.children[pe],ie=E(ue),xe=(Se=O,Ne=ue,(Math.max(Ne.maxX,Se.maxX)-Math.min(Ne.minX,Se.minX))*(Math.max(Ne.maxY,Se.maxY)-Math.min(Ne.minY,Se.minY))-ie);xe<Y?(Y=xe,q=ie<q?ie:q,ee=ue):xe===Y&&ie<q&&(q=ie,ee=ue)}F=ee||F.children[0]}var Se,Ne;return F},o.prototype._insert=function(O,F,N){var H=N?O:this.toBBox(O),q=[],Y=this._chooseSubtree(H,this.data,F,q);for(Y.children.push(O),h(Y,H);F>=0&&q[F].children.length>this._maxEntries;)this._split(q,F),F--;this._adjustParentBBoxes(H,q,F)},o.prototype._split=function(O,F){var N=O[F],H=N.children.length,q=this._minEntries;this._chooseSplitAxis(N,q,H);var Y=this._chooseSplitIndex(N,q,H),ee=D(N.children.splice(Y,N.children.length-Y));ee.height=N.height,ee.leaf=N.leaf,u(N,this.toBBox),u(ee,this.toBBox),F?O[F-1].children.push(ee):this._splitRoot(N,ee)},o.prototype._splitRoot=function(O,F){this.data=D([O,F]),this.data.height=O.height+1,this.data.leaf=!1,u(this.data,this.toBBox)},o.prototype._chooseSplitIndex=function(O,F,N){for(var H,q,Y,ee,pe,ue,ie,xe=1/0,Se=1/0,Ne=F;Ne<=N-F;Ne++){var ze=c(O,0,Ne,this.toBBox),Be=c(O,Ne,N,this.toBBox),$e=(q=ze,Y=Be,ee=void 0,pe=void 0,ue=void 0,ie=void 0,ee=Math.max(q.minX,Y.minX),pe=Math.max(q.minY,Y.minY),ue=Math.min(q.maxX,Y.maxX),ie=Math.min(q.maxY,Y.maxY),Math.max(0,ue-ee)*Math.max(0,ie-pe)),it=E(ze)+E(Be);$e<xe?(xe=$e,H=Ne,Se=it<Se?it:Se):$e===xe&&it<Se&&(Se=it,H=Ne)}return H||N-F},o.prototype._chooseSplitAxis=function(O,F,N){var H=O.leaf?this.compareMinX:y,q=O.leaf?this.compareMinY:x;this._allDistMargin(O,F,N,H)<this._allDistMargin(O,F,N,q)&&O.children.sort(H)},o.prototype._allDistMargin=function(O,F,N,H){O.children.sort(H);for(var q=this.toBBox,Y=c(O,0,F,q),ee=c(O,N-F,N,q),pe=T(Y)+T(ee),ue=F;ue<N-F;ue++){var ie=O.children[ue];h(Y,O.leaf?q(ie):ie),pe+=T(Y)}for(var xe=N-F-1;xe>=F;xe--){var Se=O.children[xe];h(ee,O.leaf?q(Se):Se),pe+=T(ee)}return pe},o.prototype._adjustParentBBoxes=function(O,F,N){for(var H=N;H>=0;H--)h(F[H],O)},o.prototype._condense=function(O){for(var F=O.length-1,N=void 0;F>=0;F--)O[F].children.length===0?F>0?(N=O[F-1].children).splice(N.indexOf(O[F]),1):this.clear():u(O[F],this.toBBox)},o})})(rO);var Ree=rO.exports;class Lee{constructor(t=[],r=kee){if(this.data=t,this.length=this.data.length,this.compare=r,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const t=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:r,compare:n}=this,i=r[t];for(;t>0;){const o=t-1>>1,a=r[o];if(n(i,a)>=0)break;r[t]=a,t=o}r[t]=i}_down(t){const{data:r,compare:n}=this,i=this.length>>1,o=r[t];for(;t<i;){let a=(t<<1)+1,u=r[a];const c=a+1;if(c<this.length&&n(r[c],u)<0&&(a=c,u=r[c]),n(u,o)>=0)break;r[t]=u,t=a}r[t]=o}}function kee(e,t){return e<t?-1:e>t?1:0}const Oee=Object.freeze(Object.defineProperty({__proto__:null,default:Lee},Symbol.toStringTag,{value:"Module"})),Dee=v_(Oee);var ib={exports:{}},Fee=function(t,r,n,i){var o=t[0],a=t[1],u=!1;n===void 0&&(n=0),i===void 0&&(i=r.length);for(var c=(i-n)/2,h=0,y=c-1;h<c;y=h++){var x=r[n+h*2+0],E=r[n+h*2+1],T=r[n+y*2+0],I=r[n+y*2+1],k=E>a!=I>a&&o<(T-x)*(a-E)/(I-E)+x;k&&(u=!u)}return u},Nee=function(t,r,n,i){var o=t[0],a=t[1],u=!1;n===void 0&&(n=0),i===void 0&&(i=r.length);for(var c=i-n,h=0,y=c-1;h<c;y=h++){var x=r[h+n][0],E=r[h+n][1],T=r[y+n][0],I=r[y+n][1],k=E>a!=I>a&&o<(T-x)*(a-E)/(I-E)+x;k&&(u=!u)}return u},nO=Fee,iO=Nee;ib.exports=function(t,r,n,i){return r.length>0&&Array.isArray(r[0])?iO(t,r,n,i):nO(t,r,n,i)};ib.exports.nested=iO;ib.exports.flat=nO;var Bee=ib.exports,eE={exports:{}};(function(e,t){(function(r,n){n(t)})(mf,function(r){const i=33306690738754706e-32;function o(k,D,V,O,F){let N,H,q,Y,ee=D[0],pe=O[0],ue=0,ie=0;pe>ee==pe>-ee?(N=ee,ee=D[++ue]):(N=pe,pe=O[++ie]);let xe=0;if(ue<k&&ie<V)for(pe>ee==pe>-ee?(q=N-((H=ee+N)-ee),ee=D[++ue]):(q=N-((H=pe+N)-pe),pe=O[++ie]),N=H,q!==0&&(F[xe++]=q);ue<k&&ie<V;)pe>ee==pe>-ee?(q=N-((H=N+ee)-(Y=H-N))+(ee-Y),ee=D[++ue]):(q=N-((H=N+pe)-(Y=H-N))+(pe-Y),pe=O[++ie]),N=H,q!==0&&(F[xe++]=q);for(;ue<k;)q=N-((H=N+ee)-(Y=H-N))+(ee-Y),ee=D[++ue],N=H,q!==0&&(F[xe++]=q);for(;ie<V;)q=N-((H=N+pe)-(Y=H-N))+(pe-Y),pe=O[++ie],N=H,q!==0&&(F[xe++]=q);return N===0&&xe!==0||(F[xe++]=N),xe}function a(k){return new Float64Array(k)}const u=33306690738754716e-32,c=22204460492503146e-32,h=11093356479670487e-47,y=a(4),x=a(8),E=a(12),T=a(16),I=a(4);r.orient2d=function(k,D,V,O,F,N){const H=(D-N)*(V-F),q=(k-F)*(O-N),Y=H-q;if(H===0||q===0||H>0!=q>0)return Y;const ee=Math.abs(H+q);return Math.abs(Y)>=u*ee?Y:-function(pe,ue,ie,xe,Se,Ne,ze){let Be,$e,it,mt,Qe,rt,gt,er,zt,qt,Zr,Wr,On,Ut,Ar,an,Ft,Mr;const mn=pe-Se,Nn=ie-Se,Xn=ue-Ne,qn=xe-Ne;Qe=(Ar=(er=mn-(gt=(rt=134217729*mn)-(rt-mn)))*(qt=qn-(zt=(rt=134217729*qn)-(rt-qn)))-((Ut=mn*qn)-gt*zt-er*zt-gt*qt))-(Zr=Ar-(Ft=(er=Xn-(gt=(rt=134217729*Xn)-(rt-Xn)))*(qt=Nn-(zt=(rt=134217729*Nn)-(rt-Nn)))-((an=Xn*Nn)-gt*zt-er*zt-gt*qt))),y[0]=Ar-(Zr+Qe)+(Qe-Ft),Qe=(On=Ut-((Wr=Ut+Zr)-(Qe=Wr-Ut))+(Zr-Qe))-(Zr=On-an),y[1]=On-(Zr+Qe)+(Qe-an),Qe=(Mr=Wr+Zr)-Wr,y[2]=Wr-(Mr-Qe)+(Zr-Qe),y[3]=Mr;let Li=function(ia,X){let Ht=X[0];for(let or=1;or<ia;or++)Ht+=X[or];return Ht}(4,y),ci=c*ze;if(Li>=ci||-Li>=ci||(Be=pe-(mn+(Qe=pe-mn))+(Qe-Se),it=ie-(Nn+(Qe=ie-Nn))+(Qe-Se),$e=ue-(Xn+(Qe=ue-Xn))+(Qe-Ne),mt=xe-(qn+(Qe=xe-qn))+(Qe-Ne),Be===0&&$e===0&&it===0&&mt===0)||(ci=h*ze+i*Math.abs(Li),(Li+=mn*mt+qn*Be-(Xn*it+Nn*$e))>=ci||-Li>=ci))return Li;Qe=(Ar=(er=Be-(gt=(rt=134217729*Be)-(rt-Be)))*(qt=qn-(zt=(rt=134217729*qn)-(rt-qn)))-((Ut=Be*qn)-gt*zt-er*zt-gt*qt))-(Zr=Ar-(Ft=(er=$e-(gt=(rt=134217729*$e)-(rt-$e)))*(qt=Nn-(zt=(rt=134217729*Nn)-(rt-Nn)))-((an=$e*Nn)-gt*zt-er*zt-gt*qt))),I[0]=Ar-(Zr+Qe)+(Qe-Ft),Qe=(On=Ut-((Wr=Ut+Zr)-(Qe=Wr-Ut))+(Zr-Qe))-(Zr=On-an),I[1]=On-(Zr+Qe)+(Qe-an),Qe=(Mr=Wr+Zr)-Wr,I[2]=Wr-(Mr-Qe)+(Zr-Qe),I[3]=Mr;const Ai=o(4,y,4,I,x);Qe=(Ar=(er=mn-(gt=(rt=134217729*mn)-(rt-mn)))*(qt=mt-(zt=(rt=134217729*mt)-(rt-mt)))-((Ut=mn*mt)-gt*zt-er*zt-gt*qt))-(Zr=Ar-(Ft=(er=Xn-(gt=(rt=134217729*Xn)-(rt-Xn)))*(qt=it-(zt=(rt=134217729*it)-(rt-it)))-((an=Xn*it)-gt*zt-er*zt-gt*qt))),I[0]=Ar-(Zr+Qe)+(Qe-Ft),Qe=(On=Ut-((Wr=Ut+Zr)-(Qe=Wr-Ut))+(Zr-Qe))-(Zr=On-an),I[1]=On-(Zr+Qe)+(Qe-an),Qe=(Mr=Wr+Zr)-Wr,I[2]=Wr-(Mr-Qe)+(Zr-Qe),I[3]=Mr;const Vi=o(Ai,x,4,I,E);Qe=(Ar=(er=Be-(gt=(rt=134217729*Be)-(rt-Be)))*(qt=mt-(zt=(rt=134217729*mt)-(rt-mt)))-((Ut=Be*mt)-gt*zt-er*zt-gt*qt))-(Zr=Ar-(Ft=(er=$e-(gt=(rt=134217729*$e)-(rt-$e)))*(qt=it-(zt=(rt=134217729*it)-(rt-it)))-((an=$e*it)-gt*zt-er*zt-gt*qt))),I[0]=Ar-(Zr+Qe)+(Qe-Ft),Qe=(On=Ut-((Wr=Ut+Zr)-(Qe=Wr-Ut))+(Zr-Qe))-(Zr=On-an),I[1]=On-(Zr+Qe)+(Qe-an),Qe=(Mr=Wr+Zr)-Wr,I[2]=Wr-(Mr-Qe)+(Zr-Qe),I[3]=Mr;const za=o(Vi,E,4,I,T);return T[za-1]}(k,D,V,O,F,N,ee)},r.orient2dfast=function(k,D,V,O,F,N){return(D-N)*(V-F)-(k-F)*(O-N)},Object.defineProperty(r,"__esModule",{value:!0})})})(eE,eE.exports);var zee=eE.exports,Q4=Ree,N1=Dee,Uee=Bee,Vee=zee.orient2d;N1.default&&(N1=N1.default);ZS.exports=aO;ZS.exports.default=aO;function aO(e,t,r){t=Math.max(0,t===void 0?2:t),r=r||0;var n=Wee(e),i=new Q4(16);i.toBBox=function(O){return{minX:O[0],minY:O[1],maxX:O[0],maxY:O[1]}},i.compareMinX=function(O,F){return O[0]-F[0]},i.compareMinY=function(O,F){return O[1]-F[1]},i.load(e);for(var o=[],a=0,u;a<n.length;a++){var c=n[a];i.remove(c),u=t5(c,u),o.push(u)}var h=new Q4(16);for(a=0;a<o.length;a++)h.insert(M2(o[a]));for(var y=t*t,x=r*r;o.length;){var E=o.shift(),T=E.p,I=E.next.p,k=P2(T,I);if(!(k<x)){var D=k/y;c=jee(i,E.prev.p,T,I,E.next.next.p,D,h),c&&Math.min(P2(c,T),P2(c,I))<=D&&(o.push(E),o.push(t5(c,E)),i.remove(c),h.remove(E),h.insert(M2(E)),h.insert(M2(E.next)))}}E=u;var V=[];do V.push(E.p),E=E.next;while(E!==u);return V.push(E.p),V}function jee(e,t,r,n,i,o,a){for(var u=new N1([],$ee),c=e.data;c;){for(var h=0;h<c.children.length;h++){var y=c.children[h],x=c.leaf?I2(y,r,n):Gee(r,n,y);x>o||u.push({node:y,dist:x})}for(;u.length&&!u.peek().node.children;){var E=u.pop(),T=E.node,I=I2(T,t,r),k=I2(T,n,i);if(E.dist<I&&E.dist<k&&e5(r,T,a)&&e5(n,T,a))return T}c=u.pop(),c&&(c=c.node)}return null}function $ee(e,t){return e.dist-t.dist}function Gee(e,t,r){if(J4(e,r)||J4(t,r))return 0;var n=_1(e[0],e[1],t[0],t[1],r.minX,r.minY,r.maxX,r.minY);if(n===0)return 0;var i=_1(e[0],e[1],t[0],t[1],r.minX,r.minY,r.minX,r.maxY);if(i===0)return 0;var o=_1(e[0],e[1],t[0],t[1],r.maxX,r.minY,r.maxX,r.maxY);if(o===0)return 0;var a=_1(e[0],e[1],t[0],t[1],r.minX,r.maxY,r.maxX,r.maxY);return a===0?0:Math.min(n,i,o,a)}function J4(e,t){return e[0]>=t.minX&&e[0]<=t.maxX&&e[1]>=t.minY&&e[1]<=t.maxY}function e5(e,t,r){for(var n=Math.min(e[0],t[0]),i=Math.min(e[1],t[1]),o=Math.max(e[0],t[0]),a=Math.max(e[1],t[1]),u=r.search({minX:n,minY:i,maxX:o,maxY:a}),c=0;c<u.length;c++)if(Hee(u[c].p,u[c].next.p,e,t))return!1;return!0}function N0(e,t,r){return Vee(e[0],e[1],t[0],t[1],r[0],r[1])}function Hee(e,t,r,n){return e!==n&&t!==r&&N0(e,t,r)>0!=N0(e,t,n)>0&&N0(r,n,e)>0!=N0(r,n,t)>0}function M2(e){var t=e.p,r=e.next.p;return e.minX=Math.min(t[0],r[0]),e.minY=Math.min(t[1],r[1]),e.maxX=Math.max(t[0],r[0]),e.maxY=Math.max(t[1],r[1]),e}function Wee(e){for(var t=e[0],r=e[0],n=e[0],i=e[0],o=0;o<e.length;o++){var a=e[o];a[0]<t[0]&&(t=a),a[0]>n[0]&&(n=a),a[1]<r[1]&&(r=a),a[1]>i[1]&&(i=a)}var u=[t,r,n,i],c=u.slice();for(o=0;o<e.length;o++)Uee(e[o],u)||c.push(e[o]);return Yee(c)}function t5(e,t){var r={p:e,prev:null,next:null,minX:0,minY:0,maxX:0,maxY:0};return t?(r.next=t.next,r.prev=t,t.next.prev=r,t.next=r):(r.prev=r,r.next=r),r}function P2(e,t){var r=e[0]-t[0],n=e[1]-t[1];return r*r+n*n}function I2(e,t,r){var n=t[0],i=t[1],o=r[0]-n,a=r[1]-i;if(o!==0||a!==0){var u=((e[0]-n)*o+(e[1]-i)*a)/(o*o+a*a);u>1?(n=r[0],i=r[1]):u>0&&(n+=o*u,i+=a*u)}return o=e[0]-n,a=e[1]-i,o*o+a*a}function _1(e,t,r,n,i,o,a,u){var c=r-e,h=n-t,y=a-i,x=u-o,E=e-i,T=t-o,I=c*c+h*h,k=c*y+h*x,D=y*y+x*x,V=c*E+h*T,O=y*E+x*T,F=I*D-k*k,N,H,q,Y,ee=F,pe=F;F===0?(H=0,ee=1,Y=O,pe=D):(H=k*O-D*V,Y=I*O-k*V,H<0?(H=0,Y=O,pe=D):H>ee&&(H=ee,Y=O+k,pe=D)),Y<0?(Y=0,-V<0?H=0:-V>I?H=ee:(H=-V,ee=I)):Y>pe&&(Y=pe,-V+k<0?H=0:-V+k>I?H=ee:(H=-V+k,ee=I)),N=H===0?0:H/ee,q=Y===0?0:Y/pe;var ue=(1-N)*e+N*r,ie=(1-N)*t+N*n,xe=(1-q)*i+q*a,Se=(1-q)*o+q*u,Ne=xe-ue,ze=Se-ie;return Ne*Ne+ze*ze}function Xee(e,t){return e[0]===t[0]?e[1]-t[1]:e[0]-t[0]}function Yee(e){e.sort(Xee);for(var t=[],r=0;r<e.length;r++){for(;t.length>=2&&N0(t[t.length-2],t[t.length-1],e[r])<=0;)t.pop();t.push(e[r])}for(var n=[],i=e.length-1;i>=0;i--){for(;n.length>=2&&N0(n[n.length-2],n[n.length-1],e[i])<=0;)n.pop();n.push(e[i])}return n.pop(),t.pop(),t.concat(n)}var qee=ZS.exports;const Zee=jc(qee);function Kee(e,t){t===void 0&&(t={}),t.concavity=t.concavity||1/0;var r=[];if(Nd(e,function(i){r.push([i[0],i[1]])}),!r.length)return null;var n=Zee(r,t.concavity);return n.length>3?Um([n]):null}function Ev(e,t,r){r===void 0&&(r={});var n=$0(e),i=$0(t),o=Jf(i[1]-n[1]),a=Jf(i[0]-n[0]),u=Jf(n[1]),c=Jf(i[1]),h=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(a/2),2)*Math.cos(u)*Math.cos(c);return PE(2*Math.atan2(Math.sqrt(h),Math.sqrt(1-h)),r.units)}function tE(e,t,r,n){n===void 0&&(n={});var i=$0(e),o=Jf(i[0]),a=Jf(i[1]),u=Jf(r),c=Rx(t,n.units),h=Math.asin(Math.sin(a)*Math.cos(c)+Math.cos(a)*Math.sin(c)*Math.cos(u)),y=o+Math.atan2(Math.sin(u)*Math.sin(c)*Math.cos(a),Math.cos(c)-Math.sin(a)*Math.sin(h)),x=ky(y),E=ky(h);return fs([x,E],n.properties)}function KS(e,t,r){if(r===void 0&&(r={}),r.final===!0)return Qee(e,t);var n=$0(e),i=$0(t),o=Jf(n[0]),a=Jf(i[0]),u=Jf(n[1]),c=Jf(i[1]),h=Math.sin(a-o)*Math.cos(c),y=Math.cos(u)*Math.sin(c)-Math.sin(u)*Math.cos(c)*Math.cos(a-o);return ky(Math.atan2(h,y))}function Qee(e,t){var r=KS(t,e);return r=(r+180)%360,r}function oO(e,t){t===void 0&&(t={});var r=By(e),n=(r[0]+r[2])/2,i=(r[1]+r[3])/2;return fs([n,i],t.properties,t)}function r5(e,t){t===void 0&&(t={});var r=0,n=0,i=0;return Nd(e,function(o){r+=o[0],n+=o[1],i++},!0),fs([r/i,n/i],t.properties)}function sO(e,t){switch(t===void 0&&(t={}),tI(e)){case"Point":return fs($0(e),t.properties);case"Polygon":var r=[];Nd(e,function(N){r.push(N)});var n=r5(e,{properties:t.properties}),i=n.geometry.coordinates,o=0,a=0,u=0,c,h,y,x,E,T,I,k,D=r.map(function(N){return[N[0]-i[0],N[1]-i[1]]});for(c=0;c<r.length-1;c++)h=D[c],x=h[0],T=h[1],y=D[c+1],E=y[0],I=y[1],k=x*I-E*T,u+=k,o+=(x+E)*k,a+=(T+I)*k;if(u===0)return n;var V=u*.5,O=1/(6*V);return fs([i[0]+O*o,i[1]+O*a],t.properties);default:var F=Kee(e);return F?sO(F,{properties:t.properties}):r5(e,{properties:t.properties})}}function n5(e){if(!e)throw new Error("geojson is required");var t=[];return Dv(e,function(r){Jee(r,t)}),Qo(t)}function Jee(e,t){var r=[],n=e.geometry;if(n!==null){switch(n.type){case"Polygon":r=Od(n);break;case"LineString":r=[Od(n)]}r.forEach(function(i){var o=ete(i,e.properties);o.forEach(function(a){a.id=t.length,t.push(a)})})}}function ete(e,t){var r=[];return e.reduce(function(n,i){var o=yl([n,i],t);return o.bbox=tte(n,i),r.push(o),i}),r}function tte(e,t){var r=e[0],n=e[1],i=t[0],o=t[1],a=r<i?r:i,u=n<o?n:o,c=r>i?r:i,h=n>o?n:o;return[a,u,c,h]}var QS={exports:{}},uO={exports:{}};(function(e,t){(function(r,n){e.exports=n()})(mf,function(){function r(O,F,N,H,q){(function Y(ee,pe,ue,ie,xe){for(;ie>ue;){if(ie-ue>600){var Se=ie-ue+1,Ne=pe-ue+1,ze=Math.log(Se),Be=.5*Math.exp(2*ze/3),$e=.5*Math.sqrt(ze*Be*(Se-Be)/Se)*(Ne-Se/2<0?-1:1),it=Math.max(ue,Math.floor(pe-Ne*Be/Se+$e)),mt=Math.min(ie,Math.floor(pe+(Se-Ne)*Be/Se+$e));Y(ee,pe,it,mt,xe)}var Qe=ee[pe],rt=ue,gt=ie;for(n(ee,ue,pe),xe(ee[ie],Qe)>0&&n(ee,ue,ie);rt<gt;){for(n(ee,rt,gt),rt++,gt--;xe(ee[rt],Qe)<0;)rt++;for(;xe(ee[gt],Qe)>0;)gt--}xe(ee[ue],Qe)===0?n(ee,ue,gt):n(ee,++gt,ie),gt<=pe&&(ue=gt+1),pe<=gt&&(ie=gt-1)}})(O,F,N||0,H||O.length-1,q||i)}function n(O,F,N){var H=O[F];O[F]=O[N],O[N]=H}function i(O,F){return O<F?-1:O>F?1:0}var o=function(O){O===void 0&&(O=9),this._maxEntries=Math.max(4,O),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function a(O,F,N){if(!N)return F.indexOf(O);for(var H=0;H<F.length;H++)if(N(O,F[H]))return H;return-1}function u(O,F){c(O,0,O.children.length,F,O)}function c(O,F,N,H,q){q||(q=D(null)),q.minX=1/0,q.minY=1/0,q.maxX=-1/0,q.maxY=-1/0;for(var Y=F;Y<N;Y++){var ee=O.children[Y];h(q,O.leaf?H(ee):ee)}return q}function h(O,F){return O.minX=Math.min(O.minX,F.minX),O.minY=Math.min(O.minY,F.minY),O.maxX=Math.max(O.maxX,F.maxX),O.maxY=Math.max(O.maxY,F.maxY),O}function y(O,F){return O.minX-F.minX}function x(O,F){return O.minY-F.minY}function E(O){return(O.maxX-O.minX)*(O.maxY-O.minY)}function T(O){return O.maxX-O.minX+(O.maxY-O.minY)}function I(O,F){return O.minX<=F.minX&&O.minY<=F.minY&&F.maxX<=O.maxX&&F.maxY<=O.maxY}function k(O,F){return F.minX<=O.maxX&&F.minY<=O.maxY&&F.maxX>=O.minX&&F.maxY>=O.minY}function D(O){return{children:O,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function V(O,F,N,H,q){for(var Y=[F,N];Y.length;)if(!((N=Y.pop())-(F=Y.pop())<=H)){var ee=F+Math.ceil((N-F)/H/2)*H;r(O,ee,F,N,q),Y.push(F,ee,ee,N)}}return o.prototype.all=function(){return this._all(this.data,[])},o.prototype.search=function(O){var F=this.data,N=[];if(!k(O,F))return N;for(var H=this.toBBox,q=[];F;){for(var Y=0;Y<F.children.length;Y++){var ee=F.children[Y],pe=F.leaf?H(ee):ee;k(O,pe)&&(F.leaf?N.push(ee):I(O,pe)?this._all(ee,N):q.push(ee))}F=q.pop()}return N},o.prototype.collides=function(O){var F=this.data;if(!k(O,F))return!1;for(var N=[];F;){for(var H=0;H<F.children.length;H++){var q=F.children[H],Y=F.leaf?this.toBBox(q):q;if(k(O,Y)){if(F.leaf||I(O,Y))return!0;N.push(q)}}F=N.pop()}return!1},o.prototype.load=function(O){if(!O||!O.length)return this;if(O.length<this._minEntries){for(var F=0;F<O.length;F++)this.insert(O[F]);return this}var N=this._build(O.slice(),0,O.length-1,0);if(this.data.children.length)if(this.data.height===N.height)this._splitRoot(this.data,N);else{if(this.data.height<N.height){var H=this.data;this.data=N,N=H}this._insert(N,this.data.height-N.height-1,!0)}else this.data=N;return this},o.prototype.insert=function(O){return O&&this._insert(O,this.data.height-1),this},o.prototype.clear=function(){return this.data=D([]),this},o.prototype.remove=function(O,F){if(!O)return this;for(var N,H,q,Y=this.data,ee=this.toBBox(O),pe=[],ue=[];Y||pe.length;){if(Y||(Y=pe.pop(),H=pe[pe.length-1],N=ue.pop(),q=!0),Y.leaf){var ie=a(O,Y.children,F);if(ie!==-1)return Y.children.splice(ie,1),pe.push(Y),this._condense(pe),this}q||Y.leaf||!I(Y,ee)?H?(N++,Y=H.children[N],q=!1):Y=null:(pe.push(Y),ue.push(N),N=0,H=Y,Y=Y.children[0])}return this},o.prototype.toBBox=function(O){return O},o.prototype.compareMinX=function(O,F){return O.minX-F.minX},o.prototype.compareMinY=function(O,F){return O.minY-F.minY},o.prototype.toJSON=function(){return this.data},o.prototype.fromJSON=function(O){return this.data=O,this},o.prototype._all=function(O,F){for(var N=[];O;)O.leaf?F.push.apply(F,O.children):N.push.apply(N,O.children),O=N.pop();return F},o.prototype._build=function(O,F,N,H){var q,Y=N-F+1,ee=this._maxEntries;if(Y<=ee)return u(q=D(O.slice(F,N+1)),this.toBBox),q;H||(H=Math.ceil(Math.log(Y)/Math.log(ee)),ee=Math.ceil(Y/Math.pow(ee,H-1))),(q=D([])).leaf=!1,q.height=H;var pe=Math.ceil(Y/ee),ue=pe*Math.ceil(Math.sqrt(ee));V(O,F,N,ue,this.compareMinX);for(var ie=F;ie<=N;ie+=ue){var xe=Math.min(ie+ue-1,N);V(O,ie,xe,pe,this.compareMinY);for(var Se=ie;Se<=xe;Se+=pe){var Ne=Math.min(Se+pe-1,xe);q.children.push(this._build(O,Se,Ne,H-1))}}return u(q,this.toBBox),q},o.prototype._chooseSubtree=function(O,F,N,H){for(;H.push(F),!F.leaf&&H.length-1!==N;){for(var q=1/0,Y=1/0,ee=void 0,pe=0;pe<F.children.length;pe++){var ue=F.children[pe],ie=E(ue),xe=(Se=O,Ne=ue,(Math.max(Ne.maxX,Se.maxX)-Math.min(Ne.minX,Se.minX))*(Math.max(Ne.maxY,Se.maxY)-Math.min(Ne.minY,Se.minY))-ie);xe<Y?(Y=xe,q=ie<q?ie:q,ee=ue):xe===Y&&ie<q&&(q=ie,ee=ue)}F=ee||F.children[0]}var Se,Ne;return F},o.prototype._insert=function(O,F,N){var H=N?O:this.toBBox(O),q=[],Y=this._chooseSubtree(H,this.data,F,q);for(Y.children.push(O),h(Y,H);F>=0&&q[F].children.length>this._maxEntries;)this._split(q,F),F--;this._adjustParentBBoxes(H,q,F)},o.prototype._split=function(O,F){var N=O[F],H=N.children.length,q=this._minEntries;this._chooseSplitAxis(N,q,H);var Y=this._chooseSplitIndex(N,q,H),ee=D(N.children.splice(Y,N.children.length-Y));ee.height=N.height,ee.leaf=N.leaf,u(N,this.toBBox),u(ee,this.toBBox),F?O[F-1].children.push(ee):this._splitRoot(N,ee)},o.prototype._splitRoot=function(O,F){this.data=D([O,F]),this.data.height=O.height+1,this.data.leaf=!1,u(this.data,this.toBBox)},o.prototype._chooseSplitIndex=function(O,F,N){for(var H,q,Y,ee,pe,ue,ie,xe=1/0,Se=1/0,Ne=F;Ne<=N-F;Ne++){var ze=c(O,0,Ne,this.toBBox),Be=c(O,Ne,N,this.toBBox),$e=(q=ze,Y=Be,ee=void 0,pe=void 0,ue=void 0,ie=void 0,ee=Math.max(q.minX,Y.minX),pe=Math.max(q.minY,Y.minY),ue=Math.min(q.maxX,Y.maxX),ie=Math.min(q.maxY,Y.maxY),Math.max(0,ue-ee)*Math.max(0,ie-pe)),it=E(ze)+E(Be);$e<xe?(xe=$e,H=Ne,Se=it<Se?it:Se):$e===xe&&it<Se&&(Se=it,H=Ne)}return H||N-F},o.prototype._chooseSplitAxis=function(O,F,N){var H=O.leaf?this.compareMinX:y,q=O.leaf?this.compareMinY:x;this._allDistMargin(O,F,N,H)<this._allDistMargin(O,F,N,q)&&O.children.sort(H)},o.prototype._allDistMargin=function(O,F,N,H){O.children.sort(H);for(var q=this.toBBox,Y=c(O,0,F,q),ee=c(O,N-F,N,q),pe=T(Y)+T(ee),ue=F;ue<N-F;ue++){var ie=O.children[ue];h(Y,O.leaf?q(ie):ie),pe+=T(Y)}for(var xe=N-F-1;xe>=F;xe--){var Se=O.children[xe];h(ee,O.leaf?q(Se):Se),pe+=T(ee)}return pe},o.prototype._adjustParentBBoxes=function(O,F,N){for(var H=N;H>=0;H--)h(F[H],O)},o.prototype._condense=function(O){for(var F=O.length-1,N=void 0;F>=0;F--)O[F].children.length===0?F>0?(N=O[F-1].children).splice(N.indexOf(O[F]),1):this.clear():u(O[F],this.toBBox)},o})})(uO);var rte=uO.exports;const nte=v_(g6),ite=v_(A6),ate=v_(LF);var Ip=rte,lO=nte,cO=ite,M0=ate.default,ote=cO.featureEach;cO.coordEach;lO.polygon;var i5=lO.featureCollection;function fO(e){var t=new Ip(e);return t.insert=function(r){if(r.type!=="Feature")throw new Error("invalid feature");return r.bbox=r.bbox?r.bbox:M0(r),Ip.prototype.insert.call(this,r)},t.load=function(r){var n=[];return Array.isArray(r)?r.forEach(function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:M0(i),n.push(i)}):ote(r,function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:M0(i),n.push(i)}),Ip.prototype.load.call(this,n)},t.remove=function(r,n){if(r.type!=="Feature")throw new Error("invalid feature");return r.bbox=r.bbox?r.bbox:M0(r),Ip.prototype.remove.call(this,r,n)},t.clear=function(){return Ip.prototype.clear.call(this)},t.search=function(r){var n=Ip.prototype.search.call(this,this.toBBox(r));return i5(n)},t.collides=function(r){return Ip.prototype.collides.call(this,this.toBBox(r))},t.all=function(){var r=Ip.prototype.all.call(this);return i5(r)},t.toJSON=function(){return Ip.prototype.toJSON.call(this)},t.fromJSON=function(r){return Ip.prototype.fromJSON.call(this,r)},t.toBBox=function(r){var n;if(r.bbox)n=r.bbox;else if(Array.isArray(r)&&r.length===4)n=r;else if(Array.isArray(r)&&r.length===6)n=[r[0],r[1],r[3],r[4]];else if(r.type==="Feature")n=M0(r);else if(r.type==="FeatureCollection")n=M0(r);else throw new Error("invalid geojson");return{minX:n[0],minY:n[1],maxX:n[2],maxY:n[3]}},t}QS.exports=fO;QS.exports.default=fO;var ste=QS.exports;const ute=jc(ste);function lte(e,t){var r={},n=[];if(e.type==="LineString"&&(e=nh(e)),t.type==="LineString"&&(t=nh(t)),e.type==="Feature"&&t.type==="Feature"&&e.geometry!==null&&t.geometry!==null&&e.geometry.type==="LineString"&&t.geometry.type==="LineString"&&e.geometry.coordinates.length===2&&t.geometry.coordinates.length===2){var i=a5(e,t);return i&&n.push(i),Qo(n)}var o=ute();return o.load(n5(t)),V1(n5(e),function(a){V1(o.search(a),function(u){var c=a5(a,u);if(c){var h=Od(c).join(",");r[h]||(r[h]=!0,n.push(c))}})}),Qo(n)}function a5(e,t){var r=Od(e),n=Od(t);if(r.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(n.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var i=r[0][0],o=r[0][1],a=r[1][0],u=r[1][1],c=n[0][0],h=n[0][1],y=n[1][0],x=n[1][1],E=(x-h)*(a-i)-(y-c)*(u-o),T=(y-c)*(o-h)-(x-h)*(i-c),I=(a-i)*(o-h)-(u-o)*(i-c);if(E===0)return null;var k=T/E,D=I/E;if(k>=0&&k<=1&&D>=0&&D<=1){var V=i+k*(a-i),O=o+k*(u-o);return fs([V,O])}return null}function cte(e,t,r){r===void 0&&(r={});var n=fs([1/0,1/0],{dist:1/0}),i=0;return Dv(e,function(o){for(var a=Od(o),u=0;u<a.length-1;u++){var c=fs(a[u]);c.properties.dist=Ev(t,c,r);var h=fs(a[u+1]);h.properties.dist=Ev(t,h,r);var y=Ev(c,h,r),x=Math.max(c.properties.dist,h.properties.dist),E=KS(c,h),T=tE(t,x,E+90,r),I=tE(t,x,E-90,r),k=lte(yl([T.geometry.coordinates,I.geometry.coordinates]),yl([c.geometry.coordinates,h.geometry.coordinates])),D=null;k.features.length>0&&(D=k.features[0],D.properties.dist=Ev(t,D,r),D.properties.location=i+Ev(c,D,r)),c.properties.dist<n.properties.dist&&(n=c,n.properties.index=u,n.properties.location=i),h.properties.dist<n.properties.dist&&(n=h,n.properties.index=u+1,n.properties.location=i+y),D&&D.properties.dist<n.properties.dist&&(n=D,n.properties.index=u),i+=y}}),n}var o5=6378137;function fte(e){return nI(e,function(t,r){return t+hte(r)},0)}function hte(e){var t=0,r;switch(e.type){case"Polygon":return s5(e.coordinates);case"MultiPolygon":for(r=0;r<e.coordinates.length;r++)t+=s5(e.coordinates[r]);return t;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0}return 0}function s5(e){var t=0;if(e&&e.length>0){t+=Math.abs(u5(e[0]));for(var r=1;r<e.length;r++)t-=Math.abs(u5(e[r]))}return t}function u5(e){var t,r,n,i,o,a,u,c=0,h=e.length;if(h>2){for(u=0;u<h;u++)u===h-2?(i=h-2,o=h-1,a=0):u===h-1?(i=h-1,o=0,a=1):(i=u,o=u+1,a=u+2),t=e[i],r=e[o],n=e[a],c+=(R2(n[0])-R2(t[0]))*Math.sin(R2(r[1]));c=c*o5*o5/2}return c}function R2(e){return e*Math.PI/180}function pte(e,t,r){r===void 0&&(r={});for(var n=G0(e),i=n.coordinates,o=0,a=0;a<i.length&&!(t>=o&&a===i.length-1);a++)if(o>=t){var u=t-o;if(u){var c=KS(i[a],i[a-1])-180,h=tE(i[a],u,c,r);return h}else return fs(i[a])}else o+=Ev(i[a],i[a+1],r);return fs(i[i.length-1])}function hO(e,t){return t===void 0&&(t={}),aI(e,function(r,n){var i=n.geometry.coordinates;return r+Ev(i[0],i[1],t)},0)}function dte(e,t){t===void 0&&(t={});var r=G0(e);switch(!t.properties&&e.type==="Feature"&&(t.properties=e.properties),r.type){case"Polygon":return vte(r,t);case"MultiPolygon":return mte(r,t);default:throw new Error("invalid poly")}}function vte(e,t){t===void 0&&(t={});var r=G0(e),n=r.coordinates,i=t.properties?t.properties:e.type==="Feature"?e.properties:{};return pO(n,i)}function mte(e,t){t===void 0&&(t={});var r=G0(e),n=r.coordinates,i=t.properties?t.properties:e.type==="Feature"?e.properties:{},o=[];return n.forEach(function(a){o.push(pO(a,i))}),Qo(o)}function pO(e,t){return e.length>1?CE(e,t):yl(e[0],t)}function gte(e){for(var t=Od(e),r=0,n=1,i,o;n<t.length;)i=o||t[0],o=t[n],r+=(o[0]-i[0])*(o[1]+i[1]),n++;return r>0}function sg(e){"@babel/helpers - typeof";return sg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},sg(e)}function yte(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l5(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,xte(n.key),n)}}function _te(e,t,r){return t&&l5(e.prototype,t),r&&l5(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function xte(e){var t=bte(e,"string");return sg(t)==="symbol"?t:String(t)}function bte(e,t){if(sg(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(sg(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function wte(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&rE(e,t)}function rE(e,t){return rE=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},rE(e,t)}function Ete(e){var t=Tte();return function(){var n=yx(e),i;if(t){var o=yx(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return Ste(this,i)}}function Ste(e,t){if(t&&(sg(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Ate(e)}function Ate(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Tte(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function yx(e){return yx=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},yx(e)}var Pg=function(e){wte(r,e);var t=Ete(r);function r(n,i){var o,a=i.style;return yte(this,r),o=t.call(this),o.scene=void 0,o.style=void 0,o.layers=void 0,o.data=[],o.scene=n,o.style=a,o.layers=o.initLayers(),o.layers.forEach(function(u){n.addLayer(u)}),a.callback instanceof Function&&a.callback(o.layers),o}return _te(r,[{key:"getLayers",value:function(){return this.layers}},{key:"show",value:function(){this.layers.forEach(function(i){i.show()})}},{key:"hide",value:function(){this.layers.forEach(function(i){i.hide()})}},{key:"setData",value:function(i){this.data=i;var o=Qo(i);this.layers.forEach(function(a){a.setData(o)})}},{key:"destroy",value:function(){var i=this;this.layers.forEach(function(o){i.scene.removeLayer(o)})}}]),r}(tc.EventEmitter);function ug(e){"@babel/helpers - typeof";return ug=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ug(e)}function Cte(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c5(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Pte(n.key),n)}}function Mte(e,t,r){return t&&c5(e.prototype,t),r&&c5(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function Pte(e){var t=Ite(e,"string");return ug(t)==="symbol"?t:String(t)}function Ite(e,t){if(ug(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(ug(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Rte(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&nE(e,t)}function nE(e,t){return nE=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},nE(e,t)}function Lte(e){var t=Dte();return function(){var n=_x(e),i;if(t){var o=_x(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return kte(this,i)}}function kte(e,t){if(t&&(ug(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Ote(e)}function Ote(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Dte(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function _x(e){return _x=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},_x(e)}var Fte=function(e){Rte(r,e);var t=Lte(r);function r(){return Cte(this,r),t.apply(this,arguments)}return Mte(r,[{key:"initLayers",value:function(){var i=this.style,o=i.normal,a=i.style,u=i.options,c=new x_(u??{}).source(Qo([])).size(o.size).color(o.color).shape("line").style(a);return[c]}}]),r}(Pg);function lg(e){"@babel/helpers - typeof";return lg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},lg(e)}function Nte(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f5(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,zte(n.key),n)}}function Bte(e,t,r){return t&&f5(e.prototype,t),r&&f5(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function zte(e){var t=Ute(e,"string");return lg(t)==="symbol"?t:String(t)}function Ute(e,t){if(lg(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(lg(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Vte(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&iE(e,t)}function iE(e,t){return iE=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},iE(e,t)}function jte(e){var t=Hte();return function(){var n=xx(e),i;if(t){var o=xx(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return $te(this,i)}}function $te(e,t){if(t&&(lg(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Gte(e)}function Gte(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Hte(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function xx(e){return xx=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},xx(e)}var Wte=function(e){Vte(r,e);var t=jte(r);function r(){var n;Nte(this,r);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return n=t.call.apply(t,[this].concat(o)),n.onMouseMove=function(u){n.emit(li.Mousemove,u)},n.onMouseOut=function(u){n.emit(li.Mouseout,u)},n.onMouseDown=function(u){n.emit(li.Dragstart,u)},n.onDragging=function(u){n.emit(li.Dragging,u)},n.onDragEnd=Er.debounce(function(u){n.emit(li.Dragend,u)},0),n.onUnClick=function(u){n.emit(li.UnClick,u)},n.enableHover=function(){var u,c;n.disableHover(),(u=n.layers[0])===null||u===void 0||u.on(Ta.Mousemove,n.onMouseMove),(c=n.layers[0])===null||c===void 0||c.on(Ta.Mouseout,n.onMouseOut)},n.disableHover=function(){var u,c;(u=n.layers[0])===null||u===void 0||u.off(Ta.Mousemove,n.onMouseMove),(c=n.layers[0])===null||c===void 0||c.off(Ta.Mouseout,n.onMouseOut)},n}return Bte(r,[{key:"initLayers",value:function(){var i=this.style,o=i.normal,a=i.hover,u=i.active,c=i.style,h=i.options,y=new x_(h??{}).source(Qo([])).size("isHover*isActive",function(x,E){return E?u.size:x?a.size:o.size}).color("isHover*isActive",function(x,E){return E?u.color:x?a.color:o.color}).shape("line").style(c);return[y]}},{key:"enableDrag",value:function(){this.disableDrag(),this.layers[0].on(Ta.Mousedown,this.onMouseDown),this.scene.on(ma.Dragging,this.onDragging),this.scene.on(ma.Mouseup,this.onDragEnd),this.scene.on(ma.Dragend,this.onDragEnd)}},{key:"disableDrag",value:function(){this.layers[0].off(Ta.Mousedown,this.onMouseDown),this.scene.off(ma.Dragging,this.onDragging),this.scene.off(ma.Mouseup,this.onDragEnd),this.scene.off(ma.Dragend,this.onDragEnd)}},{key:"enableUnClick",value:function(){this.disableUnClick(),this.layers[0].on(Ta.UnClick,this.onUnClick)}},{key:"disableUnClick",value:function(){this.layers[0].off(Ta.UnClick,this.onUnClick)}}]),r}(Pg);function cg(e){"@babel/helpers - typeof";return cg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},cg(e)}function h5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function Xte(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?h5(Object(r),!0).forEach(function(n){Yte(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):h5(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Yte(e,t,r){return t=dO(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function qte(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function p5(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,dO(n.key),n)}}function Zte(e,t,r){return t&&p5(e.prototype,t),r&&p5(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function dO(e){var t=Kte(e,"string");return cg(t)==="symbol"?t:String(t)}function Kte(e,t){if(cg(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(cg(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Qte(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&aE(e,t)}function aE(e,t){return aE=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},aE(e,t)}function Jte(e){var t=rre();return function(){var n=bx(e),i;if(t){var o=bx(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return ere(this,i)}}function ere(e,t){if(t&&(cg(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return tre(e)}function tre(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function rre(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function bx(e){return bx=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},bx(e)}var nre=function(e){Qte(r,e);var t=Jte(r);function r(){var n;qte(this,r);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return n=t.call.apply(t,[this].concat(o)),n.onMouseMove=function(u){n.emit(li.Mousemove,u)},n.onMouseOut=function(u){n.emit(li.Mouseout,u)},n.onMouseDown=function(u){n.emit(li.Click,u)},n}return Zte(r,[{key:"initLayers",value:function(){var i=this.style,o=i.normal,a=i.style,u=i.options,c=o.shape,h=o.size,y=o.color,x=o.stroke,E=new Fm(u??{}).source(Qo([])).size(h).color(y).shape(c).style(Xte({stroke:x},a));return[E]}},{key:"enableClick",value:function(){this.disableClick(),this.layers[0].on(Ta.Mousedown,this.onMouseDown)}},{key:"disableClick",value:function(){this.layers[0].off(Ta.Mousedown,this.onMouseDown)}},{key:"enableHover",value:function(){var i,o;this.disableHover(),(i=this.layers[0])===null||i===void 0||i.on(Ta.Mousemove,this.onMouseMove),(o=this.layers[0])===null||o===void 0||o.on(Ta.Mouseout,this.onMouseOut)}},{key:"disableHover",value:function(){var i,o;(i=this.layers[0])===null||i===void 0||i.off(Ta.Mousemove,this.onMouseMove),(o=this.layers[0])===null||o===void 0||o.off(Ta.Mouseout,this.onMouseOut)}}]),r}(Pg);function fg(e){"@babel/helpers - typeof";return fg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},fg(e)}function d5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function ire(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?d5(Object(r),!0).forEach(function(n){are(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d5(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function are(e,t,r){return t=vO(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ore(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function v5(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,vO(n.key),n)}}function sre(e,t,r){return t&&v5(e.prototype,t),r&&v5(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function vO(e){var t=ure(e,"string");return fg(t)==="symbol"?t:String(t)}function ure(e,t){if(fg(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(fg(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function lre(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&oE(e,t)}function oE(e,t){return oE=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},oE(e,t)}function cre(e){var t=pre();return function(){var n=Ex(e),i;if(t){var o=Ex(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return fre(this,i)}}function fre(e,t){if(t&&(fg(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return hre(e)}function hre(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function pre(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Ex(e){return Ex=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Ex(e)}var dre=function(e){lre(r,e);var t=cre(r);function r(){var n;ore(this,r);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return n=t.call.apply(t,[this].concat(o)),n.onCreate=function(u){n.emit(li.UnClick,u)},n.onMouseMove=function(u){n.emit(li.Mousemove,u)},n.onMouseOut=function(u){n.emit(li.Mouseout,u)},n.onMouseDown=function(u){n.emit(li.Dragstart,u)},n.onDragging=function(u){n.emit(li.Dragging,u)},n.onDragEnd=Er.debounce(function(u){n.emit(li.Dragend,u)},0),n.onClick=function(u){n.emit(li.Click,u)},n.onContextmenu=function(u){n.emit(li.Contextmenu,u)},n}return sre(r,[{key:"initLayers",value:function(){var i=this.style,o=i.normal,a=i.hover,u=i.active,c=i.style,h=i.options,y=new Fm(h??{}).source(Qo([])).size("isHover*isActive",function(x,E){return E?u.size:x?a.size:o.size}).color("isHover*isActive",function(x,E){return E?u.color:x?a.color:o.color}).shape("isHover*isActive",function(x,E){return E?u.shape:x?a.shape:o.shape}).style(ire({stroke:["isHover*isActive",function(x,E){return E?u.stroke:x?a.stroke:o.stroke}]},c));return[y]}},{key:"enableCreate",value:function(){this.disableCreate(),this.layers[0].on(Ta.UnClick,this.onCreate)}},{key:"disableCreate",value:function(){this.layers[0].off(Ta.UnClick,this.onCreate)}},{key:"enableHover",value:function(){var i,o;this.disableHover(),(i=this.layers[0])===null||i===void 0||i.on(Ta.Mousemove,this.onMouseMove),(o=this.layers[0])===null||o===void 0||o.on(Ta.Mouseout,this.onMouseOut)}},{key:"disableHover",value:function(){var i,o;(i=this.layers[0])===null||i===void 0||i.off(Ta.Mousemove,this.onMouseMove),(o=this.layers[0])===null||o===void 0||o.off(Ta.Mouseout,this.onMouseOut)}},{key:"enableDrag",value:function(){this.disableDrag(),this.layers[0].on(Ta.Mousedown,this.onMouseDown),this.scene.on(ma.Dragging,this.onDragging),this.scene.on(ma.Mouseup,this.onDragEnd),this.scene.on(ma.Dragend,this.onDragEnd)}},{key:"disableDrag",value:function(){this.layers[0].off(Ta.Mousedown,this.onMouseDown),this.scene.off(ma.Dragging,this.onDragging),this.scene.off(ma.Mouseup,this.onDragEnd),this.scene.off(ma.Dragend,this.onDragEnd)}},{key:"enableClick",value:function(){this.disableClick(),this.layers[0].on(Ta.Click,this.onClick)}},{key:"disableClick",value:function(){this.layers[0].off(Ta.Click,this.onClick)}},{key:"enableContextMenu",value:function(){this.disableContextMenu(),this.layers[0].on(Ta.Contextmenu,this.onContextmenu)}},{key:"disableContextMenu",value:function(){this.layers[0].off(Ta.Contextmenu,this.onContextmenu)}}]),r}(Pg);function hg(e){"@babel/helpers - typeof";return hg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},hg(e)}function vre(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function m5(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,gre(n.key),n)}}function mre(e,t,r){return t&&m5(e.prototype,t),r&&m5(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function gre(e){var t=yre(e,"string");return hg(t)==="symbol"?t:String(t)}function yre(e,t){if(hg(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(hg(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function _re(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&sE(e,t)}function sE(e,t){return sE=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},sE(e,t)}function xre(e){var t=Ere();return function(){var n=Sx(e),i;if(t){var o=Sx(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return bre(this,i)}}function bre(e,t){if(t&&(hg(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return wre(e)}function wre(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ere(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Sx(e){return Sx=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Sx(e)}var Sre=function(e){_re(r,e);var t=xre(r);function r(){var n;vre(this,r);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return n=t.call.apply(t,[this].concat(o)),n.onMouseMove=function(u){n.emit(li.Mousemove,u)},n.onMouseOut=function(u){n.emit(li.Mouseout,u)},n.onMouseDown=function(u){n.emit(li.Dragstart,u)},n.onDragging=function(u){n.emit(li.Dragging,u)},n.onDragEnd=Er.debounce(function(u){n.emit(li.Dragend,u)},0),n.onUnClick=function(u){n.emit(li.UnClick,u)},n.enableHover=function(){var u,c;n.disableHover(),(u=n.layers[0])===null||u===void 0||u.on(Ta.Mousemove,n.onMouseMove),(c=n.layers[0])===null||c===void 0||c.on(Ta.Mouseout,n.onMouseOut)},n.disableHover=function(){var u,c;(u=n.layers[0])===null||u===void 0||u.off(Ta.Mousemove,n.onMouseMove),(c=n.layers[0])===null||c===void 0||c.off(Ta.Mouseout,n.onMouseOut)},n}return mre(r,[{key:"initLayers",value:function(){var i=this.style,o=i.normal,a=i.hover,u=i.active,c=i.style,h=i.options,y=new Xx(h??{});return y.source(Qo([])).color("isHover*isActive",function(x,E){return E?u.color:x?a.color:o.color}).style(c),[y]}},{key:"enableDrag",value:function(){this.disableDrag(),this.layers[0].on(Ta.Mousedown,this.onMouseDown),this.scene.on(ma.Dragging,this.onDragging),this.scene.on(ma.Mouseup,this.onDragEnd),this.scene.on(ma.Dragend,this.onDragEnd)}},{key:"disableDrag",value:function(){this.layers[0].off(Ta.Mousedown,this.onMouseDown),this.scene.off(ma.Dragging,this.onDragging),this.scene.off(ma.Mouseup,this.onDragEnd),this.scene.off(ma.Dragend,this.onDragEnd)}},{key:"enableUnClick",value:function(){this.disableUnClick(),this.layers[0].on(Ta.UnClick,this.onUnClick)}},{key:"disableUnClick",value:function(){this.layers[0].off(Ta.UnClick,this.onUnClick)}}]),r}(Pg);function pg(e){"@babel/helpers - typeof";return pg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},pg(e)}function Are(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function g5(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Cre(n.key),n)}}function Tre(e,t,r){return t&&g5(e.prototype,t),r&&g5(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function Cre(e){var t=Mre(e,"string");return pg(t)==="symbol"?t:String(t)}function Mre(e,t){if(pg(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(pg(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Pre(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&uE(e,t)}function uE(e,t){return uE=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},uE(e,t)}function Ire(e){var t=kre();return function(){var n=Ax(e),i;if(t){var o=Ax(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return Rre(this,i)}}function Rre(e,t){if(t&&(pg(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Lre(e)}function Lre(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function kre(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Ax(e){return Ax=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Ax(e)}var Ore=function(e){Pre(r,e);var t=Ire(r);function r(n){var i;return Are(this,r),i=t.call(this),i.scene=void 0,i.previousClick=void 0,i.onDblClick=function(o){var a,u,c=(a=(u=o.pixel)!==null&&u!==void 0?u:o.point)!==null&&a!==void 0?a:{},h=c.x,y=h===void 0?0:h,x=c.y,E=x===void 0?0:x,T=Date.now();if(i.previousClick){var I=i.previousClick,k=I.x,D=I.y,V=I.time;T-V<300&&Math.abs(y-k)<5&&Math.abs(E-D)<5&&i.emit(li.DblClick,o)}i.previousClick={x:y,y:E,time:T}},i.onMouseMove=function(o){i.emit(li.Mousemove,o)},i.onMouseDown=function(o){i.emit(li.Dragstart,o)},i.onDragging=function(o){i.emit(li.Dragging,o)},i.onDragEnd=Er.debounce(function(o){i.emit(li.Dragend,o)},0),i.scene=n,i}return Tre(r,[{key:"enableDrag",value:function(){this.disableDrag(),this.scene.on(ma.Mousedown,this.onMouseDown),this.scene.on(ma.Dragging,this.onDragging),this.scene.on(ma.Mouseup,this.onDragEnd),this.scene.on(ma.Dragend,this.onDragEnd)}},{key:"disableDrag",value:function(){this.scene.off(ma.Mousedown,this.onMouseDown),this.scene.off(ma.Dragging,this.onDragging),this.scene.off(ma.Mouseup,this.onDragEnd),this.scene.off(ma.Dragend,this.onDragEnd)}},{key:"enableMouseMove",value:function(){this.disableMouseMove(),this.scene.on(ma.Mousemove,this.onMouseMove)}},{key:"disableMouseMove",value:function(){this.scene.off(ma.Mousemove,this.onMouseMove)}},{key:"enableDblClick",value:function(){this.disableDblClick(),this.scene.on(ma.Mousedown,this.onDblClick)}},{key:"disableDblClick",value:function(){this.scene.off(ma.Mousedown,this.onDblClick)}}]),r}(Cg);function dg(e){"@babel/helpers - typeof";return dg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},dg(e)}function y5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function Dre(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?y5(Object(r),!0).forEach(function(n){Fre(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):y5(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Fre(e,t,r){return t=mO(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Nre(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _5(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,mO(n.key),n)}}function Bre(e,t,r){return t&&_5(e.prototype,t),r&&_5(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function mO(e){var t=zre(e,"string");return dg(t)==="symbol"?t:String(t)}function zre(e,t){if(dg(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(dg(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Ure(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&lE(e,t)}function lE(e,t){return lE=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},lE(e,t)}function Vre(e){var t=Gre();return function(){var n=Tx(e),i;if(t){var o=Tx(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return jre(this,i)}}function jre(e,t){if(t&&(dg(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return $re(e)}function $re(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Gre(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Tx(e){return Tx=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Tx(e)}var Hre=function(e){Ure(r,e);var t=Vre(r);function r(){return Nre(this,r),t.apply(this,arguments)}return Bre(r,[{key:"initLayers",value:function(){var i=this.style,o=i.normal,a=i.active,u=i.style,c=i.options,h=new Fm(c??{}).source(Qo([])).size("isActive",function(y){return y?a.size:o.size}).color("isActive",function(y){return y?a.color:o.color}).shape("text","text").style(Dre({stroke:["isActive",function(y){return y?a.stroke:o.stroke}]},u));return[h]}}]),r}(Pg),Wre={point:dre,line:Wte,dashLine:Fte,midPoint:nre,text:Hre,polygon:Sre};function s_(e){"@babel/helpers - typeof";return s_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s_(e)}function x5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function Np(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?x5(Object(r),!0).forEach(function(n){Xre(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):x5(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Xre(e,t,r){return t=Yre(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Yre(e){var t=qre(e,"string");return s_(t)==="symbol"?t:String(t)}function qre(e,t){if(s_(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(s_(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var B0="#1990FF",Mm="#ED9D48",Sm={blend:"normal",pickingBuffer:5},L2={color:B0,shape:"circle",size:6,stroke:"#ffffff"},k2={color:Mm,shape:"circle",size:6,stroke:"#ffffff"},Zre={shape:"circle",size:6,color:Mm,stroke:"#ffffff"};Np(Np({},L2),{},{size:8}),Np(Np({},L2),{},{size:8,color:Mm});var Kre={options:Sm,normal:k2,hover:Np(Np({},k2),{},{size:8}),active:Np(Np({},k2),{},{size:8}),style:{strokeWidth:2}},O2={color:B0,size:12,stroke:"#ffffff"},Qre={point:Kre,line:{options:Sm,normal:{color:B0,size:2},hover:{color:B0,size:2},active:{color:Mm,size:2},style:{}},polygon:{options:Sm,normal:{color:B0},hover:{color:B0},active:{color:Mm},style:{opacity:.15}},midPoint:{options:Sm,normal:Zre},dashLine:{options:Sm,normal:{color:Mm,size:2},style:{lineType:"dash",dashArray:[6,6]}},text:{options:Sm,normal:O2,active:Np(Np({},O2),{},{color:Mm}),style:{fontWeight:"800",textOffset:[0,O2.size+6],textAllowOverlap:!0,strokeWidth:2}}},gO={exports:{}};(function(e){(function(t,r,n){if(!t)return;for(var i={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},o={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},a={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},u={option:"alt",command:"meta",return:"enter",escape:"esc",plus:"+",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},c,h=1;h<20;++h)i[111+h]="f"+h;for(h=0;h<=9;++h)i[h+96]=h.toString();function y(Y,ee,pe){if(Y.addEventListener){Y.addEventListener(ee,pe,!1);return}Y.attachEvent("on"+ee,pe)}function x(Y){if(Y.type=="keypress"){var ee=String.fromCharCode(Y.which);return Y.shiftKey||(ee=ee.toLowerCase()),ee}return i[Y.which]?i[Y.which]:o[Y.which]?o[Y.which]:String.fromCharCode(Y.which).toLowerCase()}function E(Y,ee){return Y.sort().join(",")===ee.sort().join(",")}function T(Y){var ee=[];return Y.shiftKey&&ee.push("shift"),Y.altKey&&ee.push("alt"),Y.ctrlKey&&ee.push("ctrl"),Y.metaKey&&ee.push("meta"),ee}function I(Y){if(Y.preventDefault){Y.preventDefault();return}Y.returnValue=!1}function k(Y){if(Y.stopPropagation){Y.stopPropagation();return}Y.cancelBubble=!0}function D(Y){return Y=="shift"||Y=="ctrl"||Y=="alt"||Y=="meta"}function V(){if(!c){c={};for(var Y in i)Y>95&&Y<112||i.hasOwnProperty(Y)&&(c[i[Y]]=Y)}return c}function O(Y,ee,pe){return pe||(pe=V()[Y]?"keydown":"keypress"),pe=="keypress"&&ee.length&&(pe="keydown"),pe}function F(Y){return Y==="+"?["+"]:(Y=Y.replace(/\+{2}/g,"+plus"),Y.split("+"))}function N(Y,ee){var pe,ue,ie,xe=[];for(pe=F(Y),ie=0;ie<pe.length;++ie)ue=pe[ie],u[ue]&&(ue=u[ue]),ee&&ee!="keypress"&&a[ue]&&(ue=a[ue],xe.push("shift")),D(ue)&&xe.push(ue);return ee=O(ue,xe,ee),{key:ue,modifiers:xe,action:ee}}function H(Y,ee){return Y===null||Y===r?!1:Y===ee?!0:H(Y.parentNode,ee)}function q(Y){var ee=this;if(Y=Y||r,!(ee instanceof q))return new q(Y);ee.target=Y,ee._callbacks={},ee._directMap={};var pe={},ue,ie=!1,xe=!1,Se=!1;function Ne(rt){rt=rt||{};var gt=!1,er;for(er in pe){if(rt[er]){gt=!0;continue}pe[er]=0}gt||(Se=!1)}function ze(rt,gt,er,zt,qt,Zr){var Wr,On,Ut=[],Ar=er.type;if(!ee._callbacks[rt])return[];for(Ar=="keyup"&&D(rt)&&(gt=[rt]),Wr=0;Wr<ee._callbacks[rt].length;++Wr)if(On=ee._callbacks[rt][Wr],!(!zt&&On.seq&&pe[On.seq]!=On.level)&&Ar==On.action&&(Ar=="keypress"&&!er.metaKey&&!er.ctrlKey||E(gt,On.modifiers))){var an=!zt&&On.combo==qt,Ft=zt&&On.seq==zt&&On.level==Zr;(an||Ft)&&ee._callbacks[rt].splice(Wr,1),Ut.push(On)}return Ut}function Be(rt,gt,er,zt){ee.stopCallback(gt,gt.target||gt.srcElement,er,zt)||rt(gt,er)===!1&&(I(gt),k(gt))}ee._handleKey=function(rt,gt,er){var zt=ze(rt,gt,er),qt,Zr={},Wr=0,On=!1;for(qt=0;qt<zt.length;++qt)zt[qt].seq&&(Wr=Math.max(Wr,zt[qt].level));for(qt=0;qt<zt.length;++qt){if(zt[qt].seq){if(zt[qt].level!=Wr)continue;On=!0,Zr[zt[qt].seq]=1,Be(zt[qt].callback,er,zt[qt].combo,zt[qt].seq);continue}On||Be(zt[qt].callback,er,zt[qt].combo)}var Ut=er.type=="keypress"&&xe;er.type==Se&&!D(rt)&&!Ut&&Ne(Zr),xe=On&&er.type=="keydown"};function $e(rt){typeof rt.which!="number"&&(rt.which=rt.keyCode);var gt=x(rt);if(gt){if(rt.type=="keyup"&&ie===gt){ie=!1;return}ee.handleKey(gt,T(rt),rt)}}function it(){clearTimeout(ue),ue=setTimeout(Ne,1e3)}function mt(rt,gt,er,zt){pe[rt]=0;function qt(Ar){return function(){Se=Ar,++pe[rt],it()}}function Zr(Ar){Be(er,Ar,rt),zt!=="keyup"&&(ie=x(Ar)),setTimeout(Ne,10)}for(var Wr=0;Wr<gt.length;++Wr){var On=Wr+1===gt.length,Ut=On?Zr:qt(zt||N(gt[Wr+1]).action);Qe(gt[Wr],Ut,zt,rt,Wr)}}function Qe(rt,gt,er,zt,qt){ee._directMap[rt+":"+er]=gt,rt=rt.replace(/\s+/g," ");var Zr=rt.split(" "),Wr;if(Zr.length>1){mt(rt,Zr,gt,er);return}Wr=N(rt,er),ee._callbacks[Wr.key]=ee._callbacks[Wr.key]||[],ze(Wr.key,Wr.modifiers,{type:Wr.action},zt,rt,qt),ee._callbacks[Wr.key][zt?"unshift":"push"]({callback:gt,modifiers:Wr.modifiers,action:Wr.action,seq:zt,level:qt,combo:rt})}ee._bindMultiple=function(rt,gt,er){for(var zt=0;zt<rt.length;++zt)Qe(rt[zt],gt,er)},y(Y,"keypress",$e),y(Y,"keydown",$e),y(Y,"keyup",$e)}q.prototype.bind=function(Y,ee,pe){var ue=this;return Y=Y instanceof Array?Y:[Y],ue._bindMultiple.call(ue,Y,ee,pe),ue},q.prototype.unbind=function(Y,ee){var pe=this;return pe.bind.call(pe,Y,function(){},ee)},q.prototype.trigger=function(Y,ee){var pe=this;return pe._directMap[Y+":"+ee]&&pe._directMap[Y+":"+ee]({},Y),pe},q.prototype.reset=function(){var Y=this;return Y._callbacks={},Y._directMap={},Y},q.prototype.stopCallback=function(Y,ee){var pe=this;if((" "+ee.className+" ").indexOf(" mousetrap ")>-1||H(ee,pe.target))return!1;if("composedPath"in Y&&typeof Y.composedPath=="function"){var ue=Y.composedPath()[0];ue!==Y.target&&(ee=ue)}return ee.tagName=="INPUT"||ee.tagName=="SELECT"||ee.tagName=="TEXTAREA"||ee.isContentEditable},q.prototype.handleKey=function(){var Y=this;return Y._handleKey.apply(Y,arguments)},q.addKeycodes=function(Y){for(var ee in Y)Y.hasOwnProperty(ee)&&(i[ee]=Y[ee]);c=null},q.init=function(){var Y=q(r);for(var ee in Y)ee.charAt(0)!=="_"&&(q[ee]=function(pe){return function(){return Y[pe].apply(Y,arguments)}}(ee))},q.init(),t.Mousetrap=q,e.exports&&(e.exports=q),typeof n=="function"&&n.amd&&n(function(){return q})})(typeof window<"u"?window:null,typeof window<"u"?document:null)})(gO);var Jre=gO.exports;const P0=jc(Jre);function u_(e){"@babel/helpers - typeof";return u_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u_(e)}function ene(e){return ine(e)||nne(e)||rne(e)||tne()}function tne(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function rne(e,t){if(e){if(typeof e=="string")return cE(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return cE(e,t)}}function nne(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function ine(e){if(Array.isArray(e))return cE(e)}function cE(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function b5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function vg(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?b5(Object(r),!0).forEach(function(n){ane(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):b5(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function ane(e,t,r){return t=one(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function one(e){var t=sne(e,"string");return u_(t)==="symbol"?t:String(t)}function sne(e,t){if(u_(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(u_(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var zm=function(){var e=1;return function(t){return"".concat(t,"-").concat(e++)}}(),ju=function(t,r){var n,i;return!!(t&&r&&((n=t.properties)===null||n===void 0?void 0:n.id)===((i=r.properties)===null||i===void 0?void 0:i.id))},Hh=function(t){var r=t.target,n=t.data,i=t.targetHandler,o=t.otherHandler;return n.map(function(a,u){var c,h=ju(a,r)?i:o;return(c=h==null?void 0:h(a,u))!==null&&c!==void 0?c:a})},une=function(){return{id:zm("point"),isHover:!1,isActive:!1,isDrag:!1,createTime:Date.now()}},lne=function(){return{id:zm("line"),isHover:!1,isActive:!1,isDrag:!1,isDraw:!1,createTime:Date.now()}},yO=function(){return{id:zm("polygon"),isHover:!1,isActive:!1,isDrag:!1,isDraw:!1,createTime:Date.now()}},l_=function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return fs(t,vg(vg({},une()),r))},_O=function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return{type:"Feature",properties:vg(vg({},lne()),{},{nodes:t},r),geometry:{type:"LineString",coordinates:jp(Qo(t))}}},D2=function(t){return yl(t,{id:zm("dashLine")})},cne=function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return{type:"Feature",properties:vg(vg({},yO()),{},{nodes:t},r),geometry:{type:"Polygon",coordinates:[jp(Qo([].concat(ene(t),[Er.first(t)])))]}}};function c_(e){"@babel/helpers - typeof";return c_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},c_(e)}function w5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function fE(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?w5(Object(r),!0).forEach(function(n){fne(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):w5(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function fne(e,t,r){return t=hne(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function hne(e){var t=pne(e,"string");return c_(t)==="symbol"?t:String(t)}function pne(e,t){if(c_(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(c_(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var dne=function(t){var r=hO(t,{units:"meters"});return pte(t,r/2,{units:"meters"})},F2=function(t,r){var n=r.showTotalDistance,i=r.format,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a=[];if(n){var u=dne(t),c=hO(t,{units:"meters"});u.properties=fE({id:zm("text"),isActive:!1,meters:c,text:i(c),type:"totalDistance"},o),a.push(u)}else for(var h=t.geometry.coordinates,y=0;y<h.length-1;y++){var x=fs(h[y]),E=fs(h[y+1]),T=Ev(x,E,{units:"meters"}),I=oO(Qo([x,E]));I.properties=fE({id:zm("text"),isActive:!1,meters:T,text:i(T),type:"distance"},o),a.push(I)}return a},E5=function(t,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=r.format,o=fte(t);return sO(t,{properties:fE({meters:o,text:i(o),type:"area",isActive:!1},n)})},xO=function(t){var r,n,i=t.getContainer();return(r=(n=i==null?void 0:i.querySelector(".l7-marker-container"))!==null&&n!==void 0?n:i==null?void 0:i.querySelector(".amap-maps"))!==null&&r!==void 0?r:null},mg=function(t){return t.lngLat||t.lnglat},Ly=function(t){var r=mg(t),n=r.lng,i=r.lat;return[n,i]},hE=function(t){var r=t.lng,n=t.lat;return[r,n]},bO=function(t){for(var r=Number.MAX_SAFE_INTEGER,n=0,i=t.length,o=0;o<i;o++)t[o]<r&&(r=t[o],n=o);return n},vne=function(t,r){var n=[],i=[];return t.forEach(function(o){Er.isEqual(o,r)?i.length&&(n.push(i),i=[]):i.push(o)}),i.length&&n.push(i),n};function Cx(e,t){return yne(e)||gne(e,t)||wO(e,t)||mne()}function mne(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function gne(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,i,o,a,u=[],c=!0,h=!1;try{if(o=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(u.push(n.value),u.length!==t);c=!0);}catch(y){h=!0,i=y}finally{try{if(!c&&r.return!=null&&(a=r.return(),Object(a)!==a))return}finally{if(h)throw i}}return u}}function yne(e){if(Array.isArray(e))return e}function _ne(e){return wne(e)||bne(e)||wO(e)||xne()}function xne(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function wO(e,t){if(e){if(typeof e=="string")return pE(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return pE(e,t)}}function bne(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function wne(e){if(Array.isArray(e))return pE(e)}function pE(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Ene=function(t,r,n){var i=[],o=[],a=[];return t==="drawData"?i=r.getData():t instanceof Function?i=t(n):i=t,i.length&&(o=i.map(function(u){var c,h=(c=u.properties)!==null&&c!==void 0?c:{},y=h.nodes,x=y===void 0?[]:y,E=h.isActive,T=E===void 0?!1:E;return T?x.filter(function(I){return!Er.isEqual(I.geometry.coordinates,n)}):x}).flat().filter(function(u){return u}),o.length||(o=jp(Qo(i)).map(function(u){return fs(u)})),a=i.map(function(u){var c,h,y=(c=u.properties)===null||c===void 0?void 0:c.line;if(!((h=u.properties)===null||h===void 0)&&h.isActive&&y){var x=y.properties.nodes,E=vne(x.map(function(T){return T.geometry.coordinates}),n).filter(function(T){return T.length>1});return E.map(function(T){return yl(T)})}return[y]}).flat().filter(function(u){return u}),a.length||i.forEach(function(u){var c=tI(u);if(/linestring/i.test(c)&&a.push(u),/polygon/i.test(c)){var h,y,x=dte(u);return(h=a).push.apply(h,_ne((y=x==null?void 0:x.features)!==null&&y!==void 0?y:[x]))}})),{points:o,lines:a}},Sne=function(t,r,n,i){var o=n.pointAdsorbPixel,a=Cx(t,2),u=a[0],c=a[1],h=i.lngLatToPixel([u,c]),y=h.x,x=h.y,E=r.map(function(k){var D=Cx(k.geometry.coordinates,2),V=D[0],O=D[1],F=i.lngLatToPixel([V,O]),N=F.x,H=F.y;return Math.pow(y-N,2)+Math.pow(x-H,2)}),T=bO(E),I=Math.pow(E[T],.5);return I<=o?r[T].geometry.coordinates:null},Ane=function(t,r,n,i){var o=n.lineAdsorbPixel,a=Cx(t,2),u=a[0],c=a[1],h=i.lngLatToPixel([u,c]),y=h.x,x=h.y,E=r.filter(function(D){return jp(D).length>1}).map(function(D){return cte(D,t)});if(!E.length)return null;var T=E.map(function(D){var V=Cx(D.geometry.coordinates,2),O=V[0],F=V[1],N=i.lngLatToPixel([O,F]),H=N.x,q=N.y;return Math.pow(y-H,2)+Math.pow(x-q,2)}),I=bO(T),k=Math.pow(T[I],.5);return k<=o?E[I].geometry.coordinates:null};function Tne(e,t){return Ine(e)||Pne(e,t)||Mne(e,t)||Cne()}function Cne(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Mne(e,t){if(e){if(typeof e=="string")return S5(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return S5(e,t)}}function S5(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Pne(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,i,o,a,u=[],c=!0,h=!1;try{if(o=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(u.push(n.value),u.length!==t);c=!0);}catch(y){h=!0,i=y}finally{try{if(!c&&r.return!=null&&(a=r.return(),Object(a)!==a))return}finally{if(h)throw i}}return u}}function Ine(e){if(Array.isArray(e))return e}var Rne=function(t,r){var n=Tne(r,2),i=n[0],o=n[1];t.lngLat&&(t.lngLat={lng:i,lat:o}),t.lnglat&&(t.lnglat={lng:i,lat:o})};function f_(e){"@babel/helpers - typeof";return f_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},f_(e)}function Lne(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function A5(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,One(n.key),n)}}function kne(e,t,r){return t&&A5(e.prototype,t),r&&A5(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function One(e){var t=Dne(e,"string");return f_(t)==="symbol"?t:String(t)}function Dne(e,t){if(f_(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(f_(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Fne=function(){function e(t,r){Lne(this,e),this.container=void 0,this.cursor=null,this.options=void 0,this.container=xO(t),this.options=r}return kne(e,[{key:"setCursor",value:function(r){r!==this.cursor&&this.container&&(this.container.style.cursor=r?this.options[r]:"",this.cursor=r)}},{key:"destroy",value:function(){this.setCursor(null)}}]),e}();function h_(e){"@babel/helpers - typeof";return h_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},h_(e)}function T5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function C5(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?T5(Object(r),!0).forEach(function(n){Nne(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):T5(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Nne(e,t,r){return t=EO(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Bne(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function M5(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,EO(n.key),n)}}function zne(e,t,r){return t&&M5(e.prototype,t),r&&M5(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function EO(e){var t=Une(e,"string");return h_(t)==="symbol"?t:String(t)}function Une(e,t){if(h_(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(h_(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Vne=function(){function e(t,r){var n=this;Bne(this,e),this.content="",this.tippy=void 0,this.scene=void 0,this.isMouseInner=!1,this.onMouseMove=function(){n.isMouseInner=!0,n.checkTippyShow()},this.onMouseOut=function(){n.isMouseInner=!1,n.checkTippyShow()},this.setContent=Er.debounce(function(i){n.content=i??"",n.tippy.setContent(i??""),n.checkTippyShow()},16,{maxWait:16}),this.tippy=C_(xO(t),C5(C5({},Pee),r)),this.tippy.hide(),this.scene=t,t.on(ma.Mousemove,this.onMouseMove),t.on(ma.Mouseout,this.onMouseOut)}return zne(e,[{key:"getContent",value:function(){return this.content}},{key:"checkTippyShow",value:function(){this.content&&this.isMouseInner?this.tippy.show():this.tippy.hide()}},{key:"destroy",value:function(){this.scene.off(ma.Mousemove,this.onMouseMove),this.scene.off(ma.Mouseout,this.onMouseOut),this.tippy.destroy()}}]),e}();function p_(e){"@babel/helpers - typeof";return p_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},p_(e)}function jne(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function P5(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Gne(n.key),n)}}function $ne(e,t,r){return t&&P5(e.prototype,t),r&&P5(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function Gne(e){var t=Hne(e,"string");return p_(t)==="symbol"?t:String(t)}function Hne(e,t){if(p_(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(p_(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Wne=function(){function e(t){var r=t.config;jne(this,e),this.historyList=[],this.historyIndex=0,this.config=void 0,this.config=r}return $ne(e,[{key:"save",value:function(r){if(this.config){var n=this.config.maxSize;this.historyIndex&&(this.historyList=this.historyList.slice(this.historyIndex),this.historyIndex=0),this.historyList.length>=n&&this.historyList.pop();var i=Er.cloneDeep(r);return this.historyList.unshift(i),i}}},{key:"revert",value:function(){if(!(!this.historyList.length||this.historyIndex>=this.historyList.length-1)){var r=this.historyList[++this.historyIndex];if(r)return Er.cloneDeep(r)}}},{key:"redo",value:function(){if(!(!this.historyList.length||this.historyIndex<=0)){var r=this.historyList[--this.historyIndex];if(r)return Er.cloneDeep(r)}}}]),e}();function gg(e){"@babel/helpers - typeof";return gg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},gg(e)}function Xne(e,t){return Zne(e)||qne(e,t)||SO(e,t)||Yne()}function Yne(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function qne(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,i,o,a,u=[],c=!0,h=!1;try{if(o=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(u.push(n.value),u.length!==t);c=!0);}catch(y){h=!0,i=y}finally{try{if(!c&&r.return!=null&&(a=r.return(),Object(a)!==a))return}finally{if(h)throw i}}return u}}function Zne(e){if(Array.isArray(e))return e}function Kne(e){return eie(e)||Jne(e)||SO(e)||Qne()}function Qne(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function SO(e,t){if(e){if(typeof e=="string")return dE(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return dE(e,t)}}function Jne(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function eie(e){if(Array.isArray(e))return dE(e)}function dE(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function I5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function x1(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?I5(Object(r),!0).forEach(function(n){AO(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):I5(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function AO(e,t,r){return t=TO(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function tie(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function R5(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,TO(n.key),n)}}function rie(e,t,r){return t&&R5(e.prototype,t),r&&R5(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function TO(e){var t=nie(e,"string");return gg(t)==="symbol"?t:String(t)}function nie(e,t){if(gg(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(gg(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function iie(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&vE(e,t)}function vE(e,t){return vE=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},vE(e,t)}function aie(e){var t=uie();return function(){var n=Mx(e),i;if(t){var o=Mx(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return oie(this,i)}}function oie(e,t){if(t&&(gg(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return sie(e)}function sie(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function uie(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Mx(e){return Mx=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Mx(e)}var lie=function(e){iie(r,e);var t=aie(r);function r(n){var i,o=n.data,a=n.render,u=n.history,c=n.scene;return tie(this,r),i=t.call(this),i.scene=void 0,i.render=void 0,i.data=Er.cloneDeep(YQ),i.timeout=null,i.diffData={},i.history=void 0,i.scene=c,i.render=a,u&&(i.history=new Wne({config:u})),o&&i.setData(o),i}return rie(r,[{key:"saveHistory",value:function(){var i;return(i=this.history)===null||i===void 0?void 0:i.save(this.data)}},{key:"revertHistory",value:function(){var i,o=(i=this.history)===null||i===void 0?void 0:i.revert();if(o)return this.setData(o),o}},{key:"redoHistory",value:function(){var i,o=(i=this.history)===null||i===void 0?void 0:i.redo();if(o)return this.setData(o),o}},{key:"setData",value:function(i){var o=this;return Object.keys(i).length&&(this.data=x1(x1({},this.data),i),this.diffData=x1(x1({},this.diffData),i),this.timeout||(this.timeout=requestAnimationFrame(function(){return o.updateDiffData()})),this.emit(j0.Change,{data:this.data})),this.data}},{key:"getData",value:function(){return this.data}},{key:"getRenderData",value:function(i){return this.data[i]}},{key:"setRenderData",value:function(i,o){var a=typeof o=="function"?o(this.getRenderData(i)):o;return this.setData(AO({},i,Kne(a).sort(function(u,c){return+u.properties.isActive-+c.properties.isActive}))),this.emit(j0.Change,this.data),a}},{key:"updateDiffData",value:function(){var i=this,o=Object.entries(this.diffData);o.length&&(o.forEach(function(a){var u=Xne(a,2),c=u[0],h=u[1];if(Array.isArray(h)){var y;(y=i.getRender(c))===null||y===void 0||y.setData(h)}}),this.emit(j0.Update,this.data,this.diffData),this.diffData={},this.timeout=null,requestAnimationFrame(function(){i.scene.render()}))}},{key:"getRender",value:function(i){return this.render[i]}},{key:"clear",value:function(){this.setData(Er.fromPairs(Object.keys(this.render).map(function(i){return[i,[]]})))}}]),r}(Cg);function yg(e){"@babel/helpers - typeof";return yg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},yg(e)}function cie(e,t){var r=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=CO(e))||t&&e&&typeof e.length=="number"){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(h){throw h},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,a=!1,u;return{s:function(){r=r.call(e)},n:function(){var h=r.next();return o=h.done,h},e:function(h){a=!0,u=h},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(a)throw u}}}}function fie(e,t){return die(e)||pie(e,t)||CO(e,t)||hie()}function hie(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function CO(e,t){if(e){if(typeof e=="string")return L5(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return L5(e,t)}}function L5(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function pie(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,i,o,a,u=[],c=!0,h=!1;try{if(o=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(u.push(n.value),u.length!==t);c=!0);}catch(y){h=!0,i=y}finally{try{if(!c&&r.return!=null&&(a=r.return(),Object(a)!==a))return}finally{if(h)throw i}}return u}}function die(e){if(Array.isArray(e))return e}function vie(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function k5(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,gie(n.key),n)}}function mie(e,t,r){return t&&k5(e.prototype,t),r&&k5(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function gie(e){var t=yie(e,"string");return yg(t)==="symbol"?t:String(t)}function yie(e,t){if(yg(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(yg(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function _ie(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&mE(e,t)}function mE(e,t){return mE=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},mE(e,t)}function xie(e){var t=wie();return function(){var n=Px(e),i;if(t){var o=Px(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return bie(this,i)}}function bie(e,t){if(t&&(yg(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return MO(e)}function MO(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function wie(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Px(e){return Px=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Px(e)}var Eie=function(e){_ie(r,e);var t=xie(r);function r(n,i){var o;vie(this,r),o=t.call(this),o.scene=void 0,o.source=void 0,o.render=void 0,o.cursor=void 0,o.options=void 0,o.enabled=!1,o.allowCreate=!1,o.sceneRender=void 0,o.mouseLngLat={lng:0,lat:0},o.popup=void 0,o.addCount=0,o.saveMouseLngLat=Er.debounce(function(h){o.mouseLngLat=mg(h)},100,{maxWait:100}),o.saveHistory=Er.debounce(function(){o.options.history&&o.source.saveHistory()},100),o.bindThis(),o.scene=n,o.sceneRender=new Ore(n),o.options=Er.merge({},o.getDefaultOptions(i),i),o.render=o.initRender(),o.source=new lie({render:o.render,history:o.options.history||void 0,scene:n}),o.cursor=new Fne(n,o.options.cursor);var a=o.options,u=a.initialData,c=a.popup;return u&&o.setData(u),c&&(o.popup=new Vne(n,c instanceof Object?c:{})),o.saveHistory(),o.bindCommonEvent(),o.emit(Ka.Init,MO(o)),o.bindEnableEvent(),o}return mie(r,[{key:"addable",get:function(){var i=this.getData(),o=this.options,a=o.multiple,u=o.maxCount,c=i.find(function(h){return h.properties.isDraw});return!this.enabled||!this.allowCreate?!1:a&&u<=0||c?!0:!(!a&&this.addCount>=1||u>0&&i.length>=u)}},{key:"getOptions",value:function(){return this.options}},{key:"getEditItem",value:function(){return this.editItem}},{key:"getDragItem",value:function(){return this.dragItem}},{key:"setHelper",value:function(i){var o,a,u=this.options.helper;if(u){var c=(o=i in u?u[i]:i)!==null&&o!==void 0?o:null;(a=this.popup)===null||a===void 0||a.setContent(c)}}},{key:"isEnable",value:function(){return this.enabled}},{key:"bindThis",value:function(){this.initRender=this.initRender.bind(this),this.getData=this.getData.bind(this),this.setData=this.setData.bind(this),this.emitChangeEvent=this.emitChangeEvent.bind(this),this.saveHistory=this.saveHistory.bind(this),this.onSceneMouseMove=this.onSceneMouseMove.bind(this),this.revertHistory=this.revertHistory.bind(this),this.redoHistory=this.redoHistory.bind(this),this.removeActiveFeature=this.removeActiveFeature.bind(this),this.bindCommonEvent=this.bindCommonEvent.bind(this),this.bindEnableEvent=this.bindEnableEvent.bind(this),this.unbindEnableEvent=this.unbindEnableEvent.bind(this),this.setActiveFeature=this.setActiveFeature.bind(this)}},{key:"bindCommonEvent",value:function(){var i=this;this.on(Ka.Add,this.emitChangeEvent),this.on(Ka.Add,function(){i.addCount++}),this.on(Ka.Edit,this.emitChangeEvent),this.on(Ka.Remove,this.emitChangeEvent),this.on(Ka.Clear,this.emitChangeEvent),this.on(Ka.AddNode,this.saveHistory),this.on(Ka.RemoveNode,this.emitChangeEvent),this.bindEmitSelectEvent(!0)}},{key:"bindEmitSelectEvent",value:function(){var i=this,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,a=null,u=function(){var h,y,x,E=i.getData().find(function(T){var I;return(I=T.properties)===null||I===void 0?void 0:I.isActive})||null;((h=a)===null||h===void 0||(y=h.properties)===null||y===void 0?void 0:y.id)!==(E==null||(x=E.properties)===null||x===void 0?void 0:x.id)&&(a=E,i.emit(Ka.Select,E))};this.source.on(j0.Change,u),o&&u()}},{key:"bindEnableEvent",value:function(){this.unbindKeyboardEvent(),this.scene.setMapStatus({doubleClickZoom:!1}),this.scene.on(ma.Mousemove,this.saveMouseLngLat),this.bindKeyboardEvent()}},{key:"unbindEnableEvent",value:function(){this.scene.setMapStatus({doubleClickZoom:!0}),this.scene.off(ma.Mousemove,this.saveMouseLngLat),this.unbindKeyboardEvent()}},{key:"bindKeyboardEvent",value:function(){var i=this,o=this.options.keyboard||{},a=o.revert,u=o.redo,c=o.remove;c&&P0.bind(c,function(){i.removeActiveFeature()}),this.options.history&&(a&&P0.bind(a,this.revertHistory),u&&P0.bind(u,this.redoHistory))}},{key:"unbindKeyboardEvent",value:function(){var i=this.options.keyboard||{},o=i.revert,a=i.redo,u=i.remove;u&&P0.unbind(u),this.options.history&&(o&&P0.unbind(o),a&&P0.unbind(a))}},{key:"emitChangeEvent",value:function(){this.emit(Ka.Change,this.getData()),this.saveHistory()}},{key:"revertHistory",value:function(){!this.enabled||!this.options.history||this.source.revertHistory()&&(this.correctDrawItem(),this.emit(Ka.Change,this.getData()))}},{key:"redoHistory",value:function(){!this.enabled||!this.options.history||this.source.redoHistory()&&(this.correctDrawItem(),this.emit(Ka.Change,this.getData()))}},{key:"getRenderLayers",value:function(){return Er.fromPairs(Er.toPairs(this.render).map(function(i){var o=fie(i,2),a=o[0],u=o[1];return[a,u.getLayers()]}))}},{key:"getTargetFeature",value:function(i){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.getData(),a=null;if(i){var u;if(a=(u=o.find(function(h){var y;return h.properties.id===(typeof i=="string"?i:(y=i.properties)===null||y===void 0?void 0:y.id)}))!==null&&u!==void 0?u:null,!a&&i instanceof Object){var c;a=(c=o.find(function(h){return Er.isEqual(i.geometry,h.geometry)}))!==null&&c!==void 0?c:null}}return a}},{key:"removeActiveFeature",value:function(){var i=this.getData().find(function(o){var a=o.properties,u=a.isActive,c=a.isDraw;return u||c});return i&&this.removeFeature(i),i}},{key:"removeFeature",value:function(i){var o=this.getData(),a=this.getTargetFeature(i);a&&(this.setData(o.filter(function(u){return!ju(a,u)})),this.emit(Ka.Remove,i,this.getData()))}},{key:"correctDrawItem",value:function(){var i=this.getData().find(function(o){return o.properties.isDraw});i&&this.onSceneMouseMove({type:"mousemove",lnglat:this.mouseLngLat,lngLat:this.mouseLngLat})}},{key:"initRender",value:function(){var i={},o=this.getRenderTypes(),a=cie(o),u;try{for(a.s();!(u=a.n()).done;){var c=u.value,h=Wre[c],y=this.options.style[c];i[c]=new h(this.scene,{style:y})}}catch(x){a.e(x)}finally{a.f()}return i}},{key:"getCommonOptions",value:function(i){return{initialData:[],autoActive:!0,cursor:Er.cloneDeep(XQ),editable:!0,style:Er.cloneDeep(Qre),multiple:!0,history:Er.cloneDeep(Cee),keyboard:Er.cloneDeep(Mee),popup:!0,helper:{},maxCount:-1}}},{key:"setCursor",value:function(i){this.cursor.setCursor(i)}},{key:"resetCursor",value:function(){this.setCursor(this.addable?"draw":null)}},{key:"enable",value:function(){var i=this,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.allowCreate=o,this.addCount=0,this.enabled=!0,this.bindEnableEvent(),this.resetCursor(),this.setHelper(this.addable?"draw":null),setTimeout(function(){i.emit(Ka.Enable,i)},0)}},{key:"disable",value:function(){var i=this;this.resetFeatures(),this.enabled=!1,this.setCursor(null),this.unbindEnableEvent(),this.addCount=0,this.setHelper(null),setTimeout(function(){i.emit(Ka.Disable,i)},0)}},{key:"clear",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;this.source.clear(),this.emit(Ka.Clear,this),i&&this.disable()}},{key:"show",value:function(){return Object.values(this.render).forEach(function(i){i.show()})}},{key:"hide",value:function(){return Object.values(this.render).forEach(function(i){i.hide()})}},{key:"destroy",value:function(){var i=this,o;Object.values(this.render).forEach(function(a){a.destroy()}),Object.values(li).forEach(function(a){Object.values(i.render).forEach(function(u){u.removeAllListeners(a)}),i.sceneRender.removeAllListeners(a)}),setTimeout(function(){Object.values(Ka).forEach(function(a){i.removeAllListeners(a)})},0),(o=this.popup)===null||o===void 0||o.destroy(),this.cursor.destroy(),this.emit(Ka.Destroy,this)}}]),r}(Cg);function _g(e){"@babel/helpers - typeof";return _g=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_g(e)}function O5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function mv(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?O5(Object(r),!0).forEach(function(n){Sie(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):O5(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Sie(e,t,r){return t=PO(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Aie(e){return Pie(e)||Mie(e)||Cie(e)||Tie()}function Tie(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Cie(e,t){if(e){if(typeof e=="string")return gE(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return gE(e,t)}}function Mie(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Pie(e){if(Array.isArray(e))return gE(e)}function gE(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Iie(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function D5(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,PO(n.key),n)}}function Rie(e,t,r){return t&&D5(e.prototype,t),r&&D5(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function PO(e){var t=Lie(e,"string");return _g(t)==="symbol"?t:String(t)}function Lie(e,t){if(_g(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(_g(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function kie(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&yE(e,t)}function yE(e,t){return yE=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},yE(e,t)}function Oie(e){var t=Nie();return function(){var n=Ix(e),i;if(t){var o=Ix(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return Die(this,i)}}function Die(e,t){if(t&&(_g(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Fie(e)}function Fie(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Nie(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Ix(e){return Ix=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Ix(e)}var Bie=function(e){kie(r,e);var t=Oie(r);function r(){return Iie(this,r),t.apply(this,arguments)}return Rie(r,[{key:"pointRender",get:function(){return this.render.point}},{key:"dragPoint",get:function(){return this.getPointData().find(function(i){return i.properties.isDrag})}},{key:"editPoint",get:function(){return this.getPointData().find(function(i){return i.properties.isActive})}},{key:"hoverPoint",get:function(){return this.getPointData().find(function(i){return i.properties.isHover})}},{key:"getDragPoint",value:function(){return this.dragPoint}},{key:"getEditPoint",value:function(){return this.editPoint}},{key:"getPointData",value:function(){return this.source.getRenderData("point")}},{key:"setPointData",value:function(i){return this.source.setRenderData("point",i)}},{key:"bindPointRenderEvent",value:function(){var i,o,a,u,c,h;(i=this.pointRender)===null||i===void 0||i.on(li.UnClick,this.onPointCreate.bind(this)),(o=this.pointRender)===null||o===void 0||o.on(li.Mousemove,this.onPointMouseMove.bind(this)),(a=this.pointRender)===null||a===void 0||a.on(li.Mouseout,this.onPointMouseOut.bind(this)),(u=this.pointRender)===null||u===void 0||u.on(li.Dragstart,this.onPointDragStart.bind(this)),(c=this.pointRender)===null||c===void 0||c.on(li.Dragging,this.onPointDragging.bind(this)),(h=this.pointRender)===null||h===void 0||h.on(li.Dragend,this.onPointDragEnd.bind(this))}},{key:"handleCreatePoint",value:function(i){var o=this.options,a=o.autoActive,u=o.editable,c=l_(i);return this.setPointData(function(h){return Hh({target:c,data:[].concat(Aie(h),[c]),targetHandler:function(x){x.properties=mv(mv({},x.properties),{},{isHover:u,isActive:a&&u})},otherHandler:function(x){x.properties=mv(mv({},x.properties),{},{isHover:!1,isActive:!1,isDrag:!1})}})}),c}},{key:"handlePointHover",value:function(i){return this.setCursor("pointHover"),ju(i,this.hoverPoint)||this.setPointData(function(o){return Hh({target:i,data:o,targetHandler:function(u){u.properties.isHover=!0},otherHandler:function(u){u.properties.isHover=!1}})}),i}},{key:"handlePointUnHover",value:function(i){return this.resetCursor(),this.setPointData(function(o){return o.map(function(a){return a.properties.isHover=!1,a})}),i}},{key:"handlePointDragStart",value:function(i){return this.setPointData(function(o){return Hh({target:i,data:o,targetHandler:function(u){u.properties=mv(mv({},u.properties),{},{isDrag:!0,isActive:!0})},otherHandler:function(u){u.properties=mv(mv({},u.properties),{},{isDrag:!1,isActive:!1})}})}),this.scene.setMapStatus({dragEnable:!1}),this.setCursor("pointDrag"),i}},{key:"handlePointDragging",value:function(i,o){return this.setPointData(function(a){return Hh({target:i,data:a,targetHandler:function(c){c.geometry.coordinates=hE(o)}})}),this.scene.setMapStatus({dragEnable:!1}),this.setCursor("pointDrag"),i}},{key:"handlePointDragEnd",value:function(i){return this.setPointData(function(o){return Hh({target:i,data:o,targetHandler:function(u){u.properties.isDrag=!1}})}),this.scene.setMapStatus({dragEnable:!0}),this.setCursor("pointHover"),i}},{key:"onPointCreate",value:function(i){return this.handleCreatePoint(hE(mg(i)))}},{key:"onPointMouseMove",value:function(i){return this.handlePointHover(i.feature)}},{key:"onPointMouseOut",value:function(i){return this.handlePointUnHover(i.feature)}},{key:"onPointDragStart",value:function(i){if(this.options.editable)return this.handlePointDragStart(i.feature)}},{key:"onPointDragging",value:function(i){var o=this.dragPoint;if(!(!this.options.editable||!o))return this.handlePointDragging(o,mg(i))}},{key:"onPointDragEnd",value:function(i){var o=this.dragPoint;if(!(!this.options.editable||!o))return this.handlePointDragEnd(o)}},{key:"enablePointRenderAction",value:function(){var i,o=this.options.editable;if(this.enabled){var a;(a=this.pointRender)===null||a===void 0||a.enableCreate()}if((i=this.pointRender)===null||i===void 0||i.enableClick(),o){var u,c;(u=this.pointRender)===null||u===void 0||u.enableHover(),(c=this.pointRender)===null||c===void 0||c.enableDrag()}}},{key:"disablePointRenderAction",value:function(){var i,o,a,u;(i=this.pointRender)===null||i===void 0||i.disableCreate(),(o=this.pointRender)===null||o===void 0||o.disableHover(),(a=this.pointRender)===null||a===void 0||a.disableDrag(),(u=this.pointRender)===null||u===void 0||u.disableClick()}}]),r}(Eie);function xg(e){"@babel/helpers - typeof";return xg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},xg(e)}function F5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function N5(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?F5(Object(r),!0).forEach(function(n){zie(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):F5(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function zie(e,t,r){return t=IO(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Uie(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function B5(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,IO(n.key),n)}}function Vie(e,t,r){return t&&B5(e.prototype,t),r&&B5(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function IO(e){var t=jie(e,"string");return xg(t)==="symbol"?t:String(t)}function jie(e,t){if(xg(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(xg(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function B1(){return typeof Reflect<"u"&&Reflect.get?B1=Reflect.get.bind():B1=function(t,r,n){var i=$ie(t,r);if(i){var o=Object.getOwnPropertyDescriptor(i,r);return o.get?o.get.call(arguments.length<3?t:n):o.value}},B1.apply(this,arguments)}function $ie(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&(e=bg(e),e!==null););return e}function Gie(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_E(e,t)}function _E(e,t){return _E=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},_E(e,t)}function Hie(e){var t=Yie();return function(){var n=bg(e),i;if(t){var o=bg(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return Wie(this,i)}}function Wie(e,t){if(t&&(xg(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Xie(e)}function Xie(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Yie(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function bg(e){return bg=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},bg(e)}var qie=function(e){Gie(r,e);var t=Hie(r);function r(){return Uie(this,r),t.apply(this,arguments)}return Vie(r,[{key:"midPointRender",get:function(){return this.render.midPoint}},{key:"getCommonOptions",value:function(i){return N5(N5({},B1(bg(r.prototype),"getCommonOptions",this).call(this,i)),{},{showMidPoint:!0})}},{key:"bindMidPointRenderEvent",value:function(){var i,o,a;(i=this.midPointRender)===null||i===void 0||i.on(li.Click,this.onMidPointClick.bind(this)),(o=this.midPointRender)===null||o===void 0||o.on(li.Mousemove,this.onMidPointHover.bind(this)),(a=this.midPointRender)===null||a===void 0||a.on(li.Mouseout,this.onMidPointUnHover.bind(this))}},{key:"getMidPointData",value:function(){return this.source.getRenderData("midPoint")}},{key:"setMidPointData",value:function(i){return this.source.setRenderData("midPoint",i)}},{key:"getMidPointsByLine",value:function(i){var o=i.properties.nodes;if(!this.options.showMidPoint||o.length<2)return[];for(var a=[],u=0;u<o.length-1;u++){var c,h,y,x,E=oO(Qo([o[u],o[u+1]]),{properties:{id:zm("midPoint"),startId:(c=(h=o[u].properties)===null||h===void 0?void 0:h.id)!==null&&c!==void 0?c:"",endId:(y=(x=o[u+1].properties)===null||x===void 0?void 0:x.id)!==null&&y!==void 0?y:""}});a.push(E)}return a}},{key:"onMidPointHover",value:function(i){this.setCursor("pointHover")}},{key:"onMidPointUnHover",value:function(i){this.resetCursor()}},{key:"enableMidPointRenderAction",value:function(){var i,o;(i=this.midPointRender)===null||i===void 0||i.enableClick(),(o=this.midPointRender)===null||o===void 0||o.enableHover()}},{key:"disableMidPointRenderAction",value:function(){var i,o;(i=this.midPointRender)===null||i===void 0||i.disableClick(),(o=this.midPointRender)===null||o===void 0||o.disableHover()}}]),r}(Bie);function d_(e){"@babel/helpers - typeof";return d_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},d_(e)}function z5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function U5(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?z5(Object(r),!0).forEach(function(n){Zie(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):z5(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Zie(e,t,r){return t=Kie(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Kie(e){var t=Qie(e,"string");return d_(t)==="symbol"?t:String(t)}function Qie(e,t){if(d_(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(d_(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Jie={draw:"单击绘制首个节点",pointHover:"可拖拽调整节点位置",pointDrag:null,lineHover:"可拖拽调整线位置",lineDrag:null,midPointHover:"单击在该位置新增节点",drawFinish:"单击继续绘制，双击结束绘制"},RO={draw:"单击绘制首个节点",drawContinue:"单击继续绘制",drawFinish:"单击继续绘制，双击结束绘制",midPointHover:"单击在该位置新增节点",pointHover:"可拖拽调整节点位置",pointDrag:null,lineHover:"可拖拽调整面位置",lineDrag:null,polygonHover:"可拖拽调整面位置",polygonDrag:null};U5(U5({},RO),{},{draw:"单击绘制首个节点",drawFinish:"单击结束绘制"});function wg(e){"@babel/helpers - typeof";return wg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},wg(e)}function eae(e,t){return nae(e)||rae(e,t)||LO(e,t)||tae()}function tae(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function rae(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,i,o,a,u=[],c=!0,h=!1;try{if(o=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(u.push(n.value),u.length!==t);c=!0);}catch(y){h=!0,i=y}finally{try{if(!c&&r.return!=null&&(a=r.return(),Object(a)!==a))return}finally{if(h)throw i}}return u}}function nae(e){if(Array.isArray(e))return e}function I0(e){return oae(e)||aae(e)||LO(e)||iae()}function iae(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function LO(e,t){if(e){if(typeof e=="string")return xE(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return xE(e,t)}}function aae(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function oae(e){if(Array.isArray(e))return xE(e)}function xE(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function V5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function Oc(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?V5(Object(r),!0).forEach(function(n){sae(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):V5(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function sae(e,t,r){return t=kO(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function uae(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function j5(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,kO(n.key),n)}}function lae(e,t,r){return t&&j5(e.prototype,t),r&&j5(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function kO(e){var t=cae(e,"string");return wg(t)==="symbol"?t:String(t)}function cae(e,t){if(wg(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(wg(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Yf(){return typeof Reflect<"u"&&Reflect.get?Yf=Reflect.get.bind():Yf=function(t,r,n){var i=fae(t,r);if(i){var o=Object.getOwnPropertyDescriptor(i,r);return o.get?o.get.call(arguments.length<3?t:n):o.value}},Yf.apply(this,arguments)}function fae(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&(e=Nc(e),e!==null););return e}function hae(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&bE(e,t)}function bE(e,t){return bE=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},bE(e,t)}function pae(e){var t=mae();return function(){var n=Nc(e),i;if(t){var o=Nc(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return dae(this,i)}}function dae(e,t){if(t&&(wg(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return vae(e)}function vae(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function mae(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Nc(e){return Nc=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Nc(e)}var gae=function(e){hae(r,e);var t=pae(r);function r(){var n;uae(this,r);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return n=t.call.apply(t,[this].concat(o)),n.previousPosition=[0,0],n}return lae(r,[{key:"lineRender",get:function(){return this.render.line}},{key:"dragLine",get:function(){return this.getLineData().find(function(i){return i.properties.isDrag})}},{key:"drawLine",get:function(){return this.getLineData().find(function(i){return i.properties.isDraw})}},{key:"editLine",get:function(){return this.getLineData().find(function(i){var o=i.properties,a=o.isActive,u=o.isDraw;return!u&&a})}},{key:"hoverLine",get:function(){return this.getLineData().find(function(i){return i.properties.isHover})}},{key:"getDragLine",value:function(){return this.dragLine}},{key:"getDrawLine",value:function(){return this.drawLine}},{key:"getEditLine",value:function(){return this.editLine}},{key:"getDefaultOptions",value:function(i){var o=Oc(Oc({},this.getCommonOptions(i)),{},{showMidPoint:!0,distanceOptions:!1,helper:Er.cloneDeep(Jie)});return i.distanceOptions&&(o.distanceOptions=Oc(Oc({},Aee),o.distanceOptions)),i.adsorbOptions&&(o.adsorbOptions=Oc(Oc({},Iee),o.adsorbOptions)),o}},{key:"getAdsorbPosition",value:function(i){var o=this.options.adsorbOptions;if(typeof o=="boolean")return i;var a=this.scene,u=o.data,c=o.pointAdsorbPixel,h=o.lineAdsorbPixel,y=null,x=Ene(u,this,i),E=x.points,T=x.lines;return E.length&&c>0&&(y=Sne(i,E,o,a)),!y&&T.length&&h>0&&(y=Ane(i,T,o,a)),y}},{key:"bindSceneEvent",value:function(){this.sceneRender.on(li.Mousemove,this.onSceneMouseMove.bind(this))}},{key:"bindPointRenderEvent",value:function(){var i;Yf(Nc(r.prototype),"bindPointRenderEvent",this).call(this),(i=this.pointRender)===null||i===void 0||i.on(li.Click,this.onPointClick.bind(this))}},{key:"bindLineRenderEvent",value:function(){var i,o,a,u,c,h;(i=this.lineRender)===null||i===void 0||i.on(li.UnClick,this.onLineUnClick.bind(this)),(o=this.lineRender)===null||o===void 0||o.on(li.Mousemove,this.onLineMouseMove.bind(this)),(a=this.lineRender)===null||a===void 0||a.on(li.Mouseout,this.onLineMouseOut.bind(this)),(u=this.lineRender)===null||u===void 0||u.on(li.Dragstart,this.onLineDragStart.bind(this)),(c=this.lineRender)===null||c===void 0||c.on(li.Dragging,this.onLineDragging.bind(this)),(h=this.lineRender)===null||h===void 0||h.on(li.Dragend,this.onLineDragEnd.bind(this))}},{key:"getDashLineDistanceTexts",value:function(i,o){var a=o.showTotalDistance,u=o.format,c=o.showDashDistance;return c?i.map(function(h){return F2(h,{showTotalDistance:a,format:u},{isActive:!0,type:"dash"})}).flat():[]}},{key:"getLineDistanceTexts",value:function(i,o){var a=o.showTotalDistance,u=o.format,c=o.showWhen,h=[];if(c.includes("active")){var y=i.filter(function(E){return E.properties.isActive&&E.properties.nodes.length>1});h.push.apply(h,I0(y.map(function(E){return F2(E,{showTotalDistance:a,format:u},{isActive:!0})}).flat()))}if(c.includes("normal")){var x=i.filter(function(E){return!E.properties.isActive&&E.properties.nodes.length>1});h.push.apply(h,I0(x.map(function(E){return F2(E,{showTotalDistance:a,format:u})}).flat()))}return h}},{key:"getDistanceTexts",value:function(){var i=this.options.distanceOptions;if(!i)return[];var o=[],a=i.showWhen,u=i.showDashDistance,c=i.format,h=i.showTotalDistance;return o.push.apply(o,I0(this.getDashLineDistanceTexts(this.getDashLineData(),{showTotalDistance:!1,format:c,showDashDistance:u})).concat(I0(this.getLineDistanceTexts(this.getLineData(),{showTotalDistance:h,format:c,showWhen:a})))),o}},{key:"getAllTexts",value:function(){return this.getDistanceTexts()}},{key:"handleCreateLine",value:function(i){var o=_O([i],{isActive:!0,isDraw:!0});return this.setLineData(function(a){return Hh({target:o,data:[].concat(I0(a),[o]),otherHandler:function(c){c.properties.isActive=!1}})}),this.setPointData([i]),this.setTextData(this.getAllTexts()),o}},{key:"syncLineNodes",value:function(i,o){return i.properties.nodes=o,i.geometry.coordinates=jp(Qo(o)),this.setLineData(function(a){return a.map(function(u){return ju(u,i)?i:u})}),ju(this.editLine,i)&&this.setMidPointData(this.getMidPointsByLine(i)),this.setPointData(i.properties.nodes),this.setTextData(this.getAllTexts()),i}},{key:"setActiveLine",value:function(i){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.setLineData(function(a){return Hh({target:i,data:a,targetHandler:function(c){c.properties=Oc(Oc({},c.properties),{},{isDraw:!1,isActive:!0,isDrag:!1,isHover:!1},o)},otherHandler:function(c){c.properties=Oc(Oc({},c.properties),{},{isDraw:!1,isActive:!1,isDrag:!1})}})}),this.setPointData(i.properties.nodes.map(function(a){return a.properties=Oc(Oc({},a.properties),{},{isHover:!1,isActive:!1}),a})),this.setMidPointData(this.getMidPointsByLine(i)),this.setDashLineData([]),this.setTextData(this.getAllTexts()),i}},{key:"clearActiveLine",value:function(){this.source.setData({point:[],line:this.getLineData().map(function(i){return i.properties=Oc(Oc({},i.properties),{},{isDrag:!1,isActive:!1,isHover:!1}),i}),midPoint:[],text:this.getAllTexts()})}},{key:"handleLineUnClick",value:function(i){return this.clearActiveLine(),i}},{key:"handleLineHover",value:function(i){if(!this.drawLine)return this.setCursor("lineHover"),ju(i,this.hoverLine)||this.setLineData(function(o){return Hh({target:i,data:o,targetHandler:function(u){u.properties.isHover=!0},otherHandler:function(u){u.properties.isHover=!1}})}),i}},{key:"handleLineUnHover",value:function(i){if(!this.drawLine)return this.resetCursor(),this.setLineData(function(o){return o.map(function(a){return a.properties.isHover=!1,a})}),i}},{key:"handleLineDragStart",value:function(i){return this.setActiveLine(i,{isDrag:!0,isActive:!0}),this.scene.setMapStatus({dragEnable:!1}),this.setCursor("lineDrag"),i}},{key:"handleLineDragging",value:function(i,o){var a=o.lng,u=o.lat,c=i.properties.nodes,h=eae(this.previousPosition,2),y=h[0],x=h[1];return c.forEach(function(E){var T=E.geometry.coordinates;E.geometry.coordinates=[T[0]+a-y,T[1]+u-x]}),this.syncLineNodes(i,c),this.setActiveLine(i,{isDrag:!0}),this.setCursor("lineDrag"),this.previousPosition=[a,u],i}},{key:"handleLineDragEnd",value:function(i){return i.properties.isDrag=!1,this.setLineData(function(o){return o}),this.scene.setMapStatus({dragEnable:!0}),i}},{key:"resetAdsorbLngLat",value:function(i){if(this.options.adsorbOptions){var o=this.getAdsorbPosition(hE(mg(i)));return o&&Rne(i,o),o}}},{key:"onPointCreate",value:function(i){if(!this.editLine){this.resetAdsorbLngLat(i);var o=Yf(Nc(r.prototype),"onPointCreate",this).call(this,i),a=this.drawLine;if(o)return a?(this.syncLineNodes(a,[].concat(I0(a.properties.nodes),[o])),this.setDashLineData([])):this.handleCreateLine(o),o}}},{key:"onPointDragStart",value:function(i){var o=this.editLine;if(o)return this.setHelper("pointDrag"),Yf(Nc(r.prototype),"onPointDragStart",this).call(this,i)}},{key:"onPointDragging",value:function(i){var o=Yf(Nc(r.prototype),"onPointDragging",this).call(this,i);if(o){var a=this.resetAdsorbLngLat(i);a&&(o.geometry.coordinates=Er.cloneDeep(a))}var u=this.editLine;return u&&o&&(this.syncLineNodes(u,u.properties.nodes.map(function(c){return ju(o,c)?o:c})),this.setActiveLine(u)),o}},{key:"onPointDragEnd",value:function(i){var o=this.editLine;if(o){var a=Yf(Nc(r.prototype),"onPointDragEnd",this).call(this,i);return this.setPointData(function(u){return u.map(function(c){return c.properties.isActive=!1,c})}),this.setHelper("pointHover"),a}}},{key:"onLineUnClick",value:function(i){var o=this.editLine;if(o)return this.handleLineUnClick(o)}},{key:"onLineMouseMove",value:function(i){if(!this.drawLine)return!this.dragLine&&!this.drawLine&&this.options.editable&&this.setHelper("lineHover"),this.handleLineHover(i.feature)}},{key:"onLineMouseOut",value:function(i){if(!this.drawLine)return!this.dragLine&&!this.drawLine&&this.setHelper(this.addable?"draw":null),this.handleLineUnHover(i.feature)}},{key:"onLineDragStart",value:function(i){if(!(!this.options.editable||this.drawLine))return this.previousPosition=Ly(i),this.setHelper("lineDrag"),this.handleLineDragStart(i.feature)}},{key:"onLineDragging",value:function(i){var o=this.dragLine;if(o)return this.handleLineDragging(o,mg(i))}},{key:"onLineDragEnd",value:function(i){var o=this.dragLine;if(o)return this.setHelper("lineHover"),this.handleLineDragEnd(o)}},{key:"onPointMouseMove",value:function(i){var o=Yf(Nc(r.prototype),"onPointMouseMove",this).call(this,i);return!this.dragLine&&!this.drawLine&&!this.dragPoint&&this.setHelper("pointHover"),o}},{key:"onPointMouseOut",value:function(i){var o=Yf(Nc(r.prototype),"onPointMouseOut",this).call(this,i);return!this.dragLine&&!this.drawLine&&!this.dragPoint&&this.setHelper(this.addable?"draw":null),o}},{key:"onMidPointHover",value:function(i){Yf(Nc(r.prototype),"onMidPointHover",this).call(this,i),this.setHelper("midPointHover")}},{key:"onMidPointUnHover",value:function(i){Yf(Nc(r.prototype),"onMidPointUnHover",this).call(this,i),this.setHelper(null)}},{key:"onPointClick",value:function(i){}},{key:"getLineData",value:function(){return this.source.getRenderData("line")}},{key:"setLineData",value:function(i){return this.source.setRenderData("line",i)}},{key:"getTextData",value:function(){return this.source.getRenderData("text")}},{key:"setTextData",value:function(i){return this.source.setRenderData("text",i)}},{key:"getDashLineData",value:function(){return this.source.getRenderData("dashLine")}},{key:"setDashLineData",value:function(i){return this.source.setRenderData("dashLine",i)}},{key:"onMidPointClick",value:function(i){var o=this.editLine,a=i.feature;if(!(!o||!a||this.dragPoint)){var u=o.properties.nodes,c=a.properties,h=c.startId,y=c.endId,x=u.findIndex(function(I){return I.properties.id===h}),E=u.findIndex(function(I){return I.properties.id===y});if(x>-1&&E>-1){var T=l_(a.geometry.coordinates,{isDrag:!0,isHover:!0});return this.setHelper("pointDrag"),u.splice(E,0,T),o.geometry.coordinates=jp(Qo(u)),this.syncLineNodes(o,u),this.setActiveLine(o),T}}}},{key:"enableSceneRenderAction",value:function(){this.sceneRender.enableDrag(),this.sceneRender.enableMouseMove(),this.sceneRender.enableDblClick()}},{key:"disableSceneRenderAction",value:function(){this.sceneRender.disableDrag(),this.sceneRender.disableMouseMove(),this.sceneRender.disableDblClick()}},{key:"enableLineRenderAction",value:function(){var i,o=this.options.editable;if((i=this.lineRender)===null||i===void 0||i.enableUnClick(),o){var a,u;(a=this.lineRender)===null||a===void 0||a.enableHover(),(u=this.lineRender)===null||u===void 0||u.enableDrag()}}},{key:"disableLineRenderAction",value:function(){var i,o,a;(i=this.lineRender)===null||i===void 0||i.disableUnClick(),(o=this.lineRender)===null||o===void 0||o.disableHover(),(a=this.lineRender)===null||a===void 0||a.disableDrag()}}]),r}(qie);function Eg(e){"@babel/helpers - typeof";return Eg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Eg(e)}function hy(e){return bae(e)||xae(e)||_ae(e)||yae()}function yae(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _ae(e,t){if(e){if(typeof e=="string")return wE(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return wE(e,t)}}function xae(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function bae(e){if(Array.isArray(e))return wE(e)}function wE(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function $5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function Hf(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?$5(Object(r),!0).forEach(function(n){wae(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$5(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function wae(e,t,r){return t=OO(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Eae(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function G5(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,OO(n.key),n)}}function Sae(e,t,r){return t&&G5(e.prototype,t),r&&G5(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function OO(e){var t=Aae(e,"string");return Eg(t)==="symbol"?t:String(t)}function Aae(e,t){if(Eg(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(Eg(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function qf(){return typeof Reflect<"u"&&Reflect.get?qf=Reflect.get.bind():qf=function(t,r,n){var i=Tae(t,r);if(i){var o=Object.getOwnPropertyDescriptor(i,r);return o.get?o.get.call(arguments.length<3?t:n):o.value}},qf.apply(this,arguments)}function Tae(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&(e=Bc(e),e!==null););return e}function Cae(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&EE(e,t)}function EE(e,t){return EE=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},EE(e,t)}function Mae(e){var t=Rae();return function(){var n=Bc(e),i;if(t){var o=Bc(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return Pae(this,i)}}function Pae(e,t){if(t&&(Eg(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Iae(e)}function Iae(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Rae(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Bc(e){return Bc=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Bc(e)}var Lae=function(e){Cae(r,e);var t=Mae(r);function r(){return Eae(this,r),t.apply(this,arguments)}return Sae(r,[{key:"dragItem",get:function(){return this.dragPolygon}},{key:"editItem",get:function(){return this.editPolygon}},{key:"polygonRender",get:function(){return this.render.polygon}},{key:"dragPolygon",get:function(){return this.getPolygonData().find(function(i){return i.properties.isDrag})}},{key:"drawPolygon",get:function(){return this.getPolygonData().find(function(i){return i.properties.isDraw})}},{key:"editPolygon",get:function(){return this.getPolygonData().find(function(i){var o=i.properties,a=o.isActive,u=o.isDraw;return!u&&a})}},{key:"hoverPolygon",get:function(){return this.getPolygonData().find(function(i){return i.properties.isHover})}},{key:"getDragPolygon",value:function(){return this.dragPolygon}},{key:"getDrawPolygon",value:function(){return this.drawPolygon}},{key:"getEditPolygon",value:function(){return this.editPolygon}},{key:"getRenderTypes",value:function(){return["polygon","line","dashLine","midPoint","point","text"]}},{key:"getData",value:function(){return this.getPolygonData()}},{key:"getMainLayer",value:function(){var i,o;return(i=(o=this.render.polygon)===null||o===void 0?void 0:o.getLayers())!==null&&i!==void 0?i:[]}},{key:"getDefaultOptions",value:function(i){var o=Hf(Hf({},qf(Bc(r.prototype),"getDefaultOptions",this).call(this,i)),{},{areaOptions:!1,helper:Er.cloneDeep(RO)});return i.areaOptions&&(o.areaOptions=Hf(Hf({},Tee),i.areaOptions)),o}},{key:"getAreaTexts",value:function(i){var o=this.options.areaOptions;if(!o)return[];var a=o.format,u=o.showWhen,c=[],h=i.filter(function(y){return y.geometry.coordinates[0].length>=4});return u.includes("active")&&h.filter(function(y){return y.properties.isActive}).forEach(function(y){c.push(E5(y,{format:a},{isActive:!0}))}),u.includes("normal")&&h.filter(function(y){return!y.properties.isActive}).forEach(function(y){c.push(E5(y,{format:a},{isActive:!1}))}),c}},{key:"getAllTexts",value:function(){return[].concat(hy(qf(Bc(r.prototype),"getAllTexts",this).call(this)),hy(this.getAreaTexts(this.getPolygonData())))}},{key:"getPolygonData",value:function(){return this.source.getRenderData("polygon")}},{key:"setPolygonData",value:function(i){return this.source.setRenderData("polygon",i)}},{key:"handleCreatePolygon",value:function(i,o){var a=cne(i,{nodes:i,line:o,isActive:!0,isDraw:!0});return this.setPolygonData(function(u){return Hh({target:a,data:[].concat(hy(u),[a]),otherHandler:function(h){h.properties.isActive=!1}})}),a}},{key:"handlePolygonUnClick",value:function(i){return this.clearActivePolygon(),i}},{key:"handlePolygonHover",value:function(i){return this.setCursor("polygonHover"),ju(i,this.hoverPolygon)||this.setPolygonData(function(o){return Hh({target:i,data:o,targetHandler:function(u){u.properties.isHover=!0},otherHandler:function(u){u.properties.isHover=!1}})}),i}},{key:"handlePolygonUnHover",value:function(){this.resetCursor(),this.setPolygonData(function(i){return i.map(function(o){return o.properties.isHover=!1,o})})}},{key:"handlePolygonDragStart",value:function(i){return this.setActivePolygon(i,{isDrag:!0}),this.scene.setMapStatus({dragEnable:!1}),this.setCursor("polygonDrag"),i}},{key:"bindPolygonRenderEvent",value:function(){var i,o,a,u;(i=this.polygonRender)===null||i===void 0||i.on(li.UnClick,this.onPolygonUnClick.bind(this)),(o=this.polygonRender)===null||o===void 0||o.on(li.Mousemove,this.onPolygonHover.bind(this)),(a=this.polygonRender)===null||a===void 0||a.on(li.Mouseout,this.onPolygonUnHover.bind(this)),(u=this.polygonRender)===null||u===void 0||u.on(li.Dragstart,this.onPolygonDragStart.bind(this))}},{key:"syncPolygonNodes",value:function(i,o){var a=jp(Qo([].concat(hy(o),[Er.first(o)]))),u=i.properties;u.isDraw;var c=u.line;if(i.properties.nodes=o,i.geometry.coordinates=[gte(yl(a))?a:a.reverse()],this.setPolygonData(function(T){return T.map(function(I){return ju(I,i)?i:I})}),!ju(this.drawPolygon,i)){var h=c.properties.nodes,y=hy(o),x=Er.first(y);h.length===o.length?y.push(l_(x.geometry.coordinates)):y.push(Er.last(h));var E=Er.last(y);Er.isEqual(x.geometry.coordinates,E.geometry.coordinates)||(E.geometry.coordinates=Er.cloneDeep(x.geometry.coordinates)),this.syncLineNodes(c,y)}return i}},{key:"setActivePolygon",value:function(i){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.setActiveLine(i.properties.line,o),this.setPolygonData(function(a){return Hh({target:i,data:a,targetHandler:function(c){c.properties=Hf(Hf({},c.properties),{},{isDraw:!1,isActive:!0,isDrag:!1,isHover:!1},o)},otherHandler:function(c){c.properties=Hf(Hf({},c.properties),{},{isDraw:!1,isActive:!1,isDrag:!1})}})}),this.setTextData(this.getAllTexts()),i}},{key:"clearActivePolygon",value:function(){this.setPolygonData(function(i){return i.map(function(o){return o.properties=Hf(Hf({},o.properties),{},{isDrag:!1,isActive:!1,isHover:!1}),o})}),this.clearActiveLine()}},{key:"onLineDragStart",value:function(i){var o=qf(Bc(r.prototype),"onLineDragStart",this).call(this,i),a=this.getPolygonData().find(function(u){return ju(u.properties.line,o)});return a&&(this.setActivePolygon(a,{isDrag:!0}),this.emit(Ka.DragStart,a,this.getPolygonData())),o}},{key:"onLineUnClick",value:function(i){return this.editLine}},{key:"onLineDragEnd",value:function(i){var o=qf(Bc(r.prototype),"onLineDragEnd",this).call(this,i),a=this.dragPolygon;return o&&a&&(a.properties.isDrag=!1,this.emit(Ka.DragEnd,a,this.getPolygonData()),this.emit(Ka.Edit,a,this.getPolygonData())),o}},{key:"onPolygonUnClick",value:function(i){var o=this.editPolygon;if(o)return this.handlePolygonUnClick(o)}},{key:"onPolygonHover",value:function(i){if(!this.drawPolygon)return this.dragPolygon||this.setHelper("polygonHover"),this.handlePolygonHover(i.feature)}},{key:"onPolygonUnHover",value:function(i){if(!this.drawPolygon)return this.setHelper(this.addable?"draw":null),this.handlePolygonUnHover()}},{key:"onPolygonDragStart",value:function(i){if(!(!this.options.editable||this.drawPolygon)){var o=i.feature;return this.previousPosition=Ly(i),this.setHelper("polygonDrag"),this.emit(Ka.DragStart,o,this.getPolygonData()),this.handlePolygonDragStart(o)}}},{key:"onMidPointClick",value:function(i){var o=this.editPolygon,a=qf(Bc(r.prototype),"onMidPointClick",this).call(this,i);if(a&&o){var u=o.properties.line.properties.nodes;this.syncPolygonNodes(o,u.slice(0,u.length-1)),this.setActivePolygon(o)}return a}},{key:"onPointDragEnd",value:function(i){var o=this.editPolygon,a=qf(Bc(r.prototype),"onPointDragEnd",this).call(this,i);return a&&o&&this.emit(Ka.Edit,o,this.getPolygonData()),a}},{key:"enablePolygonRenderAction",value:function(){var i,o=this.options.editable;if((i=this.polygonRender)===null||i===void 0||i.enableUnClick(),o){var a,u;(a=this.polygonRender)===null||a===void 0||a.enableHover(),(u=this.polygonRender)===null||u===void 0||u.enableDrag()}}},{key:"disablePolygonRenderAction",value:function(){var i,o,a;(i=this.polygonRender)===null||i===void 0||i.disableUnClick(),(o=this.polygonRender)===null||o===void 0||o.disableHover(),(a=this.polygonRender)===null||a===void 0||a.disableDrag()}},{key:"bindEnableEvent",value:function(){qf(Bc(r.prototype),"bindEnableEvent",this).call(this),this.enableSceneRenderAction(),this.enablePointRenderAction(),this.enableLineRenderAction(),this.enableMidPointRenderAction(),this.enablePolygonRenderAction()}},{key:"unbindEnableEvent",value:function(){qf(Bc(r.prototype),"unbindEnableEvent",this).call(this),this.disableSceneRenderAction(),this.disablePointRenderAction(),this.disableLineRenderAction(),this.disableMidPointRenderAction(),this.disablePolygonRenderAction()}},{key:"bindThis",value:function(){qf(Bc(r.prototype),"bindThis",this).call(this),this.bindPointRenderEvent=this.bindPointRenderEvent.bind(this),this.bindSceneEvent=this.bindSceneEvent.bind(this),this.bindLineRenderEvent=this.bindLineRenderEvent.bind(this),this.bindMidPointRenderEvent=this.bindMidPointRenderEvent.bind(this),this.bindPolygonRenderEvent=this.bindPolygonRenderEvent.bind(this)}},{key:"setActiveFeature",value:function(i){var o=this.getTargetFeature(i);o?this.setActivePolygon(o):this.clearActivePolygon()}},{key:"resetFeatures",value:function(){var i=this.getPolygonData();this.drawPolygon&&(i=i.filter(function(o){return!o.properties.isDraw}),this.source.setData({point:[],dashLine:[],midPoint:[]}),this.setLineData(function(o){return o.filter(function(a){return!a.properties.isDraw})}),this.setTextData(function(o){return o.filter(function(a){return!a.properties.isActive})})),this.editPolygon&&this.handlePolygonUnClick(this.editPolygon),this.setPolygonData(i.map(function(o){return o.properties=Hf(Hf({},o.properties),{},{isDrag:!1,isActive:!1,isHover:!1}),o}))}}]),r}(gae);function Sg(e){"@babel/helpers - typeof";return Sg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Sg(e)}function kae(e,t){return Fae(e)||Dae(e,t)||DO(e,t)||Oae()}function Oae(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Dae(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,i,o,a,u=[],c=!0,h=!1;try{if(o=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(u.push(n.value),u.length!==t);c=!0);}catch(y){h=!0,i=y}finally{try{if(!c&&r.return!=null&&(a=r.return(),Object(a)!==a))return}finally{if(h)throw i}}return u}}function Fae(e){if(Array.isArray(e))return e}function N2(e){return zae(e)||Bae(e)||DO(e)||Nae()}function Nae(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function DO(e,t){if(e){if(typeof e=="string")return SE(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return SE(e,t)}}function Bae(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function zae(e){if(Array.isArray(e))return SE(e)}function SE(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function H5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function b1(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?H5(Object(r),!0).forEach(function(n){Uae(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):H5(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Uae(e,t,r){return t=FO(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Vae(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function W5(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,FO(n.key),n)}}function jae(e,t,r){return t&&W5(e.prototype,t),r&&W5(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function FO(e){var t=$ae(e,"string");return Sg(t)==="symbol"?t:String(t)}function $ae(e,t){if(Sg(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(Sg(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Gh(){return typeof Reflect<"u"&&Reflect.get?Gh=Reflect.get.bind():Gh=function(t,r,n){var i=Gae(t,r);if(i){var o=Object.getOwnPropertyDescriptor(i,r);return o.get?o.get.call(arguments.length<3?t:n):o.value}},Gh.apply(this,arguments)}function Gae(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&(e=vf(e),e!==null););return e}function Hae(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&AE(e,t)}function AE(e,t){return AE=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},AE(e,t)}function Wae(e){var t=qae();return function(){var n=vf(e),i;if(t){var o=vf(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return Xae(this,i)}}function Xae(e,t){if(t&&(Sg(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Yae(e)}function Yae(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function qae(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function vf(e){return vf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},vf(e)}var Zae=function(e){Hae(r,e);var t=Wae(r);function r(n,i){var o;return Vae(this,r),o=t.call(this,n,i),o.drawPolygonFinish=function(){var a,u=o.drawPolygon,c=(a=u==null?void 0:u.properties.nodes)!==null&&a!==void 0?a:[];if(!(!u||c.length<3)){u.properties.isDraw=!1,o.syncPolygonNodes(u,c),o.setActivePolygon(u);var h=o.options,y=h.autoActive,x=h.editable;(!y||!x)&&o.handlePolygonUnClick(u),x?o.setHelper(y?"pointHover":"polygonHover"):o.setHelper(o.addable?"draw":null),o.emit(Ka.Add,u,o.getPolygonData())}},o.sceneRender.on(li.DblClick,o.drawPolygonFinish),o.bindPointRenderEvent(),o.bindSceneEvent(),o.bindMidPointRenderEvent(),o.bindLineRenderEvent(),o.bindPolygonRenderEvent(),o}return jae(r,[{key:"getDefaultOptions",value:function(i){return b1(b1({},Gh(vf(r.prototype),"getDefaultOptions",this).call(this,i)),{},{liveUpdate:!1})}},{key:"setData",value:function(i){var o=i.map(function(a){var u,c;if(a.properties=b1(b1({},yO()),(u=a.properties)!==null&&u!==void 0?u:{}),!(!((c=a.properties.nodes)===null||c===void 0)&&c.length)){var h=jp(a);h=h.slice(0,h.length-1),a.properties.nodes=h.map(function(x){return l_(x)})}if(!a.properties.line){var y=a.properties.nodes;a.properties.line=_O([].concat(N2(y),[l_(Er.first(y).geometry.coordinates)]))}return a});this.source.setData({point:[],midPoint:[],dashLine:[],polygon:o,line:o.map(function(a){return a.properties.line})}),this.setTextData(this.getAllTexts()),this.editPolygon&&this.setActivePolygon(this.editPolygon)}},{key:"onPointCreate",value:function(i){if(!(!this.addable||this.dragPoint)){var o=Gh(vf(r.prototype),"onPointCreate",this).call(this,i),a=this.drawPolygon,u=this.drawLine;if(o){if(a){this.syncPolygonNodes(a,[].concat(N2(a.properties.nodes),[o])),this.setDashLineData([D2([Ly(i),a.properties.nodes[0].geometry.coordinates])]);var c=a.properties.nodes.length;c>1&&this.setHelper("drawFinish")}else u&&(this.handleCreatePolygon([o],u),this.setHelper("drawContinue"));this.emit(Ka.AddNode,o,a,this.getPolygonData())}return o}}},{key:"onPointClick",value:function(i){var o=this,a=this.drawPolygon,u=i.feature;if(a){var c=a.properties.nodes;if(c.length>=3&&(ju(Er.first(c),u)||ju(Er.last(c),u)))requestAnimationFrame(function(){o.drawPolygonFinish()});else{var h=kae(u.geometry.coordinates,2),y=h[0],x=h[1];i.lngLat={lng:y,lat:x},this.onPointCreate(i)}}}},{key:"onPointDragging",value:function(i){var o=this.dragPoint,a=this.editPolygon;if(o&&a){var u=a.properties.line;u.properties.nodes=u.properties.nodes.map(function(I){return ju(I,o)?o:I});var c=u.properties.nodes,h=c.slice(0,c.length-1),y=Er.first(c),x=Er.last(c),E=ju(y,o)||ju(x,o);if(E&&(y.geometry.coordinates=x.geometry.coordinates=Ly(i)),this.options.adsorbOptions&&E){var T=this.resetAdsorbLngLat(i);T&&(y.geometry.coordinates=x.geometry.coordinates=T)}Gh(vf(r.prototype),"onPointDragging",this).call(this,i),this.syncPolygonNodes(a,h),this.setActivePolygon(a)}return o}},{key:"onLineDragging",value:function(i){var o=this.dragPolygon,a=Gh(vf(r.prototype),"onLineDragging",this).call(this,i);if(a&&o){var u=a.properties.nodes;this.syncPolygonNodes(o,u.slice(0,u.length-1)),this.emit(Ka.Dragging,o,this.getPolygonData())}return a}},{key:"onMidPointClick",value:function(i){var o=Gh(vf(r.prototype),"onMidPointClick",this).call(this,i),a=this.editPolygon;return o&&a&&(this.emit(Ka.Edit,a,this.getPolygonData()),this.emit(Ka.AddNode,o,a,this.getPolygonData())),o}},{key:"onSceneMouseMove",value:function(i){var o,a=this.drawPolygon,u=(o=a==null?void 0:a.properties.nodes)!==null&&o!==void 0?o:[];if(!(!a||!u.length)){this.options.adsorbOptions&&this.resetAdsorbLngLat(i);var c=Ly(i),h=[];if(h.push(D2([c,Er.first(u).geometry.coordinates])),u.length>1&&h.push(D2([c,Er.last(u).geometry.coordinates])),this.options.liveUpdate&&u.length>=2){var y=jp(Qo(u));a.geometry.coordinates=[[].concat(N2(y),[c,y[0]])],this.setPolygonData(this.getPolygonData())}this.setDashLineData(h),this.setTextData(this.getAllTexts())}}},{key:"removeNode",value:function(i,o){var a,u=this.getTargetFeature(o),c=this.getTargetFeature(i,(a=u==null?void 0:u.properties.nodes)!==null&&a!==void 0?a:[]);if(u&&c){var h,y=(h=u==null?void 0:u.properties.nodes)!==null&&h!==void 0?h:[];if(y.length<4)return;this.syncPolygonNodes(u,y.filter(function(x){return!ju(c,x)})),this.emit(Ka.RemoveNode,c,u,this.getLineData()),this.emit(Ka.Edit,u,this.getPolygonData())}}},{key:"onPointContextMenu",value:function(i){var o,a=this.editPolygon,u=i.feature,c=(o=a==null?void 0:a.properties.nodes)!==null&&o!==void 0?o:[];if(!(!a||c.length<4))return c.find(function(h){return ju(h,u)})||(u=c[0]),this.removeNode(u,a),u}},{key:"bindPointRenderEvent",value:function(){var i;Gh(vf(r.prototype),"bindPointRenderEvent",this).call(this),(i=this.pointRender)===null||i===void 0||i.on(li.Contextmenu,this.onPointContextMenu.bind(this))}},{key:"enablePointRenderAction",value:function(){if(Gh(vf(r.prototype),"enablePointRenderAction",this).call(this),this.options.editable){var i;(i=this.pointRender)===null||i===void 0||i.enableContextMenu()}}},{key:"disablePointRenderAction",value:function(){var i;Gh(vf(r.prototype),"disablePointRenderAction",this).call(this),(i=this.pointRender)===null||i===void 0||i.disableContextMenu()}}]),r}(Lae);(function(e){var t,r,n,i,o,a='<svg><symbol id="l7draw-qingkong" viewBox="0 0 1024 1024"><path d="M778.96777344 334.02148437h-148.31542969V284.58300781A71.78466797 71.78466797 0 0 0 556.49462891 215.36914062H467.50537109a71.78466797 71.78466797 0 0 0-74.15771484 69.11499024V334.02148437h-148.31542969a29.66308594 29.66308594 0 1 0 0 59.32617188h29.66308594v326.29394531A88.98925781 88.98925781 0 0 0 363.68457031 808.63085938h296.63085938a88.98925781 88.98925781 0 0 0 88.98925781-88.98925782V393.34765625h29.66308594a29.66308594 29.66308594 0 0 0 0-59.32617188zM452.67382812 284.58300781c0-4.74609375 6.22924805-9.78881836 14.83154297-9.78881836h88.98925782c8.60229492 0 14.83154297 5.04272461 14.83154296 9.78881836V334.02148437H452.67382812V284.53356934z m237.30468751 435.10803223a29.66308594 29.66308594 0 0 1-29.66308594 29.66308593H363.68457031a29.66308594 29.66308594 0 0 1-29.66308593-29.66308594V393.34765625h355.95703124v326.29394531z"  ></path><path d="M437.84228516 660.31542969c6.57531739 0 12.85400391-3.46069336 17.5012207-9.64050294A39.20471192 39.20471192 0 0 0 462.56152344 627.33996582V495.5369873a39.20471192 39.20471192 0 0 0-7.21801758-23.33496093A22.09899903 22.09899903 0 0 0 437.84228516 462.56152344c-6.57531739 0-12.85400391 3.46069336-17.50122071 9.64050293A39.20471192 39.20471192 0 0 0 413.12304687 495.5369873v131.80297853c0 8.75061036 2.62023926 17.15515137 7.21801758 23.33496092 4.6472168 6.17980958 10.92590333 9.64050293 17.50122071 9.64050294zM586.15771484 660.31542969c6.57531739 0 12.85400391-3.46069336 17.50122071-9.64050294a39.20471192 39.20471192 0 0 0 7.21801758-23.33496093V495.5369873a39.20471192 39.20471192 0 0 0-7.21801758-23.33496093A22.09899903 22.09899903 0 0 0 586.15771484 462.56152344c-6.57531739 0-12.85400391 3.46069336-17.5012207 9.64050293A39.20471192 39.20471192 0 0 0 561.43847656 495.5369873v131.80297853c0 8.75061036 2.62023926 17.15515137 7.21801758 23.33496092 4.6472168 6.17980958 10.92590333 9.64050293 17.5012207 9.64050294z"  ></path></symbol><symbol id="l7draw-rect" viewBox="0 0 1024 1024"><path d="M736.14 648.79V330c0-23.16-18.84-42-42-42H375.49c-11.07-19.13-31.74-32.01-55.43-32.01-35.35 0-64.01 28.66-64.01 64.01 0 23.69 12.88 44.36 32.01 55.43v318.8c0 23.16 18.84 42 42 42H648.7c11.07 19.13 31.74 32.01 55.43 32.01 35.35 0 64.01-28.66 64.01-64.01 0.01-23.7-12.87-44.37-32-55.44zM352.06 375.43A64.281 64.281 0 0 0 375.49 352h296.64v296.8a64.357 64.357 0 0 0-23.43 23.43H352.06v-296.8z"  ></path></symbol><symbol id="l7draw-circle" viewBox="0 0 1024 1024"><path d="M467.013228 557.765038a64.01 64.01 0 1 0 90.52223-90.52539 64.01 64.01 0 1 0-90.52223 90.52539Z"  ></path><path d="M832.16 512.22c0-26.06-15.58-48.46-37.93-58.45-11.21-54.67-38.11-104.92-78.48-145.3-54.42-54.42-126.78-84.4-203.75-84.4s-149.33 29.97-203.75 84.4c-54.42 54.42-84.4 126.79-84.4 203.75s29.97 149.33 84.4 203.75c54.42 54.42 126.78 84.4 203.75 84.4s149.33-29.97 203.75-84.4c40.37-40.37 67.28-90.62 78.48-145.3 22.35-9.98 37.93-32.39 37.93-58.45zM670.5 670.72c-42.34 42.34-98.62 65.65-158.5 65.65-59.87 0-116.16-23.32-158.5-65.65-42.34-42.34-65.65-98.62-65.65-158.5s23.32-116.16 65.65-158.5c42.34-42.34 98.62-65.65 158.5-65.65 59.87 0 116.16 23.32 158.5 65.65 29.9 29.9 50.3 66.77 59.71 106.95-15.81 11.66-26.07 30.4-26.07 51.55s10.26 39.9 26.07 51.55c-9.41 40.18-29.81 77.05-59.71 106.95z"  ></path></symbol><symbol id="l7draw-polygon" viewBox="0 0 1024 1024"><path d="M705.97 640.31c-5.79 0-11.39 0.78-16.72 2.22L381.94 336.66a64.079 64.079 0 0 0 2.14-16.43c0-35.35-28.66-64.01-64.01-64.01s-64.01 28.66-64.01 64.01c0 23.69 12.88 44.36 32.01 55.43V648.8c-19.13 11.07-32.01 31.74-32.01 55.43 0 35.35 28.66 64.01 64.01 64.01 23.69 0 44.35-12.87 55.42-32l275.05 0.07c11.07 19.14 31.74 32.03 55.44 32.03 35.35 0 64.01-28.66 64.01-64.01s-28.66-64.02-64.02-64.02z m-353.91 8.48V397.22L628.44 672.3l-252.94-0.07a64.411 64.411 0 0 0-23.44-23.44z"  ></path></symbol><symbol id="l7draw-line" viewBox="0 0 1024 1024"><path d="M832.16 449.21c0-35.35-28.66-64.01-64.01-64.01-29.2 0-53.81 19.56-61.5 46.28l-390.9 96.82 72.18-144.18c33.56-1.99 60.17-29.83 60.17-63.89 0-35.35-28.66-64.01-64.01-64.01s-64.01 28.66-64.01 64.01c0 13.04 3.91 25.17 10.61 35.28l-78.42 156.65c-33.58 1.97-60.21 29.81-60.21 63.89 0 35.35 28.66 64.01 64.01 64.01 29.2 0 53.81-19.56 61.5-46.28l390.8-96.79-71.97 143.34c-33.62 1.93-60.28 29.8-60.28 63.9 0 35.35 28.66 64.01 64.01 64.01s64.01-28.66 64.01-64.01c0-13-3.89-25.09-10.54-35.18l78.28-155.93c33.61-1.95 60.28-29.81 60.28-63.91z"  ></path></symbol><symbol id="l7draw-point" viewBox="0 0 1024 1024"><path d="M331.46 330.08m-64.01 0a64.01 64.01 0 1 0 128.02 0 64.01 64.01 0 1 0-128.02 0Z"  ></path><path d="M384.12 735.84m-64.01 0a64.01 64.01 0 1 0 128.02 0 64.01 64.01 0 1 0-128.02 0Z"  ></path><path d="M769.11 512.7m-64.01 0a64.01 64.01 0 1 0 128.02 0 64.01 64.01 0 1 0-128.02 0Z"  ></path></symbol></svg>',u=(u=document.getElementsByTagName("script"))[u.length-1].getAttribute("data-injectcss"),c=function(E,T){T.parentNode.insertBefore(E,T)};if(u&&!e.__iconfont__svg__cssinject__){e.__iconfont__svg__cssinject__=!0;try{document.write("<style>.svgfont {display: inline-block;width: 1em;height: 1em;fill: currentColor;vertical-align: -0.1em;font-size:16px;}</style>")}catch{}}function h(){o||(o=!0,n())}function y(){try{i.documentElement.doScroll("left")}catch{return void setTimeout(y,50)}h()}t=function(){var E,T=document.createElement("div");T.innerHTML=a,a=null,(T=T.getElementsByTagName("svg")[0])&&(T.setAttribute("aria-hidden","true"),T.style.position="absolute",T.style.width=0,T.style.height=0,T.style.overflow="hidden",T=T,(E=document.body).firstChild?c(T,E.firstChild):E.appendChild(T))},document.addEventListener?~["complete","loaded","interactive"].indexOf(document.readyState)?setTimeout(t,0):(r=function(){document.removeEventListener("DOMContentLoaded",r,!1),t()},document.addEventListener("DOMContentLoaded",r,!1)):document.attachEvent&&(n=t,i=e.document,o=!1,y(),i.onreadystatechange=function(){i.readyState=="complete"&&(i.onreadystatechange=null,h())})})(window);function Kae(){let e=z1(10);const t=.0036;return{ImageLayer:uL,Mapbox:X$,metersToLngLat:Bb,Scene:WQ,Popup:b$,PointLayer:Fm,DrawPolygon:Zae,LineLayer:x_,PolygonLayer:Xx,l7Scale:e,l7ConvertCMtoL:(u,c=0)=>{const[h,y]=u,x=c-y;return Bb([h*e.value,x*e.value])},l7ConvertLtoCM:(u,c=0)=>{const[h,y]=C1(u);return[h/e.value,c-y/e.value]},l7ConvertDataToWeb:u=>{const{mapMetersPerPixel:c,mapOriginPixelX:h,mapOriginPixelY:y,x,y:E}=u;let T=(Number(x)/Number(c)-Number(h))*t,I=-1*(Number(E)/Number(c)-Number(y))*t;return[T,I]},l7HandleImageMaxRange:(u,c)=>{let h=(u/275*10).toFixed(1),y=(c/275*10).toFixed(1);return{l7MapWidth:(c/275).toFixed(1),maxRange:Bb([h,y])}},l7ConvertWebToData:u=>{const{mapMetersPerPixel:c,mapOriginPixelX:h,mapOriginPixelY:y,x,y:E}=u;let T=(Number(x)/t+Number(h))*Number(c),I=(Number(E)/t*-1+Number(y))*Number(c);return[T,I]}}}const Qae="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEgAAABWCAMAAABb7yCeAAAAzFBMVEUAAABqgf9mgf9nhP9wgP9rgP9og/9og/9tf/9qgv9qgv9sgP9ng/9og/9sgP9rgf9sg/9mhP9qgf9ng/9sf/9mhf9rgf9lhf9ogv9mgP9ggP9uf/9mg/9lhf9ng/9og/9nhP9pgv////9sgP9qgf9rgP9qgv9mhf9rgf9ohP/t7/+Pof9yiv/H0P++yP99kf90if+9yf+jsf/j5/97k//j6P/a4P/19/+Yqf/H0f/s8P/R2P+0wP+Hmf/2+P+1wP/k6P/k5/+0wf+zwf8ghq41AAAAH3RSTlMA/iDfEN9fv99/n5CP7+9vH8/PQM+vr29QMBDPrzBvH672rwAABnBJREFUWMOtlod62kAQhCVhQxzjNMeOnQYCSahgwA3b6eX93ykzu8udhOJGMjqd9OULf2bbKcFd+tDtH3Q6k+Fk0nnZ63c/BJvo7ZuDvQkYcg3BwrZ30I0eidnvTVQGgezl/dEjMN2XytDNIMOVOt2HuulM6jIrXoOHoaKeD4kAHxcRwwL7YFA8fXEf581ew82EAO+lkJuse0y97StAfbQTREdFMaCpQf+usCzJxlGEE3/PG6iCL6+iWzmdtSQ3SEDw93ySCXWiuziaYt5edIFdfDg5UpujNhS2FhYxhS1VzOJ1/lK8rY6rtfJqDCzmWULi8qjOVgt0YBxFKdFXSgCGAJEqhNRb5+woo1Vvl2WS2orjnbUEDX2SeXmBIUEV5sgziIkH8X4D1Bm6VnY5KmqBIcvOU1FHuTT5wIzj/QwI0AZsAmhFNixsteAi6+dWJ2OrTsvR6PzmogCJt+OsUNme74Gnzocb0kIDm56OTKdTQnjHxcC8xKqnNUMG4WZTzjWYXo6czqeue1Yg7lkWx5Ez1JK2TWF+zJPvQ+/GLHlDk1YfI4qLUUNVrWAU94TrmRauO2kfGdq/N03QzFkyQxkvoDIt3Mu/hKW6bIJKn2LjcEuQpZ5rapsExXCX8RqtSSgeYyiAEnbAGwblzwpFFTIa66BB200MQ1jPAeoxRQPl6GS5Li6bnMtYk+NhvATG2IZONlR68kBafa8b+31mIGaHqcaNuu03D3cWnxxR1QRdKMetJGHR8MB9jBTRio2WHKV2cbIalmb1oMjIxI6qG/TVjEakJ+FKOiI+Q5lzZEYMQ2u7Qc8+MY4wbBzKp20/khciVGSG6SHaUcYKoSiKr9a9oosbmbPKJZo+cDk7ZObhK5yNVvAhN4vJ5lKHiqBaxSnLMJdA83w7oB8m2yLzJ0U1+8W3OujLSSWkZJWfPAnhJs/DLA9IYL3tEaur6e9PmC1iMgMxyef4szOrVChOQryBA1Zgxyc37+e6dI0zEJBUe44XosiRoGAoz7I0z9M8Baj1UZ+ejFRnkha+Sa3ORqqTRZxQOVdKPyFAHQ8xRxeIAPr2uZoSJI6yjAFd279QzleYHKKjcDt478KKzU8pmC/TOJMzWUGJlmquqPMF6y4kOAIo7QV9DgMx1j3agj+QHpOBdLSAKqU9EwoArDSEo93gaOBFBxeShWk84Cg4R65x4kwzWCHPoXAkuvQoeKsIDqug+Nc+TQmgEnMkCBgKcS1KWkJUCAsw4BAejv9ezQ/WJavlRpz7cjRasgu1VCBVzDd9QGwi+OLB9tH+r2OoETS1edDhrBAIo8pIwQoXIyiXsOiH6gK0teft4OFBMlPclksyTFmeC0jakGboTD9sfQPpKpnJ2gFGSzS0akEUm435k4Gpo3E61k9tJJjVwT5jAqZILBlQrD64MhQKKZZknwAiZRuH6TiM7Ntf//BV+h8GHXI4EgKMSFAc9YU0/hx+ULExOGaIljQsq/jMhgAgcxISw2mApfyrNiQg2opAjaPA1GfNyKGm5zqZ84zxuaMLAmbxXYdtgYBSCpjUDGnhLDLC5p9syCsxJUcFzaSL6vOVDW0KEC9qm4ZMz32VcLtj5Gr55bqakzP/ejZbXrljBASiQgE9D2rqKYaxQMlZObpV5TXzI6GF4I23g7qOAXCfGdzxbair7wtiADBDmmmvHdhxzQMk2vCkbFFmFfrQDI0VtBOs6RUjIwMoXVn29Xq2vBRcWX6enc1lsLAZgy9PgnVFe+Yok87REPPEDgtUXrpGcxwyQ8J6FgUtdWHGPqJYVAoQKPQBDqUh5WNK0oSpb2uXGEHk5iZhMtCHwFhUEo/XbvA3bb0yNxmnSk6sFJs+6UkYYFvdQ6t8W9G2ZkjmCwT+lpiQhnSRRAZISHQU3KJjzU2IkBAfxXj0dmnhuaE6Dm5VN+ShA4UWT2oPa0InHY07tJNLkgHg10bEd82OZ7Q7sV26MLO2ya3qua94s2D36JAEGwRb4iXl7W0d3oNhE5gVpiknhah1vd4K7idtkwJDGlZqdhqwJ+Dcr0hIFpUF1hQb6GEkFhsYRlavV/o4DkmwowyO+4Z+jMRRUMTGHCOFFhFquDnHSFS4qR9Pgpl2/4DzWG29Hrf0Dv2zAelwnfMUnI20awA3pxtrp3VubKrnrXNsUx09U8yz/eAf9eKJtM+L4J8VvUbZo+B/aPch5foD2oU0gwCVsqAAAAAASUVORK5CYII=",Jae="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEgAAABWCAMAAABb7yCeAAAA51BMVEUAAAD/pT7/pkH/pDz/qE3/oTz/n0D/pkH/qk7/pDv/pT//pD3/q1D/qEb/rFH/pD3/pDz/q1D/qU3/pkP/rVL/pDz/p0H/qk//pDz/qUv/qUv/qUn/qUr/qEr/p0f/pDz/r1D/n1D/ozv/pkP/p0X/pD3/q0//qUv/rFH/rE//qk//rVP/rFH/pUX/q1D/////qk3/pkP/p0b/qEj/pDz/pUH/qUv/q1D/q0//qUr/pD7/p0P/rFL/+vT/vnf/6dH/slz/x4j/tmT/9Oj/48T/37v/1KT/r1X/3rj/5cf/79v/2Kz/yImtrRoKAAAAL3RSTlMA/v7+IB8Q39/fj2Df78/Pr5CAMN+/f29vX9/Pv5BQQBAQ77+fn++wr5+f7+9vQF3khDwAAAVtSURBVFjDpZaHdtowFIZlQUghi0CzmibdezCMAduEjCZNOt7/eXqnhJim+Wzck3PC1//eK8kxy2hu1erVaqlX6lX3DmpbTfM/VI7rr0s9AB74jODxur61sabmxYE49J8S3FkUlbL6+RqarT0SsITJSqWMiLLNraJpqmpxIrJE5ImiLCqk2jjwEi2Ko+AVJSBKkuTdyl4dv8b/Hz5iYRGVxYossdYmyYpQlZr2Vx4RWHqQBD1EEiWMrS0ra89XpbKIFOTCByoAeHb2NhZ6qv77pUiMPk5GYUiSwKOTbG4s8qCFbyXjaaGDNQnTsR1rO6Ep9IiFU1E1GkhaA99POgA8bD7PVKn6JrMvYyLJE1kuyaIOLGjLNyszonpvgggGXnJhEg+2xuYdkuAnfzPtOewFhfGMXItDFUOeTn441SAfBhZOJmNXjUzLsiOxouHHi0BUxTAAzYxKAgfe1Jnxw01C3YWHtbmP04U7aNMhh0FPBCtIN0QUcXd/t1o/rq8kiJLT3c27hxOFgQH3A32yjBYhpNLCblrE7TV9V/PkXbyAHb8G3lGXZVthRTxwGbX90xJ+PNzklorCCzTM26DTvEFp5FAUi7TJ17diohJR1IWimDjudssuEMFnBYI23Vc8rKvrH851+zdXSxhpQ7cXn4H3lxetFVw8XAWiHR7cFo1e+3tPmpUqMcVwQXUNEu1hl/XQiW5bhbhEi6ji+Lm0GuPQDbSKcYEaikNgu48pjWz0JMHfsnoI0p6wOW8GWjsE/o6kgTsF0RGIDrgo3ucsgo0Jt8Vv08bQhSgeFcWOFGsDgZKIiEdu3Z7QQLp0XCIHzO2FNieBujSRlS1utSTaVaLhRPBtb0rjpjmmDYGiiFYxJYKzIs8tmWQ7dMEjiCggPTG14NixXBqVxecFhemIJ0zk86TpmTmgwljiS6MsotHmLEiUEh/MHsRxeSyLtL/oCC1xrM12HubUbEaZVoVBQFQMtpCon/b7z4z8WWBRhAUVFqUuTh9NZiKOxbGvIUrFg3gRbAeieGlsgYtFJKH2kMou2fDjUTy+059S8TjRJkrovbci0U9eyD+diBzKE1MnB1WWLxPdxcLlhIhot9v9/nNTw5nhqy+3S0VjXTdjFbk4IGqfmXPI4re5F7lVLLjdcM8/Y5dFg6JzU6GNzjscroWiUawrR0SeNsgqxrzRrUl37kUx3WFpqStNJQA88GA7pn2O0CvYieRcd8NHCQaSBeCykOsERJWdTq6bHEyLx88eGL+KxDJst9/Ti60GCi6NEi3kbpzej2X4mkj4xG9a+asANSAqCJalDOXl/xYPQaW4yPPZMGX0KBdriTSQUOt6Lot5fjmLC0SD86KrYn9E3KhnOHxSNo5vYonR9Gu15vKGwwxRdGQmeEMavJCunut6ejFtP3CNg4HMJE1+P+AzeM+wR1R4XMx4BmUTcBgz3hMcyeKZtIinYaY4BUmgiedp+j4Me7bNNOUdFgSevofLUktbPO/LZoYT54Bb8rBgpsc+0ImZwxlbVOWHNdMdsQwG+2YeldOwOb6wUKNt1gbNUn5GNSmsCHY53KoBtstmAc3J97kSlKVVEU2zkJM0ZklKCtUMNY5o2HRkltCYWMcSaLbJTMMs5SxcPHOWjrBvVvAhHLpmUYuKPppVvDwlzdSsdODK7iuz2vRs/gYd+LJG2ys8upzaASxRjS6gQqYnoWgqzkg8xU3hfnA8JU9xk7ZZFOt71DT0aFH4Yc/6pgF+nGhEnnVN5AnSjAa7xT1+Pe2qx8+L1uH6po8k0jjAJ/asz75vDrJv/psGa9jTMI/giEzEkXkU51+5ri/fzSMpb4OGls+jTbsw9kd6dHhFxvUP+UcVEFbrYnwAAAAASUVORK5CYII=";function eoe(e){const t={VITE_APP_NAME:"shenlan-effect",VITE_APP_TITLE:"效果预览",VITE_OUTPUT_DIR:"dist",VITE_APP_ENV:"production",VITE_APP_BASE_URL:"",VITE_USE_DEBUG:"",VITE_USE_MOCK:"",VITE_DELETE_CONSOLE:"true",VITE_ZIP_OUTPUT_DIR:"",VITE_BUNDLE_ANALYZER:"",VITE_USE_GZIP:"true",VITE_l7IMAGE:"https://www.ifengniao.com/upload/ybimg/",BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1,VITE_APP_VERSION:"0.0.0",VITE_APP_BUILD_TIME:"2025-01-24 09:38:53"},{ImageLayer:r,Mapbox:n,Scene:i,Popup:o,l7HandleImageMaxRange:a,l7ConvertCMtoL:u,PointLayer:c,LineLayer:h,PolygonLayer:y,DrawPolygon:x,l7Scale:E,l7ConvertLtoCM:T}=Kae(),I=w1({scene:null,l7MapWidth:0});let k=null;function D(ze=19.85){return new Promise(Be=>{const $e=new i({id:e,logoVisible:!1,map:new n({style:"light",center:[0,0],pitch:0,zoom:ze,minZoom:18})});I.scene=$e,$e.on("loaded",()=>{k=new o({offsets:[0,0],closeButton:!1}),Be()})})}function V(){try{I.scene.removeAllLayer(),I.scene.drawPolygon.clear()}catch{}}function O(){return I.scene}function F(ze){ze={width:2048,height:950,src:t.VITE_l7IMAGE+"room2.png"};const Be=I.scene,$e=a(ze.width,ze.height),it=$e.maxRange;I.l7MapWidth=$e.l7MapWidth;const mt=new r({});mt.source(ze.src,{parser:{type:"image",extent:[0,0,...it]}}),Be.setCenter([it[0]/2,it[1]/2]),Be.addLayer(mt)}const N=w1({data:[],list:{}});function H(ze){ze=Ne().station;const Be=I.scene,$e=N,it=I.l7MapWidth;$e.data=ze,Be.addImage("Gateway",Qae),Be.addImage("GatewayCar",Jae);const mt=$e.data.reduce((Qe,rt)=>{const[gt,er]=u([rt.setX,rt.setY],it),zt={...rt,lng:gt,lat:er};return Qe[rt.type]?Qe[rt.type].push(zt):Qe[rt.type]=[zt],Qe},{});for(const Qe in mt)Object.hasOwnProperty.call(mt,Qe)&&q(mt[Qe],Qe)}function q(ze,Be){const $e=I.scene,it=new c({zIndex:3}).source(ze,{parser:{type:"json",x:"lng",y:"lat",name:"type"}}).shape(Be).size(20);it.on("mousemove",mt=>{k.setLnglat(mt.lngLat).setHTML(`<span>
                <p>编号:${mt.feature.gateway}</p>
                <p>类型: Gateway</p>
                <p>X:${mt.feature.setX}</p>
                <p>Y:${mt.feature.setY}</p>
              </span>`),$e.addPopup(k)}),it.on("mouseout",()=>{k.hide()}),N.list[Be]={layer:it,source:ze},$e.addLayer(it)}function Y(ze){ze=Ne().stationList;const Be=I.scene,$e=I.l7MapWidth,it=ze.reduce((gt,er)=>{const[zt,qt]=u([er.posX,er.posY],$e);return gt.push({...er,lng:zt,lat:qt}),gt},[]),mt=new c({zIndex:3}).source(it,{parser:{type:"json",x:"lng",y:"lat",name:"type"}}).shape("circle").size(5).color("mag",()=>"#5B8FF9");Be.addLayer(mt);const Qe=[];for(let gt=0;gt<ze.length;gt++){const er=ze[gt],zt=ze[gt+1];if(zt){const[qt,Zr]=u([er.posX,er.posY],$e),[Wr,On]=u([zt.posX,zt.posY],$e);Qe.push({...er,lng:qt,lat:Zr,lng1:Wr,lat1:On})}}const rt=new h({zIndex:3}).source(Qe,{parser:{type:"json",x:"lng",y:"lat",x1:"lng1",y1:"lat1"}}).shape("line").size(2).color("#5B8FF9").animate({interval:.4,duration:1,trailLength:.8}).style({lineTexture:!0,iconStep:20});Be.addLayer(rt)}function ee(ze){const Be=I.scene,$e=N.list.GatewayCar;ze?q($e.source,"GatewayCar"):Be.removeLayer($e.layer)}const pe=w1({data:[],source:null});function ue(ze){ze=Ne().fence;const Be=I.scene,$e=I.l7MapWidth;pe.data=ze,pe.data.forEach(it=>{const mt={type:"FeatureCollection",features:[{type:"Feature",properties:{name:it.name,code:it.fenceId,c:it.type==="In"?"#95de64":"#ffd666"},geometry:{type:"Polygon",coordinates:[it.points.map(rt=>u([rt.x,rt.y],$e))]}}]},Qe=new y({zIndex:4,name:"fence-layout-"+it.fenceId,active:!0,activeColor:"red"}).source(mt).shape("fill").color("c").style({opacity:.6});it.polygonLayer=Qe,Be.addLayer(Qe)})}function ie(ze){ze?ue(pe.data):pe.data.forEach(Be=>{I.scene.removeLayer(Be.polygonLayer)})}function xe(){const ze=I.l7MapWidth,Be=Ne().fence.reduce((it,mt)=>(it.push({type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[mt.points.map(Qe=>u([Qe.x,Qe.y],ze))]}}),it),[]),$e=new x(I.scene,{initialData:Be,liveUpdate:!0,distanceOptions:{showTotalDistance:!1,showDashDistance:!0,format:it=>it>=1e3?+(it/E.value/1e3).toFixed(2)+"km":+(it/E.value).toFixed(2)+"m"}});$e.enable(),I.scene.drawPolygon=$e}function Se(){const ze=I.l7MapWidth;return I.scene.drawPolygon.getPolygonData().map(it=>{var Qe;return((Qe=it.geometry.coordinates)==null?void 0:Qe[0]).map(rt=>{const[gt,er]=rt??[],[zt,qt]=T([gt,er],ze);return{x:zt,y:qt}})})}function Ne(){return{station:[{gateway:"10030240",mapId:"1645334018633216001",groupId:"3",name:"中心",productName:"gateway",systemId:"10990145",type:"Gateway",status:"Online",ip:"61.194.146.44",fenceIds:null,setX:3.5,setY:1.9,setZ:2.5,angle:90,hisX:.306456,hisY:-.306456,hisZ:-9.65336,updateTime:1687752916,extraInfo:null},{gateway:"10030241",mapId:"1645334018633216001",groupId:"3",name:"原点",productName:"gateway",systemId:"10990145",type:"Gateway",status:"Offline",ip:"61.194.146.44",fenceIds:null,setX:.5,setY:2.1,setZ:2.5,angle:90,hisX:0,hisY:-.153228,hisZ:-10.4195,updateTime:1687752920,extraInfo:null},{gateway:"10030240",mapId:"1645334018633216001",groupId:"3",name:"中心",productName:"gateway",systemId:"10990145",type:"GatewayCar",status:"Online",ip:"61.194.146.44",fenceIds:null,setX:3.9,setY:2,setZ:2.5,angle:90,hisX:.306456,hisY:-.306456,hisZ:-9.65336,updateTime:1687752916,extraInfo:null},{gateway:"10030241",mapId:"1645334018633216001",groupId:"3",name:"原点",productName:"gateway",systemId:"10990145",type:"GatewayCar",status:"Offline",ip:"61.194.146.44",fenceIds:null,setX:1,setY:4.1,setZ:2.5,angle:90,hisX:0,hisY:-.153228,hisZ:-10.4195,updateTime:1687752920,extraInfo:null}],stationList:[{gateway:"10030240",mapId:"1645334018633216001",groupId:"3",name:"中心",productName:"gateway",systemId:"10990145",type:"Gateway",status:"Online",ip:"61.194.146.44",fenceIds:null,posX:3.5,posY:1.9,setZ:2.5,angle:90,hisX:.306456,hisY:-.306456,hisZ:-9.65336,updateTime:1687752916,extraInfo:null},{gateway:"10030240",mapId:"1645334018633216001",groupId:"3",name:"中心",productName:"gateway",systemId:"10990145",type:"Gateway",status:"Online",ip:"61.194.146.44",fenceIds:null,posX:3.62,posY:1.9,setZ:2.5,angle:90,hisX:.306456,hisY:-.306456,hisZ:-9.65336,updateTime:1687752916,extraInfo:null},{gateway:"10030240",mapId:"1645334018633216001",groupId:"3",name:"中心",productName:"gateway",systemId:"10990145",type:"Gateway",status:"Online",ip:"61.194.146.44",fenceIds:null,posX:3.73,posY:2,setZ:2.5,angle:90,hisX:.306456,hisY:-.306456,hisZ:-9.65336,updateTime:1687752916,extraInfo:null}],fence:[{fenceId:"1656844789678571521",name:"充电站",mapId:"1645334018633216001",mapName:"3F-RoomC",type:"Out",points:[{x:.37,y:2.12},{x:1.75,y:2.12},{x:1.4,y:3.16},{x:.42,y:3.14},{x:.37,y:2.12}],enabled:!0},{fenceId:"1673196278525186049",name:"禁止进入",mapId:"1645334018633216001",mapName:"3F-RoomC",type:"In",points:[{x:2.75,y:1.94},{x:3.97,y:1.92},{x:3.97,y:2.92},{x:2.76,y:2.91},{x:2.75,y:1.94}],enabled:!0}]}}return{l7:I,mapInit:D,mapClear:V,mapGetScene:O,mapSetBackgroundImage:F,pointLayerSetData:H,pointLayerListSetData:Y,pointLayerToggleJizhan:ee,polygonLayerSetData:ue,polygonLayerToggle:ie,polygonLayerSetEdit:xe,polygonLayerGetData:Se}}const toe={class:"sl-com-l7"},roe=["id"],noe={__name:"index",props:{id:{type:String,default:"l7-map-default"},fullscreen:{type:Boolean,default:!0}},setup(e,{expose:t}){const r=e,{mixinFullscreen:n,mixinFullscreenMethod:i}=HD(),{l7:o,mapInit:a,mapClear:u,mapGetScene:c,mapSetBackgroundImage:h,pointLayerSetData:y,pointLayerListSetData:x,pointLayerToggleJizhan:E,polygonLayerSetData:T,polygonLayerToggle:I,polygonLayerSetEdit:k,polygonLayerGetData:D}=eoe(r.id);return t({l7:o,mapInit:a,mapClear:u,mapGetScene:c,mapSetBackgroundImage:h,pointLayerSetData:y,pointLayerListSetData:x,pointLayerToggleJizhan:E,polygonLayerSetData:T,polygonLayerToggle:I,polygonLayerSetEdit:k,polygonLayerGetData:D}),(V,O)=>{const F=OD("fullscreen");return B2(),z2("div",toe,[gv(F,{modelValue:pf(n),"onUpdate:modelValue":O[1]||(O[1]=N=>ND(n)?n.value=N:null),class:"l7-full"},{default:yv(()=>[df("div",{id:e.id,class:"l7-map"},[e.fullscreen?(B2(),z2("span",{key:0,class:DD(["span-full",{selected:pf(n)}]),onClick:O[0]||(O[0]=(...N)=>pf(i)&&pf(i)(...N))},null,2)):FD("",!0)],8,roe)]),_:1},8,["modelValue"])])}}},X5=Y5(noe,[["__scopeId","data-v-dedb2821"]]);function ioe(e){let t=w1({switch:{layer:!0,polygon:!0}});function r(){e.value.mapInit().then(()=>{e.value.mapSetBackgroundImage(),e.value.pointLayerSetData(),e.value.pointLayerListSetData(),e.value.polygonLayerSetData()})}function n(o){e.value.pointLayerToggleJizhan(o)}function i(o){e.value.polygonLayerToggle(o)}return{demo1:t,demo1Init:r,l7MapToggleJiZhanLayer:n,l7MapTogglePolygonLayer:i}}function aoe(e){function t(){e.value.mapInit().then(()=>{e.value.mapSetBackgroundImage(),e.value.polygonLayerSetData(),e.value.polygonLayerSetEdit()})}function r(){}return{demo2Init:t,demo2MapGetDrawPolygonData:r}}const ab=e=>(UD("data-v-f2324a93"),e=e(),VD(),e),ooe={class:"sl-main-content"},soe=ab(()=>df("p",null,"展示",-1)),uoe={class:"flex"},loe={class:"sl-margin-right-10"},coe=ab(()=>df("label",null,"基站",-1)),foe=ab(()=>df("label",null,"围栏",-1)),hoe={id:"demo-1",class:"map"},poe=ab(()=>df("p",null,"可编辑",-1)),doe={class:"extra"},voe={id:"demo-2",class:"map"},moe={__name:"index",setup(e){const t=z1(null),{demo1:r,demo1Init:n,l7MapToggleJiZhanLayer:i,l7MapTogglePolygonLayer:o}=ioe(t),a=z1(null),{demo2Init:u,demo2MapGetDrawPolygonData:c}=aoe(a);return BD(()=>{n(),u()}),(h,y)=>{const x=$D,E=jD,T=GD;return B2(),z2("div",ooe,[gv(E,null,{title:yv(()=>[soe]),extra:yv(()=>[df("div",uoe,[df("div",loe,[coe,gv(x,{modelValue:pf(r).switch.layer,"onUpdate:modelValue":y[0]||(y[0]=I=>pf(r).switch.layer=I),onChange:pf(i)},null,8,["modelValue","onChange"])]),df("div",null,[foe,gv(x,{modelValue:pf(r).switch.polygon,"onUpdate:modelValue":y[1]||(y[1]=I=>pf(r).switch.polygon=I),onChange:pf(o)},null,8,["modelValue","onChange"])])])]),default:yv(()=>[df("div",null,[df("div",hoe,[gv(pf(X5),{id:"sll7-1",ref_key:"sll7_1",ref:t},null,512)])])]),_:1}),gv(E,{class:"sl-margin-top-10"},{title:yv(()=>[poe]),extra:yv(()=>[df("div",doe,[gv(T,{type:"primary",onClick:pf(c)},{default:yv(()=>[zD("获取数据")]),_:1},8,["onClick"])])]),default:yv(()=>[df("div",null,[df("div",voe,[gv(pf(X5),{id:"sll7-2",ref_key:"sll7_2",ref:a},null,512)])])]),_:1})])}}},boe=Y5(moe,[["__scopeId","data-v-f2324a93"]]);export{boe as default};
